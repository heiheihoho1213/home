<!DOCTYPE html><!--gG_fcHfRh54_2G67d48NM--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"/><link rel="stylesheet" href="/_next/static/chunks/744327b7484b60d6.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/52e4b58ae5a7041b.js"/><script src="/_next/static/chunks/fa94dba651fb58dc.js" async=""></script><script src="/_next/static/chunks/60cf7f2c7c289349.js" async=""></script><script src="/_next/static/chunks/eaaf1ef2afcba9c5.js" async=""></script><script src="/_next/static/chunks/20efe54c3743fa22.js" async=""></script><script src="/_next/static/chunks/turbopack-3ca9a878e9997434.js" async=""></script><script src="/_next/static/chunks/13d576de3999a9ec.js" async=""></script><script src="/_next/static/chunks/b18da497cd71639c.js" async=""></script><script src="/_next/static/chunks/a43937f87dbafba4.js" async=""></script><script src="/_next/static/chunks/4a4bc4fd39133772.js" async=""></script><link rel="preload" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&amp;display=swap" as="style"/><link rel="icon" href="/favicon.svg" type="image/svg+xml"/><link rel="apple-touch-icon" href="/favicon.svg"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><title>Heiheihoho&#x27;s Portfolio</title><meta name="description" content="A portfolio showcasing my projects, blogs, and gallery explorations."/><link rel="shortcut icon" href="/favicon.svg"/><link rel="icon" href="/favicon.svg"/><link rel="apple-touch-icon" href="/favicon.svg"/><link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body><div hidden=""><!--$--><!--/$--></div><div class="min-h-screen flex flex-col bg-[#f0f0f0] text-black"><div class="fixed inset-0 z-[100] bg-[#f3f4f6] flex flex-col items-center justify-center p-4"><div class="w-full max-w-lg"><div class="flex justify-between items-end mb-2"><span class="font-bold font-mono uppercase text-sm tracking-widest">System Boot</span><span class="font-black text-6xl md:text-8xl leading-none">0<!-- -->%</span></div><div class="w-full h-6 md:h-8 border-4 border-black p-1 bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]"><div class="h-full bg-black transition-all duration-200 ease-out" style="width:0%"></div></div><div class="mt-4 font-mono text-xs md:text-sm text-gray-500 space-y-1 h-20"><p>&gt;<!-- --> Initializing core modules...</p></div></div></div></div><script src="/_next/static/chunks/52e4b58ae5a7041b.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[85728,[\"/_next/static/chunks/13d576de3999a9ec.js\"],\"LanguageProvider\"]\n3:I[59015,[\"/_next/static/chunks/13d576de3999a9ec.js\"],\"Layout\"]\n4:I[4342,[\"/_next/static/chunks/b18da497cd71639c.js\",\"/_next/static/chunks/a43937f87dbafba4.js\"],\"default\"]\n5:I[18580,[\"/_next/static/chunks/b18da497cd71639c.js\",\"/_next/static/chunks/a43937f87dbafba4.js\"],\"default\"]\n7:I[99706,[\"/_next/static/chunks/b18da497cd71639c.js\",\"/_next/static/chunks/a43937f87dbafba4.js\"],\"OutletBoundary\"]\n8:\"$Sreact.suspense\"\na:I[99706,[\"/_next/static/chunks/b18da497cd71639c.js\",\"/_next/static/chunks/a43937f87dbafba4.js\"],\"ViewportBoundary\"]\nc:I[99706,[\"/_next/static/chunks/b18da497cd71639c.js\",\"/_next/static/chunks/a43937f87dbafba4.js\"],\"MetadataBoundary\"]\ne:I[576,[\"/_next/static/chunks/b18da497cd71639c.js\",\"/_next/static/chunks/a43937f87dbafba4.js\"],\"default\"]\n:HL[\"/_next/static/chunks/744327b7484b60d6.css\",\"style\"]\n:HL[\"https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700\u0026display=swap\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"gG-fcHfRh54-2G67d48NM\",\"c\":[\"\",\"blog\",\"\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[\"__PAGE__\",{}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/744327b7484b60d6.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/13d576de3999a9ec.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.svg\",\"type\":\"image/svg+xml\"}],[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"href\":\"/favicon.svg\"}],[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.googleapis.com\"}],[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.gstatic.com\",\"crossOrigin\":\"anonymous\"}],[\"$\",\"link\",null,{\"href\":\"https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700\u0026display=swap\",\"rel\":\"stylesheet\"}]]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"children\":[\"$\",\"$L3\",null,{\"children\":[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]}]]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L6\",[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/4a4bc4fd39133772.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"$L7\",null,{\"children\":[\"$\",\"$8\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@9\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$La\",null,{\"children\":\"$@b\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"$8\",null,{\"name\":\"Next.Metadata\",\"children\":\"$@d\"}]}]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$e\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"f:I[37767,[\"/_next/static/chunks/13d576de3999a9ec.js\",\"/_next/static/chunks/4a4bc4fd39133772.js\"],\"default\"]\n10:Tbd4,"])</script><script>self.__next_f.push([1,"è¿˜è®°å¾—å‡ ä¸ªæœˆå‰ï¼Œæ˜é‡‘ä½œè€… ***@çŒ«é—·å°817*** çš„ Vue3 ç‰ˆä¸Šçº¿äº†ï¼Œåœ°å€æ˜¯è¿™ä¸ªï¼š\u003chttps://github.com/maomentai817/pixel-ui\u003e ã€‚ç°åœ¨æˆ‘ä¸ä»–åˆä½œçš„ React ç‰ˆä¹Ÿæ¥äº†ï¼Œgithub åœ°å€ï¼š\u003chttps://github.com/maomentai817/pixel-ui-react\u003e\n\n***\n\n![image.png](/img/posts/Pixel-UI-React/1.jpeg)\n\n### 1ï¸âƒ£ é¡¹ç›®åˆè¡·\n\nçº¢ç™½æœºã€GameBoy æ¸¸æˆï¼Œé‚£ç§å—çŠ¶åƒç´  UI æ€»è®©äººå¿ƒé©°ç¥å¾€ã€‚ç°åœ¨è™½ç„¶æ˜¯ç°ä»£ Web æ—¶ä»£ï¼Œä½†åƒç´ é£ UI çš„ç¾å­¦ä¾ç„¶ä»¤äººç€è¿·ã€‚\n\nç°æœ‰çš„ 8-bit é£ç»„ä»¶åº“ *NES.css* æ˜¯ä¸€ä¸ª CSS æ¡†æ¶, å®ƒåªéœ€è¦ CSSï¼Œä¸ä¾èµ–äºä»»ä½• JavaScript, æ ¸å¿ƒç»˜åˆ¶é€»è¾‘éƒ½æ˜¯åŸºäº *box-shadow* å®ç°, ä½†åœ¨ä¸åŒæµè§ˆå™¨ç¯å¢ƒ, æµè§ˆå™¨ç¼©æ”¾æ—¶ï¼Œ*box-shadow* çš„æµ®ç‚¹åç§»å€¼ç»è¿‡ç¼©æ”¾åæ— æ³•ç²¾å‡†å¯¹é½ç‰©ç†åƒç´ ç½‘æ ¼ï¼Œå¯¼è‡´æ¸²æŸ“å‡ºç°é—´éš™ã€‚å­åƒç´ å®šä½ã€åƒç´ èˆå…¥è¯¯å·®å’Œ *box-shadow* æœ¬èº«ä¸é€‚åˆç²¾ç»†æ‹¼æ¥æ¸²æŸ“ç­‰åŸå› é€ æˆäº†ä¸€äº›å›°æ‰°\n\n![QQ\\_1747188289846.png](/img/posts/Pixel-UI-React/2.jpeg)\n\n[NES.css](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnostalgic-css%2FNES.css \"https://github.com/nostalgic-css/NES.css\")\n\näºæ˜¯å°±æœ‰äº†åŸºäº Vue 3 / React + TypeScript + UnoCSS + CSS Houdini æ‰“é€ çš„ä¸€æ¬¾ç»„ä»¶åº“ â€”â€” è®©**åƒç´ é£é‡å›å‰ç«¯è§†é‡**ã€‚\n\nVue3 é¡¹ç›®åœ°å€ğŸ‘‡\\\nğŸ“¦ [pixel-ui](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmaomentai817%2Fpixel-ui \"https://github.com/maomentai817/pixel-ui\")\n\nReact é¡¹ç›®åœ°å€ğŸ‘‡\\\nğŸ“¦ [pixel-ui-react](https://github.com/maomentai817/pixel-ui-react)\n\nç»„ä»¶åº“é¦–é¡µğŸ‘‡\\\nğŸ“ [Home](https://maomentai817.github.io/pixel-ui-react)\n\n***\n\n### 2ï¸âƒ£ æŠ€æœ¯é€‰å‹\n\n| æŠ€æœ¯æ ˆ               | ç”¨é€”                       |\n| ----------------- | ------------------------ |\n| React19 + *Hooks* | ç»„ä»¶åŒ–å¼€å‘æ ¸å¿ƒ                  |\n| TypeScript        | ç±»å‹ç³»ç»Ÿå¢å¼ºå¼€å‘ä½“éªŒ               |\n| UnoCSS            | åŸå­åŒ– CSSï¼Œçµæ´»é…ç½®æ ·å¼ç±»          |\n| CSS Houdini       | è‡ªå®šä¹‰ Paint Worklet æ¸²æŸ“åƒç´ è¾¹æ¡† |\n| Dumi              | ç»„ä»¶å±•ç¤º + æ–‡æ¡£ç³»ç»Ÿ              |\n| Vitest            | æµ‹è¯•ç»„ä»¶é€»è¾‘ä¸æ¸²æŸ“                |\n| pnpm + Monorepo     | é«˜æ•ˆæ„å»ºä¸å¤šåŒ…ç®¡ç†                |\n\n***\n\n### 3ï¸âƒ£ é¡¹ç›®ç›®å‰è¿›åº¦\n\nå·²è¿ç§»ä¸Šçº¿ç»„ä»¶ï¼š\n\n*   âœ… Button æŒ‰é’®\n*   âœ… Icon å›¾æ ‡\n*   âœ… Overlay é®ç½©å±‚\n*   âœ… Text æ–‡æœ¬\n*   âœ… ConfigProvider å…¨å±€é…ç½®\n*   âœ… Input è¾“å…¥æ¡†\n*   âœ… Popconfirm æ°”æ³¡ç¡®è®¤æ¡†\n*   âœ… Tooltip æ–‡å­—æç¤º\n\nå·²å‘å¸ƒ npmï¼Œå¯ä¾›ä¸‹è½½ã€‚\n\n\u003e æ›´è¿‡è§„åˆ’è§ vue ç‰ˆï¼š\u003chttps://juejin.cn/post/7503846429081944101\u003e\n\n***\n\n### 4ï¸âƒ£ æ•ˆæœé¢„è§ˆ\n\n![image.png](/img/posts/Pixel-UI-React/3.jpeg)\n\n![image.png](/img/posts/Pixel-UI-React/4.jpeg)\n\n![image.png](/img/posts/Pixel-UI-React/5.jpeg)\n\næ¬¢è¿å¤§å®¶ï¼š\n\n*   ğŸŒŸ ç‚¹ä¸ª Star\n*   ğŸ› æ Issueï¼Œæœ‰ä»€ä¹ˆå¥½çš„ç‚¹å­å’Œæƒ³æ³•éƒ½å¯ä»¥æ\n*   ğŸ¤ æ PRï¼Œå¢å¼ºå®Œå–„åŠŸèƒ½\n*   ğŸ“¢ åˆ†äº«ç»™åƒç´ æ§æœ‹å‹ï¼\n\n\u003e é¡¹ç›®åœ°å€ï¼š\u003chttps://github.com/maomentai817/pixel-ui-react\u003e"])</script><script>self.__next_f.push([1,"11:Ta042,"])</script><script>self.__next_f.push([1,"## 1. è™šæ‹Ÿ DOM\n\n#### ä¸ºä»€ä¹ˆä½¿ç”¨è™šæ‹Ÿ DOMï¼ˆvdomï¼‰\n\n- DOM æ“ä½œå¾ˆæ…¢ï¼Œè½»å¾®çš„æ“ä½œéƒ½å¯èƒ½å¯¼è‡´é¡µé¢é‡æ–°æ’ç‰ˆï¼Œéå¸¸è€—æ€§èƒ½ã€‚ç›¸å¯¹äº DOM å¯¹è±¡ï¼Œjs å¯¹è±¡å¤„ç†èµ·æ¥æ›´å¿«ï¼Œè€Œä¸”æ›´ç®€å•ã€‚é€šè¿‡ diff ç®—æ³•å¯¹æ¯”æ–°æ—§ vdomï¼ˆjs å¯¹è±¡ï¼‰ ä¹‹é—´çš„å·®å¼‚ï¼Œå¯ä»¥æ‰¹é‡çš„ã€æœ€å°åŒ–çš„æ‰§è¡Œ dom æ“ä½œï¼Œä»è€Œæå‡ç”¨æˆ·ä½“éªŒ\n- DOM å†…ç½®å±æ€§å¤ªå¤šï¼Œä½¿ç”¨ vdom å¯ä»¥åªå°è£…è‡ªå·±æƒ³è¦çš„å±æ€§æ¥å‡å°‘è®¡ç®—å¼€é”€\n  ![å›¾ç‰‡](/img/posts/react/old-dom.png)\n\n#### react æ¸²æŸ“\n\nåœ¨æŸä¸€æ—¶é—´èŠ‚ç‚¹è°ƒç”¨ React çš„ render() æ–¹æ³•ï¼Œä¼šåˆ›å»ºä¸€æ£µç”± React å…ƒç´ ç»„æˆçš„æ ‘ã€‚åœ¨ä¸‹ä¸€æ¬¡ state æˆ– props æ›´æ–°æ—¶ï¼Œç›¸åŒçš„ render() æ–¹æ³•ä¼šè¿”å›ä¸€æ£µä¸åŒçš„æ ‘ã€‚React éœ€è¦åŸºäºè¿™ä¸¤æ£µæ ‘ä¹‹é—´çš„å·®åˆ«æ¥åˆ¤æ–­å¦‚ä½•æœ‰æ•ˆç‡çš„æ›´æ–° UI ä»¥ä¿è¯å½“å‰ UI ä¸æœ€æ–°çš„æ ‘ä¿æŒåŒæ­¥ã€‚è¿™ç§ç®—æ³•èµ·ä¸ªåå­—ï¼Œå«åš DIFF ç®—æ³•ï¼Œå­—é¢æ„æ€ï¼Œå°±æ˜¯å¯¹æ¯”å·®å¼‚ã€‚\n\n#### DIFF\n\nreact æ¸²æŸ“æ ‘ï¼š\n\n![å›¾ç‰‡](/img/posts/react/diff-tree.png)\n\nç®—æ³•ç­–ç•¥\n\n- æ·±åº¦ä¼˜å…ˆéå†\n- åŒçº§æ¯”è¾ƒ\n- æ‹¥æœ‰ä¸åŒç±»å‹çš„ä¸¤ä¸ªç»„ä»¶å°†ä¼šç”Ÿæˆä¸åŒçš„æ ‘å½¢ç»“æ„ã€‚\n- ä½¿ç”¨ key æ¥ä¿æŒç¨³å®šæ¸²æŸ“\n\ndiff åŸåˆ™\n\n- åˆ é™¤ï¼šnewVdom ä¸å­˜åœ¨æ—¶\n- æ›¿æ¢ï¼švdom å’Œ newVdom ç±»å‹ä¸åŒæˆ– key ä¸åŒæ—¶\n- æ›´æ–°ï¼šæœ‰ç›¸åŒç±»å‹å’Œ key ä½† vdom å’Œ newVdom ä¸åŒæ—¶\n\n## 2. Fiber ç»“æ„\n\nä¸ºä»€ä¹ˆéœ€è¦ fiber\n\nä¸€ä¸ªæ–°çš„æ›´æ–°æ¸²æŸ“ç»“æ„ï¼Œæ›´å¥½çš„éå†æ¸²æŸ“æ ‘ï¼Œæé«˜æ€§èƒ½ã€‚\n\n- diff ç®—æ³•é‡‡ç”¨æ·±åº¦ä¼˜å…ˆéå†ï¼ˆé€’å½’ï¼‰çš„æ–¹å¼ï¼Œå¯¹äºå¤§å‹é¡¹ç›®ï¼Œç»„ä»¶æ ‘ä¼šå¾ˆå¤§ï¼Œè¿™ä¸ªæ—¶å€™é€’å½’éå†çš„æˆæœ¬å°±ä¼šå¾ˆé«˜ï¼Œä¼šé€ æˆä¸»çº¿ç¨‹è¢«æŒç»­å ç”¨ï¼Œç»“æœå°±æ˜¯ä¸»çº¿ç¨‹ä¸Šçš„å¸ƒå±€ã€åŠ¨ç”»ç­‰å‘¨æœŸæ€§ä»»åŠ¡å°±æ— æ³•ç«‹å³å¾—åˆ°å¤„ç†ï¼Œé€ æˆè§†è§‰ä¸Šçš„å¡é¡¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚\n\nfiber æ ¸å¿ƒæ€æƒ³\n\n1. å¢é‡æ¸²æŸ“ï¼Œç©ºé—²æ›´æ–°ï¼ˆæŠŠæ¸²æŸ“ä»»åŠ¡æ‹†åˆ†æˆå—ï¼ŒåŒ€åˆ°å¤šå¸§ï¼‰ï¼Œä½¿ç”¨é“¾è¡¨å¾ªç¯ä»£æ›¿é€’å½’æ¥è¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†ï¼Œç®—æ³•æ—¶é—´å¤æ‚åº¦ O(n)\n2. æ›´æ–°æ—¶èƒ½å¤Ÿæš‚åœï¼Œç»ˆæ­¢ï¼Œå¤ç”¨æ¸²æŸ“ä»»åŠ¡\n3. ç»™ä¸åŒç±»å‹çš„æ›´æ–°èµ‹äºˆä¼˜å…ˆçº§\n4. ç»™æ–°ç‰ˆ react æä¾›å¹¶å‘çš„åŸºç¡€èƒ½åŠ›\n\n![å›¾ç‰‡](/img/posts/react/fiber-1.jpeg)\n\nfiber æ ‘(åŒå‘é“¾è¡¨)ï¼š\n\n```js\n// å‚è€ƒ jsx\n\u003cdiv\u003e\n  \u003carticle\u003e\n    \u003cspan\u003e\u003c/span\u003e\n  \u003c/article\u003e\n  \u003cp\u003e\n    \u003cstrong\u003e\u003c/strong\u003e\n  \u003c/p\u003e\n  \u003ca\u003e\u003c/a\u003e\n\u003c/div\u003e\n```\n\n![å›¾ç‰‡](/img/posts/react/fiber-2.png)\n\nå› ä¸ºè¦å€ŸåŠ© fiberï¼Œæ‰€ä»¥åœ¨ vdom å¤–éœ€è¦åŒ…è£…ä¸€ä¸ª fiber node çš„å°è£…æ¥å‚ä¸è°ƒåº¦ã€‚\n\n## 3. å®ç°ä¸€ä¸ª mini-fiber\n\n### ã€‡ æµç¨‹å›¾\n\n![å›¾ç‰‡](/img/posts/react/fiber.png)\n\n### â‘  Tags\n\nç”±äºè¦æ¸²æŸ“ä¸åŒçš„ç»„ä»¶å’ŒåŸç”Ÿæ ‡ç­¾ï¼Œç»™å„ä¸ªç±»å‹æ‰“ä¸Šæ ‡ç­¾ï¼š\n\n```js\n// ReactWorkTags\nexport const FunctionComponent = 0;\nexport const ClassComponent = 1;\nexport const IndeterminateComponent = 2;\n...\nexport const HostComponent = 5;\nexport const HostText = 6;\nexport const Fragment = 7;\n```\n\n### â‘¡ Fiber å¯¹è±¡\n\næ–°å»ºä¸€ä¸ª fiber å°è£…ç±»\n\n```js\n// ReactFiber\nexport function createFiber(vnode, returnFiber) {\n  const fiber = {\n    type: vnode.type, // è¡¨ç¤ºfiberçš„çœŸå®ç±»å‹ è¿™ä¸ªå’ŒelementTypeå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯ä¸€æ ·çš„ åœ¨ä½¿ç”¨äº†æ‡’åŠ è½½ä¹‹ç±»çš„åŠŸèƒ½æ—¶å¯èƒ½ä¼šä¸ä¸€æ ·ã€‚ åŒºåˆ«äº tagï¼Œtypeå¯ä»¥è‡ªå®šä¹‰ï¼Œå½“æ˜¯ç»„ä»¶æ—¶ typeå¯ä»¥æ˜¯è¿™ä¸ªç»„ä»¶çš„æ„é€ å‡½æ•°ï¼Œç”¨æˆ·åˆ›å»ºå…ƒç´ æ—¶ä½¿ç”¨\n    key: vnode.key,\n    props: vnode.props, // å±æ€§\n    // ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹fiber\n    child: null,\n    // ä¸‹ä¸€ä¸ªå…„å¼Ÿfiber\n    sibling: null,\n    // çˆ¶fiber\n    return: returnFiber,\n    // domæˆ–å®ä¾‹\n    // å‡½æ•°å¼ç»„ä»¶ä¸ºnullï¼Œä»–çš„å®ä¾‹å­˜åœ¨childé‡Œï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆrenderé‡Œåªèƒ½æœ‰ä¸€ä¸ªè·ŸèŠ‚ç‚¹\n    stateNode: null,\n    // èŠ‚ç‚¹ä¸‹æ ‡\n    index: null,\n    // old fiber\n    alternate: null,\n    flags: Placement,\n    tag: null,\n  };\n\n  const { type } = vnode;\n\n  // æ‰“ tag\n  if (isStr(type)) {\n    // åŸç”Ÿæ ‡ç­¾\n    fiber.tag = HostComponent; // ä¼ å…¥çš„æ˜¯dom.nodeName\n  } else if (isFn(type)) {\n    // å‡½æ•°ç»„ä»¶ ç±»ç»„ä»¶\n    fiber.tag = type.prototype.isReactComponent\n      ? ClassComponent\n      : FunctionComponent;\n  } else if (isUndefined(type)) {\n    // æ­¤æ—¶æ˜¯çº¯æ–‡æœ¬æˆ–æ•°å­—èŠ‚ç‚¹\n    fiber.tag = HostText;\n    fiber.props = { children: vnode };\n  } else {\n    fiber.tag = Fragment;\n  }\n\n  return fiber;\n}\n```\n\nå…¶ä¸­ flags ç”¨äºåŒºåˆ†æ¥ä¸‹æ¥è¿›è¡Œä»€ä¹ˆæ“ä½œï¼š\n\n```js\nexport const Placement = /*                    */ 0b0000000000000000000010; // 2\nexport const Update = /*                       */ 0b0000000000000000000100; // 4\nexport const Deletion = /*                     */ 0b0000000000000000001000; // 8\n```\n\n\u003e çŸ¥é“ä¸ºä»€ä¹ˆä½¿ç”¨ äºŒè¿›åˆ¶å—ï¼Ÿè€ƒè™‘åˆ°å³å°†è¿›è¡Œçš„æ“ä½œå¯èƒ½ä¼šæœ‰å¤šä¸ªï¼Œä¸ºäº†æé«˜å¯æ‰©å±•æ€§ï¼Œä½¿ç”¨äºŒè¿›åˆ¶æ–¹ä¾¿ä½è¿ç®—ï¼Œç›¸åŠ åŒæ ·å…·æœ‰å”¯ä¸€æ€§ã€‚åˆ¤æ–­ï¼š`state \u0026 Update === true`\n\nåŒºåˆ† å‡½æ•°å¼ç»„ä»¶å’Œç±»å¼ç»„ä»¶ï¼Œéœ€è¦é¢å¤–åŠ æ ‡å¿—ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ ç±»å¼ç»„ä»¶æœ€ç»ˆéƒ½ä¼šç»§æ‰¿ Component ç»„ä»¶ï¼Œæˆ‘èƒ½å°±åœ¨è¿™ä¸ªä¸Šè¾¹åšæ‰‹è„šï¼š\n\n```js\nexport default function Component(props) {\n  this.props = props;\n}\n\n// ç±»ç»„ä»¶æ ‡è®°\nComponent.prototype.isReactComponent = {};\n```\n\nåªè¦åˆ¤æ–­æœ‰æ²¡æœ‰ isReactComponent å°±å¯ä»¥åŒºåˆ†æ˜¯å¦æ˜¯å‡½æ•°å¼ç»„ä»¶äº†ã€‚\n\nå¦‚æ­¤å°±æ„å»ºäº†ä¸€ä¸ªå¯¹ react vdom äºŒæ¬¡å°è£…çš„ Fiber å¯¹è±¡ã€‚\n\n### â‘¢ æ¸²æŸ“å®¹å™¨\n\næˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒReact 17+ çš„æ ¹ç»„ä»¶æ¸²æŸ“æ–¹å¼ï¼š\n\n```js\n// æ–°çš„æ¸²æŸ“æ–¹å¼ï¼Œå¼€æ”¾å‡ºäº† root å¯¹è±¡å•ä¾‹ï¼Œæ–¹ä¾¿é‡å¤render\nconst root = ReactDOM.createRoot(document.getElementById(\"root\"));\nroot.render(jsx);\n\n...\nroot.render(jsx1);\n```\n\né‚£ä¸å¦‚å°±ä»è¿™é‡Œå…¥æ‰‹ï¼Œæ¥çœ‹çœ‹ fiber æ˜¯æ€ä¹ˆå°è£… dom çš„ã€‚\n\n```js\nfunction createRoot(container) {\n  const root = {\n    containerInfo: container,\n  };\n\n  return new ReactDOMRoot(root);\n}\n\nfunction ReactDOMRoot(internalRoot) {\n  this._internalRoot = internalRoot;\n}\n```\n\ncreateRoot è¿”å›äº†ä¸€ä¸ªæ–°çš„ ReactDOMRoot å¯¹è±¡:\n\n```js\nReactDOMRoot.prototype.render = function (children) {\n  const root = this._internalRoot;\n\n  updateContainer(children, root);\n};\n\nfunction updateContainer(element, container) {\n  const { containerInfo } = container;\n\n  // è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œ reactçš„å®¹å™¨æ ¹èŠ‚ç‚¹ä¸€å®šæ˜¯åŸç”Ÿçš„domï¼Œä¸ç„¶ä¸å­˜åœ¨nodeName\n  const rootFiber = createFiber(element, {\n    type: containerInfo.nodeName.toLocaleLowerCase(),\n    stateNode: containerInfo,\n  });\n\n  scheduleUpdateOnFiber(rootFiber);\n}\n```\n\nè¿™ä¸ªå¯¹è±¡å®ç°äº† root çš„ render æ–¹æ³•ï¼Œè°ƒç”¨äº† updateContainer æ–¹æ³•ã€‚è€Œè¿™ä¸ªæ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª Fiber å¯¹è±¡ï¼Œé€šè¿‡ scheduleUpdateOnFiber åŠ å…¥è°ƒåº¦å™¨ï¼š\n\n```js\nexport function scheduleUpdateOnFiber(fiber) {\n  // work in process\n  wip = fiber;\n  wipRoot = fiber;\n}\n```\n\nwork in process è¡¨ç¤ºå½“å‰æ­£åœ¨å¤„ç†çš„ fiber èŠ‚ç‚¹ã€‚\n\næˆ‘ä»¬çœ‹åˆ°äº†ï¼Œåˆå§‹åŒ–å·¥ä½œå®Œæˆåï¼Œä¼¼ä¹æ²¡æœ‰æ¸²æŸ“çš„æ“ä½œï¼Œåªæ˜¯ new äº†ä¸€å †å¯¹è±¡ã€‚æ‰€ä»¥éœ€è¦åˆ›å»ºä¸€ä¸ªè°ƒåº¦ä»»åŠ¡ã€‚\n\n### â‘£ è°ƒåº¦å™¨ä¹‹ä¸€\n\næµè§ˆå™¨æœ‰è‡ªå·±çš„è°ƒåº¦å·¥å…·ï¼š\n\n\u003e è¿™é‡Œæˆ‘ä»¬æš‚ä¸”ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦çš„ç©ºé—²æ—¶é—´ç‰‡è°ƒåº¦å·¥å…·ã€‚ç”±äºè€ƒè™‘åˆ°å…¼å®¹æ€§ï¼ŒReact è‡ªå·±å®ç°äº†è¿™ä¸ªå‡½æ•°ï¼Œæ”¾åœ¨ Scheduler é‡Œï¼Œä¸‹è¾¹ä¼šè®²åˆ°ã€‚\n\n```js\n// TODOï¼šreact scheduler éƒ¨åˆ†åŸç”Ÿå®ç°äº†ä¸€å¥—ï¼šæµè§ˆå™¨äº‹ä»¶å¾ªç¯ç©ºé—²æ—¶é—´æ®µå†…è°ƒç”¨å‡½æ•°æ’é˜Ÿ\nrequestIdleCallback(workLoop);\n```\n\næˆ‘ä»¬è¿™é‡Œå…³æ³¨çš„é‡ç‚¹è¿˜æ˜¯åœ¨å¦‚ä½•è°ƒåº¦ä¸Šï¼š\n\n```js\nfunction workLoop(IdleDeadLine) {\n  // å¯ä»¥è‡ªå·±å®šä¹‰ä¼˜å…ˆçº§æ¥æ ¸å®æ‰§è¡Œä»€ä¹ˆäº‹ä»¶ï¼Œè¿™é‡Œåˆ¤æ–­åªè¦ç©ºé—²å°±æ’é˜Ÿ\n  while (wip \u0026\u0026 IdleDeadLine.timeRemaining() \u003e 0) {\n    // æ‰§è¡Œä»»åŠ¡ï¼šä½¿ç”¨æ–°çš„ O(n) ç®—æ³•\n    performUnitOfWork();\n  }\n\n  // ç¡®ä¿è°ƒåº¦å™¨åœ¨è¿è¡Œ\n  requestIdleCallback(workLoop);\n\n  // å¦‚æœæ‰€æœ‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œcommitä¸€ä¸‹ï¼Œå°±æ˜¯è¯´è§¦å‘ä¸€æ¬¡æ›´æ–°ã€‚ä» root å¼€å§‹åˆ·æ–°ä¸€éæ¸²æŸ“\n  if (!wip \u0026\u0026 wipRoot) {\n    commitRoot();\n  }\n}\n```\n\nä¸Šè¾¹çš„ä»£ç æ˜¯ä¸€ä¸ªå¾ªç¯è°ƒåº¦ï¼Œåå¤è°ƒç”¨ requestIdleCallbackï¼Œè®© CPU åœ¨ç©ºé—²æ—¶é—´ç‰‡è°ƒç”¨æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„è°ƒåº¦å‡½æ•°æ¥æ¸²æŸ“ç•Œé¢ã€‚å½“æœ‰ç©ºé—²æ—¶é—´æ—¶ï¼Œæ‰§è¡Œ performUnitOfWorkï¼Œå½“æ²¡æœ‰å·¥ä½œä¸­çš„ fiber å®ä¾‹ï¼Œè¯´æ˜æ˜¯æ¸²æŸ“æ ¹èŠ‚ç‚¹ï¼Œæ­¤æ—¶ä¸èƒ½å¤ç”¨ä¸Šè¾¹çš„æ›´æ–°é€»è¾‘ï¼Œå› ä¸ºèŠ‚ç‚¹éƒ½è¿˜æ²¡æœ‰å‘¢ï¼Œè°ˆä¸ä¸Šæ›´æ–°ï¼Œæ­¤æ—¶éœ€è°ƒç”¨ commitRootã€‚\n\næ‰§è¡Œä»»åŠ¡ä»£ç å¦‚ä¸‹ï¼š\n\n```js\n// performUnitOfWork\nconst { tag } = wip;\n\n// é€šè¿‡ tag åŒºåˆ†æ¸²æŸ“æ¨¡å¼\nswitch (tag) {\n  case HostComponent:\n    updateHostComponent(wip);\n    break;\n\n  case FunctionComponent:\n    updateFunctionComponent(wip);\n    break;\n\n  case ClassComponent:\n    updateClassComponent(wip);\n    break;\n\n  case Fragment:\n    updateFragmentComponent(wip);\n    break;\n\n  case HostText:\n    updateTextComponent(wip);\n    break;\n\n  default:\n    break;\n}\n\n// 2. æ›´æ–°wip å¤šå‰æ ‘æ·±åº¦ä¼˜å…ˆéå†\n// ä¼˜å…ˆæ‰¾å­©å­ï¼Œæ²¡æœ‰å­©å­å°±æ‰¾å…„å¼Ÿï¼Œæ²¡æœ‰å…„å¼Ÿæ‰¾çˆ¶çº§çš„å…„å¼Ÿï¼Œç›´åˆ°æ‰¾åˆ°æ ¹èŠ‚ç‚¹ã€‚æ—¶é—´å¤æ‚åº¦ï¼šO(n)\nif (wip.child) {\n  wip = wip.child;\n  return;\n}\n\nlet next = wip;\n\nwhile (next) {\n  if (next.sibling) {\n    wip = next.sibling;\n    return;\n  }\n  next = next.return;\n}\nwip = null;\n```\n\ncommitRoot ä»£ç å¦‚ä¸‹ï¼š\n\n```js\n// commitRoot\ncommitWorker(wipRoot);\n// é˜²æ­¢è¢« å¤šæ¬¡æ‰§è¡Œ\nwipRoot = null;\n\n// fiber æ ‘åˆ›å»ºçš„è¿‡ç¨‹\nfunction commitWorker(wip) {\n  // ç›´åˆ°æ‰¾ä¸åˆ° wipï¼Œé€€å‡º\n  if (!wip) {\n    return;\n  }\n  // è‡ªå·±\n  const { stateNode, flags } = wip;\n  // çˆ¶domèŠ‚ç‚¹\n  const parentNode = getParentNode(wip.return); //wip.return.stateNode;\n\n  // å…·ä½“ flags çš„è®¾ç½®ï¼Œåœ¨ åè¾¹ diff ç®—æ³•ä¸­å®ç°\n\n  // å³å°†åˆ›å»ºçš„\n  if (flags \u0026 Placement \u0026\u0026 stateNode) {\n    parentNode.appendChild(stateNode);\n  }\n\n  // å³å°†æ›´æ–°çš„\n  if (flags \u0026 Update \u0026\u0026 stateNode) {\n    updateNode(stateNode, wip.alternate.props, wip.props);\n  }\n\n  // å³å°†åˆ é™¤çš„\n  if (wip.deletions) {\n    commitDeletions(wip.deletions, stateNode || parentNode);\n  }\n\n  // 2. ä¸‹ä¸€ä¸ªå­©å­\n  commitWorker(wip.child);\n  // 3. ä¸‹ä¸€ä¸ªå…„å¼Ÿ\n  commitWorker(wip.sibling);\n}\n\nfunction getParentNode(wip) {\n  // è‡ªå®šä¹‰ç»„ä»¶æ²¡æœ‰å®ä½“ï¼Œreturné‡Œå…¨æ˜¯childï¼Œéœ€å¾€ä¸Šæ‰¾çˆ¶ç»„ä»¶\n  let tem = wip;\n  while (tem) {\n    if (tem.stateNode) {\n      return tem.stateNode;\n    }\n    tem = tem.return;\n  }\n}\n\n// prev  {a: 1}\n// next { b: 3}\nexport function updateNode(node, prevVal, nextVal) {\n  Object.keys(nextVal).forEach((k) =\u003e {\n    if (k === 'children') {\n      // æœ‰å¯èƒ½æ˜¯æ–‡æœ¬ï¼Œæˆ‘ä»¬è‡ªå·±è®¾ç½®çš„æ–‡æœ¬èŠ‚ç‚¹ props.children\n      if (isStringOrNumber(nextVal[k])) {\n        node.textContent = nextVal[k] + '';\n      }\n    } else if (k.slice(0, 2) === 'on') {\n      const eventName = k.slice(2).toLocaleLowerCase();\n      node.addEventListener(eventName, nextVal[k]);\n    } else {\n      node[k] = nextVal[k];\n    }\n  });\n}\n\nfunction commitDeletions(deletions, parentNode) {\n  for (let i = 0; i \u003c deletions.length; i++) {\n    parentNode.removeChild(getStateNode(deletions[i]));\n  }\n}\n\nfunction getStateNode(fiber) {\n  let tem = fiber;\n  while (!tem.stateNode) {\n    tem = tem.child;\n  }\n\n  return tem.stateNode;\n}\n```\n\n### â‘¤ æ¸²æŸ“èŠ‚ç‚¹\n\nä¸Šè¾¹çš„ commit æ“ä½œæˆ‘ä»¬çœ‹åˆ°äº†ï¼Œæ˜¯æ ¹æ®èŠ‚ç‚¹çš„ flags å’Œ stateNode å®ä¾‹æ¥æ›´æ–°çš„ã€‚åœ¨æ¸²æŸ“çš„æ—¶å€™ï¼Œéœ€è¦å†™å…¥è¿™ä¸¤ä»½å±æ€§ï¼Œ\n\n1. æ¸²æŸ“åŸç”ŸèŠ‚ç‚¹ï¼š\n\ncreateElement åˆ›å»ºå…ƒç´ ï¼Œprops é€šè¿‡ updateNode æ›´æ–°\n\n```js\nexport function updateHostComponent(wip) {\n  // åˆæ¬¡åŠ è½½ï¼ŒstateNode=null\n  if (!wip.stateNode) {\n    // type : dom.nodeName.toLowerCase()\n    wip.stateNode = document.createElement(wip.type);\n    // æœ€ç»ˆéƒ½ä¼šå½’ç±»åˆ°åŸç”ŸèŠ‚ç‚¹\n    // åˆå§‹åŒ–åœ¨è¿™é‡Œcommitï¼Œä¹‹åçš„æ›´æ–°åœ¨commitWorkeré‡Œcommit\n    updateNode(wip.stateNode, {}, wip.props);\n  }\n\n  // åè°ƒå­èŠ‚ç‚¹\n  reconcileChildren(wip, wip.props.children);\n}\n```\n\n2. æ¸²æŸ“æ–‡æœ¬èŠ‚ç‚¹\n\n```js\nexport function updateTextComponent(wip) {\n  // è¿˜è®°å¾—ä¸Šè¾¹åŸç”ŸèŠ‚ç‚¹æ”¾åœ¨äº† props.children ä¸­\n  wip.stateNode = document.createTextNode(wip.props.children);\n}\n```\n\n3. æ¸²æŸ“ç±»å¼ç»„ä»¶\n\n```js\nexport function updateClassComponent(wip) {\n  const { type, props } = wip;\n\n  // type æ˜¯ç±»çš„æ„é€ å™¨\n  const instance = new type(props);\n  const children = instance.render();\n\n  reconcileChildren(wip, children);\n}\n```\n\n4. æ¸²æŸ“å‡½æ•°å¼ç»„ä»¶\n\n```js\nexport function updateFunctionComponent(wip) {\n  // è¯»å– hook çš„æ“ä½œä¹‹åè®²hookåŸç†æ—¶ä¼šæåˆ°\n  // renderWithHooks(wip);\n  const { type, props } = wip;\n\n  const children = type(props);\n\n  reconcileChildren(wip, children);\n}\n```\n\n5. æ¸²æŸ“ Fragment\n\n```js\nexport function updateFragmentComponent(wip) {\n  reconcileChildren(wip, wip.props.children);\n}\n```\n\næœ€åæ˜¯è°ƒèŠ‚å­èŠ‚ç‚¹å‡½æ•°ï¼Œè¿™ä¹Ÿæ˜¯ diff ç®—æ³•å®ç°çš„åœ°æ–¹ï¼Œè®¾ç½® flag ä¹Ÿåœ¨è¿™é‡Œï¼š\n\n```js\nfunction reconcileChildren(wip, children) {\n  if (isStringOrNumber(children)) {\n    return;\n  }\n\n  // åŸç”Ÿ dom åªæœ‰ä¸€ä¸ª childï¼Œä¼šæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™é‡Œç»Ÿä¸€æ”¾åœ¨æ•°ç»„é‡Œ\n  const newChildren = isArray(children) ? children : [children];\n\n  // è®°å½•ä¸Šä¸€ä¸ªfiber\n  let previousNewFiber = null;\n  let oldFiber = wip.alternate?.child;\n  for (let i = 0; i \u003c newChildren.length; i++) {\n    const newChild = newChildren[i];\n    if (!newChild) {\n      // è§„é¿è¿™æ ·çš„å†™æ³•ï¼š {null}\n      continue;\n    }\n    const newFiber = createFiber(newChild, wip);\n\n    const same = sameNode(newFiber, oldFiber);\n\n    if (same) {\n      // æ ‡è®°ï¼šæ›´æ–°èŠ‚ç‚¹\n      Object.assign(newFiber, {\n        stateNode: oldFiber.stateNode,\n        alternate: oldFiber,\n        flags: Update,\n      });\n    }\n\n    if (!same \u0026\u0026 oldFiber) {\n      // ä¸æ–°çš„ä¸ä¸€æ ·ï¼Œæ ‡è®°ï¼šåˆ é™¤\n      deleteChild(wip, oldFiber);\n    }\n\n    if (oldFiber) {\n      oldFiber = oldFiber.sibling;\n    }\n\n    // createFiber é»˜è®¤çš„ flagså°±æ˜¯æ ‡è¯†ï¼šPlacement æ–°å»º\n    if (i === 0) {\n      // å­èŠ‚ç‚¹ä¸­çš„ç¬¬ä¸€ä¸ªï¼ŒæŠŠé“¾è¡¨æ„å»ºèµ·æ¥\n      wip.child = newFiber;\n    } else {\n      previousNewFiber.sibling = newFiber;\n    }\n\n    previousNewFiber = newFiber;\n  }\n}\n\nfunction deleteChild(returnFiber, childToDelete) {\n  const deletions = returnFiber.deletions;\n\n  if (deletions) {\n    returnFiber.deletions.push(childToDelete);\n  } else {\n    returnFiber.deletions = [childToDelete];\n  }\n}\n\nfunction sameNode(a, b) {\n  return a \u0026\u0026 b \u0026\u0026 a.type === b.type \u0026\u0026 a.key === b.key;\n}\n```\n\n### â‘¥ è°ƒåº¦å™¨ä¹‹äºŒ\n\nè®²è‡ªå®šä¹‰è°ƒåº¦ CPU ç©ºé—²æ—¶é—´ç‰‡ä¹‹å‰ï¼Œå…ˆå›é¡¾ä¸€ä¸‹ä¹‹å‰åŠ å…¥è°ƒåº¦å™¨çš„å‡½æ•°ï¼š\n\n```js\n// rootèŠ‚ç‚¹è°ƒç”¨\nexport function scheduleUpdateOnFiber(fiber) {\n  // work in process\n  wip = fiber;\n  wipRoot = fiber;\n\n  // æ–°å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„è°ƒåº¦\n  scheduleCallback(workLoop);\n}\n```\n\nä¸Šè¾¹ä¸ºäº†ä¸ä½¿ç”¨ js è‡ªå¸¦çš„è°ƒåº¦å™¨ requestIdleCallbackï¼Œreact è¿™é‡Œè‡ªå®šä¹‰äº†è°ƒåº¦çš„å®ç°ã€‚æˆ‘ä»¬æ¥ç®€æ˜“å®ç°ä¸€ä¸‹è¿™ä¸ªè°ƒåº¦å™¨ï¼š\n\n---\n\nï¼ˆè°ƒåº¦å™¨å®ç°å¼€å§‹ï¼‰\n\n```js\n// scheduler.js\n// ç‰µæ‰¯åˆ°æœ€å°å †çš„ç®—æ³•ï¼Œå¯ä»¥å‚è€ƒçŸ¥è¯†åº“ä¸­åŸºç¡€éƒ¨åˆ†ç®—æ³•\nimport { push, pop, peek } from './minHeap';\n\n// ä»»åŠ¡é˜Ÿåˆ—\nlet taskQueue = [];\n// ä»»åŠ¡è®¡æ•°\nlet taskIdCounter = 1;\n\n// ä»»åŠ¡ä¼˜å…ˆçº§ å»¶è¿Ÿæ—¶é—´\nexport function scheduleCallback(callback) {\n  const currentTime = getCurrentTime();\n\n  const timeout = -1; // æºç ä¸­è¿˜ä¼šæœ‰ priorityLevel ä½œä¸ºä¸€ä¸ªæƒé‡ç»´åº¦\n  const expirationTime = currentTime + timeout;\n\n  // æ¯æ¬¡è°ƒåº¦ï¼Œidè‡ªå¢ï¼Œpushè¿›å †\n  const newTask = {\n    id: taskIdCounter++,\n    callback, // å›è°ƒå‡½æ•°\n    expirationTime, // ä»»åŠ¡å¼€å§‹æ—¶é—´\n    sortIndex: expirationTime, // ä»»åŠ¡æ’åºï¼Œå–å†³äºè¿‡æœŸæ—¶é—´ï¼ˆè¿™é‡Œç®€å•çš„ä»»åŠ¡è¿‡æœŸæ—¶é—´è¶Šè¿‘ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼‰\n  };\n  push(taskQueue, newTask);\n\n  // è¯·æ±‚è°ƒåº¦\n  requestHostCallback();\n}\n\n// MessageChannelå…è®¸æˆ‘ä»¬åœ¨ä¸åŒçš„æµè§ˆä¸Šä¸‹æ–‡ï¼Œæ¯”å¦‚window.open()æ‰“å¼€çš„çª—å£æˆ–è€…iframeç­‰ä¹‹é—´å»ºç«‹é€šä¿¡ç®¡é“ï¼Œå¹¶é€šè¿‡ä¸¤ç«¯çš„ç«¯å£ï¼ˆport1å’Œport2ï¼‰å‘é€æ¶ˆæ¯ã€‚MessageChannelä»¥DOM Eventçš„å½¢å¼å‘é€æ¶ˆæ¯ï¼Œæ‰€ä»¥å®ƒå±äºå¼‚æ­¥çš„å®ä»»åŠ¡ã€‚\nconst channel = new MessageChannel();\nconst port = channel.port2;\nchannel.port1.onmessage = function () {\n  handleWorkMessage();\n};\n\nfunction requestHostCallback() {\n  port.postMessage(null);\n}\n\nfunction handleWorkMessage() {\n  // æ¯æ¬¡å–å‡ºå †é¡¶æœ€å°çš„\n  let currentTask = peek(taskQueue);\n  while (currentTask) {\n    // æš‚ä¸è€ƒè™‘æ‰§è¡Œè¿›åº¦ä»¥åŠä¸­æ–­æ‰§è¡Œ\n    const callback = currentTask.callback;\n    currentTask.callback = null;\n    callback();\n    // åˆ é™¤ä»»åŠ¡\n    pop(taskQueue);\n    // æ‹¿å½“å‰ç­‰å¾…æ—¶é—´æœ€å°çš„ä»»åŠ¡\n    currentTask = peek(taskQueue);\n  }\n}\n\nfunction getCurrentTime() {\n  // Date.now()ï¼šè¿”å›çš„æ—¶é—´æˆ³æ²¡æœ‰è¢«é™åˆ¶åœ¨ä¸€æ¯«ç§’çš„ç²¾ç¡®åº¦å†…ï¼Œå°äº 1ms çš„æµ‹è¯•ä¸å‡ºæ¥ç»“æœã€‚\n  // performance.now()ï¼šè¿”å›çš„æ—¶é—´æˆ³ä»¥åŒç²¾åº¦æµ®ç‚¹æ•° double çš„å½¢å¼è¡¨ç¤ºæ—¶é—´ï¼Œç²¾åº¦æœ€é«˜å¯è¾¾å¾®ç§’çº§ã€‚ä¸å—ç³»ç»Ÿå½±å“ã€‚Date.now() çº¦ç­‰äº performance.timing.navigationStart + performance.now()\n  return performance.now();\n}\n```\n\nï¼ˆè°ƒåº¦å™¨å®ç°ç»“æŸï¼‰\n\n---\n\næ­¤æ—¶è°ƒåº¦å™¨å¤–è¾¹çš„ loop å‡½æ•°å°±å¯ä»¥ç²¾ç®€äº†ï¼š\n\n```js\nfunction workLoop() {\n  while (wip) {\n    performUnitOfWork();\n  }\n\n  // ç¡®ä¿è°ƒåº¦å™¨åœ¨è¿è¡Œ\n  // requestIdleCallback(workLoop);\n\n  if (!wip \u0026\u0026 wipRoot) {\n    commitRoot();\n  }\n}\n```\n\n### ã€‡ æ”¹è¿›çš„æµç¨‹å›¾\n\n![å›¾ç‰‡](/img/posts/react/fiber-3.png)\n\n## 4. Hooks\n\nå†™åœ¨å‰è¾¹ï¼šHooks ä¸¥æ ¼æ¥è¯´ä¹Ÿæ˜¯ fiber çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿç‰µæ‰¯åˆ° diff å’Œè°ƒåº¦ï¼Œå•ç‹¬æ‹¿å‡ºæ¥æ˜¯å› ä¸ºä»–ç¡®å®æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¦‚å¿µï¼ŒåŒæ—¶ä¹Ÿé¿å…ä¸Šä¸€ä¸ªç« èŠ‚å¤ªè¿‡è‡ƒè‚¿ã€‚\n\n`Hooks` æœ¬è´¨å°±æ˜¯å¤„ç†å‡½æ•°å¼ç»„ä»¶çš„çŠ¶æ€çš„é›†åˆã€‚çŠ¶æ€ï¼Œæ˜¯ react vdom ä¸­è‡ªå®šä¹‰çš„ä¸€ä¸ªå±æ€§ï¼Œæˆ‘ä»¬åœ¨ fiber åŒ–ä¹‹åä¹Ÿåº”è¯¥æœ‰ï¼Œè¿™é‡ŒåŠ ä¸Šï¼š\n\n```js\nexport function createFiber(vnode, returnFiber) {\n  const fiber = {\n    ...\n    memorizedState: null\n  }\n}\n```\n\nmemorizedState å±æ€§å¯¹äºç±»å¼ç»„ä»¶å­˜æ”¾çš„æ˜¯ state å¯¹è±¡ï¼Œå¯¹äºå‡½æ•°å¼ç»„ä»¶æ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸º hooks æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„ï¼Œæ‰€ä»¥è¿™é‡Œåˆç”¨äº†é“¾å¼å­˜å‚¨ï¼ŒmemorizedState å­˜æ”¾ç¬¬ä¸€ä¸ª hooks æŒ‡é’ˆå³å¯ã€‚\n\nå› ä¸º hooks æ˜¯å‡½æ•°å¼ç»„ä»¶ç‰¹æœ‰çš„ï¼Œæ‰€ä»¥åªä¼šåœ¨æ¸²æŸ“å‡½æ•°å¼ç»„ä»¶æ—¶ä½¿ç”¨ï¼š\n\n```js\nexport function updateFunctionComponent(wip) {\n  // è¿™é‡Œè°ƒç”¨\n  renderWithHooks(wip);\n\n  const { type, props } = wip;\n  const children = type(props);\n  reconcileChildren(wip, children);\n}\n```\n\næˆ‘ä»¬æ–°å»ºä¸€ä¸ª hooks.js æ–‡ä»¶æ¥åŒæ„å¤„ç† hookã€‚\n\nå…ˆå¤„ç† hooks ä¸­çš„å…¨å±€å±æ€§ï¼š\n\n```js\nlet currentlyRenderingFiber = null;\n// è€hook, åœ¨useEffectä¸­ä½¿ç”¨\nlet currentHook = null;\n// å½“å‰å·¥ä½œä¸­çš„hookï¼ŒåŒwipä¸€æ ·ï¼Œhooksä¹Ÿæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œéœ€è¦ä¸€ä¸ªå½“å‰çš„æŒ‡é’ˆä½ç½®æ ‡è¯†\nlet workInProgressHook = null;\n\nexport function renderWithHooks(wip) {\n  currentlyRenderingFiber = wip;\n  currentlyRenderingFiber.memorizedState = null;\n  workInProgressHook = null;\n}\n```\n\nè¿™é‡Œç±»æ¯”å‰é¢çš„ fiber åº”è¯¥å¥½ç†è§£ï¼Œè®²å½“å‰ wip ä¼ å…¥å˜é‡ currentlyRenderingFiberï¼Œå¹¶åˆå§‹åŒ–ã€‚\n\næ¥ç€å†™ä¸€ä¸ªé€šç”¨çš„æ–¹æ³•æ¥æ„é€ å‡½æ•°å¼ç»„ä»¶ä¸­ hooks çš„é“¾è¡¨å…³ç³»ï¼š\n\n```js\nfunction updateWorkInProgressHook() {\n  let hook;\n\n  // æ‹¿åˆ°å½“å‰ fiber åœ¨ diff ä¸­çš„ old fiber\n  const current = currentlyRenderingFiber.alternate;\n\n  if (current) {\n    // 2.æ›´æ–°\n    currentlyRenderingFiber.memorizedState = current.memorizedState;\n\n    if (workInProgressHook) {\n      // å½“å‰ hook æŒ‡é’ˆçš„ä½ç½®\n      workInProgressHook = hook = workInProgressHook.next;\n      currentHook = currentHook.next;\n    } else {\n      // æ²¡æœ‰æŒ‡é’ˆï¼Œå°±ä» hook0 å¼€å§‹\n      workInProgressHook = hook = currentlyRenderingFiber.memorizedState;\n      currentHook = current.memorizedState;\n    }\n  } else {\n    // currentHook åªæœ‰åœ¨ fiber å˜æ›´æ—¶æ‰èµ·ä½œç”¨ï¼Œä¸ç„¶ä¸€ç›´æ˜¯ null\n    currentHook = null;\n\n    // 1.åˆæ¬¡æ¸²æŸ“\n    hook = {\n      memorizedState: null, // state\n      next: null, // ä¸‹ä¸€ä¸ªhook\n    };\n\n    if (workInProgressHook) {\n      // å¦‚æœå·²ç»æœ‰hookï¼Œå°±æ‰¾é“¾è¡¨ä¸‹ä¸€ä¸ªï¼Œç§»åŠ¨æŒ‡é’ˆ\n      workInProgressHook = workInProgressHook.next = hook;\n    } else {\n      // ä¸ç„¶å°±åˆå§‹åŒ–memorizedState\n      workInProgressHook = currentlyRenderingFiber.memorizedState = hook;\n    }\n  }\n\n  return hook;\n}\n```\n\nåˆ°è¿™é‡Œï¼Œä¸€ä¸ªç®€å•çš„ Hooks å°±åˆå§‹åŒ–å®Œæˆå•¦ã€‚æ¥ä¸‹æ¥çœ‹çœ‹å…·ä½“çš„ hooks æ€ä¹ˆç”¨å§ã€‚\n\n### â‘  useReducer\n\nuseReducer æ˜¯ useState çš„æ›¿ä»£å“ï¼Œä½¿ç”¨çš„æ–¹å¼å¦‚ä¸‹ï¼š\n\n```js\n// å£°æ˜\nconst initialState = 1;\nconst reducer = (state: number, action: any | { type: string, value: any }) =\u003e {\n  return state + 1;\n};\n\nconst [count, dispatch] = useReducer(reducer, initialState);\n\n// è°ƒç”¨\ndispatch('add');\n```\n\nåˆ†æä¸€ä¸‹ï¼ŒuseReducer ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå¤„ç†å‡½æ•° reducer å’Œä¸€ä¸ªåˆå§‹å€¼ï¼›åŒäº‹è¿”å›ä¸€ä¸ªå½“å‰çš„æœ€æ–°å€¼å’Œè§¦å‘ reducer çš„å‡½æ•° dispatchï¼Œè¿™ä¸ª dispatch å¯ä»¥æ¥å—ä¸€ä¸ª action å‚æ•°ï¼Œaction å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ä¹Ÿå¯ä»¥æ˜¯ ä¸€ä¸ªå¯¹è±¡ï¼š`{ type, value }`ã€‚\n\næˆ‘ä»¬å®šä¹‰è¿™ä¸ªå‡½æ•°ï¼š\n\n```js\nexport function useReducer(reducer, initalState) {\n  // æ‹¿åˆ°å½“å‰çš„ workInProgressHook\n  const hook = updateWorkInProgressHook();\n  // ç»™åˆå§‹å€¼\n  if (!currentlyRenderingFiber.alternate) {\n    // å¦‚æœæ²¡æœ‰ç»è¿‡ diff æ ‡è®°èµ‹å€¼ alternateï¼Œè¯´æ˜è¿˜æ²¡æœ‰åˆå§‹åŒ–è¿‡ stateã€‚æ²¡æœ‰å¯¹æ¯”å°±ä¸ä¼šå­˜åœ¨ state æ”¹å˜\n    hook.memorizedState = initalState;\n  }\n\n  ...\n}\n```\n\næ¥ä¸‹æ¥å°±æ˜¯å®ç° å°† reducer è½¬å˜ä¸º dispatch äº†ã€‚\n\næˆ‘ä»¬å£°æ˜ä¸€ä¸ªè½¬æ¢å‡½æ•°ï¼š\n\n```js\nfunction dispatchReducerAction(fiber, hook, reducer, action) {\n  // hook.memorizedState = reducer ? reducer(hook.memorizedState) : action;\n  if (reducer) {\n    hook.memorizedState = reducer(hook.memorizedState, action);\n  } else {\n    // useState: setState(1);\n    hook.memorizedState = action;\n  }\n\n  // æ›´æ–° alternateï¼Œ fiberå·²ç»æ”¹å˜\n  fiber.alternate = { ...fiber };\n  // å…„å¼ŸèŠ‚ç‚¹ç½®ç©ºï¼Œæ„æ€æ˜¯åªæ›´æ–°å½“å‰å‡½æ•°èŠ‚ç‚¹å³å¯ã€‚è¿™é‡Œä¸ç”¨æ‹…å¿ƒé“¾è¡¨æ–­æ‰ï¼ŒreconcileChildren ä¸­ä¼šé‡æ–°æ„é€ é“¾è¡¨å…³ç³»ã€‚hook æ›´æ–°åªæ˜¯æ®å±€éƒ¨æ›´æ–°\n  fiber.sibling = null;\n  scheduleUpdateOnFiber(fiber);\n}\n```\n\nç”±äº å‚æ•° fiber, hook, reducer æ˜¯æˆ‘ä»¬å†…éƒ¨å¤„ç†çš„ï¼Œåªæœ‰ action æ˜¯å¤–éƒ¨ä¼ çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ useReducer è¿™é‡Œ bind ä¸€ä¸‹ï¼š\n\n```js\n// useReducer å‡½æ•°\n...\n\n// bind åˆ° null ä¸Šï¼Œæ˜¯ä¸ºäº†è®© currentlyRenderingFiber æ›´æ–°ï¼Œç›´æ¥è°ƒç”¨ dispatchReducerActionï¼Œå…¶æŒ‡é’ˆæŒ‡å‘æ²¡æœ‰å˜åŒ–ï¼Œæœ‰å¤šä¸ªå‡½æ•°å¼ç»„ä»¶æ—¶ï¼Œä¼šäº§ç”Ÿæ¸²æŸ“é”™ä¹±ã€‚\n// currentlyRenderingFiber ä½œä¸ºä¸€ä¸ªå½¢å‚å­˜è¿›æ¥ï¼Œå½¢æˆäº†ä¸€ä¸ªé—­åŒ…ã€‚å¦‚æœæœ‰å¤šä¸ªå‡½æ•°å¼ç»„ä»¶éƒ½æœ‰hooksçš„è¯ï¼Œä»–ä»¬çš„currentlyRenderingFiberæ˜¯å„è‡ªçš„fiberï¼Œä¸ä¼šé€ æˆæŒ‡é’ˆæ··ä¹±ã€‚\nconst dispatch = dispatchReducerAction.bind(\n  null,\n  currentlyRenderingFiber,\n  hook,\n  reducer\n);\n\nreturn [hook.memorizedState, dispatch];\n```\n\n### â‘¡ useState\n\nuseState æ˜¯ useReducer çš„ä¸€ä¸ªç‰¹æ®Šå½¢æ€ï¼Œæ²¡æœ‰ reducerï¼Œæ¯æ¬¡åªè¿”å› action é‡Œçš„å€¼ã€‚\n\n```js\n// reducer ä¸º null\nexport function useState(initialState) {\n  return useReducer(null, initialState);\n}\n```\n\n### â‘¢ useEffect / useLayoutEffect\n\nuseEffect åœ¨é¡µé¢æ¸²æŸ“å®Œæˆåè¿›å…¥è°ƒåº¦é˜Ÿåˆ—æ‰§è¡Œï¼Œæ˜¯å¼‚æ­¥çš„ã€‚useLayoutEffect åˆ™æ˜¯åŒæ­¥æ‰§è¡Œå‰¯ä½œç”¨æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¼šåœ¨æµè§ˆå™¨æ¸²æŸ“ä¹‹å‰è¿è¡Œã€‚\n\nç”±äº useEffect ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªï¼Œæ‰€ä»¥ï¼Œä»ç„¶æ˜¯æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼å­˜å‚¨çš„ï¼Œè¿™é‡Œä¸ºäº†ä¾¿äºå¤§å®¶ç†è§£ï¼Œæš‚æ—¶ç”¨æ•°ç»„ä»£æ›¿ï¼š\n\n```js\nexport function renderWithHooks(wip) {\n  // old\n  currentlyRenderingFiber = wip;\n  currentlyRenderingFiber.memorizedState = null;\n  workInProgressHook = null;\n\n  // ä¸ºäº†æ–¹ä¾¿ï¼ŒuseEffectä¸useLayoutEffectåŒºåˆ†å¼€ï¼Œå¹¶ä¸”ä»¥æ•°ç»„ç®¡ç†\n  // æºç ä¸­æ˜¯æ”¾ä¸€èµ·çš„ï¼Œå¹¶ä¸”æ˜¯ä¸ªé“¾è¡¨\n  currentlyRenderingFiber.updateQueueOfEffect = [];\n  currentlyRenderingFiber.updateQueueOfLayout = [];\n}\n```\n\nç”±äº useEffect å’Œ useLayoutEffect éƒ½æ˜¯åœ¨ç»„ä»¶åŠ è½½çš„æŸä¸ªæ—¶æœºæ‰§è¡Œä¸€æ®µæ–¹æ³•ã€‚æˆ‘ä»¬æŠŠå…¬å…±çš„å®ç°æå–å‡ºæ¥ï¼š\n\n```js\nfunction updateEffectImp(hooksFlags, create, deps) {\n  const hook = updateWorkInProgressHook();\n\n  // åˆå§‹åŒ–æ—¶æ²¡æœ‰ currentHookï¼Œå¿…ç„¶ä¼šèµ°åˆ°ä¸‹è¾¹æ‰§è¡Œå‡½æ•°ï¼Œç»„ä»¶çŠ¶æ€å˜æ›´æ—¶ï¼Œä¼šèµ‹å€¼ currentHookï¼Œç”¨äºæ‹¦æˆªæ˜¯å¦è¦æ›´æ–°\n  if (currentHook) {\n    // ç”¨äºæ ¡éªŒä¸¤æ¬¡ ä¾èµ– æ˜¯å¦æœ‰å˜åŒ–\n    const prevEffect = currentHook.memorizedState;\n    if (deps) {\n      const prevDeps = prevEffect.deps;\n      if (areHookInputsEqual(deps, prevDeps)) {\n        return;\n      }\n    }\n  }\n\n  const effect = { hooksFlags, create, deps };\n\n  hook.memorizedState = effect;\n\n  // useEffect\n  if (hooksFlags \u0026 HookPassive) {\n    currentlyRenderingFiber.updateQueueOfEffect.push(effect);\n    // useLayoutEffect\n  } else if (hooksFlags \u0026 HookLayout) {\n    currentlyRenderingFiber.updateQueueOfLayout.push(effect);\n  }\n}\n\n// ! HookFlags\nexport const HookLayout = /*    */ 0b010;\nexport const HookPassive = /*   */ 0b100;\n\nexport function areHookInputsEqual(nextDeps, prevDeps) {\n  if (prevDeps == null) {\n    return false;\n  }\n\n  // è¿™é‡Œåªæ˜¯ç®€å•çš„æŒ‰ä½ç½®ç´¢å¼•å¯¹æ¯”\n  for (let i = 0; i \u003c prevDeps.length \u0026\u0026 i \u003c nextDeps.length; i++) {\n    if (Object.is(nextDeps[i], prevDeps[i])) {\n      continue;\n    }\n    return false;\n  }\n\n  return true;\n}\n```\n\næœ€å¤–å±‚çš„è°ƒç”¨å¯ä»¥è¿™æ ·å†™ï¼š\n\n```js\nexport function useEffect(create, deps) {\n  return updateEffectImp(HookPassive, create, deps);\n}\n\nexport function useLayoutEffect(create, deps) {\n  return updateEffectImp(HookLayout, create, deps);\n}\n```\n\nç»è¿‡ä¸Šé¢çš„å‡½æ•°åï¼Œç»„ä»¶å†…æ‰€æœ‰çš„ useEffect å°±éƒ½æ”¶é›†åœ¨æ•°ç»„ä¸­äº†ã€‚æ¥ä¸‹æ¥å°±æ˜¯æ‰¾ä¸ªæ—¶æœºè¿›åº¦è°ƒåº¦ã€‚åˆ†æä¸€ä¸‹ï¼Œä¼ é€’çš„å‡½æ•°éœ€è¦åœ¨ç•Œé¢æ¸²æŸ“å‰åè°ƒç”¨ï¼Œæ‰€ä»¥åº”è¯¥åœ¨ diff ä¹‹åï¼Œæˆ‘ä»¬å°±æŠŠå®ƒåŠ åœ¨ commit å‡½æ•°ä¸­ï¼š\n\n```js\nfunction commitWorker(wip) {\n  // ...\n\n  if (wip.tag === FunctionComponent) {\n    invokeHooks(wip);\n  }\n\n  // 2. æäº¤å­èŠ‚ç‚¹\n  commitWorker(wip.child);\n  // 3. æäº¤å…„å¼Ÿ\n  commitWorker(wip.sibling);\n}\n```\n\nåœ¨å½“å‰èŠ‚ç‚¹å˜åŒ–æ›´æ–°å®Œä¹‹åï¼Œè¿˜æ²¡æœ‰æ¸²æŸ“å­èŠ‚ç‚¹ä¹‹å‰ï¼Œæ£€æŸ¥ä¸€ä¸‹æ˜¯å¦æœ‰ useEffect å’Œ useLayoutEffectï¼š\n\n```js\n// ä¹‹å‰å†™çš„è°ƒåº¦å‡½æ•°\nimport { scheduleCallback } from './scheduler';\n\n// æ ¸å¿ƒè°ƒç”¨ä»£ç ç¤ºä¾‹\nfunction invokeHooks(wip) {\n  const { updateQueueOfEffect, updateQueueOfLayout } = wip;\n\n  // åŒæ­¥ï¼Œé˜»å¡äº† commitWorker\n  for (let i = 0; i \u003c updateQueueOfLayout.length; i++) {\n    const effect = updateQueueOfLayout[i];\n    // æœªå¤„ç†å…¶è¿”å›å€¼\n    effect.create();\n  }\n\n  // åŠ å…¥è°ƒåº¦ï¼Œä¸€èˆ¬ä¼šåœ¨æ¸²æŸ“ç»“æŸåæ‰§è¡Œ\n  for (let i = 0; i \u003c updateQueueOfEffect.length; i++) {\n    const effect = updateQueueOfEffect[i];\n\n    scheduleCallback(() =\u003e {\n      effect.create();\n    });\n  }\n}\n```\n\n\u003e æ€è€ƒï¼šè¿˜è®°å¾— Effect çš„å‡½æ•°æœ‰ return ä¹ˆï¼Ÿåœ¨å‰¯ä½œç”¨æ¶ˆå¤±æ—¶è°ƒç”¨ã€‚è¿™é‡Œï¼Œeffect.create() çš„è¿”å›å€¼å°±æ˜¯é‚£ä¸ª return çš„å‡½æ•°ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œä¹Ÿåº”è¯¥åŠ å…¥è°ƒåº¦é˜Ÿåˆ—ï¼Œåªæ˜¯è¦æ§åˆ¶è°ƒç”¨æ—¶æœºï¼Œ**å› ä¸ºå…¶åªåœ¨ç»„ä»¶è¢« delete æ—¶è°ƒç”¨**ã€‚\n\n### ã€‡ æ¸²æŸ“æµç¨‹å›¾\n\n![å›¾ç‰‡](/img/posts/react/react-hooks-useReducer.jpg)\n\n![å›¾ç‰‡](/img/posts/react/react-hooks-useEffect.png)\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠ›å¼€ fiberï¼Œç®€åŒ–ä¸€ä¸‹æºç é€»è¾‘ï¼ŒåŒæ—¶æ¢ä¸€ç§æ€è·¯æ¥çœ‹ hook æœ¬èº«ï¼Œä½¿ç”¨ preact ä¸­çš„å®ç°æ¥è®²è§£ï¼š\n\n### â‘£ useMemo / useCallback\n\næˆ‘ä»¬æŠŠ react å†…ç½®çš„ hook éƒ½ç¼–ä¸Šå·ï¼Œä¾¿äº devtool è§£æï¼Œæ¯”å¦‚ useState æ˜¯ 1ï¼ŒuseCallback æ˜¯ 8ï¼ŒuseMemo æ˜¯ 7 ç­‰ç­‰ã€‚äºæ˜¯æœ‰äº†ä¸‹è¡¨ï¼š\n\n| hook                | ç¼–å·ï¼ˆcurrentHookï¼‰ |\n| ------------------- | ------------------- |\n| useState            | 1                   |\n| useReducer          | 2                   |\n| useEffect           | 3                   |\n| useLayoutEffect     | 4                   |\n| useRef              | 5                   |\n| useImperativeHandle | 6                   |\n| useMemo             | 7                   |\n| useCallback         | 8                   |\n| useContext          | 9                   |\n| useErrorBoundary    | 10                  |\n| useId               | 11                  |\n\næˆ‘ä»¬å¯ä»¥é€šè¿‡ getHookState æ–¹æ³•è·å–åˆ°è¿™ä¸ª hook çš„çŠ¶æ€ï¼š\n\n```js\nfunction getHookState(index, type) {\n  // é€šè¿‡ type è®°å½• state ç±»å‹ï¼Œä¾¿äº devTool è§£æ\n  ...\n  // é€šè¿‡ index è·å–å½“å‰ hook\n  const hooks =\n\t\tcurrentComponent.__hooks ||\n\t\t(currentComponent.__hooks = {\n\t\t\t_list: [],\n\t\t\t_pendingEffects: []\n\t\t});\n\n\tif (index \u003e= hooks._list.length) {\n\t\thooks._list.push({ _pendingValue: EMPTY });\n\t}\n\treturn hooks._list[index];\n}\n```\n\nç»™å½“å‰çš„ vnodeï¼ˆcurrentComponentï¼‰è®¾ç½®`__hooks`å±æ€§ï¼Œæ¯ä¸€ä¸ª hook å‘¢ï¼Œåˆæœ‰è‡ªå·±çš„`_list`æ¥æ”¾ç½® hook ä»¬çš„çŠ¶æ€ï¼Œä»¥ useMemo ä¸ºä¾‹ï¼š\n\n```ts\nexport interface MemoHookState {\n  _value?: any;\n  _pendingValue?: any;\n  _args?: any[];\n  _pendingArgs?: any[];\n  _factory?: () =\u003e any;\n}\n```\n\nåŒæ—¶æ¯ä¸€ä¸ª hook è¿˜æœ‰è‡ªå·±çš„ \\_pendingEffectsï¼š\n\n```ts\nexport interface EffectHookState {\n  _value?: Effect;\n  _args?: any[];\n  _pendingArgs?: any[];\n  _cleanup?: Cleanup | void;\n}\n```\n\nuseMemo:\n\n```js\n// hookæŒ‰ç…§é€’å¢é¡ºåºï¼Œä¼šç»™ä¸€ä¸ªcurrentIndex\n// factoryï¼šç”¨æˆ·ä¼ å…¥çš„ç¼“å­˜å‡½æ•°\n// args: ä¾èµ–æ•°ç»„\nexport function useMemo(factory, args) {\n  /** @type {import('./internal').MemoHookState} */\n  const state = getHookState(currentIndex++, 7);\n  if (argsChanged(state._args, args)) {\n    state._pendingValue = factory();\n    state._pendingArgs = args;\n    state._factory = factory;\n    return state._pendingValue;\n  }\n\n  return state._value;\n}\n\n// æ£€æµ‹ä¾èµ–æ›´æ–°\n// è¿”å›trueçš„æƒ…å†µï¼šæ²¡æœ‰old depsã€ä¾èµ–é•¿åº¦å˜åŒ–ã€æ–°ä¾èµ–ä¸­æœ‰ä¸å’ŒåŸä¾èµ–ä¸€æ ·çš„å¯¹è±¡\nfunction argsChanged(oldArgs, newArgs) {\n  return (\n    !oldArgs ||\n    oldArgs.length !== newArgs.length ||\n    newArgs.some((arg, index) =\u003e arg !== oldArgs[index])\n  );\n}\n```\n\næ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ useCallback:\n\n```js\n// currentHook å°±æ˜¯ç”¨äº devtool è§£æçš„å˜é‡ï¼Œè¿™é‡Œå¿½ç•¥\nexport function useCallback(callback, args) {\n  currentHook = 8;\n  return useMemo(() =\u003e callback, args);\n}\n```\n\n### â‘¤ useDebounce\n\næ¥ä¸‹æ¥æˆ‘ä»¬æ¥å¼•ç”³ä¸€ä¸‹ç¬¬ä¸‰æ–¹ hook åº“`ahooks`ä¸­çš„ä¸€ä¸ªé˜²æŠ– hookã€‚\n\nä½¿ç”¨ï¼š\n\n```jsx\nimport React, { useState } from 'react';\nimport { useDebounce } from 'ahooks';\n\nexport default () =\u003e {\n  const [value, setValue] = useState\u003cstring\u003e();\n  const debouncedValue = useDebounce(value, { wait: 500 });\n\n  return (\n    \u003cdiv\u003e\n      \u003cinput\n        value={value}\n        onChange={(e) =\u003e setValue(e.target.value)}\n        placeholder=\"Typed value\"\n        style={{ width: 280 }}\n      /\u003e\n      \u003cp style={{ marginTop: 16 }}\u003eDebouncedValue: {debouncedValue}\u003c/p\u003e\n    \u003c/div\u003e\n  );\n};\n```\n\nåŸç†ï¼š\n\n```js\n// å¤–å±‚å‡½æ•°å…¥å‚ï¼šfunc, wait, optionsï¼ˆmaxWaitç­‰å‚æ•°ï¼‰\n// å†…å±‚å‡½æ•°\nfunction debounced(...args) {\n  const time = Date.now();\n  const isInvoking = shouldInvoke(time);\n\n  lastArgs = args;\n  lastThis = this;\n  lastInvokeTime = time;\n\n  if (timerId) {\n    cancelTimer();\n  }\n\n  if (isInvoking) {\n    // é‡å¯å®šæ—¶å™¨å‡½æ•° timerExpired\n    timerId = startTimer(timerExpired, wait);\n    return invokeFunc(lastInvokeTime);\n  }\n\n  return result;\n}\n\nfunction invokeFunc(time) {\n  const args = lastArgs;\n  const thisArg = lastThis;\n\n  lastArgs = lastThis = undefined;\n  lastInvokeTime = time;\n  result = func.apply(thisArg, args);\n  return result;\n}\n```\n\nå…¶ä¸­ï¼š\n\n```js\nfunction shouldInvoke(time) {\n  const timeSinceLastInvoke = time - lastInvokeTime; // è·ç¦»ä¸Šä¸€æ¬¡è°ƒç”¨çš„æ—¶é—´å·®\n\n  return (\n    lastInvokeTime === undefined ||\n    timeSinceLastInvoke \u003e= wait ||\n    timeSinceLastInvoke \u003c 0 ||\n    (maxing \u0026\u0026 timeSinceLastInvoke \u003e= maxWait)\n  );\n}\n\n// è¿™äº›éƒ½æ˜¯å†…éƒ¨å¯¹è±¡ï¼Œå…¼å®¹äº†jsä¸åŒè¿è¡Œæ—¶ç¯å¢ƒçš„å…¶é‚£å¥å¯¹è±¡\nconst root =\n  freeGlobalThis || freeGlobal || freeSelf || Function('return this')();\nconst useRAF =\n  !wait \u0026\u0026 wait !== 0 \u0026\u0026 typeof root.requestAnimationFrame === 'function';\n\nfunction startTimer(pendingFunc, wait) {\n  if (useRAF) {\n    root.cancelAnimationFrame(timerId);\n    return root.requestAnimationFrame(pendingFunc);\n  }\n  return setTimeout(pendingFunc, wait);\n}\n```\n\n## 5. Diff ç®—æ³•é«˜çº§\n\nè¿™é‡Œè®²è§£ä¸€ä¸‹é«˜é˜¶ç‰ˆ diff ç®—æ³•ã€‚\n\nä¸Šè¾¹çš„ diff ç®—æ³•ï¼ˆreconcileChildrenï¼‰é—®é¢˜ï¼š\n\n- æŒ‰ä½ç½®å¯¹æ¯”ï¼Œé‡å¤ç»„ä»¶æ²¡åŠæ³•å¤ç”¨ï¼Œæ€§èƒ½è¾ƒä½\n\nå› ä¸ºå¤§å¤šæ•°æƒ…å†µï¼Œé¡µé¢çš„å˜åŒ–éƒ½æ˜¯å¾ˆå°çš„ï¼Œå¤§éƒ¨åˆ† dom æ ‘éƒ½æ˜¯ä¸å˜çš„ï¼Œåªæœ‰ä¸ªåˆ«çš„å˜åŒ–ï¼Œä¹‹å‰çš„ç®—æ³•ä¸­ï¼Œå¦‚æœå¯¹åº”ä½ç½®ä¸ŠèŠ‚ç‚¹ä¸ä¸€æ ·å°±ç›´æ¥åˆ æ‰ï¼Œä¸‹è¾¹æœ‰éœ€è¦è¿™ä¸ªèŠ‚ç‚¹äº†ï¼Œåªå¥½å†åˆ›å»ºï¼Œæˆæœ¬é«˜äº†ä¸å°‘ã€‚\n\nç®—æ³•æ€è·¯ï¼š\n\n- åˆ›å»ºä¸€ä¸ª hash è¡¨å­˜æ”¾ç¼“å­˜èŠ‚ç‚¹\n- éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹åˆ æ‰åå­˜åˆ° hash è¡¨ä¸­\n- æ¯éœ€è¦æ–°å¢ä¸€ä¸ªä½ç½®çš„èŠ‚ç‚¹æ—¶ï¼Œä» hash è¡¨ä¸­è¯»å–\n- ä¸€è½® diff åšå®Œä¹‹åï¼Œæ¸…ç©º hash è¡¨\n\nè€ƒè™‘åˆ° fiber çš„å•é“¾è¡¨ç»“æ„ï¼Œå°±ä¸ä½¿ç”¨ vue çš„åŒæŒ‡é’ˆä»å‰ååŒæ­¥æŸ¥è¯¢ï¼Œè€Œæ˜¯ä»å·¦è¾¹å¾€å³éå†ï¼Œæ¯”è¾ƒæ–°è€èŠ‚ç‚¹ï¼Œå¦‚æœèŠ‚ç‚¹å¯ä»¥å¤ç”¨ï¼Œç»§ç»­å¾€å³ï¼Œå¦åˆ™å°±åœæ­¢ã€‚\n\n### æµç¨‹å›¾\n\næ¸²æŸ“æ ‘ï¼ˆpfiber å°±æ˜¯ returnFiberï¼‰ï¼š\n![å›¾ç‰‡](/img/posts/react/diff-1.png)\n\nç¬¬ä¸€æ­¥ï¼šä»å·¦å¾€å³éå†ï¼ŒæŸ¥æ‰¾ç›´æ¥èƒ½ç”¨çš„ï¼Œç›´åˆ°é‡åˆ°ä¸èƒ½ç”¨çš„ä¸ºæ­¢ï¼ˆä¸‹å›¾ä¸­çš„æ•°å­—ä»£è¡¨è¯¥ fiber çš„ indexï¼‰ï¼š\n\n![å›¾ç‰‡](/img/posts/react/diff-2.png)\n\nèƒ½å¤ç”¨çš„ï¼š\n\n```js\nconst same = sameNode(newChild, oldFiber);\n\nif (same) {\n  const newFiber = createFiber(newChild, returnFiber);\n\n  Object.assign(newFiber, {\n    stateNode: oldFiber.stateNode,\n    alternate: oldFiber,\n    flags: Update,\n  });\n}\n\n// newIndex æŒ‡é’ˆåç§»\n// lastPlacedIndex æŒ‡å‘æœ€åæ”¾ç½®çš„ä½ç½®\n```\n\nåœæ­¢æ¡ä»¶ï¼š`!sameNode(newChild, oldFiber)`\n\nç¬¬äºŒæ­¥ï¼šå¦‚æ–°èŠ‚ç‚¹æ²¡æœ‰äº†ï¼ˆnewIndex === newChildren.lengthï¼‰ï¼š\n\n![å›¾ç‰‡](/img/posts/react/diff-3.png)\n\nè€èŠ‚ç‚¹å¾€åçš„åŠ å…¥åˆ é™¤é˜Ÿåˆ—ï¼š\n\n```js\n// éå†éšåçš„èŠ‚ç‚¹ï¼ŒåŠ å…¥çˆ¶èŠ‚ç‚¹çš„ deletions\nreturnFiber.deletions.push(...)\n```\n\nç¬¬ä¸‰æ­¥ï¼šå¦‚æœè€èŠ‚ç‚¹æ²¡æœ‰äº†ï¼š\n\n![å›¾ç‰‡](/img/posts/react/diff-4.png)\n\næ–°çš„èŠ‚ç‚¹ä¾æ¬¡æ„å»ºé“¾è¡¨ï¼š\n\n```js\n...\nif (previousNewFiber == null) {\n  returnFiber.child = newFiber;\n} else {\n  previousNewFiber.sibling = newFiber;\n}\n```\n\nç¬¬å››æ­¥ï¼šå…¶ä»–æƒ…å†µï¼Œä½¿ç”¨ hash è¡¨ç´¢å¼•\n\n```js\n// ä¸¾ä¾‹1\n// 0 1 [2 3 4 5 6]\n// 0 1 [3 4 5 6 7 2]\n\n// ä¸¾ä¾‹2\n// [0 1 2 3 4 5 6]\n// [2 1 3 4 5]\n\n// æŠŠè€èŠ‚ç‚¹åŠ å…¥Map\nconst existingChildren = mapRemainingChildren(oldFiber); // new Map()\n// éå†æ–°èŠ‚ç‚¹ï¼Œé€šè¿‡æ–°èŠ‚ç‚¹çš„keyå»å“ˆå¸Œè¡¨ä¸­æŸ¥æ‰¾èŠ‚ç‚¹ï¼Œæ‰¾åˆ°å°±å¤ç”¨èŠ‚ç‚¹ï¼Œå¹¶ä¸”åˆ é™¤å“ˆå¸Œè¡¨ä¸­å¯¹åº”çš„èŠ‚ç‚¹\n```\n\n![å›¾ç‰‡](/img/posts/react/diff-5.png)\n\nç¬¬äº”æ­¥ï¼šæ–°èŠ‚ç‚¹éå†å®Œåï¼Œè‹¥ hash è¡¨ä¸­ä»ç„¶æœ‰èŠ‚ç‚¹ï¼Œåˆ™æŠŠè¿™äº›èŠ‚ç‚¹åŠ å…¥ returnFiber.deletions;\n\n### ç¤ºæ„ä»£ç \n\n```js\n// oldfiberçš„å¤´ç»“ç‚¹\nlet oldFiber = returnFiber.alternate?.child;\n// ä¸‹ä¸€ä¸ªoldFiber | æš‚æ—¶ç¼“å­˜ä¸‹ä¸€ä¸ªoldFiber\nlet nextOldFiber = null;\n// ç”¨äºåˆ¤æ–­æ˜¯returnFiberåˆæ¬¡æ¸²æŸ“è¿˜æ˜¯æ›´æ–°\nlet shouldTrackSideEffects = !!returnFiber.alternate;\nlet previousNewFiber = null;\nlet newIndex = 0;\n// ä¸Šä¸€æ¬¡domèŠ‚ç‚¹æ’å…¥çš„æœ€è¿œä½ç½®\n// old 0 1 2 3 4\n// new 2 1 3 4\nlet lastPlacedIndex = 0;\n\n// *1. ä»å·¦è¾¹å¾€å³éå†ï¼Œæ¯”è¾ƒæ–°è€èŠ‚ç‚¹ï¼Œå¦‚æœèŠ‚ç‚¹å¯ä»¥å¤ç”¨ï¼Œç»§ç»­å¾€å³ï¼Œå¦åˆ™å°±åœæ­¢\nfor (; oldFiber \u0026\u0026 newIndex \u003c newChildren.length; newIndex++) {\n  const newChild = newChildren[newIndex];\n  if (newChild == null) {\n    continue;\n  }\n\n  if (oldFiber.index \u003e newIndex) {\n    nextOldFiber = oldFiber;\n    oldFiber = null;\n  } else {\n    nextOldFiber = oldFiber.sibling;\n  }\n\n  const same = sameNode(newChild, oldFiber);\n  if (!same) {\n    if (oldFiber == null) {\n      oldFiber = nextOldFiber;\n    }\n    break;\n  }\n  const newFiber = createFiber(newChild, returnFiber);\n\n  Object.assign(newFiber, {\n    stateNode: oldFiber.stateNode,\n    alternate: oldFiber,\n    flags: Update,\n  });\n\n  // èŠ‚ç‚¹æ›´æ–°\n  lastPlacedIndex = placeChild(\n    newFiber,\n    lastPlacedIndex,\n    newIndex,\n    shouldTrackSideEffects,\n  );\n\n  if (previousNewFiber == null) {\n    returnFiber.child = newFiber;\n  } else {\n    previousNewFiber.sibling = newFiber;\n  }\n\n  previousNewFiber = newFiber;\n  oldFiber = nextOldFiber;\n}\n\n// *2. æ–°èŠ‚ç‚¹æ²¡äº†ï¼Œè€èŠ‚ç‚¹è¿˜æœ‰\n// 0 1 2\n// 0\nif (newIndex === newChildren.length) {\n  deleteRemainingChildren(returnFiber, oldFiber);\n  return;\n}\n\n// *3. åˆæ¬¡æ¸²æŸ“\n// 1ï¼‰åˆæ¬¡æ¸²æŸ“\n// 2ï¼‰è€èŠ‚ç‚¹æ²¡äº†ï¼Œæ–°èŠ‚ç‚¹è¿˜æœ‰\nif (!oldFiber) {\n  for (; newIndex \u003c newChildren.length; newIndex++) {\n    const newChild = newChildren[newIndex];\n    if (newChild == null) {\n      continue;\n    }\n    const newFiber = createFiber(newChild, returnFiber);\n\n    lastPlacedIndex = placeChild(\n      newFiber,\n      lastPlacedIndex,\n      newIndex,\n      shouldTrackSideEffects,\n    );\n\n    if (previousNewFiber === null) {\n      // head node\n      returnFiber.child = newFiber;\n    } else {\n      previousNewFiber.sibling = newFiber;\n    }\n\n    previousNewFiber = newFiber;\n  }\n}\n\n// *4 æ–°è€èŠ‚ç‚¹éƒ½è¿˜æœ‰\n// å°è€Œä¹±\n// old 0 1 [2 3 4]\n// new 0 1 [3 4]\n// !4.1 æŠŠå‰©ä¸‹çš„oldå•é“¾è¡¨æ„å»ºå“ˆå¸Œè¡¨\nconst existingChildren = mapRemainingChildren(oldFiber);\n\n// !4.2 éå†æ–°èŠ‚ç‚¹ï¼Œé€šè¿‡æ–°èŠ‚ç‚¹çš„keyå»å“ˆå¸Œè¡¨ä¸­æŸ¥æ‰¾èŠ‚ç‚¹ï¼Œæ‰¾åˆ°å°±å¤ç”¨èŠ‚ç‚¹ï¼Œå¹¶ä¸”åˆ é™¤å“ˆå¸Œè¡¨ä¸­å¯¹åº”çš„èŠ‚ç‚¹\nfor (; newIndex \u003c newChildren.length; newIndex++) {\n  const newChild = newChildren[newIndex];\n  if (newChild == null) {\n    continue;\n  }\n  const newFiber = createFiber(newChild, returnFiber);\n\n  // oldFiber\n  const matchedFiber = existingChildren.get(newFiber.key || newFiber.index);\n  if (matchedFiber) {\n    // èŠ‚ç‚¹å¤ç”¨\n    Object.assign(newFiber, {\n      stateNode: matchedFiber.stateNode,\n      alternate: matchedFiber,\n      flags: Update,\n    });\n\n    existingChildren.delete(newFiber.key || newFiber.index);\n  }\n\n  lastPlacedIndex = placeChild(\n    newFiber,\n    lastPlacedIndex,\n    newIndex,\n    shouldTrackSideEffects,\n  );\n\n  if (previousNewFiber == null) {\n    returnFiber.child = newFiber;\n  } else {\n    previousNewFiber.sibling = newFiber;\n  }\n  previousNewFiber = newFiber;\n}\n\n// *5 oldçš„å“ˆå¸Œè¡¨ä¸­è¿˜æœ‰å€¼ï¼Œéå†å“ˆå¸Œè¡¨åˆ é™¤æ‰€æœ‰old\nif (shouldTrackSideEffects) {\n  existingChildren.forEach((child) =\u003e deleteChild(returnFiber, child));\n}\n```\n\nå…¶ä¸­å·¥å…·å‡½æ•°ï¼š\n\n```js\n// åˆæ¬¡æ¸²æŸ“ï¼Œåªæ˜¯è®°å½•ä¸‹æ ‡\n// æ›´æ–°ï¼Œæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦ç§»åŠ¨\nfunction placeChild(\n  newFiber,\n  lastPlacedIndex,\n  newIndex,\n  shouldTrackSideEffects,\n) {\n  newFiber.index = newIndex;\n  if (!shouldTrackSideEffects) {\n    // çˆ¶èŠ‚ç‚¹åˆæ¬¡æ¸²æŸ“\n    return lastPlacedIndex;\n  }\n  // çˆ¶èŠ‚ç‚¹æ›´æ–°\n  // å­èŠ‚ç‚¹æ˜¯åˆæ¬¡æ¸²æŸ“è¿˜æ˜¯æ›´æ–°å‘¢\n  const current = newFiber.alternate;\n  if (current) {\n    const oldIndex = current.index;\n    // å­èŠ‚ç‚¹æ˜¯æ›´æ–°\n    // lastPlacedIndex è®°å½•äº†ä¸Šæ¬¡domèŠ‚ç‚¹çš„ç›¸å¯¹æ›´æ–°èŠ‚ç‚¹çš„æœ€è¿œä½ç½®\n    // old 0 1 2 3 4\n    // new 2 1 3 4\n    // 2 1(6) 3 4\n    if (oldIndex \u003c lastPlacedIndex) {\n      // move\n      newFiber.flags |= Placement;\n      return lastPlacedIndex;\n    } else {\n      return oldIndex;\n    }\n  } else {\n    // å­èŠ‚ç‚¹æ˜¯åˆæ¬¡æ¸²æŸ“\n    newFiber.flags |= Placement;\n    return lastPlacedIndex;\n  }\n}\n\n// hashè¡¨\nfunction mapRemainingChildren(currentFirstChild) {\n  const existingChildren = new Map();\n\n  let existingChild = currentFirstChild;\n  while (existingChild) {\n    // key: value\n    // key||index: fiber\n    existingChildren.set(\n      existingChild.key || existingChild.index,\n      existingChild,\n    );\n    existingChild = existingChild.sibling;\n  }\n\n  return existingChildren;\n}\n```\n\nåœ¨ commitWorker é‡ŒåŠ å…¥ï¼š\n\n```js\nif (flags \u0026 Placement \u0026\u0026 stateNode) {\n  // 1\n  // 0 1 2 3 4\n  // 2 1 3 4\n  const before = getHostSibling(wip.sibling);\n  insertOrAppendPlacementNode(stateNode, before, parentNode);\n  // parentNode.appendChild(stateNode);\n}\n\n...\nfunction getHostSibling(sibling) {\n  while (sibling) {\n    if (sibling.stateNode \u0026\u0026 !(sibling.flags \u0026 Placement)) {\n      return sibling.stateNode;\n    }\n    sibling = sibling.sibling;\n  }\n  return null;\n}\nfunction insertOrAppendPlacementNode(stateNode, before, parentNode) {\n  if (before) {\n    parentNode.insertBefore(stateNode, before);\n  } else {\n    parentNode.appendChild(stateNode);\n  }\n}\n```\n\n```jsx\n/**\n * compact: true\n * inline: true\n */\nimport React from 'react';\nimport Giscus from '@giscus/react';\nimport { usePrefersColor } from 'dumi';\n\nexport default function Main() {\n  const [color] = usePrefersColor();\n\n  return (\n    \u003csection style={{ marginTop: '32px' }}\u003e\n      \u003cGiscus\n        id=\"comments\"\n        reactionsEnabled=\"1\"\n        emitMetadata=\"0\"\n        inputPosition=\"bottom\"\n        loading=\"lazy\"\n        src=\"https://giscus.app/client.js\"\n        repo=\"UMCloud-FE\"\n        repoId=\"R_kgDOIYRu5Q\"\n        category=\"Announcements\"\n        categoryId=\"DIC_kwDOIYRu5c4CU1sl\"\n        mapping=\"URL\"\n        strict=\"0\"\n        reactionsEnabled=\"1\"\n        emitMetadata=\"1\"\n        inputPosition=\"bottom\"\n        theme={color === 'dark' ? 'dark_tritanopia' : 'light_tritanopia'}\n        lang=\"zh-CN\"\n        loading=\"lazy\"\n        crossorigin=\"anonymous\"\n        async={true}\n        // theme={giscusTheme}\n      /\u003e\n    \u003c/section\u003e\n  );\n}\n```"])</script><script>self.__next_f.push([1,"12:T163a,"])</script><script>self.__next_f.push([1,"è€ç”Ÿå¸¸è°ˆçš„é—®é¢˜ï¼Œå›¾ç‰‡å¤ªå¤šå¤ªå¤§çš„ç½‘ç«™ï¼Œå¾€å¾€ç”±äºå›¾ç‰‡åŠ è½½è¿‡æ…¢è€Œå¯¼è‡´é¡µé¢ç™½å±æ—¶é—´è¿‡é•¿ã€‚æœ¬æ¬¡å¹´å‰æœ€åä¸€æ›´ï¼Œæ¥è®²ä¸€ä¸ªåŠ è½½æ–¹æ³•æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚\n\n\u003e åœ¨ä½¿ç”¨ Next.js æ—¶ï¼Œå‘ç°å…¶æ”¯æŒæ¨¡ç³Šå›¾ç‰‡å ä½ç¬¦åŠ è½½çš„æ–¹å¼ï¼Œæœ¬æ–‡å°±æ‰‹åŠ¨å®ç°ä¸€ä¸ª\n\n\n![ä¼ä¸šå¾®ä¿¡æˆªå›¾_0cbf1b0b-91ee-49ff-bb58-a0d390bc61a2.png](/img/posts/2024-2-7/2024-2-7-1.png)\n\n*å›¾ç‰‡è§£é‡Šï¼šNextjs ä½¿ç”¨ placeholder=\"blur\" æ¥æŒ‡å®šå½“å‰å›¾ç‰‡ä½¿ç”¨æ¨¡ç³Šå›¾ç‰‡å ä½ç¬¦åŠ è½½*\n\n## 1. å‰ç½®å·¥ä½œ\n\né¦–å…ˆä½ å¾—å‡†å¤‡ä¸€å †å›¾ç‰‡ï¼Œéƒ¨ç½²ä¸€ä¸ªæµ‹è¯•çš„ç½‘é¡µã€‚\n\n```html\n\u003cbody class=\"p-12 m-auto\"\u003e\n  \u003cdiv class=\"container flex justify-center\"\u003e\n    \u003cimg loading=\"lazy\" alt=\"9\" class=\"w-full object-cover rounded-lg\"\n      src=\"http://e.hiphotos.baidu.com/image/pic/item/a1ec08fa513d2697e542494057fbb2fb4316d81e.jpg\" /\u003e\n      ...\n      ä¸‹é¢æ˜¯å¹¶åˆ—çš„ä¸€å † imgï¼Œæ•°é‡ 100+\n  \u003c/div\u003e\n\u003c/body\u003e\n```\n\né¡µé¢é¢„è§ˆï¼š\n\n\n![image.png](/img/posts/2024-2-7/2024-2-7-2.png)\n\nä½†æ˜¯ï¼Œå½“ç½‘é€Ÿæ…¢ä¸€ç‚¹ï¼Œæˆ–è€…å›¾ç‰‡å†é«˜æ¸…ä¸€ç‚¹æ—¶ï¼Œå›¾ç‰‡å°±ä¼šå‡ºç°åŠ è½½ç™½å±ï¼ˆä»ä¸Šå¾€ä¸‹çš„æ‰«æçº¿ï¼‰ã€‚\n\n## 2. è®¾ç½®å»¶è¿ŸåŠ è½½\n\né¦–å…ˆï¼Œæˆ‘ä»¬åˆ©ç”¨ img æ ‡ç­¾çš„èƒ½åŠ›ï¼Œæ·»åŠ æ‡’åŠ è½½å±æ€§ï¼š\n\n```html\n\u003cimg loading=\"lazy\" src=\"image.jpg\" alt=\"...\" /\u003e\n```\n\nå…¼å®¹æ€§ï¼š\n\n![image.png](/img/posts/2024-2-7/2024-2-7-3.png)\n\n\nè¿™ä¸ªç­–ç•¥æœ‰ä¸€ä¸ªåŠ¨æ€çš„åŸåˆ™ï¼š\n\n1. *Lazy loadingåŠ è½½æ•°é‡ä¸å±å¹•é«˜åº¦æœ‰å…³ï¼Œé«˜åº¦è¶Šå°åŠ è½½æ•°é‡è¶Šå°‘ï¼Œä½†å¹¶ä¸æ˜¯çº¿æ€§å…³ç³»ã€‚4G ç½‘ç»œä¸‹çš„è§†å£è·ç¦»é˜ˆå€¼æ˜¯ 1250 åƒç´ ï¼Œ3G ç½‘ç»œä¸‹æ˜¯ 2500 åƒç´ ã€‚*\n2. *Lazy loadingåŠ è½½æ•°é‡ä¸ç½‘é€Ÿæœ‰å…³ï¼Œç½‘é€Ÿè¶Šæ…¢ï¼ŒåŠ è½½æ•°é‡è¶Šå¤šï¼Œä½†å¹¶ä¸æ˜¯çº¿æ€§å…³ç³»*ã€‚\n3. *æ»šåŠ¨ä¼šè§¦å‘å›¾ç‰‡æ‡’åŠ è½½ï¼Œä¸ä¼šè¯´æ»šåŠ¨ä¸€å±åå†å»åŠ è½½ã€‚*\n4. *çª—å£resizeå°ºå¯¸å˜åŒ–ä¹Ÿä¼šè§¦å‘å›¾ç‰‡æ‡’åŠ è½½ã€‚*\n5. *æ ¹æ®æ»šåŠ¨ä½ç½®ä¸åŒï¼ŒLazy loadingä¼šå¿½ç•¥å¤´å°¾çš„å›¾ç‰‡è¯·æ±‚ã€‚*\n\nè¿™ä¸ªç­–ç•¥è·Ÿæµè§ˆå™¨ï¼Œç½‘é€Ÿå’Œè¿è¡Œç¯å¢ƒéƒ½æœ‰å…³ç³»ï¼Œæˆ‘å°±ä»¥æˆ‘æœ¬åœ°ä¸ºå‡†è¿›è¡Œæµ‹è¯•ã€‚ä¸ºäº†æ»¡è¶³æµè§ˆå™¨é˜ˆå€¼ï¼Œæˆ‘ä»¬æ”¾ç½®äº† 100+ çš„ç½‘ç»œå›¾ç‰‡ï¼Œè§ä¸Šé¢é¢„è§ˆå›¾ã€‚åœ¨åˆå§‹åŒ–åŠ è½½æ—¶åªåŠ è½½äº†ä¸€éƒ¨åˆ†ï¼Œç­‰å¾€ä¸‹æ»šåŠ¨ä¸€äº›ï¼Œçœ‹æ•ˆæœï¼š\n\n![1.gif](/img/posts/2024-2-7/2024-2-7-4.gif)\n\n\n\u003e æ³¨æ„å›¾ç‰‡çš„åµŒå¥—å±‚çº§ï¼Œå¦‚æœ html ä¹¦å†™æœ‰è¯¯ï¼Œæˆ–è€…åµŒå¥—å±‚çº§è¿‡å¤šï¼Œæ‡’åŠ è½½å¯èƒ½ä¸ä¼šè¢«è§¦å‘\n\n## 3. é…ç½®æ¨¡ç³Šå›¾ç‰‡\n\næˆ‘ä»¬å‡†å¤‡å¥½ä½åƒç´ çš„æ¨¡ç³Šå›¾ç‰‡ï¼Œå°†æ¯ä¸€ä¸ª img ç”¨ div åŒ…è£¹èµ·æ¥ï¼Œå¹¶ç»™ div åŠ ä¸Šé‚£ä¸ªæ¨¡ç³Šçš„èƒŒæ™¯å›¾ç‰‡ï¼ˆnext.js ä¹Ÿæ˜¯è¿™ä¹ˆåšçš„ï¼‰ï¼š\n \n```html\n\u003cdiv class=\"blur-load\" style=\"background-image: url(æ¨¡ç³Šå›¾ç‰‡)\"\u003e\n  \u003cimg ... loading=\"lazy\" /\u003e\n\u003c/div\u003e\n```\n\nå…¶ä¸­æ¨¡ç³Šå›¾ç‰‡çš„æ ·å¼å¯ä»¥è¿™æ ·å®šä¹‰, ä¿è¯èƒŒæ™¯å›¾ç‰‡ä¸ img èƒ½å¤Ÿé‡åˆï¼š\n\n```css\nimg {\n  width: 100%;\n  aspect-ratio: 1/1;\n  object-fit: cover;\n  object-position: center;\n}\n\n.blur-load {\n  background-size: cover;\n  background-position: center;\n}\n```\n\n\u003e è¿™ä¸ªæ–¹æ³•çš„åŸç†æ˜¯ img å›¾ç‰‡çš„å±‚çº§è¦é«˜äºå…¶æœ¬èº«æˆ–è€…çˆ¶çº§çš„èƒŒæ™¯å›¾ç‰‡ï¼Œå½“å›¾ç‰‡åŠ è½½å‡ºæ¥åè‡ªåŠ¨è¦†ç›–èƒŒæ™¯å›¾ç‰‡\n\nåˆ¶ä½œæ¨¡ç³Šå›¾ç‰‡ï¼Œå¯ä»¥ä½¿ç”¨ [ffmpeg](https://ffmpeg.org/) å·¥å…·ï¼ˆè‡ªè¡Œè¿›å…¥å®˜ç½‘ä¸‹è½½å®‰è£…å³å¯ï¼‰ã€‚\n\n\u003e mac ç”µè„‘ç›´æ¥ä¸‹è½½ Unix å¯æ‰§è¡Œæ–‡ä»¶åˆ°æœ¬åœ°å°±å¯ä»¥ç”¨å®ƒæ‰§è¡ŒæŒ‡ä»¤äº†ï¼›windows ç”µè„‘ç›´æ¥ä¸‹è½½ build çš„ç›®å½•æ–‡ä»¶ï¼Œæ‰¾åˆ° bin ç›®å½•ä¸‹çš„ ffmpeg.exe å°±å¯ä»¥æ‰§è¡Œäº†ã€‚\n\nè¿è¡ŒæŒ‡ä»¤ï¼š\n\n```sh\n# æˆ‘åšäº† 20 å€ç¼©æ”¾ï¼Œä½ å¯ä»¥è‡ªå·±å®šä¹‰ç¼©æ”¾æ¯”ä¾‹\nffmpeg -i 1.jpg -vf scale=20:-1 1-sm.png\n```\n\nè¿™æ ·ä¾¿ç”Ÿæˆäº†ä¸€ä¸ªå¾ˆå°çš„å›¾ç‰‡ï¼š\n\n\n![image.png](/img/posts/2024-2-7/2024-2-7-5.png)\n\nè°ƒæ•´ä»£ç ï¼š\n\n```html\n\u003cdiv class=\"blur-load rounded-lg\" style=\"background-image: url(./1-sm.png)\"\u003e\n\u003cimg loading=\"lazy\" alt=\"9\" class=\"w-full object-cover rounded-lg\"\n  src=\"http://e.hiphotos.baidu.com/image/pic/item/a1ec08fa513d2697e542494057fbb2fb4316d81e.jpg\"\u003e\n\u003c/div\u003e\n```\n\næˆ‘ä»¬å°†ç½‘é€Ÿè°ƒæ…¢çœ‹çœ‹æ•ˆæœï¼š\n\n\n![image.png](/img/posts/2024-2-7/2024-2-7-6.png)\n\nä½†æ˜¯è¿™æ ·è¿˜æœ‰é—®é¢˜ï¼Œå°±æ˜¯å›¾ç‰‡æ˜¯ä»ä¸Šå¾€ä¸‹é€æ¸åŠ è½½çš„ï¼Œéƒ¨åˆ†åŠ è½½ä¹Ÿä¼šæ˜¾ç¤ºçš„é¡µé¢ä¸Šï¼š\n\n\n![1.gif](/img/posts/2024-2-7/2024-2-7-7.gif)\n\næˆ‘ä»¬æƒ³è¦çš„æ•ˆæœæ˜¯å›¾ç‰‡å®Œå…¨åŠ è½½åå†è®©å›¾ç‰‡å‡ºæ¥ï¼Œè¿™è¦å€ŸåŠ© jsï¼š\n\n```js\nfunction loaded(div) {\n  div.classList.add('loaded');\n}\n\nconst blurDivs = document.querySelectorAll('.blur-load');\nblurDivs.forEach(div =\u003e {\n  const img = div.querySelector('img');\n  \n  // åœ¨åŠ è½½å®Œæˆçš„æ—¶å€™æ·»åŠ æ ·å¼\n  if (img.complete) { loaded(div) }\n  else { img.addEventListener('load', () =\u003e loaded(div)) }\n})\n```\n\nè¿™æ ·ï¼Œåœ¨åŠ è½½å®Œæˆåæ‰ä¼šæœ‰ 'loaded' æ ·å¼åŠ è½½åœ¨å¤–å›´çš„ div ä¸Šã€‚æˆ‘ä»¬åªéœ€è¦ç»™ div æ·»åŠ æ ·å¼ï¼š\n\n```css\n.blur-load.loaded \u003e img {\n opacity: 1;\n}\n\n/* åŠ è½½å®Œæˆä¹‹å‰ä¿æŒé€æ˜ */\n.blur-load \u003e img {\n  opacity: 0;\n  transition: opacity 200ms ease-in-out;\n}\n```\n\nè¿™æ ·åœ¨åŠ è½½å®Œæˆåæ‰ä¼šæœ‰æ¨¡ç³Šå›¾ç‰‡è¿‡æ¸¡æ˜¾ç¤ºä¸ºåŸå›¾çš„æ•ˆæœäº†ï¼š\n\n\n![1.gif](/img/posts/2024-2-7/2024-2-7-8.gif)\n\n## 4. è‡ªå®šä¹‰ loading åŠ¨ç”»\n\nå¦‚æœä½ è‡ªå·±è§‰å¾—è¿˜ä¸æ»¡æ„ï¼Œæƒ³è¦è‡ªå·±åŠ å…¥æƒ³è¦çš„åŠ¨ç”»æ•ˆæœï¼Œé‚£ä¹ˆä½ å¯ä»¥å­åœ¨è¿™ä¸ªdivä¸Šè‡ªå·±å®šä¹‰æ ·å¼ã€‚ä¸‹é¢ç»™å‡ºä¸€ç§è„‰å†²æ•ˆæœçš„å‚è€ƒæ ·ä¾‹ï¼š\n\n```css\n.blur-load {\n  position: relative;\n}\n.blur-load::before {\n  content: \"\";\n  position: absolute;\n  inset: 0;\n  animation: pulse 2s infinite;\n}\n\n@keyframes pulse {\n  0% {\n    background-color: rgba(255, 255, 255, 0);\n  }\n  \n  50% {\n    background-color: rgba(255, 255, 255, 0.4);\n  }\n  \n  100% {\n    background-color: rgba(255, 255, 255, 0);\n  }\n}\n\n/* åŠ è½½å®Œæˆåå–æ¶ˆ */\n.blur-load.loaded::before {\n  content: none;\n}\n```\næ•ˆæœå›¾å¦‚ä¸‹ï¼š\n\n\n![1.gif](/img/posts/2024-2-7/2024-2-7-9.gif)"])</script><script>self.__next_f.push([1,"13:T812,"])</script><script>self.__next_f.push([1,"## ä½¿ç”¨ CSS æ¡†æ¶\n\nå¦‚æœä½ ä¸æƒ³è‡ªå·±é…ç½®è¿™äº›ä¹±ä¸ƒå…«ç³Ÿçš„é…ç½®ï¼Œåˆè‹¦äºä¸ä¼šè®¾è®¡ä¸»é¢˜é¢œè‰²ï¼Œé‚£ä¹ˆ [Tailwindcss](https://tailwindcss.com/docs/dark-mode) å°±å¯ä»¥å¸®ä½ å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚\n\n\u003e ä½¿ç”¨ css æ¡†æ¶ï¼ŒåŸåˆ™ä¸Šä¸ç®—æ˜¯ä¸€ä¸ªæ–°æŠ€æœ¯åˆ†ç±»ï¼Œä»–è¿˜æ˜¯ä¸Šé¢æ‰€è®²çš„æ–¹æ¡ˆä¸­çš„ä¸€ç§æˆ–å‡ ç§ï¼Œæ˜¯å¯¹è¿™äº›æ–¹æ¡ˆçš„ä¼ä¸šçº§å°è£…\n\næˆ‘ä»¬å€Ÿç”¨å®˜æ–¹çš„å¤œé—´ä¸»é¢˜çš„ä¾‹å­ï¼š\n\n```js\n\u003cdiv class=\"bg-white dark:bg-slate-800 rounded-lg px-6 py-8 ring-1 ring-slate-900/5 shadow-xl\"\u003e\n  \u003cdiv\u003e\n    \u003cspan class=\"inline-flex items-center justify-center p-2 bg-indigo-500 rounded-md shadow-lg\"\u003e\n      \u003csvg class=\"h-6 w-6 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" aria-hidden=\"true\"\u003e\u003c!-- ... --\u003e\u003c/svg\u003e\n    \u003c/span\u003e\n  \u003c/div\u003e\n  \u003ch3 class=\"text-slate-900 dark:text-white mt-5 text-base font-medium tracking-tight\"\u003eWrites Upside-Down\u003c/h3\u003e\n  \u003cp class=\"text-slate-500 dark:text-slate-400 mt-2 text-sm\"\u003e\n    The Zero Gravity Pen can be used to write in any orientation, including upside-down. It even works in outer space.\n  \u003c/p\u003e\n\u003c/div\u003e\n```\n\nä½¿ç”¨ `dark:` æ¥å£°æ˜åœ¨ä¸»é¢˜ä¸ºå¤œé—´æ—¶çš„æ ·å¼ï¼Œå¯ä»¥é…ç½®ä¸ºè‡ªåŠ¨è¯†åˆ«ç³»ç»Ÿæ ·å¼æˆ–è€…æ˜¯å¯æ§çš„åˆ‡æ¢æ¨¡å¼ï¼Œåˆ‡æ¢ä¸ºå¤œé—´æ¨¡å¼åï¼Œä¼šåœ¨ html æ ¹å…ƒç´ ä¸Šæ·»åŠ ç±» `dark`ï¼š\n\n\n![image.png](/img/posts/2024-1-25/2024-1-25-9.png)\n\nè¿™æ ·ï¼ŒTailwind å°±èƒ½è¯†åˆ«å¹¶ä¿®æ”¹æ¸²æŸ“æ ·å¼äº†ï¼š\n\n![image.png](/img/posts/2024-1-25/2024-1-25-10.png)\n\n\u003e è¿™ç§åˆ‡æ¢æ–¹å¼ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯ç±»ååˆ‡æ¢æ¨¡å¼ï¼Œåªæ˜¯ä½¿ç”¨æ¡†æ¶æ›´åŠ æ–¹ä¾¿å¿«æ·ï¼Œæ”¯æŒçš„ç”Ÿæ€ä¹Ÿæ›´å¥½\n\n\u003e è¯¦ç»†çš„ Tailwindcss çš„ä½¿ç”¨ï¼Œå¯ä»¥è§ [å°è‚šå¸¦æ‚¨ Tailwind CSS å¿«é€Ÿå…¥é—¨](https://juejin.cn/post/7301910992312549376)\n\nä¼˜åŠ¿ï¼š\n\n- å¤§åŠ¿æ‰€è¶‹ï¼Œå‰æ™¯å¹¿é˜”\n- æ˜“äºç®¡ç†å’Œç»´æŠ¤ï¼Œä½¿å¾—å®šåˆ¶ä¸»é¢˜å˜å¾—éšå¿ƒæ‰€æ¬²\n- ä»£ç å†—ä½™å°\n- æ›´å¥½çš„æ€§èƒ½ä¸å¯æ‰©å±•æ€§\n\nä¸è¶³ï¼š\n\n- æ¡†æ¶æœ¬èº«å¯èƒ½ä¼šä¸å·²æœ‰é¡¹ç›®æ¶æ„å†²çª\n- æ¡†æ¶çº¦æŸäº†å¯å®šåˆ¶çš„çµæ´»æ€§\n- å­¦ä¹ æˆæœ¬è¾ƒé«˜\n- éœ€è¦æœ‰é¢å¤–çš„ç»´æŠ¤ç‰ˆæœ¬å‡çº§å·¥ä½œ"])</script><script>self.__next_f.push([1,"14:T5d7,## CSS-IN-JS\n\nä½¿ç”¨è¿‡ React çš„æœ‹å‹åº”è¯¥å¬è¯´è¿‡ emotionï¼Œä»–çš„è®¾è®¡ç†å¿µæ˜¯ `All styles in Js`ï¼Œæˆ‘ä¹‹å‰è®²è¿‡çš„ UIç»„ä»¶åº“ å°±ç”¨çš„æ˜¯è¿™ä¸ªï¼š[æ‰‹æŠŠæ‰‹æ­å»ºåŸºäºReactçš„å‰ç«¯UIåº“ ï¼ˆäºŒï¼‰-- ä¸»é¢˜é…ç½®](https://juejin.cn/post/7076652936331280421).\n\nä»–ä¸ Antd çš„å®ç°ç†å¿µä¸€è‡´ï¼Œä¹Ÿæ˜¯ç»´æŠ¤ä¸€ä¸ª `ThemeProvider` æ¥å®Œæˆå¯é…ç½®çš„ä¸»é¢˜è®¾ç½®ï¼š\n\n```js\nimport { ThemeProvider as EThemeProvider } from 'emotion-theming';\n\nrender() {\n    const { theme: _theme, ...rest } = this.props;\n    const { theme } = this.state;\n    return \u003cEThemeProvider theme={theme} {...rest} /\u003e;\n}\n```\n\n\u003e Antd æ˜¯åˆ‡æ¢åä½¿ç”¨ä¸åŒçš„ css æ–‡ä»¶ï¼Œemotion æ˜¯åˆ‡æ¢åä½¿ç”¨ä¸åŒçš„æ ·å¼ jsï¼Œæœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«\n\nä¸Šé¢çš„ theme ä¸»é¢˜å¯ä»¥ä½¿ç”¨ä¸€ä¸ª `designTokens.ts` é…ç½®å„ç§å°ºå¯¸ï¼Œé¢œè‰²ç­‰ï¼š\n\n\n![image.png](/img/posts/2024-1-25/2024-1-25-8.png)\n\nç„¶åå°†æ–‡ä»¶å¯¼å‡ºåï¼Œå…¨å±€æ¥è®¿é—®ï¼š\n\n```js\nmport { useTheme } from 'emotion-theming';\n\nimport { defaultTheme } from '../../style';\n\nconst useDesignTokens = () =\u003e {\n  // æ‹¿åˆ°Themeproviderçš„theme\n  const theme = useTheme();\n  if (!Object.keys(theme).length) return defaultTheme.designTokens;\n  return theme.designTokens;\n};\n\nexport default useDesignTokens;\n```\n\nä¼˜ç‚¹ï¼š\n\n- ä¸ä¼šå­˜åœ¨ css åŠ è½½éƒ¨ç½²çš„é—®é¢˜ï¼Œé€‚åˆå¾®å‰ç«¯è¿™ç§éœ€è¦éš”ç¦»æ ·å¼çš„åœºæ™¯\n- ...\\[Antd æ–¹æ¡ˆä¼˜ç‚¹]\n\nç¼ºç‚¹ï¼š\n\n- å­¦ä¹ æ›²çº¿æ¯”è¾ƒé«˜\n- å¢åŠ äº†è¿è¡Œæ—¶çš„å¼€é”€å’Œæ‰“åŒ…ä½“ç§¯\n- æºç å¯è¯»æ€§å¯èƒ½ä¼šå˜å·®15:T573d,"])</script><script>self.__next_f.push([1,"éšç€ Nextjs 13+ çš„æ¨å‡ºï¼Œå®˜æ–¹æ¨å‡ºäº†ä¸€ç§å¾ˆæ–°çš„è·¯ç”±æ¨¡å¼ï¼Œå« [App Router](https://nextjs.org/docs/app) çš„ï¼Œä»Šå¤©æ¥çœ‹çœ‹è¿™ç©æ„æ€ä¹ˆä½¿ç”¨å§ã€‚\n\nä»–ä¸åŒäºä¹‹å‰çš„ pages è·¯ç”±æœºåˆ¶ï¼Œè€Œæ˜¯ä»¥ app æ–‡ä»¶å¤¹ä¸ºæ ¹ç›®å½•ï¼Œä»¥ page.tsxï¼ˆjsxï¼‰ ä¸ºå…¥å£ï¼Œä»¥ layout.tsx (jsx) ä¸ºå¸ƒå±€ç»„ä»¶ï¼Œå‚æ•°è·å–ä¸ä¸€æ ·äº†ï¼ŒåŒæ—¶ä¹Ÿå¼•å…¥äº†ä¸å°‘æ–°çš„APIã€‚\n\nP.S. æ–°ä¸œè¥¿å±‚å‡ºä¸ç©·ï¼ŒçœŸçš„å­¦ä¸åŠ¨äº†å•Š...\n\n![ä¸æ•¢å­å£°.jpeg](/img/posts/2024-1-19/2024-1-19-1.png)\n\n\u003e Node \u003e= v18.17\n\n\u003e ä»¥åå®˜æ–¹çš„æ›´æ–°æ–¹å‘å…¨åœ¨ next å’Œ turbopack äº†ï¼Œæ‰€ä»¥ä¼ ç»Ÿçš„ create-react-app å’Œ react-router æ¸æ¸è¢«æŠ›å¼ƒï¼Œå¦‚æœå°†æ¥ react-router å®˜æ–¹ä¹Ÿä¸æ›´æ–°äº†ï¼Œä¸çŸ¥é“ vite å°†æ¥è¦æ€ä¹ˆæ”¯æŒ react çš„åˆ›å»ºï¼Ÿ\n\n----\n\n## 0. åˆ›å»ºé¡¹ç›®\n\næ‰§è¡ŒæŒ‡ä»¤ï¼š\n\n```shell\nnpx create-next-app nextjs-app-router-test\n```\n\næœ€æ–°çš„ CLI ä¼šæœ‰å¾ˆå¤šæç¤ºé€‰é¡¹ï¼Œæˆ‘ä»¬æ˜¯ App router çš„è®²è§£ï¼Œå…¶ä»–æ— å…³çš„é€‰é¡¹å…³æ‰å³å¯ï¼š\n\n```\nâœ” Would you like to use TypeScript? â€¦ [No] / Yes  // ä¼ ç»Ÿ js\nâœ” Would you like to use ESLint? â€¦ [No] / Yes\nâœ” Would you like to use Tailwind CSS? â€¦ [No] / Yes  // ä¸ä½¿ç”¨ css æ¡†æ¶ï¼Œå°±ä¼šç”Ÿæˆ css module æ–‡ä»¶ï¼Œæ¯”å¦‚ page.module.css\nâœ” Would you like to use `src/` directory? â€¦ [No] / Yes // æ‰å¹³åŒ–ç®¡ç†\nâœ” Would you like to use App Router? (recommended) â€¦ No / [Yes] // å¼€å¯ App Router\nâœ” Would you like to customize the default import alias (@/*)? â€¦ No / [Yes]\nâœ” What import alias would you like configured? â€¦ [@]/*\n```\n\nç”Ÿæˆåï¼Œå·¥ç¨‹ç›®å½•ä¸»è¦æ–‡ä»¶å¦‚ä¸‹ï¼š\n\n```shell\n./app\nâ”œâ”€â”€ favicon.ico\nâ”œâ”€â”€ globals.css\nâ”œâ”€â”€ layout.js\nâ”œâ”€â”€ page.js\nâ””â”€â”€ page.module.css\n./public\nâ”œâ”€â”€ next.svg\nâ””â”€â”€ vercel.svg\nnext.config.js \npackage.json\n```\n\næˆ‘ä»¬å®‰è£…ä¾èµ–åå¯åŠ¨é¡¹ç›®ï¼š\n\n![image.png](/img/posts/2024-1-19/2024-1-19-2.png)\n\n## 1. è·¯ç”±\n\n### è·¯ç”±ç»“æ„\n\næˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ page.js:\n\n```js\nimport styles from './page.module.css'\n\nexport default function Home() {\n  return (\n    \u003cmain className={styles.main}\u003e\n      Home\n    \u003c/main\u003e\n  )\n}\n```\n\n![image.png](/img/posts/2024-1-19/2024-1-19-3.png)\n\nè€Œ layout.js ç»„ä»¶ï¼š\n\n```js\nexport default function RootLayout({ children }) {\n  return (\n    \u003chtml lang=\"en\"\u003e\n      \u003cbody className={inter.className}\u003e{children}\u003c/body\u003e\n    \u003c/html\u003e\n  )\n}\n```\n\nå¯ä»¥çœ‹åˆ°ä»–æ˜¯é¡¹ç›®çš„ä¸»ä½“ç»“æ„ï¼Œä»–ä¼ å…¥çš„ children æ˜¯ page.js ä¸­çš„å†…å®¹ã€‚\n\nä»¥ä¸Šä¾¿æ˜¯ App Router çš„ä¸»ä½“ç»“æ„äº† ï¼ˆapp ç›®å½• + page.js + layout.jsï¼‰ã€‚å¯ä»¥å¯¹æ¯” pages è·¯ç”±ï¼ˆpages ç›®å½• + _app.js + _document.jsï¼‰.\n\næ­¤å¤–è¿˜æœ‰ä¸€ä¸ª public ç›®å½•ï¼Œå®ƒé‡Œè¾¹çš„æ–‡ä»¶æ˜¯å¯ä»¥è¢«ä½¿ç”¨ `/` ç›´æ¥å¼•ç”¨çš„ã€‚\n\napp æ–‡ä»¶å¤¹ä¸­å¯ä»¥åˆ›å»ºå­æ–‡ä»¶å¤¹ç”¨äºåŒºåˆ†å­è·¯ç”±ï¼Œåœ¨appé¡¶å±‚çš„æ–‡ä»¶å°±è¡¨ç¤ºè·Ÿè·¯ç”±æ–‡ä»¶ã€‚æ¯ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹å•å…ƒå¯ä»¥åŒ…å«çš„æ–‡ä»¶å¦‚ä¸‹ï¼š\n\n\n|       æ–‡ä»¶å        |          å¯é€‰çš„åç¼€           |           åŠŸèƒ½                   |\n| ------------------- | ------------------- | ---------------------------- |\n| [`layout`](https://nextjs.org/docs/app/api-reference/file-conventions/layout)                     | `.js` `.jsx` `.tsx` | å¸ƒå±€çš„é¡¶å±‚ç»„ä»¶                       |\n| [`page`](https://nextjs.org/docs/app/api-reference/file-conventions/page)                         | `.js` `.jsx` `.tsx` | é¡µé¢ä¸»ä½“                         |\n| [`loading`](https://nextjs.org/docs/app/api-reference/file-conventions/loading)                   | `.js` `.jsx` `.tsx` | é¡µé¢åŠ è½½æ—¶çš„ loading                   |\n| [`not-found`](https://nextjs.org/docs/app/api-reference/file-conventions/not-found)               | `.js` `.jsx` `.tsx` | é¡µé¢ 404 æ—¶æ˜¾ç¤ºï¼Œä»…åœ¨é¡¶å±‚ç”Ÿæ•ˆ            |\n| [`error`](https://nextjs.org/docs/app/api-reference/file-conventions/error)                       | `.js` `.jsx` `.tsx` | é¡µé¢é”™è¯¯æ—¶æ˜¾ç¤ºï¼Œä»…åœ¨é¡¶å±‚ç”Ÿæ•ˆ              |\n| [`global-error`](https://nextjs.org/docs/app/api-reference/file-conventions/error#global-errorjs) | `.js` `.jsx` `.tsx` | å…¨å±€é”™è¯¯æ—¶æ˜¾ç¤ºï¼Œä»…åœ¨é¡¶å±‚ç”Ÿæ•ˆ             |\n| [`route`](https://nextjs.org/docs/app/api-reference/file-conventions/route)                       | `.js` `.ts`         | API è¯·æ±‚å®šåˆ¶æ–‡ä»¶                 |\n| [`template`](https://nextjs.org/docs/app/api-reference/file-conventions/template)                 | `.js` `.jsx` `.tsx` | é‡æ¸²æŸ“æ—¶å®šåˆ¶ layout           |\n| [`default`](https://nextjs.org/docs/app/api-reference/file-conventions/default)                   | `.js` `.jsx` `.tsx` | å¹³è¡Œè·¯ç”±å›è½é¡µé¢ï¼ˆå®˜æ–¹æ–‡æ¡£è¿˜åœ¨è¡¥å……ä¸­ã€‚ã€‚ã€‚ï¼‰|\n\n\u003e å¦‚æœæŸä¸€çº§ç›®å½•ä¸‹æ²¡æœ‰ layout å’Œ pageï¼Œåˆ™ä¸ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ­£ç¡®çš„è·¯ç”±ç»“æ„\n\nä» app æ–‡ä»¶å¤¹å¼€å§‹å¾€ä¸‹ï¼Œéµä»ç›®å½•è·¯ç”±ç»“æ„ï¼š\n\n\n![image.png](/img/posts/2024-1-19/2024-1-19-4.png)\n\næ¯”å¦‚æˆ‘åœ¨ app ä¸‹æ–°å»º dashboard ç›®å½•ï¼Œåœ¨ä¸‹è¾¹å†™ä¸Šè‡ªå·±çš„ layout.js å’Œ page.js æ–‡ä»¶ä»¬å°±å¯ä»¥è¿™æ ·è®¿é—®ï¼š`http://localhost:3000/dashboard` ï¼ˆ`\u003cLink href=\"/dashboard\"\u003eDashboard\u003c/Link\u003e`ï¼‰ã€‚æ­¤æ—¶ç›®å½•ç»“æ„å¯èƒ½æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š\n\n\n![image.png](/img/posts/2024-1-19/2024-1-19-5.png)\n\næˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ template.js æ¥ä½œä¸ºä¸­é—´å±‚ï¼Œå®ƒä»‹äº layout.js å’Œå…¶å­©å­ç»„ä»¶ä¹‹é—´ï¼š\n\n```js\n// dashboard/template.js\nimport React from 'react'\n\nexport default function template({ children }) {\n  return (\n    \u003cdiv\u003e\n      æ¥æ”¶æ¥è‡ª page.js çš„æ•°æ®ï¼š\n      {children}\n    \u003c/div\u003e\n  )\n}\n```\n\nç„¶åé¡µé¢æ˜¾ç¤ºï¼š\n\n![image.png](/img/posts/2024-1-19/2024-1-19-6.png)\n\ntemplate å¯ç”¨äºé¡µé¢å¸ƒå±€ï¼Œæ‹†åˆ†é¡µé¢åŠŸèƒ½ç­‰ã€‚\n\n### è·¯ç”±ç»„\n\næœ‰æ—¶å€™æˆ‘ä»¬æƒ³ç”¨ä¸€ä¸ªå¤§çš„æ–‡ä»¶å¤¹ç®¡ç†åˆ†ç»„æ–‡ä»¶ï¼Œä½†æ˜¯åˆä¸æƒ³ nextsjs å°†å…¶è¯†åˆ«ä¸ºè·¯ç”±ï¼Œé‚£ä¹ˆå¯ä»¥å°†æ–‡ä»¶å¤¹ç”¨å°æ‹¬å·åŒ…è£¹ï¼š\n\n\n![image.png](/img/posts/2024-1-19/2024-1-19-7.png)\n\næ­¤æ—¶å°±å¯ä»¥è¿™æ ·è®¿é—®äº†ï¼š`http://localhost:3000/about`ã€‚\n\n\u003e éœ€æ³¨æ„ï¼Œæœ‰å¤šä¸ªè·¯ç”±ç»„æ—¶ï¼Œå†…éƒ¨çš„äºŒçº§ç›®å½•ï¼Œæ¯”å¦‚ about ä¸èƒ½é‡åï¼Œä¸ç„¶ä¼šè¯†åˆ«é”™è¯¯ã€‚\n\nå½“ç„¶äº†ï¼Œå„ä¸ªè·¯ç”±ç»„é¡¶å±‚ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„ layout.js ï¼Œæˆ–è€…å„ä¸ªäºŒçº§è·¯ç”±ï¼ˆæ¯”å¦‚ about æ–‡ä»¶å¤¹ï¼‰ä¸‹åˆ†åˆ«æ”¾ç½®è‡ªå·±çš„ layout.js ä¹Ÿå¯ä»¥ã€‚\n\n### åŠ¨æ€è·¯ç”±\n\n\u003e ä»…åœ¨æœåŠ¡ç«¯ç»„ä»¶ä½¿ç”¨\n\nå¯ä»¥å°†æ–‡ä»¶å¤¹åç§°ç”¨ä¸­æ‹¬å·æ‹¬èµ·æ¥è¡¨ç¤ºåŠ¨æ€è·¯ç”±ï¼š\n\n```shell\n./app/posts\nâ””â”€â”€ [id]\n    â””â”€â”€ page.js\n```\n\nå…¶ä¸­ page.js:\n\n```js\nexport default function Post({ params }) {\n  return (\n    \u003cdiv\u003ePost: {params.id}\u003c/div\u003e\n  )\n}\n```\n\næ­¤æ—¶å¯é€šè¿‡è·¯ç”± `http://localhost:3000/posts/1` æ¥è®¿é—®:\n\n\n![image.png](/img/posts/2024-1-19/2024-1-19-8.png)\n\nå½“ç„¶äº†ï¼Œå‚æ•°ä¸æ˜¯åªèƒ½ä¼ é€’ä¸€çº§å‚æ•°ï¼Œæˆ‘ä»¬å¦‚æœè¿™æ ·å®šä¹‰æ–‡ä»¶å¤¹ï¼š`[...ids]`ï¼š\n\n```shell\n./app/posts\nâ””â”€â”€ [...ids]\n    â””â”€â”€ page.js\n```\n\næ­¤æ—¶è®¿é—®ï¼š`http://localhost:3000/posts/12/56`ï¼Œæ­¤æ—¶åœ¨æœåŠ¡ç«¯å¯æ‰“å°æ‹¿åˆ°çš„å‚æ•°ï¼š\n\n```js\n{ params: { ids: [ '12', '56' ] }, searchParams: {} }\n```\n\nä¸Šé¢çš„å†™æ³•è¿˜æœ‰ä¸€ç§å˜ä½“ï¼š`[[...ids]]`ï¼Œä½¿ç”¨åŒæ‹¬å·å’Œå•æ‹¬å·çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¯†åˆ«çš„åŸºæœ¬æ²¡æœ‰å·®åˆ«ï¼Œå”¯ä¸€çš„ä¸åŒæ˜¯ï¼Œä½¿ç”¨åŒæ‹¬å·å¯ä»¥è¯†åˆ«ä¸å¸¦å‚æ•°çš„è·¯å¾„ï¼š`http://localhost:3000/posts`ï¼Œè€Œå•æ‹¬å·çš„é…ç½®å°± 404 äº†ã€‚\n\n### å¹³è¡Œè·¯ç”±\n\nå¹³è¡Œè·¯ç”±çš„æ–‡ä»¶å¤¹ä»¥ `@` å¼€å¤´ï¼Œå…¶é»˜è®¤ä¹Ÿä¸ä¼šç”Ÿæˆåœ¨è·¯ç”±ä¸­ï¼Œä¸èƒ½ç›´æ¥è®¿é—®ã€‚\n\n\næ¯”å¦‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼š`@dashboard` å’Œ `@login` ï¼Œä¸€ä¸ªè¡¨ç¤ºç™»å½•åçš„æ¬¢è¿ç•Œé¢ï¼Œä¸€ä¸ªè¡¨ç¤ºæ²¡æœ‰æƒé™æ—¶çš„ç™»å½•é¡µé¢ï¼š\n\n\n![image.png](/img/posts/2024-1-19/2024-1-19-9.png)\n\n\næˆ‘ä»¬é‡å†™ä¸€ä¸‹ `app/layout.js`:\n\n```js\nimport { getUser } from '@/lib/auth'\n \nexport default function Layout({ dashboard, login }) {\n  const isLoggedIn = getUser()\n  return isLoggedIn ? dashboard : login\n}\n```\n\ngetUser æ˜¯è·å–å½“å‰ç”¨æˆ·çš„ï¼Œè¿™é‡Œå¿½ç•¥å…¶å®ç°ã€‚è¿™æ ·ï¼Œåœ¨æ ¹è·¯ç”±ä¸‹ï¼Œå°±å¯ä»¥é€šè¿‡æ¡ä»¶è¯­å¥åŠ¨æ€æŒ‚è½½å’Œåˆ é™¤è·¯ç”±ç»„ä»¶ï¼Œå½“ç„¶äº†ï¼Œä»–ä»¬ä¹Ÿå¯ä»¥åŒæ—¶è¢«æ¸²æŸ“åœ¨åŒä¸€ä¸ªé¡µé¢ä¸Šã€‚\n\n### è·¯ç”±æ‹¦æˆª\n\nè·¯ç”±æ‹¦æˆªä¸€èˆ¬é’ˆå¯¹å¼¹å‡ºå±‚ï¼Œåœ¨ nextjs ä¸­ï¼Œå¼¹å‡ºå±‚ modal ä¹Ÿæœ‰è‡ªå·±çš„è·¯ç”±ï¼Œåœ¨å¼¹å‡ºå±‚è·¯ç”±ä¸‹åŸåœ°åˆ·æ–°é¡µé¢ï¼Œä¸åº”è¯¥å†å‡ºç°æ¨¡æ€æ¡†ï¼Œè€Œæ˜¯ç›´æ¥å±•ç¤ºåŸæ¥å¼¹çª—é‡Œè¾¹çš„è¯¦æƒ…ï¼Œè¿™æ ·çš„ä¸€ä¸ªurlå±•ç¤ºä¸¤ç§å½¢æ€çš„è·¯ç”±ï¼Œå«åšæ‹¦æˆªè·¯ç”±ã€‚\n\nè·¯ç”±æ‹¦æˆªï¼Œæ˜¯åœ¨è·¯ç”±ç›®å½•å‘½åå‰é¢åŠ ä¸Šå°æ‹¬å·è¡¨ç¤ºï¼š\n\n-   `(.)`åŒ¹é…**åŒä¸€çº§åˆ«çš„æ®µ**\n-   `(..)`åŒ¹é…**ä¸Šä¸€çº§çš„æ®µ**\n-   `(..)(..)`åŒ¹é…**ä¸Šé¢ä¸¤çº§çš„æ®µ**\n-   `(...)`åŒ¹é…**æ ¹** `app`ç›®å½•ä¸­çš„æ®µ\n\næˆ‘ä»¬ä¸¾ä¾‹æ¥è¯´æ˜ã€‚\n\n\n![image.png](/img/posts/2024-1-19/2024-1-19-10.png)\n\nä¸Šé¢çš„å›¾ç‰‡ä¸­ï¼Œphotoç›®å½•ä¸‹æ”¾ç½®çš„æ˜¯è·¯ç”± `photo/id` è¦å±•ç¤ºçš„å›¾ç‰‡è¯¦æƒ…å†…å®¹ï¼Œ`@modal` ç›®å½•ç”¨äºå°† photo ç›®å½•æ‹¦æˆªå¹¶åŒ…è£¹åœ¨ä¸€ä¸ªæ¨¡æ€æ¡†ä¸­ã€‚è¿™é‡Œ `(..)`ä¼šä» `@modal` ä¸Šä¸€çº§ç›®å½•å¯¼å…¥åŒçº§ç›®å½•ä¸­å»æ‰¾ `photo` ç›®å½•æ¥åŒ¹é…ã€‚\n\næ­¤æ—¶ï¼Œå½“é€šè¿‡ ```\u003cLink key={id} href={`/photos/${id}`}\u003e``` æ¥è®¿é—®ç›®å½•æ—¶ï¼Œå°±ä¼šå‡ºç°ä¸»é¡µé¢ä¸Šå¼¹å‡ºçš„æ¨¡æ€æ¡†ã€‚\n\nåœ¨åˆ—è¡¨é¡µç‚¹å‡» link è®¿é—®ï¼š\n\n\n![image.png](/img/posts/2024-1-19/2024-1-19-11.png)\n\nç›´æ¥é€šè¿‡ url è®¿é—®ï¼š\n\n\n![image.png](/img/posts/2024-1-19/2024-1-19-12.png)\n\ndemo åœ°å€ï¼š[è·¯ç”±æ‹¦æˆª](https://github.com/vercel-labs/nextgram/tree/main)\n\n### è·¯ç”±å¤„ç†ç¨‹åº ï¼ˆAPIè·¯ç”±ï¼‰\n\næ¯ä¸€å¥—è·¯ç”±ï¼ŒåŒ…æ‹¬æ ¹è·¯ç”±ï¼Œéƒ½æ˜¯å¯ä»¥é…æœ‰ä¸€ä¸ª `route.js` (ts) æ–‡ä»¶ç”¨äºè‡ªå®šä¹‰å¤„ç†æ•°æ®å’Œè·¯ç”±è¿”å›å†…å®¹çš„ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä¸‹çš„è·¯ç”±ç›®å½•ï¼š\n\n```shell\n./posts\nâ””â”€â”€ [...ids]\n    â”œâ”€â”€ page.js\n    â””â”€â”€ route.js\n```\n\nåœ¨ route.js ä¸­æˆ‘ä»¬å†™å…¥ï¼š\n\n```js\nexport async function GET(\n  request,\n  params\n) {\n  const ids = params.params.ids;\n  console.log(ids)\n\n  return new Response('Hello, Next.js!', {\n    status: 200,\n    headers: { 'Set-Cookie': `token=${ids}` },\n  })\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œä»–æ¥å—äº†è·¯ç”±å‚æ•° idsï¼Œå¹¶ä¸”æ ¹æ®è‡ªå®šä¹‰çš„é€»è¾‘è¿”å›äº†é¡µé¢å“åº”ã€‚é¡µé¢è®¿é—® `http://localhost:3000/posts/111/122` æŸ¥çœ‹æ•ˆæœï¼š\n\n\n![image.png](/img/posts/2024-1-19/2024-1-19-13.png)\n\nè‡ªå®šä¹‰çš„ cookie è®¾ç½®è¿›å»äº†ã€‚\n\n### è·¯ç”±ä¸­é—´ä»¶\n\nåœ¨é¡¹ç›®ç›®å½•ä¸­æ”¾ç½®æ–‡ä»¶ `middleware.ts`ï¼ˆæˆ– .jsï¼‰æ¥å®šä¹‰ä¸­é—´ä»¶ã€‚æ”¾ç½®ç›®å½•ä¸`pages`æˆ–`app`åŒçº§ï¼Œæˆ–åœ¨å†…éƒ¨`src` é¡¶å±‚ï¼ˆå¦‚æœæœ‰ srcï¼‰ï¼Œnextjs ä¼šè‡ªåŠ¨è¯†åˆ«ä¸­é—´ä»¶æ–‡ä»¶ï¼Œå¹¶åœ¨å†…å®¹ç¼“å­˜å’Œè·¯ç”±åˆ‡æ¢ä¹‹å‰æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚\n\nä¸¾ä¸€ä¸ªæˆ‘åœ¨é¡¹ç›®ä¸­é…ç½® i18n çš„ä¾‹å­ï¼š\n\n```js\n// src/middleware.js\nexport function middleware(req) {\n  let lng\n  if (req.cookies.has(cookieName)) {\n    lng = acceptLanguage.get(req.cookies.get(cookieName).value)\n    console.log('Cookie language:', lng)\n  }\n  if (!lng) {\n    lng = acceptLanguage.get(req.headers.get('Accept-Language'))\n    console.log('Accept-Language:', lng)\n  }\n  if (!lng || !languages.includes(lng)) lng = fallbackLng\n\n  // Redirect if lng in path is not supported\n  if (\n    !languages.some(loc =\u003e req.nextUrl.pathname.startsWith(`/${loc}`)) \u0026\u0026\n    !req.nextUrl.pathname.startsWith('/_next')\n  ) {\n    return NextResponse.redirect(new URL(`/${lng}${req.nextUrl.pathname}`, req.url))\n  }\n\n  return NextResponse.next()\n}\n```\n\nä¸Šé¢çš„ä»£ç ï¼Œæ‹¦æˆªè¯·æ±‚ reqï¼Œåˆ¤æ–­è¯·æ±‚çš„ cookie é‡Œæœ‰æ²¡æœ‰è¯­è¨€çš„é…ç½®ï¼Œå¦‚æœæ²¡æœ‰å°±ä½¿ç”¨ Accept-Language è·å–æµè§ˆå™¨æ¨èçš„è¯­è¨€ï¼Œå¦‚æœè¿˜æ²¡æœ‰å°±ä½¿ç”¨å›è½å…œåº•æ–¹æ¡ˆï¼›æœ€åä½¿ç”¨ `NextResponse.redirect` é‡å®šå‘åˆ°å¯¹åº”çš„è¯­è¨€è·¯å¾„ã€‚\n\n## 2. æ•°æ®è·å–æ–¹å¼\n\nNext.js ä¹Ÿå¯ä»¥è¯·æ±‚ç¬¬ä¸‰æ–¹çš„æœåŠ¡æ¥è·å–æ•°æ®ã€‚\n\n### æœåŠ¡ç«¯\n\næœåŠ¡ç«¯ç»„ä»¶ä¸­ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ fetchï¼š\n\n```js\n// page.js\nasync function getData() {\n  const res = await fetch('https://api.example.com/...')\n  // The return value is *not* serialized\n  // You can return Date, Map, Set, etc.\n \n  if (!res.ok) {\n    // This will activate the closest `error.js` Error Boundary\n    throw new Error('Failed to fetch data')\n  }\n \n  return res.json()\n}\n \nexport default async function Page() {\n  const data = await getData()\n  console.log(data)\n  return \u003cmain\u003e\u003c/main\u003e\n}\n```\næ­¤å¤–ï¼Œfetch å¯ä»¥ä½¿ç”¨ `{ cache: 'force-cache' }` æ¥ç¼“å­˜æ•°æ®ã€‚\n\n### å®¢æˆ·ç«¯\n\nè¦å£°æ˜ä¸€ä¸ªç»„ä»¶æ˜¯å®¢æˆ·ç«¯ç»„ä»¶ï¼Œéœ€è¦è¿™æ ·å†™:\n\n```js\n'use client'\n \nexport default function ClientComponent({ updateItem }) {\n  return \u003cform action={updateItem}\u003e{/* ... */}\u003c/form\u003e\n}\n```\n\nå®¢æˆ·ç«¯ç»„ä»¶å°±è·Ÿå¹³å¸¸çš„ react å¼€å‘ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨ React çš„å„ç§çŠ¶æ€ Hook å’Œ ç¬¬ä¸‰æ–¹å·¥å…·ï¼ˆæ¯”å¦‚ axiosï¼‰æ¥å¤„ç†æ•°æ®ã€‚\n\nå®¢æˆ·ç«¯æˆ‘ä»¬è¿˜å¯ä»¥è¯·æ±‚å‰é¢çš„ API è·¯ç”±æ¥è·å–æ•°æ®ï¼ŒAPI è·¯ç”±ä¸­å¯ä»¥æ˜¯æœåŠ¡ç«¯è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£è¯·æ±‚çš„æ•°æ®ã€‚\n\n## 3. æœåŠ¡ç«¯æ¸²æŸ“ä¸å®¢æˆ·ç«¯æ¸²æŸ“\n\n### æœåŠ¡ç«¯ç­–ç•¥\n\n- é»˜è®¤ä¸ºé™æ€æ¸²æŸ“\n\nè·¯ç”±å’ŒæœåŠ¡ç«¯æ•°æ®åœ¨ build æ—¶åŒæ­¥è·å–ï¼Œç»“æœä¼šå­˜åœ¨æœåŠ¡ç«¯ï¼Œæ”¯æŒç¼“å­˜ CDN ä¸­ï¼Œæ­¤æ—¶å°±æ˜¯æ ‡å‡†çš„åç«¯ç›´å‡ºçš„é™æ€é¡µé¢ã€‚\n\n- åŠ¨æ€æ¸²æŸ“\n\nè·¯ç”±åœ¨æ¯æ¬¡è®¿é—®æ—¶åŠ¨æ€è·å–é¡µé¢æ•°æ®ï¼Œé€‚ç”¨äºä¸€äº›éœ€è¦å±•ç¤ºå®æ—¶æ•°æ®çš„åœºæ™¯ï¼ˆæ¯”å¦‚ cookiesã€url paramsç­‰ï¼‰ã€‚\n\nå¦‚æœé¡µé¢ä¸­æœ‰åŠ¨æ€å‡½æ•°æˆ–è€…æœªè¢«ç¼“å­˜çš„æ•°æ®ï¼Œåˆ™è‡ªåŠ¨è½¬æ¢ä¸ºåŠ¨æ€é¡µé¢æ¸²æŸ“ï¼š\n\nDynamic Functions | Data       | Route                |\n| ----------------- | ---------- | -------------------- |\n| No                | Cached     | Statically Rendered  |\n| Yes               | Cached     | Dynamically Rendered |\n| No                | Not Cached | Dynamically Rendered |\n| Yes               | Not Cached | Dynamically Rendered|\n\nå…³äºåŠ¨æ€å‡½æ•°ï¼ŒæŒ‡çš„æ˜¯åªæœ‰åœ¨è¯·æ±‚åæ‰çŸ¥é“è¿”å›ç»“æœçš„å‡½æ•°ï¼ŒåŠ¨æ€å‡½æ•°å¿…é¡»æ˜¯å†…ç½®çš„ï¼Œå› ä¸º fetch ä¼šè¢«ç¼“å­˜ï¼š\n\n```js\nimport { cookies } from 'next/headers'\nimport { headers } from 'next/headers'\n```\n\n- æµå¼åŠ è½½\n\næ¸è¿›å¼çš„ UI æ¸²æŸ“ç­–ç•¥ï¼Œå¯ä»¥é€šè¿‡ loading.js æ–‡ä»¶ï¼Œæˆ–è€…ä½¿ç”¨ `React.Suspense` æ¥å¼€å¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæµå¼åŠ è½½å†…ç½®äº Next.js App Router ä¸­ï¼ŒåŠ©äºæé«˜åˆå§‹é¡µé¢åŠ è½½æ€§èƒ½ï¼Œæ¯”å¦‚åŠ è½½å“ªäº› ä¾èµ–äºè¾ƒæ…¢æ•°æ®è·å–ï¼ˆä¼šé˜»æ­¢æ¸²æŸ“æ•´ä¸ªè·¯ç”±ï¼‰çš„ UIï¼ˆäº§å“é¡µé¢ä¸Šçš„è¯„è®ºç­‰ï¼‰:\n\n```js\n// page.js\nimport { Suspense } from 'react'\nimport { PostFeed, Weather } from './Components'\n \nexport default function Posts() {\n  return (\n    \u003csection\u003e\n      \u003cSuspense fallback={\u003cp\u003eLoading feed...\u003c/p\u003e}\u003e\n        \u003cPostFeed /\u003e\n      \u003c/Suspense\u003e\n      \u003cSuspense fallback={\u003cp\u003eLoading weather...\u003c/p\u003e}\u003e\n        \u003cWeather /\u003e\n      \u003c/Suspense\u003e\n    \u003c/section\u003e\n  )\n}\n```\n\n### å®¢æˆ·ç«¯ç­–ç•¥\n\nå®¢æˆ·ç«¯ç»„ä»¶åœ¨ build æ—¶ä¸å‚ä¸è·å–æ•°æ®å’Œé¢„æ¸²æŸ“ï¼Œä»–åœ¨å®¢æˆ·æµè§ˆå™¨è¿è¡Œæ—¶æ‰å¼€å§‹æ‰§è¡Œå¹¶æ¸²æŸ“æ•°æ®ã€‚å®¢æˆ·ç«¯ç»„ä»¶å¯ä»¥ä½¿ç”¨çŠ¶æ€ã€æ•ˆæœå’Œäº‹ä»¶ä¾¦å¬å™¨ï¼Œå¾€å¾€ç”¨äºäº¤äº’ç›¸å¯¹å¤æ‚çš„åœºæ™¯ã€‚\n\nåœ¨éœ€è¦å®¢æˆ·ç«¯æ¸²æŸ“çš„ä»£ç ç‰‡æ®µé¡¶å±‚å†™ä¸Šï¼š`\"use client\"` ä¾¿å¯ä»¥å£°æ˜å®¢æˆ·ç«¯ç»„ä»¶ï¼š\n\n```js\n'use client'\n \nimport { useState } from 'react'\n \nexport default function Counter() {\n  const [count, setCount] = useState(0)\n \n  return (\n    \u003cdiv\u003e\n      \u003cp\u003eYou clicked {count} times\u003c/p\u003e\n      \u003cbutton onClick={() =\u003e setCount(count + 1)}\u003eClick me\u003c/button\u003e\n    \u003c/div\u003e\n  )\n}\n```\n\nNext.js æ¸²æŸ“çš„ç­–ç•¥æ˜¯ï¼šåœ¨ç”¨æˆ·å®¢æˆ·ç«¯æ‹‰å–æœåŠ¡ç«¯ç»„ä»¶ä»£ç å’Œå®¢æˆ·ç«¯ç»„ä»¶ä»£ç ï¼Œå…ˆæ¸²æŸ“å‡ºæ— äº¤äº’çš„é¡µé¢ä¿¡æ¯ï¼Œå®Œæˆåˆå§‹é¡µé¢åŠ è½½ï¼Œä¹‹åä½¿ç”¨å®¢æˆ·ç«¯æ°´åˆæŠ€æœ¯ï¼Œæ›´æ–° DOM æ ‘ï¼Œæ¤å…¥äº¤äº’ä¿¡æ¯å’Œäº‹ä»¶ç›‘å¬ã€‚\n\n\n## 4. å…³äºç¼“å­˜\n\n### è¯·æ±‚ç¼“å­˜\n\nä¸ºäº†ä¸ç”¨æ¯æ¬¡éƒ½è°ƒç”¨æ¥å£è·å–é‡å¤çš„æ•°æ®ï¼ŒNext.js æ‰©å±•äº† fetch API å»è‡ªåŠ¨ç¼“å­˜è¯·æ±‚æ•°æ®ï¼Œç¼“å­˜å‘½ä¸­ç­–ç•¥æ˜¯ï¼š`ç›¸åŒçš„ urlã€åè®®å’Œè¯·æ±‚ä½“`ã€‚\n\n\n![image.png](/img/posts/2024-1-19/2024-1-19-14.png)\n\nåœ¨éœ€è¦æ•°æ®çš„åœ°æ–¹ï¼Œå¯ä»¥æ”¾å¿ƒçš„ç›´æ¥ä½¿ç”¨ fetch å³å¯ï¼ŒNext.js ä¼šè¿›è¡Œå…œåº•çš„ã€‚ç¼“å­˜ç­–ç•¥å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š\n\n1. åœ¨ä¸€ä¸ª route åŠ è½½æ—¶ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œä¸è¿›è¡Œç¼“å­˜\n2. ç¬¬äºŒæ¬¡è¯·æ±‚ï¼Œå¦‚æœæ»¡è¶³æˆ‘ä»¬ä¸Šé¢è¯´çš„æ¡ä»¶ï¼Œåˆ™å‘½ä¸­ç¼“å­˜ï¼Œè¿™æ¬¡è¯·æ±‚è¿”å›æ•°æ®å°±ä»ç¼“å­˜ä¸­å–\n3. ä¸€æ—¦ route é‡æ¸²æŸ“äº†ï¼Œç¼“å­˜åˆ™ä¼šæ¸…é™¤ï¼Œé‚£ä¹ˆè°ƒç”¨å°±ä¼šå‘èµ· API è¯·æ±‚äº†ã€‚\n\nå¦‚æœä¸æƒ³ç¼“å­˜è¿™ä¸ªè¯·æ±‚ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š\n\n```js\nconst { signal } = new AbortController()\nfetch(url, { signal })\n```\n\n### æ•°æ®çš„ç¼“å­˜\n\n**æ•°æ®ç¼“å­˜å’Œè¯·æ±‚è®°å¿†ä¹‹é—´çš„å·®å¼‚**\n\nå®˜æ–¹è§£é‡Šï¼š\n\næ•°æ®ç¼“å­˜åœ¨ä¼ å…¥è¯·æ±‚å’Œéƒ¨ç½²ä¸­æ˜¯æŒä¹…çš„ï¼Œè€Œè¯·æ±‚ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸä»…æŒç»­åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ã€‚\n\né€šè¿‡è¯·æ±‚ç¼“å­˜ï¼Œå¯ä»¥é¿å…é‡å¤è¯·æ±‚ç¼“å­˜æœåŠ¡å™¨ã€CDNç­‰çš„æ•°é‡ã€‚è€Œé€šè¿‡æ•°æ®ç¼“å­˜ï¼Œæˆ‘ä»¬å‡å°‘äº†å¯¹åŸå§‹æ•°æ®æºå‘å‡ºçš„è¯·æ±‚æ•°é‡ã€‚\n\nåƒµå°¸æ ½èŠ±ï¼Œå…·ä½“çš„åŒºåˆ«æˆ‘ä¹Ÿç†è§£ä¸æ·±ï¼Œä¸ºå•¥è¦åšä¸¤å±‚~~ ğŸ˜“\n\næˆ‘ä»¬çœ‹å›¾ï¼š\n\n\n![image.png](/img/posts/2024-1-19/2024-1-19-15.png)\n\nè¯·æ±‚ç¼“å­˜æ˜¯åœ¨æ•°æ®ç¼“å­˜å‰è¾¹çš„ï¼Œè¯·æ±‚ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œæ‰ä¼šå»æ‰¾æ•°æ®ç¼“å­˜ï¼Œè¿˜æ²¡æœ‰å‘½ä¸­æ‰ä¼šå»è¯·æ±‚åŸå§‹æ•°æ®æºã€‚\n\næˆ‘ä»¬å¯ä»¥è¿™æ ·è¯·æ±‚ï¼š\n\n```js\nfetch('https://...', { next: { revalidate: 3600 } })\n```\n\nè¡¨ç¤º 3600 ç§’ä¹‹å†…ï¼Œæ•°æ®æ˜¯ç¼“å­˜æœ‰æ•ˆçš„ã€‚3600 ç§’ä¹‹åä¼šè‡ªåŠ¨é‡æ–°éªŒè¯ï¼Œè‹¥æ²¡æœ‰å˜åŒ–åˆ™è¿˜æ˜¯ç”¨ç¼“å­˜ã€‚\n\næˆ‘ä»¬è¿˜å¯ä»¥ç¦ç”¨ç¼“å­˜:\n\n```js\nfetch(`https://...`, { cache: 'no-store' })\n```\n\n### å°ç»“\n\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…¨è·¯ç”±ç¼“å­˜çš„æµç¨‹å›¾ï¼š\n\n\n![image.png](/img/posts/2024-1-19/2024-1-19-16.png)\n\n1. è¿è¡Œæ—¶ï¼Œå®¢æˆ·ç«¯çš„è·¯ç”±ç¼“å­˜ï¼Œæ¯”å¦‚ Suspense.\n2. ç¼–è¯‘æ—¶ï¼Œè·¯ç”±å·²ç»ç¡®å®šï¼Œè¯·æ±‚çš„è·¯ç”±å¦‚æœå‘½ä¸­ç¼“å­˜ï¼Œåˆ™ç›´æ¥è¿”å›ã€‚\n3. ç¼–è¯‘æ—¶ï¼ŒAPI è¯·æ±‚å·²ç»ç¡®å®šï¼Œè¯·æ±‚çš„ API å¦‚æœå‘½ä¸­ç¼“å­˜ï¼Œåˆ™ç›´æ¥è¿”å›ç»“æœï¼Œä¸å¿…å†æ¬¡å‘èµ·å¯¹æ•°æ®ç¼“å­˜çš„è¯·æ±‚ã€‚\n4. ç¼–è¯‘æ—¶ï¼ŒéåŠ¨æ€ API è¿”å›çš„ç»“æœå·²ç»ç¡®å®šï¼Œå¦‚æœè¯·æ±‚ç›¸åŒçš„æ•°æ®ï¼Œä¸”ç¼“å­˜ä¸è¿‡æœŸï¼Œåˆ™ä½¿ç”¨ç¼“å­˜ç»“æœï¼Œä¸å‘å…ƒæ•°æ®è¯·æ±‚ã€‚\n\n## 5. å…³äºæ ·å¼ \n\nå¯ä»¥ä½¿ç”¨ css æ¨¡å—ï¼š\n\n```js\nimport styles from './styles.module.css'\n \nexport default function DashboardLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  return \u003csection className={styles.dashboard}\u003e{children}\u003c/section\u003e\n}\n```\n\nä¹Ÿå¯ä»¥ä½¿ç”¨ CSS-in-JSï¼Œæ¯”å¦‚ emotion ç­‰ï¼Œå½“ç„¶ä¸€äº›é¢„å¤„ç†å™¨ï¼Œæ¯”å¦‚ sassã€less ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä¸è¿‡è¦åœ¨é…ç½®é‡Œå¢åŠ é…ç½®é¡¹ï¼š\n\n```js\nconst path = require('path')\n \nmodule.exports = {\n  sassOptions: {\n    includePaths: [path.join(__dirname, 'styles')],\n  },\n}\n```\n\nå½“ç„¶ï¼Œå¯¹äºä¼ä¸šçº§å¤§å‹åº”ç”¨ï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨ Tailwindcssï¼Œä¸‹ä¸€æœŸè®²å®æˆ˜ä¼šè®²è§£ã€‚\n\n\n## 6. SEO é…ç½®\n\n\n### meta \n\nåœ¨å„ä¸ª page.js æ–‡ä»¶ä¸­ï¼Œéƒ½å¯ä»¥é…ç½®å½“å‰é¡µé¢å¯¹åº”çš„ meta ä¿¡æ¯ï¼š\n\n```js\nimport { Metadata } from 'next'\n\n// ä½¿ç”¨ é™æ€ meta\nexport const metadata: Metadata = {\n  title: '...',\n}\n \n// ä½¿ç”¨ åŠ¨æ€ meta\nexport async function generateMetadata({ params }) {\n  return {\n    title: '...',\n  }\n}\n\nexport default function Page() { return '...'}\n```\nå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ layout ä¸­å†™å…¥ã€‚\n\n### sitemap\n\næ¨èå®‰è£… `next-sitemap` åº“ï¼Œä½¿ç”¨æ—¶åªéœ€è¦åœ¨ package.json ä¸­å†™å…¥æŒ‡ä»¤å³å¯ï¼š`\"postbuild\": \"next-sitemap\"`ï¼Œè¿™æ ·åœ¨æ‰“åŒ…åå°±ä¼šåœ¨ public æ–‡ä»¶å¤¹ç”Ÿæˆ robots.txt å’Œ sitemap.xml æ–‡ä»¶ã€‚å½“ç„¶äº†ï¼Œå¦‚æœä½ æƒ³è‡ªå®šä¹‰é…ç½®ï¼Œå¯åœ¨æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ `next-sitemap.config`:\n\n```js\n/** @type {import('next-sitemap').IConfig} */\nmodule.exports = {\n  siteUrl: process.env.SITE_URL || \"https://xxx.com\",\n  generateIndexSitemap: false,\n  generateRobotsTxt: true,\n  robotsTxtOptions: {\n    policies: [{ userAgent: '*', allow: '/' }],\n  },\n};\n```\n\n## 7. é™„å½•ï¼šNext.js 13+ æ–°åŠŸèƒ½ä¸€è§ˆ\n\n### React æœåŠ¡å™¨ç»„ä»¶ ï¼ˆRSCï¼‰\n\nRSCs å…è®¸åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šé‡‡ç”¨æ›´ç²¾ç»†çš„æ¸²æŸ“æ–¹å¼ã€‚React å…è®¸å¼€å‘è€…é€‰æ‹©ç»„ä»¶æ˜¯åœ¨æœåŠ¡å™¨ä¸Šè¿˜æ˜¯åœ¨å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·è¯·æ±‚æ—¶è¢«è¿«å†³å®šåœ¨å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ä¸Šæ¸²æŸ“æ•´ä¸ªé¡µé¢ã€‚è¿™å¯ä»¥è®©ä½ åœ¨æœç´¢å¼•æ“ç»“æœé¡µé¢ä¸­è·å¾—å·¨å¤§ä¼˜åŠ¿ã€‚\n\n### Streaming UI\n\næµå¼ UIï¼ˆStreaming UIï¼‰ä»£ç å—æ˜¯ä¸€ä¸ªæ–°å…´çš„è®¾è®¡æ¨¡å¼ï¼Œç§°ä¸º`å²›å±¿æ¶æ„ï¼ˆthe island architectureï¼‰`ï¼Œæ—¨åœ¨é¦–æ¬¡åŠ è½½æ—¶å°½é‡å‘å®¢æˆ·ç«¯å‘é€æœ€å°‘çš„ä»£ç ã€‚\n\nå…¶å®ç°ç›®æ ‡æ˜¯ï¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªæ— éœ€ JavaScript çš„å®Œå…¨æ¸²æŸ“çš„é¡µé¢ï¼Œç„¶åå†å‘é€å‰©ä½™çš„å†…å®¹ã€‚\n\nå½“ Next.js åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“é¡µé¢æ—¶ï¼Œé€šå¸¸ä¼šå°†é¡µé¢çš„æ‰€æœ‰ JavaScript æ†ç»‘å¹¶ä¸ä¹‹ä¸€èµ·å‘é€ã€‚è€Œæµå¼ UI ä»£ç å—çš„å¼•å…¥æ¶ˆé™¤äº†è¿™ç§éœ€è¦ï¼Œå…è®¸å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªéå¸¸å°çš„é™æ€é¡µé¢ï¼Œæ˜¾è‘—æ”¹å–„äº†è¯¸å¦‚é¦–æ¬¡å†…å®¹å‘ˆç°æ—¶é—´å’Œæ•´ä½“é¡µé¢é€Ÿåº¦ç­‰æŒ‡æ ‡ã€‚\n\næµå¼ UI çš„æ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š\n\n-   ç”¨æˆ·å‘èµ·åˆå§‹è¯·æ±‚\n-   æ¸²æŸ“å¹¶å‘é€åŸºæœ¬çš„ HTML é¡µé¢ç»™å®¢æˆ·ç«¯\n-   æœåŠ¡å™¨å‡†å¤‡ JavaScript æ†ç»‘æ–‡ä»¶\n-   åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­æ˜¾ç¤ºéœ€è¦ JavaScript çš„é¡µé¢éƒ¨åˆ†\n-   ä»…å°†è¯¥ç»„ä»¶æ‰€éœ€çš„ JavaScript æ†ç»‘æ–‡ä»¶å‘é€ç»™å®¢æˆ·ç«¯\n\n### App Router\n\napp ç›®å½•ä¸‹çš„æ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯é¢„å…ˆé…ç½®å¥½çš„ï¼Œä»¥å…è®¸ RSCs å’Œæµå¼ UI çš„å‡ºç°ã€‚ä½ åªéœ€è¦åˆ›å»ºä¸€ä¸ª[loading.js](https://beta.nextjs.org/docs/routing/loading-ui)ç»„ä»¶ï¼Œå®ƒå°†å®Œå…¨åŒ…ä½é¡µé¢ç»„ä»¶å’Œ suspense è¾¹ç•Œå†…çš„ä»»ä½•å­èŠ‚ç‚¹ã€‚\n\n### å‡çº§çš„ Next Image ç»„ä»¶\n\nåˆ©ç”¨äº†æµè§ˆå™¨åŸç”Ÿæ”¯æŒçš„æ‡’åŠ è½½ç­–ç•¥ï¼Œæ·»åŠ äº†ä¸€äº›å¯¹ SEO æœ‰å¾ˆå¤§å¸®åŠ©çš„æ”¹è¿›ï¼š\n\n-   é»˜è®¤éœ€è¦ alt æ ‡ç­¾ã€‚\n-   æ›´å¥½çš„éªŒè¯ï¼Œä»¥ç¡®å®šæ¶‰åŠæ— æ•ˆå±æ€§é”™è¯¯ã€‚\n-   ç”±äºæœ‰äº†ä¸€ä¸ªæ›´åƒ HTML çš„ç•Œé¢ï¼Œæ›´å®¹æ˜“è¿›è¡Œæ ·å¼è®¾è®¡ã€‚\n\n### Font ç»„ä»¶\n\nç½‘é¡µæ€§èƒ½ä¸­ï¼ŒCLS æ˜¯ä¸€ä¸ªé‡è¦çš„æŒ‡æ ‡ï¼ˆCLS æ˜¯ Cumulative Layout Shift çš„ç¼©å†™ï¼Œè¡¡é‡åœ¨ç½‘é¡µçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…å‘ç”Ÿçš„æ‰€æœ‰æ„å¤–å¸ƒå±€åç§»çš„å¾—åˆ†æ€»å’Œã€‚ï¼‰ï¼Œæ ¹æ®ä½ æ‰€ä½¿ç”¨çš„æ¡†æ¶ï¼ˆæ¯”å¦‚ Gatsbyï¼‰ï¼Œè®©å­—ä½“æœ‰æ•ˆåœ°é¢„åŠ è½½å¯èƒ½æ˜¯å¾ˆæ£˜æ‰‹çš„ã€‚ä¸€æ®µæ—¶é—´ä»¥æ¥ï¼Œå‘è°·æ­Œç­‰å­—ä½“åº“å‘å‡ºå¤–éƒ¨è¯·æ±‚æ˜¯ä¸€ä¸ªé¿å…ä¸äº†çš„è¡Œä¸ºï¼Œåœ¨è®¸å¤š SPA åº”ç”¨ç¨‹åºä¸­é€ æˆäº†ä¸€ä¸ªéš¾ä»¥ç®¡ç†çš„ç“¶é¢ˆï¼ˆé¡µé¢æ–‡å­—ä¼šé—ªçƒä¸€ä¸‹ï¼‰ã€‚\n\nNext Font Component æ—¨åœ¨è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒåœ¨æ„å»ºæ—¶è·å–æ‰€æœ‰çš„å¤–éƒ¨å­—ä½“ï¼Œå¹¶ä»ä½ è‡ªå·±çš„åŸŸä¸­è‡ªæˆ‘æ‰˜ç®¡å®ƒä»¬ã€‚å­—ä½“ä¹Ÿè¢«è‡ªåŠ¨ä¼˜åŒ–ï¼Œå¹¶ä¸”é€šè¿‡è‡ªåŠ¨åˆ©ç”¨ CSS **size-adjustï¼ˆå¤§å°è°ƒæ•´ï¼‰**  å±æ€§å®ç°äº†é›¶ç´¯ç§¯çš„å¸ƒå±€è½¬ç§»ã€‚\n\næ¯”å¦‚è¿™æ ·ä½¿ç”¨ google å­—ä½“ï¼š\n\n```js\nimport { Roboto } from 'next/font/google'\n\nconst roboto = Roboto({ weight: '400', subsets: ['latin'], display: 'swap',})\n\n...\n\u003chtml lang=\"en\" className={roboto.className}\u003e \u003cbody\u003e{children}\u003c/body\u003e \u003c/html\u003e\n```\n\nå…³äºæ–°åŠŸèƒ½ App router å°±è®²è¿™ä¹ˆå¤šå•¦ï¼Œæ¬¢è¿å¤§å®¶ä¸€èµ·è®¨è®ºäº¤æµï¼Œä¸€èµ·å­¦ä¹ ã€‚"])</script><script>self.__next_f.push([1,"16:T1b89,"])</script><script>self.__next_f.push([1,"æœ¬èŠ‚ç»§ç»­ï¼Œä»‹ç»å¾®å‰ç«¯ä¸­ js éš”ç¦»çš„æ–¹æ¡ˆã€‚å‰ä¸€è®²çš„ iframe éš”ç¦»ï¼Œæœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨äº† V8 å¼•æ“çš„éš”ç¦»æœºåˆ¶ï¼Œå€ŸåŠ© iframe å®ç°çš„ï¼›æœ¬èŠ‚è¯´çš„å¿«ç…§éš”ç¦»ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯æŠŠå­åº”ç”¨æ‰§è¡Œåœ¨ä¸»åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œä½†æ˜¯å¯¹ä¸»åº”ç”¨çš„ winodw åšå¿«ç…§ï¼Œåœ¨å­åº”ç”¨å¸è½½çš„æ—¶å€™æ¢å¤å¿«ç…§å³å¯ã€‚\n\n![image.png](/img/posts/2024-1-11/2024-1-11-1.png)\n\n[ä»“åº“åœ°å€ï¼šsandbox/snapshot-script åˆ†æ”¯](https://github.com/heiheihoho1213/monto-app/tree/sandbox/snapshot-script)\n\n## 2. ä¸»åº”ç”¨æœåŠ¡\n\næˆ‘ä»¬å¯åŠ¨ä¸»åº”ç”¨æœåŠ¡ï¼š\n\n```js\napp.listen(port.main, host);\n```\nå¹¶åœ¨ä¸»åº”ç”¨é‡Œå†™å…¥æ¥å£è¯·æ±‚ï¼š\n\n```js\napp.post(\"/microapps\", function (req, res) {\n  // è¿™é‡Œå¯ä»¥æ˜¯ç®¡ç†åå°æ–°å¢èœå•åå­˜å‚¨åˆ°æ•°æ®åº“çš„æ•°æ®\n  // ä»è€Œå¯ä»¥é€šè¿‡ç®¡ç†åå°åŠ¨æ€é…ç½®å¾®åº”ç”¨çš„èœå•\n  res.json([\n    {\n      name: \"micro1\",\n      id: \"micro1\",\n      // è¿™é‡Œæš‚æ—¶ä»¥ä¸€ä¸ªå…¥å£æ–‡ä»¶ä¸ºç¤ºä¾‹\n      script: `http://${host}:${port.micro}/micro1.js`,\n      style: `http://${host}:${port.micro}/micro1.css`,\n      // æŒ‚è½½åˆ° window ä¸Šçš„å¯åŠ¨å‡½æ•° window.micro1_mount\n      mount: \"micro1_mount\",\n      // æŒ‚è½½åˆ° window ä¸Šçš„å¯åŠ¨å‡½æ•° window.micro1_unmount\n      unmount: \"micro1_unmount\",\n      prefetch: true,\n    },\n    {\n      name: \"micro2\",\n      id: \"micro2\",\n      script: `http://${host}:${port.micro}/micro2.js`,\n      style: `http://${host}:${port.micro}/micro2.css`,\n      mount: \"micro2_mount\",\n      unmount: \"micro2_unmount\",\n      prefetch: true,\n    },\n  ]);\n});\n```\n\n### å­åº”ç”¨è®¾ç½®\n\næˆ‘ä»¬åˆ†åˆ«åœ¨ä¸¤ä¸ªå­åº”ç”¨ä¸­å„è‡ªé…ç½®è‡ªå·±çš„æ‰§è¡Œä»£ç ï¼Œä»»åŠ¡è®¾ç½®å…¨å±€çš„å˜é‡æ¥éªŒè¯æ²™ç®±çš„éš”ç¦»æ•ˆæœï¼š\n\n```js\n// micro1.js\nlet root = document.createElement(\"h1\");\nroot.textContent = \"å¾®åº”ç”¨1\";\nroot.id = 'micro1-dom';\nroot.onclick = () =\u003e {\n  console.log(\"å¾®åº”ç”¨1 çš„ window.a: \", window.a);\n};\ndocument.body.appendChild(root);\n\nwindow.a = 1;\n\n// micro2.js\nlet root = document.createElement(\"h1\");\nroot.textContent = \"å¾®åº”ç”¨2\";\nroot.id = 'micro2-dom';\nroot.onclick = () =\u003e {\n  console.log(\"å¾®åº”ç”¨2 çš„ window.a: \", window.a);\n};\ndocument.body.appendChild(root);\n\nwindow.a = 2;\n```\n\n## 3. ä¸»åº”ç”¨æ¸²æŸ“\n\næˆ‘ä»¬é…ç½®ä¸»åº”ç”¨çš„å…¥å£ï¼Œå¹¶è®¾ç½®ç”¨äºéªŒè¯çš„åŒåå…¨å±€å˜é‡ï¼š\n\n```html\n\u003c!-- ä¸»åº”ç”¨å¯¼èˆª --\u003e\n\u003cdiv id=\"nav\"\u003e\u003c/div\u003e\n\n\u003c!-- ä¸»åº”ç”¨å†…å®¹åŒº --\u003e\n\u003cdiv id=\"container\"\u003e\u003c/div\u003e\n\n\u003cscript\u003e\n  window.a = 3;\n\u003c/script\u003e\n```\n\næ¥ç€åœ¨ä¸»åº”ç”¨å¯åŠ¨çš„è„šæœ¬å†™å…¥æ²™ç®±é…ç½®ã€‚\n\n## 4. å®ç°æ²™ç®±\n\næ²™ç®±çš„å®ç°æ­¥éª¤å¯ä»¥å‚è§ iframe æ²™ç®±çš„æµç¨‹ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ Sandbox ç±»çš„å®ç°ã€‚\n\næˆ‘ä»¬å®ç°æ²™ç®±ç±»æ„é€ å‡½æ•°ï¼š\n\n```js\n// ç±»ä¸»è¦æˆå‘˜å˜é‡\n// å¾®åº”ç”¨ JS è¿è¡Œä¹‹å‰çš„ä¸»åº”ç”¨ window å¿«ç…§\nmainWindow = {};\n// å¾®åº”ç”¨ JS è¿è¡Œä¹‹åçš„ window å¯¹è±¡ï¼ˆç”¨äºç†è§£ï¼‰\nmicroWindow = {};\n// å¾®åº”ç”¨å¤±æ´»åå’Œä¸»åº”ç”¨çš„ window å¿«ç…§å­˜åœ¨å·®å¼‚çš„å±æ€§é›†åˆ\ndiffPropsMap = {};\n\nconstructor(options) {\n  this.options = options;\n  // é‡æ–°åŒ…è£…éœ€è¦æ‰§è¡Œçš„å¾®åº”ç”¨ JS è„šæœ¬\n  this.wrapScript = this.createWrapScript();\n}\n\ncreateWrapScript() {\n  // å¾®åº”ç”¨çš„ä»£ç è¿è¡Œåœ¨ç«‹å³æ‰§è¡Œçš„åŒ¿åå‡½æ•°ä¸­ï¼Œéš”ç¦»ä½œç”¨åŸŸ\n  return `;(function(window){\n    ${this.options.scriptText}\n  })(window)`;\n}\n```\n\nåŒæ ·æ˜¯é—­åŒ…æ‰§è¡Œè„šæœ¬ï¼Œä¸åŒçš„æ˜¯ä¸å†ä½¿ç”¨ window çš„ä»£ç†äº†ï¼Œè¿™é‡Œçš„ window æ˜¯ä¸»åº”ç”¨ window çš„å¿«ç…§ï¼Œä¸‹é¢ä¼šä»‹ç»å®ç°ã€‚\n\n#### æ¿€æ´»\n\næ²™ç®±åˆ›å»ºå®Œæˆåï¼Œå°±æ˜¯æ¿€æ´»å’Œå¸è½½åŠŸèƒ½äº†ï¼Œå…ˆçœ‹æ¿€æ´»ï¼š\n\n```js\nactive() {\n  // è®°å½•å¾®åº”ç”¨ JS è¿è¡Œä¹‹å‰çš„ä¸»åº”ç”¨ window å¿«ç…§\n  this.recordMainWindow();\n  // æ¢å¤å¾®åº”ç”¨éœ€è¦çš„ window å¯¹è±¡\n  this.recoverMicroWindow();\n  if (this.exec) {\n    return;\n  }\n  this.exec = true;\n  // æ‰§è¡Œå¾®åº”ç”¨ï¼ˆæ³¨æ„å¾®åº”ç”¨çš„ JS ä»£ç åªéœ€è¦è¢«æ‰§è¡Œä¸€æ¬¡ï¼‰\n  this.execWrapScript();\n}\n```\n\nå…¶ä¸­ recordMainWindow ç”¨äºè®°å½•æŒ‚è½½ä¹‹å‰ä¸»åº”ç”¨çš„ window çŠ¶æ€ï¼š\n\n```js\nrecordMainWindow() {\n  for (const prop in window) {\n    if (window.hasOwnProperty(prop)) {\n      this.mainWindow[prop] = window[prop];\n    }\n  }\n}\n```\n\nrecoverMicroWindow æ˜¯æ¢å¤ä¸Šä¸€æ¬¡æŒ‚è½½å­åº”ç”¨æ—¶çš„ window çŠ¶æ€ï¼š\n\n```js\nrecoverMicroWindow() {\n  // å¦‚æœå¾®åº”ç”¨å’Œä¸»åº”ç”¨çš„ window å¯¹è±¡å­˜åœ¨å±æ€§å·®å¼‚\n  // ä¸Šä¸€æ¬¡å¾®åº”ç”¨ window = ä¸»åº”ç”¨ window + å·®å¼‚å±æ€§ï¼ˆåœ¨å¾®åº”ç”¨å¤±æ´»å‰ä¼šè®°å½•è¿è¡Œè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°æ›´æ”¹çš„ window å±æ€§å€¼ï¼Œå†æ¬¡è¿è¡Œä¹‹å‰éœ€è¦æ¢å¤ä¿®æ”¹çš„å±æ€§å€¼ï¼‰\n  Object.keys(this.diffPropsMap).forEach((p) =\u003e {\n    // æ›´æ”¹ JS è¿è¡Œä¹‹å‰çš„å¾®åº”ç”¨ window å¯¹è±¡ï¼Œæ³¨æ„å¾®åº”ç”¨æœ¬è´¨ä¸Šå…±äº«äº†ä¸»åº”ç”¨çš„ window å¯¹è±¡ï¼Œå› æ­¤ä¸€ä¸ªæ—¶åˆ»åªèƒ½è¿è¡Œä¸€ä¸ªå¾®åº”ç”¨\n    window[p] = this.diffPropsMap[p];\n  });\n\n  this.microWindow = window;\n}\n```\n\nç„¶åå°±æ˜¯æ‰§è¡Œ è„šæœ¬ äº†ï¼š\n\n```js\nexecWrapScript() {\n  // åœ¨å…¨å±€ä½œç”¨åŸŸå†…æ‰§è¡Œå¾®åº”ç”¨ä»£ç \n  (0, eval)(this.wrapScript);\n}\n```\n\n(0, eval) æ˜¯ä¸€ä¸ªé€—å·è¡¨è¾¾å¼ï¼Œå…¶è¿”å›æœ€å³è¾¹çš„å€¼ï¼Œç­‰ä»·äº evalï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆå†™ï¼Œæ˜¯å› ä¸ºé€—å·è¡¨è¾¾å¼ä¹‹åè¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹ eval çš„é—´æ¥è°ƒç”¨ï¼Œè€Œé—´æ¥è°ƒç”¨è®¡ç®—å‡ºæ¥çš„æ˜¯ä¸€ä¸ªå€¼ï¼Œè€Œä¸æ˜¯å¼•ç”¨ï¼Œç›¸å½“äºæŠŠè¿™ä¸ªå‡½æ•°å•ç‹¬å£°æ˜å‡ºæ¥å†æ‰§è¡Œã€‚\n\nä¸Šé¢çš„ä»£ç  (0, eval)(this.wrapScript)ï¼Œç›¸å½“äºæ”¹å˜äº† eval æ‰§è¡Œå¯¹è±¡ä¸º wrapScriptï¼Œæ”¹å˜äº†å†…éƒ¨æ‰§è¡Œçš„ this æŒ‡é’ˆã€‚\n\n#### å¤±æ•ˆ\n\næˆ‘ä»¬å†æ¥çœ‹çœ‹è§£é™¤æ¿€æ´»çŠ¶æ€çš„å®ç°ã€‚\n\n```js\ninactive() {\n  // æ¸…ç©ºä¸Šä¸€æ¬¡è®°å½•çš„å±æ€§å·®å¼‚\n  this.diffPropsMap = {};\n  // è®°å½•å¾®åº”ç”¨è¿è¡Œåå’Œä¸»åº”ç”¨ Window å¿«ç…§å­˜åœ¨çš„å·®å¼‚å±æ€§\n  this.recordDiffPropsMap();\n  console.log(\n    `${this.options.appId} diffPropsMap: `,\n    this.diffPropsMap\n  );\n}\n```\n\nå…¶ä¸­ recordDiffPropsMapï¼š\n\n```js\nrecordDiffPropsMap() {\n  // è¿™é‡Œçš„ microWindow æ˜¯å¾®åº”ç”¨å¤±æ´»ä¹‹å‰çš„ windowï¼ˆåœ¨å¾®åº”ç”¨æ‰§è¡ŒæœŸé—´ä¿®æ”¹è¿‡ window å±æ€§çš„ windowï¼‰\n  for (const prop in this.microWindow) {\n    // å¦‚æœå¾®åº”ç”¨è¿è¡ŒæœŸé—´å­˜åœ¨å’Œä¸»åº”ç”¨å¿«ç…§ä¸ä¸€æ ·çš„å±æ€§å€¼\n    if (\n      window.hasOwnProperty(prop) \u0026\u0026\n      this.microWindow[prop] !== this.mainWindow[prop]\n    ) {\n      // è®°å½•å¾®åº”ç”¨è¿è¡ŒæœŸé—´ä¿®æ”¹æˆ–è€…æ–°å¢çš„å·®å¼‚å±æ€§ï¼ˆä¸‹ä¸€æ¬¡è¿è¡Œå¾®åº”ç”¨ä¹‹å‰å¯ç”¨äºæ¢å¤å¾®åº”ç”¨è¿™ä¸€æ¬¡è¿è¡Œçš„ window å±æ€§ï¼‰\n      this.diffPropsMap[prop] = this.microWindow[prop];\n      // æ¢å¤ä¸»åº”ç”¨çš„ window å±æ€§å€¼\n      window[prop] = this.mainWindow[prop];\n    }\n  }\n}\n```\n\nå¤§è‡´æµç¨‹å°±æ˜¯è®°å½•ä¸€ä¸‹ä¸åŸæ¥ window çš„å·®å¼‚ï¼Œç„¶åæ¢å¤åŸæ¥è®°å½•çš„ä¸»åº”ç”¨çš„ windowã€‚\n\næˆ‘ä»¬å°†ä¸Šé¢çš„è®¾è®¡æ€è·¯æ€»ç»“å¦‚ä¸‹ï¼š\n\n![image.png](/img/posts/2024-1-11/2024-1-11-2.png)\n\nå…¶ä½™ç±»çš„å®ç°ä¸ iframe éš”ç¦»ä¸€è‡´ï¼Œå¯ä»¥å‚è§ï¼š[iframe sandbox](/posts/monto-app-sandbox-webcomponents-iframe)\n\n## 5. å°ç»“\n\næœ¬éš”ç¦»æ–¹å¼å®é™…æ˜¯åŠ¨æ€ script çš„å˜ç§ï¼Œæ²¡æœ‰åˆ›å»º script æ ‡ç­¾ï¼Œè€Œæ˜¯ç›´æ¥åœ¨ window å¿«ç…§ä¸­æ‰§è¡Œå¾®åº”ç”¨çš„ jsï¼Œç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼š\n\n- ä¸èƒ½åŒæ—¶åŠ è½½å¤šä¸ªå­åº”ç”¨\n- æ— æ³•å¤„ç†ä¸»å­åº”ç”¨åŒæ—¶æ“ä½œ window äº§ç”Ÿå†²çªçš„é—®é¢˜"])</script><script>self.__next_f.push([1,"17:T386d,"])</script><script>self.__next_f.push([1,"æœ¬èŠ‚å¼€å§‹ï¼Œä»‹ç»å¾®å‰ç«¯ä¸­ js éš”ç¦»çš„æ–¹æ¡ˆã€‚\n\n## 1. iframeæ²™ç®±åŸç†\n\niframe ä¹‹æ‰€ä»¥æ”¯æŒ js éš”ç¦»ï¼Œæ˜¯å› ä¸ºåœ¨ V8 å¼•æ“é‡Œï¼Œæ¯ä¸€ä¸ª iframe éƒ½ç›¸å½“äºå¼€äº†ä¸€ä¸ªæ–°çš„ Isolate å¯¹è±¡ï¼Œæ‰€ä»¥å°±ç›¸å½“äºé—´æ¥ä½¿ç”¨äº† V8 éš”ç¦»ï¼Œä»–ä»¬æ˜¯ä¸åŒçš„ V8 ä¸Šä¸‹æ–‡ã€‚\n\næœ¬æ–‡ç»“åˆä¹‹å‰çš„ Web Components åŠ è½½æ–¹æ¡ˆå’Œ iframe å¤©ç„¶æ²™ç®±ï¼Œæ¥å®ç°ä¸€ä¸ªéš”ç¦»çš„æ–¹æ¡ˆã€‚ä½¿ç”¨ iframe çš„æœ€ä¸»è¦çš„é—®é¢˜å¦‚ä¸‹ï¼š\n\n- ä¸»å­è·¯ç”±ä¸ç»Ÿä¸€\n- å¼¹å‡ºå±‚ä¸ä¼šè‡ªåŠ¨å±…ä¸­\n- æ•°æ®çŠ¶æ€åŒæ­¥é—®é¢˜\n\næˆ‘ä»¬è¿™é‡Œå…ˆè§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå°†ä¸»åº”ç”¨çš„ history å¯¹è±¡ä»£ç†ä¸€ä¸‹ä¼ é€’ç»™å­åº”ç”¨ï¼š\n\n![image.png](/img/posts/2024-1-10/2024-1-10-1.png)\n\n[ä»“åº“åœ°å€ï¼šsandbox/web-components-proxy åˆ†æ”¯](https://github.com/heiheihoho1213/monto-app/tree/sandbox/web-components-proxy)\n\næˆ‘ä»¬å®ç°çš„æ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. æ”¹é€ å­åº”ç”¨å…¥å£ï¼Œå£°æ˜è‡ªå·±çš„å®šåˆ¶å…ƒç´ ä¿¡æ¯\n2. ä¸»åº”ç”¨å¯åŠ¨æ—¶ï¼Œè·å–å­åº”ç”¨ä¿¡æ¯\n3. åˆ›å»º iframe å…ƒç´ \n4. iframeä¸­å­åº”ç”¨æŒ‚è½½æ—¶ï¼Œå°†ä¸»åº”ç”¨çš„ window ä»£ç†åä¼ é€’ç»™å­åº”ç”¨\n5. å­åº”ç”¨å¼€å§‹æ¸²æŸ“ï¼Œæ‰§è¡Œè‡ªå·±çš„ jsï¼Œå¹¶æŒ‚è½½è‡ªå·±çš„å®šåˆ¶åŒ–å…ƒç´ \n6. å­åº”ç”¨å¸è½½æ—¶ï¼Œè®¾ç½® display ä¸º none å³å¯ï¼Œjs ä¸ç”¨åˆ é™¤\n\n#### æ”¹é€ å­åº”ç”¨\n\n```js\n// æµ‹è¯•ä»£ç ï¼šå…¨å±€å˜é‡çš„æ±¡æŸ“æƒ…å†µ\nthis.a = 'a';\nconsole.log('å¾®åº”ç”¨1 a: ', a);\n\nvar b = 'b';\nconsole.log('å¾®åº”ç”¨1 b: ', window.b);\n\nwindow.c = 'c';\nconsole.log('å¾®åº”ç”¨1 c: ', window.c);\n\nlet root = document.createElement(\"button\");\nroot.textContent = \"å¾®åº”ç”¨ 1 æ›´æ”¹ history ä¸º micro1\";\ndocument.body.appendChild(root);\n\nroot.onclick = () =\u003e {\n  // è¿™é‡Œæ¥è¯´æ˜ history ç”¨çš„æ˜¯ä¸»åº”ç”¨æ¥çš„ä»£ç†\n  history.pushState({}, '', '/micro1');\n}\n// endï¼šæµ‹è¯•ä»£ç \n\nclass MicroApp1Element extends HTMLElement {\n  constructor() {\n    super();\n  }\n\n  connectedCallback() {\n    console.log(`[micro-app-1]ï¼šæ‰§è¡Œ connectedCallback ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°`);\n    this.mount();\n  }\n\n  disconnectedCallback() {\n    console.log(`[micro-app-1]ï¼šæ‰§è¡Œ disconnectedCallback ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°`);\n    // å¸è½½å¤„ç†\n    this.unmount();\n  }\n\n  // [ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°] å½“ custom element å¢åŠ . åˆ é™¤. ä¿®æ”¹è‡ªèº«å±æ€§æ—¶ï¼Œè¢«è°ƒç”¨\n  attributeChangedCallback(attr, oldVal, newVal) {\n    console.log(\n      `[app:${this.name}]ï¼šæ‰§è¡Œ attributeChangedCallback ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°`\n    );\n    if (this[attr] !== newVal) {\n      this[attr] = newVal;\n      this.isConnected \u0026\u0026 this.mount();\n    }\n  }\n\n  mount() {\n    const $micro = document.createElement(\"h1\");\n    $micro.textContent = \"å¾®åº”ç”¨1\";\n    // å°†å¾®åº”ç”¨çš„å†…å®¹æŒ‚è½½åˆ°å½“å‰è‡ªå®šä¹‰å…ƒç´ ä¸‹\n    this.appendChild($micro);\n  }\n\n  unmount() {}\n}\n\nwindow.customElements.define(\"micro-app-1\", MicroApp1Element);\n```\n\nåœ¨å­åº”ç”¨é‡Œå®šä¹‰äº† Web Components çš„å…ƒç´ å£°æ˜ï¼Œå…¶æ“ä½œçš„ document ç­‰å¯¹è±¡ï¼Œéƒ½æ˜¯ç›¸å¯¹äºè‡ªå·±çš„ iframe å†…éƒ¨è€Œè¨€çš„ã€‚\n\n#### ä¸»åº”ç”¨é…ç½®å­åº”ç”¨åˆ—è¡¨ä¿¡æ¯\n\né¦–å…ˆå¯åŠ¨æœåŠ¡å™¨ï¼š\n\n```html\n\u003c!-- ä¸»åº”ç”¨å¯¼èˆª --\u003e\n\u003cdiv id=\"nav\"\u003e\u003c/div\u003e\n\n\u003c!-- ä¸»åº”ç”¨å†…å®¹åŒº --\u003e\n\u003cdiv id=\"container\"\u003e\u003c/div\u003e\n```\n\n```js\napp.use(express.static(path.join(\"public\", \"main\")));\n// ...\napp.listen(port.main, host);\n```\n\né…ç½®è¯·æ±‚æ¥å£ï¼ˆå­åº”ç”¨å„è‡ªçš„nodeæœåŠ¡éœ€è¦é…ç½®è·¨åŸŸï¼Œè¿™é‡Œç•¥å»ï¼‰ï¼š\n\n```js\napp.post(\"/microapps\", function (req, res) {\n  res.json([\n    {\n      name: \"micro1\",\n      id: \"micro1\",\n      // è‡ªå®šä¹‰å…ƒç´ åç§°\n      customElement: \"micro-app-1\",\n      // è¿™é‡Œæš‚æ—¶ä»¥ä¸€ä¸ªå…¥å£æ–‡ä»¶ä¸ºç¤ºä¾‹\n      script: `http://${host}:${port.micro}/micro1.js`,\n      style: `http://${host}:${port.micro}/micro1.css`,\n      prefetch: true,\n    },\n    {\n      name: \"micro2\",\n      id: \"micro2\",\n      customElement: \"micro-app-2\",\n      script: `http://${host}:${port.micro}/micro2.js`,\n      style: `http://${host}:${port.micro}/micro2.css`,\n      prefetch: true,\n    },\n  ]);\n});\n```\n\n#### åˆ›å»º iframe\n\næˆ‘ä»¬å£°æ˜ä¸€ä¸ª IframeSandbox ç±»:\n\n```js\n// IframeSandbox\nconstructor(options) {\n  this.options = options;\n  // åˆ›å»º iframe æ—¶æµè§ˆå™¨ä¼šåˆ›å»ºæ–°çš„å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œç”¨äºéš”ç¦»ä¸»åº”ç”¨çš„å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡\n  this.iframe = this.createIframe();\n  this.iframeWindow = this.iframe.contentWindow;\n  // æ‰§è¡Œ history ä»£ç†\n  this.proxyIframeWindow();\n}\n```\n\nåœ¨å­åº”ç”¨æ¿€æ´»æ—¶å¯ä»¥è¿™ä¹ˆå†™ï¼š\n\n```js\nnew IframeSandbox({\n  rootElm: this.rootElm,  // æŒ‚è½½åº”ç”¨çš„æ ¹èŠ‚ç‚¹ï¼Œè¿™é‡Œæ˜¯ #container\n  scriptText: this.scriptText,\n  url: this.app.script,\n  id: this.app.id,\n  customElement: this.app.customElement\n});\n```\n\nåœ¨ IframeSandbox ç±»é‡Œï¼Œæˆ‘ä»¬å¼€å§‹æ„é€ ä¸€ä¸ªå±€éƒ¨çš„ js sandboxã€‚\n\né¦–å…ˆï¼Œä½¿ç”¨ src = about:blank çš„ iframe å¯ä»¥ä¿è¯å…¶ä¸ä¸»åº”ç”¨åŒæºï¼š\n\n```js\n// IframeSandbox\ncreateIframe() {\n  const { rootElm, id, url } = this.options;\n  const iframe = window.document.createElement(\"iframe\");\n  const attrs = {\n    src: \"about:blank\",\n    \"app-id\": id,\n    \"app-src\": url,\n    style: \"border:none;width:100%;height:100%;\",\n  };\n  Object.keys(attrs).forEach((name) =\u003e {\n    iframe.setAttribute(name, attrs[name]);\n  });\n  rootElm?.appendChild(iframe);\n  return iframe;\n}\n```\n\u003e app-src æ˜¯ä¸€ç§å®‰å…¨ç­–ç•¥ï¼ŒæŒ‡å®šäº†åªæœ‰å­åº”ç”¨è‡ªå·±çš„ url çš„èµ„æºå¯ä»¥è¢«åŠ è½½\n\n#### åš history ä»£ç†\n\nç”±äº history æ˜¯åœ¨ window ä¸‹çš„ï¼Œdocument ä¹Ÿæ˜¯åœ¨ window ä¸‹çš„ï¼Œæˆ‘ä»¬å¹²è„†ç›´æ¥ä»£ç†ä¸»åº”ç”¨çš„ window å¯¹è±¡ï¼š\n\n```js\n// IframeSandboxï¼Œåœ¨ä¸»åº”ç”¨ä¸­æ‰§è¡Œçš„\nproxyIframeWindow() {\n  this.iframeWindow.proxy = new Proxy(this.iframeWindow, {\n    get: (target, prop) =\u003e {\n      // åªæ˜¯ç®€å•çš„ä»£ç†ï¼Œä¸»å­åº”ç”¨è·¯ç”±å†²çªæ²¡æœ‰è§£å†³\n      // æ€è€ƒï¼šä¸ºäº†é˜²æ­¢ URL å†²çªé—®é¢˜ï¼Œæ˜¯å¦ä¹Ÿå¯ä»¥å½¢æˆè®¾è®¡è§„èŒƒï¼Œæ¯”å¦‚ä¸»åº”ç”¨é‡‡ç”¨ History è·¯ç”±ï¼Œå­åº”ç”¨é‡‡ç”¨ Hash è·¯ç”±ï¼Œä»è€Œç¡®ä¿ä¸»å­åº”ç”¨çš„è·¯ç”±ä¸ä¼šäº§ç”Ÿå†²çªçš„é—®é¢˜\n      if (prop === \"history\" || prop === \"location\" || prop === \"document\") {\n        // ä½¿ç”¨ä¸»åº”ç”¨ window\n        return window[prop];\n      }\n\n      if (prop === \"window\" || prop === \"self\") {\n        return this.iframeWindow.proxy;\n      }\n\n      // prop æ˜¯ä¿®æ­£è¿‡çš„æŒ‡å‘\n      return this.getTargetValue(target, prop);\n    },\n\n    set: (target, prop, value) =\u003e {\n      target[prop] = value;\n      return true;\n    },\n\n    has: (target, prop) =\u003e !!target[prop],\n  });\n}\n```\næ­¤æ—¶ï¼ŒåŸç”Ÿçš„ä¸€äº› API ä¼šæœ‰é—®é¢˜ï¼Œæ¯”å¦‚ window.alert å†…éƒ¨çš„ this ä¸æ˜¯æŒ‡å‘ iframe çš„ windowï¼Œè€Œæ˜¯æŒ‡å‘è¢«ä»£ç†åçš„ proxyï¼Œå› æ­¤åœ¨è°ƒç”¨ alert ç­‰åŸç”Ÿå‡½æ•°ä¼šæŠ¥é”™ Illegal invocationã€‚\nåŒç±»å‹çš„æ–¹æ³•è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ addEventListener. atob ç­‰ã€‚\n\nè¿™é‡Œçš„ getTargetValueï¼Œç”¨äºé‡æ–°å°†è¿™äº›åŸç”Ÿ native api çš„ this ä¿®æ­£ä¸º iframe çš„ windowã€‚\n\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ç°ï¼š\n\n```js\ngetTargetValue(target, prop) {\n  const value = target[prop];\n\n  // è¿‡æ»¤å‡º window.alert. window.addEventListener ç­‰ API\n  if (\n    typeof value === \"function\" \u0026\u0026\n    !this.isBoundedFunction(value) \u0026\u0026  // æ˜¯ç›´æ¥å®šä¹‰çš„ functionï¼Œä¸æ˜¯ bind çš„å‡½æ•°ï¼Œå› ä¸º å¦‚æœå‡½æ•°å·²ç»è¿›è¡Œäº† bindï¼Œé‚£ä¹ˆä¸åº”è¯¥è¿›è¡Œå†æ¬¡çš„ç»‘å®šæ“ä½œ\n    !this.isConstructable(value) // è¿‡æ»¤æ‰æ„é€ å‡½æ•°ï¼šä¾‹å¦‚åŸç”Ÿçš„ Object. Array ä»¥åŠç”¨æˆ·è‡ªå·±åˆ›å»ºçš„æ„é€ å‡½æ•°ç­‰ã€‚ä¸€äº›æ„é€ å‡½æ•°ä¸éœ€è¦è¿›è¡Œ bind æ“ä½œï¼Œå› ä¸º bind ç”Ÿæˆçš„å‡½æ•°ä¼šå¤±å»åŸæœ‰å‡½æ•°çš„å±æ€§å’Œ prototype\n  ) {\n    console.log('ä¿®æ­£ this: ', prop);\n\n    // ä¿®æ­£ value çš„ this æŒ‡å‘ä¸º target\n    const boundValue = Function.prototype.bind.call(value, target);\n    // é‡æ–°æ¢å¤ value åœ¨ bound ä¹‹å‰çš„å±æ€§å’ŒåŸå‹ï¼ˆbind ä¹‹åä¼šä¸¢å¤±ï¼‰\n    for (const key in value) {\n      boundValue[key] = value[key];\n    }\n    // å¦‚æœåŸæ¥çš„å‡½æ•°å­˜åœ¨ prototype å±æ€§ï¼Œè€Œ bound ä¹‹åä¸¢å¤±äº†ï¼Œé‚£ä¹ˆé‡æ–°è®¾ç½®å›æ¥\n    if (\n      value.hasOwnProperty(\"prototype\") \u0026\u0026\n      !boundValue.hasOwnProperty(\"prototype\")\n    ) {\n      boundValue.prototype = value.prototye;\n    }\n    return boundValue;\n  }\n  return value;\n}\n```\n\nå…¶ä¸­ä¸¤ä¸ªåˆ¤æ–­å‡½æ•°å¦‚ä¸‹ï¼š\n\n```js\nisBoundedFunction(fn) {\n  return (\n    // åœ¨ES6åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œæ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ª name å±æ€§, å¦‚æœå‡½æ•°æ˜¯é€šè¿‡ function å…³é”®å­—å®šä¹‰çš„ï¼Œé‚£ä¹ˆå®ƒçš„ name å±æ€§å€¼å°±æ˜¯è¿™ä¸ªå‡½æ•°åã€‚ä½†å¦‚æœå‡½æ•°æ˜¯é€šè¿‡å…¶ä»–æ–¹å¼ï¼ˆä¾‹å¦‚ä½¿ç”¨ Function æ„é€ å‡½æ•°æˆ– Function.prototype.bind æ–¹æ³•ï¼‰åˆ›å»ºçš„ï¼Œé‚£ä¹ˆå®ƒçš„ name å±æ€§å€¼å¯èƒ½ä¼šè¢«ä¿®æ”¹æˆ–æ·»åŠ å‰ç¼€ (æ¯”å¦‚ bound)\n    // ä¾‹å­ï¼š\n    /**\n      let obj = {  \n        x: 10,  \n        getX: function() {  \n          return this.x;  \n        }  \n      };\n        \n      let getXBoundToObj = obj.getX.bind(obj);  \n      console.log(getXBoundToObj.name); // è¾“å‡º bound getX\n    */\n    \n    // è¢«ç»‘å®šçš„å‡½æ•°æœ¬èº«æ²¡æœ‰ prototype\n    fn.name.indexOf(\"bound \") === 0 \u0026\u0026 !fn.hasOwnProperty(\"prototype\")\n  );\n}\n\nisConstructable(fn) {\n  // å¯ä»¥è¯†åˆ« Object. Array ç­‰åŸç”Ÿæ„é€ å‡½æ•°ï¼Œä¹Ÿå¯ä»¥è¯†åˆ«ç”¨æˆ·è‡ªå·±åˆ›å»ºçš„æ„é€ å‡½æ•°\n  return (\n    fn.prototype \u0026\u0026\n    // é€šå¸¸æƒ…å†µä¸‹æ„é€ å‡½æ•°å’Œç±»çš„ prototype.constructor æŒ‡å‘æœ¬èº«\n    fn.prototype.constructor === fn \u0026\u0026\n    // é€šå¸¸æƒ…å†µä¸‹æ„é€ å‡½æ•°å’Œç±»éƒ½ä¼šå­˜åœ¨ prototype.constructorï¼Œå› æ­¤é•¿åº¦å¤§äºç­‰æ–¼ 1\n    // éœ€è¦æ³¨æ„æ™®é€šå‡½æ•°ä¸­ä¹Ÿä¼šå­˜åœ¨ prototype.constructorï¼Œ\n    // å› æ­¤å¦‚æœ prototypeä¸Š æœ‰è‡ªå®šä¹‰å±æ€§æˆ–è€…æ–¹æ³•ï¼Œé‚£ä¹ˆå¯ä»¥åˆ¤å®šä¸ºç±»æˆ–è€…æ„é€ å‡½æ•°ï¼Œå› æ­¤è¿™é‡Œçš„åˆ¤æ–­æ˜¯å¤§äº 1\n    // è‡ªå»ºå‡½æ•°ï¼Œæ¯”å¦‚function Person {}; ï¼ŒåŸå‹é“¾ä¸Šæ²¡æœ‰æ–¹æ³•çš„ class è¯†åˆ«. function Person() {} è¯†åˆ«ç­‰ï¼Œå…¶é•¿åº¦ = 1\n    // æ³¨æ„ä¸è¦ä½¿ç”¨ Object.keys è¿›è¡Œåˆ¤æ–­ï¼ŒObject.keys æ— æ³•è·å– Object.defineProperty å®šä¹‰çš„å±æ€§\n    (Object.getOwnPropertyNames(fn.prototype).length \u003e 1\n      || (Object.getOwnPropertyNames(fn.prototype).length === 1 \u0026\u0026 Object.getOwnPropertyNames(fn.prototype)[0] === 'constructor'))\n  );\n  // TODO: æ²¡æœ‰ constructor çš„æ„é€ å‡½æ•°è¯†åˆ«\n  // ä¾‹å¦‚ Person.prototype = {}; æ­¤æ—¶æ²¡æœ‰ prototype.constructor å±æ€§\n}\n```\n\n\n#### æ¿€æ´»ä¸å¤±æ´»å‡½æ•°\n\næ¥ä¸‹æ¥åœ¨sandboxä¸­å®šä¹‰ä¸€ä¸‹æ¿€æ´»å­åº”ç”¨çš„å‡½æ•°ï¼š\n\n```js\n// IframeSandbox\nasync active() {\n  this.iframe.style.display = \"block\";\n  // å¦‚æœå·²ç»é€šè¿‡ Script åŠ è½½å¹¶æ‰§è¡Œè¿‡ JSï¼Œåˆ™æ— éœ€é‡æ–°åŠ è½½å¤„ç†\n  if (this.execScriptFlag) return;\n  this.execScript();\n  this.mount();\n  this.execScriptFlag = true;\n}\n```\n\nå…¶ä¸­æ ¸å¿ƒçš„æ‰§è¡Œä»£ç å’ŒæŒ‚è½½å‡½æ•°å¦‚ä¸‹ï¼š\n\n```js\nexecScript() {\n  const scriptElement =\n    this.iframeWindow.document.createElement(\"script\");\n  // ä½¿ç”¨åŒ¿åæ‰§è¡Œæ˜¯ä¸ºäº†ä¿è¯jsä½œç”¨åŸŸä¸ä¼šå¤–æ³„ï¼Œå¹¶ä¸”ä¾¿äºä½¿ç”¨ä»£ç†\n  scriptElement.textContent = `\n      (function(window) {\n        with(window) {\n          ${this.options.scriptText}\n        }\n      }).bind(window.proxy)(window.proxy);\n      `;\n  this.iframeWindow.document.head.appendChild(scriptElement);\n}\n\nmount() {\n  if (!this.$webcomponent) {\n    const $slot = this.iframeWindow.document.body;\n    // åˆ›å»ºç»„ä»¶å…ƒç´ \n    this.$webcomponent = this.iframeWindow.document.createElement(\n      this.options.customElement\n    );\n    this.$webcomponent.setAttribute(\"micro-id\", this.options.id);\n    $slot.appendChild(this.$webcomponent);\n  }\n}\n```\nä¸Šé¢çš„å‡½æ•°ä¸­ï¼Œwith è¯­å¥ç”¨äºå°†å½¢å‚windowçš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•æ·»åŠ åˆ°è‡ªå·±çš„ä½œç”¨åŸŸä¸­ï¼Œå…¶è®¾è®¡çš„æœ¬æ„ç”¨äºç¼©çŸ­æŸ¥æ‰¾ä½œç”¨åŸŸé“¾ã€‚\n\nå¤±æ´»æ¯”è¾ƒç®€å•ï¼š\n\n```js\ninactive() {\n  this.iframe.style.display = \"none\";\n}\n```\n\næ­¤å¤–è¿˜æœ‰æ²™ç®±æœ¬èº«çš„é”€æ¯å‡½æ•°ï¼Œè¿™é‡Œä¹Ÿæä¸€ä¸‹ï¼š\n\n```js\n// IframeSandbox é”€æ¯æ²™ç®±\ndestroy() {\n  this.options = null;\n  this.exec = false;\n  if (this.iframe) {\n    this.iframe.parentNode?.removeChild(this.iframe);\n  }\n  this.iframe = null;\n}\n```\n\nåˆ°è¿™é‡Œï¼Œæ²™ç®±çš„è®¾è®¡åŸºæœ¬å®Œæˆï¼\n\næ¥ä¸‹æ¥æˆ‘ä»¬æŒ‰ç…§åŠ è½½é¡ºåºï¼Œé¦–å…ˆåˆå§‹åŒ–ä¸»åº”ç”¨ï¼Œè·å–å¾®åº”ç”¨åˆ—è¡¨ï¼š\n\n```js\nasync init() {\n  this.microApps = await this.fetchMicroApps();\n  this.createNav();\n  this.navClickListener();\n  this.hashChangeListener();\n  // åˆ›å»ºå¾®å‰ç«¯ç®¡ç†å®ä¾‹\n  this.microManager = new MicroManager(\n    document.getElementById(\"container\"),\n    this.microApps\n  );\n}\n\n// ä»ä¸»åº”ç”¨æœåŠ¡å™¨è·è¯·æ±‚å¾®åº”ç”¨åˆ—è¡¨ä¿¡æ¯\nasync fetchMicroApps() {\n  try {\n    const res = await window.fetch(\"/microapps\", {\n      method: \"post\",\n    });\n    return await res.json();\n  } catch (err) {\n    console.error(err);\n  }\n}\n\n...\n// åˆ›å»º nav å¯¼èˆªçš„ä»£ç ä¸æ˜¯æ ¸å¿ƒï¼Œç•¥å»\n// hash è·¯ç”±å˜åŒ–çš„ç›‘å¬äº‹ä»¶\nhashChangeListener() {\n  // ç›‘å¬ Hash è·¯ç”±çš„å˜åŒ–ï¼Œåˆ‡æ¢å¾®åº”ç”¨ï¼ˆè¿™é‡Œè®¾å®šä¸€ä¸ªæ—¶åˆ»åªèƒ½åˆ‡æ¢ä¸€ä¸ªå¾®åº”ç”¨ï¼‰\n  window.addEventListener(\"hashchange\", () =\u003e {\n    this.microApps?.forEach(async ({ id }) =\u003e {\n      id === window.location.hash.replace(\"#\", \"\")\n        ? this.microManager.activeApp(id)\n        : this.microManager.inactiveApp(id);\n    });\n  });\n}\n```\n\nä¸Šé¢ä»£ç æåˆ°ä¸€ä¸ª MicroManager ç±»ï¼Œç”¨äºç®¡ç†å¾®å‰ç«¯åº”ç”¨çš„æ¿€æ´»å’Œé”€æ¯ï¼š\n\n```js\nappsMap = new Map();\n\n// æ”¾å…¥å…¨éƒ¨çš„å¾®åº”ç”¨åˆ°ä¸€ä¸ªmap\nsetAppMaps(apps) {\n  apps.forEach((app) =\u003e {\n    this.appsMap.set(app.id, new MicroAppManager(this.rootElm, app));\n  });\n}\n\n// æ¿€æ´»å¾®åº”ç”¨\nactiveApp(id) {\n  const current = this.appsMap.get(id);\n  current \u0026\u0026 current.active();\n}\n\n// å¤±æ´»å¾®åº”ç”¨\ninactiveApp(id) {\n  const current = this.appsMap.get(id);\n  current \u0026\u0026 current.inactive();\n}\n```\n\nä¸ºäº†ä¾¿äºç†è§£ï¼Œä¸Šé¢åˆå•ç‹¬å°è£…äº†ä¸€ä¸ª MicroAppManager ç±»ï¼Œç”¨äºç›´æ¥æ“ä½œæ²™ç®±ï¼š\n\n```js\n// è·å– JS æ–‡æœ¬ï¼ˆå¾®åº”ç”¨æœåŠ¡éœ€è¦æ”¯æŒè·¨åŸŸè¯·æ±‚ï¼‰\nasync fetchScript(src) {\n  try {\n    const res = await window.fetch(src);\n    return await res.text();\n  } catch (err) {\n    console.error(err);\n  }\n}\n\n// æ¿€æ´»\nasync active() {\n  // ç¼“å­˜èµ„æºå¤„ç†\n  if (!this.scriptText) {\n    this.scriptText = await this.fetchScript(this.app.script);\n  }\n\n  // å¦‚æœæ²¡æœ‰åˆ›å»ºæ²™ç®±ï¼Œåˆ™å®æ—¶åˆ›å»º\n  // éœ€è¦æ³¨æ„åªç»™æ¿€æ´»çš„å¾®åº”ç”¨åˆ›å»º iframe æ²™ç®±ï¼Œå› ä¸ºåˆ›å»º iframe ä¼šäº§ç”Ÿå†…å­˜æŸè€—\n  if (!this.sandbox) {\n    this.sandbox = new IframeSandbox({\n      rootElm: this.rootElm,\n      scriptText: this.scriptText,\n      url: this.app.script,\n      id: this.app.id,\n      customElement: this.app.customElement\n    });\n  }\n\n  this.sandbox.active();\n}\n\n// å¤±æ´»\ninactive() {\n  this.sandbox?.inactive();\n}\n```\n\n## 2. demo æµ‹è¯•\n\n![image.png](/img/posts/2024-1-10/2024-1-10-2.png)\n\n## 3. å®æˆ˜æµ‹è¯•\n\n#### é€‚é… Vue"])</script><script>self.__next_f.push([1,"18:T1dba,"])</script><script>self.__next_f.push([1,"æœ¬èŠ‚ç»§ç»­ä»‹ç»å¾®å‰ç«¯çš„å¦ä¸€ç§æ–¹æ¡ˆï¼šåŠ¨æ€ scriptã€‚é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†å½“å‰çš„å¾®åº”ç”¨æ‰“åŒ…åï¼Œå°†å…¥å£çš„ js æ–‡ä»¶é€šè¿‡ script åŠ è½½è¿›ä¸»åº”ç”¨ï¼Œä»è€Œè¾¾åˆ°å¾®å‰ç«¯çš„æ•ˆæœã€‚ä»–å¯èƒ½æ˜¯ç›®å‰å®ç°èµ·æ¥æœ€ç®€å•çš„ä¸€ç§æ–¹æ¡ˆã€‚\n\n![image.png](/img/posts/2024-1-8/2024-1-8-3.png)\n\n[ä»“åº“åœ°å€ï¼štutorial/dynamic-script åˆ†æ”¯](https://github.com/heiheihoho1213/monto-app/tree/tutorial/dynamic-script)\n\n## 1. ä¸»åº”ç”¨\n\næˆ‘ä»¬ç”¨ node å¯åŠ¨ä¸€ä¸ªä¸»åº”ç”¨:\n\n```js\napp.listen(port.main, host);\n```\n\nå¹¶åœ¨ä¸»åº”ç”¨é‡Œå†™å…¥æ¥å£è¯·æ±‚ï¼š\n\n```js\napp.post(\"/microapps\", function (req, res) {\n  // è¿™é‡Œå¯ä»¥æ˜¯ç®¡ç†åå°æ–°å¢èœå•åå­˜å‚¨åˆ°æ•°æ®åº“çš„æ•°æ®\n  // ä»è€Œå¯ä»¥é€šè¿‡ç®¡ç†åå°åŠ¨æ€é…ç½®å¾®åº”ç”¨çš„èœå•\n  res.json([\n    {\n      name: \"micro1\",\n      id: \"micro1\",\n      // è¿™é‡Œæš‚æ—¶ä»¥ä¸€ä¸ªå…¥å£æ–‡ä»¶ä¸ºç¤ºä¾‹\n      script: `http://${host}:${port.micro}/micro1.js`,\n      style: `http://${host}:${port.micro}/micro1.css`,\n      // æŒ‚è½½åˆ° window ä¸Šçš„å¯åŠ¨å‡½æ•° window.micro1_mount\n      mount: \"micro1_mount\",\n      // æŒ‚è½½åˆ° window ä¸Šçš„å¯åŠ¨å‡½æ•° window.micro1_unmount\n      unmount: \"micro1_unmount\",\n      prefetch: true,\n    },\n    {\n      name: \"micro2\",\n      id: \"micro2\",\n      script: `http://${host}:${port.micro}/micro2.js`,\n      style: `http://${host}:${port.micro}/micro2.css`,\n      mount: \"micro2_mount\",\n      unmount: \"micro2_unmount\",\n      prefetch: true,\n    },\n  ]);\n});\n```\n\nä¸Šé¢é…ç½®çš„è¿™ä¸¤ä¸ªå­åº”ç”¨ï¼Œè‡ªå·±å„è‡ªå•ç‹¬åœ¨è‡ªå·±ç«¯å£å¯åŠ¨å³å¯ã€‚ï¼ˆè¿™é‡Œå…¬ç”¨äº†ä¸€ä¸ªå­åº”ç”¨ç«¯å£ï¼Œå®é™…æƒ…å†µå¯èƒ½å­åº”ç”¨ç«¯å£ä¸ä¸€æ ·ï¼‰\n\n\nç„¶åé…ç½®ä¸»åº”ç”¨çš„ htmlï¼Œå¹¶é…ç½®åŠ è½½åŠŸèƒ½ï¼š\n\n```html\n\u003cdiv class=\"container\"\u003e\n  \u003c!-- å¾®åº”ç”¨æ¸²æŸ“çš„æ’æ§½ --\u003e\n  \u003cdiv id=\"micro-app-slot\"\u003e\u003c/div\u003e\n\u003c/div\u003e\n```\n\n```js\nloadScript({ script, id }) {\n  return new Promise((resolve, reject) =\u003e {\n    const $script = document.createElement(\"script\");\n    $script.src = script;\n    $script.setAttribute(\"micro-script\", id);\n    $script.onload = resolve;\n    $script.onerror = reject;\n    document.body.appendChild($script);\n  });\n}\n\nloadStyle({ style, id }) {\n  return new Promise((resolve, reject) =\u003e {\n    const $style = document.createElement(\"link\");\n    $style.href = style;\n    $style.setAttribute(\"micro-style\", id);\n    $style.rel = \"stylesheet\";\n    $style.onload = resolve;\n    $style.onerror = reject;\n    document.head.appendChild($style);\n  });\n}\n\nremoveStyle({ id }) {\n  const $style = document.querySelector(`[micro-style=${id}]`);\n  $style \u0026\u0026 $style?.parentNode?.removeChild($style);\n}\n\nhasLoadScript({ id }) {\n  const $script = document.querySelector(`[micro-script=${id}]`);\n  return !!$script;\n}\n\nhasLoadStyle({ id }) {\n  const $style = document.querySelector(`[micro-style=${id}]`);\n  return !!$style;\n}\n```\n\nä¸»åº”ç”¨åˆå§‹åŒ–ï¼š\n\n```js\ninit() {\n  this.processMicroApps();\n  this.navClickListener();\n  this.hashChangeListener();\n}\n\nprocessMicroApps() {\n  this.getMicroApps().then((res) =\u003e {\n    this.microApps = res;\n    this.prefetchMicroAppStatic();\n    this.createMicroAppNav();\n  });\n}\n\nprefetchMicroAppStatic() {\n  const prefetchMicroApps = this.microApps?.filter(\n    (microapp) =\u003e microapp.prefetch\n  );\n  prefetchMicroApps?.forEach((microApp) =\u003e {\n    microApp.script \u0026\u0026 this.prefetchStatic(microApp.script, \"script\");\n    microApp.style \u0026\u0026 this.prefetchStatic(microApp.style, \"style\");\n  });\n}\n\ncreateMicroAppNav(microApps) {\n  const fragment = new DocumentFragment();\n  this.microApps?.forEach((microApp) =\u003e {\n    // TODO: APP æ•°æ®è§„èŒƒæ£€æµ‹ (ä¾‹å¦‚æ˜¯å¦æœ‰ script. mount. unmount ç­‰ï¼‰\n    const button = document.createElement(\"button\");\n    button.textContent = microApp.name;\n    button.id = microApp.id;\n    fragment.appendChild(button);\n  });\n  nav.appendChild(fragment);\n}\n```\n\nå…¶ä¸­ getMicroApps æ˜¯æœåŠ¡è·å–å¾®åº”ç”¨åˆ—è¡¨ä¿¡æ¯ï¼Œä¸»åº”ç”¨å§‘ä¸”ä½¿ç”¨ hashchange é…ç½®è·¯ç”±æ£€æµ‹ï¼š\n\n```js\nhashChangeListener() {\n  // ç›‘å¬ Hash è·¯ç”±çš„å˜åŒ–ï¼Œåˆ‡æ¢å¾®åº”ç”¨\n  // è¿™é‡Œè®¾å®šä¸€ä¸ªæ—¶åˆ»é¡µé¢ä¸Šåªæœ‰ä¸€ä¸ªå¾®åº”ç”¨\n  window.addEventListener(\"hashchange\", () =\u003e {\n    this.microApps?.forEach(async (microApp) =\u003e {\n      // åŒ¹é…éœ€è¦æ¿€æ´»çš„å¾®åº”ç”¨\n      if (microApp.id === window.location.hash.replace(\"#\", \"\")) {\n        console.time(`fetch microapp ${microApp.name} static`);\n        // åŠ è½½ CSS æ ·å¼\n        microApp?.style \u0026\u0026\n          !this.hasLoadStyle(microApp) \u0026\u0026\n          (await this.loadStyle(microApp));\n        // åŠ è½½ Script æ ‡ç­¾\n        microApp?.script \u0026\u0026\n          !this.hasLoadScript(microApp) \u0026\u0026\n          (await this.loadScript(microApp));\n        console.timeEnd(`fetch microapp ${microApp.name} static`);\n        window?.[microApp.mount]?.(\"#micro-app-slot\");\n        // å¦‚æœå­˜åœ¨å¸è½½ API åˆ™è¿›è¡Œåº”ç”¨å¸è½½å¤„ç†\n      } else {\n        this.removeStyle(microApp);\n        window?.[microApp.unmount]?.();\n      }\n    });\n  });\n}\n```\n\n\u003e è¿™é‡Œåœ¨å­åº”ç”¨å¸è½½æ—¶æ²¡æœ‰ç§»é™¤ jsï¼Œæ˜¯å› ä¸ºé‡æ–°åŠ è½½æ—¶é¡¶çº§ä½œç”¨åŸŸä¼šè¢«é‡æ–°æ‰§è¡Œï¼Œæ¯”å¦‚ let a = 1; è¿™æ ·åå¤å£°æ˜ä¼šæŠ¥é”™ã€‚\n\u003e åŒæ—¶ï¼Œä¸å†™ removeScriptï¼Œjs åœ¨ `window` ä¸ŠæŒ‚è½½äº†å­åº”ç”¨çš„ `mount` å’Œ `unmount` æ–¹æ³•ä¹Ÿä¸ä¼šé€ æˆæ±¡æŸ“ï¼Œæ²¡å¿…è¦åˆ é™¤ã€‚\n\n## 2. å­åº”ç”¨æ”¹é€ \n\nå½“ç„¶ï¼Œå„ä¸ªå­åº”ç”¨å…¥å£æ–‡ä»¶è¦æ”¹é€ ï¼Œæš´éœ²é’©å­å‡½æ•°ï¼š\n\n```js\n// micro1.js\n// ç«‹å³æ‰§è¡Œçš„åŒ¿åå‡½æ•°å¯ä»¥é˜²æ­¢å˜é‡ root äº§ç”Ÿå†²çª\n(function () {\n  let root;\n\n  // è¦ä¿è¯å„ä¸ªå­åº”ç”¨åç§°ä¸ä¸€æ ·\n  window.micro1_mount = function (slot) {\n    // ä»¥ä¸‹å…¶å®å¯ä»¥æ˜¯ React æ¡†æ¶æˆ–è€… Vue æ¡†æ¶ç”Ÿæˆçš„ Document å…ƒç´ ï¼Œè¿™é‡Œåªæ˜¯åšä¸€ä¸ªç®€å•çš„ç¤ºä¾‹\n    root = document.createElement(\"h1\");\n    root.textContent = \"å¾®åº”ç”¨1\";\n    // åœ¨å¾®åº”ç”¨æ’æ§½ä¸ŠæŒ‚è½½ DOM å…ƒç´ \n    const $slot = document.querySelector(slot);\n    $slot?.appendChild(root);\n  };\n\n  window.micro1_unmount = function () {\n    if (!root) return;\n    root.parentNode?.removeChild(root);\n  };\n})();\n\n\n// micro1.css\nh1 {\n  color: green;\n}\n```\n\nåŒæ—¶å­åº”ç”¨ä¹Ÿè¦å¯åŠ¨èµ·æ¥ï¼š\n\n```js\napp.listen(port.micro, host);\n```\nè¿™æ ·ï¼Œscript æ ‡ç­¾çš„ src æ‰èƒ½å¤Ÿå»æ‰¾åˆ°æœåŠ¡å™¨ä¸Šå­åº”ç”¨çš„ js å…¥å£æ–‡ä»¶ã€‚\n\n\u003e æœ¬æ–‡ç”¨äº†hashè·¯ç”±é…ç½®åˆ‡æ¢ï¼Œæœ¬èº«æœ‰è®¾è®¡ç¼ºé™·ï¼Œå®æˆ˜ä¸­éœ€è¦è‡ªå·±è®¾ç½®æ›´å®Œå–„çš„è·¯ç”±æ–¹æ¡ˆã€‚\n\nåŸºäºä»¥ä¸Šæè¿°ï¼Œå…¶å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š\n\n- ä¸»åº”ç”¨å¯ä»¥åŠ¨æ€å¢å‡. æ›´æ–°å­åº”ç”¨çš„æ•°é‡ï¼Œå®ç°åŠ¨æ€éƒ¨ç½²ã€‚\n- å¾®åº”ç”¨å¯ä»¥å¦‚æ­£å¸¸åº”ç”¨ä¸€æ ·è¿›è¡Œä¼˜åŒ–ï¼Œå¦‚ä»£ç åˆ†å‰²ï¼Œé™æ€èµ„æºåˆ†ç¦»ï¼ŒCDNåŠ é€Ÿç­‰ã€‚\n- ä¸éœ€è¦å¦‚NPMåº“ä¸€æ ·ï¼Œé…ç½®é¢å¤–çš„é…ç½®æ–‡ä»¶ä½¿å…¶æ‰“åŒ…æˆä¾èµ–åº“ã€‚\n- ä¸»å­åº”ç”¨å¤©ç„¶åŒåŸŸï¼ˆé™¤äº†åŠ è½½jsæ—¶è¦è·¨åŸŸï¼‰\n\nå…¶é—®é¢˜ä¹Ÿæ˜¯ä¸npmæ–¹æ¡ˆä¸€æ ·ï¼š\n\n- ä¸»åº”ç”¨ä¸å¾®åº”ç”¨çš„å…¨å±€å˜é‡. CSSæ ·å¼. æœ¬åœ°å­˜å‚¨çš„æ•°æ®æ— æ³•åšåˆ°å¾ˆå¥½çš„éš”ç¦»ã€‚\n- å­åº”ç”¨éœ€è¦æ”¹é€ é€‚é…ï¼ŒåŒ NPM æ–¹æ¡ˆä¸€æ ·æ²¡åŠæ³•å®Œå…¨è§£è€¦åˆã€‚\n\nä¸ NPM æ–¹æ¡ˆå·®å¼‚ï¼š\n\n- æœ¬æ–¹æ¡ˆä¸ç”¨å»é™¤ script\n- æœ¬æ–¹æ¡ˆçš„ script å¯ä»¥åš chunkï¼Œè€ŒNPMæ–¹æ¡ˆåªèƒ½åšåˆ° Tree Shakingã€‚åŠ¨æ€ script åˆ†æˆäº†å¤šæ®µ chunkï¼Œä½“ç§¯æ›´å°‘äº†ï¼Œè€Œ NPM åˆ™æ˜¯å…¨é‡æ„å»ºåˆ°åŒ…é‡Œçš„ ï¼ˆä½¿ç”¨ require è‡ªåŠ¨å¼•å…¥å…¨éƒ¨åŒ…ï¼‰ï¼Œæ­¤æ—¶æ€§èƒ½ä¼˜åŒ–ä¸Šåº”è¯¥æ˜¯æœ‰å·®å¼‚çš„ã€‚\n\n\u003e ä½†æ˜¯æ„Ÿè§‰NPMæ–¹æ¡ˆï¼Œåªè¦æ”¾å…¥å…¥å£æ–‡ä»¶ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿèƒ½åšåˆ°åˆ†chunkï¼Ÿæ¯”å¦‚è¿™ä¸ªä¸ä½¿ç”¨ require('react-micro-app')ï¼Œè€Œæ˜¯ä½¿ç”¨åŠ¨æ€å¼•å…¥ï¼š\n\n```js\nimport(\"react-micro-app\").then(chunk =\u003e {})\n```\n\n\u003e æ‰“ chunk æ˜¯å°†æ‡’åŠ è½½. å…¬å…±ä¾èµ–åˆ†ç¦»ï¼Œæ˜¯ webpack è‡ªåŠ¨åŒ–å¤„ç†çš„è¿‡ç¨‹ã€‚äº²æµ‹ä¼šæŠ¥é”™ï¼Œç›®å‰è¿˜ä¸çŸ¥é“å¯ä¸å¯è¡Œã€‚"])</script><script>self.__next_f.push([1,"19:T1a00,"])</script><script>self.__next_f.push([1,"æœ¬èŠ‚ç»§ç»­ä»‹ç»å¾®å‰ç«¯çš„å¦ä¸€ç§æ–¹æ¡ˆï¼šWeb Componentsã€‚å®ƒæ˜¯æ ¹æ®æµè§ˆå™¨åŸç”Ÿæ”¯æŒçš„ç»„ä»¶åŒ–æ–¹æ¡ˆæ¥å°è£…çš„å¾®åº”ç”¨ã€‚å…¶å®ç°æ–¹å¼ç±»ä¼¼äºåŠ¨æ€ script æ–¹æ¡ˆï¼Œ\n\n![image.png](/img/posts/2024-1-8/2024-1-8-4.png)\n\n[ä»“åº“åœ°å€ï¼štutorial/web-components-cookie åˆ†æ”¯](https://github.com/heiheihoho1213/monto-app/tree/tutorial/web-components-cookie)\n\n## 1. ä¸»åº”ç”¨\n\nè¿˜æ˜¯è€æ ·å­ï¼Œå¯åŠ¨ä¸€ä¸ªnodeæœåŠ¡ï¼š\n\n```js\napp.listen(port.main, host);\n```\n\nç„¶åé…ç½®è¯·æ±‚å¾®æœåŠ¡åˆ—è¡¨çš„æ¥å£ï¼š\n\n```js\napp.post(\"/microapps\", function (req, res) {\n\n  console.log(\"main cookies: \", req.cookies);\n\n  // è®¾ç½®ä¸€ä¸ªå“åº”çš„ Cookie æ•°æ®\n  res.cookie(\"main-app\", true);\n\n  // è¿™é‡Œå¯ä»¥æ˜¯ç®¡ç†åå°æ–°å¢èœå•åå­˜å‚¨åˆ°æ•°æ®åº“çš„æ•°æ®\n  // ä»è€Œå¯ä»¥é€šè¿‡ç®¡ç†åå°åŠ¨æ€é…ç½®å¾®åº”ç”¨çš„èœå•\n  res.json([\n    {\n      name: \"micro1\",\n      id: \"micro1\",\n      // è‡ªå®šä¹‰å…ƒç´ åç§°\n      customElement: \"micro-app-1\",\n      // è¿™é‡Œæš‚æ—¶ä»¥ä¸€ä¸ªå…¥å£æ–‡ä»¶ä¸ºç¤ºä¾‹\n      script: `http://${host}:${port.micro}/micro1.js`,\n      style: `http://${host}:${port.micro}/micro1.css`,\n      prefetch: true,\n    },\n    {\n      name: \"micro2\",\n      id: \"micro2\",\n      customElement: \"micro-app-2\",\n      script: `http://${host}:${port.micro}/micro2.js`,\n      style: `http://${host}:${port.micro}/micro2.css`,\n      prefetch: true,\n    },\n  ]);\n});\n```\n\nä¸»åº”ç”¨çš„ html é¡µé¢ä¸ åŠ¨æ€ script åŸºæœ¬é¡µé¢ä¸€è‡´ï¼Œè¿™é‡Œåªå±•ç¤ºä¸åŒä¹‹å¤„ï¼š\n\n```js\nhashChangeListener() {\n  // Web Components æ–¹æ¡ˆ\n  // å¾®åº”ç”¨çš„æ’æ§½\n  const $slot = document.getElementById(\"micro-app-slot\");\n\n  window.addEventListener(\"hashchange\", () =\u003e {\n    this.microApps?.forEach(async (microApp) =\u003e {\n      // Web Components æ–¹æ¡ˆ\n      const $webcomponent = document.querySelector(\n        `[micro-id=${microApp.id}]`\n      );\n\n      if (microApp.id === window.location.hash.replace(\"#\", \"\")) {\n        console.time(`fetch microapp ${microApp.name} static`);\n        // åŠ è½½ CSS æ ·å¼\n        microApp?.style \u0026\u0026\n          !this.hasLoadStyle(microApp) \u0026\u0026\n          (await this.loadStyle(microApp));\n        // åŠ è½½ Script æ ‡ç­¾\n        microApp?.script \u0026\u0026\n          !this.hasLoadScript(microApp) \u0026\u0026\n          (await this.loadScript(microApp));\n        console.timeEnd(`fetch microapp ${microApp.name} static`);\n\n        // åŠ¨æ€ Script æ–¹æ¡ˆ\n        // window?.[microApp.mount]?.(\"#micro-app-slot\");\n\n        // Web Components æ–¹æ¡ˆ\n        // å¦‚æœæ²¡æœ‰åœ¨ DOM ä¸­æ·»åŠ è‡ªå®šä¹‰å…ƒç´ ï¼Œåˆ™å…ˆæ·»åŠ å¤„ç†\n        if (!$webcomponent) {\n          // Web Components æ–¹æ¡ˆ\n          // è‡ªå®šä¹‰å…ƒç´ çš„æ ‡ç­¾æ˜¯å¾®åº”ç”¨å…ˆå®šä¹‰å‡ºæ¥çš„ï¼Œç„¶ååœ¨æœåŠ¡ç«¯çš„æ¥å£é‡Œé€šè¿‡ customElement å±æ€§è¿›è¡Œçº¦å®š\n          const $webcomponent = document.createElement(\n            microApp.customElement\n          );\n          $webcomponent.setAttribute(\"micro-id\", microApp.id);\n          $slot.appendChild($webcomponent);\n        // å¦‚æœå·²ç»å­˜åœ¨è‡ªå®šä¹‰å…ƒç´ ï¼Œåˆ™è¿›è¡Œæ˜¾ç¤ºå¤„ç†\n        } else {\n          $webcomponent.style.display = \"block\";\n        }\n      } else {\n        this.removeStyle(microApp);\n        // åŠ¨æ€ Script æ–¹æ¡ˆ\n        // window?.[microApp.unmount]?.();\n\n        // Web Components æ–¹æ¡ˆ\n        // å¦‚æœå·²ç»æ·»åŠ äº†è‡ªå®šä¹‰å…ƒç´ ï¼Œåˆ™éšè—è‡ªå®šä¹‰å…ƒç´ \n        if ($webcomponent) {\n          $webcomponent.style.display = \"none\";\n        }\n      }\n    });\n  });\n}\n```\n\n## 2. å­åº”ç”¨æ”¹é€ \n\nå­åº”ç”¨ä¹Ÿå¯åŠ¨ä¸€ä¸‹ï¼š\n\n```js\n// è¿™é‡Œæå¸¦æ‰‹é…ç½®å­åº”ç”¨ ajax è¯·æ±‚çš„è·¨åŸŸ\napp.use((req, res, next) =\u003e {\n  // è·¨åŸŸè¯·æ±‚ä¸­æ¶‰åŠåˆ° Cookie ä¿¡æ¯ä¼ é€’ï¼Œå€¼ä¸èƒ½ä¸º *ï¼Œå¿…é¡»æ˜¯å…·ä½“çš„åœ°å€ä¿¡æ¯\n  res.header(\"Access-Control-Allow-Origin\", `http://ä½ çš„åŸŸå.com:${port.main}`);\n  res.header(\"Access-Control-Allow-Methods\", \"GET, POST, OPTIONS\");\n  res.header(\"Allow\", \"GET, POST, OPTIONS\");\n  // å…è®¸è·¨åŸŸè¯·æ±‚æ—¶æºå¸¦ Cookie\n  res.header(\"Access-Control-Allow-Credentials\", true);\n  next();\n});\n\napp.use(\n  express.static(path.join(\"public\", \"micro\"), {\n    etag: true,\n    lastModified: true,\n  })\n);\n\napp.post(\"/cors\", function (req, res) {\n  console.log(\"micro cookies: \", req.cookies);\n\n  // å¢åŠ  SameSite å’Œ Secure å±æ€§ï¼Œä»è€Œä½¿æµè§ˆå™¨æ”¯æŒ iframe å­åº”ç”¨çš„è·¨ç«™æºå¸¦ Cookie\n  // æ³¨æ„ Secure éœ€è¦ HTTPS åè®®çš„æ”¯æŒ\n  const cookieOptions = { sameSite: \"none\", secure: true };\n\n  // è®¾ç½®ä¸€ä¸ªå“åº”çš„ Cookie æ•°æ®\n  res.cookie(\"micro-app\", true, cookieOptions);\n  res.json({\n    hello: \"true\",\n  });\n});\n\napp.listen(port.micro, host);\n```\n\nå­åº”ç”¨çš„å…¥å£jsè¦æ”¹é€ ä¸€ä¸‹ï¼Œæš´éœ²å‡ºæ¥ç”Ÿå‘½å‘¨æœŸé’©å­ï¼š\n\n```js\nclass MicroApp2Element extends HTMLElement {\n  constructor() {\n    super();\n  }\n\n  // [ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°] å½“ custom element è‡ªå®šä¹‰æ ‡ç­¾é¦–æ¬¡è¢«æ’å…¥æ–‡æ¡£ DOM æ—¶ï¼Œè¢«è°ƒç”¨\n  connectedCallback() {\n    console.log(`[micro-app-2]: æ‰§è¡Œ connectedCallback ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°`);\n    // æŒ‚è½½åº”ç”¨\n    // ç›¸å¯¹æ¯”åŠ¨æ€ Scriptï¼Œç»„ä»¶å†…éƒ¨å¯ä»¥è‡ªåŠ¨è¿›è¡Œ mount æ“ä½œï¼Œä¸éœ€è¦å¯¹å¤–æä¾›æ‰‹åŠ¨è°ƒç”¨çš„ mount å‡½æ•°ï¼Œä»è€Œé˜²æ­¢ä¸å¿…è¦çš„å…¨å±€å±æ€§å†²çª\n    this.mount();\n  }\n\n  // [ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°] å½“ custom element ä»æ–‡æ¡£ DOM ä¸­åˆ é™¤æ—¶ï¼Œè¢«è°ƒç”¨\n  disconnectedCallback() {\n    console.log(\n      `[micro-app-2]: æ‰§è¡Œ disconnectedCallback ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°`\n    );\n    // å¸è½½å¤„ç†\n    this.unmount();\n  }\n\n  mount() {\n    const $micro = document.createElement(\"h1\");\n    $micro.textContent = \"å¾®åº”ç”¨2\";\n    // å°†å¾®åº”ç”¨çš„å†…å®¹æŒ‚è½½åˆ°å½“å‰è‡ªå®šä¹‰å…ƒç´ ä¸‹\n    this.appendChild($micro);\n\n    // æ–°å¢ Ajax è¯·æ±‚ï¼Œç”¨äºè¯·æ±‚ micro1.js æ‰€åœ¨çš„æœåŠ¡\n    // éœ€è¦æ³¨æ„ micro1.js åŠ¨æ€åŠ è½½åœ¨ä¸»åº”ç”¨ localhost:4000 ä¸‹ï¼Œå› æ­¤è¯·æ±‚æ˜¯è·¨åŸŸçš„\n    window\n      .fetch(\"http://30.120.112.54:3000/cors\", {\n        method: \"post\",\n        credentials: \"include\"\n      })\n      .then((res) =\u003e res.json())\n      .catch((err) =\u003e {\n        console.error(err);\n      });\n  }\n}\n\nwindow.customElements.define(\"micro-app-2\", MicroApp2Element);\n```\n\nå¯¹æ¯”äºåŠ¨æ€Scriptæ–¹æ¡ˆï¼ŒWeb Componentsæ–¹æ¡ˆæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\n\n- ä¸éœ€è¦å¯¹å¤–æŠ›å‡ºå…¨å±€APIï¼ˆæŒ‚è½½ä¸å¸è½½ï¼‰ï¼ŒWeb Components å¤©ç„¶æ”¯æŒï¼Œå¯å¤ç”¨æ€§æ›´å¼ºã€‚\n- æ›´æ ‡å‡†åŒ–ï¼ŒWeb Componentsçš„èƒ½åŠ›åç»­ä¼šéšç€w3cæ ‡å‡†é€æ­¥æå‡ã€‚\n- ä¹Ÿæ˜¯åŠ¨æ€ script çš„ä¼˜ç‚¹ï¼šå¯ä»¥éå¸¸ä¾¿æ·çš„è¿›è¡Œç§»æ¤å’Œç»„ä»¶æ›¿æ¢\n\nå½“ç„¶ï¼ŒWeb Componentsè¿˜æ˜¯å­˜åœ¨ä¸€äº›ä¸è¶³ï¼š\n\n- å…¼å®¹æ€§é—®é¢˜ã€‚å¯¹æ—§ç‰ˆæœ¬æµè§ˆå™¨å…¼å®¹æ€§ä¸å¥½ã€‚\n- æœ‰ä¸€å®šä¸Šæ‰‹éš¾åº¦ï¼Œéœ€è¦é¢å¤–å­¦ä¹ Web Componentsç›¸å…³çŸ¥è¯†ã€‚\n- å­åº”ç”¨æ˜¯ä¾µå…¥å¼çš„"])</script><script>self.__next_f.push([1,"1a:T2106,"])</script><script>self.__next_f.push([1,"æœ¬èŠ‚ç»§ç»­ä»‹ç»å¾®å‰ç«¯çš„å¦ä¸€ç§æ–¹æ¡ˆï¼šNPM\n\nNPM åŒ…æ˜¯å¾®å‰ç«¯è®¾è®¡æ–¹æ¡ˆä¹‹ä¸€ï¼Œåœ¨è®¾è®¡æ—¶éœ€è¦å°†å¾®åº”ç”¨æ‰“åŒ…æˆç‹¬ç«‹çš„ NPM åŒ…ï¼Œç„¶ååœ¨ä¸»åº”ç”¨ä¸­å¼•å…¥å’Œä½¿ç”¨ã€‚\n\n## 1. èƒŒæ™¯çŸ¥è¯†\n\næˆ‘ä»¬ä¸€èˆ¬è¿™æ ·åœ¨é¡¹ç›®ä¸­å¼•å…¥ jsï¼š\n\n```html\n\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n  \u003chead\u003e\n    \u003cmeta charset=\"UTF-8\"\u003e\n    \u003cmeta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"\u003e\n    \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e\n    \u003ctitle\u003eDocument\u003c/title\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cscript src=\"a.js\"\u003e\u003c/script\u003e\n    \u003cscript src=\"b.js\"\u003e\u003c/script\u003e\n    \u003cscript src=\"c.js\"\u003e\u003c/script\u003e\n    \u003cscript src=\"d.js\"\u003e\u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\nå¦‚æœæœ‰ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œé‚£ä¹ˆéœ€è¦æŒ‰ç…§é¡ºåºæ¥åŠ è½½ï¼š\n\n```html\n\u003cbody\u003e\n  \u003cscript\u003e\n    // æœªåŠ è½½ lodash æ—¶ï¼Œæ— æ³•è·å– _ å˜é‡\n    // Uncaught ReferenceError: _ is not defined\n    console.log(_); \n  \u003c/script\u003e\n\n  \u003cscript src=\"https://cdn.bootcdn.net/ajax/libs/lodash.js/4.17.21/lodash.min.js\"\u003e\u003c/script\u003e\n  \n  \u003cscript\u003e\n    // åŠ è½½ lodash ä¹‹åï¼Œå¯ä»¥è·å– _ å˜é‡\n    // Æ’ Mc(n,t,r){var e=null==n?X:_e(n,t);return e===X?r:e}\n    console.log(_.get); \n  \u003c/script\u003e\n\u003c/body\u003e\n```\n\nä½†æ˜¯è¿™æ ·åŠ è½½æœ‰ä¸ªé—®é¢˜ï¼Œä¼šé€ æˆå˜é‡æ±¡æŸ“ï¼š\n\n```html\n\u003cbody\u003e\n  \u003cscript\u003e\n    const _ = 111;\n  \u003c/script\u003e\n  \n  \u003cscript\u003e\n    console.log(_); // 111\n  \u003c/script\u003e\n  \n  \u003cscript src=\"https://cdn.bootcdn.net/ajax/libs/lodash.js/4.17.21/lodash.min.js\"\u003e\u003c/script\u003e\n  \n  \u003cscript\u003e\n    console.log(_); // 111\n    console.log(_.get); // undefined\n  \u003c/script\u003e\n\u003c/body\u003e\n```\n\n## 2. NPM åŠ è½½\n\nä¸Šé¢çš„ä¾‹å­ï¼Œå…¨å±€åŠ è½½çš„ lodash å°±å¤±æ•ˆäº†ã€‚å¦‚æœé¡¹ç›®å¾ˆå¤æ‚ï¼Œä¸Šè¿°çš„æƒ…å†µå°±å¾ˆä¸å¥½å¤„ç†äº†ã€‚ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼ŒJavaScript å¼€å§‹æä¾›ä¸€ç§å°†ç¨‹åºæ‹†åˆ†ä¸ºå¯æŒ‰éœ€å¯¼å…¥çš„å•ç‹¬æ¨¡å—ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨ç›®å‰é€šç”¨çš„ ESModule æ¨¡å—æ¥è¿›è¡Œæ‹†åˆ†ã€‚\n\n[ä»“åº“åœ°å€ï¼štutorial/npm-esmodule åˆ†æ”¯](https://github.com/heiheihoho1213/monto-app/tree/tutorial/npm-esmodule)\n\né¡¹ç›®ç»“æ„ï¼š\n\n```shell\nâ”œâ”€â”€ public                 # æ‰˜ç®¡çš„é™æ€èµ„æºç›®å½•\nâ”‚   â”œâ”€â”€ custom_modules/    # è‡ªå®šä¹‰æ¨¡å—\nâ”‚   â”‚   â”œâ”€â”€ add.js                         \nâ”‚   â”‚   â””â”€â”€ conflict.js                                        \nâ”‚   â”œâ”€â”€ node_modules/      # ä¸‰æ–¹æ¨¡å—\nâ”‚   â”‚   â””â”€â”€ lodash-es/        \nâ”‚   â””â”€â”€ index.html         # åº”ç”¨é¡µé¢\nâ””â”€â”€ app.js\n```\n\ncustom_modules ä¸­æˆ‘ä»¬å†™å…¥å‡ ä¸ªè‡ªå®šä¹‰çš„ä¾èµ–æ–¹æ³•ï¼š\n\n```js\n// add.js\nexport function add(a, b) {\n  return a + b;\n}\n\n// conflict.js\nconst _ = 111;\nconsole.log('conflict.js --\u003e ', _)\n```\n\næˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªæœ¬åœ°çš„ node æœåŠ¡æ¥è®¿é—® js æ–‡ä»¶ã€‚åœ¨ index.html ä¸­å†™å…¥ï¼š\n\n```html\n\u003cscript type=\"importmap\"\u003e\n  {\n    \"imports\": {\n      \"custom_modules/\": \"/custom_modules/\",\n      \"lodash/\": \"/node_modules/lodash-es/\",\n      \"lodash\": \"/node_modules/lodash-es/lodash.js\"\n    }\n  }\n\u003c/script\u003e\n```\n\n\u003e import-maps å­˜åœ¨æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜ï¼Œå¯ä»¥æ‰¾ç›¸åº”çš„ polyfill è¿›è¡Œå…¼å®¹æ€§å¤„ç†ã€‚\n\nå…ˆå£°æ˜ npm åŒ…çš„æ˜ å°„å…³ç³»ã€‚\n\nç„¶åæŒ‰ç…§æ¨¡å—ä½ å¼•å…¥ï¼š\n\n```html\n\u003cscript type=\"module\"\u003e\n  // è‡ªå®šä¹‰æ¨¡å— - add å‡½æ•°\n  import { add } from \"custom_modules/add.js\";\n  // è‡ªå®šä¹‰æ¨¡å— - é˜²å†²æ’æµ‹è¯• (_ å˜é‡)\n  import \"custom_modules/conflict.js\";\n  // ä¸‰æ–¹æ¨¡å— - æŒ‰éœ€å¼•å…¥ lodash\n  import isNull from \"lodash/isNull.js\";\n\n  console.log(isNull);  // Function\n  console.log(add(1, 2)); // 3\n\n  // åœ¨ confilict.js ä¸­å£°æ˜çš„ const _ = 111; ä¸ä¼šä½œç”¨åœ¨å½“å‰è„šæœ¬ä¸­\n  console.log(_);  // Uncaught ReferenceError: _ is not defined\n\u003c/script\u003e\n```\n\næ­¤æ—¶å°±ä¸ä¼šæœ‰å…¨å±€æ±¡æŸ“äº†ï¼Œè‡ªå·±çš„å˜é‡åªåœ¨è‡ªå·±çš„npmä½œç”¨èŒƒå›´å†…ç”Ÿæ•ˆï¼Œç¬¬ä¸‰æ–¹åŒ…ä½¿ç”¨æŒ‰éœ€åŠ è½½å³å¯ã€‚æ­¤æ—¶å°±ä¸ç”¨è€ƒè™‘åŠ è½½é¡ºåºäº†ã€‚\n\n![image.png](/img/posts/2024-1-8/2024-1-8-1.png)\n\nESM åŠ è½½æ–¹å¼æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š\n\n- ä¸éœ€è¦æ„å»ºå·¥å…·è¿›è¡Œæ‰“åŒ…å¤„ç†ï¼›\n- å¤©ç„¶æŒ‰éœ€å¼•å…¥ï¼Œå¹¶ä¸”ä¸éœ€è¦è€ƒè™‘æ¨¡å—çš„åŠ è½½é¡ºåºï¼›\n- æ¨¡å—åŒ–ä½œç”¨åŸŸï¼Œä¸éœ€è¦è€ƒè™‘å˜é‡åå†²çªé—®é¢˜ã€‚\n\n## 3. NPM å¾®æœåŠ¡æ–¹æ¡ˆ\n\nåº”ç”¨çš„æ„å»ºéœ€è¦ç”Ÿæˆ HTML æ–‡ä»¶å¹¶æ‰“åŒ… JS. CSS ä»¥åŠå›¾ç‰‡ç­‰é™æ€èµ„æºï¼Œä¸šåŠ¡ç»„ä»¶çš„æ„å»ºæ›´å¤šçš„æ˜¯æ‰“åŒ…æˆåº”ç”¨éœ€è¦é€šè¿‡æ¨¡å—åŒ–æ–¹å¼å¼•å…¥ä½¿ç”¨çš„ JavaScript åº“ã€‚\n\nåº”ç”¨åœ¨æ„å»ºæ—¶ä¸ºäº†æå‡æ„å»ºé€Ÿåº¦ï¼ŒåŒæ—¶ä¹Ÿä¸ºäº†ç®€åŒ–æ„å»ºé…ç½®ï¼Œé€šå¸¸åœ¨ä½¿ç”¨ babel-loader ï¼ˆè½¬è¯‘å·¥å…·ï¼‰è¿›è¡Œè½¬è¯‘æ—¶ ï¼Œ ä¼šå±è”½ node_modules ç›®å½•ä¸‹çš„ NPM åŒ…ï¼Œå› æ­¤éœ€è¦å°†å‘å¸ƒçš„ NPM ç»„ä»¶è½¬è¯‘æˆå¤§å¤šæ•°æµè§ˆå™¨èƒ½å¤Ÿå…¼å®¹çš„ ES5 æ ‡å‡†ã€‚\n\n![image.png](/img/posts/2024-1-8/2024-1-8-2.png)\n\nNPM çš„å¾®å‰ç«¯è®¾è®¡æ–¹æ¡ˆä¸­ï¼Œå„ä¸ªå¾®åº”ç”¨å¯ä»¥é‡‡ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆï¼Œä½†æ˜¯æ„å»ºæ—¶éœ€è¦åƒå‘å¸ƒä¸šåŠ¡ç»„ä»¶ä¸€æ ·è¾“å‡º ES5 \u0026 æ¨¡å—åŒ–æ ‡å‡†çš„ JavaScript åº“ï¼ˆå°½ç®¡å¼€å‘çš„æ˜¯åº”ç”¨ï¼Œä½†æ˜¯æ„å»ºçš„ä¸æ˜¯åº”ç”¨ç¨‹åºï¼Œä¸éœ€è¦é¢å¤–ç”Ÿæˆ HTMLï¼‰ï¼Œä»è€Œä½¿ä¸»åº”ç”¨å®‰è£…å„è‡ªçš„ä¾èµ–æ—¶ï¼Œå¯ä»¥é€šè¿‡æ¨¡å—åŒ–çš„æ–¹å¼å¼•å…¥å¾®åº”ç”¨ã€‚ä¸»åº”ç”¨ä¸éœ€è¦å…³å¿ƒå¾®åº”ç”¨çš„æŠ€æœ¯æ ˆï¼Œä¸éœ€è¦å…³å¿ƒå¾®åº”ç”¨çš„æ„å»ºé…ç½®é¡¹ã€‚\n\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸ª [demo](https://github.com/heiheihoho1213/monto-app/tree/tutorial/npm-micro)\n\nä¸»åº”ç”¨æˆ‘ä»¬å‡è®¾ä½¿ç”¨ vueï¼Œè®¾ç½®å­åº”ç”¨çš„è·¯ç”±ï¼š\n\n```js\nimport ReactApp from \"./React\";\nimport VueApp from \"./Vue\";\nconst router = createBrowserRouter([\n  {\n    path: \"/\",\n    element: \u003cApp /\u003e,\n    children: [\n      {\n        path: \"react\",\n        element: \u003cReactApp /\u003e,\n      },\n      {\n        path: \"vue\",\n        element: \u003cVueApp /\u003e,\n      },\n    ],\n  },\n]);\n```\n\nå„ä¸ªå­åº”ç”¨çš„å…¥å£éœ€è¦æ”¹é€ ï¼Œæˆ‘ä»¬ä»¥ react ä¸ºä¾‹ï¼š\n\n```js\n// package.json åç§°ï¼šreact-micro-app\nlet root;\n\nexport function mount(containerId) {\n  console.log(\"react app mount\");\n  root = ReactDOM.createRoot(document.getElementById(containerId));\n  root.render(\n    \u003cReact.StrictMode\u003e\n      \u003cApp /\u003e\n    \u003c/React.StrictMode\u003e\n  );\n}\n\nexport function unmount() {\n  console.log(\"react app unmount: \", root);\n  root \u0026\u0026 root.unmount();\n}\n```\n\nå­åº”ç”¨éƒ¨ç½²ä¸º npm å¹¶å‘å¸ƒåï¼Œä¸»åº”ç”¨ç›´æ¥å¼•å…¥ï¼ˆè¿™é‡Œä½¿ç”¨ lernaï¼‰ç®¡ç†ï¼š\n\n```js\n// ä¸»åº”ç”¨å¼•å…¥\n// React.js\nconst { mount, unmount } = require(\"react-micro-app\");\nimport React, { useEffect } from \"react\";\n\nconst containerId = 'react-app';\n\nfunction ReactApp() {\n  useEffect(() =\u003e {\n    mount(containerId);\n    return () =\u003e {\n      unmount();\n    };\n  }, []);\n  return \u003cdiv id={containerId}\u003e\u003c/div\u003e;\n}\n\nexport default React.memo(ReactApp);\n```\nå¦‚æœä¸æƒ³é¢å¤–å¼•å…¥å¾®åº”ç”¨çš„ CSS æ ·å¼ï¼Œé‚£ä¹ˆå¯ä»¥å°†æ ·å¼å†…è”åˆ° JS ä¸­ï¼Œå½“ç„¶å…¶å®ƒçš„ä¸€äº›é™æ€èµ„æºä¹Ÿéœ€è¦å†…è”åˆ° JS ä¸­ï¼Œé€šè¿‡ Webpack å¯ä»¥è¿›è¡Œå¾ˆå¥½çš„å¤„ç†ã€‚\nç”±äºéœ€è¦æ„å»ºæˆç±»ä¼¼äºåº“åŒ…çš„æ¨¡å—åŒ–è§„èŒƒï¼Œå­åº”ç”¨éœ€è¦æ›´æ”¹ Webpack çš„é…ç½® (ä»¥ vue ä¸ºä¾‹)ï¼š\n\n```js\nmodule.exports = defineConfig({\n  transpileDependencies: true,\n  // å†…è” CSS æ ·å¼å¤„ç†\n  css: { extract: false }\n});\n```\n\n\u003e æ€è€ƒï¼šæœ‰æ²¡æœ‰æ–¹æ³•å¯ä»¥åšåˆ°ä¸»åº”ç”¨å¼•å…¥æ–¹å¼ä¸å˜çš„æƒ…å†µä¸‹ï¼Œåœ¨å¼€å‘æ€å¼•å…¥çš„æ˜¯å¾®åº”ç”¨çš„æºç ï¼ˆä¿®æ”¹å¾®åº”ç”¨çš„ä»£ç åä¸éœ€è¦æ„å»ºï¼Œç›´æ¥åœ¨ä¸»åº”ç”¨ä¸­ä¼šçƒ­æ›´æ–°å˜æ›´ï¼‰ï¼Œè€Œåœ¨ç”Ÿäº§æ€å¼•å…¥çš„æ˜¯å¾®åº”ç”¨æ„å»ºåå‘å¸ƒçš„ NPM åŒ…ï¼Œè¿™ç§é…ç½®åœ¨å•ä¸ªä¸šåŠ¡ç»„ä»¶çš„å¼€å‘ä¸­å°¤ä¸ºé‡è¦ ?\n\n\u003e å¼€å‘æ—¶å°†ä¾èµ–çš„åº”ç”¨æ‹‰ä¸‹æ¥åˆ°æœ¬åœ°ï¼Œå¹¶åšå…³è”ï¼ˆæ¯”å¦‚ lernaï¼‰åå¯åŠ¨å¼€å‘åº”ç”¨ã€‚å¯åŠ¨å™¨ä¸­æ£€æµ‹æœ¬åœ°æœ‰å°±ä½¿ç”¨æœ¬åœ°ï¼Œæ²¡æœ‰å°±ä½¿ç”¨ npm ä¸‹è½½ä½¿ç”¨ï¼Ÿ\n\nNPM æ–¹æ¡ˆä¼˜ç‚¹ï¼š\n\n- å¯ä»¥æŒ‰ç…§ UMD. CommonJS æˆ–è€… ESM ç­‰ä¸åŒè§„èŒƒè¿›è¡Œå¼•å…¥ï¼Œä¸åŒä¾èµ–åº“é—´ä¹Ÿæ²¡æœ‰å¼ºä¾èµ–\n- ä¸éœ€è¦å•ç‹¬çš„æœåŠ¡å™¨è¿›è¡Œéƒ¨ç½²ä»¥åŠèµ„æºæ‰˜ç®¡ï¼Œåªéœ€è¦å‘å¸ƒåˆ°npmä»“åº“å³å¯ã€‚\n- å¤ç”¨æ€§å¥½ï¼Œå¯ä»¥ä»»æ„ç»„åˆæˆä¸åŒçš„å¾®å‰ç«¯ç³»ç»Ÿã€‚\n- å¯ä»¥å…±äº«åŒä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ï¼Œå¤©ç„¶å…±äº« windowï¼Œä¸Šä¸‹æ–‡åŠå†…å­˜æ•°æ®ã€‚\n- ä¸»å­åº”ç”¨å¤©ç„¶åŒåŸŸ\n\n\nç¼ºç‚¹ï¼š\n\n- ä¸»åº”ç”¨éœ€è¦ä¸€ä¸ªå¸¦è·¯ç”±çš„æ¡†æ¶ï¼Œæ— æ³•åšåˆ°æŠ€æœ¯æ— å…³ã€‚\n- æ— æ³•å¤„ç†ä¸»å­åº”ç”¨æ ·å¼å†²çª\n- å¾®åº”ç”¨çš„æ„å»ºéœ€è¦åšé¢å¤–çš„é…ç½®ï¼Œå› ä¸ºæ„å»ºçš„ä¸æ˜¯åº”ç”¨ï¼Œè€Œæ˜¯ä¾èµ–åº“ã€‚\n- å¾®åº”ç”¨å‘å¸ƒæ–°ç‰ˆæœ¬åï¼Œä¸»åº”ç”¨éƒ½éœ€è¦é‡æ–°å®‰è£…å¹¶æ„å»ºéƒ¨ç½²ï¼Œæ— æ³•åšåˆ°å­åº”ç”¨ç‹¬ç«‹å¯åŠ¨å’Œéƒ¨ç½²ã€‚\n- ä¾èµ– webpack ç­‰æ‰“åŒ…å·¥å…·\n- å½“å¾®åº”ç”¨è¿‡å¤šï¼Œè¿˜éœ€è¦è€ƒè™‘ä½“ç§¯è¿‡å¤§çš„ä¼˜åŒ–é—®é¢˜ï¼Œæ¯”å¦‚å…¬å…±æ¡†æ¶æŠ½ç¦»ï¼Œä»£ç åˆ†å‰²ç­‰ã€‚\n- å­åº”ç”¨æ— æ³•ç‹¬ç«‹éƒ¨ç½²å’Œå¼€å‘\n\né—ç•™é—®é¢˜ï¼š\n\n- ä¸»åº”ç”¨ä¸å­åº”ç”¨å…¨å±€å˜é‡æ±¡æŸ“\n- CSS æ ·å¼å†²çª\n- å­˜å‚¨æ•°æ®å†²çª"])</script><script>self.__next_f.push([1,"1b:T2645,"])</script><script>self.__next_f.push([1,"æœ¬èŠ‚å¼€å§‹å¾®å‰ç«¯é¡¹ç›®çš„ä»‹ç»ã€‚\n\n## 1. èƒŒæ™¯çŸ¥è¯†\n\nä¸€ä¸ªå¥½çš„å¾®å‰ç«¯æ¶æ„ï¼Œåº”è¯¥å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š\n\n- SPA ä½“éªŒï¼šå¾®å‰ç«¯å¯ä»¥ä½¿æ‰€æœ‰çš„åº”ç”¨ä¿æŒåŸæœ‰çš„ SPA ä½“éªŒï¼Œç»Ÿä¸€å“ç‰Œè®¤çŸ¥ï¼›\n- æŠ€æœ¯æ ˆæ— å…³ï¼šå¯ä»¥ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆï¼ˆä¾‹å¦‚ React. Vue. Svelte ï¼‰å¼€å‘ï¼Œæ”¯æŒç‹¬ç«‹éƒ¨ç½²ï¼›\n- æ€§èƒ½ä¼˜åŒ–ï¼š åœ¨ MPA å’Œ iframe ä¸­å¦‚æœæƒ³è¦åšæ€§èƒ½ä¼˜åŒ–ï¼Œå¾€å¾€éœ€è¦ä¾èµ–æµè§ˆå™¨å’Œ HTTP çš„èƒ½åŠ›ï¼Œè€Œåœ¨å¾®å‰ç«¯ä¸­å¯ä»¥å¤„ç†åº”ç”¨èµ„æºçš„å»é‡. åº”ç”¨è‡ªèº«çš„é¢„åŠ è½½. é¢„æ¸²æŸ“å’Œç¼“å­˜å¤„ç†ï¼Œä¹Ÿå¯ä»¥å¯¹å·²åŠ è½½çš„é¡µé¢è¿›è¡Œä¿æ´»å¤„ç†ï¼Œå¢åŠ äº†æ€§èƒ½ä¼˜åŒ–çš„æ‰‹æ®µï¼›\n- è§£è€¦é‡æ„ï¼šéƒ¨åˆ†ä½ä»£ç é¡µé¢æ— æ³•æ»¡è¶³æ€§èƒ½è¦æ±‚æ—¶ï¼Œå¯ä»¥é€šè¿‡æ–°çš„æŠ€æœ¯æ ˆå°†é¡µé¢è¿›è¡Œé‡æ„ï¼Œä¸å½±å“å…¶ä»–ä½ä»£ç é¡µé¢çš„è¿è¡Œï¼Œä»è€Œå¯ä»¥å‡å°‘é‡æ„å¸¦æ¥çš„å½±å“é¢ã€‚\n- ç‹¬ç«‹æ€§ï¼šç‹¬ç«‹å¼€å‘. ç‹¬ç«‹éƒ¨ç½²å’Œç‹¬ç«‹è¿è¡Œ\n\n**ä¸ºä»€ä¹ˆä½¿ç”¨å¾®å‰ç«¯**ï¼šå¾®å‰ç«¯å¯ä»¥é™ä½å¤§å‹å¤æ‚åº”ç”¨çš„å¼€å‘. å‡çº§. ç»´æŠ¤ä»¥åŠå›¢é˜Ÿåä½œçš„æˆæœ¬ã€‚å½“ç„¶ï¼Œè§£å†³å†å²é—ç•™çš„éš¾ä»¥å¼€å‘. å‡çº§å’Œç»´æŠ¤çš„å¤§å‹åº”ç”¨ï¼Œä¹Ÿæ˜¯ä½¿ç”¨å¾®å‰ç«¯çš„ä¸€ä¸ªé‡è¦åŸå› ã€‚\n\nweb æ¶æ„æ¼”è¿›ï¼š\n\n![image.png](/img/posts/2024-1-3/2024-1-3-2.png)\n\nä½¿ç”¨å¾®å‰ç«¯ï¼š\n\n![image.png](/img/posts/2024-1-3/2024-1-3-3.png)\n\nå…¶åœ¨ä¼ä¸šä¸­çš„ä¸šåŠ¡åœºæ™¯ï¼š\n\n![image.png](/img/posts/2024-1-3/2024-1-3-4.png)\n\nç„¶è€Œå¾®å‰ç«¯ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œä¾‹å¦‚ä»¥ä¸‹åœºæ™¯å¯èƒ½å¹¶ä¸éœ€è¦å¾®å‰ç«¯ï¼š\n\n- åº”ç”¨çš„ä¸šåŠ¡å•ä¸€ï¼Œä¸å­˜åœ¨å¤šä¸ªå›¢é˜Ÿå¹¶è¡Œå¼€å‘çš„æƒ…å†µï¼Œä¸éœ€è¦å…¼å®¹ä¸åŒçš„æŠ€æœ¯æ ˆï¼›\n- åº”ç”¨çš„åŠŸèƒ½å·²ç»éå¸¸å®Œå–„ï¼Œä¸å­˜åœ¨å¤§é‡æ–°éœ€æ±‚å¼€å‘çš„å¯èƒ½æ€§ï¼›\n- é¡¹ç›®ç»„ä¸æƒ³èŠ±è´¹å¤§é‡çš„æ—¶é—´åœ¨åº”ç”¨çš„æ”¹é€ ä¸Šï¼Œä»¥ç°æœ‰åº”ç”¨çš„ç¨³å®šæ€§ä¸ºä¸»ï¼›\n- åº”ç”¨è¿›è¡Œå¾®å‰ç«¯æ”¹é€ çš„æˆæœ¬è¿˜ä¸å¦‚ç›´æ¥æ”¹é€ å½“å‰å­˜é‡åº”ç”¨å¸¦æ¥çš„æ”¶ç›Šå¤§ï¼›\n- å›¢é˜Ÿå†…å¼€å‘äººå‘˜ä¸ç†Ÿæ‚‰å¾®å‰ç«¯ï¼Œæ— æ³•åº”å¯¹å¾®å‰ç«¯æ¶æ„çš„å¤æ‚æ€§ã€‚\n\n## 2. æµè§ˆå™¨éš”ç¦»\n\næµè§ˆå™¨æ˜¯å¤šè¿›ç¨‹æ¶æ„ï¼Œåœ¨æ¸²æŸ“é¡µé¢æ—¶ï¼Œç†è®ºä¸Šä¸åŒçš„ç«™ç‚¹ä¼šå¯ç”¨ä¸åŒçš„æ¸²æŸ“è¿›ç¨‹ï¼ˆRendererï¼‰ï¼Œä»–ä»¬ä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚Chrome æµè§ˆå™¨åœ¨è¿›è¡Œæ²™ç®±è®¾è®¡æ—¶ï¼Œä¼šå°½å¯èƒ½çš„å¤ç”¨ç°æœ‰æ“ä½œç³»ç»Ÿçš„æ²™ç®±æŠ€æœ¯ï¼Œä¾‹å¦‚ä»¥ Windows æ“ä½œç³»ç»Ÿçš„æ²™ç®±æ¶æ„ä¸ºä¾‹ï¼Œæ‰€æœ‰çš„æ²™ç®±éƒ½ä¼šåœ¨è¿›ç¨‹ç²’åº¦è¿›è¡Œæ§åˆ¶ï¼Œæ‰€æœ‰çš„è¿›ç¨‹éƒ½é€šè¿‡ IPC è¿›è¡Œé€šä¿¡ã€‚\n\n![image.png](/img/posts/2024-1-3/2024-1-3-5.png)\n\nåœ¨ Chrome æµè§ˆå™¨ä¸­æ²™ç®±éš”ç¦»ä»¥ Renderer è¿›ç¨‹ä¸ºå•ä½ï¼Œè€Œåœ¨æ—§ç‰ˆçš„æµè§ˆå™¨ä¸­ä¼šå­˜åœ¨å¤šä¸ª **Web åº”ç”¨å…±äº«åŒä¸€ä¸ª Renderer è¿›ç¨‹**çš„æƒ…å†µï¼Œæ­¤æ—¶æµè§ˆå™¨ä¼šä¾é åŒæºç­–ç•¥æ¥é™åˆ¶ä¸¤ä¸ªä¸åŒæºçš„æ–‡æ¡£è¿›è¡Œäº¤äº’ï¼Œå¸®åŠ©éš”ç¦»æ¶æ„æ–‡æ¡£æ¥å‡å°‘å®‰å…¨é£é™©ã€‚\n\nä½†æ˜¯è€å¼æµè§ˆå™¨æœªå¯ç”¨ç«™ç‚¹éš”ç¦»ï¼Œæ ‡ç­¾é¡µåº”ç”¨å’Œå†…éƒ¨çš„ iframe åº”ç”¨ä¼šå¤„äºåŒä¸€ä¸ª Renderer è¿›ç¨‹ï¼ŒWeb åº”ç”¨æœ‰å¯èƒ½å‘ç°å®‰å…¨æ¼æ´å¹¶ç»•è¿‡åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œè®¿é—®åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„å…¶ä»– Web åº”ç”¨ï¼Œå› æ­¤å¯èƒ½äº§ç”Ÿå¦‚ä¸‹å®‰å…¨é£é™©ï¼š\n\n- è·å–è·¨ç«™ç‚¹ Web åº”ç”¨çš„ Cookie å’Œ HTML 5 å­˜å‚¨æ•°æ®ï¼›\n- è·å–è·¨ç«™ç‚¹ Web åº”ç”¨çš„ HTML. XML å’Œ JSON æ•°æ®ï¼›\n- è·å–æµè§ˆå™¨ä¿å­˜çš„å¯†ç æ•°æ®ï¼›\n- å…±äº«è·¨ç«™ç‚¹ Web åº”ç”¨çš„æˆæƒæƒé™ï¼Œä¾‹å¦‚åœ°ç†ä½ç½®ï¼›\n- ç»•è¿‡ X-Frame-Options åŠ è½½ iframe åº”ç”¨ï¼ˆä¾‹å¦‚ç™¾åº¦çš„é¡µé¢è¢« iframe åµŒå¥—ï¼‰ï¼›\n- è·å–è·¨ç«™ç‚¹ Web åº”ç”¨çš„ DOM å…ƒç´ ã€‚\n\n## 3. iframe æ–¹æ¡ˆ\n\n[ä»“åº“åœ°å€ï¼šdemo/iframe-isolate åˆ†æ”¯](https://github.com/heiheihoho1213/monto-app/tree/tutorial/iframe-isolate)\n\nåœ¨ Chrome 67 ç‰ˆæœ¬ä¹‹åï¼Œä¸ºäº†é˜²å¾¡å¤šä¸ªè·¨ç«™çš„ Web åº”ç”¨å¤„äºåŒä¸€ä¸ª Renderer è¿›ç¨‹è€Œå¯èƒ½äº§ç”Ÿçš„å®‰å…¨é£é™©ï¼Œ**æµè§ˆå™¨ä¼šç»™æ¥è‡ªä¸åŒç«™ç‚¹çš„ Web åº”ç”¨åˆ†é…ä¸åŒçš„ Renderer è¿›ç¨‹**ã€‚ä¾‹å¦‚å½“å‰æ ‡ç­¾é¡µåº”ç”¨ä¸­åŒ…å«äº†å¤šä¸ªä¸åŒç«™ç‚¹çš„ iframe åº”ç”¨ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šä¸ºå„è‡ªåˆ†é…ä¸åŒçš„ Renderer è¿›ç¨‹ï¼Œä»è€Œå¯ä»¥åŸºäºæ²™ç®±ç­–ç•¥è¿›è¡Œåº”ç”¨çš„è¿›ç¨‹éš”ç¦»ï¼Œç¡®ä¿æ”»å‡»è€…éš¾ä»¥ç»•è¿‡å®‰å…¨æ¼æ´ç›´æ¥è®¿é—®è·¨ç«™ Web åº”ç”¨ã€‚\n\nä¸»åº”ç”¨é‡Œå®šä¹‰ï¼š\n\n```html\n\u003cbody\u003e\n  \u003ch1\u003emain åº”ç”¨\u003c/h1\u003e\n  \u003cbutton onclick=\"javascript:window.open('\u003c%= iframeUrl %\u003e')\"\u003eåœ¨æ–°çš„æ ‡ç­¾é¡µæ‰“å¼€ iframe åº”ç”¨\u003c/button\u003e\n  \u003cbr\u003e\n  \u003c!-- åŒç«™åº”ç”¨ï¼šiframe.html --\u003e\n  \u003ciframe src=\"\u003c%= iframeUrl %\u003e\"\u003e\u003c/iframe\u003e\n  \u003c!-- è·¨ç«™åº”ç”¨: --\u003e\n  \u003ciframe src=\"https://nextjs.org/\"\u003e\u003c/iframe\u003e\n\u003c/body\u003e\n```\n\nå­åº”ç”¨é‡Œå®šä¹‰ï¼š\n\n```html\n\u003cbody\u003e\n  \u003ch1\u003eåŒç«™çš„ iframe åº”ç”¨\u003c/h1\u003e\n  \u003cbutton onclick=\"javascript:alert('æˆ‘æ˜¯å¼¹çª—')\"\u003eç‚¹æˆ‘æœ‰å¼¹çª—\u003c/button\u003e\n\u003c/body\u003e\n```\n\nç„¶ååœ¨ä¸»æœåŠ¡é‡Œå†™å…¥å­åº”ç”¨çš„åœ°å€ï¼š\n\n```js\napp.get(\"/\", function (req, res) {\n  // ä½¿ç”¨ ejs æ¨¡ç‰ˆå¼•æ“å¡«å……ä¸»åº”ç”¨ views/main.html ä¸­çš„ iframeUrl å˜é‡ï¼Œå¹¶å°†å…¶æ¸²æŸ“åˆ°æµè§ˆå™¨\n  res.render(\"main\", {\n    // å¡«å…… iframe åº”ç”¨çš„åœ°å€ï¼Œåªæœ‰ç«¯å£ä¸åŒï¼Œiframe åº”ç”¨å’Œ main åº”ç”¨è·¨åŸŸä½†æ˜¯åŒç«™ï¼Œå¯ä»¥ä½¿ç”¨ åŒç«™åº”ç”¨é€šè¿‡ä¿®æ”¹ document.domain è¿›è¡Œé€šä¿¡\n    iframeUrl: `http://${host}:${port.micro}`\n  });\n});\n```\n\nå­åº”ç”¨ä¹Ÿä½¿ç”¨å•ç‹¬çš„æœåŠ¡å¯åŠ¨å³å¯ï¼š\n\n![image.png](/img/posts/2024-1-3/2024-1-3-1.png)\n\n## 4. iframe æµè§ˆä¸Šä¸‹æ–‡\n\nåˆ¤æ–­ä¸€ä¸ªé¡µé¢æ˜¯ä¸æ˜¯åœ¨ iframe ä¸­è¢«æ‰“å¼€ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç ï¼š\n\n```js\n// é€šè¿‡è®¿é—® window.top å¯ä»¥è·å–å½“å‰æµè§ˆä¸Šä¸‹æ–‡çš„é¡¶çº§æµè§ˆä¸Šä¸‹æ–‡ window å¯¹è±¡ï¼Œé€šè¿‡è®¿é—® window.parent å¯ä»¥è·å–çˆ¶æµè§ˆä¸Šä¸‹æ–‡çš„ window å¯¹è±¡ã€‚\nif(window.top !== window) {}\n```\n\nå¦‚æœä¸»åº”ç”¨æ˜¯åœ¨ç©ºç™½çš„æ ‡ç­¾é¡µæ‰“å¼€ï¼Œé‚£ä¹ˆä¸»åº”ç”¨æ˜¯ä¸€ä¸ªé¡¶çº§æµè§ˆä¸Šä¸‹æ–‡ï¼Œé¡¶çº§æµè§ˆå™¨ä¸Šä¸‹æ–‡æ—¢ä¸æ˜¯åµŒå¥—çš„æµè§ˆä¸Šä¸‹æ–‡ï¼Œè‡ªèº«ä¹Ÿæ²¡æœ‰çˆ¶æµè§ˆä¸Šä¸‹æ–‡ã€‚\n\n**iframe æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼š**\n\n- å¤©ç„¶çš„ js. css éš”ç¦»ï¼Œçœçš„å†™ sandbox äº†\n- ç§»æ¤æ€§å’Œå¤ç”¨æ€§å¥½ï¼ŒæŠ€æœ¯æ ˆç‹¬ç«‹ï¼Œå¯ä»¥ä¾¿æ·åœ°åµŒåœ¨ä¸åŒçš„ä¸»åº”ç”¨ä¸­\n- å¯ä»¥åœ¨è¿è¡Œæ—¶åšåˆ°åŠ¨æ€åŒ–ä¿®æ”¹\n- åˆ‡æ¢å¾®åº”ç”¨ä¸éœ€è¦åˆ·æ–°ä¸»åº”ç”¨\n- å¤©ç„¶çš„åº”ç”¨é—´èµ„æºæ‡’åŠ è½½ï¼Œæ²¡æœ‰åŠ è½½å­åº”ç”¨ï¼Œå…¶èµ„æºä¹Ÿä¸ä¼šè¢«åŠ è½½ã€‚\n\n\u003e ç„¶è€Œ iframe æ–¹æ¡ˆæœ‰å“ªäº›é—®é¢˜å‘¢ï¼Ÿ\n\n**ä¸è¶³ï¼š**\n\n- é¦–æ¬¡åŠ è½½ iframe åº”ç”¨æ—¶ï¼Œä¼šå› ä¸ºæœåŠ¡ç«¯è¯·æ±‚è€Œå¯¼è‡´å†…å®¹åŒºå¸¦æ¥çŸ­æš‚çš„ç™½å±æ•ˆæœ\n- ä¸»åº”ç”¨åˆ·æ–°æ—¶ï¼Œiframe æ— æ³•ä¿æŒ URL çŠ¶æ€ï¼ˆä¼šé‡æ–°åŠ è½½ src å¯¹åº”çš„åˆå§‹ URLï¼‰ï¼›\n- ä¸»åº”ç”¨å’Œ iframe å¤„äºä¸åŒçš„æµè§ˆä¸Šä¸‹æ–‡ï¼Œæ— æ³•ä½¿ iframe ä¸­çš„æ¨¡æ€æ¡†ç›¸å¯¹äºä¸»åº”ç”¨å±…ä¸­ï¼›\n- ä¸»åº”ç”¨å’Œ iframe å¾®åº”ç”¨çš„æ•°æ®çŠ¶æ€åŒæ­¥é—®é¢˜ï¼šæŒä¹…åŒ–æ•°æ®å’Œé€šä¿¡ã€‚\n- å¯¹äºéåå°ç®¡ç†ç³»ç»Ÿè€Œè¨€ï¼Œä½¿ç”¨ iframe è¿˜éœ€è¦è€ƒè™‘ SEO. ç§»åŠ¨ç«¯å…¼å®¹æ€§. åŠ è½½æ€§èƒ½ç­‰é—®é¢˜ã€‚\n- ä¸»/å­åº”ç”¨ cookie å…±äº«é—®é¢˜ï¼ˆæ¯”å¦‚å…ç™»ï¼‰\n\n## 5. iframe æ–¹æ¡ˆ cookie å…±äº«\n\n\u003e å…¶ä»–æ–¹æ¡ˆçš„ cookie å…±äº«ä¹Ÿç±»ä¼¼\n\n#### åŒåŸŸ\n\n```js\napp.get(\"/\", function (req, res) {\n  // è®¾ç½®ä¸»åº”ç”¨çš„ cookie æ ‡è¯†\n  res.cookie(\"cookie-test\", \"123\");\n  // ä½¿ç”¨ ejs æ¨¡ç‰ˆå¼•æ“å¡«å……ä¸»åº”ç”¨ public/main.html ä¸­çš„ micro å˜é‡ï¼Œå¹¶å°†å…¶æ¸²æŸ“åˆ°æµè§ˆå™¨\n  res.render(\"main\", {\n    // micro æŒ‡å‘å¾®åº”ç”¨çš„æ‰“å¼€åœ°å€\n    micro: `http://${host}:${port.main}/micro`,\n  });\n});\n\n// å¾®åº”ç”¨å’Œä¸»åº”ç”¨åŒåŸŸï¼Œåªæ˜¯æœåŠ¡è·¯ç”±ä¸åŒ\napp.get(\"/micro\", function (req, res) {\n  // è®¾ç½® iframe å¾®åº”ç”¨çš„ cookie æ ‡è¯†ï¼Œé¡ºä¾¿è§‚å¯Ÿèƒ½å¦è¦†ç›–ä¸»åº”ç”¨çš„ cookie æ ‡è¯†\n  // åŒåŸŸæ—¶å…±äº«cookieï¼Œå­åº”ç”¨ä¼šæ”¹åŠ¨ä¸»åº”ç”¨çš„cookie\n  res.cookie(\"micro-app\", \"true\").cookie(\"cookie-test\", \"456\");\n  // æ¸²æŸ“ views/micro.html\n  res.render(\"micro\");\n});\n```\n\nç»“è®ºï¼šä¸»å­åº”ç”¨å¯ä»¥å…±äº« Cookie æ•°æ®ï¼Œä½†æ˜¯å­˜åœ¨åŒåå±æ€§å€¼è¢«è¦†ç›–çš„é£é™©\n\n#### åŒç«™ä¸åŒåŸŸ\n\nä¸»åº”ç”¨ï¼š\n\n```js\n// ä½¿ç”¨ iHosts é…ç½® example.com æŒ‡å‘æœ¬æœºçš„ ip åœ°å€ï¼Œæ¨¡æ‹ŸåŒç«™\n// ä¸»åº”ç”¨è®¿é—®åœ°å€ï¼šhttp://example.com:4000\napp.get(\"/\", function (req, res) {\n  res.cookie(\"cookie-test\", \"456\");\n  // ä½¿å­åŸŸçš„å¾®åº”ç”¨å¯ä»¥å…±äº« Cookie\n  // åœ¨è®¾ç½® Cookie æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ Domainå’Œ Path æ¥æ ‡è®°ä½œç”¨åŸŸ\n  // é»˜è®¤ä¸æŒ‡å®šçš„æƒ…å†µä¸‹ï¼ŒDomain å±æ€§ä¸ºå½“å‰åº”ç”¨çš„ hostï¼Œç”±äº xiaodududududuo.example.com å’Œ example.com ä¸åŒ\n  // å› æ­¤é»˜è®¤æƒ…å†µä¸‹ä¸¤è€…ä¸èƒ½å…±äº« Cookieï¼Œå¯ä»¥é€šè¿‡è®¾ç½® Domain ä½¿å…¶ä¸ºå­åŸŸè®¾ç½® Cookieï¼Œä¾‹å¦‚ Domain=example.comï¼Œåˆ™ Cookie ä¹ŸåŒ…å«åœ¨å­åŸŸ xiaodududududuo.example.com ä¸­\n  res.cookie(\"main-cookie-test\", \"true\", { domain: \"example.com\" }); // æ ¸å¿ƒä»£ç \n  res.render(\"main\", {\n    // ä½¿ç”¨ iHosts é…ç½® xiaodududududuo.example.com æŒ‡å‘æœ¬æœºçš„ ip åœ°å€\n    // å­åº”ç”¨è®¿é—®åœ°å€ï¼š http://xiaodududududuo.example.com:3000\n    micro: `http://xiaodududududuo.example.com:${port.micro}`,\n  });\n});\n```\n\nå­åº”ç”¨ï¼š\n\n```js\napp.get(\"/\", function (req, res) {\n  // è®¾ç½® iframe å¾®åº”ç”¨çš„ cookie æ ‡è¯†ï¼Œé¡ºä¾¿è§‚å¯Ÿèƒ½å¦è¦†ç›–ä¸»åº”ç”¨çš„ cookie æ ‡è¯†\n  res.cookie(\"micro-app\", \"true\").cookie(\"cookie-test\", \"123\");\n  res.render(\"micro\");\n});\n```\n\nç»“è®ºï¼šé»˜è®¤æƒ…å†µæ— æ³•å…±äº«ï¼Œä½†æ˜¯é€šè¿‡è®¾ç½® Domain ä½¿å¾—ä¸¤ä¸ªåº”ç”¨å¯ä»¥å…±äº«å½¼æ­¤çš„ Cookieã€‚\n\n#### è·¨ç«™\n\nä»£ç å°±ä¸ç”¨æ¼”ç¤ºäº†ï¼Œä¸¤ä¸ªå®Œå…¨ä¸åŒçš„åœ°å€ä½œä¸ºä¸»/å­æœåŠ¡ï¼Œç›´æ¥è¯´ç»“è®ºï¼šå­åº”ç”¨é»˜è®¤æ— æ³•æºå¸¦ Cookieï¼ˆé˜²æ­¢ CSRF æ”»å‡»ï¼‰ï¼Œéœ€è¦ä½¿ç”¨ HTTPS åè®®å¹¶è®¾ç½®æœåŠ¡ç«¯ Cookie çš„ SameSite å’Œ Secure è®¾ç½®æ‰è¡Œï¼Œå¹¶ä¸”å­åº”ç”¨æ— æ³•å’Œä¸»åº”ç”¨å½¢æˆ Cookie å…±äº«\n\n\u003e æœ¬åœ°å¯ä»¥ä½¿ç”¨ ngrok æ¨¡æ‹Ÿè·¨ç«™\n\n## 6. å‰©ä½™ç¼ºç‚¹\n\n- é¦–æ¬¡åŠ è½½ç™½å±æ•ˆæœï¼ˆå¯ä»¥ä½¿ç”¨é¢„åŠ è½½. é¢„æ¸²æŸ“ç­‰ä¼˜åŒ–æªæ–½ï¼‰\n- iframe æ— æ³•ä¿æŒ URL çŠ¶æ€ï¼ˆä¸»å­åº”ç”¨éœ€è¦åš history çš„ä»£ç†ï¼Œå…¨å±€ä½¿ç”¨ä¸€ä¸ªå•ä¾‹ï¼‰\n- æ¨¡æ€æ¡†ç›¸å¯¹äºä¸»åº”ç”¨å±…ä¸­é—®é¢˜ï¼ˆåŒä¸Šï¼Œä¸»å­åº”ç”¨éœ€åš window å¯¹è±¡ä»£ç†ï¼Œå¼¹çª—ç›¸å¯¹äº body ç½®äºé¡¶å±‚ï¼‰\n- æ•°æ®çŠ¶æ€åŒæ­¥é—®é¢˜ï¼ˆåŒä¸Šï¼Œä¸»å­åº”ç”¨éœ€åš window å¯¹è±¡ä»£ç†ï¼Œä¸»å­åº”ç”¨è®¾ç½®é€šä¿¡æœºåˆ¶ä¼ é€’äº‹ä»¶å¯¹è±¡ç­‰ï¼‰\n- SEO. ç§»åŠ¨ç«¯å…¼å®¹æ€§. åŠ è½½æ€§èƒ½ï¼š ï¼Ÿ\n\n----"])</script><script>self.__next_f.push([1,"1c:T17d8,"])</script><script>self.__next_f.push([1,"äºŒå‰æ ‘æ˜¯ä¸€ç§è®¡ç®—æœºåŸºç¡€æ•°æ®ç»“æ„ï¼Œæœ€è¿‘åœ¨å†™æ ‘ç»„ä»¶çš„æ—¶å€™æœ‰ç”¨åˆ°äº†è¿™ä¸ªåŸºæœ¬çŸ¥è¯†ï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹ã€‚\n\n## 1. å¼•\n\nå®ƒçš„å®é™…ä½¿ç”¨åœºæ™¯éå¸¸å¹¿æ³›ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„äºŒå‰æ ‘åº”ç”¨åœºæ™¯ï¼š\n\n*   æ–‡ä»¶ç³»ç»Ÿï¼šæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç»“æ„å¯ä»¥ä½¿ç”¨äºŒå‰æ ‘è¡¨ç¤ºï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ï¼Œé€šè¿‡å·¦å­èŠ‚ç‚¹å’Œå³å­èŠ‚ç‚¹è¿æ¥å½¢æˆå±‚çº§ç»“æ„ã€‚\n*   æ•°æ®åº“ç´¢å¼•ï¼šæ•°æ®åº“ç´¢å¼•é€šå¸¸ä½¿ç”¨äºŒå‰æ ‘å®ç°ï¼Œæ¯”å¦‚äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰ç”¨äºå¿«é€Ÿæœç´¢å’Œæ£€ç´¢æ•°æ®ã€‚\n*   è¡¨è¾¾å¼è§£æå’Œè®¡ç®—ï¼šäºŒå‰æ ‘å¯ä»¥ç”¨äºè§£æå’Œè®¡ç®—è¡¨è¾¾å¼ï¼Œå¦‚æ•°å­¦è¡¨è¾¾å¼. å¸ƒå°”è¡¨è¾¾å¼ç­‰ã€‚\n*   å›¾åƒå¤„ç†ï¼šåœ¨å›¾åƒå¤„ç†ä¸­ï¼ŒäºŒå‰æ ‘å¸¸ç”¨äºå›¾åƒå‹ç¼©ç®—æ³•ï¼ˆå¦‚å“ˆå¤«æ›¼ç¼–ç ï¼‰å’Œå›¾åƒæ¸è¿›å¼åŠ è½½ã€‚\n*   è·¯ç”±ç®—æ³•ï¼šåœ¨ç½‘ç»œè·¯ç”±ä¸­ï¼ŒäºŒå‰æ ‘å¯ä»¥ç”¨äºæ„å»ºè·¯ç”±è¡¨ï¼Œå¸®åŠ©ç¡®å®šæ•°æ®åŒ…çš„ä¼ è¾“è·¯å¾„ã€‚\n*   è§£ææ ‘ï¼šäºŒå‰æ ‘å¯ä»¥ç”¨äºæ„å»ºè§£ææ ‘ï¼Œç”¨äºè§£æå’Œç†è§£è‡ªç„¶è¯­è¨€. ç¼–ç¨‹è¯­è¨€ç­‰ç»“æ„åŒ–æ•°æ®ã€‚\n*   äººå·¥æ™ºèƒ½å’Œå†³ç­–æ ‘ï¼šå†³ç­–æ ‘æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œå¸¸ç”¨äºäººå·¥æ™ºèƒ½ä¸­çš„åˆ†ç±»å’Œå†³ç­–é—®é¢˜ã€‚\n*   å †å’Œä¼˜å…ˆé˜Ÿåˆ—ï¼šäºŒå‰å †æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ç»“æ„ï¼Œç”¨äºå®ç°ä¼˜å…ˆé˜Ÿåˆ—å’Œå †æ’åºç®—æ³•ã€‚\n*   ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨ï¼šåœ¨ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨ä¸­ï¼ŒäºŒå‰æ ‘å¸¸ç”¨äºè¯­æ³•åˆ†æå’Œæ„å»ºæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚\n*   æ•°æ®å‹ç¼©ï¼šäºŒå‰æ ‘å¸¸ç”¨äºæ•°æ®å‹ç¼©ç®—æ³•ï¼Œå¦‚éœå¤«æ›¼ç¼–ç ï¼ˆHuffman Codingï¼‰ï¼Œé€šè¿‡æ ‘çš„æ„å»ºå’Œè·¯å¾„ç¼–ç æ¥å®ç°æ•°æ®çš„é«˜æ•ˆå‹ç¼©å’Œè§£å‹ç¼©ã€‚\n*   çº¿æ®µæ ‘ï¼šçº¿æ®µæ ‘æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œç”¨äºå¤„ç†åŒºé—´æŸ¥è¯¢é—®é¢˜ï¼Œå¦‚åŒºé—´æœ€å°å€¼. åŒºé—´å’Œç­‰ã€‚\n*   ç´¢å¼•ç»“æ„ï¼šäºŒå‰æ ‘å¯ç”¨äºæ„å»ºå„ç§ç´¢å¼•ç»“æ„ï¼Œå¦‚Bæ ‘å’ŒB+æ ‘ï¼Œç”¨äºå¿«é€Ÿçš„æ•°æ®åº“æŸ¥è¯¢å’Œç´¢å¼•æ“ä½œã€‚\n*   çº¿ç´¢äºŒå‰æ ‘ï¼šçº¿ç´¢äºŒå‰æ ‘æ˜¯ä¸€ç§ä¼˜åŒ–çš„äºŒå‰æ ‘ç»“æ„ï¼Œé€šè¿‡æ·»åŠ é¢å¤–çš„çº¿ç´¢ä¿¡æ¯ï¼Œå¯ä»¥å¿«é€Ÿè¿›è¡Œä¸­åºéå†. å‰åºéå†ç­‰æ“ä½œã€‚\n*   ç¼“å­˜å®ç°ï¼šLRU Cacheï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ç¼“å­˜ï¼‰å¸¸ä½¿ç”¨åŒå‘é“¾è¡¨å’ŒäºŒå‰æ ‘ï¼ˆå¦‚çº¢é»‘æ ‘ï¼‰ç›¸ç»“åˆçš„æ–¹å¼å®ç°ï¼Œä»¥å¿«é€Ÿæ’å…¥. åˆ é™¤å’ŒæŸ¥æ‰¾æœ€è¿‘ä½¿ç”¨çš„æ•°æ®ã€‚\n\näºŒå‰æ ‘ä¸€ä¸ªé‡è¦çš„ç®—æ³•å°±æ˜¯ä»–çš„çš„éå†ï¼Œåœ¨ASTç¼–è¯‘å™¨å¼€å‘. è·¯ç”±å¯¼èˆª. æ–‡ä»¶ç³»ç»Ÿç­‰ç­‰ä¸šåŠ¡åœºæ™¯ä¸­éƒ½åœ¨å¹¿æ³›çš„ä½¿ç”¨ã€‚\n\n## 2. æ„å»ºä¸€ä¸ªäºŒå‰æ ‘\n\näºŒå‰æ ‘æœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œæ‰€æœ‰çš„çˆ¶èŠ‚ç‚¹æœ€å¤šåªèƒ½æœ‰ä¸¤ä¸ªå­©å­ã€‚æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªäºŒå‰æ ‘å¦‚ä¸‹ï¼š\n\n![image.png](/img/posts/2023-12-6/2023-12-6-1.png)\n\nä»£ç ç»“æ„å¦‚ä¸‹ï¼š\n\n```js\nconst tree = {\n  name: 1,\n  children: [\n    {\n      name: 2,\n      children: [\n        {\n          name: 4,\n          children: [{ name: 8 }],\n        },\n        { name: 5 },\n      ],\n    },\n    {\n      name: 3,\n      children: [{ name: 6 }, { name: 7 }],\n    },\n  ],\n};\n```\n\næ¥ä¸‹æ¥ç»“åˆå›¾å½¢ï¼Œç”¨ä»£ç æ¥å®ç°ä¸€ä¸‹ä»–çš„éå†ï¼š\n\n## 3. éå†\n\n### å±‚æ¬¡éå†\n\næŒ‰ç…§å±‚çº§éå†\n\nç®—æ³•æ€è·¯ï¼š\n\n*   å»ºç«‹ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå°†å…¶å­èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä»å·¦è‡³å³å…¥é˜Ÿ\n*   éå†é˜Ÿåˆ—å¹¶å‡ºé˜Ÿï¼Œé‡å¤ç¬¬äºŒæ­¥ååŠéƒ¨åˆ†\n*   é˜Ÿåˆ—ä¸ºç©ºåˆ™éå†ç»“æŸ\n\n\n![image.png](/img/posts/2023-12-6/2023-12-6-2.png)\n\n```js\nfunction traverse(node) {\n  if (!node) {\n    return;\n  }\n\n  const queue = [];\n  queue.unshift(node);\n\n  while (queue.length \u003e 0) {\n    const printNode = queue.pop();\n    console.log(printNode.name);\n    if (printNode.children \u0026\u0026 printNode.children.length \u003e 0) {\n      queue.unshift(...printNode.children.slice().reverse());\n    }\n  }\n}\n```\n\n### å…ˆåºéå†\n\né€’å½’å®ç°\n\n*   ä»æ ¹èŠ‚ç‚¹å¼€å§‹\n*   å°†å·¦å³èŠ‚ç‚¹å½“åšå­æ ‘ï¼Œå…ˆéå†å·¦èŠ‚ç‚¹ï¼Œå†éå†å³èŠ‚ç‚¹\n*   ç›´åˆ°å½“å‰èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ä¸ºæ­¢\n\n```js\nfunction preOrderTraverse(root) {\n  if (root != null) {\n    const children = root.children || [];\n    console.log(root.name);\n    preOrderTraverse(children[0]);\n    preOrderTraverse(children[1]);\n  }\n}\n```\n\néé€’å½’å®ç°\n\n*   å»ºç«‹ä¸€ä¸ªæ ˆï¼Œå…¥æ ˆæ ¹èŠ‚ç‚¹\n*   å‡ºæ ˆå½“å‰èŠ‚ç‚¹ï¼Œå°†å½“å‰èŠ‚ç‚¹å­èŠ‚ç‚¹é›†åˆé€†å‘å…¥æ ˆ\n*   é‡å¤ç¬¬äºŒæ­¥ï¼Œç›´åˆ°æ ˆç©º\n\n\n![image.png](/img/posts/2023-12-6/2023-12-6-3.png)\n\n```js\nfunction preOrderTraverse(node) {\n  if (!node) return;\n\n  const track = [];\n  track.push(node);\n\n  while (track.length \u003e 0) {\n    const node = track.pop();\n    console.log(node.name);\n    const children = node.children;\n    if (children \u0026\u0026 children.length \u003e 0) {\n      track.push(...children.reverse());\n    }\n  }\n}\n```\n\n\u003e æ€è€ƒï¼šå­¦ä¼šäº†å…ˆåºéå†ï¼Œç›¸ä¿¡ä½ åº”è¯¥èƒ½å¤Ÿå¾ˆå®¹æ˜“çš„å†™å‡ºååºéå†çš„å®ç°ï¼\n\n### ä¸­åºéå†\n\néé€’å½’å®ç°\n\n*   å»ºç«‹ä¸€ä¸ªæ ˆï¼Œå…¥æ ˆæ ¹èŠ‚ç‚¹\n*   è‹¥æœ‰å·¦å­èŠ‚ç‚¹ï¼Œåˆ™å…¥æ ˆï¼Œç›´åˆ°æ²¡æœ‰å·¦å­èŠ‚ç‚¹æ—¶å‡ºæ ˆæ ˆé¡¶å…ƒç´ å¹¶æ‰“å°ï¼Œå…¥æ ˆæ ˆé¡¶å…ƒç´ çš„å³å­èŠ‚ç‚¹\n*   é‡å¤ç¬¬äºŒæ­¥ï¼Œç›´åˆ°æ²¡æœ‰å¯ç”¨å…ƒç´ ä¸”æ ˆç©ºä¸ºæ­¢\n\n\n![image.png](/img/posts/2023-12-6/2023-12-6-4.png)\n\n```js\nfunction middleOrderTraverse(node) {\n  if (!node) return;\n\n  const stack = [];\n  let currentNode = node;\n  while (currentNode || stack.length \u003e 0) {\n    if (currentNode) {\n      stack.push(currentNode);\n      currentNode =\n        currentNode \u0026\u0026 currentNode.children ? currentNode.children[0] : null;\n    } else {\n      const poped = stack.pop();\n      console.log(poped.name);\n      currentNode = poped.children ? poped.children[1] : null;\n    }\n  }\n}\n```\n\n### é“¾è¡¨å®ç°\n\né“¾è¡¨ä¸é€‚åˆåšå¹¿åº¦ä¼˜å…ˆéå†ï¼Œä¸‹é¢ç¤ºæ„å›¾ä¸­ï¼Œæ·±åº¦ä¼˜å…ˆä¼šéå¸¸çš„æ–¹ä¾¿ã€‚æˆ‘ä»¬æ‹¿ react fiber çš„ç»“æ„æ¥ä¸¾ä¾‹ã€‚\n\n\n![image.png](/img/posts/2023-12-6/2023-12-6-5.png)\n\n*   éå†æ€è·¯ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä»¥æ­¤éå†æ¯ä¸€ä¸ªç»è¿‡çš„èŠ‚ç‚¹çš„ child å’Œ sibling\n\nä¼ªä»£ç å®ç°ï¼š\n\n```js\nfunction linkedListTraverse(root) {\n  let wip = root;\n\n  while (wip) {\n    console.log(wip);\n\n    if (wip.child) {\n      temp = wip.child;\n      wip.child = null; // éå†è¿‡å°±å‰”é™¤\n      wip = temp;\n      continue;\n    }\n\n    if (wip.sibling) {\n      temp = wip.sibling;\n      wip.sibling = null; // éå†è¿‡å°±å‰”é™¤\n      wip = temp;\n      continue;\n    }\n\n    wip = wip.return;\n  }\n}\n```"])</script><script>self.__next_f.push([1,"1d:T68a2,"])</script><script>self.__next_f.push([1,"2023 å¹´ï¼Œ CSS é¢†åŸŸæœ‰äº†æ–°çš„å˜åŒ–ï¼Œæ•´ä½“è¶‹åŠ¿æ˜¯æ›´åŠ çš„æ˜“ç”¨ï¼Œå¹¶è´´åˆæµè¡Œçš„æ¡†æ¶åšäº†æ‰©å±•ã€‚Chrome çš„å¼€å‘è€… blog å’Œ MDN é‡Œæ›´æ–°äº†ä¸€äº›æ¯”è¾ƒæœ‰æ„æ€çš„ CSS 2023 åŠ¨å‘çš„å†…å®¹ï¼Œæ–‡ç« æ¯”è¾ƒé•¿ï¼Œå†…å®¹æœ‰ç‚¹ä¹±ï¼Œè¿™é‡Œæ€»ç»“åˆ†äº«ä¸€ä¸‹ç»™å¤§å®¶ã€‚\n\n## 1. æ‘˜è¦\n\næœ¬æ–‡æ˜¯ â€œ2023 å¹´åº¦æŠ€æœ¯ç›˜ç‚¹â€ ç³»åˆ—æ–‡ç« ï¼Œä¸»è¦ä»‹ç»å‰ç«¯ CSS é¢†åŸŸåœ¨ 2023 å¹´çš„é‡è¦è¿›å±•ã€‚æœ¬æ–‡ä» CSS åŸºç¡€åŠŸèƒ½ã€æ’ç‰ˆã€é¢œè‰²ã€è‡ªé€‚åº”è®¾è®¡ã€äº¤äº’å’Œç»„ä»¶ç­‰æ–¹é¢è¿›è¡Œç›˜ç‚¹ã€‚\n\n\u003e å¯ä»¥æŸ¥çœ‹æ–‡ç« ç›®å½•ä»¥é€‰æ‹©æŸ¥çœ‹è‡ªå·±æ„Ÿå…´è¶£çš„æ›´æ–°\n\n## 2. åŸºç¡€åŠŸèƒ½\n\ncss æ–°å¢äº†ä¸‰è§’å‡½æ•°ç›¸å…³å‡½æ•°ï¼š`sin()`ã€`cos()`ã€`tan()`ã€`asin()`ã€`acos()`ã€`atan()` å’Œ `atan2()`ã€‚\n\nä¸‰è§’å‡½æ•°çš„ä½¿ç”¨è¦å’Œ `calc` ç»“åˆæ‰èƒ½å‡ºæ•ˆæœã€‚\n\n#### ä¸‰è§’å‡½æ•°\n\n![image.png](/img/posts/2024-1-2/2024-1-2-1.png)\n\n-   `cos()`ï¼šè¿”å›è§’åº¦çš„ä½™å¼¦å€¼ï¼Œè¯¥å€¼ä»‹äºÂ `-1`Â å’ŒÂ `1`Â ä¹‹é—´ã€‚\n-   `sin()`ï¼šè¿”å›è§’åº¦çš„æ­£å¼¦å€¼ï¼Œè¯¥å€¼ä»‹äºÂ `-1`Â å’ŒÂ `1`Â ä¹‹é—´ã€‚\n-   `tan()`ï¼šè¿”å›è§’åº¦çš„æ­£åˆ‡å€¼ï¼Œå–å€¼ä»‹äºÂ `âˆ’âˆ`Â å’ŒÂ `+âˆ`Â ä¹‹é—´ã€‚\n\nä»¥æ­£å¼¦ä¸ºä¾‹ï¼Œä½ å¯ä»¥è¿™ä¹ˆå†™ï¼š`width: calc(sin(var(--angle)) * 200px);` æ¥è®¡ç®—å®½åº¦å€¼ã€‚\n\næˆ‘ä»¬å®ç°ä¸€ä¸ªè®¡ç®—è§’åº¦å‚çº¿é•¿åº¦çš„é—®é¢˜æ¥è¯´æ˜ sin çš„ç”¨æ³•ã€‚ä¸‹é¢çš„ä¾‹å­é‡Œï¼Œç»¿è‰²è™šçº¿çš„é•¿åº¦å°±æ˜¯ `æ–œè¾¹ï¼ˆ200pxï¼‰* sin(è§’åº¦)` è®¡ç®—å‡ºæ¥çš„ï¼š\n\n[å®ç° sin è®¡ç®—ä¸‰è§’å½¢è¾¹é•¿](https://code.juejin.cn/pen/7317184041529114662)\n\n\u003e ç”±äº chrome çš„ css ä¸æ”¯æŒ rem() å’Œ mod() ç­‰å–æ¨¡å‡½æ•°ï¼Œæ‰€ä»¥ç”¨äº†ä¸¤ä¸ª css å˜é‡è¡¨ç¤º 180deg å‰åçš„è§’åº¦\n\n\u003e ç ä¸Šæ˜é‡‘æ€ä¹ˆä¸æ”¯æŒç›´æ¥é¢„è§ˆäº†ï¼Œæˆ‘æ”¾ä¸ªæˆªå›¾å§...\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-2.png)\n\n\nåŒç†ï¼Œcos å’Œ tan å¯ä»¥å¦‚ä¸‹ä½¿ç”¨ï¼š\n\n```css\ntransform: scaleX(cos(var(--angle)))\ntransform: scaleX(tan(var(--angle)));\n```\n\nå®˜æ–¹demoï¼šhttps://codepen.io/web-dot-dev/pen/NWLxROo\n\n#### åä¸‰è§’å‡½æ•°\n\nåä¸‰è§’å‡½æ•°æ˜¯ä¸‰è§’å‡½æ•°çš„é€†è¿ç®—ï¼ŒåŒ…å«ï¼š`asin()`ã€`acos()`ã€`atan()`Â å’ŒÂ `atan2()`ã€‚å‰ä¸‰ä¸ªæ¥å—ä¸€ä¸ªæ•°å€¼ï¼Œè¿”å›å¯¹åº”çš„è§’åº¦å€¼ã€‚\n\nç¬¬å››ä¸ª `atan2()`ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°Â `A`Â å’ŒÂ `B`ã€‚è¿”å› X è½´æ­£è½´ä¸Â `(B, A)`Â ç‚¹ä¹‹é—´çš„è§’åº¦ã€‚\n\n\u003e atan2å¯¹è±¡é™æ•æ„Ÿï¼Œæ ¹æ®ä¸¤ä¸ªå‚æ•°åˆ¤æ–­å®ƒæ˜¯å±äºå“ªä¸ªè±¡é™å¹¶ç»™å‡ºå¯¹åº”çš„è§’åº¦å€¼ï¼Œå€¼åŸŸèŒƒå›´[-pi, pi]ï¼›atanå¯¹è±¡é™ä¸æ•æ„Ÿï¼Œå€¼åŸŸèŒƒå›´ä¸º[-pi/2, pi/2]\n\nä¸‹é¢è¿˜æ˜¯ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ `atan()`Â å’ŒÂ `atan2()` çš„åŒºåˆ«ã€‚\n\n[åä¸‰è§’å‡½æ•°ç¤ºä¾‹](https://code.juejin.cn/pen/7317462707643351092)\n\nä¸‹ä¸€ä¸ªæ–°åŠŸèƒ½æ˜¯ `n-*` çš„é€‰æ‹©å™¨ã€‚å¤§å®¶ä¹‹å‰ä¹Ÿéƒ½ç”¨è¿‡è¯¸å¦‚ :nth-of-type è¿™æ ·çš„ä¼ªç±»æ¥å®ç°å…ƒç´ é€‰æ‹©ï¼Œç°åœ¨å®˜æ–¹å¢å¼ºäº†è¿™ä¸ªåŠŸèƒ½ï¼Œä½¿ç”¨ S è¯­æ³•æ¥æ›´å¥½åœ°æ§åˆ¶ :nth-child() é€‰æ‹©ï¼š `:nth-child()`Â å’ŒÂ `:nth-last-child()`ã€‚\n\n#### n-* é€‰æ‹©å™¨ ä¸ S è¯­æ³•\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-3.png)\n\nä½¿ç”¨ä¾‹å­ï¼š\n\n-   `:nth-child(2)`ï¼šé€‰æ‹©ç¬¬äºŒä¸ªå­çº§ã€‚\n-   `:nth-child(2n)`ï¼šé€‰æ‹©æ‰€æœ‰å¶æ•°å­é¡¹ï¼ˆä¾‹å¦‚ 2ndã€4thã€6thã€8th ç­‰ï¼‰ã€‚**\n-   `:nth-child(2n+1)`ï¼šé€‰æ‹©æ‰€æœ‰å¥‡æ•°å­é¡¹ï¼ˆç¬¬ 1ã€3ã€5ã€7ï¼Œä¾æ­¤ç±»æ¨ï¼‰ã€‚**\n-   `:nth-child(5n+1)`ï¼šé€‰æ‹©ç¬¬ 1 ä¸ªÂ  *(=(5Ã—0)+1)* ã€ç¬¬ 6 ä¸ªÂ  *(=(5Ã—1)+1)* ã€ç¬¬ 11 ä¸ªÂ  *(=(5Ã—2)+1)* ...å­çº§ã€‚\n-   `:nth-child(5n+2)`ï¼šé€‰æ‹©ç¬¬ 2 ä¸ªÂ  *(=(5Ã—0)+2)* ã€ç¬¬ 7 ä¸ªÂ  *(=(5Ã—1)+2)* ã€ç¬¬ 12 ä¸ªÂ  *(=(5Ã—2)+2)* ... å­é¡¹ã€‚\n\né‡Œè¾¹çš„é€‰æ‹©é¡¹å¯ä»¥æ˜¯ç­‰å·®æ•°åˆ—ï¼Œç­‰æ¯”æ•°åˆ—ï¼Œæˆ–è€…æ˜¯è‡ªå®šä¹‰çš„ä»»æ„æ•°åˆ—ï¼Œç”šè‡³å¯ä»¥ç»„åˆä½¿ç”¨ï¼š\n\n-   `:nth-child(n+3)`ï¼šé€‰æ‹©ä»ç¬¬ 3 ä¸ªå¼€å§‹çš„æ¯ä¸ªå­çº§ã€‚\n-   `:nth-child(-n+5)`ï¼šé€‰æ‹©ä¸è¶…è¿‡ç¬¬ 5 ä¸ªå­çº§ï¼ˆç¬¬ 1 ä¸ªã€ç¬¬ 2 ä¸ªã€ç¬¬ 3 ä¸ªã€ç¬¬ 4 ä¸ªã€ç¬¬ 5 ä¸ªã€‚\n-   `:nth-child(n+3):nth-child(-n+5)`ï¼šé€‰æ‹©ç¬¬ 3 ä¸ªåˆ°ç¬¬ 5 ä¸ªï¼ˆç¬¬ 3 ä¸ªã€ç¬¬ 4 ä¸ªã€ç¬¬ 5 ä¸ªï¼‰çš„æ¯ä¸ªå­çº§ã€‚\n\nåŒç†ï¼Œ`:nth-last-child()`Â ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œç±»ä¼¼çš„é€‰æ‹©ï¼Œä½†ä¸æ˜¯ä»å¤´å¼€å§‹è®¡æ•°ï¼Œè€Œæ˜¯ä»å¤´å¼€å§‹è®¡æ•°ã€‚\n\nä¸‹é¢ç»™ä¸€ä¸ªåˆ›å»ºæ–‘é©¬çº¹ç¤ºä¾‹ï¼š\n\n```css\ntr:nth-child(even) {\nÂ  background-color: #E9E9E9;\n}\n\n// å¦ä¸€ç§å†™æ³•\ntr:nth-of-type(even){ \n  background: #E9E9E9;\n}\n```\n\n\u003e â€œnth-of-typeâ€å’Œâ€œnth-childâ€çš„åŒºåˆ«ï¼šp:nth-of-type(7)é€‰æ‹©çš„på…ƒç´ æ‰€åœ¨çš„çˆ¶å…ƒç´ ä¸‹çš„ç¬¬7ä¸ªPå…ƒç´ å³ï¼šç¬¬7ä¸ªpï¼›p:nth-child(6)é€‰æ‹©çš„på…ƒç´ æ‰€åœ¨çš„çˆ¶å…ƒç´ ä¸‹çš„ç¬¬6ä¸ªå­å…ƒç´ ï¼Œä¸”è¯¥å…ƒç´ æ˜¯På…ƒç´ ã€‚\n\nnth-child è¿˜å¯ä»¥ç»“åˆ S è¯­æ³•ä½¿ç”¨ï¼š\n\n```css\n:nth-child(An+B [of S]?)\n:nth-last-child(An+B [of S]?)\n```\næŒ‡å®šÂ `of S`Â åï¼Œ`An+B`Â é€»è¾‘ä»…åº”ç”¨äºä¸ç»™å®šé€‰æ‹©å™¨åˆ—è¡¨Â `S`Â åŒ¹é…çš„å…ƒç´ ã€‚è¿™å®é™…ä¸Šæ„å‘³ç€ï¼Œæ‚¨å¯ä»¥åœ¨Â `An+B`Â æ‰§è¡Œæ“ä½œä¹‹å‰é¢„å…ˆè¿‡æ»¤å­é¡¹ï¼š\n\n```css\n:nth-child(2 of .highlight) {\n  /* = Select the 2nd child element that has the class .highlight applied to it */\n  outline: 0.3rem dashed hotpink;\n  outline-offset: 0.7rem;\n}\n```\nä¸Šé¢çš„ä¾‹å­ï¼Œé€‰æ‹©äº†çˆ¶å…ƒç´ ç›’å­ä¸­ï¼Œç±»åå« highlight ä¸­çš„ç¬¬äºŒä¸ªå­å…ƒç´ ï¼ˆæ³¨æ„ä¸æ˜¯ç‰©ç†é¡ºåºçš„ç¬¬äºŒä¸ªï¼‰æ¥èµ‹å€¼æ ·å¼ã€‚\n\nå†ä¸¾ä¸ªä¾‹å­ï¼Œä¸Šé¢çš„æ–‘é©¬çº¹è¿˜å¯ä»¥å¢å¼ºï¼š\n\n```css\n// ç­›é€‰æ²¡æœ‰ hidden å±æ€§çš„åˆ—ï¼Œç„¶åå†è®¡ç®—æ–‘é©¬çº¹\ntr:nth-child(even of :not([hidden])) {\nÂ  background-color: lightgrey;\n}\n```\n\n#### `@scope`\n\n![image.png](/img/posts/2024-1-2/2024-1-2-4.png)\n\nChrome 118+ å¢åŠ äº†å¯¹Â `@scope`Â çš„æ”¯æŒï¼Œè¿™æ˜¯ä¸€é¡¹ @ è§„åˆ™ï¼Œå¯å°†é€‰æ‹©å™¨çš„èŒƒå›´é™å®šä¸ºæ–‡æ¡£çš„ç‰¹å®šå­æ ‘ï¼Œä»è€Œæ§åˆ¶ css ä½œç”¨åŸŸï¼Œè¿™å¯¹äºå°†æ¥éœ€è¦åš css éš”ç¦»çš„ä¸šåŠ¡åœºæ™¯æœ‰å¤§ç”¨å¤„ï¼š\n\n```css\n@scope (html) {\n  .warning {\n    display: none;\n  }\n}\n\n/* Only match elements in the card component, but donâ€™t target those in nested components */\n@scope (.card) to ([data-component]) {\n  img {\n    border: 0.25em solid #6300ff;\n    border-radius: 0.5em;\n  }\n}\n```\n\nä¸Šé¢çš„ç¬¬äºŒä¸ªä¾‹å­ï¼Œåªä½œç”¨äº card ç±»ï¼Œè€Œä¸ä½œç”¨äºå…¶åŒ…å«data-componentå±æ€§çš„å­å…ƒç´ ï¼Œå³ cardç±» å’Œ \\[data-component] ä¹‹é—´çš„å…ƒç´ ã€‚\n\n\nå®˜ç½‘demoï¼šhttps://codepen.io/web-dot-dev/pen/YzdOydZ\n\n#### `@layer åµŒå¥—`\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-5.png)\n\n\u003e å…¶å®è¿™ä¸ªç‰¹æ€§22å¹´å°±æœ‰äº†\n\nå®˜æ–¹ css æ˜¾ç„¶æ˜¯å¸å–äº†å„ä¸ªå‰ç«¯æ¡†æ¶å’Œé¢„å¤„ç†å™¨çš„ç»éªŒï¼Œå¹¶è¿›è¡Œäº†å‡çº§ï¼Œç°åœ¨ css ä¹Ÿè¦æ”¯æŒåµŒå¥—äº†ã€‚\n\n\nä¹‹å‰è¿™æ ·çš„å†™æ³•ï¼š\n\n```css\nul li {}\nul li .child {\n  color: red;\n}\n```\n\nç°åœ¨å¯ä»¥è¿™æ ·å†™äº†ï¼š\n\n```css\n@layer test {\n    ul {\n      li {\n        \u0026 .child {\n          color: red;\n        }\n      }\n    }\n    \n    .card {\n      \u0026--header {\n        /* is not equal to \".card--header\" */\n      }\n    }\n}\n```\n\n\u003e å½“ç„¶ç›´æ¥åµŒå¥—ï¼Œä¸ä½¿ç”¨ @layer ä¹Ÿæ˜¯å¯ä»¥çš„\n\nä½¿ç”¨å…·å `@layer` åŒ…è£¹çš„ css ç‰‡æ®µå¯ä»¥æ”¯æŒåµŒå¥—ä¼˜å…ˆçº§é…ç½®ã€‚\n\n```css\n@layer base, special;\n\n@layer special {\n  .item {\n    color: red;\n  }\n}\n\n@layer base {\n  .item {\n    color: green;\n    border: 5px solid green;\n    font-size: 1.5em;\n    padding: 0.5em;\n  }\n}\n```\né¢„å…ˆå®šä¹‰å„ä¸ªå…·ålayerçš„ä¼˜å…ˆçº§ï¼Œä»å·¦åˆ°å³ä¾æ¬¡é™ä½ï¼Œä¸Šé¢çš„ item ç±»å…ƒç´ ï¼Œæœ€åä¼šè¢«åŠ ä¸Šçº¢è‰²çš„é¢œè‰²ï¼Œè€Œä¸æ˜¯ç»¿è‰²ã€‚\n\n#### å­ç½‘æ ¼å¸ƒå±€\n\n![image.png](/img/posts/2024-1-2/2024-1-2-6.png)\n\næˆ‘ä»¬éƒ½çŸ¥é“æœ‰ grid å¸ƒå±€ï¼Œç°åœ¨è¿æ¥äº†å¢å¼ºï¼ŒåŠ å…¥äº† subgrid å¸ƒå±€ã€‚\n\næˆ‘ä»¬è¿™ä¹ˆå®šä¹‰ä¸€ä¸ªç½‘æ ¼å¸ƒå±€ï¼š\n\n```css\n.container {\nÂ  display: grid;\nÂ  gap: 1rem;\nÂ  grid-template-columns: [column-1] 20ch [column-2] 1fr;\n}\n```\nç½‘æ ¼æœ‰ä¸¤åˆ—ï¼Œä¸€åˆ—ç»™20chï¼Œä¸€åˆ—å é¢†å‰©ä½™ç©ºé—´ï¼š\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-7.png)\n\næˆ‘ä»¬ç°åœ¨å®šä¹‰å­ç½‘æ ¼ï¼š\n\n```css\n.container \u003e div {\nÂ  grid-column: span 2;\n\nÂ  display: grid;\nÂ  grid-template-columns: subgrid; /* 20ch 1fr */\n}\n```\n\n![image.png](/img/posts/2024-1-2/2024-1-2-8.png)\n\nè¿™æ ·ä¸€æ¥ï¼Œå­ div è™½ç„¶è¿˜æ˜¯å äº†ä¸€è¡Œï¼Œä½†æ˜¯ä»–ç»§æ‰¿äº†çˆ¶å…ƒç´ çš„ç½‘æ ¼å¸ƒå±€ï¼Œå³çˆ¶ç½‘æ ¼çš„åˆ—å·²ç»æœ‰æ•ˆå‘ä¸‹ä¼ é€’åˆ°å­ç½‘æ ¼ï¼Œåœ¨å„ä¸ªå­ div å†…éƒ¨å†å®ç°å¸ƒå±€æ—¶å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚æœ€æ–°çš„æµè§ˆå™¨ä¸­ä¹Ÿæ ‡æ˜äº†è¿™ç§å¸ƒå±€ï¼š\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-9.png)\n\ndemo å¦‚ä¸‹ï¼š[å­ç½‘æ ¼å¸ƒå±€ demo](https://code.juejin.cn/pen/7317532251985313830)\n\nçœ‹çœ‹ä½ çš„æµè§ˆå™¨æ”¯ä¸æ”¯æŒï¼Œå¯ä»¥è¿™æ ·ï¼š\n\n```css\n@supports (grid-template-columns: subgrid) {\n  /* safe to enhance to */\n}\n```\n\nå®˜æ–¹demoï¼šhttps://codepen.io/web-dot-dev/pen/MWLENzm\n\n## 3. æ’ç‰ˆ\n\n2023 å¹´ï¼Œcss ä¹Ÿå¼€å§‹é’ˆå¯¹æ’ç‰ˆæ›´æ–°äº†ï¼Œå¯èƒ½æ˜¯å€Ÿé‰´äº† Tailwind çš„ç»éªŒ...\n\n#### é¦–å­—æ¯\n\n![image.png](/img/posts/2024-1-2/2024-1-2-10.png)\n\nChrome 110 ä¸­æ¨å‡ºäº†Â `initial-letter`Â å±æ€§ï¼Œå¯ä»¥å°†é¦–å­—æ¯æŠ¬èµ·æˆ–é™ä½ã€‚\n\nç¤ºä¾‹ï¼š`\u003cp\u003eLorem ipsum dolor ...\u003c/p\u003e`\n\n```css\np {\n  \u0026::first-letter {\n    initial-letter: 3 2;\n    color: green;\n  }\n}\n```\n\næ ¸å¿ƒç‚¹æ˜¯ `first-letter` ä¼ªå…ƒç´ ï¼Œä»–åœ¨ DOM ç»“æ„æ ‘ä¸­ä¸ä¼šä½“ç°å‡ºæ¥ï¼ˆæ‰€ä»¥æœ‰äº›è¿·ï¼Œè°ƒè¯•æœ‰å›°éš¾ï¼Œå¹½çµå…ƒç´ ï¼Ÿï¼‰ï¼Œå…¶ä¸­å¯é€‰é¡¹ initial-letter å¯ä»¥è®¾ç½®å…¶åç§»é‡ï¼Œä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºé¦–å­—æ¯é«˜åº¦å ç”¨ 3 è¡Œï¼Œä¸‹æ²‰ 2 è¡Œï¼š\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-11.png)\n\n\u003e é¦–å­—æ¯å±æ€§åŒæ ·æ”¯æŒä¸­æ–‡\n\n#### æ–‡å­—æŠ˜è¡Œä¼˜åŒ–\n\n![image.png](/img/posts/2024-1-2/2024-1-2-12.png)\n\næ–°å¢ä¸¤ç§å†™æ³• `text-wrap: balance` å’Œ `text-wrap: pretty`ï¼Œå®˜æ–¹è§£é‡Šè¯·ç§»æ­¥ï¼šhttps://www.w3.org/TR/css-text-4/#text-wrapã€‚\n\nå‰è€…æ˜¯æµè§ˆå™¨ä¸ºæ–‡æœ¬æ‰¾å‡ºæœ€ä½³çš„å‡è¡¡æ¢è¡Œè§£å†³æ–¹æ¡ˆï¼š\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-13.png)\n\nemmï¼Œæ€ä¹ˆæ„Ÿè§‰è¿˜ä¸å¦‚åŸæ¥ã€‚ã€‚ã€‚æ¨èä½¿ç”¨ prettyï¼Œè‡³å°‘èƒ½å·¦å³å¯¹é½ã€‚\n\n## 4. é¢œè‰²\n\né¢œè‰²æ–¹é¢æ˜¯å·²æœ‰é¢œè‰²åº“çš„æ‰©å……ï¼Œå¢åŠ äº†æ›´å¤šçš„é¢œè‰²å’Œå¯é€‰é¡¹ã€‚å®˜æ–¹çš„è¯´æ³•æ˜¯ï¼ŒåŸæ¥çš„ CSS ä¸æ”¯æŒé«˜æ¸…ç”»è´¨ï¼Œè€Œå¤§å¤šæ•°äººæ”¾åœ¨å£è¢‹é‡Œã€æ”¾åœ¨èº«ä¸Šæˆ–å®‰è£…åœ¨å¢™ä¸Šçš„æ˜¾ç¤ºå±å…·æœ‰å¹¿è‰²åŸŸå’Œé«˜æ¸…è‰²å½©ã€‚æ˜¾ç¤ºå±çš„é¢œè‰²å¤„ç†é€Ÿåº¦æ¯” CSS å¿«ï¼Œç°åœ¨ CSS çš„æ›´æ–°å¯ä»¥ä¸ä¹‹ä¸€è¾ƒé«˜ä½äº†ã€‚\n\n#### é«˜æ¸… CSS\n\nCSSÂ [Color Level 4](https://www.w3.org/TR/css-color-4) æå‡ºäº†é«˜æ¸… CSS æ–¹æ¡ˆï¼Œä» Chrome 111 å¼€å§‹æ”¯æŒè‰²å½©ç©ºé—´å’Œè‰²åŸŸï¼Œä»–æ˜¯åœ¨å·²æœ‰è‰²åŸŸçš„åŸºç¡€ä¸Šçš„é¢œè‰²æ‰©å……ï¼Œä»¥é€‚åº”ç°åœ¨æ›´åŠ é«˜æ¸…æ˜¾ç¤ºçš„æ˜¾ç¤ºè®¾å¤‡ã€‚\n\nå®˜æ–¹æ¨å‡º 7 ä¸­è‰²åŸŸï¼š\n\n-   [sRGB](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#srgb)\n-   [RGB 98](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#a98-rgb)\n-   [Display p3](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#display-p3)\n-   [Rec2020](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#rec2020)\n-   [ProPhoto](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#prophoto-rgb)\n-   [ç¾å›½å•†ä¸šè¡Œä¸šä¿¡æ¯ç½² (CIE)](https://en.wikipedia.org/wiki/CIE_1931_color_space)\n-   [HVS](https://www.cs.rochester.edu/courses/572/colorvis/gamutvis.html)ï¼ˆäººåƒè‰²åŸŸï¼‰\n\né¢œè‰²ç©ºé—´æ˜¯è‰²åŸŸçš„æ’åˆ—ï¼Œå®ƒå»ºç«‹äº†å½¢çŠ¶ä»¥åŠè·å–é¢œè‰²çš„æ–¹æ³•ã€‚é¢œè‰²çº§åˆ« 4 å¼•å…¥äº† 12ä¸­é¢œè‰²ç©ºé—´ç”¨äºä»è‰²åŸŸä¸­æŸ¥æ‰¾é¢œè‰²ï¼š\n\n-   [sRGB çº¿æ€§](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#linear-srgb)\n-   [LCH](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#lch)\n-   [okLCH](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#oklch)\n-   [å®éªŒ](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#lab)\n-   [okLAB](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#oklab)\n-   [Display p3](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#display-p3)\n-   [Rec2020](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#rec2020)\n-   [a98 RGB](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#a98-rgb)\n-   [ProPhoto RGB](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#prophoto-rgb)\n-   [XYZ](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#xyz-xyz-d50-xyz-d65)\n-   [XYZ d50](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#xyz-xyz-d50-xyz-d65)\n-   [XYZ d65](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#xyz-xyz-d50-xyz-d65)\n\nä¹‹å‰åªæœ‰å››ç§é¢œè‰²ç©ºé—´ï¼š\n\n-   [Hex](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#hex), å³ 16è¿›åˆ¶é¢œè‰²\n-   [RGB](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#rgb)\n-   [HSL](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#hsl)\n-   [HWB](https://developer.chrome.com/docs/css-ui/high-definition-css-color-guide?hl=zh-cn#hwb)\n\nçŸ¥é“äº†æ¦‚å¿µï¼Œæˆ‘ä»¬æ¥çœ‹å‡ ç§æ–°çš„é¢œè‰²å®šä¹‰ã€‚\n\n###### HWB\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-14.png)\n\nHWBï¼ˆè‰²ç›¸ã€ç™½åº¦ã€é»‘åº¦ï¼‰æ˜¯é¢å‘äººç±»æè¿°é¢œè‰²çš„ sRGB è‰²åŸŸé¢œè‰²ç©ºé—´ï¼š\n\n```css\n--modern: hwb(200deg 25% 25%);\n```\n\n###### `color()`Â å‡½æ•°\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-15.png)\n\ncolor() æ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–ç©ºé—´ï¼Œç”¨äºè®¿é—®ä½¿ç”¨ RGB é€šé“çš„é¢œè‰²ç©ºé—´ã€‚è€Œä¸”å¯æ‰©å®¹è‡³åŸºäº RGB çš„ä»»ä½•å¹¿è‰²åŸŸè‰²å½©ç©ºé—´ã€‚ä½¿ç”¨ä¸¾ä¾‹ï¼š\n\n```css\n--display-p3: color(display-p3 1 1 1);\n--srgb: color(srgb 1 1 1);\n```\n\nç”šè‡³ä¹‹å‰çš„ rgb ä¹Ÿå¯ä»¥è¿™ä¹ˆç»Ÿä¸€æ¥å†™ï¼š\n\n```css\n--rgb: color(rgb 25 25 25)\n```\n\n###### å…¶ä»–\n\næ­¤å¤–è¿˜æœ‰ lch / lab / oklch / OKLAB / dispaly-p3 ç­‰é¢œè‰²ç©ºé—´ï¼Œç”±äºä¸œè¥¿å¤ªå¤šäº†ï¼Œå°±ä¸ä¸€æ ·åˆ—å‡ºï¼Œä¸Šé¢æœ‰é“¾æ¥ï¼Œå¯ä»¥è‡ªè¡Œç‚¹å‡»æŸ¥çœ‹ã€‚è¿™ç±»CIE ç©ºé—´é¢œè‰²éƒ½èƒ½å¤Ÿæ›´å¥½çš„è¡¨ç¤ºæ•´ä¸ªäººç±»å¯è§çš„è‰²è°±ã€‚ä½¿ç”¨æ–°çš„é¢œè‰²ç©ºé—´è¿˜ä¼šå½±å“é¢œè‰²æ¸å˜å’Œæ’å€¼ç­‰åŠŸèƒ½ã€‚\n\n#### color-mix()\n\n![image.png](/img/posts/2024-1-2/2024-1-2-16.png)\n\nä»–æ˜¯ç”¨äºé¢œè‰²æ··æ·†çš„å‡½æ•°ï¼Œçµæ„Ÿå¯èƒ½ä¹Ÿæ˜¯æ¥è‡ªcssé¢„å¤„ç†å™¨ã€‚\n\nå®˜æ–¹demoï¼šhttps://codepen.io/web-dot-dev/pen/JjBZLrm\n\nä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬è¿™é‡Œå®ç°ä¸€ä¸ªç®€å•çš„åˆ‡æ¢é¢œè‰²çš„ä¾‹å­ï¼š\n\n[ä¸»é¢˜é¢œè‰²åˆ‡æ¢](https://code.juejin.cn/pen/7317573307016806435)\n\nä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå„ä¸ªä¸»é¢˜çš„é¢œè‰²ï¼Œé€šè¿‡æ··æ·†å¾—æ¥ã€‚æˆ‘ä»¬æ‹¿ä¸€ä¸ªæ¥è¯´æ˜ä½¿ç”¨æ–¹å¼ã€‚\n\n`color-mix(in oklab, #0af 25%, black)`ï¼šåœ¨ oklab è‰²åŸŸç©ºé—´å†…ï¼Œå°†å¤©è“è‰²çš„25%ä¸é»‘è‰²æ··åˆã€‚æ­¤æ—¶æ–‡å­—çš„é¢œè‰²å¦‚ä¸‹ï¼š\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-17.png)\n\nçœ‹ç€æ˜¯é»‘è‰²çš„ï¼Œå…¶å®æœ‰ç‚¹è“éŸµã€‚å¦‚æœå°† 25% è°ƒæ•´åˆ° 75% å°±ä¼šæ˜æ˜¾äº†ï¼š\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-18.png)\n\n#### from å…³é”®å­—\n\nå¯ä»¥çœ‹åšæ˜¯ color-mix çš„æ‰©å±•å¢å¼ºï¼š\n\n`color: rgb(from green r g b)`\n\nç­‰ä»·äº ` color: rgb(0 128 0)`ï¼Œæ„æ€æ˜¯ä» green å¼€å§‹ï¼Œæ‹¿åˆ° rgb çš„å€¼ï¼Œå¹¶åœ¨ä¹‹åçš„å‚æ•°ä¸­ä½¿ç”¨ï¼Œä»–è®¡ç®—çš„æ˜¯è½¬æ¢åçš„ç›¸å¯¹é¢œè‰²ã€‚äºæ˜¯ä¼šæœ‰å¦‚ä¸‹å†™æ³•ï¼š\n\n```css\n// r g b æ˜¯ä¸‰ä¸ªå˜é‡ï¼Œå¯ä»¥æ¢é¡ºåºä½¿ç”¨\nrgb(from green g g g) /* rgb(128 128 128) */\nrgb(from green b r g) /* rgb(0 0 128) */\nrgb(from green 0 0 g) /* rgb(0 0 128) */\n```\nå½“ç„¶èªæ˜çš„ä½ ä¹Ÿèƒ½çŒœåˆ°ï¼Œé€æ˜åº¦ä¹Ÿèƒ½å½“åšå˜é‡ï¼š\n\n```css\nrgb(from rgba(0, 128, 0, .5) r g b / alpha) /* alpha=50% */\n```\nä¸Šé¢å°±ç›¸å½“äºå°†é¢œè‰²æ‰“æˆå„ä¸ªé€šé“åˆ†é‡æ¥å®ç°æ··æ·†ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªï¼š`background: hsl(from blue calc(h + 180) s l)`.\n\nè¿™ä¸ªæ˜¯ hsl çš„è½¬å˜ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªé€šé“åˆ†é‡åŠ äº† 180 åè¿”å›ï¼Œå…¶å®æ˜¯æ±‚è“è‰²çš„äº’è¡¥è‰²ï¼š\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-19.png)\n\n## 5. å“åº”å¼è®¾è®¡\n\næ–°çš„ä¸€å¹´ï¼Œå“åº”å¼å¸ƒå±€åˆæœ‰äº†æ–°çš„å†™æ³•ã€‚\n\n#### æŸ¥è¯¢å®¹å™¨å¤§å°\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-20.png)\n\nç›¸æ¯”äºä¼ ç»Ÿçš„åª’ä½“æŸ¥è¯¢ï¼Œå®¹å™¨æŸ¥è¯¢æ›´åŠ ç»†ç²’åº¦ï¼Œä»–å¯ä»¥åº”ç”¨åœ¨å±€éƒ¨å®¹å™¨æˆ–è€…æŒ‡å®šå®¹å™¨å†…:\n\n```css\ncontainer: card / inline-size;\n```\n\nè¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªå«åš card çš„é€‚åº”å†…åµŒå¤§å°çš„å“åº”å¼å®¹å™¨ï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨æŸ¥è¯¢ï¼š\n\n```css\n/* åªæœ‰ä¸€ä¸ªå®¹å™¨æ—¶ï¼Œåå­— card å¯ä»¥çœç•¥ */\n@container card (max-width: 400px) {\n\n}\n```\n\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š[å“åº”å¼å®¹å™¨](https://code.juejin.cn/pen/7317593902143012902)\n\n#### å®¹å™¨æ ·å¼\n\næ­¤å¤–ï¼Œåœ¨ Chrome 111 ä¸­ï¼Œæ ·å¼æŸ¥è¯¢å·²éƒ¨åˆ†å®ç°ï¼šå¯ä»¥ä½¿ç”¨Â `@container style()`Â æŸ¥è¯¢çˆ¶å…ƒç´ ä¸Šçš„è‡ªå®šä¹‰å±æ€§çš„å€¼ã€‚æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ï¼ˆå…¼å®¹æ€§ä¸å¥½ï¼‰ï¼š\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-21.png)\n\n```css\n@container style(--theme: pink) {\n  .demo-btn {\n    background: linear-gradient(45deg, pink, violet);\n    border: 4px double #f452dc;\n  }\n}\n```\nä¸Šé¢çš„ä¾‹å­ï¼Œæ ¹æ®å˜é‡ theme çš„å€¼åŠ¨æ€æ·»åŠ æ ·å¼ï¼Œå®Œæ•´ demo å¦‚ä¸‹ï¼š\n\nhttps://codepen.io/web-dot-dev/pen/GRXZLvW\n\n\n#### :has()\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-22.png)\n\nå­—é¢æ„æ€å°±æ˜¯è¯´é€‰ä¸­æ‹¥æœ‰æŸä¸ªå±æ€§çš„å…ƒç´ ï¼š\n\n```css\n.card:has(.card__media) {\n  --color: #6300ff;\n}\n```\nä¸Šé¢çš„ä»£ç ï¼Œæ˜¯é€‰ä¸­æ‹¥æœ‰ä¸€ä¸ªç±»å« card__media çš„ card å…ƒç´ ã€‚ä»–å¯ä»¥è®©ä½ åœ¨ä¼—å¤šç›¸åŒçš„ç±»åå« card çš„å…ƒç´ ä¸­é€‰ä¸­ä½ æƒ³è¦çš„ã€‚\n\nå…¶ä¸ä½†å¯ä»¥åœ¨ DOM æ ‘ä¸­å‘ä¸Šé€‰æ‹©çˆ¶çº§å…ƒç´ ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œæ¨ªå‘é€‰æ‹©ã€‚\n\næ¯”å¦‚æœ‰ä¸ªåˆ—è¡¨ï¼š\n\n```html\n\u003cul class=\"dock\"\u003e\n  \u003cli\u003e\u003c/li\u003e\n  ...\n  \u003cli\u003e\u003c/li\u003e\n\u003c/ul\u003e\n```\næ¯ä¸€ä¸ª li é‡Œæ˜¯ä¸€ä¸ªåˆ—è¡¨å›¾ç‰‡ï¼Œæˆ‘ä»¬æƒ³å®ç°é¼ æ ‡æ»‘åŠ¨å˜å¤§ï¼Œè¿™ä¹ˆå†™ï¼š\n\n```css\n.dock li:hover {\n  width: 3em;\n}\n.dock li:hover img {\n  translate: 0% -15%;\n}\n```\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-23.png)\n\nå¦‚æœæƒ³å®ç° mac ç³»ç»Ÿé‚£ç§ï¼Œå·¦å³å›¾ç‰‡ä¹Ÿä¼šå˜å¤§çš„åŠ¨ç”»ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š\n\n```css\n.dock li:hover + li,\n.dock li:has(+ li:hover) {\n  width: 2.5em;\n}\n```\nä¸ä½†é€‰æ‹©å…¶ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ï¼Œè¿˜ä½¿ç”¨ has é€‰æ‹©å…¶ä¸Šä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ï¼š\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-24.png)\n\n#### åª’ä½“æŸ¥è¯¢æœ‰äº†æ–°åŠŸèƒ½\n\nåŸæ¥å·²æœ‰çš„åª’ä½“æŸ¥è¯¢åŠŸèƒ½å¾—åˆ°äº†å²è¯—çº§åŠ å¼ºã€‚\n\n###### é€‚åº”è®¾å¤‡åˆ·æ–°ç‡\n\n![image.png](/img/posts/2024-1-2/2024-1-2-25.png)\n\næ–°å¢å¦‚ä¸‹å†™æ³•ï¼š\n\n```css\n@media (update: none) {\n\n}\n```\n\nå¯¹äºå¤§å¤šæ•°æ–°ç‰ˆè®¾å¤‡ï¼Œå…¶æ›´æ–°ä¸€èˆ¬æ˜¯ fastï¼Œä½†æ˜¯é’ˆå¯¹ç”µå­é˜…è¯»å™¨ä»¥åŠä½èƒ½è€—ä»˜æ¬¾ç³»ç»Ÿç­‰è®¾å¤‡ï¼Œå…¶åˆ·æ–°ç‡å¯èƒ½è¾ƒæ…¢ï¼Œå¯ä»¥ä½¿ç”¨ slow é€‚é…ï¼Œå…¶ä½™çš„åƒæ‰“å°æœºä¸€ç±»çš„ï¼Œå¯ä»¥è®¾ç½®ä¸º noneã€‚[demo](https://codepen.io/web-dot-dev/pen/PoyPMBw)\n\næ ¹æ®ä¸åŒçš„è®¾å¤‡åˆ·æ–°ç‡é‡‡ç”¨ä¸åŒçš„ CSS è¡¨ç°å½¢å¼ï¼Œæ„å‘³ç€æ‚¨å¯ä»¥èŠ‚çœç”µæ± ç”µé‡æˆ–å‡å°‘é”™è¯¯çš„è§†å›¾æ›´æ–°ã€‚ç”±äºä½“éªŒè€…ä¸å¯èƒ½å‡‘é½åˆ·æ–°ç‡ä¸åŒçš„è®¾å¤‡ä¸å¤ªå®¹æ˜“ï¼Œè¿™é‡Œä½¿ç”¨jsæ¥æ¨¡æ‹Ÿè¯´æ˜ï¼š\n\n[å®˜æ–¹demoï¼šå°é¸­å­æ‘‡å¤´](https://code.juejin.cn/pen/7319044288761823258)\n\n\u003e demo æ˜¯ä½¿ç”¨jsæ¨¡æ‹Ÿåˆ·æ–°ç‡ä¸åŒçš„è®¾å¤‡ï¼Œå¹¶ä¸æ˜¯å¯¹ update çš„ä½¿ç”¨è¯´æ˜\n\n###### åª’ä½“æŸ¥è¯¢æ£€æŸ¥jsè„šæœ¬\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-26.png)\n\nè„šæœ¬åª’ä½“æŸ¥è¯¢å¯ç”¨äºæ£€æŸ¥ JavaScript æ˜¯å¦å¯ç”¨ã€‚è¿™å¯¹äºæ¸è¿›å¼å¢å¼ºéå¸¸æœ‰ç”¨ã€‚åœ¨æ­¤åª’ä½“æŸ¥è¯¢æ¨å‡ºä¹‹å‰ï¼Œä¸€ä¸ªç”¨äºæ£€æµ‹ JavaScript æ˜¯å¦å¯ç”¨çš„ç­–ç•¥æ˜¯åœ¨ HTML ä¸­æ”¾ç½®ä¸€ä¸ªÂ `nojs`Â ç±»ï¼Œç„¶åä½¿ç”¨ JavaScript å°†å…¶ç§»é™¤ã€‚ç°åœ¨å¯ä»¥ä½¿ç”¨ css æ¥æ£€æµ‹äº†ï¼š\n\n```css\n@media (scripting: enabled) {\n  .steam {\n    opacity: 1;\n  }\n}\n```\n\n###### ç”¨äºå‡ä½é€æ˜åº¦çš„åª’ä½“æŸ¥è¯¢\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-27.png)\n\néä¸é€æ˜ç•Œé¢å¯èƒ½ä¼šå¼•èµ·å¤´ç—›ï¼Œæˆ–è€…è®©å„ç±»è§†åŠ›ç¼ºé™·äººç¾¤é€ æˆè§†è§‰éšœç¢ã€‚å› æ­¤ï¼ŒWindowsã€macOS å’Œ iOS è®¾æœ‰ç³»ç»Ÿåå¥½è®¾ç½®ï¼Œå¯ä»¥é™ä½æˆ–ç§»é™¤ç•Œé¢çš„é€æ˜åº¦ã€‚è¿™ä¸ªé’ˆå¯¹Â `prefers-reduced-transparency`Â çš„åª’ä½“æŸ¥è¯¢éå¸¸é€‚åˆä½¿ç”¨å…¶ä»–åå¥½è®¾ç½®åª’ä½“æŸ¥è¯¢ï¼š\n\n```css\nsvg {\n    --transparency: 50%;\n    \n    @media (prefers-reduced-transparency: reduce) {\n      --transparency: 95%;\n    }\n}\n```\n\n## 6. äº¤äº’\n\n#### è§†å›¾è½¬æ¢ API\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-28.png)\n\nå®˜æ–¹è¯´æ˜æ˜¯å¢å¼ºcssè¿‡æ¸¡ï¼Œæ›´å¥½çš„å‡å°‘å¡é¡¿å’Œå›¾å½¢äº¤å ã€‚\n\nä½¿ç”¨ï¼š`const viewTransition = document.startViewTransition(updateCallback)`\n\nä½¿ç”¨æ–¹å¼å¾ˆåƒ requestAnimationFrameï¼Œè¿™ä¸ªæ˜¯åœ¨å½“å‰äº‹ä»¶å¾ªç¯ç»“æŸå‰æ‰§è¡Œå›è°ƒï¼Œè€Œæˆ‘ä»¬ä»Šå¤©çš„è¿™ä¸ª APIï¼Œä¼šæ•è·ç½‘é¡µçš„å½“å‰çŠ¶æ€ã€‚è¿™åŒ…æ‹¬æˆªå–å±å¹•æˆªå›¾ã€‚å®Œæˆåï¼Œç³»ç»Ÿä¼šè°ƒç”¨ä¼ é€’ç»™Â `.startViewTransition()`Â çš„å›è°ƒ updateCallbackã€‚è¿™æ­£æ˜¯ DOM å‘ç”Ÿå˜åŒ–çš„åœ°æ–¹ã€‚ç„¶åï¼ŒAPI ä¼šæ•è·ç½‘é¡µçš„æ–°çŠ¶æ€ã€‚\n\nå®˜æ–¹è¯´æ˜å¦‚ä¸‹ï¼š[startViewTransition](https://developer.chrome.com/docs/web-platform/view-transitions/?hl=zh-cn#why_do_we_need_this_feature)ï¼Œ æœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ã€‚\n\n#### linear()\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-29.png)\n\nè¯¥å‡½æ•°ç”¨äºæ¨¡æ‹Ÿçº¿æ€§æ’å€¼æ¥è¿‘ä¼¼è®¡ç®—åŠ /å‡é€Ÿç±»å‹çš„åŠ¨ç”»ã€‚ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š\n\n```css\n:root {\n  --custom-easing: linear(\n    0,\n    0.06,\n    0.25 18%,\n    1 36%,\n    0.81,\n    0.75,\n    0.81,\n    1,\n    0.94,\n    1,\n    1\n  );\n}\n```\nå¯ä»¥æŸ¥çœ‹åœ¨çº¿ [demo](https://linear-easing-generator.netlify.app/) æ¥åˆ›å»ºä¸€ä¸ªä½¿ç”¨æ¡ˆä¾‹ã€‚\n\n#### Scroll End API\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-30.png)\n\nå®˜æ–¹å¯¹æ»šåŠ¨äº‹ä»¶çš„å¢å¼ºï¼Œç»ˆäºæœ‰äº†è‡ªå·±çš„æ»šåŠ¨åˆ°åº•çš„æ£€æµ‹äº†ï¼Œè¿™å¯¹äºé•¿åˆ—è¡¨æ¸²æŸ“å¾ˆæœ‰å¸®åŠ©ï¼š\n\n```js\ndocument.onscrollend = event =\u003e {\n  Toast('scroll end')\n}\n```\n\n#### æ»šåŠ¨æ¡é©±åŠ¨åŠ¨ç”»\n\nè¿™ä¸ªæ˜¯æ¯”è¾ƒæƒŠè‰³çš„æ›´æ–°äº†ï¼Œå¤§å¤šæ•°é—¨æˆ·ç½‘ç«™éƒ½æœ‰æ»šåŠ¨æ‡’åŠ è½½æˆ–è€…æ·¡å…¥æ·¡å‡ºçš„åŠ¨ç”»æ•ˆæœï¼Œè¿™æ¬¡æ”¹åŠ¨è¡¥å…¨äº†ä¹‹å‰åŸç”Ÿ css æ²¡æœ‰æ»šåŠ¨æ£€æµ‹çš„ç©ºç™½ã€‚\n\nå®˜æ–¹æ¼”ç¤º demoï¼š[Scroll-driven Animations (scroll-driven-animations.style)](https://scroll-driven-animations.style/)\n\nå…¶ä¸»è¦æ˜¯é€šè¿‡ `animation-timeline` å±æ€§è®¾ç½®é©±åŠ¨ï¼Œå¯é€‰çš„é©±åŠ¨æ–¹å¼æœ‰ `scoll` å’Œ `view`ã€‚æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š[æ»šåŠ¨åŠ¨ç”»](https://code.juejin.cn/pen/7319093484529877007)\n\n`animation: text steps(var(--chars)) forwards;` æ¥æ£€æµ‹æ»šåŠ¨çš„åç§»é‡ï¼Œå¹¶ä¼ ç»™å˜é‡ --charsmï¼Œç„¶åå¯ä»¥é€šè¿‡åç§»é‡è®¾ç½®æ–‡å­—èƒŒæ™¯è‰²çš„å®½åº¦ï¼š\n\n![image.png](/img/posts/2024-1-2/2024-1-2-31.png)\n\nå¦ä¸€ç§é©±åŠ¨æ–¹å¼ view è¿™ä¹ˆå®šä¹‰ï¼š`animation-timeline: view();`ï¼Œå¯é€šè¿‡ animation-range è®¾ç½®å˜åŒ–èŒƒå›´ï¼Œç”¨äºç›‘æµ‹å½“å‰å…ƒç´ æ˜¯å¦åœ¨å¯è§†åŒºåŸŸï¼Œå®˜æ–¹ demoï¼š[CSS Wrapped 2023: Scroll-Driven Animations: View Timeline #CSSWrapped2023 (codepen.io)](https://codepen.io/web-dot-dev/pen/XWOqovr)\n\n#### ç»™ display: none æ·»åŠ åŠ¨ç”»\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-32.png)\n\nchrome æ–°å¢åŠŸèƒ½ï¼š`transition-behavior`ï¼Œæ¥å—ä¸¤ä¸ªå€¼ï¼š`normal`Â å’ŒÂ `allow-discrete`ï¼Œå…¶ä¸­ `allow-discrete`Â æ¨¡å¼å¯å®ç°ç¦»æ•£è½¬æ¢ã€‚ä½¿ç”¨æ–¹å¼ï¼š\n\n```css\n.card {\n  transition: opacity 0.25s, display 0.25s;\n  transition-behavior: allow-discrete;\n}\n```\n\ndemo: [åˆ é™¤å¡ç‰‡](https://codepen.io/web-dot-dev/pen/poQMLrN)\n\n#### `@starting-style`\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-33.png)\n\n`@starting-style`Â CSS è§„åˆ™ä»¥æ–°çš„ Web åŠŸèƒ½ä¸ºåŸºç¡€ï¼Œç”¨äºåœ¨Â `display: none`Â ä¹‹é—´æ·»åŠ åŠ¨ç”»æ•ˆæœï¼Œä½†ä¹Ÿå¯ä»¥ç”¨äºå…¶ä»–çš„ transitionã€‚å¯ä»¥çœ‹è¿™ä¸ª [demo](https://codepen.io/web-dot-dev/pen/OJdjjdX)\n\nå¼¹çª—é»˜è®¤æ˜¯éšè—åœ¨å±å¹•ä¹‹ä¸‹çš„ï¼š\n\n```css\ndialog {\n  transition: translate 0.7s ease-out, overlay 0.7s ease-out, display 0.7s ease-out allow-discrete;\n  translate: 0 100vh;\n}\n```\n\nè®¾ç½®å¼€å…³ï¼š\n\n```css\ndialog[open] {\n  translate: 0 0;\n}\n```\n\nä½†æ˜¯è¿™ä¸ªæ˜¯çªç„¶å‡ºç°çš„ï¼Œæ˜æ˜è®¾ç½®äº† transition: translateï¼Œè¿‡æ¸¡å´æ²¡å‡ºæ¥ï¼Œåº”è¯¥æ˜¯ h5 çš„ dialog çš„ open çœ‹åš display çš„ä¿®æ”¹äº†å§ã€‚æˆ‘ä»¬è®¾ç½®è¿‡æ¸¡ï¼š\n\n```css\n@starting-style {\n  dialog[open] {\n    translate: 0 100vh;\n  }\n}\n```\næ­¤æ—¶å°±æœ‰åŠ¨ç”»äº†ã€‚\n\n#### overlayÂ ã€:popover-open ä¸Â ::backdrop\n\n![image.png](/img/posts/2024-1-2/2024-1-2-34.png)\n\ncss åŸç”Ÿä¹Ÿå¼€å§‹æ”¯æŒå¼¹å‡ºå±‚äº†ï¼Œé™¤äº†ä¸Šé¢ h5 çš„ dialogï¼Œè¿™é‡Œè¿˜æœ‰ popover çš„ css å±æ€§ã€‚\n\nå®˜æ–¹ demoï¼š[CSSWrapped2023 Overlay (codepen.io)](https://codepen.io/web-dot-dev/pen/zYeJbgw)\n\n## 7. ç»„ä»¶\n\n#### popover\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-35.png)\n\nè¯¥ç»„ä»¶æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š\n\n-   **æ™‹å‡åˆ°é¡¶å±‚**ã€‚å¼¹å‡ºå¼çª—å£ä¼šæ˜¾ç¤ºåœ¨ç½‘é¡µå…¶ä½™éƒ¨åˆ†ä¹‹ä¸Šçš„å•ç‹¬å›¾å±‚ä¸Šï¼Œå› æ­¤æ— éœ€è°ƒæ•´ z-indexã€‚\n-   **è½»å…³é—­åŠŸèƒ½**ã€‚ç‚¹å‡»å¼¹å‡ºçª—å£åŒºåŸŸä»¥å¤–çš„ä½ç½®å°†å…³é—­å¼¹å‡ºçª—å£å¹¶è¿”å›ç„¦ç‚¹ã€‚\n-   **é»˜è®¤ç„¦ç‚¹ç®¡ç†**ã€‚æ‰“å¼€å¼¹å‡ºå¼çª—å£ä¼šä½¿ä¸‹ä¸€ä¸ªæ ‡ç­¾é¡µåœæ­¢åœ¨å¼¹å‡ºå¼çª—å£å†…æ˜¾ç¤ºã€‚\n-   **æ— éšœç¢é”®ç›˜ç»‘å®šã€‚** ç‚¹æŒ‰Â `esc`Â é”®æˆ–åŒé‡åˆ‡æ¢æŒ‰é’®ä¼šå…³é—­å¼¹å‡ºå¼çª—å£å¹¶è¿”å›ç„¦ç‚¹ã€‚\n-   **å¯è®¿é—®çš„ç»„ä»¶ç»‘å®š**ã€‚ä»è¯­ä¹‰ä¸Šå°†å¼¹å‡ºå¼çª—å£å…ƒç´ è¿æ¥åˆ°å¼¹å‡ºå¼çª—å£è§¦å‘å™¨ã€‚\n\nåªéœ€è¦ç»™ä¸€ä¸ªæ™®é€šçš„ div åŠ ä¸Š `popover` å±æ€§ï¼Œç„¶åç»™æŒ‰é’®å‘¢åŠ ä¸Š `popovertarget` å¯¹åº”è¿™ä¸ª div çš„ id å³å¯ã€‚è¯¦æƒ…å¯ä»¥æŸ¥çœ‹ [demo](https://code.juejin.cn/pen/7319331878450757670):\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-36.png)\n\n#### hr æ ‡ç­¾ç„•å‘æ–°æ˜¥\n\nä¹‹å‰å¯¹ hr æ ‡ç­¾çš„ç†è§£å°±æ˜¯å¾ˆä¸‘çš„æ¨ªçº¿ï¼Œæ¯”è¾ƒé¸¡è‚‹ï¼ŒUIåº“éƒ½ä¼šå»è‡ªå·±å®ç°åˆ†å‰²çº¿ï¼Œè¿™ä¸ H5 çš„åˆè¡·ç›¸è¿èƒŒï¼Œåˆ¶å®šæ ‡å‡†çš„äººéƒ½å¸Œæœ›è‡ªå·±çš„ç»„ä»¶èƒ½è¢«å„ä¸ªä¸»æµ UI åº“ä½¿ç”¨æ¥è¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚\n\n\u003e ä½†ç°åœ¨è·¯è¿˜å¾ˆé•¿ï¼Œselect ç»„ä»¶è¿˜æ˜¯åŠŸèƒ½æ¬ ç¼ºï¼Œå„ä¸ªUIåº“ä¸å¾—ä¸è‡ªå·±å®ç°\n\nç°åœ¨ hr å¯ä»¥å’Œ select ç»“åˆä½¿ç”¨äº†ï¼š\n\n```html\n\u003cselect name=\"majors\" id=\"major-select\"\u003e\n  \u003coption value=\"\"\u003eSelect a favorite feature\u003c/option\u003e\n  \u003chr\u003e\n  \u003coptgroup label=\"Foundations\"\u003e\n    \u003coption value=\"trig\"\u003eTrigonometric functions\u003c/option\u003e\n    \u003coption value=\"nth\"\u003eComplex nth-* selection\u003c/option\u003e\n    \u003coption value=\"nesting\"\u003eNesting\u003c/option\u003e\n    \u003coption value=\"subgrid\"\u003eSubgrid\u003c/option\u003e\n    \u003coption value=\"mq-ranges\"\u003eMedia query range syntax\u003c/option\u003e\n  \u003c/optgroup\u003e\n  ...\n```\n\næ„Ÿè§‰è¿˜ä¸é”™ï¼ˆä½†æ˜¯åŸç”Ÿ select è¿æœç´¢éƒ½ä¸æ”¯æŒï¼Œå¯èƒ½ä¼ä¸šçº§è½åœ°è¿˜æœ‰äº›å›°éš¾ï¼‰ï¼š\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-37.png)\n\n#### `:user-valid`Â å’ŒÂ `:user-invalid`\n\n![image.png](/img/posts/2024-1-2/2024-1-2-38.png)\n\nè¿™ä¸¤ä¸ªä¼ªç±»æ˜¯ç”¨äºç”¨æˆ·ä¸è¾“å…¥å†…å®¹æ ¡éªŒçš„ï¼Œåœ¨è¿›è¡Œæ˜æ˜¾äº’åŠ¨åæ ¡éªŒè¡¨å•æ˜¯å¦æ— æ•ˆã€‚\n\nä¸‹é¢æ˜¯ä¸ªä¾‹å­ï¼ˆæ ¡éªŒåŸç”Ÿ h5 è¡¨å•çš„è§„åˆ™ï¼‰ï¼Œå¯ç”¨äºè¯´æ˜ä¸ :valid çš„åŒºåˆ«ï¼š[è¡¨å•æ ¡éªŒ](https://code.juejin.cn/pen/7319341325450412067)\n\n#### æ‰‹é£ç´ç»„ä»¶\n\n\n![image.png](/img/posts/2024-1-2/2024-1-2-39.png)\n\nè¿™ä¸ªç»„ä»¶ç”¨çš„è¿˜æ˜¯ h5 çš„ details æ ‡ç­¾ï¼Œä¸æ˜¯ä¸ªæ–°ä¸œè¥¿äº†ï¼Œä½†æ˜¯å…¶å¢åŠ äº†`name`Â å±æ€§çš„æ”¯æŒã€‚ä½¿ç”¨æ­¤å±æ€§æ—¶ï¼Œå…·æœ‰ç›¸åŒÂ `name`Â å€¼çš„å¤šä¸ªÂ `\u003cdetails\u003e`Â å…ƒç´ ä¼šå½¢æˆè¯­ä¹‰ç»„ã€‚\n\næˆ‘ä»¬æ¥çœ‹ [demo](https://code.juejin.cn/pen/7319383154270142479)\n\n----\n\n## 8. æ€»ç»“\n\nå‰ç«¯ CSS çš„å‘å±•è¶‹åŠ¿æ˜¯ç´§è´´ç”¨æˆ·ä¸»æµä½¿ç”¨ä¹ æƒ¯ï¼Œå¹¶å€Ÿé‰´å„ä¸ª UI åº“å’Œæ¡†æ¶çš„ä½¿ç”¨æ–¹å¼æ”¹é€ ï¼Œä¸ H5 æ ‡ç­¾ç»“åˆï¼ŒåŠ›å›¾å®Œå–„è‡ªå·±çš„ç»„ä»¶ä½“ç³»ï¼Œè·Ÿä¸Šæ—¶ä»£çš„å˜åŒ–æ½®æµã€‚æ•´ä½“æ–¹å‘å¦‚ä¸‹ï¼š\n\n- å“åº”å¼å’Œç§»åŠ¨ä¼˜å…ˆè®¾è®¡\n- CSS å˜é‡ä¸æµç¨‹æ§åˆ¶æ“ä½œè¶Šæ¥è¶Šå¤šï¼Œæ‰“é€šä¸ js çš„å±éšœ\n- åŠ¨ç”»ä¸è¿‡æ¸¡ä¼˜åŒ–\n- é¢œè‰²ç©ºé—´æ‰©å……\n- æ˜“ç”¨æ€§å¢å¼ºï¼Œå‡½æ•°æ‰©å……\n- æ€§èƒ½ä¼˜åŒ–"])</script><script>self.__next_f.push([1,"1e:T6237,"])</script><script>self.__next_f.push([1,"Tailwind CSSæ˜¯ä¸€ä¸ªåŠŸèƒ½ç±»ä¼˜å…ˆçš„CSSæ¡†æ¶ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå¼€å‘ CSSï¼Œçµæ´»å¯å®šåˆ¶ã€‚é‰´äºå®˜ç½‘çš„æè¿°æ¯”è¾ƒæ™¦æ¶©ï¼Œæ–°æ‰‹ä¸Šæ‰‹æ¯”è¾ƒéš¾ï¼Œæœ‰å„ç§å‘éœ€è¦è¸©ï¼Œå®æ“æ€§ä¸å¼ºï¼Œæœ¬æœŸå°±å¸¦å¤§å®¶äº†è§£ä¸€ä¸‹è¿™ä¸ª CSS å¿«é€Ÿå¼€å‘æ¡†æ¶çš„ä½¿ç”¨ä»¥åŠä¸€äº›å¸¸ç”¨çš„é…ç½®ã€‚\n\n\u003e æœ¬æ–‡å†™ç»™æ²¡æ—¶é—´æŸ¥é˜…æ–‡æ¡£ï¼Œä½†åˆæƒ³å¿«é€Ÿä¸Šæ‰‹çš„å¼€å‘è€…ã€‚æœ¬æ–‡æ¶‰åŠåˆ°çš„çŸ¥è¯†ï¼Œè¦†ç›–äº†å¹³æ—¶ä¸šåŠ¡å¼€å‘çš„å¤§å¤šæ•°åœºæ™¯ï¼Œå¯ä¾›å‚è€ƒæŸ¥é˜…\n\u003e  \n\u003e å¼€å‘ç¯å¢ƒï¼šnode16+ | VS Code\n\u003e \n\u003e [å®˜ç½‘ä¸­æ–‡é•œåƒ](https://tailwind.nodejs.cn/)\n\nå¦‚æœæ‚¨å·²ç»æŒæ¡äº† Tailwind çš„åŸºæœ¬åŸç†ï¼Œåªæƒ³çŸ¥é“å…·ä½“æ¡†æ¶å¦‚ä½•é…ç½®ï¼Œå¯ä»¥ç›´æ¥è·³è½¬åˆ°ä¸‹é¢å¯¹åº”ç« èŠ‚æŸ¥é˜…ã€‚\n\n\n----\n\n## 1. VS Code æ’ä»¶\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-1.png)\n\nå®‰è£…å¥½åå°±å¯ä»¥æœ‰è‡ªåŠ¨æç¤ºäº†ï¼š\n\n![image.png](/img/posts/2023-11-11/2023-11-11-2.png)\n\næ’ä»¶è¿˜å¯ä»¥é«˜äº®é”™è¯¯. é¢„è§ˆå†…ç½®cssæ ·å¼. è®¾ç½®è¯­è¨€ç¯å¢ƒç­‰ï¼Œæ¨è VS Code ç”¨æˆ·ä½¿ç”¨ã€‚\n\n\n## 2. Tailwind CLI\n\næ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹æ ¹ç›®å½•ä¸‹ï¼š\n\n```shell\nyarn add --dev tailwindcss\nnpx tailwindcss init\n```\n\næˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ä¸ªé…ç½®æ–‡ä»¶ `tailwind.config.js` åœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆï¼Œæˆ‘ä»¬æ·»åŠ è¦æ£€ç´¢çš„æ–‡ä»¶ï¼š\n\n```js\n/** @type {import('tailwindcss').Config} */\nmodule.exports = {\n  content: ['./index.html'],\n  theme: {\n    extend: {},\n  },\n  plugins: [],\n}\n```\n\nè¿™æ ·ï¼ŒTailwind å°±åªä¼šæ£€æµ‹ index.html ä¸­æ˜¯å¦ä½¿ç”¨äº† tailwindcssï¼Œå¹¶å£°ç§°æœ€å° css é›†åˆã€‚æˆ‘ä»¬å†™ä¸€ä¸‹è¿™ä¸ª index.html:\n\n```html\n\u003c!doctype html\u003e\n\u003chtml\u003e\n\u003chead\u003e\n  \u003ctitle\u003ehello\u003c/title\u003e\n  \u003cmeta charset=\"UTF-8\"\u003e\n  \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e\n  \u003clink href=\"/dist/output.css\" rel=\"stylesheet\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n  \u003ch1 class=\"text-3xl font-bold underline\"\u003e\n    Hello world!\n  \u003c/h1\u003e\n  \u003cbutton class=\"underline bg-violet-500 hover:bg-violet-600 active:bg-violet-700 focus:outline-none focus:ring focus:ring-violet-300 ...\"\u003e\n    Save changes\n  \u003c/button\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n```\nç„¶ååœ¨ src ç›®å½•ä¸‹å†™ä¸€ä¸ª input.css æ–‡ä»¶ï¼š\n\n```js\n@tailwind base;  // å¼•å…¥åŸºç¡€æ ·å¼ï¼Œæ¯”å¦‚ bodyçš„margin. æ ·å¼ç»§æ‰¿è§„åˆ™ç­‰\n@tailwind components;  // å¼•å…¥å¸¸ç”¨çš„ç»„ä»¶æ ·å¼ï¼Œä¸€èˆ¬åœ¨å…¶ä»–å‰ç«¯æ¡†æ¶ä¸­ä½¿ç”¨\n@tailwind utilities; // å·¥å…·æ ·å¼ï¼Œæ¯”å¦‚ä¸‹åˆ’çº¿. å­—ä½“é¢œè‰²ç­‰\n```\n\næ‰§è¡Œ cliï¼š\n\n```shell\nnpx tailwindcss -i ./src/input.css -o ./dist/output.css --watch --config ./tailwind.config.js\n```\n\nè¿™é‡Œçš„ `--config ./tailwind.config.js` å¯ä»¥ä¸å†™ï¼Œé»˜è®¤ä¼šæ£€ç´¢æ ¹ç›®å½•ä¸‹çš„åŒåæ–‡ä»¶ã€‚\n\n\n\u003e è¿™é‡Œæœ‰ä¸€ä¸ªå‘ï¼Œå¦‚ä¸‹å›¾\n\n![image.png](/img/posts/2023-11-11/2023-11-11-3.png)\n\nå¦‚æœä½ æ‰§è¡ŒæŒ‡ä»¤åå‡ºç° cliï¼Œæœ‰å¯èƒ½æ˜¯è¾“å…¥è¾“å‡ºçš„æ–‡ä»¶è·¯å¾„ä¸å¯¹ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ç›®æ ‡é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯ä½ é…ç½®æ–‡ä»¶æ£€æµ‹çš„ content ä¸å­˜åœ¨æˆ–æ²¡æœ‰ä½¿ç”¨ tailwincssã€‚æˆ‘ç¬¬ä¸€æ¬¡å‡ºç°è¿™ä¸ªé”™è¯¯ï¼Œæ˜¯è¯¯æŠŠ `--config` å†™æˆäº† `--content`...\n\nåˆ°æ­¤ä¸ºæ­¢ï¼Œå°±ç”Ÿæˆä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ï¼Œå·¥ç¨‹ç›®å½•å¦‚ä¸‹ï¼š\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-4.png)\n \nç”±äº tailwindcss åªèƒ½è¿è¡Œåœ¨æœåŠ¡å™¨ç¯å¢ƒï¼Œæˆ‘ä»¬è¿™é‡Œå°±æ­å»ºä¸€ä¸ªå¼€å‘æœåŠ¡å™¨æ¥è¯´æ˜é—®é¢˜ï¼š\n\n```shell\nyarn add --dev http-server\n\nnpx http-server\n```\næœåŠ¡è·‘èµ·æ¥ï¼š\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-5.png)\n\næˆ‘ä»¬æ‰“å¼€ 8080 ç«¯å£æŸ¥çœ‹ï¼š\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-6.png)\n\næ ·å¼å·²ç»ä¸Šå»äº†ã€‚\n\n## 3. ä¸ postcss å’Œ sass ç»“åˆä½¿ç”¨\n\npostcss ç”¨äºæ ¼å¼åŒ–æ ·å¼ï¼Œä½¿çš„æ ·å¼æ›´åŠ è§„èŒƒç»Ÿä¸€ï¼Œä¸ä¼šæ ·å¼æ±¡æŸ“ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªä¾èµ– postcss çš„ autoprefixer ä¸ºæ ·å¼è‡ªåŠ¨å¢åŠ å‰ç¼€ï¼Œæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š\n\n```shell\nyarn add --dev postcss autoprefixer postcss-nesting postcss-import\n```\nåä¸¤ä¸ªä¾èµ–æ˜¯å®ç°çº§è” css çš„è§£æ å’Œ è§£æ @import è¯­å¥çš„ã€‚æˆ‘ä»¬åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶ `postcss.config.js`ï¼Œä»¥æ’ä»¶çš„å½¢å¼å¼•å…¥ä¾èµ–:\n\n```js\nmodule.exports = {\n  plugins: {\n    'postcss-import': {},\n    'tailwindcss/nesting': 'postcss-nesting',\n    tailwindcss: {},\n    autoprefixer: {},\n  }\n}\n```\n\nå°† input.css æ”¹ä¸º input.scssï¼Œå¹¶ä¿®æ”¹æ–‡ä»¶ï¼š\n\n```scss\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\nbody {\n  h1 {\n    font-size: 64px !important;\n  }\n}\n\n@media (min-resolution: 2dppx) {\n  .image {\n    background-image: url(image@2x.png);\n  }\n}\n```\n\nç„¶åæ‰§è¡Œ cli æŒ‡ä»¤ï¼ŒæŒ‡æ˜è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼š\n\n```shell\nnpx tailwindcss -i ./src/input.scss -o ./dist/output.css --watch --postcss postcss.config.js\n```\n\næˆ‘ä»¬çœ‹çœ‹è¾“å‡ºçš„ output.cssï¼š\n\n```css\nbody h1 {\n  font-size: 64px !important;\n}\n\n@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 2dppx) {\n  .image {\n    background-image: url(image@2x.png);\n  }\n}\n```\nå¯ä»¥çœ‹åˆ°å·²ç»è§£æä¸ºæ™®é€šçš„ cssï¼Œå¹¶æ·»åŠ äº†å…¼å®¹æ€§å‰ç¼€å’Œè‡ªåŠ¨è®¡ç®—å…¼å®¹æ€§å•ä½ã€‚\n\n## 4. å†…ç½®æ ·å¼ç±»é€ŸæŸ¥è¡¨\n\n\u003e å¦‚æœä¸æƒ³çœ‹é€ŸæŸ¥ï¼Œç›´æ¥è°ƒåˆ°åè¾¹æ¡†æ¶ä½¿ç”¨å³å¯\n\næœ‰ä¸€ä¸ªåˆæ­¥è®¤è¯†åï¼Œæˆ‘ä»¬è¿™é‡Œæ¥åˆ†ç±»æ€»ç»“ä¸€ä¸‹ tailwindcss çš„å¸¸ç”¨æ ·å¼ç±»ï¼Œå¦‚æœæƒ³è¦çœ‹å…¨éƒ¨çš„æ ·å¼ï¼Œå‚è§ï¼š[tailwind](https://tailwind.nodejs.cn/docs/preflight)ã€‚\n\n#### ï¼ˆ1. é¢„æ£€æ ·å¼\n\n`@tailwind base;`\n\nä»–å¼•å…¥åï¼Œè‡ªåŠ¨è®¾ç½®é»˜è®¤è¾¹è·æ˜¯0. æ‰€æœ‰çš„æ ‡é¢˜æ ‡ç­¾çš„å­—ä½“å¤§å°å’Œæƒé‡ç»§æ‰¿ä»–çš„åŒ…å«å—. åˆ—è¡¨æ ·å¼æ¸…é™¤. å›¾ç‰‡. iframeç­‰å¤šåª’ä½“æ ‡ç­¾è‡ªåŠ¨ä¸ºå—çº§. å›¾ç‰‡è§†é¢‘è‡ªåŠ¨è¢«é™åˆ¶ä¸ºæœ€å¤§çˆ¶çº§å®½åº¦. é‡å†™é»˜è®¤è¾¹æ¡†æ ·å¼ç­‰ã€‚\n\nå½“ç„¶ä½ ä¹Ÿå¯ä»¥æ‰©å±•é¢„æ£€èŒƒå›´ï¼š\n\n```css\n@tailwind base;\n@layer base { h1 { @apply text-2xl; } }\n```\n\né¢„æ£€æ ·å¼è¡¨å¦‚ä¸‹ï¼šhttps://unpkg.com/tailwindcss@3.3.5/src/css/preflight.css\n\n#### ï¼ˆ2. å¸ƒå±€\n\nçºµæ¨ªæ¯”ï¼š\n\nClass         | Properties            |\n| ------------- | --------------------- |\n| aspect-auto   | aspect-ratio: auto;   |\n| aspect-square | aspect-ratio: 1 / 1;  |\n| aspect-video  | aspect-ratio: 16 / 9;|\n\nå“åº”å¼å®¹å™¨ï¼š\n\nClass        | Breakpoint         | Properties   |\n| ------------ | ------------------ | ------------ |\n| container    | None               | width: 100%; |\n|| smÂ (640px)   | max-width: 640px;  |            \n|| mdÂ (768px)   | max-width: 768px;  |            \n|| lgÂ (1024px)  | max-width: 1024px; |             \n|| xlÂ (1280px)  | max-width: 1280px; |             \n|| 2xlÂ (1536px) | max-width: 1536px;|\n\nä½¿ç”¨ä¸¾ä¾‹ï¼š\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-7.png)\n\n#### ï¼ˆ3. åˆ—å¸ƒå±€\n\nClass     | Properties  | note |\n| --------- | ----------- | -- |\n| columns-`{num}` | columns: 1; | numå¯å–ï¼š `[1-12]` |\n| columns-auto | columns: auto; |  |\ncolumns-3xs | columns: 16rem; /* 256px */ ||\n| columns-2xs | columns: 18rem; /* 288px */||\ncolumns-xs | columns: 20rem; /* 320px */ ||\n| columns-sm | columns: 24rem; /* 384px */ ||\n| columns-md | columns: 28rem; /* 448px */ ||\n| columns-lg | columns: 32rem; /* 512px */ ||\n| columns-xl | columns: 36rem; /* 576px */||\n| columns-`{num}`xl | columns: 36rem çš„ num å€ |numå¯å–ï¼š `[2-7]` |\n\næ–‡ç« æœ€åæˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªå®æˆ˜è¯´æ˜\n\n#### ï¼ˆ4. æº¢å‡ºå¤„ç†\n\nClass              | Properties           |\n| ------------------ | -------------------- |\n| overflow-auto      | overflow: auto;      |\n| overflow-hidden    | overflow: hidden;    |\n| overflow-clip      | overflow: clip;      |\n| overflow-visible   | overflow: visible;   |\n| overflow-scroll    | overflow: scroll;    |\n| overflow-x-auto    | overflow-x: auto;    |\n| overflow-y-auto    | overflow-y: auto;    |\n| overflow-x-hidden  | overflow-x: hidden;  |\n| overflow-y-hidden  | overflow-y: hidden;  |\n| overflow-x-clip    | overflow-x: clip;    |\n| overflow-y-clip    | overflow-y: clip;    |\n| overflow-x-visible | overflow-x: visible; |\n| overflow-y-visible | overflow-y: visible; |\n| overflow-x-scroll  | overflow-x: scroll;  |\n| overflow-y-scroll  | overflow-y: scroll;|\n\n#### ï¼ˆ5. å®šä½\n\n| Class    | Properties          |\n| -------- | ------------------- |\n| static   | position: static;   |\n| fixed    | position: fixed;    |\n| absolute | position: absolute; |\n| relative | position: relative; |\n| sticky   | position: sticky;|\n\n#### ï¼ˆ6. display\n\nClass        | Properties             |\n| ------------ | ---------------------- |\n| block        | display: block;        |\n| inline-block | display: inline-block; |\n| inline       | display: inline;       |\n| flex         | display: flex;|\n|...||\n\nflex å¯¹å…¶æ–¹å¼ï¼š\n\njustify-center  | justify-content: center;        |\n| --------------- | ------------------------------- |\n| justify-between | justify-content: space-between; |\n| justify-around  | justify-content: space-around;|\n| items-start  | align-items: flex-start; |\n| items-end    | align-items: flex-end;   |\n| items-center | align-items: center;|\n\n\n#### ï¼ˆ7. è¾¹è·\n\nClass | Properties                             |\n| ----- | -------------------------------------- |\n| p-0   | padding: 0px;                          |\n| px-0  | padding-left: 0px; padding-right: 0px; |\n| py-0  | padding-top: 0px; padding-bottom: 0px;|\n|...||\n\nClass | Properties                           |\n| ----- | ------------------------------------ |\n| m-0   | margin: 0px;                         |\n| mx-0  | margin-left: 0px; margin-right: 0px; |\n| my-0  | margin-top: 0px; margin-bottom: 0px;|\n|...||\n\nå¦‚æœè®¾ç½®å•ä¸ªè¾¹è·ï¼Œå¯ä½¿ç”¨ç¼©å†™ï¼špl-1ï¼špadding-left: 1pxï¼Œä»¥æ­¤ç±»æ¨\n\n#### ï¼ˆ8. æ–‡æœ¬ç±»\n\n| Class         | Properties                                                      |\n| ------------- | --------------------------------------------------------------- |\n| truncate      | overflow: hidden; text-overflow: ellipsis; white-space: nowrap; |\n| text-ellipsis | text-overflow: ellipsis;                                        |\n| text-clip     | text-overflow: clip;|\n|...||\n\n#### ï¼ˆ9. è¾¹æ¡†\n\nClass    | Properties         |\n| -------- | ------------------ |\n| border-0 | border-width: 0px; |\n| border-2 | border-width: 2px; |\n| border-4 | border-width: 4px; |\n| border-8 | border-width: 8px; |\n| border   | border-width: 1px;|\n| rounded-md| border-radius: 0.375rem |\n...\n\n#### ï¼ˆ10. åŠ¨ç”»\n\nClass          | Properties                                                                                                                                                                                                                                     |\n| -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| animate-none   | animation: none;                                                                                                                                                                                                                               |\n| animate-spin   | animation: spin 1s linear infinite; `@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }`                                                                                                                    |\n| animate-ping   | animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite; `@keyframes ping { 75%, 100% { transform: scale(2); opacity: 0; } }    `                                                                                                                 |\n| animate-pulse  | animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; `@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } } `                                                                                                                 |\n| animate-bounce | animation: bounce 1s infinite; `@keyframes bounce { 0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); } 50% { transform: translateY(0); animation-timing-function: cubic-bezier(0, 0, 0.2, 1); } }`|\n\n\n#### ï¼ˆ11. é¢œè‰²\n\n- bg å¼€å¤´ (css ä¸­ theme(textColor.) æˆ– theme(colors.) å¼€å¤´) è¡¨ç¤ºèƒŒæ™¯è‰²ï¼Œé€šè¿‡æ’ä»¶å¯ä»¥è‡ªå·±é€‰æ‹©ï¼š\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-8.png)\n\n- text (css ä¸­ theme(textColor.) æˆ– theme(colors.)) å¼€å¤´è¡¨ç¤ºæ–‡å­—é¢œè‰²ï¼š\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-9.png)\n\n#### ï¼ˆ12. äº‹ä»¶\n\n- snap æˆ– scroll å¼€å¤´ï¼šç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œå‚è€ƒ [æ»šåŠ¨](https://tailwind.nodejs.cn/docs/scroll-snap-align)\n- hover: å¼€å¤´ï¼šç›‘å¬é¼ æ ‡æ‚¬æµ®äº‹ä»¶\n- active: å’Œ focus: å¼€å¤´ï¼šæ•è·æ¿€æ´»çš„å’Œèšç„¦çš„å…ƒç´ \n- first: æ•è·ç¬¬ä¸€ä¸ªå…ƒç´ \n- odd: å’Œ even: æ•è·å¥‡å¶å…ƒç´ \n- è¿˜å¯ä»¥æ•è·ä¼ªå…ƒç´ ï¼šafter: ç­‰ï¼š[ä¼ªå…ƒç´ ](https://tailwind.nodejs.cn/docs/hover-focus-and-other-states#pseudo-elements)\n\n#### ï¼ˆæ’ä»¶\n\n[æ’ç‰ˆæ’ä»¶](https://tailwind.nodejs.cn/docs/typography-plugin)ï¼š\n\n```\nyarn add --dev @tailwindcss/typography\n```\n\næ·»åŠ é…ç½®æ–‡ä»¶ï¼š\n\n```js\nplugins: [ require('@tailwindcss/typography') ],\n```\n\nä½¿ç”¨ï¼š\n\n```html\n\u003carticle class=\"prose lg:prose-xl\"\u003e\n```\n\n[è¡¨å•æ’ä»¶](https://github.com/tailwindlabs/tailwindcss-forms):\n\n```shell\nyarn add --dev @tailwindcss/forms\n```\n\né…ç½®ï¼š\n\n```js\nplugins: [\n  require('@tailwindcss/forms'),\n  // ...\n],\n```\n\nä½¿ç”¨ï¼š\n\n```html\n\u003cinput type=\"email\" class=\"form-input px-4 py-3 rounded-full\"\u003e\n\n\u003cselect class=\"form-select px-4 py-3 rounded-full\"\u003e\n\u003c!-- ... --\u003e\n\u003c/select\u003e\n```\n\nå¯ç”¨æ ·å¼ï¼š\n\n|å…ƒç´ |class|\n| ------------------- | ------------------ |\n|`input`     | `form-input`       |\n| `textarea`          | `form-textarea`    |\n| `select`            | `form-select`      |\n| `select[multiple]`  | `form-multiselect` |\n| `[type='checkbox']` | `form-checkbox`    |\n| `[type='radio']`    | `form-radio`|\n\n\n## 5. è‡ªå®šä¹‰æ ·å¼\n\nåœ¨é…ç½®æ–‡ä»¶ä¸­å¯ä»¥è¿™æ ·å†™ï¼š\n\n```js\ntheme: {\n    extend: {\n      spacing: {\n        '8xl': '96rem',\n        '9xl': '128rem',\n      },\n    },\n    screens: {\n        'sm': '640px', // =\u003e @media (min-width: 640px) \n        ...\n    },\n    colors: {\n      'text-blue': '#4848ff'\n    }\n  },\n```\n\nè¿™æ ·å°±å¯ä»¥ä½¿ç”¨äº†ã€‚\n\nåœ¨ css ä¸­ä½¿ç”¨ï¼š\n\n```css\ncolor: theme('colors.text-blue');\nmax-width: theme('spacing.8xl');\n@media (min-width: theme('screens.sm')) {}\n```\n\nåœ¨ html ä¸­ä½¿ç”¨ï¼š\n\n```html\n\u003cp class=\"text-text-blue\"\u003e\n\u003cdiv class=\"mb-8xl\"\u003e \u003c!-- mb æ˜¯ margin bottom --\u003e\n\u003cdiv class=\"sm:flex\"\u003e \u003c!-- è¿™ä¸ªå…ƒç´ åœ¨å±å¹•å®½åº¦å¤§äºç­‰äº 'md' æ—¶å°†ä½¿ç”¨ flex å¸ƒå±€ --\u003e\n```\n\n\u003e ç±»åä¸­ï¼Œé¢œè‰²ä¼šè‡ªåŠ¨åŠ å…¥ text å‰ç¼€ã€‚ç”±äºç±»åæ²¡æœ‰è§„åˆ™ï¼Œä¸å¤ªå¥½è®°ï¼Œæ¨èæ–°æ‰‹ä½¿ç”¨ css æ¥å¼•å…¥è‡ªå·±çš„è‡ªå®šä¹‰ä¸»é¢˜\n\n## 6. Nextjs ä¸­ä½¿ç”¨\n\næ‰§è¡Œå‘½ä»¤è¡Œï¼š\n\n```sh\nnpx create-next-app@latest\n```\n\nå¯é€‰æ‹©é¡¹é€‰æ‹©å¦‚ä¸‹ï¼š\n\n![image.png](/img/posts/2023-11-11/2023-11-11-10.png)\n\n\u003e App router æ˜¯å¦ä¸€ç§è·¯ç”±æ–¹å¼ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶å¤¹æ˜¯ä¸€ä¸ªé¡µé¢ï¼Œå…¥å£æ–‡ä»¶éƒ½æ˜¯ page.tsxï¼Œå¯å‚è€ƒï¼šhttps://nextjs.org/docs/app/building-your-application/routing/route-groups\n\nå·¥ç¨‹ç›®å½•ç”Ÿæˆåï¼Œé¡¹ç›®ä¼šè‡ªåŠ¨åœ¨æ ¹ç›®å½•ä¸‹å»ºç«‹ postcss.config.js å’Œ tailwind.config.jsã€‚\n\né¡¹ç›®ç›®å½•å¦‚ä¸‹ï¼š\n\n![image.png](/img/posts/2023-11-11/2023-11-11-11.png)\n\næˆ‘ä»¬é…ç½®å…¥å£ page.tsx:\n\n```tsx\nexport default function Home() {\n  return (\n    \u003cmain className=\"flex min-h-screen flex-col items-center justify-between p-24\"\u003e\n      \u003ch1 className=\"text-3xl font-bold underline\"\u003e\n        Hello world!\n      \u003c/h1\u003e\n    \u003c/main\u003e\n  )\n}\n```\né¡µé¢ä¸ŠæŸ¥çœ‹ï¼š\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-12.png)\n\n#### åœ¨ css module ä¸­ä½¿ç”¨\n\næˆ‘ä»¬åœ¨ dashboard/index.module.css ä¸­å†™å…¥ï¼š\n\n```css\n.container {\n  color: theme(textColor.purple.400);\n}\n```\nåœ¨ dashboard/page.tsx ä¸­å¼•å…¥ï¼š\n\n```tsx\nimport styles from './index.module.css';\n\nexport default function Page() {\n  return \u003ch1 className={`${styles['container']}`}\u003eHello, Dashboard page!\u003c/h1\u003e\n}\n```\n\næˆ‘ä»¬è®¿é—®é¡µé¢æŸ¥çœ‹ï¼š\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-13.png)\n\n#### åœ¨ mdx æ–‡ä»¶ä¸­ä½¿ç”¨\n\nè‹¥è¦åœ¨ mdx æ–‡ä»¶ä¸­ä½¿ç”¨ï¼ŒApp Router éœ€è¦å¦‚ä¸‹é…ç½®ï¼š\n\nå®‰è£…ä¾èµ–ï¼š\n\n```sh\nyarn add  @next/mdx @mdx-js/loader @mdx-js/react @types/mdx\n```\n\nåœ¨ src ç›®å½•ä¸‹é…ç½® mdx-components.tsxï¼š\n\n```tsx\nimport type { MDXComponents } from 'mdx/types'\n \nexport function useMDXComponents(components: MDXComponents): MDXComponents {\n  return {\n    ...components,\n  }\n}\n```\nç„¶åæ–°å»ºä¸€ä¸ªåŒ…å« mdx æ–‡ä»¶çš„ç›®å½•ï¼š\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-14.png)\n\npage.mdx å†™é“ï¼š\n\n```mdx\n\u003cdiv className=\"bg-blue-500 p-4\"\u003e\n  This is a styled div.\n\u003c/div\u003e\n\nHello Mdx\n```\n\né¡µé¢æŸ¥çœ‹ï¼š\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-15.png)\n\næ ·å¼ç”Ÿæ•ˆäº†ï¼\n\n\n## 7. vite é¡¹ç›®ä¸­ä½¿ç”¨\n\næˆ‘ä»¬å…ˆé€šè¿‡ vite åˆ›å»ºä¸€ä¸ª vue é¡¹ç›®ï¼š\n\n```sh\nnpm create vite@latest my-project -- --template vue\n```\n\nç„¶åè¿›å…¥å·¥ç¨‹æ ¹ç›®å½•ä¸‹ï¼Œå®‰è£…ä¾èµ–å’Œåˆå§‹åŒ–é…ç½®ï¼š\n\n```sh\nyarn add --dev tailwindcss postcss autoprefixer\nnpx tailwindcss init -p\n```\n\né…ç½®æ–‡ä»¶ tailwind.config.js ä¸­å†™å…¥ä½ è¦æ‹¦æˆªçš„ä½¿ç”¨äº†cssèµ„æºçš„æ–‡ä»¶å†…å®¹ï¼š\n\n```js\nexport default {\n  content: [\n    \"./index.html\",\n    \"./src/**/*.{vue,js,ts,jsx,tsx}\",\n  ],\n  theme: {\n    extend: {},\n  },\n  plugins: [],\n}\n```\n\nåœ¨ style.css ä¸­å¼•å…¥ï¼š\n\n```css\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n```\n\næˆ‘ä»¬æŠŠ App.vue ä¸­è‡ªå¸¦çš„æ‰€æœ‰æ ·å¼æ¸…ç©ºï¼Œå†™ä¸‹å¦‚ä¸‹çš„æµ‹è¯•ä»£ç ï¼š\n\n```vue\n// æ–‡å­—ç²—ä½“. å¸¦ä¸‹åˆ’çº¿. 3xlå¤§å°\n\u003ch1 class=\"text-3xl font-bold underline\"\u003e Hello world! \u003c/h1\u003e\n```\n\nè¿è¡ŒæœåŠ¡ï¼Œå¯ä»¥çœ‹åˆ°æ•ˆæœå·²ç»å‡ºæ¥ï¼š\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-16.png)\n\n\n## 8. Nuxtjs é¡¹ç›®ä¸­ä½¿ç”¨\n\nnuxtjs æ¨èä½¿ç”¨æ”¯æŒ vue3 çš„æ¨¡å—åŒ–æ–¹æ¡ˆ nuxiã€‚æˆ‘ä»¬å…ˆåˆå§‹åŒ–é¡¹ç›®ï¼š\n\n```sh\nnpx nuxi init my-project\n```\n\nç„¶åè¿›å…¥æ ¹ç›®å½•ä¸‹å®‰è£…ä¾èµ–ï¼š\n\n```sh\nyarn\nnpx nuxi module add @nuxtjs/tailwindcss\nnpx tailwindcss init\n```\nè¿™é‡Œä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ tailwin.config.jsï¼Œä½¿ç”¨é»˜è®¤å€¼å°±å¯ä»¥ï¼Œçœ‹æ¥ nuxt çš„é›†æˆåº¦è¿˜æŒºé«˜çš„ã€‚ç›´æ¥å¯åŠ¨é¡¹ç›®ï¼Œä¿®æ”¹ app.vue:\n\n```vue\n\u003ctemplate\u003e\n\u003ch1 class=\"text-3xl font-bold underline\"\u003e\n  Hello world!\n\u003c/h1\u003e\n\u003c/template\u003e\n```\n\næŸ¥çœ‹æ•ˆæœï¼š\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-17.png)\n\n## 9. å®æˆ˜\n\n#### ï¼ˆ1. åˆ‡æ¢ä¸»é¢˜\n\ntailwindcss å†…ç½®äº† dark å¤œé—´æ¨¡å¼ï¼Œå¯ä»¥æ”¯æŒç™½å¤©å’Œé»‘å¤œçš„åˆ‡æ¢ã€‚æ¯”å¦‚ä½¿ç”¨å®˜æ–¹çš„è¿™ä¸ªä¾‹å­ï¼Œä½¿ç”¨æµè§ˆå™¨Â `prefers-color-scheme` åª’ä½“åŠŸèƒ½è¿›è¡Œå˜æ¢ï¼š\n\n```html\n\u003cdiv class=\"bg-white dark:bg-slate-800 rounded-lg px-6 py-8 ring-1 ring-slate-900/5 shadow-xl\"\u003e\n  \u003cdiv\u003e\n    \u003cspan class=\"inline-flex items-center justify-center p-2 bg-indigo-500 rounded-md shadow-lg\"\u003e\n      \u003csvg class=\"h-6 w-6 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" aria-hidden=\"true\"\u003e\u003c!-- ... --\u003e\u003c/svg\u003e\n    \u003c/span\u003e\n  \u003c/div\u003e\n  \u003ch3 class=\"text-slate-900 dark:text-white mt-5 text-base font-medium tracking-tight\"\u003eWrites Upside-Down\u003c/h3\u003e\n  \u003cp class=\"text-slate-500 dark:text-slate-400 mt-2 text-sm\"\u003e\n    The Zero Gravity Pen can be used to write in any orientation, including upside-down. It even works in outer space.\n  \u003c/p\u003e\n\u003c/div\u003e\n```\n\nä»–ä¼šè‡ªåŠ¨è¯†åˆ«æ“ä½œç³»ç»Ÿæ˜¯å¦æ˜¯å¤œé—´æ¨¡å¼ï¼Œå¹¶åº”ç”¨ dark:åè¾¹çš„å±æ€§ã€‚\n\nå¦‚æœæƒ³è¦æ‰‹åŠ¨åˆ‡æ¢å¤œé—´æ¨¡å¼ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶é‡Œè¿™æ ·é…ç½®ï¼š\n\n```js\nmodule.exports = {\n  darkMode: 'class', // media æ˜¯è‡ªåŠ¨è¯†åˆ«\n}\n```\n\næ­¤æ—¶å°† html è®¾ç½®ä¸ºå¤œé—´æ¨¡å¼å³å¯ï¼š\n\n```html\n\u003chtml class=\"dark\"\u003e\n```\n\n\u003e æ³¨æ„ï¼šé…ç½®é¡¹ä¸­ä½¿ç”¨äº† darkMode åï¼Œä¸èƒ½å†å‡ºç° theme å­—æ®µï¼Œå¦åˆ™ä¸‹é¢çš„ä¼šè¦†ç›–ä¸Šé¢çš„é…ç½®\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-18.png)\n\nä½ å¯ä»¥ä½¿ç”¨ç”¨æˆ·çš„ç³»ç»Ÿåå¥½ï¼ˆé¡µé¢ä¸Šæ”¾ç½®å¼€å…³æ§åˆ¶ localStorage é‡Œ theme å˜åŒ–ï¼‰æˆ–ä½¿ç”¨Â [`Window.matchMedia()`Â API](https://developer.mozilla.org/en-US/docs/Web/API/Window/matchMedia) æ¥è·å–å½“å‰æ“ä½œç³»ç»Ÿæ˜¯å¦ä¸ºå¤œé—´æ¨¡å¼ï¼š\n\n```js\nwindow.matchMedia('(prefers-color-scheme: dark)').matches\n```\næ£€æµ‹åˆ°å½“å‰ä¸ºå¤œé—´æ¨¡å¼æ—¶ï¼Œä¿®æ”¹ html æ ‡ç­¾çš„ classï¼Œæ·»åŠ  `dark` å³å¯ã€‚\n\nè¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸¤ç§æ¨¡å¼æ¯ä¸€ä¸ªæ–‡å­—. èƒŒæ™¯éƒ½è¦æŒ‡å®šé¢œè‰²ï¼Œè¿™ä¸ªå¯ä»¥æå‡ºåˆ°å…¬å…±æ ·å¼ä¸­ä½¿ç”¨ï¼š\n\n```scss\n.box {\n  @apply bg-white text-black;\n}\n\nhtml.dark {\n  .box {\n    @apply bg-slate-800 text-white;\n  }\n}\n```\n\nè¿™æ ·åœ¨å®šä¹‰ç±»çš„æ—¶å€™ï¼Œå°±ä¼šå®¹æ˜“ä¸€äº›ï¼š\n\n```html\n// ç™½å¤©\n\u003chtml\u003e\n  \u003cdiv class=\"box\"\u003e\u003c/box\u003e\n\u003c/html\u003e\n\n// å¤œæ™š\n\u003chtml class=\"dark\"\u003e\n  \u003cdiv class=\"box\"\u003e\u003c/box\u003e\n\u003c/html\u003e\n```\n\n#### ï¼ˆ2. ç€‘å¸ƒæµå¸ƒå±€\n\n\u003e è¿™æ˜¯å®˜ç½‘æ ·ä¾‹\n\nç€‘å¸ƒæµçš„ç²¾é«“åœ¨äºå„ç§ä¸åŒå°ºå¯¸çš„å›¾ç‰‡èƒ½å¤Ÿå®Œç¾çš„è®¡ç®—é«˜åº¦å¹¶é€æ¬¡æ’é˜Ÿã€‚æˆ‘ä»¬å‡è®¾è¦æ˜¾ç¤ºä¸‰åˆ—å›¾ç‰‡ï¼Œæˆ‘ä»¬å°±è®¾ç½®ä¸€ä¸ªå“åº”å¼çš„åˆ—å¸ƒå±€ç›’å­å®¹å™¨ï¼š\n\n```html\n\u003cdiv class=\"columns-2 sm:columns-3 gap-8\"\u003e\n```\næ­¤æ—¶ï¼Œæ ·å¼å¦‚ä¸‹ï¼š\n\n![image.png](/img/posts/2023-11-11/2023-11-11-19.png)\n\nè¡¨ç¤ºåœ¨ å¤§äº sm å°ºå¯¸ä¸‹ï¼Œä½¿ç”¨ 3åˆ—å¸ƒå±€ï¼Œå¦åˆ™ä½¿ç”¨ 2åˆ—å¸ƒå±€ã€‚gap è¡¨ç¤ºæ¯ä¸€åˆ—ä¹‹é—´çš„é—´è·ï¼Œä¸è®¾ç½®çš„è¯é»˜è®¤ 16px (ç»§æ‰¿å±æ€§ï¼Œchrome æ˜¯ 16px)ã€‚\n\nå®¹å™¨å†…æ”¾ç½®ä¸€ä¸ªä¸€ä¸ªçš„å›¾ç‰‡ã€‚æˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨ div æ¥åŒ…è£¹å›¾ç‰‡ï¼š\n\n```html\n\u003cdiv class=\"aspect-w-16 aspect-h-9\"\u003e\n  \u003cimg class=\"w-full object-cover rounded-lg\" src=\"\"\u003e\n\u003c/div\u003e\n```\n-   `aspect-w-16`: è¿™ä¸ªç±»è¡¨ç¤ºè®¾ç½®ä¸€ä¸ªå…ƒç´ çš„å®½åº¦ï¼Œä½¿å…¶å®½åº¦ä¸ºé«˜åº¦çš„16å€ã€‚\n-   `aspect-h-9`: è¿™ä¸ªç±»è¡¨ç¤ºè®¾ç½®ä¸€ä¸ªå…ƒç´ çš„é«˜åº¦ï¼Œä½¿å…¶é«˜åº¦ä¸ºå®½åº¦çš„9å€ã€‚\n\nå½“ç„¶è¿™ä¸¤ä¸ªç±»æ˜¯å·²çŸ¥å›¾ç‰‡é•¿å®½æ¯”æ—¶å¯ä»¥è¿™ä¹ˆå†™ï¼Œä¸çŸ¥é“çš„è¯å°±ä¸å†™ã€‚.w-full è¡¨ç¤ºå®½åº¦æ’‘æ»¡è¯¥åˆ—ï¼Œobject-cover å…ƒç´ è¢«ç¼©æ”¾ä»¥è¦†ç›–æ•´ä¸ªå®¹å™¨æ¡†ï¼Œä½†å¯èƒ½ä¼šè¢«è£å‰ªã€‚\n\nå› ä¸ºæ˜¯åˆ—å¼å¸ƒå±€ï¼Œæ˜¯ä»å·¦å¼€å§‹ï¼Œä»ä¸Šå¾€ä¸‹å¸ƒå±€çš„ï¼Œæ‰€ä»¥ä¹‹åçš„å…ƒç´ éƒ½éœ€è¦åŠ ä¸Š marginï¼š\n\n```html\n\u003cdiv class=\"aspect-w-1 aspect-h-1 mt-8\"\u003e\n```\nç„¶åæˆ‘ä»¬å†åŠ ä¸Šå¤–è¾¹æ¡†å’Œå±…ä¸­æ ·å¼ç¾åŒ–ï¼Œå…¨éƒ¨ä»£ç å¦‚ä¸‹ï¼š\n\n```html\n\u003cbody class=\"p-12 m-auto\"\u003e\n  \u003cdiv class=\"container flex justify-center\"\u003e\n    \u003cdiv class=\"columns-2 sm:columns-3 gap-8\"\u003e\n      \u003cdiv\u003e\n        \u003cimg class=\"w-full object-cover rounded-lg\" src=\"https://images.unsplash.com/photo-1454496522488-7a8e488e8606?ixlib=rb-1.2.1\u0026amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026amp;auto=format\u0026amp;fit=crop\u0026amp;w=2952\u0026amp;q=80\"\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\" aspect-w-1 aspect-h-1 mt-8\"\u003e\n        \u003cimg class=\"w-full object-cover rounded-lg\" src=\"https://images.unsplash.com/photo-1434394354979-a235cd36269d?ixlib=rb-1.2.1\u0026amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026amp;auto=format\u0026amp;fit=crop\u0026amp;w=2902\u0026amp;q=80\"\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"aspect-w-1 aspect-h-1 mt-8\"\u003e\n        \u003cimg class=\"w-full object-cover rounded-lg\" src=\"https://images.unsplash.com/photo-1491904768633-2b7e3e7fede5?ixlib=rb-1.2.1\u0026amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026amp;auto=format\u0026amp;fit=crop\u0026amp;w=3131\u0026amp;q=80\"\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"sm:block  aspect-w-1 aspect-h-1 mt-8\"\u003e\n        \u003cimg class=\"w-full object-cover rounded-lg\" src=\"https://images.unsplash.com/photo-1463288889890-a56b2853c40f?ixlib=rb-1.2.1\u0026amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026amp;auto=format\u0026amp;fit=crop\u0026amp;w=3132\u0026amp;q=80\"\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"sm:block  aspect-w-16 aspect-h-9 mt-8\"\u003e\n        \u003cimg class=\"w-full object-cover rounded-lg\" src=\"https://images.unsplash.com/photo-1611605645802-c21be743c321?ixlib=rb-1.2.1\u0026amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026amp;auto=format\u0026amp;fit=crop\u0026amp;w=2940\u0026amp;q=80\"\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"sm:block  aspect-w-1 aspect-h-1 mt-8\"\u003e\n        \u003cimg class=\"w-full object-cover rounded-lg\" src=\"https://images.unsplash.com/photo-1498603993951-8a027a8a8f84?ixlib=rb-1.2.1\u0026amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026amp;auto=format\u0026amp;fit=crop\u0026amp;w=2936\u0026amp;q=80\"\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"sm:block  aspect-w-1 aspect-h-1 mt-8\"\u003e\n        \u003cimg class=\"w-full object-cover rounded-lg\" src=\"https://images.unsplash.com/photo-1526400473556-aac12354f3db?ixlib=rb-1.2.1\u0026amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026amp;auto=format\u0026amp;fit=crop\u0026amp;w=2940\u0026amp;q=80\"\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"sm:block  aspect-w-1 aspect-h-1 mt-8\"\u003e\n        \u003cimg class=\"w-full object-cover rounded-lg\" src=\"https://images.unsplash.com/photo-1617369120004-4fc70312c5e6?ixlib=rb-1.2.1\u0026amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026amp;auto=format\u0026amp;fit=crop\u0026amp;w=1587\u0026amp;q=80\"\u003e\n      \u003c/div\u003e\n      \u003cdiv class=\"sm:block  aspect-w-16 aspect-h-9 mt-8\"\u003e\n        \u003cimg class=\"w-full object-cover rounded-lg\" src=\"https://images.unsplash.com/photo-1518892096458-a169843d7f7f?ixlib=rb-1.2.1\u0026amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026amp;auto=format\u0026amp;fit=crop\u0026amp;w=2940\u0026amp;q=80\"\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\u003c/body\u003e\n```\n\næ•ˆæœå›¾ï¼š\n\nå¤§å±ï¼š\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-20.png)\n\nå°å±ï¼š\n\n\n![image.png](/img/posts/2023-11-11/2023-11-11-21.png)\n\n#### ï¼ˆ3. å†™ä¸€ä¸ªå¸¦åŠ¨ç”»çš„ç»„ä»¶\n\ntailwindcss å†…ç½®äº†ä¸€ä¸ªå°å‹çš„åŠ¨ç”»åº“ï¼Œå¯ä»¥ä½¿ç”¨ç±»æ¥æ§åˆ¶ã€‚ä¸‹é¢çš„ä»£ç æ˜¯ä¸€ä¸ªå¼¹è·³çš„æŒ‰é’®ï¼š\n\n```html\n\u003cbutton type=\"button\" class=\"animate-bounce bg-indigo-500 text-white p-2 rounded-md\"\u003e\n  Hello World\n\u003c/button\u003e\n```\n\næ•ˆæœå¦‚ä¸‹ï¼š\n\n![å±å¹•å½•åˆ¶2023-11-16-ä¸‹åˆ2.37.29.gif](/img/posts/2023-11-11/2023-11-11-22.gif)\n\n\n-----\n\nå¤§è‡´è®²è§£å°±è¿™ä¹ˆå¤šå•¦ï¼Œå€ºè§ï¼"])</script><script>self.__next_f.push([1,"1f:T3797,"])</script><script>self.__next_f.push([1,"## 1. Hooks\n\n### use\n\n`use` æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨åˆ†æ”¯è·Ÿå¾ªç¯ä¸­ä½¿ç”¨çš„ React Hookï¼Œå®ƒå¯ä»¥è®©ä½ è¯»å–ç±»ä¼¼äº [Promise](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise) æˆ– [context](https://zh-hans.react.dev/learn/passing-data-deeply-with-context) çš„èµ„æºçš„å€¼ã€‚\n\n\u003e `use` Hook ç›®å‰ä»…åœ¨ canary ä¸ experimental æ¸ é“ä¸­å¯ç”¨\n\n- ä½¿ç”¨ use è¯»å– context çš„å€¼\n\n```js\nconst theme = use(ThemeContext);\n```\næ­¤æ—¶ç±»ä¼¼äº useContextï¼Œä¸è¿‡ use æ›´åŠ çµæ´»ã€‚React ä¼šæœç´¢ç»„ä»¶æ ‘å¹¶æ‰¾åˆ° æœ€æ¥è¿‘çš„ context provider ä»¥ç¡®å®šéœ€è¦è¿”å›çš„ context å€¼ã€‚å®ƒå‘ä¸Šæœç´¢å¹¶å¿½ç•¥è°ƒç”¨ `use(context)` çš„ç»„ä»¶æœ¬èº«ä¸­çš„ context providerã€‚\n\n- ä¼ é€’ promise çš„å€¼\n\nå¦‚æœä½ ä½¿ç”¨äº†æœåŠ¡ç«¯æ¸²æŸ“ API æ¥æ‰‹åŠ¨é…ç½® SSRï¼Œä½ å¯èƒ½ä¼šåœ¨æœåŠ¡ç«¯æ¨é€ä¸€ä¸ªæµå¼ï¼ˆstreamï¼‰æ•°æ®ï¼Œåœ¨å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ use æ¥å—ã€‚\n\n```js\n// æ ¹ç»„ä»¶é€šè¿‡ fetchMessage è·å–æµï¼ŒåŒ…è£…ä¸º promise ç»™åˆ° Messageç»„ä»¶\nexport default function App() {\n  const messagePromise = fetchMessage();\n  return (\n    \u003cSuspense fallback={\u003cp\u003ewaiting for message...\u003c/p\u003e}\u003e\n      \u003cMessage messagePromise={messagePromise} /\u003e\n    \u003c/Suspense\u003e\n  );\n}\n```\n\nMessageç»„ä»¶ä¸­ï¼š\n\n```js\n// message.js\n'use client';\n\nimport { use } from 'react';\n\nexport function Message({ messagePromise }) {\n  const messageContent = use(messagePromise);\n  return \u003cp\u003eHere is the message: {messageContent}\u003c/p\u003e;\n}\n```\n\nuse å¯ä»¥å’Œ Suspense è”åŠ¨ï¼Œå½“ä¼ é€’çš„ promise æ²¡æœ‰ fullfill æ—¶ï¼Œloading ä¸€ç›´ç”Ÿæ•ˆï¼Œå½“ promise æˆåŠŸä»¥åï¼Œæ˜¾ç¤º resolve çš„å€¼ã€‚\n\n\u003e å°†æ¥è‡ªæœåŠ¡å™¨ç»„ä»¶çš„ Promise ä¼ é€’è‡³å®¢æˆ·ç«¯ç»„ä»¶æ—¶ï¼Œå…¶è§£æå€¼å¿…é¡»å¯åºåˆ—åŒ–ä»¥åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´ä¼ é€’ã€‚åƒå‡½æ•°è¿™æ ·çš„æ•°æ®ç±»å‹ä¸å¯åºåˆ—åŒ–ï¼Œä¸èƒ½æˆä¸ºè¿™ç§ Promise çš„è§£æå€¼ã€‚\n\n- å¤„ç† promise é”™è¯¯è¾¹ç•Œ\n\nå½“ promise æŠ¥é”™æ—¶ï¼Œuse éœ€è¦æ‰‹åŠ¨è®¾ç½®æ•è·é”™è¯¯ï¼š\n\n```js\nimport { ErrorBoundary } from \"react-error-boundary\";\n\n\u003cErrorBoundary fallback={\u003cp\u003eâš ï¸Something went wrong\u003c/p\u003e}\u003e\n  \u003cSuspense fallback={\u003cp\u003eâŒ›Downloading message...\u003c/p\u003e}\u003e\n    \u003cMessage messagePromise={messagePromise} /\u003e\n  \u003c/Suspense\u003e\n\u003c/ErrorBoundary\u003e\n```\n\nä¸Šé¢çš„ç¤ºä¾‹ä½¿ç”¨äº†ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚æœä¸ä½¿ç”¨ ErrorBoundary åŒ…è£¹ï¼Œè¿˜å¯ä»¥è¿™æ ·å†™ï¼š\n\n```js\n  const messagePromise = new Promise((resolve, reject) =\u003e {\n    reject();\n  }).catch(() =\u003e {\n    return \"no new message found.\";\n  });\n```\nä½¿ç”¨ promise è‡ªå¸¦çš„ catch æ•è·é”™è¯¯ã€‚catch ä¸­ return çš„å†…å®¹ï¼Œä¼šè¢«è§†ä½œæ­£å¸¸çš„è¿”å›ã€‚\n\n\u003e ä¸èƒ½åœ¨ React ç»„ä»¶æˆ– Hook å‡½æ•°ä¹‹å¤–è°ƒç”¨ `use`ï¼Œæˆ–è€…åœ¨ try-catch å—ä¸­è°ƒç”¨ `use`\n\n### useOptimistic\n\n\u003e `useOptimistic`Â Hook ç›®å‰ä»…åœ¨ canary ä¸ experimental æ¸ é“ä¸­å¯ç”¨\n\nè¿™ä¸ª hook ç”¨äºä¼˜åŒ– UI çš„æ›´æ–°ã€‚\n\nè€ƒè™‘ä¸‹é¢çš„åœºæ™¯ï¼Œç•Œé¢ä¸Šä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»å¯ä»¥å¼‚æ­¥è°ƒç”¨å‘é€æ¥å£ï¼š\n\n```js\n\u003cform action={formAction} ref={formRef}\u003e\n  \u003cinput type=\"text\" name=\"message\" placeholder=\"Hello!\" /\u003e\n  \u003cbutton type=\"submit\"\u003eSend\u003c/button\u003e\n\u003c/form\u003e\n```\n\nè¡¨å•å“åº”ï¼Œåœ¨å‘é€å®Œæ•°æ®åæ˜¾ç¤ºå‘é€çš„æ•°æ®ï¼š\n\n```js\nasync function formAction(formData) {\n  // è¿™ä¸€æ¡ç°åœ¨æ²¡æœ‰ï¼Œä¸‹é¢å¼•å…¥ä¹è§‚æ¶ˆæ¯æ—¶åŠ å…¥\n  addOptimisticMessage(formData.get(\"message\"));\n  formRef.current.reset();\n  await sendMessage(formData);\n}\n\nasync function sendMessage(formData) {\n  // deliverMessage æ˜¯ API çš„è°ƒç”¨\n  const sentMessage = await deliverMessage(formData.get(\"message\"));\n  setMessages([...messages, { text: sentMessage }]);\n}\n```\nè¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼ŒsendMessage æ˜¯ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œåœ¨å‘é€å®Œæˆåï¼Œè°ƒç”¨ setMessages æ”¹å˜ state çš„å€¼ï¼Œè¿™æ—¶åœ¨å‘é€è®°å½•åˆ—è¡¨é‡Œå°±ä¼šæœ‰ä¸€æ¡è®°å½•ã€‚ä½†æ˜¯åœ¨å‘é€è¿‡ç¨‹ä¸­ï¼Œè¯¥è®°å½•æ˜¯ä¸ä¼šå‡ºç°çš„ã€‚\n\næ­¤æ—¶ï¼Œæˆ‘ä»¬å£°æ˜ä¸€ä¸ªä¹è§‚çŠ¶æ€ï¼š\n\n```js\n const [optimisticMessages, addOptimisticMessage] = useOptimistic(\n    messages,\n    (state, newMessage) =\u003e [\n      ...state,\n      {\n        text: newMessage,\n        sending: true\n      }\n    ]\n  );\n```\nä»–ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åˆšåˆšçš„ stateï¼šmessagesï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒï¼Œå®æ—¶æ¥å—æœ€æ–°çš„çŠ¶æ€å¹¶è¿”å›è‡ªå®šä¹‰çš„ç»“æ„ã€‚\n\næˆ‘ä»¬åœ¨åˆ—è¡¨æ¸²æŸ“çš„åœ°æ–¹å°±å¯ä»¥è¿™æ ·å†™äº†ï¼š\n\n```js\n{optimisticMessages.map((message, index) =\u003e (\n    \u003cdiv key={index}\u003e\n      {message.text}\n      {!!message.sending \u0026\u0026 \u003csmall\u003e (Sending...)\u003c/small\u003e}\n    \u003c/div\u003e\n))}\n```\nè¿™æ ·ï¼Œåœ¨å‘é€çš„è¿‡ç¨‹ä¸­ï¼ŒaddOptimisticMessage è¢«è°ƒç”¨äº†ï¼Œæ•°ç»„è¿½åŠ çš„é‚£ä¸ªå…ƒç´ å¤„äº sending ä¸­ï¼Œå°±ä¼šæ˜¾ç¤º sending çš„æ–‡æœ¬ï¼›åœ¨æ¥å£è¯·æ±‚æˆåŠŸåï¼ŒoptimisticMessages ä¼šæ£€æµ‹åˆ°è¯·æ±‚å®Œæ¯•ï¼Œè‡ªåŠ¨ç¦»åœºã€‚æˆ‘ä»¬å®éªŒä¸¤æ¬¡ï¼Œæ‰“å°ä¸€ä¸‹è¿™ä¸ª optimisticMessages çŠ¶æ€çš„å€¼ï¼š\n\n\n![image.png](/img/posts/2023-11-9/2023-11-9-1.png)\n\nå½“æ¥å£è°ƒç”¨å®Œæ¯•åï¼Œå› ä¸ºè°ƒç”¨äº† sendMessageï¼Œæ‰€ä»¥ addOptimisticMessages å’Œ messages ä¸¤ä¸ªçŠ¶æ€å°±è¶‹äºä¸€è‡´äº†ã€‚\n\n\u003e **useOptimistic** æ˜¯ä¸€ç§ä¹è§‚æ›´æ–°æœºåˆ¶ï¼Œä¸»è¦åº”ç”¨äºéœ€è¦ä¸æœåŠ¡å™¨è¿›è¡Œå¼‚æ­¥äº¤äº’çš„åœºæ™¯ï¼Œå¦‚æ¶ˆæ¯å‘é€ã€‚åœ¨è¿™ç§æœºåˆ¶ä¸‹ï¼Œé€šå¸¸å¸Œæœ›ä¼˜å…ˆæ˜¾ç¤ºæ–°æ•°æ®æˆ–æ–°çŠ¶æ€ï¼Œè€Œä¸æ˜¯ç­‰å¾…æœåŠ¡å™¨è¿”å›å“åº”åå†è¿›è¡Œæ›´æ–°ï¼›\n\u003e \n\u003e **useTransition** ä¸»è¦è§£å†³çš„æ˜¯åœ¨ç•Œé¢åˆ‡æ¢è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„å†…å®¹åŠ è½½é—®é¢˜ã€‚å®ƒå…è®¸ç»„ä»¶åœ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªç•Œé¢ä¹‹å‰ç­‰å¾…å†…å®¹åŠ è½½ï¼Œä»è€Œé¿å…å‡ºç°ä¸å¿…è¦çš„åŠ è½½çŠ¶æ€ã€‚\n\n### useFormState\n\n\u003e `useFormState` Hook ç›®å‰ä»…åœ¨ canary ä¸ experimental æ¸ é“ä¸­å¯ç”¨\n\n`useFormState` æ˜¯ react-dom åº“ä¸‹çš„ hookï¼Œå…è®¸æ ¹æ®è¡¨å•æ“ä½œçš„ç»“æœæ›´æ–°çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š\n\n```js\nfunction AddToCartForm({itemID, itemTitle}) {\n  const [message, formAction] = useFormState(addToCart, null);\n  return (\n    \u003cform action={formAction}\u003e\n      \u003ch2\u003e{itemTitle}\u003c/h2\u003e\n      \u003cinput type=\"hidden\" name=\"itemID\" value={itemID} /\u003e\n      \u003cbutton type=\"submit\"\u003eAdd to Cart\u003c/button\u003e\n      {message}\n    \u003c/form\u003e\n  );\n}\n```\nå…¶ä¸­ action.js\n\n```js\n\"use server\";\n\n// æ¨¡æ‹ŸæœåŠ¡ç«¯å…¥åº“å“åº”\nexport async function addToCart(prevState, queryData) {\n  const itemID = queryData.get('itemID');\n  if (itemID === \"1\") {\n    return \"Added to cart\";\n  } else {\n    return \"Couldn't add to cart: the item is sold out.\";\n  }\n}\n```\n\nuseFormState ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯actionè§¦å‘å‡½æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯ åˆå§‹å€¼ã€‚å½“è§¦å‘ action æäº¤æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼šè¢«è°ƒç”¨ï¼ŒaddToCart æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å˜åŒ–å‰ message çš„å€¼ï¼Œç¬¬äºŒä¸ªæ˜¯ formData å¯¹è±¡ï¼Œå…¶è¿”å›çš„å€¼ä¼šå¤åˆ¶åˆ° message é‡Œï¼Œå¹¶æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Šã€‚\n \nmessage å¯ä»¥ç†è§£ä¸ºéªŒè¯è¡¨å•åçš„è¿”å›å€¼ã€‚\n\nä¸Šé¢ä»£ç æ‰§è¡Œæµç¨‹ï¼š\n\nç‚¹å‡»æäº¤ ==\u003e è§¦å‘ addToCart ==\u003e è¿”å›è¡¨å•å¤„ç†çš„ç»“æœï¼Œè‡ªåŠ¨èµ‹å€¼ç»™ message\n\n\u003e è¿™ä¸ª hook å¯ä»¥ç”¨äºè¡¨å•æ ¡éªŒåçš„é”™è¯¯/ä¿¡æ¯å±•ç¤ºï¼Œåªæ”¯æŒåœ¨å®¢æˆ·ç«¯ä½¿ç”¨\n\n### useFormStatus\n\n\u003e `useFormStatus`Â Hook ç›®å‰ä»…åœ¨ canary ä¸ experimental æ¸ é“ä¸­å¯ç”¨\n\nä¸ useFormState éƒ½æ˜¯ react-dom åº“ä¸‹çš„ hookï¼Œä½†æ˜¯ä¸å‰è€…ç»Ÿä¸€æ”¶é›†è¡¨å•æ ¡éªŒçŠ¶æ€ä¸åŒï¼Œ`useFormStatus` æ˜¯ä¸€ä¸ªæä¾›è¡¨å•æäº¤åçŠ¶æ€ä¿¡æ¯çš„ Hookã€‚\n\nå…¶ä½¿ç”¨åœ¨è¡¨å•å†…éƒ¨ï¼š\n\n```js\n\u003cform action={submitForm}\u003e\n  \u003cUsernameForm /\u003e\n\u003c/form\u003e\n\n...\n\nexport async function submitForm(query) {\n  await new Promise((res) =\u003e setTimeout(res, 1000));\n}\n```\næˆ‘ä»¬åœ¨ UsernameForm ä¸­å®šä¹‰ä¸€ä¸ªï¼š\n\n```js\nconst {pending, data} = useFormStatus();\n\n...\n\u003cbutton type=\"submit\" disabled={pending}\u003e\n  {pending ? 'æäº¤ä¸­â€¦â€¦' : 'æäº¤'}\n\u003c/button\u003e\n{showSubmitted ? (\n  \u003cp\u003eæäº¤è¯·æ±‚ç”¨æˆ·åï¼š{submittedUsername.current}\u003c/p\u003e\n) : null}\n```\n\nè¡¨å•çš„æäº¤ action æ˜¯ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œæ¯”å¦‚ Promiseï¼Œå½“å¼‚æ­¥è¯·æ±‚æ²¡æœ‰ç»“æŸæ—¶ï¼Œpending å°±ä¼šæ˜¯ trueï¼Œè¯¥è¿‡ç¨‹ä¸­ data ä¾¿æ˜¯æ•´ä¸ªè¡¨å•æäº¤çš„æ•°æ®ä¿¡æ¯ã€‚è¿™ä¸ª hook ç›¸å½“äºåœ¨æäº¤è¿‡ç¨‹ä¸­å°†è¡¨å•æ•°æ®å’Œæäº¤è¿›åº¦æš´éœ²äº†å‡ºæ¥ï¼Œä¾¿äºå‰ç«¯å±•ç¤ºå¯¹åº”çš„å“åº”å¼é¡µé¢ã€‚\n\n## 2. APIs\n\n### cache\n\n`cache` å…è®¸ç¼“å­˜æ•°æ®è·å–æˆ–è®¡ç®—çš„ç»“æœã€‚ä»–å¯ä»¥åœ¨**ä»»ä½•ç»„ä»¶ä¹‹å¤–**è°ƒç”¨ï¼Œæ˜¯ç¼“å­˜ hook çš„é€šç”¨å½¢å¼ã€‚\n\n\u003e `cache` ä»…åœ¨ React çš„ [Canary](https://zh-hans.react.dev/community/versioning-policy#canary-channel) å’Œ [experimental](https://zh-hans.react.dev/community/versioning-policy#experimental-channel) æ¸ é“ä¸­å¯ç”¨\n\n- ç¼“å­˜é‡å¤è®¡ç®—\n\næ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå¾ˆå¤æ‚çš„è®¡ç®—ï¼š\n\n```js\nimport calculateUserMetrics from 'lib/user';\n\nconst getUserMetrics = cache(calculateUserMetrics);\n```\nä½¿ç”¨ cache ç¼“å­˜ä»¥åï¼Œåœ¨å‡½æ•°é‡Œç›´æ¥å¼•ç”¨å³å¯ï¼š\n\n```js\nfunction TeamReport({users}) {\n  for (let user in users) {\n    const metrics = getUserMetrics(user);\n    // ...\n  }\n  // ...\n}\n```\n\ncache æ¥å—ä¸€ä¸ªå‡½æ•°å½“åšè®¡ç®—å‡½æ•°ï¼Œcache è¿”å›çš„å€¼ä¸ºä¸€ä¸ªå•ä¾‹å‡½æ•°ï¼Œå†³å®šè¿™ä¸ªå‡½æ•°æ˜¯å¦è·å–ç¼“å­˜çš„å”¯ä¸€æŒ‡æ ‡å°±æ˜¯ä¼ å…¥çš„å€¼æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸¤æ¬¡æ¢å…¥çš„å‚æ•°ï¼ˆä¸Šé¢çš„ä¾‹å­æ˜¯ user å¯¹è±¡ï¼‰å¼•ç”¨ç›¸åŒï¼Œåˆ™ç¬¬äºŒæ¬¡ä½¿ç”¨ç¼“å­˜ã€‚\n\n- ç¼“å­˜ API æ•°æ®\n\n```js\nconst getTemperature = cache(async (city) =\u003e {\n\treturn await fetchTemperature(city);\n});\n\n// ä½¿ç”¨\nasync function AnimatedWeatherCard({city}) {\n\tconst temperature = await getTemperature(city);\n\t// ...\n}\n```\n\nç±»ä¼¼åœ°ï¼Œä»–å¯ä»¥æ¥å—å¼‚æ­¥å‡½æ•°ä½œä¸ºè®¡ç®—å‡½æ•°ä¼ å…¥ï¼Œä¼ å…¥çš„ city ä¸ºç›¸åŒçš„å€¼æ—¶ï¼Œç›´æ¥å–ç¼“å­˜ã€‚\n\n- é¢„åŠ è½½æ•°æ®\n\nå¯ä»¥ç”¨ cache æ‰‹åŠ¨é…ç½®é¢„åŠ è½½ï¼Œåœ¨é¡µé¢åˆå§‹åŒ–æ—¶é¢„å…ˆè·å–æ•°æ®ï¼š\n\n```js\nconst getUser = cache(async (id) =\u003e {\n  return await db.user.query(id);\n})\n...\nfunction Home({id}) {\n  // âœ… æ­£ç¡®ç¤ºä¾‹ï¼šå¼€å§‹è·å–ç”¨æˆ·æ•°æ®ã€‚\n  getUser(id);\n  // â€¦â€¦ä¸€äº›è®¡ç®—å·¥ä½œ\n  return (\n    \u003c\u003e\n      \u003cProfile id={id} /\u003e\n    \u003c/\u003e\n  );\n}\n```\nè¿™æ ·ï¼Œåœ¨æ”¹ç™»å½•ç”¨æˆ·çš„ä»»æ„é¡µé¢ï¼Œéƒ½å¯ä»¥æˆ‘å»¶æ—¶è·å–ç”¨æˆ·ä¿¡æ¯ï¼š\n\n```js\nconst user = await getUser(id);\n```\n\n### experimental_taintObjectReference\n\nè¿™ä¸ª API è¿˜ä¸ç¨³å®šï¼Œè¿˜åœ¨å¼€å‘ä¸­ï¼Œç”¨äºé˜»æ­¢ç‰¹å®šç”¨æˆ·æ•°æ®å¯¹è±¡å®ä¾‹è¢«ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶ï¼Œä¾‹å¦‚ `user` å¯¹è±¡ã€‚\n\n```js\nimport {experimental_taintObjectReference} from 'react';\n\nexport async function getUser(id) {\n  const user = await db`SELECT * FROM users WHERE id = ${id}`;\n  experimental_taintObjectReference(\n    'Do not pass the entire user object to the client. ' +\n      'Instead, pick off the specific properties you need for this use case.',\n    user,\n  );\n  return user;\n}\n```\nä»–çš„å­—é¢æ„æ€æ˜¯æ±¡æŸ“å¯¹è±¡å¼•ç”¨ï¼Œå°±æ˜¯è¯´å°† user åŠ«æŒäº†ï¼Œä¸ç»™ä½ å®¢æˆ·ç«¯ç”¨äº†ã€‚ç›®å‰è½åœ°å®ç°è¿˜ä¸æ˜ç¡®ï¼ŒæœŸå¾…æ­£å¼ç‰ˆæœ¬ã€‚\n\n### experimental_taintUniqueValue\n\nè¿™ä¸ª API è¿˜ä¸ç¨³å®šï¼Œè¿˜åœ¨å¼€å‘ä¸­ï¼Œç”¨äºé˜²æ­¢å°†å”¯ä¸€å€¼ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶ï¼Œä¾‹å¦‚å¯†ç ã€å¯†é’¥æˆ–ä»¤ç‰Œã€‚\n\n```js\nimport {experimental_taintUniqueValue} from 'react';\n\nexport async function getUser(id) {\n  const user = await db`SELECT * FROM users WHERE id = ${id}`;\n  experimental_taintUniqueValue(\n    'Do not pass a user session token to the client.',\n    user,\n    user.session.token\n  );\n  return user;\n}\n```\n\nå®˜æ–¹åªç»™äº†è¿™ä¹ˆä¸ªä¾‹å­ï¼Œå…·ä½“ä½¿ç”¨ç»†èŠ‚è¿˜æœ‰å¾…è€ƒè¯ã€‚\n\n## 3. æŒ‡ä»¤\n\næŒ‡ä»¤è¿™ä¸ªæ¦‚å¿µåœ¨ react ä¸­ç®—æ˜¯ä¸€ä¸ªç¨€å¥‡äº‹ï¼Œvue ä¸­æœ‰ v-ifï¼Œng ä¸­å¤©ç„¶å†…ç½® Directiveï¼Œreact ä¸­è¿™ä¹Ÿå¼€å§‹å¼•å…¥æŒ‡ä»¤çš„æ¦‚å¿µäº†ã€‚\n\n### use client\n\nç”¨äºæœåŠ¡ç«¯æ¸²æŸ“ä»£ç é‡Œã€‚React æœåŠ¡ç«¯ç»„ä»¶é»˜è®¤æ˜¯èµ° SSR çš„ï¼Œä½¿ç”¨è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šå½“å‰æ–‡ä»¶æ˜¯å±äºå®¢æˆ·ç«¯çš„ã€‚\n\nå¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š\n\n```js\n'use client';\n\nimport { useState } from 'react';\nimport inspirations from './inspirations'; // å­—åº“ï¼Œè¿™é‡Œå¯å¿½ç•¥\nimport FancyText from './FancyText';  // å±•ç¤ºæ–‡å­—çš„ç»„ä»¶\n\nexport default function InspirationGenerator({children}) {\n  const [index, setIndex] = useState(0);\n  const quote = inspirations[index];\n  const next = () =\u003e setIndex((index + 1) % inspirations.length);\n\n  return (\n    \u003c\u003e\n      \u003cp\u003eYour inspirational quote is:\u003c/p\u003e\n      \u003cFancyText text={quote} /\u003e\n      \u003cbutton onClick={next}\u003eInspire me again\u003c/button\u003e\n      {children}\n    \u003c/\u003e\n  );\n}\n```\nä¸Šé¢çš„ç»„ä»¶æ˜¯ä¸€ä¸ªå°è£…çš„æ–‡å­—ç”Ÿæˆå™¨ç»„ä»¶ï¼Œæˆ‘ä»¬åœ¨å…¥å£æ–‡ä»¶ä¸­å¼•å…¥ï¼š\n\n```js\nimport FancyText from './FancyText';\nimport InspirationGenerator from './InspirationGenerator';\nimport Copyright from './Copyright';\n\nexport default function App() {\n  return (\n    \u003c\u003e\n      \u003cFancyText title text=\"Get Inspired App\" /\u003e\n      \u003cInspirationGenerator\u003e\n        \u003cCopyright year={2004} /\u003e\n      \u003c/InspirationGenerator\u003e\n    \u003c/\u003e\n  );\n}\n```\nè¿™å°±åšäº†éš”ç¦»äº†ï¼Œæ€»çš„ä»£ç éƒ½æ˜¯æœåŠ¡ç«¯ç›´å‡ºçš„ï¼Œä½†æ˜¯ InspirationGenerator æ ‡è®°äº†ä½¿ç”¨åœ¨å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬å€Ÿç”¨å®˜ç½‘çš„è°ƒç”¨æ ‘è¯´æ˜ç°åœ¨çš„å¼•ç”¨å…³ç³»ï¼š\n\n\n\n![image.png](/img/posts/2023-11-9/2023-11-9-2.png)\n\nInspirationGenerator æ ‡è®°äº†ä¸ºå®¢æˆ·ç«¯æ¸²æŸ“ï¼Œåˆ™å…¶ä½œä¸ºå…¶å®èŠ‚ç‚¹çš„æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½ä¼šé‡‡ç”¨å®¢æˆ·ç«¯æ¸²æŸ“äº†ã€‚\n\næˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æ¸²æŸ“å…³ç³»ï¼š\n\n\n![image.png](/img/posts/2023-11-9/2023-11-9-3.png)\n\nå¯ä»¥çœ‹åˆ°ï¼ŒCopyright è™½ç„¶æ˜¯ InspirationGenerator ç»„ä»¶å†…éƒ¨çš„ childrenï¼Œä½†æ˜¯ä»å¼•ç”¨å…³ç³»æ¥çœ‹ï¼Œæ²¡æœ‰è¢« 'use client' æ ‡è®°ï¼Œæ‰€ä»¥å°±èµ°æœåŠ¡ç«¯æ¸²æŸ“ã€‚\n\n### use server\n\nç”¨äºæœåŠ¡ç«¯æ¸²æŸ“ä»£ç é‡Œã€‚React æœåŠ¡ç«¯ç»„ä»¶é»˜è®¤æ˜¯èµ° SSR çš„ï¼Œä½¿ç”¨è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šå½“å‰æ–‡ä»¶æ˜¯å±äºæœåŠ¡ç«¯çš„ã€‚\n\nè¿™å°±ç±»ä¼¼äº next.js é‡Œè¾¹çš„ getServerSidePropsï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ç¤ºä¾‹ä»£ç ï¼š\n\n```js\n// App.js\n\nasync function requestUsername(formData) {\n  'use server';\n  const username = formData.get('username');\n  // ...\n}\n\nexport default App() {\n  \u003cform action={requestUsername}\u003e\n    \u003cinput type=\"text\" name=\"username\" /\u003e\n    \u003cbutton type=\"submit\"\u003eRequest\u003c/button\u003e\n  \u003c/form\u003e\n}\n```\n\nåœ¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼Œæˆ‘ä»¬äººä¸ºæ ‡è®° requestUsername å‡½æ•°æ˜¯å±äºæœåŠ¡ç«¯çš„ï¼Œè¿™æ ·åœ¨é¡¹ç›®ä»£ç æ‰“åŒ…ä¸º bundle æ—¶å°±ä¼šç›´æ¥é¢„å…ˆè°ƒç”¨ requestUsernameï¼Œç›¸å½“äºé»˜è®¤æäº¤äº†ä¸€æ¬¡è¡¨å•ã€‚\n\nè€Œä¸”ï¼Œæ ‡è®°ä¸ºæœåŠ¡ç«¯çš„å‡½æ•°å¯ä»¥è®¾ç½®ä¸ºå¼‚æ­¥ï¼š\n\n```js\n// actions.js\n'use server';\n\nlet likeCount = 0;\nexport default async incrementLike() {\n  likeCount++;\n  return likeCount;\n}\n```\n\nè¿™æ ·åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­å°±å¯ä»¥å¼‚æ­¥æ¥æ”¶äº†ï¼š\n\n\n```js\nstartTransition(async () =\u003e {\n  const currentCount = await incrementLike();\n});\n```\n\n\u003e å…³äº use client å’Œ use serverï¼Œå®˜æ–¹çš„ä½¿ç”¨æ¡ˆä¾‹è¾ƒå°‘ï¼Œä¹Ÿæ²¡æœ‰å¦å¤–çš„å‚è€ƒã€‚å¦‚æœåæœŸè¿™ä¸ª API è¾ƒä¸ºæˆç†Ÿåï¼Œæˆ‘ä¼šè¡¥å……ä½¿ç”¨æ¡ˆä¾‹\n-----"])</script><script>self.__next_f.push([1,"20:T4fa4,"])</script><script>self.__next_f.push([1,"## 1. æœåŠ¡ç«¯æ¸²æŸ“\n\næœåŠ¡ç«¯æ¸²æŸ“æ˜¯æœåŠ¡ç«¯è¿”å›æ¸²æŸ“å‡ºçš„ html å­—ç¬¦ä¸²ï¼ˆæˆ–æ•°æ®æµï¼‰ï¼Œæµè§ˆå™¨æ¥è§£æ html ä»¥æ„å»ºé¡µé¢ã€‚åœ¨ React å¼€å‘ä¸­ï¼Œè¦æƒ³ä½¿ç”¨ SSRï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š\n\n1. ä½¿ç”¨ Nextjs\n2. æ‰‹åŠ¨æ­å»ºæœåŠ¡ç«¯æ¸²æŸ“\n\nå®˜ç½‘æåˆ°çš„æœåŠ¡ç«¯ API å°±æ˜¯ React æä¾›çš„æ”¯æŒæ‰‹åŠ¨æ­å»ºæœåŠ¡ç«¯æ¸²æŸ“çš„ã€‚å…¶**æœ¬è´¨æ˜¯æœåŠ¡ç«¯ç›´æ¥å°†ä¸€ä¸ªç”Ÿæˆå¥½çš„ HTML ç»™åˆ°å‰ç«¯ï¼Œå‰ç«¯ä¸€æ¬¡æ€§æ¸²æŸ“**ï¼Œä¾¿äºåŠ é€Ÿé¦–å±åŠ è½½å’Œè¿›è¡Œ SEOã€‚è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œå®¢æˆ·ç«¯å·¥ä½œå¹¶ä¸ä»…ä»…æ˜¯æ¸²æŸ“æœåŠ¡å™¨è¿”å›çš„ htmlï¼Œä¸ºäº†ä¿è¯æœåŠ¡ç«¯è¿”å›çš„ html åœ¨å®¢æˆ·ç«¯èƒ½å¤Ÿå¤„ç†äº‹ä»¶å’Œäº¤äº’ï¼Œå®¢æˆ·ç«¯è¦é‡æ–°è¿›è¡Œ vdom çš„æ„å»ºå’Œäº‹ä»¶ç»‘å®šï¼Œå³ï¼Œ**åœ¨æ¸²æŸ“å‡º html åï¼ŒæŠŠç›¸åº”ç»„ä»¶å…³è”åˆ°å…¶å¯¹åº”çš„ç»„ä»¶ä¸Šï¼Œå¹¶æ·»åŠ äº¤äº’é€»è¾‘å’Œç®¡ç†ä¹‹åçš„æ¸²æŸ“ï¼ˆhtml æ˜ å°„ä¸º React æ ‘ï¼‰**ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œå‰ç«¯ç»„ä»¶é€»è¾‘åœ¨æœåŠ¡ç«¯æ¸²æŸ“ä¸€æ¬¡åï¼Œåœ¨å®¢æˆ·ç«¯ä¹Ÿè¦é’ˆå¯¹æ€§çš„æ¸²æŸ“ä¸€æ¬¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å«æ°´åˆï¼ˆhydrateï¼‰ï¼Œè¿™ä¸¤æ¬¡æ¸²æŸ“å«åšåŒæ„æ¸²æŸ“ã€‚\n\n\u003e å°½ç®¡æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰å¹¶ hydrate çš„è¿‡ç¨‹æ¯”çº¯ç²¹çš„å®¢æˆ·ç«¯æ¸²æŸ“ï¼ˆCSRï¼‰çœ‹èµ·æ¥æ›´ç¹çï¼Œä½†æ˜¯å®ƒå®é™…ä¸Šå¯ä»¥èŠ‚çœæ¸²æŸ“æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤æ‚çš„ React åº”ç”¨ä¸­ã€‚\n\n### SSR vs CSR\n\næœåŠ¡ç«¯ç”¨æ¥å­˜å‚¨å’Œå“åº”æ•°æ®ï¼Œå®¢æˆ·ç«¯ç”¨äºè¯·æ±‚å’Œå±•ç¤ºæ•°æ®ï¼Œä»–ä»¬éƒ½æœ‰è‡ªå·±çš„æ¸²æŸ“æ–¹å¼ã€‚å°½ç®¡è¿™ä¸¤ç§æ–¹æ³•éƒ½æ¶‰åŠåˆ°ä»æœåŠ¡å™¨è·å– HTML å¹¶åœ¨æµè§ˆå™¨ä¸­è§£æï¼Œä½†å®ƒä»¬ä¹‹é—´å­˜åœ¨ä¸€äº›é‡è¦çš„åŒºåˆ«ã€‚\n\n1.  åˆå§‹æ¸²æŸ“ï¼šSSR ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡ç«¯å·²ç»è¿”å›äº†å®Œæ•´çš„é¡µé¢ï¼Œå®¢æˆ·ç«¯åªéœ€è¦åšå°‘é‡çš„æ°´åˆæ“ä½œå³å¯ï¼›CSR ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡å™¨è¿”å›çš„æ˜¯å…¥å£çš„æœ€å°åŒ–çš„ html (index.html)ï¼Œå®¢æˆ·ç«¯éœ€è¦é€šè¿‡ä¸‹è½½å¥½çš„ cssã€js æ–‡ä»¶é€è¡Œè§£æå¹¶æ„å»º DOM å’Œ CSSOMï¼Œæœ€ç»ˆç”Ÿæˆå®Œæ•´çš„ htmlã€‚\n2.  äº¤äº’æ€§ï¼šåœ¨ SSR ä¸­ï¼Œç”±äº HTML æ˜¯åœ¨æœåŠ¡å™¨ä¸Šé¢„å…ˆæ¸²æŸ“çš„ï¼Œæ‰€ä»¥ä»ä¸€å¼€å§‹å°±å…·æœ‰äº¤äº’æ€§ã€‚è¿™æ„å‘³ç€ç”¨æˆ·å¯ä»¥åœ¨é¡µé¢åŠ è½½åç«‹å³çœ‹åˆ°æ‰€æœ‰çš„åŠŸèƒ½å’Œå†…å®¹ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å®¢æˆ·ç«¯ JavaScript ä»£ç æ‰§è¡Œã€‚è€Œåœ¨ CSR ä¸­ï¼Œç”¨æˆ·å¯èƒ½éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆjsæ‰§è¡Œï¼ŒDOMæ„å»ºç­‰è€—æ—¶æ“ä½œï¼‰æ‰èƒ½çœ‹åˆ°äº¤äº’åŠŸèƒ½ã€‚\n3.  SEOï¼šç”±äºæœç´¢å¼•æ“é€šå¸¸æ›´æ“…é•¿è§£æ HTMLï¼Œè€Œä¸æ˜¯ JavaScriptï¼Œå› æ­¤ SSR å¯ä»¥æé«˜æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰ã€‚æœç´¢å¼•æ“å¯ä»¥æ›´å®¹æ˜“åœ°è¯»å–å’Œç†è§£ SSR ç”Ÿæˆçš„ HTML ä¸­çš„å†…å®¹ã€‚è€Œ CSR åˆå§‹åŒ–çš„ html ä»…ä»…æ˜¯ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼Œæ²¡æœ‰çˆ¬å–çš„æ„ä¹‰ã€‚å¯ä»¥å‚è§è¿™ç¯‡ä¼˜åŒ– [SEO ä¼˜åŒ–](https://juejin.cn/post/7295651353854132239)\n4.  æ€§èƒ½ï¼šSSR åœ¨æœåŠ¡å™¨ä¸Šå®Œæˆæ¸²æŸ“ï¼Œè¿™æ„å‘³ç€æœåŠ¡å™¨éœ€è¦æ›´å¤šçš„è®¡ç®—èµ„æºã€‚è€Œ CSR å°†æ¸²æŸ“å·¥ä½œè½¬ç§»åˆ°äº†å®¢æˆ·ç«¯ï¼Œè¿™å¯ä»¥å‡è½»æœåŠ¡å™¨çš„è´Ÿæ‹…ã€‚ç„¶è€Œï¼Œéšç€ç¡¬ä»¶æ€§èƒ½çš„æé«˜å’Œä¼˜åŒ–æŠ€æœ¯çš„è¿›æ­¥ï¼Œè¿™ç§å·®å¼‚å˜å¾—è¶Šæ¥è¶Šå°ã€‚\n5.  å¤æ‚æ€§ï¼šSSR éœ€è¦æ›´å¤šçš„å¼€å‘å·¥ä½œï¼Œå› ä¸ºå®ƒæ¶‰åŠåˆ°åœ¨æœåŠ¡å™¨ç«¯å¤„ç†æ¸²æŸ“å’Œåœ¨å®¢æˆ·ç«¯å¤„ç† hydrateï¼ˆå°† HTML è½¬æ¢ä¸º React ç»„ä»¶ï¼‰ã€‚è€Œ CSR æ›´ç®€å•ï¼Œå› ä¸ºå®ƒåªéœ€è¦åœ¨å®¢æˆ·ç«¯å¤„ç†æ¸²æŸ“ã€‚\n\næ€»çš„æ¥è¯´ï¼Œè™½ç„¶ SSR å’Œ CSR åœ¨æŠ€æœ¯ä¸Šæœ‰ä¸€äº›åŒºåˆ«ï¼Œä½†å®ƒä»¬éƒ½å¯ä»¥æœ‰æ•ˆåœ°æ¸²æŸ“ React åº”ç”¨ã€‚é€‰æ‹©å“ªç§æ–¹æ³•å–å†³äºå…·ä½“çš„åº”ç”¨éœ€æ±‚å’Œåœºæ™¯ã€‚\n\nä¸‹é¢å›¾è§£è¯´æ˜ä¸€ä¸‹ï¼š\n\nSSR:\n\n\n![æ— æ ‡é¢˜-2023-10-11-1617.png](/img/posts/2023-11-3/2023-11-3-1.png)\n\n----\n\nCSR:\n\n![æ— æ ‡é¢˜-2023-10-11-1617.png](/img/posts/2023-11-3/2023-11-3-2.png)\n\n### SSR é€‚ç”¨çš„åœºæ™¯\n\n- éœ€è¦ SEO ä¼˜åŒ–çš„åœºæ™¯\n- éœ€è¦æ›´å¿«çš„é¦–å±æ—¶é—´\n- é™æ€é¡µé¢æˆ–è€…blogç±»å†…å®¹å±•ç¤ºç±»ç½‘é¡µ\n- éœ€è¦å¢å¼ºç”¨æˆ·å¯è®¿é—®æ€§çš„é¡µé¢ï¼šèƒ½å¤Ÿå¿«é€Ÿè·å–é¡µé¢å†…å®¹å¹¶è¿›è¡Œæµè§ˆ\n\n### CSR é€‚ç”¨çš„åœºæ™¯\n\n- é«˜äº¤äº’æ€§ã€å®æ—¶æ›´æ–°çš„åœºæ™¯ï¼š\n- å¤æ‚å‰ç«¯é€»è¾‘åœºæ™¯ï¼šCSR å¯¹äºå¤æ‚çš„äº¤äº’å’ŒåŠ¨æ€æ•ˆæœçš„æ”¯æŒè¾ƒå¥½ï¼Œå¼€å‘ä¹Ÿç›¸å¯¹ç®€å•ã€‚\n- APIé©±åŠ¨çš„åº”ç”¨ç¨‹åºï¼šCSR å…è®¸å®¢æˆ·ç«¯è·å–æ•°æ®æ¥å¤„ç†ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨è´Ÿè½½å¹¶æä¾›å“åº”å¼ä½“éªŒã€‚\n\n## 2. React SSR çš„å‡ ç§ API\n\nå®˜ç½‘æä¾›äº†è¿™ä¹ˆå‡ ä¸ª API ç”¨äºåœ¨æœåŠ¡ç«¯æ¸²æŸ“ React ç»„ä»¶ï¼š\n\n### renderToString\n\nå®ƒå¯ä»¥å°† React ç»„ä»¶æ¸²æŸ“æˆå­—ç¬¦ä¸²ï¼Œæœ€å¸¸ç”¨çš„ SSR APIã€‚å®ƒè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå…¶ä¸­åŒ…å« HTML å’Œ React ç»„ä»¶çš„æ ‡è®°ã€‚è¿™ä¸ª API å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨ï¼Œå°† React ç»„ä»¶æ¸²æŸ“æˆ HTMLï¼Œç„¶åå°† HTML å‘é€åˆ°å®¢æˆ·ç«¯ã€‚\n\næœåŠ¡ç«¯è¿™æ ·å†™ï¼ˆnodejsä¸ºä¾‹ï¼‰\n\n\n```js\nimport { renderToString } from 'react-dom/server';\n\napp.use('/', (request, response) =\u003e {\n  const html = renderToString(\u003cApp /\u003e);\n  response.send(html);\n});\n```\n\nåœ¨å®¢æˆ·ç«¯æµè§ˆå™¨æ¥æ”¶åˆ°å®ƒåï¼Œè¦ä½¿ç”¨ React è¯­è¨€æ¸²æŸ“å‡ºæ¥ï¼š\n\n\n```js\nimport { hydrateRoot } from 'react-dom/client';\n\nhydrateRoot(document.getElementById('root'), \u003cApp/\u003e);\n```\n\nhydrate ä¼šåœ¨æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œä¸åˆ›å»º html æ ‡ç­¾ï¼Œè€Œæ˜¯ç›´æ¥å…³è”å·²æœ‰çš„ã€‚è¿™æ ·å°±é¿å…äº†æ²¡å¿…è¦çš„æ¸²æŸ“ã€‚\n\n### renderToPipeableStream\n\nå®ƒå¯ä»¥å°† React ç»„ä»¶æ¸²æŸ“ä¸ºå¯è¯»çš„ Streamã€‚ä½¿ç”¨æ–¹å¼æœ‰ç•¥å¾®ä¸åŒï¼š\n\n```js\nimport { renderToPipeableStream } from 'react-dom/server';\n\nconst stream = renderToPipeableStream(\u003cApp /\u003e);  \nresponse.set('Content-Type', 'text/html');  \nstream.pipe(res);  \n```\n\nä¸åŒäº renderToStringï¼Œä»–å¯ä»¥ä½œä¸ºä¸€ä¸ªç®¡é“ä¸æ–­å¾€æœåŠ¡å™¨å“åº”é‡Œè¾“å‡ºå†…å®¹ã€‚`renderToPipeableStream`æä¾›äº†æ›´é«˜çº§çš„ç‰¹æ€§ï¼Œä¾‹å¦‚è·¯ç”±æ§åˆ¶ã€å¼‚æ­¥æ•°æ®åŠ è½½ç­‰ã€‚å®ƒè¿”å›ä¸€ä¸ªå¯è¯»çš„Streamå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥ç”¨äºå°†Reactç»„ä»¶æ¸²æŸ“ä¸ºHTMLæ–‡æ¡£çš„æµå¼ä¼ è¾“ã€‚ä½¿ç”¨`renderToPipeableStream`å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯å®ç°æ›´å¤æ‚çš„æ¸²æŸ“é€»è¾‘ï¼Œä¾‹å¦‚**æ ¹æ®è·¯ç”±è·¯å¾„åŠ¨æ€åŠ è½½ç»„ä»¶ã€æŒ‰éœ€åŠ è½½æ•°æ®**ç­‰ã€‚\n\n### renderToReadableStream\n\nä»–æ˜¯ renderToPipeableStream çš„ä¸€ç§æ›¿ä»£æ–¹æ¡ˆã€‚\n\nä½¿ç”¨æ–¹å¼ï¼š\n\n```js\nimport { renderToReadableStream } from 'react-dom/server';\n\nasync function handler(request) {\n  const stream = await renderToReadableStream(\u003cApp /\u003e, {\n    bootstrapScripts: ['/main.js']\n  });\n  return new Response(stream, {\n    headers: { 'content-type': 'text/html' },\n  });\n}\n```\nè¿™ä¸ª API è¿”å›çš„æ˜¯ä¸€ä¸ª Promiseï¼Œä¾èµ– web æµï¼Œç›®å‰çš„å…¼å®¹æ€§å­˜åœ¨é—®é¢˜ã€‚å¯ä»¥å‚è€ƒ web æµçš„æ¦‚å¿µï¼š[Stream API](https://developer.mozilla.org/en-US/docs/Web/API/Streams_API)\n\n### renderToStaticMarkup\n\n`renderToStaticMarkup` ä¼šå°†éäº¤äº’çš„ React ç»„ä»¶æ ‘æ¸²æŸ“æˆ HTML å­—ç¬¦ä¸²ã€‚å…¶è¾“å‡ºæ— æ³•è¿›è¡ŒäºŒæ¬¡æ¸²æŸ“ï¼Œä¸”å¯¹ Suspense çš„æ”¯æŒæœ‰é™ã€‚ä¸å»ºè®®åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ä½¿ç”¨å®ƒã€‚\n\nä½¿ç”¨æ–¹å¼ï¼š\n\n```js\nimport { renderToStaticMarkup } from 'react-dom/server';\n\n// è·¯ç”±å¤„ç†ç¨‹åºè¯­æ³•å–å†³äºä½ çš„åç«¯æ¡†æ¶\napp.use('/', (request, response) =\u003e {\n  const html = renderToStaticMarkup(\u003cPage /\u003e);\n  response.send(html);\n});\n```\n\nå¦‚æœè¦æ¸²æŸ“çš„æ˜¯çº¯é™æ€å†…å®¹ï¼Œåˆ™éå¸¸åˆé€‚ã€‚\n\n\n### renderToStaticNodeStream\n\n`renderToStaticNodeStream` å¯ä»¥ä¸º [Node.js åªè¯»æµ](https://nodejs.org/api/stream.html#readable-streams) æ¸²æŸ“éäº¤äº’å¼ React æ ‘ã€‚\n\nå…¶ä½¿ç”¨ä¹Ÿæ˜¯ä¸€ä¸ªç®¡é“ï¼Œå¹¶å£°ç§°é™æ€çš„éäº¤äº’å¼ç½‘é¡µã€‚ä¸åŒçš„æ˜¯ï¼Œä»–éœ€è¦ç­‰å¾…æ‰€æœ‰ [Suspenseè¾¹ç•Œ](https://zh-hans.react.dev/reference/react/Suspense) å®Œæˆåæ‰è¿”å›è¾“å‡ºï¼Œä¸”è¿”å›ç»™å®¢æˆ·ç«¯çš„è¾“å‡ºç»“æœä¸æ”¯æŒ hydrateã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨åœ¨äºç¼“å†²æ‰€æœ‰è¾“å‡ºï¼Œè¿™ä¸ªè¾“å‡ºæ˜¯ä¸€ä¸ªutf-8 ç¼–ç çš„å­—èŠ‚æµï¼Œ\n\n----\n\nä¸Šé¢çš„ API ç”¨äºåœ¨è‡ªå®šä¹‰çš„æœåŠ¡å™¨ä¸­æ‰‹åŠ¨éƒ¨ç½² SSRï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨ Nextjs éƒ¨ç½²ä¸€ä¸ª SSR åº”ç”¨ã€‚\n\n## 3. React SSR/SSG æœ€ä½³å®è·µæ–¹æ¡ˆ - Next\n\nå®˜æ–¹æ–‡æ¡£æ¨èä½¿ç”¨ Nextjs æ¥é…ç½® SSR é¡µé¢ï¼Œæœ€æ–°ç‰ˆçš„ React ä¹Ÿæ¨èä½¿ç”¨ [Nextjs](https://www.nextjs.cn/learn/basics/create-nextjs-app/setup) æ¥åˆ›å»º React Appã€‚æˆ‘ä»¬æ¥å®æˆ˜ä¸€ä¸‹ã€‚\n\n\u003e Node \u003e= v18ï¼Œï¼Œæœ€æ–°ç‰ˆçš„ next éœ€è¦ node18+\n\n### â‘ . æ–°å»ºä¸€ä¸ªç©ºçš„ npm ä»“åº“\n\n```shell\nnpm init\n```\n\n### â‘¡. å®‰è£…ä¾èµ–\n\n```shell\nyarn add next react react-dom\n```\n\n### â‘¢. ä¿®æ”¹ `package.json`\n\n```json\n\"scripts\": {\n  \"dev\": \"next dev\",\n  \"build\": \"next build\",\n  \"start\": \"next start\",\n  \"lint\": \"next lint\"\n}\n```\n\n### â‘£. åˆ›å»ºé¡µé¢æ–‡ä»¶\n\n- é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªÂ `pages`Â ç›®å½•\n- ç›®å½•ä¸­å†™ä¸€ä¸ª index.js\n\n\n```js\nfunction HomePage() {\n  return \u003cdiv\u003eWelcome to Next.js!\u003c/div\u003e\n}\n\nexport default HomePage\n```\n\n- ç›®å½•ä¸­å†å†™ä¸€ä¸ªé¡µé¢ about.js\n\n\n```js\nfunction AboutPage() {\n  return \u003cdiv\u003eWelcome to My blog!\u003c/div\u003e\n}\n\nexport default AboutPage\n```\n\n- å¯åŠ¨é¡¹ç›® `yarn dev`\n- é€šè¿‡è·¯ç”±è®¿é—®é¡µé¢çœ‹çœ‹ï¼š`localhost:3000/about`\n\n\n### â‘¤. æ·»åŠ åŠ¨æ€è·¯ç”±\n\npages ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å« postsï¼Œåœ¨ä¸‹é¢åˆ›å»ºåŠ¨æ€è·¯ç”±é¡µé¢ \\[pid].js\n\n```js\nimport { useRouter } from 'next/router'\n\nconst Post = () =\u003e {\n  const router = useRouter()\n  const { pid } = router.query\n\n  return \u003cp\u003ePost: {pid}\u003c/p\u003e\n}\n\nexport default Post\n```\n\nä½¿ç”¨ `localhost:3000/post/abc` è®¿é—®æŸ¥çœ‹é¡µé¢æ•ˆæœ\n\n\n![image.png](/img/posts/2023-11-3/2023-11-3-3.png)\n\n### â‘¥. é…ç½®é¢„æ¸²æŸ“\n\n- SSG\n\nå¦‚æœä½ çš„é¡µé¢æ˜¯çº¯é™æ€é¡µï¼Œä½¿ç”¨ SSG æ—¶ï¼ŒHTML æ–‡ä»¶å°†åœ¨æ¯ä¸ªé¡µé¢è¯·æ±‚æ—¶è¢«é‡ç”¨ï¼Œè¿˜å¯ä»¥è¢« CDN ç¼“å­˜ã€‚å¦‚æœä½ çš„é¡µé¢ä¸éœ€è¦è·å–å¤–éƒ¨æ•°æ®ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼Œposts ä¸‹æ–°å»ºä¸€ä¸ª blog.jsï¼š\n\n\n```js\nfunction Blog() {\n  const posts = [...];\n  return (\n    \u003cul\u003e\n      {posts.map((post) =\u003e (\n        \u003cli\u003e{post.title}\u003c/li\u003e\n      ))}\n    \u003c/ul\u003e\n  )\n}\n\nexport default Blog\n```\n\nåšå®¢æ¸²æŸ“è‡ªç„¶ä¼šä¾èµ–å¤–éƒ¨æ¥å£ï¼Œå¯ä»¥è¿™ä¹ˆé…ç½®ï¼Œåœ¨åŒæ–‡ä»¶ï¼ˆblog.jsï¼‰ä¸­å¯¼å‡ºä¸€ä¸ªasyncå‡½æ•°ï¼š\n\n```js\n// posts æ˜¯å¤–éƒ¨æ¥å£è·å–åˆ°åï¼Œ getStaticProps ä¼ å…¥çš„\nfunction Blog({ posts }) {...}\n\nexport async function getStaticProps() {\n  // è°ƒç”¨å¤–éƒ¨ API è·å–åšæ–‡åˆ—è¡¨ (ç¼–è¯‘å’Œæ‰“åŒ…æ—¶å°±ä¼šè°ƒç”¨)\n  const res = await fetch('https://.../posts')\n  const posts = await res.json()\n\n  // é€šè¿‡è¿”å› { props: { posts } } å¯¹è±¡ï¼ŒBlog ç»„ä»¶\n  // åœ¨æ„å»ºæ—¶å°†æ¥æ”¶åˆ° `posts` å‚æ•°\n  return {\n    props: {\n      posts,\n    },\n  }\n}\n```\n\u003e getStaticProps å‡½æ•°ï¼Œåœ¨é¡µé¢æ‰“åŒ…æ—¶å°±ä¼šæ‰§è¡Œå¹¶ç¼“å­˜ï¼Œåœ¨çº¿ä¸Šæ¨¡å¼ä¾¿ä¸ä¼šåå¤æ‰§è¡Œã€‚è€Œåœ¨å¼€å‘ç¯å¢ƒï¼Œæ¯æ¬¡åˆ·æ–°é¡µé¢æ—¶ï¼Œæ•´ä¸ªé¡µé¢ä¼šç­‰å¾… fetch è¿”å›æ•°æ®åæ‰åŠ è½½ã€‚\n\n\næ­¤å¤–ï¼ŒåŠ¨æ€è·¯ç”±é¡µ \\[pid].js çš„æ¸²æŸ“ï¼Œä¹Ÿä¼šä¾èµ–å¤–éƒ¨åŠ¨æ€æ¥å£ï¼Œä¼ å…¥ abcï¼Œå°±è¡¨ç¤ºå±•ç¤º abc è¿™ä¸€ç¯‡æ–‡ç« çš„ä¿¡æ¯ï¼Œç°åœ¨æ¥é…ç½®è·¯å¾„é¢„æ¸²æŸ“ï¼ˆpages/posts/\\[pid].js ä¸­ï¼‰ï¼š\n\n\n```js\n// æ­¤å‡½æ•°åœ¨æ„å»ºæ—¶è¢«è°ƒç”¨\nexport async function getStaticPaths() {\n  // è°ƒç”¨å¤–éƒ¨ API è·å–åšæ–‡åˆ—è¡¨\n  const res = await fetch('https://.../posts')\n  const posts = await res.json()\n\n  // æ®åšæ–‡åˆ—è¡¨ç”Ÿæˆæ‰€æœ‰éœ€è¦é¢„æ¸²æŸ“çš„è·¯å¾„\n  const paths = posts.map((post) =\u003e ({\n    params: { pid: post.id },\n  }))\n\n  // We'll pre-render only these paths at build time.\n  // { fallback: false } means other routes should 404.\n  return { paths, fallback: false }\n}\n\n// åœ¨æ„å»ºæ—¶ä¹Ÿä¼šè¢«è°ƒç”¨\nexport async function getStaticProps({ params }) {\n  // params åŒ…å«æ­¤ç‰‡åšæ–‡çš„ `pid` ä¿¡æ¯ã€‚\n  // å¦‚æœè·¯ç”±æ˜¯ /posts/1ï¼Œé‚£ä¹ˆ params.pid å°±æ˜¯ 1\n  const res = await fetch(`https://.../posts/${params.pid}`)\n  const post = await res.json()\n\n  // é€šè¿‡ props å‚æ•°å‘é¡µé¢ä¼ é€’åšæ–‡çš„æ•°æ®\n  return { props: { post } }\n}\n```\n\nä¸Šé¢çš„ä»£ç ï¼ŒgetStaticPaths è¿”å›å…è®¸è®¿é—®çš„ pid é›†åˆï¼Œæ¯”å¦‚æ¥å£è¿”å›äº†æ•°æ® paths: \\[1,2,3,4], é‚£ä¹ˆä½ è¯·æ±‚ `localhost:3000/posts/5` å°±ä¼š 404; getStaticProps çš„é€»è¾‘ä¸ä¸Šé¢ä¸€æ ·ï¼Œå®é™…è®¿é—®äº† pid=1çš„è·¯å¾„ï¼Œé‚£ä¹ˆ params å°±æ˜¯ `{pid: 1}`ï¼Œç„¶åé˜»å¡é¡µé¢å»è·å–æ•°æ®ã€‚\n\n- SSR\n\nå¦‚æœä½ è¦ä½¿ç”¨Â **æœåŠ¡å™¨ç«¯æ¸²æŸ“**ï¼Œåˆ™ä¼šåœ¨Â **æ¯æ¬¡é¡µé¢è¯·æ±‚æ—¶**Â é‡æ–°ç”Ÿæˆé¡µé¢çš„ HTMLï¼Œè™½ç„¶é€Ÿåº¦ä¸åŠå‰è€…ï¼Œä½†æ˜¯é¢„æ¸²æŸ“çš„é¡µé¢å°†å§‹ç»ˆæ˜¯æœ€æ–°çš„ã€‚\n\nç±»ä¼¼åœ°ï¼Œä¹Ÿåœ¨é¡µé¢æ–‡ä»¶å¯¼å‡ºä¸€ä¸ªasyncå‡½æ•°ï¼š\n\n\n```js\nfunction Blog({ data }) {\n  // Render data...\n}\n\n// This gets called on every request\nexport async function getServerSideProps() {\n  // Fetch data from external API\n  const res = await fetch(`https://.../data`)\n  const data = await res.json()\n\n  // Pass data to the page via props\n  return { props: { data } }\n}\n```\næ‰§è¡Œè¿‡ç¨‹å¤§åŒå°å¼‚ï¼Œä¸åŒçš„æ˜¯æ¯æ¬¡çº¿ä¸Šè¯·æ±‚é¡µé¢éƒ½ä¼šå»è°ƒç”¨ getServerSideProps æ¥è¯·æ±‚æ¥å£ã€‚\n\n### â‘¦. é…ç½®å…¥å£ç»„ä»¶\n\nåœ¨ pages ç›®å½•ä¸‹é…ç½®ä¸€ä¸ªæ–‡ä»¶ _app.js:\n\n```js\n// å¦‚æœæœ‰ css å°±å¼•å…¥\nimport '../styles.css'\n\n// æ–°åˆ›å»ºçš„ `pages/_app.js` æ–‡ä»¶ä¸­å¿…é¡»æœ‰æ­¤é»˜è®¤çš„å¯¼å‡ºï¼ˆexportï¼‰å‡½æ•°\nexport default function MyApp({ Component, pageProps }) {\n  return \u003cComponent {...pageProps} /\u003e\n}\n```\n_app.js é»˜è®¤æ˜¯æ‰€æœ‰é¡µé¢æ–‡ä»¶çš„æ€»å…¥å£ï¼Œä»–å¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°ï¼ŒComponent æ˜¯å½“å‰çš„ç»„ä»¶ï¼ŒpageProps æ˜¯è¿™ä¸ªç»„ä»¶çš„ propsã€‚ä½œä¸ºç»Ÿä¸€çš„å…¥å£ï¼Œåœ¨è¿™é‡Œä½ å°±å¯ä»¥é…ç½®å¾ˆå¤šå‚æ•°äº†ï¼Œæ¯”å¦‚ seoé…ç½®ã€å…¬å…±æ ·å¼ã€å¸ƒå±€èœå•ç­‰ã€‚\n\n### â‘§. é…ç½®æ ·å¼\n\nåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º style.cssï¼Œå¹¶åœ¨ _app.js ä¸­å¼•å…¥ï¼š\n\n\n```css\nbody {\n  font-family: 'SF Pro Text', 'SF Pro Icons', 'Helvetica Neue', 'Helvetica',\n    'Arial', sans-serif;\n  margin: 0 auto;\n}\n```\n\nå¦‚æœè¦ä½¿ç”¨ sassï¼Œå¯ä»¥å…ˆå®‰è£…ä¾èµ–ï¼š\n\n```\nyarn add sass\n```\n\nåœ¨é¡¹ç›®ä¸­å¼•å…¥ sass æ¨¡å—ï¼š\n\n```js\nimport variables from '../styles/variables.module.scss'\n```\n\n### â‘¨. é¡µé¢å¸ƒå±€\n\nåœ¨ _app.js ä¸­å¼•å…¥è‡ªå®šä¹‰çš„å¸ƒå±€ç»„ä»¶ï¼š\n\n```js\nimport Layout from '../components/layout'\n\nexport default function MyApp({ Component, pageProps }) {\n  return (\n    \u003cLayout\u003e\n      \u003cComponent {...pageProps} /\u003e\n    \u003c/Layout\u003e\n  )\n}\n```\n\nLayout å¯ä»¥æ˜¯ä¸‹é¢çš„å½¢å¼ï¼š\n\n```js\nimport useSWR from 'swr'\nimport Navbar from './navbar'\nimport Footer from './footer'\n\nexport default function Layout({ children }) {\n  const { data, error } = useSWR('/api/navigation', fetcher)\n\n  if (error) return \u003cdiv\u003eFailed to load\u003c/div\u003e\n  if (!data) return \u003cdiv\u003eLoading...\u003c/div\u003e\n\n  return (\n    \u003c\u003e\n      \u003cNavbar links={data.links} /\u003e\n      \u003cmain\u003e{children}\u003c/main\u003e\n      \u003cFooter /\u003e\n    \u003c/\u003e\n  )\n}\n```\n\nè¿™é‡Œç”¨äº†ç¬¬ä¸‰æ–¹åº“æ¥è¯·æ±‚ï¼Œå…¶ä¸­çš„ fetcher å¯ä»¥è¿™ä¹ˆå†™ï¼š\n\n```js\nconst fetcher = (url) =\u003e fetch(url).then((res) =\u003e res.json());\n```\n\n### â‘©. é…ç½®é™æ€èµ„æº\n\nåœ¨æ ¹ç›®å½•ä¸‹æ–°å»º public ç›®å½•ã€‚\n\n- å¼•å…¥æœ¬åœ°å›¾ç‰‡\n\n```js\nimport Image from 'next/image'\nimport profilePic from '../public/me.png'\n\n\u003cImage\n    src={profilePic}\n    alt=\"Picture of the author\"\n/\u003e\n```\n- åŠ è½½è¿œç¨‹å›¾ç‰‡\n\n```js\n\u003cImage\n    src=\"/me.png\"\n    alt=\"Picture of the author\"\n    width={500}\n    height={500}\n    priority\n/\u003e\n```\nè¿œç¨‹èµ„æºåŸŸåé…ç½®æœ‰ä¸¤ç§æ–¹å¼ï¼Œåœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºé…ç½®æ–‡ä»¶ next.config.js:\n\nç¬¬ä¸€ç§ï¼š\n```js\nmodule.exports = {\n  images: {\n    domains: ['example.com', 'example2.com'],\n  },\n}\n```\nè¿™ä¸ªé…ç½®ä¸“é—¨ç”¨äºåŠ è½½å›¾ç‰‡ï¼Œè®¾ç½®åŸŸååªæ˜¯å…¶ä¸­ä¸€ä¸ªé€‰æ‹©é¡¹ï¼Œé»˜è®¤ä½¿ç”¨æ•°ç»„ç¬¬ä¸€ä¸ªåŸŸåï¼Œåœ¨å…·ä½“ä½¿ç”¨æ—¶ï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®šæ•°ç»„ä¸­çš„æšä¸¾é¡¹ï¼š`\u003cImage src=\"my-image.jpg?domain=https://example2.com\" alt=\"My Image\" /\u003e`\n\nç¬¬äºŒç§ï¼š\n\n```js\nasync rewrites() {\n    return {\n      fallback: [\n        {\n          source: '/home/:image*',\n          destination: `https://${isProd ? CDNPath : filePath}/home/:image*`\n        }\n      ]\n    }\n}\n```\nè¿™ä¸ªé…ç½®ç”¨äºé‡å†™è§„åˆ™ï¼Œä½œç”¨åŸŸæ¯”è¾ƒå¹¿ï¼Œè¿˜å¯ä»¥ç”¨æ¥æ‹¦æˆª API è¯·æ±‚ç­‰ã€‚\n\n- ä½¿ç”¨å¤–æŒ‚å­—ä½“\n\nåœ¨ pages æ–°å»ºä¸€ä¸ª _document.js æ–‡ä»¶ï¼š\n\n```js\nimport Document, { Html, Head, Main, NextScript } from 'next/document'\n\nclass MyDocument extends Document {\n  render() {\n    return (\n      \u003cHtml\u003e\n        \u003cHead\u003e\n          \u003clink\n            href=\"https://fonts.googleapis.com/css2?family=Inter\u0026display=optional\"\n            rel=\"stylesheet\"\n          /\u003e\n        \u003c/Head\u003e\n        \u003cbody\u003e\n          \u003cMain /\u003e\n          \u003cNextScript /\u003e\n        \u003c/body\u003e\n      \u003c/Html\u003e\n    )\n  }\n}\n\nexport default MyDocument\n```\n\n\u003e _document.js ç”¨äºè‡ªå®šä¹‰ \\\u003chead\u003e æ ‡ç­¾ã€å®šä¹‰ CSS æ ·å¼ã€æ·»åŠ å…ƒæ•°æ®ï¼ˆmetadataï¼‰ç­‰\n\n- ä½¿ç”¨å¤–éƒ¨è„šæœ¬\n\n```js\nclass MyDocument extends Document {\n...\n    \u003cHead\u003e\n        \u003cScript src=\"https://connect.facebook.net/en_US/sdk.js\" strategy=\"lazyOnload\" /\u003e\n    \u003c/Head\u003e\n    \u003cbody\u003e\n      \u003cMain /\u003e\n      \u003cNextScript /\u003e\n    \u003c/body\u003e\n}\n```\n\n### â‘ª. ç¯å¢ƒå˜é‡é…ç½®\n\nNext.js å†…ç½®æ”¯æŒå°†ç¯å¢ƒå˜é‡ä»Â `.env.local`Â åŠ è½½åˆ°Â `process.env`Â ä¸­ã€‚ä½ å¯ä»¥åœ¨æœ¬åœ°æ ¹ç›®å½•æ–‡ä»¶ `.env.local` ä¸­å†™å…¥è‡ªå®šä¹‰çš„å˜é‡ï¼š\n\n```\nenvironment=development\n```\n\nç„¶åå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è·å–ï¼š`process.env.environment`\n\nä½ ä¹Ÿå¯ä»¥ç›´æ¥åŠ ä¸Šå‰ç¼€ï¼šNEXT_PUBLIC\n\n```\nNEXT_PUBLIC_ANALYTICS_ID=abcdefghijk\n```\nè¿™æ ·çš„å˜é‡ä¼šåŠ è½½åœ¨nodejsä¸­ï¼Œä½ åœ¨jsæ–‡ä»¶é‡Œä¹Ÿå¯ä»¥é€šè¿‡ process æ¥è®¿é—®äº†ã€‚\n\n### â‘«. é…ç½®i18n\n\nå®‰è£…ä¾èµ–ï¼š`yarn add react-i18next i18next next-i18next`\n\nåœ¨ _app.js ä¸­å¼•å…¥ï¼š\n\n```js\nimport { appWithTranslation } from 'next-i18next';\n\n...\nexport default memo(appWithTranslation(MyApp));\n```\n\nåœ¨ public æ–‡ä»¶å¤¹é‡Œå†™å…¥ä¸­è‹±æ–‡æ–‡æ¡ˆï¼š\n\n![image.png](/img/posts/2023-11-3/2023-11-3-4.png)\n\n![image.png](/img/posts/2023-11-3/2023-11-3-5.png)\n\n![](/img/posts/2023-11-3/2023-11-3-6.png)\n\næ ¹ç›®å½•ä¸‹æ·»åŠ é…ç½®æ–‡ä»¶ next-i18next.config.jsï¼š\n\n```js\nmodule.exports = {\n  i18n: {\n    localeDetection: false, // ä¸æ£€æµ‹æµè§ˆå™¨è¯­è¨€ç¯å¢ƒ\n    defaultLocale: 'en',\n    locales: ['en' , 'zh']\n  },\n  localePath: typeof window === 'undefined'\n    ? require('path').resolve('./public/locales')\n    : require('path').resolve('./public/locales'),\n  reloadOnPrerender: process.env.NEXT_PUBLIC_DOMAIN_ENV === 'development',\n};\n```\nå¹¶åœ¨ next-config.js ä¸­å¼•å…¥ï¼š\n\n```js\nconst { i18n } = require('./next-i18next.config');\n\nmodule.exports = () =\u003e {\n\n  return {\n    i18n,\n  }\n}\n```\n\nåœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼š\n\n```js\nimport { serverSideTranslations } from 'next-i18next/serverSideTranslations';\nimport { useTranslation } from 'next-i18next';\n\nconst { t } = useTranslation(['common']);\n\n...\n// æ¸²æŸ“æ—¶ä½¿ç”¨\n\u003cbutton className={`${Style['btn-link']} mr-16 primary button-outlined`}\u003e\n  {t('login')}\n\u003c/button\u003e\n...\n\nexport const getStaticProps = async ({\n  locale,\n}) =\u003e {\n  return {\n    props: {\n      ...(await serverSideTranslations(locale ?? 'en', [\n        'common'\n      ])),\n    },\n  }\n}\n\n```\ni18n ä¼šåœ¨é¢„ç¼–è¯‘çš„æ—¶å€™ï¼Œå¾€ getStaticProps ä¼ å…¥å›½é™…åŒ–æ–‡æ¡ˆå‚æ•°ã€‚æ§åˆ¶æ˜¾ç¤ºå“ªä¸€ä¸ªæ–‡æ¡ˆï¼Œæ˜¯æ ¹æ®é…ç½®çš„ç›®å½•å’Œè®¿é—®è·¯å¾„æ¥çš„ï¼Œæ¯”å¦‚è¦æ˜¾ç¤ºä¸­æ–‡ï¼Œlocalesä¸‹æœ‰ä¸ªzhæ–‡ä»¶å¤¹ï¼Œä½ çš„è®¿é—®è·¯å¾„ä¹Ÿåº”è¯¥å¯¹åº”ï¼š\n\n\n![image.png](/img/posts/2023-11-3/2023-11-3-12.png)\n\næ‰€ä»¥å¯ä»¥å†™ä¸€ä¸ªå…¨å±€çš„åˆ‡æ¢æŒ‰é’®ï¼Œæ¥æ§åˆ¶è·¯ç”±å˜åŒ–ï¼š`window.location.href = '/zh';`\n\n\n### â‘¬. è‡ªå®šä¹‰é…ç½®\n\nnextjs æä¾›è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ next.config.js (æˆ– mjsï¼Œä½¿ç”¨ ESM) ç”¨äºé«˜çº§é…ç½®:\n\n```js\n// å¸¸ç”¨é…ç½®\nconst { PHASE_DEVELOPMENT_SERVER } = require('next/constants')\n\nmodule.exports = (phase, { defaultConfig }) =\u003e {\n  // å¼€å‘ç¯å¢ƒé…ç½®\n  if (phase === PHASE_DEVELOPMENT_SERVER) {\n    return {\n        env: {\n          env: 'dev', // å¯åœ¨é¡µé¢ä½¿ç”¨ï¼š\u003ch1\u003eenv is: {process.env.env}\u003c/h1\u003e\n        },\n        basePath: '/docs', // åŸºç¡€è·¯å¾„ï¼Œæ‰€æœ‰çš„Linkè·³è½¬ä¼šä»¥è¿™ä¸ªä¸ºåŸºç¡€\n        compress: false, // å‹ç¼©ä»£ç \n        generateEtags: false, // ç¦ç”¨ ETag ï¼Ÿ\n        distDir: 'build', // è‡ªå®šä¹‰è¾“å‡ºç›®å½•\n        async redirects() {  // é‡å®šå‘\n          return [\n            {\n              source: '/about',\n              destination: '/',\n              permanent: true,\n            },\n          ]\n        },\n        async rewrites() { // é‡å†™èµ„æºè·¯å¾„ï¼Œé»˜è®¤æ˜¯åœ¨æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿï¼ˆé¡µé¢å’Œ`/public`æ–‡ä»¶ï¼‰ä¹‹åã€åŠ¨æ€è·¯ç”±ä¹‹å‰åº”ç”¨çš„ï¼›ä½¿ç”¨ fallback è¡¨ç¤ºæ¯æ¬¡æ£€æŸ¥æ–‡ä»¶å’ŒåŠ¨æ€è·¯ç”±ä¹‹åè§¦å‘\n          return {\n            fallback: [\n              {\n                source: '/home/:image*',\n                destination: `https://${isProd ? CDNPath : filePath}/home/:image*`\n              },\n            ]\n          }\n        },\n      }\n  }\n\n  return {\n    // åŒä¸Š...\n  }\n}\n```\n### â‘­. éƒ¨ç½²\n\n- å°†ä»£ç æ¨é€åˆ° github\n- æ³¨å†Œä¸€ä¸ª vercelè´¦å·ï¼šhttps://vercel.com/signup\n- é€‰æ‹©å…³è”ä»“åº“ï¼Œé€‰ä¸­ä½ çš„ä»“åº“\n\n\n![image.png](/img/posts/2023-11-3/2023-11-3-7.png)\n\n\n![image.png](/img/posts/2023-11-3/2023-11-3-8.png)\n\n- ç‚¹å‡»éƒ¨ç½²åä¼šè‡ªåŠ¨éƒ¨ç½²\n\n\n![image.png](/img/posts/2023-11-3/2023-11-3-9.png)\n\n- ç„¶ååœ¨ github ä»“åº“å³ä¾§ä¼šå‡ºç°é“¾æ¥ï¼š\n\n\n![image.png](/img/posts/2023-11-3/2023-11-3-10.png)ã€\n\n- æŸ¥çœ‹åšå®¢\n\n\n![image.png](/img/posts/2023-11-3/2023-11-3-11.png)"])</script><script>self.__next_f.push([1,"21:T391a,"])</script><script>self.__next_f.push([1,"ç°ä»£æµè§ˆå™¨çš„åº•å±‚åŸç†ç‰¹åˆ«çš„å¤æ‚ï¼Œå¯ä»¥è¯´æ˜¯ä¸€ä¸ªå°å‹çš„æ“ä½œç³»ç»Ÿã€‚ä»¥ chrome ä¸ºä¾‹ï¼Œä»–æ˜¯å¤šè¿›ç¨‹çš„æµè§ˆå™¨ï¼Œå…¶ä¸­æ¸²æŸ“é¡µé¢æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ï¼Œå«åšæ¸²æŸ“è¿›ç¨‹ã€‚ç›®å‰ç”¨çš„æœ€å¤šçš„æ–¹å¼æ˜¯ä¸€ä¸ª tab é¡µå•ç‹¬åˆ†é…ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹æ¥ç»´æŠ¤ã€‚æ¯ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªæ¸²æŸ“ä¸»çº¿ç¨‹ç”¨äºæ— é˜»å¡åœ°æ‰§è¡Œæ¸²æŸ“ä»»åŠ¡ã€‚\n\næ¸²æŸ“ï¼Œé€šä¿—çš„è§£é‡Šå°±æ˜¯**å°† html å­—ç¬¦ä¸²è§£æä¸ºå›¾å½¢åƒç´ ä¿¡æ¯**çš„è¿‡ç¨‹ã€‚ä½ è¾“å…¥ä¸€ä¸ª url åœ°å€åï¼Œä¼šé€šè¿‡ä¸€ç³»åˆ—è§£æï¼Œä»ç›®æ ‡æœåŠ¡å™¨ç›´æ¥æˆ–é—´æ¥è·å–åˆ°è¿™ä¸ª html å­—ç¬¦ä¸²ï¼Œè€Œæ¸²æŸ“è¿›ç¨‹è¦åšçš„å°±æ˜¯è¿™ä¸ªç¿»è¯‘ä¸ºåƒç´ ä¿¡æ¯çš„è¿‡ç¨‹ã€‚\n\næœ¬æ–‡å°±é€šè¿‡å›¾è§£æ¥è®²è¿°æµè§ˆå™¨çš„æ¸²æŸ“ä¸»çº¿ç¨‹çš„å·¥ä½œè¿‡ç¨‹ã€‚\n\n[chromium å†…æ ¸æºç ](https://github.com/chromium/chromium)\n\n----\n\n## 0. æ¸²æŸ“æµæ°´çº¿\n\nä¾æ®æ¶ˆæ¯å¾ªç¯çš„æ¦‚å¿µï¼Œæµè§ˆå™¨æ¸²æŸ“ä¸»çº¿ç¨‹æŒ‰ç…§å„ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¾®ä»»åŠ¡é˜Ÿåˆ—ã€äº¤äº’é˜Ÿåˆ—ï¼Œå»¶æ—¶é˜Ÿåˆ—ç­‰ï¼‰ä¼˜å…ˆçº§ï¼Œå–ç”¨ä»»åŠ¡åŒ…å¹¶æ‰§è¡Œã€‚é‚£ä¹ˆï¼Œæ‰§è¡Œçš„è¿™äº›åŒ…åçš„å˜æ›´ï¼Œä½•æ—¶ä¼šçœŸæ­£å‘ˆç°åœ¨é¡µé¢ä¸Šå‘¢ï¼Ÿæˆ‘ä»¬çœ‹å›¾ï¼š\n\n\n![æ— æ ‡é¢˜-2023-10-06-1925.png](/img/posts/2023-10-26/2023-10-26-1.png)\n\nåœ¨æµè§ˆå™¨å‘å‰ç«¯æœåŠ¡å™¨è¯·æ±‚åˆ° html å­—ç¬¦ä¸²åï¼Œå°±æ‰“åŒ…ä¸ºä¸€ä¸ªæ¶ˆæ¯å¾ªç¯ä¸­çš„ä¸€ä¸ªæ¸²æŸ“ä»»åŠ¡ï¼Œäº¤ç”±æ¸²æŸ“ä¸»çº¿ç¨‹æ‰§è¡Œæ¸²æŸ“å·¥ä½œã€‚\n\né‚£ä¹ˆæµè§ˆå™¨æ˜¯å¦‚ä½•è§£æè¿™ä¸ª html å­—ç¬¦ä¸²çš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥æ€»è§ˆä¸€ä¸‹ä»–çš„è§£ææµæ°´çº¿ï¼Œä¹‹åçš„å°èŠ‚å†åˆ†æ­¥æ¥è®²è§£ï¼š\n\n\n![æ— æ ‡é¢˜-2023-10-06-1925.png](/img/posts/2023-10-26/2023-10-26-2.png)\n\n## 1. è§£æ HTML\n\næˆ‘ä»¬è·å–ä¸€ä¸ªé¡µé¢ï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡ç½‘ç»œè¯·æ±‚æ‹¿åˆ° html å­—ç¬¦ä¸²æœ¬èº«çš„ï¼š\n\n\n![image.png](/img/posts/2023-10-26/2023-10-26-3.png)\n\næˆ‘ä»¬ä¹Ÿå¯ä»¥åŠ ä¸Š `view-source` å‰ç¼€æ¥è®¿é—®è¿™ä¸ªå­—ç¬¦ä¸²ï¼š`view-source:https://www.ucloud.cn`\n\n\n![image.png](/img/posts/2023-10-26/2023-10-26-4.png)\n\nä»–ä¸éšåè·å–åˆ°çš„ cssã€js æ–‡ä»¶å…±åŒå½±å“äº†é¡µé¢çš„æ¸²æŸ“ã€‚\n\næµè§ˆå™¨è·å–åˆ° HTMLåï¼Œäº§ç”Ÿæ¸²æŸ“ä»»åŠ¡ï¼Œäº¤ç»™æ¸²æŸ“ä¸»çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚éšåçš„æ¸²æŸ“è§£æå™¨ä¼šå°†è¿™ä¸ªç»“æ„è§£æä¸º DOM æ ‘ å’Œ CSSOM æ ‘ã€‚\n\nå…ˆè§£é‡Šæ¦‚å¿µï¼š\n\n- DOMæ ‘ï¼šæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼Œæ˜¯ç½‘é¡µä¸­ htmlå…ƒç´ ä¸ºæ ¹èŠ‚ç‚¹çš„ä¸€é¢—å…ƒç´ å…³è”å…³ç³»çš„é›†åˆ\n\n\n![æ— æ ‡é¢˜-2023-10-06-1925.png](/img/posts/2023-10-26/2023-10-26-5.png)\n\n- CSSOMæ ‘: æ˜¯ç½‘é¡µCSSå¯¹è±¡æ¨¡å‹ï¼Œæè¿°é¡µé¢DOMç»“æ„å±‚é›†ä¸­çš„cssæ ·å¼\n\n\n![æ— æ ‡é¢˜-2023-10-06-1925.png](/img/posts/2023-10-26/2023-10-26-6.png)\n\nå…¶ä¸­ï¼š\n\n- StyleSheetList æ˜¯é¡µé¢ CSSOM æ ¹èŠ‚ç‚¹ï¼Œä»£è¡¨é¡µé¢æ‰€æœ‰çš„æ ·å¼è¡¨ï¼Œå…¶åŒ…å«å¤šå¥—ä¸åŒä¼˜å…ˆçº§çš„æ ·å¼è¡¨ \n- CSSStyleSheet æ˜¯é¡µé¢æ ·å¼è¡¨ï¼Œæœ‰è¿™å‡ ç§ï¼šå†…è”ï¼ˆ`\u003cdiv style=\"\"\u003e`ï¼‰ã€å¤–éƒ¨ï¼ˆ`\u003clink\u003e`ï¼‰ã€å†…éƒ¨ï¼ˆ`\u003cstyle\u003e`ï¼‰å’Œé»˜è®¤æ ·å¼è¡¨ ï¼ˆä¹Ÿå«ç”¨æˆ·ä»£ç†æ ·å¼è¡¨ï¼Œæ¯ä¸ªæµè§ˆå™¨å†…ç½®æ ·å¼ï¼‰ï¼Œé€šè¿‡ `document.styleSheets` å¯ä»¥è·å–ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰çš„æ ·å¼è¡¨ã€‚\n- CSSStyleRuleï¼šcss è§„åˆ™ï¼Œæ¯”å¦‚ï¼š`body { margin: 0 }` å°±æ˜¯ä¸€ä¸ªè§„åˆ™\n\n\u003e æµè§ˆå™¨çš„ API ä½¿ç”¨ C++ å®ç°ï¼Œå…¶ä½¿ç”¨ js è¿›è¡Œäº†å°è£…ï¼Œä½¿å¾— DOM æ“ä½œå¯ä»¥ä½¿ç”¨ js å®Œæˆ\n\nçŸ¥é“äº†ä¸Šè¿°æ¦‚å¿µï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æµè§ˆå™¨è§£æ html çš„è¿‡ç¨‹ï¼š\n\n\n![æ— æ ‡é¢˜-2023-10-06-1925.png](/img/posts/2023-10-26/2023-10-26-7.png)\n\næˆ‘ä»¬æ¥çœ‹å›¾è¯´è¯ï¼š\n\n1. æ¸²æŸ“ä¸»çº¿ç¨‹æ— é˜»å¡çš„è¯»å– html å­—ç¬¦ä¸²\n2. é‡åˆ°cssï¼Œäº¤ç”±é¢„è§£æçº¿ç¨‹çº¿ç¨‹å‡†å¤‡cssèµ„æºï¼Œå‡†å¤‡å¥½åæ— é˜»å¡è§£æï¼Œå¹¶æ¨é€ä»»åŠ¡ã€‚æ¸²æŸ“ä¸»çº¿ç¨‹é€šè¿‡cssæ„é€ CSSOM\n3. é‡åˆ°jsï¼Œäº¤ç”±é¢„è§£æçº¿ç¨‹å‡†å¤‡jsèµ„æºï¼Œå‡†å¤‡å¥½åå¼€å§‹æ‰§è¡Œjsï¼Œjsä¼šå½±å“CSSOM/DOMæ ‘çš„ç»“æ„ï¼Œæ‰€ä»¥ä¸»çº¿ç¨‹éœ€è¦é˜»å¡ç­‰å¾…ï¼Œæ‰§è¡Œå®Œæ¯•åï¼Œé‡æ–°æ„å»ºCSSOM/DOMæ ‘\n4. æ¸²æŸ“ä¸»çº¿ç¨‹ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œé‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°ç»“æŸã€‚\n\nè¿™ä¸€æ­¥çš„äº§å‡ºï¼šDOM/CSSOM\n\n## 2. æ ·å¼è®¡ç®—\n\nè¿™ä¸€æ­¥çš„ç›®çš„æ˜¯éå† DOMæ ‘ï¼Œæ‰¾åˆ°é¡µé¢å„ä¸ªå…ƒç´ çš„æœ€ç»ˆè®¡ç®—æ ·å¼ï¼ˆComputed Styleï¼‰ï¼š\n\n\n![image.png](/img/posts/2023-10-26/2023-10-26-8.png)\n\nåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼š\n\n- é¢„è®¾å€¼ä¼šå˜ä¸ºç»å¯¹å€¼ã€‚æ¯”å¦‚ 100% -\u003e pxï¼Œ0.125rem -\u003e pxï¼Œred -\u003e rgb(255, 0, 0)ç­‰\n- åŒä¸€å…ƒç´ æŒ‰ç…§ä¼˜å…ˆçº§å±‚å ã€ç»§æ‰¿ç­‰å„ç§å› ç´ å†³å®šæœ€ç»ˆçš„æ ·å¼\n- è®¡ç®—æ ·å¼ä¼šå±•ç¤ºæ‰€æœ‰çš„å¯èƒ½æ ·å¼ï¼Œå³ä½¿æ²¡æœ‰è®¾ç½®è¿‡ï¼Œä¹Ÿä¼šæ˜¯ none æˆ–è€… unset\n\nè·å–è®¡ç®—æ ·å¼æœ‰å“ªäº›ï¼Œå¯ä»¥ä½¿ç”¨ APIï¼š`getComputedStyle`\n\n\n![image.png](/img/posts/2023-10-26/2023-10-26-9.png)\n\n## 3. å¸ƒå±€\n\nå¸ƒå±€çš„è¿‡ç¨‹ï¼Œå°±æ˜¯é€šè¿‡ CSSOM/DOM æ ‘ç”ŸæˆçœŸæ­£åœ¨é¡µé¢å±•ç¤ºçš„ç»“æ„å¸ƒå±€æ ‘ã€‚æˆ‘ä»¬çœ‹å›¾ï¼š\n\n\n![æ— æ ‡é¢˜-2023-10-06-1925.png](/img/posts/2023-10-26/2023-10-26-10.png)\n\nä¸Šå›¾è¿™ä¸ªä¾‹å­å°±å¾ˆå¥½çš„è¯´æ˜äº† DOM æ ‘å’Œå¸ƒå±€æ ‘çš„åŒºåˆ«ã€‚å¸ƒå±€æ ‘ä¸­çš„å„ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¼šæœ‰è‡ªå·±çš„åŒ…å«å—çš„ã€‚\n\n\u003e åŒ…å«å—ï¼š100% è®¡ç®—çš„ç›¸å¯¹å°ºå¯¸å°±æ˜¯è¯¥å…ƒç´ çš„åŒ…å«å—ã€‚å¦‚æœæ˜¯ absolute å®šä½å…ƒç´ ï¼Œå…¶åŒ…å«å—æ˜¯ç¦»ä»–æœ€è¿‘çš„è®¾ç½®äº†é static å®šä½çš„ç¥–å…ˆå…ƒç´ \n\n\nå…¶å®åœ¨ chrome æºç ä¸­ä¹Ÿè§„å®šäº†å„ä¸ªæ ‡ç­¾çš„å†…ç½®æ ·å¼ï¼Œä»–ä»¬éƒ½ä¼šåœ¨å¸ƒå±€é˜¶æ®µè¿›è¡Œåˆ¤æ–­ï¼š\n\n![image.png](/img/posts/2023-10-26/2023-10-26-11.png)\n\nå¦å¤–ä¸€ä¸ªå¸ƒå±€ä¸ DOM ä¸ä¸€æ ·çš„æ˜¯ï¼šæ–‡æœ¬å†…å®¹å¿…é¡»åœ¨è¡Œç›’ä¸­ï¼Œå…·åçš„è¡Œç›’å’Œå—ç›’åœ¨å¸ƒå±€æ ‘ä¸­ä¸èƒ½ç›¸é‚»ï¼Œæ¯”å¦‚ä¸€ä¸ª `inline-block` å’Œä¸€ä¸ª `flex`ï¼Œä»–ä»¬è‚¯å®šæ˜¯åˆ†ä¸¤è¡Œæ˜¾ç¤ºçš„ï¼Œæµè§ˆå™¨ä¸€ç§å¤„ç†æ–¹å¼æ˜¯æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªåŒ¿åçš„ç›’å­æ¥åšé—´éš”ï¼š\n\n\n![æ— æ ‡é¢˜-2023-10-06-1925.png](/img/posts/2023-10-26/2023-10-26-12.png)\n\n\u003e å¸ƒå±€éœ€è¦è€ƒè™‘çš„å› ç´ æœ‰å¾ˆå¤šï¼Œå®šä½ã€æ ·å¼ã€ BFC ç­‰ï¼›åŒæ—¶åœ¨å¸ƒå±€æ ‘é‡Œä¹Ÿä¼šæš´éœ²ä¸€äº›å¸¸ç”¨ä¿¡æ¯ï¼Œæ¯”å¦‚ clientHeightã€offsetHeight ç­‰\n\n\u003e å¸ƒå±€çš„ä¾‹å­è¿˜æœ‰å¾ˆå¤šï¼Œä¸Šé¢çš„ä¾‹å­æ—¨åœ¨è¯´æ˜ DOM æ ‘ï¼ˆjsonï¼‰å’Œ å¸ƒå±€æ ‘çš„ç»“æ„ï¼ˆc++ å¯¹è±¡ï¼‰å¾€å¾€æ˜¯ä¸ä¸€æ ·çš„\n\n## 4. åˆ†å±‚\n\nç°ä»£æµè§ˆå™¨ä¸ºäº†æå‡æ¸²æŸ“æ•ˆç‡ï¼Œå°†äºŒç»´æå‡åˆ°ä¸‰ç»´ï¼Œå¢åŠ ç»´åº¦ï¼Œå¼€è¾Ÿæ–°çš„ç©ºé—´ã€‚ç±»ä¼¼äº PS ä¸­çš„å›¾å±‚ï¼Œä¾¿äºå±€éƒ¨æ¸²æŸ“ã€‚\n\nåœ¨å¸ƒå±€ç¡®å®šäº†å…ƒç´ çš„ä½ç½®å’Œæ ·å¼ä»¥åï¼Œæµè§ˆå™¨ä¼šæ ¹æ®æ¸²æŸ“å¼•æ“çš„ä¸åŒé‡‡ç”¨ä¸åŒçš„åˆ†å±‚æ–¹å¼ã€‚\n\n\n\n![å±å¹•å½•åˆ¶2023-10-26 ä¸‹åˆ4.29.57 (2).gif](/img/posts/2023-10-26/2023-10-26-13.gif)\n\n\u003e ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯æœ‰åˆ†å±‚çš„ã€‚è‡³å°‘æ»šåŠ¨æ¡æ˜¯é»˜è®¤å±‚çº§é«˜äºé¡µé¢çš„ã€‚\n\nåˆ†å±‚ä¸€èˆ¬æ˜¯è·Ÿ css å±æ€§æœ‰å…³ç³»ï¼Œä¸€èˆ¬åœ°ï¼Œå †å ä¸Šä¸‹æ–‡ç›¸å…³çš„å±æ€§ä¼šå½±å“åˆ†å±‚ã€‚ æ¯”å¦‚ z-index å¼ºåˆ¶æé«˜å±‚çº§ï¼›whil-change åˆ™é€‚ç”¨äºåˆ†å±‚æ¸²æŸ“çš„æµè§ˆå™¨ï¼Œå‘Šè¯‰æµè§ˆå™¨ï¼Œæ ¹æ®å®é™…æƒ…å†µå°†å…¶å•ç‹¬åˆ†å±‚ã€‚\n\nåˆ†å±‚çš„ä½œç”¨ï¼š\n\n- æé«˜æ¸²æŸ“æ•ˆç‡ï¼šé€‚ç”¨äºä½ç½®åå¤å˜åŒ–çš„å…ƒç´ ï¼Œå›æµé‡ç»˜åªåœ¨åŒå±‚å‡ºç°ï¼Œè®¡ç®—é‡ä¼šå‡å°‘\n\nåˆ†å±‚ä¸èƒ½æ»¥ç”¨ï¼š\n\n- åˆ†å±‚ä¼šå¢åŠ å†…å­˜æ¶ˆè€—ï¼Œè¿‡å¤šçš„åˆ†å±‚ä¼šå¯¼è‡´æµè§ˆå™¨éå†å’Œè®¡ç®—çš„è€—æ—¶å˜é•¿ã€‚æ‰€ä»¥åº”è¯¥é¿å…æ— æ„ä¹‰çš„åˆ†å±‚æˆ–è€…ä¸åˆç†çš„åˆ†å±‚\n\n\n## 5. ç»˜åˆ¶æŒ‡ä»¤\n\nè¿™ä¸€æ­¥æ˜¯æ¸²æŸ“ä¸»çº¿ç¨‹çš„æœ€åä¸€æ­¥æ“ä½œï¼Œ**ä»–é’ˆå¯¹æ¯ä¸€å±‚å…ƒç´ ï¼Œç”Ÿæˆå¯¹åº”çš„ç»˜åˆ¶æŒ‡ä»¤ï¼šæ¯”å¦‚å°†ç¬”ç§»åŠ¨åˆ° (x, y)ï¼Œç»˜åˆ¶å®½åº¦100pxçš„é»‘è‰²ç›´çº¿...**ï¼ˆç±»ä¼¼ canvasï¼‰ã€‚\n\nä»è¿™ä¸€æ­¥å¾€åï¼Œæ¸²æŸ“ä¸»çº¿ç¨‹çš„å·¥ä½œå°±å®Œæˆäº†ï¼Œæ¸²æŸ“ä¸»çº¿ç¨‹ä¼šå¸¦ç€æ‰€æœ‰ç”Ÿæˆçš„ç»˜åˆ¶æŒ‡ä»¤é›†ï¼Œå°†ä»»åŠ¡äº¤ç»™å…¶ä»–çº¿ç¨‹å®Œæˆã€‚\n\n![æ— æ ‡é¢˜-2023-10-11-1617.png](/img/posts/2023-10-26/2023-10-26-14.png)\n\n\n## 6. åˆ†å—ï¼ˆtilingï¼‰\n\nåˆ°äº†è¿™ä¸€æ­¥ï¼Œæµè§ˆå™¨ä¼šå°†æ¯ä¸€å±‚ä¸Šçš„å…ƒç´ åˆ†æˆä¸åŒçš„å—ï¼Œç¡®å®šå„ä¸ªå—çš„ä¼˜å…ˆçº§ã€‚ä¸€èˆ¬é è¿‘è§†å£çš„å—ä¼˜å…ˆçº§ä¼šç›¸å¯¹è¾ƒé«˜ã€‚\n\n\n![æ— æ ‡é¢˜-2023-10-11-1617.png](/img/posts/2023-10-26/2023-10-26-15.png)\n\nåˆ†å—ä¸€èˆ¬æ˜¯äº¤ç»™åˆ†å—çº¿ç¨‹æ¥å®Œæˆçš„ï¼Œä»–ä¼šç»´æŠ¤å¾ˆå¤šä¸ªåˆæˆå™¨æ¥ç®¡ç†è¿™äº›å—çš„åˆå¹¶å’Œå±•å¼€ã€‚\n\n\n## 7. å…‰æ …åŒ–ï¼ˆGPUè®¡ç®—ä¸ºä¸»ï¼‰\n\nå…‰æ …åŒ–ï¼ˆRasterï¼‰æ˜¯å›¾åƒå¤„ç†çš„ä¸€ä¸ªæ¦‚å¿µï¼Œä»–å°†æŒ‰ç…§æ¯ä¸€ä¸ªå—çš„ä¼˜å…ˆçº§ï¼Œå°†å„ä¸ªå—å…ƒç´ è§£æä¸ºä½å›¾æ ¼å¼ã€‚å¦‚å›¾å±•ç¤ºäº†ä¸€ä¸ªåƒç´ ç‚¹åŠå…¶å‘¨è¾¹è¿é€šåŒºåŸŸåƒç´ ç‚¹çš„ç¤ºæ„å›¾ï¼š\n\n\n![æ— æ ‡é¢˜-2023-10-11-1617.png](/img/posts/2023-10-26/2023-10-26-16.png)\n\næˆ‘ä»¬æ‰€è¯´çš„ GPUè®¡ç®—ä¸»è¦å°±æ˜¯åœ¨è¿™ä¸€ä¸ªç¯èŠ‚ï¼ŒGPU æ¯” CPU æ›´æ“…é•¿å…‰æ …åŒ–è®¡ç®—ï¼Œå…¶æœ¬è´¨æ˜¯çŸ©é˜µçš„è¿ç®—ã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œè¿™ä¸€è¿‡ç¨‹å°†åˆ†é…ç»™ GPU è¿›ç¨‹æ¥å¤„ç†ã€‚\n\n## 8. æœ€ç»ˆç»˜åˆ¶ï¼ˆGPUè®¡ç®—ä¸ºä¸»ï¼‰\n\nåˆæˆçº¿ç¨‹è´Ÿè´£è®¡ç®—å‡ºæ¯ä¸€ä¸ªä½å›¾åœ¨å±å¹•ä¸Šçš„ä½ç½®ï¼Œäº¤ç»™ GPU è¿›è¡Œæœ€ç»ˆå‘ˆç°ã€‚\n\n\nè¿™é‡Œæ¥è§£é‡Šä¸€ä¸‹ï¼Œæ¸²æŸ“è¿›ç¨‹å®é™…ä¸Šæ˜¯åœ¨æ²™ç›’é‡Œè¾¹è¿è¡Œçš„ï¼Œå…¶æ²¡æœ‰æ“ä½œç¡¬ä»¶çš„èƒ½åŠ›ï¼Œæ‰€ä»¥è¿™é‡Œå¿…é¡»è¦äº¤ç»™ GPU è¿›ç¨‹è¿‡æ¸¡ã€‚\n\næ¯”è¾ƒç¥å¥‡çš„æ˜¯ï¼Œcss æ ·å¼ **transform** å¹¶ä¸æ˜¯åœ¨å…‰æ …åŒ–ä¸­ç”Ÿæˆåƒç´ ç‚¹ï¼Œè€Œæ˜¯åœ¨è¿™ä¸€æ­¥çœŸæ­£è¦ç”»çš„æ—¶å€™å†³å®šçš„ï¼Œå°±æ˜¯åœ¨ GPU åšä¸€ä¸ªçŸ©é˜µå˜æ¢ã€‚\n\næˆ‘ä»¬ä¸¾ä¸€ä¸ªçŸ©é˜µä¹˜æ³• åš **skewX** çš„ä¾‹å­ã€‚æˆ‘ä»¬å°† google é¦–é¡µçš„ logo æ¨ªå‘æ‰­æ›²ä¸€ä¸‹ï¼š\n\n\n![image.png](/img/posts/2023-10-26/2023-10-26-17.png)\n\n\næˆ‘ä»¬ç”¨ä¸€ä¸ªç‚¹ P(x, y, 1) æ¥è¯´æ˜é—®é¢˜ï¼Œå°†å…¶è¡¨ç¤ºä¸ºé½æ¬¡åæ ‡å½¢å¼ [x, y, 1]ã€‚ï¼ˆæ¨¡å‹å‚è€ƒï¼š[skewX() - CSSï¼šå±‚å æ ·å¼è¡¨ | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform-function/skewX)ï¼‰\n\n```\nP = [x, y, 1] \n```\n\nä½¿ç”¨ä¹˜æ³•ç®—å­ T è¡¨ç¤ºè½¬æ¢çŸ©é˜µï¼š \n\n```\nT = \\begin{bmatrix}  \n1 \u0026  tan(25deg) \u0026 0 \\\\  \n0 \u0026 1 \u0026 0 \\\\  \n0 \u0026 0 \u0026 1  \\\\  \n\\end{bmatrix}\n```\n![image.png](/img/posts/2023-10-26/1.png)\n\n\nç°åœ¨ï¼Œæˆ‘ä»¬è¦å°†è¿™ä¸ªç‚¹åº”ç”¨Â `transform: skewX(25deg)`Â å˜æ¢ã€‚\n\n```\nP' = T * P^{\\text{T}} = [x', y', z']\n```\n![image.png](/img/posts/2023-10-26/2.png)\n\nè®¡ç®—åå¾—ï¼š\n\n```\nx' = x + tan(25deg) * y  \n```\n```\ny' = y  \n```\n```\nz' = z = 1\n```\n![image.png](/img/posts/2023-10-26/3.png)\n\n\nå¯ä»¥çœ‹åˆ°ï¼ŒskewX åï¼Œçºµåæ ‡æ²¡æœ‰å˜ï¼Œæ¨ªåæ ‡æ•´ä½“å‘å³ç§»åŠ¨äº† `tan(25deg) * y` çš„è·ç¦»ï¼Œæ ¹æ®ä¸‰è§’å‡½æ•°å…¬å¼å¯ä»¥çœ‹å‡ºï¼Œç¡®å®æ˜¯å‘å³å€¾æ–œäº† 25 åº¦ã€‚\n\n\u003e skewX å€¾æ–œæ˜¯æ ¹æ®å›¾å½¢çš„ä¸­å¿ƒç‚¹è¿›è¡Œçš„ï¼Œä¸‹åŠéƒ¨åˆ†å‘å³å¹³ç§»ï¼Œä¸ŠåŠéƒ¨åˆ†å‘å·¦å¹³ç§»ï¼›ä¸Šé¢çš„ä¾‹å­åªä¸¾ä¾‹äº†ä¸‹åŠéƒ¨åˆ†çš„æƒ…å†µã€‚\n\n\u003e åŒç±»å‹çš„æ“ä½œè¿˜æœ‰ ç¼©æ”¾(`scale`)ï¼Œæ—‹è½¬(`rotate`)ä»¥åŠä½ç§»(`translate`) ç­‰\n\n--------------\nå†æ¥çœ‹ä¸€ä¸‹å®Œæ•´çš„è¿‡ç¨‹ï¼Œå¸®åŠ©å›å¿†ï¼š\n\n\n![æ— æ ‡é¢˜-2023-10-06-1925.png](/img/posts/2023-10-26/2023-10-26-18.png)\n\n-----\n\n## 9. Q \u0026 A\n\n#### ä»€ä¹ˆæ˜¯ reflow ï¼Ÿ\n\nå›æµçš„æœ¬è´¨æ˜¯é‡æ–°è®¡ç®—å¸ƒå±€æ ‘ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å›æµçš„æ‰§è¡Œè¿‡ç¨‹ï¼š\n\n\n![æ— æ ‡é¢˜-2023-10-11-1617.png](/img/posts/2023-10-26/2023-10-26-19.png)\n\nå½“è¿›è¡Œäº†å½±å“å¸ƒå±€çš„æ“ä½œåï¼ˆcssomæ”¹å˜ï¼‰ï¼Œä¼šå¼•å‘ä¸€æ¬¡ layoutã€‚\n\næµè§ˆå™¨æœ‰è‡ªå·±çš„ä¼˜åŒ–ç­–ç•¥ï¼Œå¾€å¾€å°†å¤šæ¬¡å›æµåˆå¹¶æ‰§è¡Œï¼ˆæµè§ˆå™¨ä¼šåœ¨æ¶ˆæ¯é˜Ÿåˆ—åšä¼˜åŒ–ï¼‰ï¼Œæ¯”å¦‚åœ¨ js ä»£ç å…¨éƒ¨æ‰§è¡Œå®Œæ¯•åè¿›è¡Œç»Ÿä¸€æ‰§è¡Œï¼Œæ‰€ä»¥ reflow æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚æ‰€ä»¥ï¼Œåœ¨æŸç§åœºæ™¯ä¸‹ï¼Œjs å¯èƒ½ä¸èƒ½å®æ—¶è·å–ï¼ˆåŒæ­¥è·å–ï¼‰æœ€æ–°çš„å¸ƒå±€ä¿¡æ¯ã€‚ï¼ˆå¯ä»¥é€šè¿‡ç›´æ¥åŒæ­¥è¯»å–å±æ€§æ¥å¼ºåˆ¶è§¦å‘å›æµï¼‰\n\n\u003e å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä»£ç åº”è¯¥é¿å…é¢‘ç¹ä¿®æ”¹å¸ƒå±€æ ‘ï¼ˆheight/width/margin/padding...ï¼‰\n\n#### ä»€ä¹ˆæ˜¯ repaint ï¼Ÿ\n\né‡ç»˜çš„æœ¬è´¨æ˜¯é‡æ–°æ ¹æ®åˆ†å±‚ä¿¡æ¯è®¡ç®—ç»˜åˆ¶çš„æŒ‡ä»¤ã€‚ä»–å¼€å§‹çš„èŠ‚ç‚¹ä¸€èˆ¬æ˜¯ paintï¼ŒæŸç§æƒ…å†µä¹Ÿä¼šå¼•èµ·åˆ†å±‚å˜åŒ–ã€‚\n\nå›æµä¸€å®šä¼šå¼•èµ·é‡ç»˜ã€‚\n\n\n![æ— æ ‡é¢˜-2023-10-11-1617.png](/img/posts/2023-10-26/2023-10-26-20.png)\n\n#### ä¸ºä»€ä¹ˆ transform æ•ˆç‡é«˜ ï¼Ÿ\n\nå› ä¸ºè®¡ç®— transform æ˜¯åœ¨æœ€åä¸€æ­¥ï¼ˆdrawï¼‰æ—¶ï¼Œé’ˆå¯¹æœ¬å±‚çº§çš„å…ƒç´ ï¼Œåœ¨ GPU ä¸­æ‰§è¡Œå˜æ¢çš„ï¼Œä¸ä¼šå¼•èµ·å›æµå’Œé‡ç»˜ã€‚\n\n\n![æ— æ ‡é¢˜-2023-10-11-1617.png](/img/posts/2023-10-26/2023-10-26-21.png)\n\nä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œtransform ä¸åœ¨æ¸²æŸ“ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œæ‰€ä»¥ï¼Œå³ä½¿é¡µé¢ js è¿›å…¥äº†æ­»å¾ªç¯ï¼ŒåŠ¨ç”»ä¹Ÿå¯ä»¥æ­£ç¡®æ‰§è¡Œã€‚\n\n\n## 10. é™„ï¼šrequestAnimationFrame ä¸ requestIdleCallback\n\n#### æ¸²æŸ“ä»»åŠ¡å‡ºç°çš„æ—¶æœº\n\nè§†å…·ä½“æƒ…å†µè€Œå®šï¼Œå¹¶ä¸æ˜¯æ¯ä¸€è½®æ¶ˆæ¯å¾ªç¯ç»“æŸæ—¶éƒ½ä¼šäº§ç”Ÿä¸€ä¸ª**æ¸²æŸ“ä»»åŠ¡**ã€‚è¿™è¦æ ¹æ®å±å¹•åˆ·æ–°ç‡ã€é¡µé¢æ€§èƒ½ã€é¡µé¢æ˜¯å¦åœ¨åå°è¿è¡Œç­‰æ¥å…±åŒå†³å®šï¼Œé€šå¸¸æ¥è¯´è¿™ä¸ªæ¸²æŸ“é—´éš”æ˜¯å›ºå®šçš„ã€‚é€šå¸¸å†³å®šæ¸²æŸ“æ—¶æœºçš„å› ç´ æœ‰å¦‚ä¸‹å‡ ç‚¹ï¼š\n\n1. æ˜¾ç¤ºå™¨ä¸€èˆ¬å¸§ç‡ä¸º 60fpsï¼ˆæ¯ 16.66ms æ¸²æŸ“ä¸€æ¬¡ï¼‰ï¼Œå¦‚æœé¡µé¢æ€§èƒ½ç»´æŒä¸äº† 60fpsï¼Œæµè§ˆå™¨ä¼šé™åˆ° 30fps ä»¥ä¿è¯æ¸²æŸ“èƒ½å¤Ÿè¿›è¡Œä¸‹å»ã€‚\n2. å¦‚æœæµè§ˆå™¨ä¸Šä¸‹æ–‡ä¸å¯è§ï¼Œé‚£ä¹ˆé¡µé¢ä¼šé™ä½åˆ° 4fps å·¦å³ç”šè‡³æ›´ä½ã€‚\n3. å¦‚æœæµè§ˆå™¨åˆ¤å®šå½“å‰æ”¹åŠ¨ä¸ä¼šå¼•èµ·è§†è§‰å˜åŒ–æˆ–è€… **`requestAnimationFrame`** å›è°ƒä¸ºç©ºæ—¶ï¼Œåˆ™ä¼šè·³è¿‡æ¸²æŸ“ã€‚\n4. åœ¨é¡µé¢ resizeã€é¡µé¢ scrollã€**`requestAnimationFrame`** è°ƒç”¨ã€IntersectionObserver è§¦å‘æ˜¾ç¤ºã€å…ƒç´ æ˜¾ç¤ºã€éšè—æˆ–ç»“æ„å˜åŒ–æ—¶ï¼Œä¸€èˆ¬åœ¨æ¸²æŸ“é—´éš”åˆ°æ¥æ—¶ä¼šæ¨é€ä¸€ä¸ªæ¸²æŸ“ä»»åŠ¡ã€‚\n\n#### requestAnimationFrame\n\nrequestAnimationFrame çš„å›è°ƒæœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š\n\n1.  åœ¨é‡æ–°æ¸²æŸ“å‰è°ƒç”¨ã€‚\n2.  å›è°ƒåˆå¹¶æ‰§è¡Œã€‚\n\nç¬¬ä¸€æ¡ï¼Œä¿è¯äº†åœ¨æ¸²æŸ“ä»»åŠ¡æ‰§è¡Œä¹‹å‰æ‰§è¡Œå®Œæƒ³è¦æ”¹å˜çš„å…ƒç´ ï¼Œä¿è¯äº†åŠ¨ç”»çš„æµç•…ï¼Œä¸ä¼šæ‹–å»¶åˆ°ä¸‹ä¸€å¸§å†æ¸²æŸ“ã€‚ç¬¬äºŒæ¡æˆ‘ä»¬å¯ä»¥çœ‹ä¸€æ®µä»£ç ï¼š\n\n```js\n// requestAnimationFrame åœ¨æ¸²æŸ“ä»»åŠ¡æ‰§è¡Œä¹‹å‰æ‰§è¡Œ\nsetTimeout(() =\u003e {\n  console.log(1)\n  requestAnimationFrame(() =\u003e console.log(2))\n})\nsetTimeout(() =\u003e {\n  console.log(3)\n  requestAnimationFrame(() =\u003e console.log(4))\n})\n\nqueueMicrotask(() =\u003e console.log(5))\nqueueMicrotask(() =\u003e console.log(6))\n\n/** è¾“å‡º\n5\n6\n1\n3\n2\n4\n*/\n```\n\n\u003e queueMicrotask æ˜¯ web APIï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªå¾®ä»»åŠ¡\n\n#### requestIdleCallback\n\nrequestIdleCallback æ˜¯ç©ºé—²è°ƒåº¦ç®—æ³•ï¼ŒæŠŠä¸€äº›è®¡ç®—é‡è¾ƒå¤§ä½†æ˜¯åˆæ²¡é‚£ä¹ˆç´§æ€¥ï¼ˆä»»åŠ¡é˜Ÿåˆ—çš„ä¼˜å…ˆçº§å†³å®šï¼‰çš„ä»»åŠ¡æ”¾åˆ°ç©ºé—²æ—¶é—´å»æ‰§è¡Œã€‚ä¸è¦å»å½±å“æµè§ˆå™¨ä¸­ä¼˜å…ˆçº§è¾ƒé«˜çš„ä»»åŠ¡ï¼Œæ¯”å¦‚åŠ¨ç”»ç»˜åˆ¶ã€ç”¨æˆ·è¾“å…¥ã€å¾®ä»»åŠ¡ç­‰ç­‰ã€‚\n\n\n```js\n// å®šä¹‰ä½ çš„è®¡ç®—å¯†é›†å‹ä»»åŠ¡  \nfunction computeIntensiveTask() {  \n  // æ‰§è¡Œä¸€äº›å¤æ‚çš„è®¡ç®—...  \n}  \n  \n// ä½¿ç”¨ requestIdleCallback åœ¨ç©ºé—²æ—¶æ‰§è¡Œä»»åŠ¡  \nrequestIdleCallback(function() {  \n  computeIntensiveTask();  \n}, {  \n  timeout: 1000, // è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…æ²¡æœ‰ç©ºé—²æ—¶é—´ï¼Œå›è°ƒå‡½æ•°å°†è¢«å–æ¶ˆ  \n  dependencies: [] // å¯ä»¥è®¾ç½®ä¾èµ–é¡¹ï¼Œå½“æ‰€æœ‰ä¾èµ–é¡¹éƒ½å®Œæˆæ—¶ï¼Œæ‰ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°  \n});\n```\n\nä½†æ˜¯ï¼Œå…¶å…¼å®¹æ€§è¿˜ä¸å¥½ï¼Œå¯¼è‡´ React çš„ fiber ä¸å¾—ä¸è‡ªå·±å®ç°äº†ä¸€å¥—è¿™ä¸ª APIã€‚\n\n\n![image.png](/img/posts/2023-10-26/2023-10-26-22.png)\n\n\n## 11. æ€»ç»“\n\n#### æµè§ˆå™¨æ˜¯å¦‚ä½•æ¸²æŸ“é¡µé¢çš„ï¼Ÿ\n\n1. æ¥å— HTMLï¼Œäº§ç”Ÿæ¸²æŸ“ä»»åŠ¡ï¼Œäº¤ç»™æ¸²æŸ“ä¸»çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—\n2. åœ¨æ¶ˆæ¯å¾ªç¯æœºåˆ¶ä¸‹ï¼Œæ¸²æŸ“ä¸»çº¿ç¨‹ä¾æ¬¡å–å‡ºä»»åŠ¡å¹¶å¼€å§‹æ¸²æŸ“\n3. æ¸²æŸ“ä»»åŠ¡åˆ†ä¸ºå¤šä¸ªé˜¶æ®µä¸²è¡Œæµæ°´æ‰§è¡Œ:\n\n```js\n1. htmlè§£æ\n2. æ ·å¼è®¡ç®—\n3. å¸ƒå±€\n4. åˆ†å±‚\n5. ç»˜åˆ¶æŒ‡ä»¤\n6. åˆ†å—\n7. å…‰æ …åŒ–\n8. ç”»å‡ºåƒç´ ç‚¹ã€‚\n```"])</script><script>self.__next_f.push([1,"22:T2812,"])</script><script>self.__next_f.push([1,"äº‹ä»¶å¾ªç¯ ï¼ˆEvent loopï¼Œåˆå«æ¶ˆæ¯å¾ªç¯ Message loopï¼‰æ˜¯æµè§ˆå™¨çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ï¼Œæ˜¯å‰ç«¯å­¦ä¹ å’ŒæŠ€æœ¯æå‡ç»•ä¸è¿‡å»çš„çŸ¥è¯†ã€‚æœ¬æ–‡é€šè¿‡å›¾è§£çš„æ–¹å¼ï¼Œè®²è¿°ä¸€ä¸‹ç°ä»£æµè§ˆå™¨äº‹ä»¶å¾ªç¯çš„è¿è¡ŒåŸç†ã€‚\n\n## 1. æµè§ˆå™¨çš„è¿›ç¨‹ä¸çº¿ç¨‹\n\nè¿›ç¨‹æ˜¯è®¡ç®—æœºæ“ä½œç³»ç»Ÿèµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚ç°ä»£æµè§ˆå™¨ï¼Œä»¥ chrome ä¸ºä¾‹ï¼Œå¹¿æ³›é‡‡ç”¨çš„æ˜¯å¤šè¿›ç¨‹æ¶æ„ã€‚ä¸ºäº†å‡å°‘è¿ç¯å´©æºƒçš„å‡ ç‡ï¼Œå¯åŠ¨æµè§ˆå™¨åï¼Œä¼šå°†å„ä¸ªä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªè¿›ç¨‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n\n![è¿›ç¨‹.png](/img/posts/2023-10-12/2023-10-12-1.png)\n\nchrome å°†æµè§ˆå™¨ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªè¿›ç¨‹ï¼š\n\n- æµè§ˆå™¨è¿›ç¨‹ï¼ˆBrowser processï¼‰ï¼šæˆ‘è´Ÿè´£ç•Œé¢æ˜¾ç¤ºã€ç”¨æˆ·äº¤äº’ã€å­è¿›ç¨‹ç®¡ç†ç­‰ä¸šåŠ¡ã€‚\n- ç½‘ç»œè¿›ç¨‹ï¼ˆNetwork processï¼‰ï¼šæˆ‘è´Ÿè´£åŠ è½½ç½‘ç»œèµ„æºä¸šåŠ¡ã€‚\n- æ¸²æŸ“è¿›ç¨‹ï¼ˆRendering processï¼‰ï¼šæˆ‘æ˜¯æ¸²æŸ“çš„ä¸»è§’ï¼Œè´Ÿè´£æ‰§è¡Œ HTMLã€cssã€js ä»£ç ã€‚é»˜è®¤æƒ…å†µï¼Œæµè§ˆå™¨ä¼šä¸ºæ¯ä¸€ä¸ª tab é¡µç­¾å¼€å¯ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ï¼Œä»¥ç¡®ä¿ç›¸äº’ä¸å½±å“ã€‚\n- ...\n\n\u003e é¢‘ç¹å¼€å¯è¿›ç¨‹ä¼šé€ æˆå†…å­˜å ç”¨è¿‡å¤šçš„æƒ…å†µï¼Œchrome åç»­ä¼šè¿›è¡Œæ”¹è¿›ï¼Œè€ƒè™‘ç›¸åŒç«™ç‚¹ï¼ˆç›¸åŒé¡¶çº§åŸŸåå’ŒäºŒçº§åŸŸåï¼‰å…±ç”¨ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ã€‚\n\n![æ— æ ‡é¢˜-2023-10-06-19251.png](/img/posts/2023-10-12/2023-10-12-2.png)\n\n\næ¸²æŸ“è¿›ç¨‹ä¼šå¼€å¯ä¸€ä¸ªæ¸²æŸ“ä¸»çº¿ç¨‹ï¼Œç”¨äºæ— é˜»å¡æ¸²æŸ“ä»»åŠ¡ã€‚å…¶ä½™çº¿ç¨‹ååŠ©ä¸»çº¿ç¨‹å®Œæˆä»»åŠ¡ã€‚\n\n**æ¸²æŸ“ä¸»çº¿ç¨‹ï¼ˆMain threadï¼‰** è´Ÿè´£æ‰§è¡Œä»£ç ã€æ ·å¼ä¸å¸ƒå±€ï¼ˆé€šè¿‡ä¼˜å…ˆçº§ã€ç™¾åˆ†æ¯”æ¢ç®—ã€å®½é«˜ç­‰å‡ ä½•ä¿¡æ¯é«˜åŠ¨æ€è®¡ç®—ã€ç›¸å¯¹ä½ç½®ç­‰è®¡ç®—æœ€ç»ˆæ ·å¼è¡¨ï¼‰ã€å¤„ç†å›¾å±‚ã€æ§åˆ¶60å¸§åˆ·æ–°ã€æ‰§è¡Œå„ç§å›è°ƒå‡½æ•°ç­‰ï¼Œæ˜¯æœ€å¿™çš„ä¸€ä¸ªï¼Œä¸€åˆ»ä¹Ÿæ²¡æœ‰åœæ­‡ã€‚\n\n\n![æ— æ ‡é¢˜-2023-10-06-19252.png](/img/posts/2023-10-12/2023-10-12-3.png)\n\næ­¤æ—¶å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸»æ¸²æŸ“ä»»åŠ¡éƒ½äº¤ç»™ä¸€ä¸ªçº¿ç¨‹ï¼Œæ•ˆç‡ä¼šé«˜å—ï¼Ÿä¸ºä»€ä¹ˆä¸å¤šçº¿ç¨‹ä¸€èµ·æ¸²æŸ“ï¼Ÿ\n\nè¿™æ˜¯å› ä¸ºæµè§ˆå™¨æ¸²æŸ“å’Œ JavaScript æ‰§è¡Œå…±ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ JavaScript æ‰§è¡Œåˆä¼šå½±å“ CSSOM/DOM æ ‘çš„æ¸²æŸ“å’Œç»“æ„ï¼Œæ‰€ä»¥å¿…é¡»é˜»å¡æ¸²æŸ“ï¼Œä»–ä»¬ä¹Ÿå¿…é¡»æ˜¯å•çº¿ç¨‹æ“ä½œã€‚åœ¨æ„å»º DOM æ—¶ï¼ŒHTML è§£æå™¨è‹¥é‡åˆ°äº† JavaScriptï¼Œå®ƒä¼šæš‚åœæ„å»ºDOMï¼Œå°†æ§åˆ¶æƒç§»äº¤ç»™ JavaScript å¼•æ“ï¼Œç­‰ JavaScript å¼•æ“è¿è¡Œå®Œæ¯•ï¼Œæµè§ˆå™¨å†ä»ä¸­æ–­çš„åœ°æ–¹æ¢å¤ DOM æ„å»ºã€‚å¦‚æœä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†å¯èƒ½ä¼šå¯¼è‡´æ¸²æŸ“DOMçš„å†²çªï¼Œå¤æ‚åº¦ä¼šå¤§å¹…åº¦æå‡ï¼š\n\n\n![æ— æ ‡é¢˜-2023-10-06-19254.png](/img/posts/2023-10-12/2023-10-12-4.png)\n\n## 2. æ¶ˆæ¯å¾ªç¯\n\nä¸Šé¢ä½¿ç”¨å•çº¿ç¨‹ï¼Œä½¿å¾—åœ¨ç¼–å†™ä»£ç æ—¶æ— éœ€è€ƒè™‘å¤æ‚çš„çº¿ç¨‹åŒæ­¥å’Œäº’æ–¥é—®é¢˜ï¼Œä»è€Œé™ä½äº†å¼€å‘çš„å¤æ‚æ€§ï¼Œä½†æ˜¯ç»ˆå½’æ•ˆç‡æ˜¯ä¸Šä¸å»çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™é‡Œå·§å¦™åœ°å¼•å…¥äº†æ¶ˆæ¯å¾ªç¯æ¥ç»Ÿä¸€è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n\n**æ ¸å¿ƒæ€æƒ³**ï¼šæ¸²æŸ“ä¸»çº¿ç¨‹æ°¸ä¹…è½®è¯¢æ‰§è¡Œä»»åŠ¡ï¼›å•ç‹¬å¼€è¾Ÿä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage queueï¼‰ç©ºé—´ç”¨äºå­˜æ”¾å„ä¸ªçº¿ç¨‹åŠ å…¥çš„ä»»åŠ¡ï¼›æ¸²æŸ“ä¸»çº¿ç¨‹åªæ˜¯ç®€å•çš„æ‹¿å–ä»»åŠ¡æ‰§è¡Œï¼Œè€Œä¸ç”¨æ“å¿ƒè¿™ä¸ªä»»åŠ¡æ˜¯è°é€è¿‡æ¥çš„ã€‚åœ¨ Chrome çš„æºç ä¸­ï¼Œä½¿ç”¨çš„æ˜¯ä¸€ä¸ªæ­»å¾ªç¯æ¥å®Œæˆçš„ï¼š\n\n```cpp\nfor(;;) {}\n```\n\n\u003e æ¶ˆæ¯é˜Ÿåˆ—çš„æ— é™è½®è¯¢å°±å«æ¶ˆæ¯å¾ªç¯ï¼Œæ¶ˆæ¯å¾ªç¯å°±å‘ç”Ÿåœ¨æ¸²æŸ“ä¸»çº¿ç¨‹é‡Œ\n\n![æ— æ ‡é¢˜-2023-09-15-1456.png](/img/posts/2023-10-12/2023-10-12-5.png)\n\n1. æœ€å¼€å§‹ï¼Œæ¸²æŸ“ä¸»çº¿ç¨‹å¼€å§‹è½®è¯¢\n2. æ¯ä¸€æ¬¡å‘¢å¾ªç¯æ£€æŸ¥æ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¦æœ‰ä»»åŠ¡ï¼Œæœ‰åˆ™å–å‡ºç¬¬ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œã€‚\n3. å…¶ä»–æ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è¿½åŠ ä»»åŠ¡è¿›æ¶ˆæ¯é˜Ÿåˆ—çš„æœ«å°¾ã€‚\n\n### å¼‚æ­¥\n\nåœ¨æ¶ˆæ¯å¾ªç¯ä¸­ï¼Œè‚¯å®šä¼šå­˜åœ¨ä¸€äº›éœ€è¦å»¶æ—¶æ‰§è¡Œçš„ä»£ç ï¼Œjsåœ¨æ‰§è¡Œåˆ°ä»–ä»¬æ—¶ä¸ä¼šç«‹å³è§¦å‘å›è°ƒï¼Œè€Œæ˜¯éœ€è¦æŸç§è®¡æ—¶æœºåˆ¶æˆ–è€…è§¦å‘æœºåˆ¶æ¥å®šæ—¶è§¦å‘ï¼Œä»–ä»¬ä¸€èˆ¬æ˜¯é€šè¿‡å›è°ƒå‡½æ•°æ¥è¿”å›æ‰§è¡Œçš„ç»“æœï¼Œå¤§è‡´åˆ†ç±»å¦‚ä¸‹ï¼š\n\n1. å‰ç«¯APIè®¡æ—¶å™¨ï¼šsetTimeoutã€setInterval\n2. å‰ç«¯å¼‚æ­¥ APIï¼šPromiseç­‰\n3. ç½‘ç»œé€šä¿¡ï¼šXHRã€fetchç­‰\n4. ç”¨æˆ·äº¤äº’å›è°ƒï¼šaddEventListener\n\n\u003e å¼‚æ­¥ä¸åŒæ­¥æœ€å¤§çš„ä¸åŒæ˜¯ï¼Œå¼‚æ­¥å›è°ƒè§¦å‘å‰çš„å»¶æ—¶å¯¹ç”¨æˆ·æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚è®¾è®¡æµè§ˆå™¨æ—¶ï¼Œå¼‚æ­¥è§¦å‘å‰çš„é‚£æ®µå»¶æ—¶åº”è¯¥å¦å¤–å¼€è¾Ÿçº¿ç¨‹ï¼ˆæ¯”å¦‚è®¡æ—¶çº¿ç¨‹ï¼‰å•ç‹¬è®¡æ•°ï¼Œè€Œä¸é˜»å¡æ¸²æŸ“ä¸»çº¿ç¨‹\n\nå¼‚æ­¥çš„æ¸²æŸ“è¿‡ç¨‹å¦‚ä¸‹ï¼š\n\n\n![æ— æ ‡é¢˜-2023-09-15-1456.png](/img/posts/2023-10-12/2023-10-12-6.png)\n\nå¯ä»¥çœ‹åˆ°ï¼Œå¼‚æ­¥ä»»åŠ¡åœ¨æ‰§è¡Œå®Œæ¯•åè¿›å…¥æ¶ˆæ¯é˜Ÿåˆ—æœ«å°¾æ’é˜Ÿå³å¯ï¼ä¸»çº¿ç¨‹åªç®¡æ‹¿æ¶ˆæ¯ä»»åŠ¡ï¼Œè€Œä¸ç”¨ç®¡è®¡æ—¶ä»»åŠ¡æ˜¯å¦å®Œæˆã€‚\n\n\u003e è®¡æ—¶çº¿ç¨‹å…¶å®ä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿåº•å±‚çš„é€»è¾‘ï¼Œè¿™é‡Œä¸åšæ·±ç©¶ã€‚\n\n\n#### å¼‚æ­¥æ¡ˆä¾‹\n\nçœ‹ä¸‹é¢çš„ä»£ç ï¼š\n\n```js\nfunction delay(duration) { /* æ­»å¾ªç¯ duration ç§’ */ }\n\nconst btn = document.querySelector('button');\nconst h1 = document.querySelector('h1');\n\nbtn.onclick = function() {\n    h1.textContent = 'hello message queue !'\n    delay(3000)\n}\n```\nä»–æ‰§è¡Œåä¼šæœ‰ä»€ä¹ˆè¡¨ç°ï¼Ÿæ˜¯é¡µé¢æ ‡é¢˜å˜ä¸º 'hello message queue !' åå‡æ­»3ç§’é’Ÿå—ï¼Ÿæˆ‘ä»¬ç”¨å›¾è§£æ¥åˆ†æä¸€ä¸‹ï¼š\n\n\n![æ— æ ‡é¢˜-2023-09-15-1456.png](/img/posts/2023-10-12/2023-10-12-7.png)\n\næˆ‘ä»¬æ¥çœ‹å›¾è¯´è¯ï¼š\n\n1. ç”¨æˆ·ç‚¹å‡»ï¼Œç‚¹å‡»çš„å›è°ƒè¿›å…¥æ¶ˆæ¯é˜Ÿåˆ—\n2. è¿™ä¸ªå›è°ƒäº‹ä»¶åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼ŒåŒæ­¥ä»£ç  `h1.textContent = 'hello message queue !'` ç«‹å³æ‰§è¡Œï¼Œå»¶æ—¶ä»£ç å¼€å§‹æ‰§è¡Œè¿›å…¥æ­»å¾ªç¯\n3. æœ€åå…¥é˜Ÿä¸€ä¸ªç»˜åˆ¶ä»»åŠ¡ï¼Œåœ¨å…¶ä»–ä»£ç æ‰§è¡Œå®Œæ¯•åå¼€å§‹ç»˜åˆ¶\n\næ˜¯ä¸æ˜¯çœ‹å‡ºé—®é¢˜æ¥å•¦ï¼Ÿæµè§ˆå™¨å®é™…æ•ˆæœæ˜¯å…ˆå‡æ­»3ç§’é’Ÿå†æ”¹å˜æ ‡é¢˜æ–‡å­—ï¼\n\n\u003e ç»˜åˆ¶ä»»åŠ¡ä¾§é‡äºæ¸²æŸ“åŸç†ï¼Œä¸æ˜¯æœ¬æ–‡é‡ç‚¹ï¼Œä¸åšèµ˜è¿°ã€‚ä»–å‡ºç°åœ¨å¾ªç¯çš„æ¯ä¸€æ¬¡è¿­ä»£ä¹‹åã€‚åœ¨æ¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯çš„è¿­ä»£ä¸­ï¼Œæµè§ˆå™¨ä¼šå…ˆå¤„ç†æ‰€æœ‰çš„åŒæ­¥ä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼šè§£æHTMLï¼Œå¤„ç†DOMæ“ä½œç­‰ï¼‰ï¼Œç„¶åå¤„ç†å¼‚æ­¥ä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼šç½‘ç»œè¯·æ±‚ï¼Œå®šæ—¶å™¨å›è°ƒç­‰ï¼‰ã€‚åœ¨è¿™ä¸ªå¼‚æ­¥ä»»åŠ¡å®Œæˆåï¼Œæµè§ˆå™¨ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯è¿­ä»£ã€‚\n\n#### ç†è§£å¼‚æ­¥\n\nå…³äºå¼‚æ­¥ï¼Œæˆ‘ä»¬æ˜¯æ€ä¹ˆç†è§£çš„å‘¢ï¼Ÿ\n\nä¸€èˆ¬æ¥è¯´ï¼Œå•çº¿ç¨‹è¯­è¨€æ˜¯æ²¡æœ‰ä¸¥æ ¼æ„ä¹‰çš„å¼‚æ­¥çš„ï¼Œä»£ç æ˜¯ä»ä¸Šè‡³ä¸‹ä¾æ¬¡æ‰§è¡Œçš„ã€‚ä¸Šé¢è®²çš„å¼‚æ­¥ï¼Œæ˜¯åœ¨æµè§ˆå™¨ç»´åº¦æ¥è®²çš„ï¼Œjsæ²¡æœ‰å¤šçº¿ç¨‹ï¼Œä½†æ˜¯æµè§ˆå™¨å¯ä»¥å¼€è¾Ÿå¤šä¸ªçº¿ç¨‹æ¥ç»´æŠ¤å¼‚æ­¥çš„ä»»åŠ¡ã€‚\n\næ¸²æŸ“ä¸»çº¿ç¨‹æ‰§è¡Œ js ä»»åŠ¡ï¼ˆjsçº¿ç¨‹é˜»å¡æ‰§è¡Œï¼‰ï¼Œä¸»çº¿ç¨‹æœ‰æ‰¿æ‹…æ¸²æŸ“çš„å…¶ä»–ä»»åŠ¡ï¼Œå¦‚æœéƒ½åŒæ­¥æ‰§è¡Œï¼Œä¸»çº¿ç¨‹å°±ä¼šç™½ç™½æ¶ˆè€—æ—¶é—´ï¼Œé¡µé¢ç»å¸¸æ€§å‡æ­»ã€‚\n\né‡‡ç”¨æ¶ˆæ¯å¾ªç¯+å¼‚æ­¥æ—¶ï¼Œåœ¨å¼‚æ­¥ä»»åŠ¡å‘ç”Ÿæ—¶ï¼Œä¸»çº¿ç¨‹å°†è¿™ä¸ªä»»åŠ¡äº¤ç»™å…¶ä»–çº¿ç¨‹æ¥æ‰§è¡Œï¼Œè·³è¿‡è¿™ä¸ªä»»åŠ¡å¾€åæ‰§è¡Œï¼›å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åå°†å›è°ƒåŒ…è£…æˆä»»åŠ¡æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—æœ«å°¾ï¼Œç­‰å¾…ä¸»çº¿ç¨‹è°ƒç”¨ã€‚\n\nè¿™å°±ä¿è¯äº†å•çº¿ç¨‹æ¸²æŸ“æ—¶ï¼Œæ°¸ä¸é˜»å¡æ¸²æŸ“ã€‚æœ€å¤§é™åº¦ä¿è¯ä¸»çº¿ç¨‹æµç•…ã€‚\n\n\n### ä¼˜å…ˆçº§\n\nä»»åŠ¡æœ¬èº«æ²¡æœ‰ä¼˜å…ˆçº§ï¼Œæ¸²æŸ“ä¸»çº¿ç¨‹ä¾æ¬¡ä»å¯¹å¤´æ‹¿å–ä»»åŠ¡æ‰§è¡Œã€‚æœ‰ä¼˜å…ˆçº§çš„æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ã€‚\n\nåœ¨æœ€æ–°ç‰ˆçš„ chrome ä¸­ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å…¶å®ä¸æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè€Œæ˜¯å¤šä¸ªï¼Œä»–ä»¬æœ‰ä¼˜å…ˆçº§ï¼Œè¿™ä¸ªä¼˜å…ˆçº§å†³å®šäº†è°å…ˆè¿›å…¥æ¸²æŸ“ä¸»çº¿ç¨‹è¢«æ‰§è¡Œï¼š\n\n- å»¶æ—¶é˜Ÿåˆ—ï¼ˆDelay queueï¼‰ï¼šè®¡æ—¶å™¨å›è°ƒä»»åŠ¡é˜Ÿåˆ—ï¼Œä¼˜å…ˆçº§ã€ä¸­ã€‘\n- äº¤äº’é˜Ÿåˆ—ï¼ˆInteractive queueï¼‰ï¼šç”¨æˆ·äº¤äº’åå›è°ƒäº‹ä»¶é˜Ÿåˆ—ï¼Œä¼˜å…ˆçº§ã€é«˜ã€‘\n- å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆMicro queueï¼‰ï¼šç”¨æˆ·æ•°æ®æœ€å¿«æ‰§è¡Œé˜Ÿåˆ—ï¼Œä¾‹å¦‚ Promiseã€MutationObserver ç­‰ï¼Œå…¶ä¼˜å…ˆçº§ã€æœ€é«˜ã€‘\n- ...\n\n\n\u003e æ ¹æ® W3C æœ€æ–°æ ‡å‡†ï¼Œç°ä»£æµè§ˆå™¨å°†å®ä»»åŠ¡é˜Ÿåˆ—çš„æ¦‚å¿µè¿›ä¸€æ­¥åšäº†ç»†åˆ†ã€‚åŸæ¥çš„å®ä»»åŠ¡ä¸»è¦åŒ…å«ï¼š`script(æ•´ä½“ä»£ç )ã€setTimeoutã€setIntervalã€I/Oã€UIäº¤äº’äº‹ä»¶ã€postMessageã€MessageChannelã€setImmediate(Node.js ç¯å¢ƒ)`ç­‰ã€‚\n\n#### ä¼˜å…ˆçº§æ¡ˆä¾‹\n\næˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šï¼š\n\n```js\nsetTimeout(function() {\n  console.log(1);\n}, 0);\n\nconsole.log(2);\n\nPromise.resolve().then(function() {\n  console.log(3);\n});\n\nconsole.log(4);\n```\n\næˆ‘ä»¬å°†ä»£ç æ‹†åˆ†å‡ å—æ¥åˆ†æï¼š\n\n\n![æ— æ ‡é¢˜-2023-10-11-1617.png](/img/posts/2023-10-12/2023-10-12-8.png)\n\njs ä»£ç æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œæ‰€ä»¥è¿™ 4 å—ä¼šè¢« js æ‰§è¡Œå¼•æ“å¿«é€Ÿæ‰«æåˆ°å¹¶åŠ å…¥å“åº”çš„é˜Ÿåˆ—é‡Œï¼š\n\n\n![æ— æ ‡é¢˜-2023-10-11-1617.png](/img/posts/2023-10-12/2023-10-12-9.png)\n\nç„¶åæ¸²æŸ“ä¸»çº¿ç¨‹ä¼šæŒ‰ç…§é˜Ÿåˆ—çš„ä¼˜å…ˆçº§æ‹¿å–ä»»åŠ¡ï¼Œç”±äº 2 å’Œ 4 å·ä»»åŠ¡æ˜¯åŒæ­¥ä»£ç ï¼Œç›´æ¥å…¥æ¸²æŸ“ä¸»çº¿ç¨‹ï¼Œå¯ç›´æ¥æ‰§è¡Œï¼Œæ‰“å° 2 å’Œ 4ï¼›æ¥ä¸‹æ¥æ‹¿å–ä¼˜å…ˆçº§æœ€é«˜çš„å¾®å¯¹åˆ—çš„ä»»åŠ¡ 3 å¹¶æ‰§è¡Œï¼Œè¾“å‡º 3ï¼Œæ¥ä¸‹æ¥æ‹¿äº¤äº’é˜Ÿåˆ—ï¼Œæ²¡æœ‰ä»»åŠ¡ï¼›æœ€åè·å–å»¶æ—¶é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œå¹¶ä¾æ¬¡æ‰§è¡Œã€‚\n\næ³¨æ„ï¼Œè¿™é‡Œ 1 å·å»¶æ—¶ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œä¼šå¼€è¾Ÿè®¡æ—¶çº¿ç¨‹æ¥è®¡æ•°ï¼Œè®¡æ•°å®Œæˆåï¼Œå°†é‡Œè¾¹çš„åŒæ­¥ä»£ç  `console.log(1);` åŠ å…¥åŒæ­¥çš„æ¶ˆæ¯é˜Ÿåˆ— (è¿™é‡Œå°±æ˜¯ç›´æ¥åŠ å…¥æ¸²æŸ“ä¸»çº¿ç¨‹ï¼‰åŒæ­¥æ‰§è¡Œï¼Œå°±å¯ä»¥è¾“å‡º 1 äº†ã€‚æ‰€ä»¥è¾“å‡ºç»“æœæ˜¯ï¼š`2 4 3 1`\n\n----\n\n## 3. æ€»ç»“\n\n**æ¦‚å¿µä¸€**ï¼šæ¶ˆæ¯å¾ªç¯åˆå«äº‹ä»¶å¾ªç¯ï¼Œæ˜¯æµè§ˆå™¨å¤„ç†å¼‚æ­¥çš„ä¸€ç§è°ƒåº¦ç­–ç•¥ã€‚\n\n**æ¦‚å¿µäºŒ**ï¼šæ¸²æŸ“ä¸»çº¿ç¨‹ä¼šåå¤è½®è¯¢ï¼ˆforå¾ªç¯ï¼‰ï¼Œä¸æ–­æ‹¿å–æ¶ˆæ¯é˜Ÿåˆ—çš„ä»»åŠ¡æ¥æ‰§è¡Œï¼›å…¶ä»–çº¿ç¨‹è·å–åˆ°ä»»åŠ¡åï¼Œåœ¨åˆé€‚çš„æ—¶æœºå°†å…¶è¿½åŠ åœ¨æ¶ˆæ¯é˜Ÿåˆ—æœ«å°¾ã€‚\n\n**æ¦‚å¿µä¸‰**ï¼šä»»åŠ¡é˜Ÿåˆ—åˆ†ä¸º å»¶æ—¶é˜Ÿåˆ—ã€äº¤äº’é˜Ÿåˆ—ã€å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼›ä¸åŒä»»åŠ¡é˜Ÿåˆ—æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ã€‚\n\n### Q\u0026A\n\n#### å»¶æ—¶é˜Ÿåˆ—æ˜¯æ€ä¹ˆè®¡æ—¶çš„ï¼Ÿæ—¶é—´ç²¾ç¡®å—ï¼Ÿ\n\nå»¶æ—¶é˜Ÿåˆ—è°ƒç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½ï¼Œè€Œè®¡ç®—æœºç¡¬ä»¶å¹¶æ²¡æœ‰ç±»ä¼¼åŸå­é’Ÿçš„è®¾å¤‡ï¼ˆä½¿ç”¨çš„æ˜¯CPUå¯„å­˜å™¨è®¡æ—¶ï¼‰ï¼Œæ²¡æœ‰åŠæ³•åšåˆ°ç™¾åˆ†ç™¾ç²¾å‡†ã€‚\n\næŒ‰ç…§ W3C æ ‡å‡†ï¼Œæµè§ˆå™¨å®ç°è®¡æ—¶å™¨æ—¶ï¼Œå¦‚æœåµŒå¥—å±‚çº§è¶…è¿‡ 5 å±‚ï¼Œåˆ™ä¼šå¸¦æœ‰ 4 æ¯«ç§’çš„æœ€å°é—´éš”æ—¶é—´ï¼Œè¿™åˆè¿›ä¸€æ­¥åŠ å¤§äº†å»¶æ—¶çš„è¯¯å·®ã€‚è€Œä¸”è®¡æ—¶å™¨å›è°ƒä¹Ÿåªä¼šåœ¨æ¸²æŸ“ä¸»çº¿ç¨‹ç©ºé—²æ—¶æ‰§è¡Œï¼Œå¦‚æœå»¶æ—¶ä»»åŠ¡ä¹‹å‰æœ‰ä¸€ä¸ªå¾ˆé•¿çš„ js åŒæ­¥é˜»å¡ï¼Œä¹Ÿä¼šé€ æˆå®šæ—¶ä¸å‡†ç¡®ã€‚\n\n\nChrome å…³äºæœ€å°å»¶æ—¶çš„æºç ï¼š\n\n![image.png](/img/posts/2023-10-12/2023-10-12-10.png)\n\n\n\n----\n\n## 4. ç»ƒä¸€ç»ƒ\n\nä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„ç†å¿µï¼Œå£ç®—ä¸€ä¸‹è¾“å‡ºæ˜¯ä»€ä¹ˆå§ï¼\n\n\n```js\nfunction test() {\n  console.log(1);\n  Promise.resolve().then(function() {\n    console.log(2);  \n  });\n}\n\nsetTimeout(function() {\n  console.log(3);\n  Promise.resolve().then(test);\n});\n\nPromise.resolve().then(function() {\n  console.log(4);\n  setTimeout(() =\u003e {\n    console.log(5);\n  });\n});\n\nconsole.log(6);\n```"])</script><script>self.__next_f.push([1,"23:T12d6,"])</script><script>self.__next_f.push([1,"æœ¬æœŸæ¥è®²è§£ä¸€ä¸‹ react-dom åº“ä¸­ç”¨äºå®¢æˆ·ç«¯æ¸²æŸ“çš„ API ä»¬ã€‚\n\n## 1. çº¯å®¢æˆ·ç«¯æ¸²æŸ“ createRoot\n\ncreateRoot ç”¨äºå®¢æˆ·ç«¯åˆ›å»º React æ¸²æŸ“çš„æ ¹èŠ‚ç‚¹ã€‚ï¼ˆæœåŠ¡ç«¯æ¸²æŸ“æ— æ•ˆï¼‰\n\nè¿™é‡Œä¸»è¦ä»‹ç»ä½¿ç”¨æ–¹å¼ã€‚\n\n### ä½¿ç”¨æ–¹å¼ \n\n1. åˆå§‹åŒ–ä¸€ä¸ª React é¡¹ç›®\n\n```js\nimport { createRoot } from 'react-dom/client';\nimport App from './App.js';\nimport './styles.css';\n\nconst root = createRoot(document.getElementById('root'));\nroot.render(\u003cApp /\u003e);\n```\n\nä¸Šé¢çš„äººä»£ç ï¼ŒcreateRoot è·å–ä¸€ä¸ªçœŸå®çš„ DOM å…ƒç´ å¯¹è±¡æœ¬èº«ä½œä¸ºå…¥å‚ï¼Œè¿”å› React æ¸²æŸ“æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œä»–æœ‰ `render` å’Œ `unmount` ä¸¤ä¸ªæ–¹æ³•ã€‚ä»–ä½œä¸ºé¡¹ç›®çš„å…¥å£ï¼Œåªå»ºè®®ä½¿ç”¨ä¸€æ¬¡ã€‚\n\nå…¶æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š\n\n- æŸ¥æ‰¾ HTML ä¸­ä¼ å…¥çš„ DOM node.\n- åœ¨è¯¥ DOM ä¸­æ”¾ç½®ç»„ä»¶ App ï¼ˆä¼šæ¸…ç©ºå·²æœ‰å…ƒç´ ï¼‰\n\n2. é¡¹ç›®ä¸­éƒ¨åˆ†æ¸²æŸ“\n\næ¯”å¦‚é¡¹ç›®ä¸­æœ‰ä¸€ä¸ª html é¡µé¢ï¼š\n\n```html\n\u003cnav id=\"navigation\"\u003e\u003c/nav\u003e\n\u003cmain\u003e\n  \u003cp\u003eThis paragraph is not rendered by React (open index.html to verify).\u003c/p\u003e\n  \u003csection id=\"comments\"\u003e\u003c/section\u003e\n\u003c/main\u003e\n```\n\næˆ‘ä»¬å¼•å…¥ä¸€ä¸ªjsæ–‡ä»¶ï¼š\n\n```js\nconst navDomNode = document.getElementById('navigation');\nconst navRoot = createRoot(navDomNode); \nnavRoot.render(\u003cNavigation /\u003e);\n\nconst commentDomNode = document.getElementById('comments');\nconst commentRoot = createRoot(commentDomNode); \ncommentRoot.render(\u003cComments /\u003e);\n```\nè¿™æ ·ï¼Œåœ¨ nav å’Œ main ä¸­å°±å„è‡ªäº§ç”Ÿäº†ä¸€ä¸ª React çš„æ¸²æŸ“æ ‘ï¼š\n\n\n![image.png](/img/posts/2023-9-17/2023-9-17-1.png)\n\nå¦‚æœä½ æƒ³è¦æ’¤é”€ä¸Šè¿°æ¸²æŸ“å·¥ä½œï¼Œå¯ä»¥è¿™æ ·å†™ï¼š\n\n```js\nroot.unmount();\n```\n\n3. æ›´æ–°å·²ç»æ¸²æŸ“è¿‡çš„Reactæ ‘\n\nå·²ç»åˆ›å»ºå‡ºæ¥çš„ rootï¼Œå¦‚æœæƒ³è¦æ›¿æ¢å…¶æ¸²æŸ“å†…å®¹ï¼Œå¯ä»¥è¿™æ ·ï¼š\n\n```js\nroot.render(\u003cApp counter={i} /\u003e);\n```\n\nè¿™ä¼šé”€æ¯åŸæ¥çš„æ¸²æŸ“ï¼Œè€Œé‡æ–°å»ºç«‹æ–°çš„æ¸²æŸ“æ ‘ã€‚ä¸‹é¢çš„ä¾‹å­å°±æ˜¯åˆ©ç”¨è¿™ç§åŸç†å®ç°çš„é¡µé¢è®¡æ—¶å™¨ï¼š\n\n```js\nsetInterval(() =\u003e {\n  root.render(\u003cApp counter={i} /\u003e);\n  i++;\n}, 1000);\n```\næ¯è¿‡ä¸€ç§’å°±åˆ·æ–°ä¸€ä¸‹é¡µé¢æ¸²æŸ“çš„ç»„ä»¶ã€‚\n\n\n## 2. æ°´åˆæœåŠ¡ç«¯æ¸²æŸ“ä»£ç  hydrateRoot\n\n`hydrate`Â çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨å®¢æˆ·ç«¯æ¥ç®¡ä»æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„åº”ç”¨ç¨‹åºï¼Œå¹¶å°†åº”ç”¨ç¨‹åºçš„çŠ¶æ€ä¸æœåŠ¡å™¨ç«¯ä¿æŒä¸€è‡´ã€‚\n\nåœ¨ä¼ ç»Ÿçš„ SSR è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨ç«¯ä¼šæ¸²æŸ“å‡º HTML å­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚ç„¶åï¼Œå®¢æˆ·ç«¯çš„ JavaScript ä»£ç ä¼šæ¥ç®¡è¿™ä¸ªå·²ç»æ¸²æŸ“å¥½çš„é¡µé¢ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº¤äº’å¤„ç†ã€‚ä½†æ˜¯ï¼Œåœ¨å®¢æˆ·ç«¯æ¥ç®¡é¡µé¢ä¹‹å‰ï¼Œç”¨æˆ·å¯èƒ½ä¼šçœ‹åˆ°ä¸€ä¸ªç©ºç™½å±å¹•æˆ–è€…ä¸å®Œå…¨æ¸²æŸ“çš„é¡µé¢ï¼Œè¿™è¢«ç§°ä¸ºâ€œé—ªçƒâ€ç°è±¡ã€‚\n\n`hydrate`Â æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„ HTML ä¸­æ’å…¥ä¸€äº›ç‰¹æ®Šçš„æ³¨é‡Šï¼ˆç§°ä¸ºâ€œhydration markersâ€ï¼‰ï¼Œè¿™äº›æ³¨é‡ŠåŒ…å«äº†å®¢æˆ·ç«¯ JavaScript éœ€è¦çš„ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€ç»„ä»¶çš„ç±»å‹ç­‰ç­‰ã€‚å½“å®¢æˆ·ç«¯åŠ è½½é¡µé¢æ—¶ï¼Œå®ƒä¼šæŸ¥æ‰¾è¿™äº›æ³¨é‡Šï¼Œå¹¶ä½¿ç”¨è¿™äº›ä¿¡æ¯æ¥æ¢å¤åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œä»è€Œå¿«é€Ÿæ¥ç®¡é¡µé¢ï¼Œå¹¶å‡å°‘â€œé—ªçƒâ€ç°è±¡ã€‚\n\nä½¿ç”¨Â `hydrate`ï¼ˆæ°´åˆï¼‰Â æ–¹æ³•ï¼Œå¯ä»¥ä½¿ SSR çš„åº”ç”¨ç¨‹åºæ›´åŠ æµç•…åœ°è¿‡æ¸¡åˆ°å®¢æˆ·ç«¯ï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€‚\n\n### ä½¿ç”¨æ–¹å¼\n\n1. æ¥æ”¶æœåŠ¡ç«¯è¿‡æ¥çš„ html\n\næˆ‘ä»¬å‡è®¾ä¸€æ®µæœåŠ¡ç«¯è¿‡æ¥çš„ä»£ç ï¼š\n\n```html\n\u003c!--\n  HTML content inside \u003cdiv id=\"root\"\u003e...\u003c/div\u003e\n  was generated from App by react-dom/server.\n--\u003e\n\u003cdiv id=\"root\"\u003e\u003ch1\u003eHello, world!\u003c/h1\u003e\u003cbutton\u003eYou clicked me \u003c!-- --\u003e0\u003c!-- --\u003e times\u003c/button\u003e\u003c/div\u003e\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸ª id å«åš root çš„æ ¹å…ƒç´ ï¼Œæˆ‘ä»¬å°±åœ¨å…¥å£æ–‡ä»¶ä¸­æ¸²æŸ“ï¼š\n\n```js\nimport { hydrateRoot } from 'react-dom/client';\nimport App from './App.js';\n\nhydrateRoot(\n  document.getElementById('root'),\n  \u003cApp /\u003e\n);\n```\n\nè¿™é‡Œ App è¿™ä¸ªç»„ä»¶åœ¨ æœåŠ¡ç«¯è¿”å›çš„ html ä¸­å°±æœ‰æ¸²æŸ“å¥½çš„ç‰ˆæœ¬ï¼ŒReact ä¼šæ ¹æ®ä¼ è¿›æ¥çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ˆAppæºç ï¼‰é‡æ„æ¸²æŸ“æ ‘è¿›è¡Œæ¸²æŸ“ã€‚\n\n2. å¤„ç†æ°´åˆæ—¶çš„å·®å¼‚é”™è¯¯\n\nå¦‚æœå•ä¸ªå…ƒç´ çš„å±æ€§æˆ–æ–‡æœ¬å†…å®¹åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´ä¸å¯é¿å…åœ°å­˜åœ¨å·®å¼‚ï¼ˆä¾‹å¦‚æ—¶é—´æˆ³ï¼‰ï¼Œæ‚¨å¯ä»¥ç¦æ­¢æ°´åˆä¸åŒ¹é…çš„è­¦å‘Šã€‚è¦ç¦æ­¢æŸä¸ªå…ƒç´ çš„æ°´åˆè­¦å‘Šï¼Œè¯·æ·»åŠ  `suppressHydrationWarning={true}`ï¼š\n\n```js\nhydrateRoot(document.getElementById('root'), \u003cApp /\u003e);\n```\n\n3. åŒºåˆ†æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„ä¸åŒ\n\nå¦‚æœä½ ç¡®å®éœ€è¦åœ¨å®¢æˆ·ç«¯æ¸²æŸ“ä¸€äº›ä¸æœåŠ¡ç«¯ä¸åŒçš„ä¸œè¥¿ã€‚ å¯ä»¥åœ¨å®¢æˆ·ç«¯é‡Œè¿™æ ·å†™ï¼š\n\n```js\nexport default function App() {\n  const [isClient, setIsClient] = useState(false);\n\n  useEffect(() =\u003e {\n    setIsClient(true);\n  }, []);\n\n  return (\n    \u003ch1\u003e\n      {isClient ? 'Is Client' : 'Is Server'}\n    \u003c/h1\u003e\n  );\n}\n```\n\nè¿™æ ·ï¼Œåœ¨æ°´åˆçš„è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šé’ˆå¯¹æ€§çš„æ¸²æŸ“äº†ã€‚è¿™ç§æ–¹å¼å°±æ˜¯è¯´å¯ä»¥åœ¨ SSR çš„åŸºç¡€ä¸Šï¼Œå®¢æˆ·ç«¯å†å¢é‡æ›´æ–°åªéœ€è¦å®¢æˆ·ç«¯æ¸²æŸ“çš„å†…å®¹ï¼Œæ¯”å¦‚ä¸Šé¢æåˆ°çš„è®¡æ•°å™¨ç­‰ã€‚"])</script><script>self.__next_f.push([1,"24:T1a16,"])</script><script>self.__next_f.push([1,"## 1. createPortal\n\ncreatePortal ç”¨äºæ‰‹åŠ¨æ¸²æŸ“åŠ¨æ€ç»„ä»¶ã€‚\n\n### æ¥å—å‚æ•°\n\n-   `children`: ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯ä»¥è¢« render çš„ React DOM.\n-   `domNode`: ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªçœŸå®çš„ DOM èŠ‚ç‚¹ï¼Œç”¨äºå½“åšæ¸²æŸ“çš„çˆ¶å®¹å™¨.\n-   å¯é€‰é¡¹ `key`: ç¬¬ä¸‰ä¸ªå‚æ•°å¯é€‰ï¼Œä½œä¸ºåŠ¨æ€ç»„ä»¶çš„ key.\n\n### è¿”å›å€¼\n\n`createPortal`è¿”å›ä¸€ä¸ª React node. åœ¨æ¸²æŸ“æ—¶ï¼ŒReact ä¼šå°†æŒ‡å®šçš„æ¸²æŸ“ç»„ä»¶æ”¾ç½®åœ¨æŒ‡å®šçš„ DOM å®¹å™¨ï¼ˆdomNodeï¼‰å†…ã€‚\n\n### æ³¨æ„äº‹é¡¹\n\n-   ä½¿ç”¨ createPortal æ˜¯ä¼šäº‹ä»¶å†’æ³¡çš„. ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ åœ¨ portal å†…éƒ¨ç‚¹å‡»é¼ æ ‡, è¿™ä¸ª portal åˆè¢« `\u003cdiv onClick\u003e` åŒ…è£¹, åˆ™ `onClick` äº‹ä»¶ä¹Ÿä¼šè¢«è§¦å‘. \n\n### ä½¿ç”¨æ¡ˆä¾‹\n\n1. å¾€åˆ«çš„ div é‡Œæ¸²æŸ“ä¸€ä¸ªç»„ä»¶\n\n```jsx\nexport default function MyComponent() {\n  return (\n    \u003cdiv style={{ border: '2px solid black' }}\u003e\n      \u003cp\u003eThis child is placed in the parent div.\u003c/p\u003e\n      {createPortal(\n        \u003cp\u003eThis child is placed in the document body.\u003c/p\u003e,\n        document.body\n      )}\n    \u003c/div\u003e\n  );\n}\n```\nçœ‹çœ‹ç•Œé¢ï¼Œç¡®å®æ¸²æŸ“åœ¨ body ä¸‹ï¼ŒåŸæ¥çš„ä½ç½®ç©ºç©ºå¦‚ä¹Ÿï¼š\n\n\n![image.png](/img/posts/2023-9-15/2023-9-15-1.png)\n\n2. å®ç°ä¸€ä¸ªå¼¹çª—\n\nå¦‚æœä½ å†™è¿‡ UI åº“ï¼Œä¸Šé¢çš„ DOM ç»“æ„ä½ å¯èƒ½ä¼šæ¯”è¾ƒç†Ÿæ‚‰ï¼Œè¿™å°±æ˜¯å¼¹å‡ºå±‚ç»„ä»¶å¸¸ç”¨çš„æ’å…¥æ–¹å¼ã€‚æˆ‘ä»¬å°±ç”¨ä¸Šé¢çš„åŸç†ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„å¼¹çª—ï¼Œ\n\n```js\nexport default function PortalExample() {\n  const [showModal, setShowModal] = useState(false);\n  return (\n    \u003c\u003e\n      \u003cbutton onClick={() =\u003e setShowModal(true)}\u003e\n        Show modal using a portal\n      \u003c/button\u003e\n      {showModal \u0026\u0026 createPortal(\n        \u003cModalContent onClose={() =\u003e setShowModal(false)} /\u003e,\n        document.body\n      )}\n    \u003c/\u003e\n  );\n}\n```\nå¦‚æœä¸ä½¿ç”¨ createPortalï¼Œåœ¨ showModal æ—¶ï¼ŒModalContent ç»„ä»¶ä¼šè¿½åŠ åœ¨æŒ‰é’®ä¸‹é¢ï¼Œå¦‚æœè®¾ç½®äº†ç»å¯¹å®šä½åï¼Œä¹Ÿåªæ˜¯é’ˆå¯¹ä¸Šä¸€çº§ç»„ä»¶çš„åç§»ï¼Œè€Œå¼¹çª—ç†åº”æ˜¯ä¸ªå…¨å±€æ€§çš„ç»„ä»¶ã€‚æˆ‘ä»¬çœ‹çœ‹è¿è¡Œæ•ˆæœï¼š\n\n\n![image.png](/img/posts/2023-9-15/2023-9-15-2.png)\n\n\n3. æœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼Œå¾€ç‹¬ç«‹çš„ html ä¸­æ¸²æŸ“\n\næœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼Œä¼šå­˜åœ¨è„±ç¦» React ç¯å¢ƒçš„é¡µé¢ (æ¯”å¦‚ React root åªä½œä¸º web é¡¹ç›®çš„ä¸€éƒ¨åˆ†æ—¶)ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥å®ç°æ¸²æŸ“ï¼š\n\n```js\nconst sidebarContentEl = document.getElementById('sidebar-content');\n\n...\n\u003c\u003e\n  \u003cMainContent /\u003e\n  {createPortal(\n    \u003cSidebarContent /\u003e,\n    sidebarContentEl\n  )}\n\u003c/\u003e\n```\n\n4. **å°†åªæ”¯æŒ js å¼•å…¥æ–¹å¼çš„ç¬¬ä¸‰æ–¹åº“æ¸²æŸ“ä¸º React ç»„ä»¶**\n\næœ‰çš„ç¬¬ä¸‰æ–¹åº“åªæä¾›äº† js å¼•å…¥æ–¹å¼ï¼Œæ¯”å¦‚ åœ°å›¾ç»„ä»¶ leafletï¼š\n\n```js\n// map-widget.js\nimport 'leaflet/dist/leaflet.css';\nimport * as L from 'leaflet';\n\nexport function createMapWidget(containerDomNode) {\n  const map = L.map(containerDomNode);\n  map.setView([0, 0], 0);\n  L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {\n    maxZoom: 19,\n    attribution: 'Â© OpenStreetMap'\n  }).addTo(map);\n  return map;\n}\n\nexport function addPopupToMapWidget(map) {\n  const popupDiv = document.createElement('div');\n  L.popup()\n    .setLatLng([0, 0])\n    .setContent(popupDiv)\n    .openOn(map);\n  return popupDiv;\n}\n```\n\nä¸Šé¢çš„ä¸¤ä¸ªå‡½æ•°éƒ½ä¸æ˜¯ç»„ä»¶ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨Reactç»„ä»¶ä¸­ç›´æ¥å¼•ç”¨ã€‚\n\nçœ‹ä¸‹é¢çš„å¤„ç†ï¼š\n\n```js\nimport { useRef, useEffect, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport { createMapWidget, addPopupToMapWidget } from './map-widget.js';\n\nexport default function Map() {\n  const containerRef = useRef(null);\n  const mapRef = useRef(null);\n  const [popupContainer, setPopupContainer] = useState(null);\n\n  useEffect(() =\u003e {\n    if (mapRef.current === null) {\n      const map = createMapWidget(containerRef.current);\n      mapRef.current = map;\n      const popupDiv = addPopupToMapWidget(map);\n      setPopupContainer(popupDiv);\n    }\n  }, []);\n\n  return (\n    \u003cdiv style={{ width: 250, height: 250 }} ref={containerRef}\u003e\n      {popupContainer !== null \u0026\u0026 createPortal(\n        \u003cp\u003eHello from React!\u003c/p\u003e,\n        popupContainer\n      )}\n    \u003c/div\u003e\n  );\n}\n```\n\nä¸Šé¢çš„ä»£ç ï¼Œä½¿ç”¨ React çŠ¶æ€ popupContainer æ¥å—äº†åœ°å›¾è¿”å›çš„å®¹å™¨ divï¼Œå¹¶åŒ…è£¹åœ¨ç»„ä»¶ Map ä¸­è¿”å›ã€‚å¦‚æ­¤ï¼Œè¿™ä¸ªç»„ä»¶å°±å¯ä»¥è¢«å¤–éƒ¨ç»„ä»¶è°ƒç”¨äº†ã€‚\n\n## 2. flushSync\n\nflushSync ç”¨äºå¼ºåˆ¶åˆ·æ–° React æ‰€æœ‰å·²ç»æŒ‚èµ·çš„æ¸²æŸ“å·¥ä½œï¼Œå¹¶åŒæ­¥æ›´æ–°ç»„ä»¶æ ‘ã€‚\n\nåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒReact ä½¿ç”¨å¼‚æ­¥æ›´æ–°ç­–ç•¥ï¼Œè¿™æ„å‘³ç€åœ¨è°ƒç”¨ `setState` æˆ– `forceUpdate` ç­‰æ›´æ–°æ–¹æ³•åï¼ŒReact å°†åœ¨äº‹ä»¶å¾ªç¯çš„å½“å‰è¿­ä»£ä¸­æ‰¹é‡æ›´æ–°ç»„ä»¶ï¼Œè€Œä¸æ˜¯ç«‹å³æ›´æ–°ï¼ˆå¯ä»¥äº†è§£ä¸€ä¸‹ fiber çš„è°ƒåº¦åŸç†ï¼‰ã€‚è¿™ç§å¼‚æ­¥æ›´æ–°ç­–ç•¥å¯ä»¥æé«˜æ€§èƒ½ï¼Œä½†æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ç«‹å³æ›´æ–°ç»„ä»¶ï¼Œè¿™å°±æ˜¯ `flushSync` çš„ç”¨é€”ã€‚\n\n`flushSync` æ–¹æ³•å¯ä»¥å¼ºåˆ¶ React ç«‹å³æ‰§è¡Œå½“å‰æ‰¹æ¬¡çš„æ‰€æœ‰æ›´æ–°ï¼Œè€Œä¸æ˜¯ç­‰å¾…äº‹ä»¶å¾ªç¯çš„ä¸‹ä¸€ä¸ªè¿­ä»£ã€‚\n\n\u003e æ»¥ç”¨ä¼šæŸå®³æ€§èƒ½ï¼Œæœ€å¥½ä¸ç”¨ã€‚\n\n### æ¥å—å‚æ•°\n\n-   `callback`: æ¥å—ä¸€ä¸ªå‡½æ•°ã€‚ä¼šç«‹å³è¢«è°ƒç”¨ï¼Œå¹¶åˆ·æ–°çŠ¶æ€ã€‚åŒæ—¶ä¹Ÿä¼šåˆ·æ–°é˜»å¡çš„æ›´æ–°ä»»åŠ¡ã€å‰¯ä½œç”¨ç­‰ã€‚\n\n### æ³¨æ„äº‹é¡¹\n\n-   `flushSync`Â ä¼šæ˜¾è‘—å½±å“æ€§èƒ½.\n-   `flushSync`Â å¯èƒ½å¼ºåˆ¶é˜»å¡ Suspense ç»„ä»¶ï¼Œä»¥è‡³äº fallback æ— æ³•æ˜¾ç¤º.\n\n### ä½¿ç”¨æ¡ˆä¾‹\n\n1. åŒä¸€å‘¨æœŸå†…æ¸²æŸ“çš„é—®é¢˜\n\næœ‰æ—¶å€™æƒ³è¦åœ¨åŒä¸€ä¸ªæ¸²æŸ“å‘¨æœŸå†…è·å–åˆ°æœ€æ–°çš„ state çš„å€¼ï¼Œæ¯”å¦‚ä¸‹é¢çš„æ‰“å°æœºçš„ä¾‹å­ï¼š\n\n```js\nimport { useState, useEffect } from 'react';\n\nexport default function PrintApp() {\n  const [isPrinting, setIsPrinting] = useState(false);\n\n  useEffect(() =\u003e {\n    function handleBeforePrint() {\n      setIsPrinting(true);\n    }\n\n    function handleAfterPrint() {\n      setIsPrinting(false);\n    }\n\n    window.addEventListener('beforeprint', handleBeforePrint);\n    window.addEventListener('afterprint', handleAfterPrint);\n    return () =\u003e {\n      window.removeEventListener('beforeprint', handleBeforePrint);\n      window.removeEventListener('afterprint', handleAfterPrint);\n    }\n  }, []);\n\n  return (\n    \u003c\u003e\n      \u003ch1\u003eisPrinting: {isPrinting ? 'yes' : 'no'}\u003c/h1\u003e\n      \u003cbutton onClick={() =\u003e window.print()}\u003e\n        Print\n      \u003c/button\u003e\n    \u003c/\u003e\n  );\n}\n```\nbeforeprint äº‹ä»¶åœ¨è°ƒç”¨æ‰“å°é¡µé¢æ—¶ä¼šè¢«ç«‹å³è°ƒç”¨ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°ï¼Œåœ¨ç•Œé¢ä¸Šï¼ŒisPrinting å´æ˜¯ noã€‚è¿™æ˜¯å› ä¸ºæ›´æ–° state çš„ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—åï¼Œæ‰“å°å¼¹çª—æ‰“å¼€äº†ï¼Œé˜»å¡äº†ä»»åŠ¡ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼ºåˆ¶æ¸²æŸ“ï¼š\n\n```js\nfunction handleAfterPrint() {\n  flushSync(() =\u003e {\n    setIsPrinting(false);\n  })\n}\n```\n\nè¿™æ ·ï¼Œå°±ä¼šåœ¨æ‰“å°å¼¹çª—æ‰“å¼€çš„åŒæ—¶ï¼ŒåŒæ­¥æ¸²æŸ“ UI äº†ã€‚\n\n----\n\nåˆ°è¿™é‡Œï¼Œå¸¸è§„çš„ API å°±ä»‹ç»å®Œäº†ï¼Œä¹‹åçš„ç³»åˆ—æ–‡ç« å°±å¼€å§‹ä»‹ç»å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯æ¸²æŸ“çš„ç›¸å…³APIäº†ï¼Œæ•¬è¯·æœŸå¾…~~"])</script><script>self.__next_f.push([1,"25:T1a9d,"])</script><script>self.__next_f.push([1,"å®˜ç½‘åœ°å€ï¼š[React](https://react.dev/)\n\n## 1. memo\n\nç»„ä»¶çº§åˆ«çš„ç¼“å­˜å‡½æ•°ï¼Œä½¿ç”¨å®ƒåŒ…è£¹çš„ç»„ä»¶ç»„æˆçš„æ–°ç»„ä»¶å¯ä»¥åœ¨ props æ²¡æœ‰å˜åŒ–æ—¶é˜»æ­¢é‡æ¸²æŸ“ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚ç±»ä¼¼äºVueçš„ keepAliveã€‚\n\n### æ¥å—å‚æ•°\n\n- æ¥å—ä¸€ä¸ª react ç»„ä»¶ã€‚`memo` ä¸ä¼šæ”¹å˜è¿™ä¸ªç»„ä»¶æœ¬èº«çš„å±æ€§ï¼Œä»»ä½•æœ‰æ•ˆçš„ React ç»„ä»¶ï¼ŒåŒ…æ‹¬å‡½æ•°å’Œ `forwardRef` ç»„ä»¶ï¼Œéƒ½å¯ä»¥è¢«æ¥å—ã€‚\n- ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯é€‰å‚æ•°ï¼šç»„ä»¶ä»¥å‰çš„ props å’Œå®ƒçš„æ–° propsã€‚\n\n### è¿”å›å€¼\n\n`memo` è¿”å›ä¸€ä¸ªæ–°çš„ React ç»„ä»¶ã€‚å®ƒçš„è¡Œä¸ºä¸æä¾›ç»™çš„ç»„ä»¶ç›¸åŒï¼Œåªæ˜¯ React ä¸ä¼šæ€»æ˜¯åœ¨å…¶çˆ¶çº§è¢«é‡æ–°æ¸²æŸ“æ—¶æ‰§è¡Œé‡æ–°æ¸²æŸ“ï¼Œé™¤éå®ƒçš„ props å‘ç”Ÿäº†å˜åŒ–ï¼ˆObject.is æ¯”è¾ƒï¼‰ã€‚\n\n### æ³¨æ„äº‹é¡¹\n\n**memo ä¸æ˜¯ä¸‡èƒ½çš„ï¼š**\n\n1.  å½“ä¸€ä¸ªç»„ä»¶åœ¨åŒ…è£…å…¶ä»–ç»„ä»¶æ—¶ï¼Œè®©å®ƒæ¥å— JSX ä½œä¸ºå­ç»„ä»¶ã€‚è¿™æ ·ï¼Œå½“çˆ¶ç»„ä»¶æ›´æ–°è‡ªå·±çš„çŠ¶æ€æ—¶ï¼Œéœ€è¦è®© React çŸ¥é“å®ƒçš„å­ç»„ä»¶æ˜¯å¦ä¸éœ€è¦é‡æ–°æ¸²æŸ“æ—¶ï¼Œä½ æ‰è¦è€ƒè™‘ä½¿ç”¨ memoã€‚\n2. æ›´æ¨èä½¿ç”¨ç»„ä»¶çº§åˆ«çš„ stateï¼Œè€Œä¸è¦æŠŠæ‰€æœ‰çŠ¶æ€éƒ½ç»´æŠ¤åœ¨é¡¶çº§ç»„ä»¶ï¼Œå†å¤§é‡ä½¿ç”¨ memo æ¥æŒ½å›æ€§èƒ½ã€‚\n3. ä¿æŒç»„ä»¶çš„çº¯å‡€æ€§ã€‚å¦‚æœä½ çš„ç»„ä»¶å¤šæ¬¡æ¸²æŸ“è¿”å›çš„ä¸åŒçš„çŠ¶æ€ï¼Œä½ åº”è¯¥è®¸ä¿®å¤ä½ ç»„ä»¶çš„ bugï¼Œè€Œä¸æ˜¯åŠ ä¸€ä¸ª memoã€‚\n4. é¿å…ä¸å¿…è¦çš„çŠ¶æ€æ›´æ–°ï¼Œè¿™äº›æ›´æ–°æœ‰æ—¶å€™ä¼šé€ æˆå­ç»„ä»¶åå¤æ¸²æŸ“ã€‚\n5. åˆ é™¤ useEffect ä¸­ä¸å¿…è¦çš„ä¾èµ–é¡¹ï¼Œä»–æœ‰æ—¶å€™ä¹Ÿä¼šé€ æˆè¿‡å¤šçš„æ¸²æŸ“ã€‚\n6. props å¦‚æœæ˜¯å‡½æ•°ï¼Œçˆ¶ç»„ä»¶åº”å°†è¯¥å‡½æ•°ç¼“å­˜ï¼ˆuseCallbackç­‰ï¼‰ï¼Œå¦åˆ™çˆ¶ç»„ä»¶æ¸²æŸ“ï¼Œè¯¥å‡½æ•°å¼•ç”¨ä¼šå˜åŒ–ï¼Œå¯¼è‡´å­ç»„ä»¶çš„ memo å¤±æ•ˆã€‚\n\n### ä½¿ç”¨æ¡ˆä¾‹\n\n1. éƒ¨åˆ†å±æ€§å˜åŒ–æ›´æ–°ç»„ä»¶\n\nReact ç»„ä»¶éƒ½æ˜¯çº¯å‡½æ•°ï¼Œæˆ–è€…è¯´åº”è¯¥æ˜¯çº¯å‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥è®¤ä¸º props æ²¡æœ‰å˜åŒ–çš„æ—¶å€™ï¼Œå…¶è¾“å‡ºä¹Ÿä¸åº”è¯¥å˜åŒ–ã€‚è¿™å°±æ˜¯ memo èƒ½å¤Ÿç¼“å­˜è€Œä¸é€ æˆé”™ä¹±çš„ç†è®ºåŸºç¡€ã€‚ \n\nä¸‹é¢çš„ä¾‹å­ï¼Œåªè¦å…¥å‚ name æ²¡æœ‰å˜åŒ–ï¼ŒGreeting ç»„ä»¶å†…éƒ¨æ˜¯ä¸ä¼šé‡æ–°æ¸²æŸ“çš„ã€‚\n\n```js\nconst Greeting = memo(function Greeting({ name }) {\n  return \u003ch1\u003eHello, {name}!\u003c/h1\u003e;\n});\n\nexport default Greeting;\n\n// å…¶ä»–ç»„ä»¶å¼•ç”¨\n\u003cGreeting name={name} /\u003e\n```\n\n2. ä¸ context ç»“åˆçš„ç¼“å­˜\n\nä¸‹é¢çš„ä¾‹å­ï¼Œå­ç»„ä»¶ Greeting æ˜¯ä¸€ä¸ªä½¿ç”¨äº†memåŒ…è£¹çš„ç»„ä»¶ï¼Œä½†æ˜¯å½“çˆ¶ç»„ä»¶å±æ€§ theme å˜åŒ–æ—¶ï¼Œè¿˜æ˜¯ä¼šå¼•èµ·å­ç»„ä»¶é‡æ¸²æŸ“ã€‚ \n\n```js\nexport default function MyApp() {\n  const [theme, setTheme] = useState('dark');\n\n  function handleClick() {\n    setTheme(theme === 'dark' ? 'light' : 'dark'); \n  }\n\n  return (\n    \u003cThemeContext.Provider value={theme}\u003e\n      \u003cbutton onClick={handleClick}\u003e\n        Switch theme\n      \u003c/button\u003e\n      \u003cGreeting name=\"Taylor\" /\u003e\n    \u003c/ThemeContext.Provider\u003e\n  );\n}\n```\nè‹¥è¦ä½¿ç»„ä»¶ä»…åœ¨æŸäº› context å±æ€§æ”¹å˜æ—¶é‡æ–°æ¸²æŸ“ï¼Œè¯·å°†ç»„ä»¶ä¸€åˆ†ä¸ºäºŒã€‚ä»å¤–éƒ¨ç»„ä»¶çš„ context ä¸­è¯»å–æ‚¨éœ€è¦çš„å†…å®¹ï¼Œå¹¶å°†å…¶ä½œä¸º props ä¼ é€’ç»™è®°å¿†çš„å­ç»„ä»¶ã€‚\n\n3. ç»„ä»¶è§„èŒƒï¼šå°½é‡å‡å°‘ç»„ä»¶æˆå‘˜çš„åå¤å˜åŒ–\n\nReact çš„é‡æ¸²æŸ“åˆ¤æ–­éƒ½æ˜¯ä½¿ç”¨ Object.is æ¥åˆ¤æ–­çš„ï¼Œä½†æ˜¯ `Object.is({}, {})` å¯æ˜¯ä¼šè¿”å› false çš„ã€‚æ‰€ä»¥ç»„ä»¶çš„äººæˆå‘˜æ–¹æ³•åº”è¯¥åšå¿…è¦çš„ç¼“å­˜ï¼Œè®©ç»„ä»¶åœ¨é‡æ¸²æŸ“æ—¶è¿™ä¸ªæ–¹æ³•è¿˜èƒ½ä¿æŒè¿‡å»çš„å†…å­˜å¼•ç”¨ã€‚\n\n```js\nfunction Page() {\n  const [name, setName] = useState('Taylor');\n  const [age, setAge] = useState(42);\n\n  const person = useMemo(\n    () =\u003e ({ name, age }),\n    [name, age]\n  );\n\n  return \u003cProfile person={person} /\u003e;\n}\n\nconst Profile = memo(function Profile({ person }) {\n  // ...\n});\n```\nä¸Šé¢çš„ä¾‹å­ï¼Œperson è¢«ç¼“å­˜äº†ï¼Œå½“Pageç»„ä»¶é‡æ¸²æŸ“æ—¶ï¼Œä¸ä¼šå› ä¸º person çš„å†…å­˜å¼•ç”¨å˜åŒ–äº†è€Œå¯¼è‡´ Profile ä¸å¿…è¦çš„æ¸²æŸ“ã€‚\n\n4. ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°æ¥æ¯”å¯¹ props\n\næˆ‘ä»¬å†™ä¸ªè‡ªå®šä¹‰çš„å‡½æ•°æ¥æ¯”å¯¹ propsï¼Œä»è€Œå†³å®šæ˜¯å¦è¦é‡æ¸²æŸ“ã€‚æ­¤å‡½æ•°ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™å­ç»„ä»¶ã€‚ä»…å½“è¿”å› true æ—¶ä¸åšé‡æ¸²æŸ“ï¼Œå¦åˆ™å°±è¿›è¡Œé‡æ¸²æŸ“ã€‚\n\n```js\nconst Chart = memo(function Chart({ dataPoints }) {\n  // ...\n}, arePropsEqual);\n\nfunction arePropsEqual(oldProps, newProps) {\n  return (\n    oldProps.dataPoints.length === newProps.dataPoints.length \u0026\u0026\n    oldProps.dataPoints.every((oldPoint, index) =\u003e {\n      const newPoint = newProps.dataPoints[index];\n      return oldPoint.x === newPoint.x \u0026\u0026 oldPoint.y === newPoint.y;\n    })\n  );\n}\n```\nå½“ç”¨åˆ°è‡ªå®šä¹‰å‡½æ•°æ—¶ï¼Œä¸€å®šè¦æµ‹è¯•ä¸€ä¸‹æ˜¯å¦æ€§èƒ½æ¯”é»˜è®¤çš„æ¯”å¯¹æ–¹å¼æ›´å¥½ã€‚è¿™é‡Œè¾¹å‘æ¯”è¾ƒå¤šï¼Œå°½é‡é¿å…æ·±åº¦æ£€æŸ¥ï¼Œ**æ·±åº¦ç›¸ç­‰æ€§æ£€æŸ¥å¯èƒ½ä¼šä½¿ç»„ä»¶å˜å¾—éå¸¸æ…¢**ã€‚\n\n## 2. forwardRef\n\nforwardRef ä½¿ç»„ä»¶å‘çˆ¶ç»„ä»¶æš´éœ²å‡ºè‡ªå·±çš„ DOM ç»“æ„ã€‚\n\n### æ¥æ”¶å‚æ•°\n\n-  å‡½æ•°å¼ç»„ä»¶ã€‚React ä¼šåœ¨çˆ¶ç»„ä»¶ä¸­å¸¦ç€ props å’Œ ref è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚\n\n### è¿”å›å€¼\n\n- `forwardRef` è¿”å›åŸå‡½æ•°å¼ç»„ä»¶ï¼Œä¸è¿‡ä¼šåœ¨ props ä¸­å¸¦å…¥ ref ä¿¡æ¯ã€‚\n\n### ä½¿ç”¨æ¡ˆä¾‹\n\n1. çˆ¶ç»„ä»¶è·å–å­ç»„ä»¶ DOM å®ä¾‹\n\n```js\n// å­ç»„ä»¶\nconst MyInput = forwardRef(function MyInput(props, ref) {\n  const { label, ...otherProps } = props;\n  return (\n    \u003clabel\u003e\n      {label}\n      \u003cinput {...otherProps} ref={ref} /\u003e\n    \u003c/label\u003e\n  );\n});\n\n// çˆ¶ç»„ä»¶\nfunction Form() {\n  const ref = useRef(null);\n\n  function handleClick() {\n    ref.current.focus();\n  }\n\n  return (\n    \u003cform\u003e\n      \u003cMyInput label=\"Enter your name:\" ref={ref} /\u003e\n      \u003cbutton type=\"button\" onClick={handleClick}\u003e\n        Edit\n      \u003c/button\u003e\n    \u003c/form\u003e\n  );\n}\n```\nä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå­ç»„ä»¶å°† ref æ‰“åœ¨ input æ ‡ç­¾ä¸­ï¼Œå¹¶æš´éœ²å‡ºå»ï¼›çˆ¶ç»„ä»¶ä¸­ï¼ŒåŒæ ·ä½¿ç”¨ ref å±æ€§æ¥å—ã€‚`useRef` çš„ä½¿ç”¨ï¼Œå¯ä»¥å‚çœ‹ä¹‹å‰çš„æ–‡ç« ï¼š[useRef](https://juejin.cn/post/7249607108044357690#heading-14)\n\n\u003e ä½¿ç”¨ forwardRef å°±ç›¸å½“äº ref é€ä¼ ã€‚çˆ¶ç»„ä»¶ä¸­çš„ useRef ç›´æ¥æ‰“åœ¨å­ç»„ä»¶ä¸­çš„ input\n\n2. æ’­æ”¾å™¨æ§åˆ¶\n\nä¸Šé¢æ˜¯æ§åˆ¶æ–‡æœ¬æ¡†èšç„¦ï¼Œä¸‹é¢æ˜¯å¦å¤–çš„ H5 API çš„è°ƒç”¨ä¾‹å­ï¼Œçˆ¶ç»„ä»¶ä¸­æ§åˆ¶æ’­æ”¾å™¨ï¼š\n\n```js\n// å­ç»„ä»¶\n\u003cvideo width={width} ref={ref}\u003e\n  \u003csource\n    src={src}\n    type={type}\n  /\u003e\n\u003c/video\u003e\n\n// çˆ¶ç»„ä»¶\n\u003cbutton onClick={() =\u003e ref.current.play()}\u003e\n    Play\n\u003c/button\u003e\n```\n\n3. æš´éœ²å­ç»„ä»¶æˆå‘˜æ–¹æ³•\n\nuseImperativeHandle çš„ä½¿ç”¨å¯ä»¥å‚è§ [useImperativeHandle](https://juejin.cn/post/7249607108044357690#heading-21)\n\n```js\nconst MyInput = forwardRef(function MyInput(props, ref) {\n  const inputRef = useRef(null);\n\n  useImperativeHandle(ref, () =\u003e {\n    return {\n      focus() {\n        inputRef.current.focus();\n      },\n      scrollIntoView() {\n        inputRef.current.scrollIntoView();\n      },\n      handleClick() {\n        handleClick();\n      }\n    };\n  }, []);\n  \n  function handleClick() {\n    // è‡ªå®šä¹‰çš„æˆå‘˜æ–¹æ³•\n    alert('click');\n  }\n\n  return \u003cinput {...props} ref={inputRef} /\u003e;\n});\n```\nè¿™æ ·åœ¨çˆ¶ç»„ä»¶ä¸­å°±å¯ä»¥è¿™æ ·è°ƒç”¨äº†ï¼š`ref.current.scrollIntoView();`\n\n\n----\nå®Œ ï¼ï¼"])</script><script>self.__next_f.push([1,"26:T1449,"])</script><script>self.__next_f.push([1,"å®˜ç½‘åœ°å€ï¼š[React](https://react.dev/)\n\n## 1. startTransition\n\næˆ‘ä»¬åœ¨è®² [useTransition](https://juejin.cn/post/7268530145202700303) çš„ä¸€èŠ‚æˆ‘ä»¬è®²è¿‡ï¼Œé€šè¿‡ hook å¯ä»¥è·å–åˆ°è¿™ä¸ª APIï¼Œæ¨èç»“åˆ hook ä¸€èµ·ä½¿ç”¨ã€‚\n\nå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥å¼•å…¥ï¼š\n\n```js\nimport { startTransition } from 'react';\n\nfunction TabContainer() {\n  const [tab, setTab] = useState('about');\n\n  function selectTab(nextTab) {\n    startTransition(() =\u003e {\n      setTab(nextTab);\n    });\n  }\n  // ...\n}\n```\nä»–çš„ä½œç”¨æ˜¯é˜²æ­¢ UI é˜»å¡ï¼Œåšåˆ°å‰ç«¯å¼‚æ­¥éé˜»å¡æ¸²æŸ“ã€‚å…·ä½“ä½¿ç”¨æ–¹å¼è§ useTransitionã€‚\n\n### æ³¨æ„äº‹é¡¹\n\n-  `startTransition` ä¸ä¼šè¿½è¸ªæ¸²æŸ“ pending çš„çŠ¶æ€. æƒ³è¦è·å–æ¸²æŸ“å®æ—¶çŠ¶æ€ï¼Œè¯·ä½¿ç”¨ [`useTransition`](https://juejin.cn/post/7268530145202700303) .\n-  ä½¿ç”¨å®ƒåŒ…è£¹ state çš„ `set` å‡½æ•°æ¥å®ç°è·Ÿè¯¥ state ç›¸å…³çš„æ¸²æŸ“è¿‡æ¸¡ã€‚ å¦‚æœæƒ³è¦å“åº” props å˜åŒ–æ¥å®ç°æ¸²æŸ“è¿‡æ¸¡ï¼Œè¯·ä½¿ç”¨ [`useDeferredValue`](https://juejin.cn/post/7268530145202700303).\n-  `startTransition` å†…éƒ¨å‡½æ•°å¿…é¡»æ˜¯åŒæ­¥çš„.\n-  æ ‡è®°ä¸º transition çš„ state æ›´æ–°ä¼šè¢«å…¶ä»– state çš„æ›´æ–°æ‰“æ–­æ¸²æŸ“ï¼Œåœ¨å…¶ä»–æ¸²æŸ“è°ƒåº¦ç»“æŸåå†æ¬¡æƒ³é‡æ–°æ‰§è¡Œè¯¥æ¸²æŸ“.\n-  ä¸èƒ½ç”¨äºæ§åˆ¶æ–‡æœ¬è¾“å…¥ç»„ä»¶.\n-  å¦‚æœåŒæ—¶æœ‰å¤šä¸ªåœ¨è¿è¡Œçš„è¿‡æ¸¡ï¼ŒReact ä¼šæŠŠä»–ä»¬åˆå¹¶ä¸€èµ·å¤„ç†ã€‚è¿™ä¸ªæ–¹æ¡ˆä¼¼ä¹æ˜¯ä¸ªæ€§èƒ½ç¼ºé™·ï¼Œéšåçš„ç‰ˆæœ¬å¯èƒ½ä¼šä¿®å¤å®ƒã€‚\n\n## 2. createContext\n\né¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ª context å¯¹è±¡ï¼Œä¸€èˆ¬ç»“åˆ hook ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒæˆ‘ [useContext](https://juejin.cn/post/7249607108044357690) çš„æ–‡ç« ã€‚\n\nå®˜ç½‘çš„éƒ¨åˆ†æè¿°ä¸ useContext æœ‰é‡å¤ï¼Œè¿™é‡ŒåŠç›´æ¥è®²ä½¿ç”¨æ¡ˆä¾‹ã€‚\n\n### ä½¿ç”¨æ¡ˆä¾‹\n\n1. é…ç½®å…¨å±€å˜é‡\n\n```js\n// æ”¾åœ¨å…¨å±€ï¼Œåˆ›å»ºæ—¶çš„é»˜è®¤å€¼ä¸€èˆ¬å¯ä»¥ä¸ç”¨ä¼ é€’ï¼Œåœ¨ provider æ—¶ä¼šé…ç½®åˆå§‹å€¼çš„\nconst ThemeContext = createContext();  \nconst AuthContext = createContext();\n```\næˆ‘ä»¬å®šä¹‰ä¸»é¢˜ä¿¡æ¯å’Œè®¤è¯ä¿¡æ¯ï¼Œç”¨å®ƒåŒ…è£¹æ ¹ç»„ä»¶ï¼š\n\n```jsx\nconst [theme, setTheme] = useState('dark');\nconst [currentUser, setCurrentUser] = useState({ id: 1 });\n\n\u003cThemeContext.Provider value={theme}\u003e\n  \u003cAuthContext.Provider value={currentUser}\u003e\n    \u003cPage /\u003e\n  \u003c/AuthContext.Provider\u003e\n\u003c/ThemeContext.Provider\u003e\n```\n\nåœ¨åŒ…è£¹çš„å†…éƒ¨ç»„ä»¶ä¸­ï¼Œæ— è®ºå¤šæ·±çš„å±‚çº§ï¼Œéƒ½å¯ä»¥è¿™æ ·ä½¿ç”¨æ¥è·å– value å€¼ï¼š\n\n```js\nconst theme = useContext(ThemeContext); // dark\n```\n\n\u003e ç¡®ä¿ ThemeContext æ˜¯ä¸€å¼€å§‹å®šä¹‰çš„é‚£ä¸ªå•ä¾‹\n\nä»–è¸¢åŠ¨äº†ä¸€ä¸ªå•å‘æ•°æ®æµï¼Œå¯ä»¥ä»é¡¶å‘ä¸‹ä¼ é€’åŠ¨æ€å“åº”å¼æ•°æ®ã€‚å¦‚æœåœ¨å…¥å£å¤„ç»´æŠ¤ä¸€äº› stateï¼Œæš´éœ²å‡ºäº‹ä»¶æ¥ç»™å„ä¸ªä¸šåŠ¡æ¨¡å—è°ƒç”¨ï¼Œå°±å¯ä»¥å®ç°ä¸€ä¸ªç±»ä¼¼ redux çš„åŠŸèƒ½ã€‚\n\n2. å±€éƒ¨å¼•ç”¨\n\n```js\n// Button.js  \nimport { ThemeContext } from './Contexts.js';\n```\n\næ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å…¨å±€é…ç½®äº†ä¸»é¢˜ä¸º darkï¼Œä½†æ˜¯æœ‰ä¸€ä¸ª Button ç»„ä»¶ï¼Œå…¶éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå°±å¯ä»¥è¿™æ ·å†™ï¼Œåœ¨ Button å†…éƒ¨å†æ¬¡ Provider è‡ªå·±æƒ³è¦çš„ä¸»é¢˜å³å¯ï¼Œç›¸åŒçš„ context éµå¾ªå°±è¿‘åŸåˆ™ã€‚\n\n## 3. lazy\n\nå»¶è¿ŸåŠ è½½ç»„ä»¶çš„å·¥å…·ï¼Œå¾€å¾€ä¸ [\\\u003cSuspense\u003e](https://juejin.cn/post/7270648629378252840#heading-4) ç»„ä»¶ä¸€èµ·ä½¿ç”¨ã€‚\n\n\nç®€å•ä½¿ç”¨ï¼š\n\n```js\nconst MarkdownPreview = lazy(() =\u003e import('./MarkdownPreview.js'));\n```\n\n### æ¥å—å‚æ•°\n\næ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å› Promise æˆ–è€… å…¶ä»–ç±» *thenable* çš„å¼‚æ­¥å‡½æ•°ã€‚React é»˜è®¤ä¸ä¼šå»åŠ è½½ lazy åŒ…è£¹çš„ç»„ä»¶ï¼Œé™¤éæ˜ç¡®çš„åœ¨ç•Œé¢ä¸Šéœ€è¦æ¸²æŸ“ä»–ã€‚å½“å¼€å§‹åŠ è½½æ—¶ï¼ŒReact ä¼šç­‰å¾…å…¶è§£æï¼Œè§£æè¿‡ç¨‹ä¸­ç”± Suspense æä¾›è¿‡æ¸¡å“åº”ï¼Œè§£æå®Œæ¯•åå³å¯æ¸²æŸ“ã€‚è¿”å›çš„ Promise å’Œ Promise ä¸­ resolve çš„å€¼éƒ½ä¼šè¢«ç¼“å­˜ï¼ˆæ¯”å¦‚æ‰“åŒ…çš„jsæ–‡ä»¶ï¼‰ï¼Œå†æ¬¡æ¸²æŸ“å°±ä¸ä¼šé‡å¤è¯·æ±‚èµ„æºã€‚ä½†æ˜¯è¿™ä¸ªç»„ä»¶æœ¬èº«çš„é‡æ¸²æŸ“è¿˜æ˜¯ä¼šè¢«è§¦å‘ã€‚å¦‚æœè¯¥ Promise reject è¯·æ±‚ï¼Œå¼‚å¸¸ä¼šå†’æ³¡è‡³æœ€è¿‘çš„å¤„ç†å‡½æ•°ï¼ˆError Boundaryï¼‰æŠ›å‡ºã€‚\n\n### è¿”å›å€¼\n\nè¿”å›ä¸€ä¸ªå¯ä»¥æ¸²æŸ“åœ¨ fiber æ ‘ä¸­çš„ç»„ä»¶ã€‚\n\n### æ³¨æ„äº‹é¡¹\n\n- lazy è¦åœ¨ js æ¨¡å—é¡¶å±‚ä½¿ç”¨ï¼Œä¸è¦åœ¨ç»„ä»¶å†…éƒ¨ä½¿ç”¨\n- \n\n### ä½¿ç”¨æ¡ˆä¾‹\n\n1. åŠ¨æ€å¼•å…¥åŠ è½½\n\n```js\nconst MarkdownPreview = lazy(() =\u003e import('./MarkdownPreview.js'));\n\n\u003cSuspense fallback={\u003cLoading /\u003e}\u003e\n  \u003ch2\u003ePreview\u003c/h2\u003e\n  \u003cMarkdownPreview /\u003e\n\u003c/Suspense\u003e\n```\næ•ˆæœï¼š\n\nåŠ è½½ä¸­ï¼š\n\n\n![image.png](/img/posts/2023-9-6/2023-9-6-1.png)\n\nåŠ è½½åï¼š\n\n![image.png](/img/posts/2023-9-6/2023-9-6-2.png)\n\nåŠ è½½ä¸€æ¬¡åä¾¿ä¸ä¼šå†å‡ºç° loading\n\n2. è·¯ç”±æ‡’åŠ è½½\n\nä»‹ç»ä½œè€…åœ¨å·¥ä½œä¸­ç”¨è¿‡çš„ä¸€ä¸ªä½¿ç”¨ js æ•°ç»„é…ç½®è·¯ç”±æ‡’åŠ è½½çš„æ¡ˆä¾‹ï¼š\n\n```jsx\n// route.js\nconst Loadable = (Component) =\u003e (props) =\u003e (\n    \u003cSuspense fallback={\u003cLoader /\u003e}\u003e\n      \u003cComponent {...props} /\u003e\n    \u003c/Suspense\u003e\n);\n\nconst Home = Loadable(lazy(() =\u003e import('views/pages')));\nconst User = Loadable(lazy(() =\u003e import('views/pages/common/user')));\n\nconst routes = [\n    {\n      path: 'home',\n      children: [\n        {\n          path: '/',\n          element: \u003cHome /\u003e\n        }\n      ]\n    },\n    {\n      path: 'setting',\n      children: [\n        {\n          path: 'user-setting',\n          element: \u003cUser /\u003e\n        }\n      ]\n    }\n]\n\nuseRoutes(routes);\n\n// ä½¿ç”¨\nimport Routes from 'route.js';\n\n\u003cRoutes /\u003e\n```\n---\n\nå®Œ ï¼"])</script><script>self.__next_f.push([1,"27:T18ef,"])</script><script>self.__next_f.push([1,"æ–‡ç« ç»§æ‰¿è‡ª [è®°ä¸€æ¬¡å‰ç«¯åº”ç”¨éƒ¨ç½²åï¼Œåˆ·æ–°é™æ€èµ„æºä¸¢å¤±é—®é¢˜](https://juejin.cn/post/7269694294597287971) çš„æ–¹æ¡ˆï¼Œè¿™é‡Œæ¢ä¸€ç§å†™æ³•é‡æ–°é˜è¿°ï¼ŒåŠ ä¸Šä¸€äº›è‡ªå·±çš„æ€è€ƒå’Œå›¾æ–‡è§£é‡Šã€‚\n\n## 1. åœºæ™¯é‡ç°\n\nå‰ç«¯å®ç°ä¸€ä¸ªè·¯ç”±æ‡’åŠ è½½æ—¶ï¼Œç‚¹å‡» menu åˆ‡æ¢é¡µé¢æ—¶å‡ºç°èµ„æº 404 é—®é¢˜ï¼š\n\n![image.png](/img/posts/2023-8-27/2023-8-27-1.png)\n\né¡¹ç›®ä¾‹å­å¦‚ä¸‹ï¼š\n\n```js\nconst AFunction = lazy(() =\u003e import('./page/a.js'))\nconst BFunction = lazy(() =\u003e import('./page/b.js'))\n\nfunction App() {\n\n  return (\n    \u003cdiv className=\"App\"\u003e\n        \u003cHashRouter basename=\"/\"\u003e\n          \u003cLink style={{marginRight: 20}} to=\"/\"\u003eHome\u003c/Link\u003e\n          \u003cLink to=\"/about\"\u003eAbout\u003c/Link\u003e\n          \u003cSuspense fallback={\u003cdiv\u003eLoading...\u003c/div\u003e}\u003e\n            \u003cRoutes\u003e\n              \u003cRoute path=\"/\" element={\u003cAFunction /\u003e}\u003e\u003c/Route\u003e\n              \u003cRoute path=\"/about\" element={\u003cBFunction /\u003e} /\u003e\n            \u003c/Routes\u003e\n          \u003c/Suspense\u003e\n        \u003c/HashRouter\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè®¿é—® `/` è·¯å¾„æ—¶ï¼Œ`BFunction` ç»„ä»¶æ˜¯ä¸ä¼šè¢«åŠ è½½çš„ï¼Œåªä¼šåŠ è½½ webpack å¯¹åº”è·¯ç”±çš„ chunkï¼š\n\n\n![image.png](/img/posts/2023-8-27/2023-8-27-2.png)\n\nåœ¨åˆ‡æ¢è·¯ç”±åˆ° `/about` æ—¶ï¼Œä¼šåŠ è½½è¿™ä¸ªè·¯ç”±å¯¹åº”çš„ chunk æ–‡ä»¶ï¼Œåå¤åˆ‡æ¢åˆ™ä¸ä¼šé‡å¤åŠ è½½ã€‚\n\né¡¹ç›®ä¸ä½¿ç”¨åœºæ™¯æè¿°å®Œæ¯•ï¼\n\n## 2. é—®é¢˜åˆ†æ\n\nç†è®ºä¸Šï¼Œåˆ‡æ¢èµ„æºæ˜¯ä¼šå»æœåŠ¡å™¨è·å–åˆ°å¯¹åº” chunk çš„ js èµ„æºçš„ï¼Œå‡ºç° 404ï¼Œè¦ä¹ˆæ˜¯æœåŠ¡å™¨æ–‡ä»¶è¢«åˆ é™¤ï¼Œè¦ä¹ˆæ˜¯æ–‡ä»¶è¢«é‡æ–°æ‰“åŒ…ï¼Œhash å€¼è¢«æ”¹å˜äº†ã€‚\n\nç¬¬ä¸€ç§æƒ…å†µï¼Œèµ„æºè¢«åˆ é™¤æˆ‘ä»¬ä¸è€ƒè™‘ï¼Œä¸å¯æ§å› ç´ ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿä¸ä¼šæ²¡äº‹å»åˆ é™¤è¿˜åœ¨ä½¿ç”¨çš„èµ„æºçš„ã€‚ç¬¬äºŒç§æƒ…å†µå°±æœ‰å¯èƒ½äº†ï¼Œæˆ‘ä»¬æœ¬åœ°æ‰“äº†åŒ…ï¼Œæ›¿æ¢äº†èµ„æºæ–‡ä»¶ï¼Œæ˜¯ä¼šé€ æˆ hash å˜åŒ–çš„ï¼Œæ¯æ¬¡æ‰“åŒ…éƒ½ä¼šé’ˆå¯¹ä¸åŒçš„åˆ†åŒ… chunk æ‰“ä¸åŒçš„ hash å€¼ã€‚\n\n## 3. é—®é¢˜åŸç†\n\nçŸ¥é“é—®é¢˜åï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹æ‰“åŒ…éƒ¨ç½²æµç¨‹å‡ºç°äº†é‚£äº›çº°æ¼ã€‚\n\nå‰ç«¯é¡¹ç›®ç®€æ˜“éƒ¨ç½²æµç¨‹å¦‚ä¸‹ï¼š\n\n```mermaid\ngraph TD\nCIæ‰“åŒ… --\u003e æœåŠ¡å™¨èµ„æºæ–‡ä»¶æ›¿æ¢\næœåŠ¡å™¨èµ„æºæ–‡ä»¶æ›¿æ¢ --\u003e æµè§ˆå™¨è·å–èµ„æº\n```\n\n![](/img/posts/2023-8-27/2023-8-27-3.png)\n\nè€Œæ‰“åŒ…åç›®å‰åœ¨èµ„æºæœåŠ¡å™¨å­˜æ”¾ç›®å½•å¦‚ä¸‹ï¼š\n\n```shell\nâ”œâ”€console-fe\nâ”‚  â”œâ”€bundle\nâ”‚  â”œâ”€static\nâ”‚  â”œâ”€main.sdf67hda.js\nâ”‚  â””â”€index.html\n```\n\n`index.html` é‡Œå¼•å…¥äº†è¯¥æ¬¡æ‰“åŒ…çš„å…¥å£æ–‡ä»¶ï¼š`main.[hash].js`ï¼Œstatic æ˜¯é™æ€èµ„æºæ–‡ä»¶å¤¹ï¼Œbundle æ˜¯æ‰“åŒ…å¥½çš„ js æ–‡ä»¶å¤¹ã€‚\n\nç”±äº æµè§ˆå™¨æœ‰ç¼“å­˜ï¼Œåœ¨ç”¨æˆ·å·²ç»æ¸²æŸ“å‡º index.html åä¼šäº§ç”Ÿç¼“å­˜ï¼ˆæ¯”å¦‚å…¥å£ main.28cb0dcd.jsï¼‰ï¼Œç”¨æˆ·æ™®é€šåˆ·æ–°é¡µé¢æ—¶ï¼Œæµè§ˆå™¨é»˜è®¤å»æ‹¿ç¼“å­˜çš„ å…¥å£ jsï¼Œè€Œåˆ†å‘çš„å„ä¸ª chunk è·¯å¾„æ˜¯å†™åœ¨ å…¥å£ js æ–‡ä»¶çš„ï¼Œæ‰€ä»¥å°±æ‹¿ä¸åˆ°äº†ã€‚\n\n\nç”¨æµç¨‹å›¾æè¿°å¦‚ä¸‹ï¼š\n\n```mermaid\njourney\ntitle  å‰ç«¯èµ„æºéƒ¨ç½²ä¸ç”¨æˆ·è®¿é—®ä¸åŒæ­¥\nsection å‘å¸ƒé˜¶æ®µ\næ‰“åŒ…: 5: æ—§ç‰ˆæœ¬\nèµ„æºæ›¿æ¢: 5: æ—§ç‰ˆæœ¬\næ›´æ–°æœåŠ¡å™¨: 3: å¯èƒ½å‡ºç°é—®é¢˜\nsection å‘å¸ƒå®Œæˆå\nç”¨æˆ·åˆ·æ–°é¡µé¢: 3: å¼ºåˆ·æ­£å¸¸\nç”¨æˆ·ä¸åˆ·æ–°ï¼ŒåŸåœ°ç‚¹å‡»è·¯ç”±èµ„æº: 1: ç‰ˆæœ¬ä¸¢å¤± 404\n```\n\n![](/img/posts/2023-8-27/2023-8-27-4.png)\n\n## 4. è§£å†³æ–¹æ¡ˆ\n\n1. å–æ¶ˆç¼“å­˜ index.html\n\n\næˆ‘ä»¬è¯•ç€ä»æœåŠ¡ç«¯æç¤ºé˜»æ­¢ index.html ç¼“å­˜ï¼š\n\n```shell\n# nginx\nlocation ~ \\.html$ { add_header Cache-Control \"no-cache, no-store, must-revalidate\"; }\n```\n\nå†æ¬¡éƒ¨ç½²åï¼Œå‘ç°åˆ·æ–°é¡µé¢çš„æƒ…å†µå¯ä»¥æ‹¿åˆ°æ–°çš„èµ„æºäº†ï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·åœç•™åœ¨è€é¡µé¢ï¼ŒåŸåœ°ç‚¹å‡»è·¯ç”±è·³è½¬è¿˜æ˜¯ä¸è¡Œã€‚è¿™ä¸ªæƒ³æƒ³ä¹Ÿæ˜¯å¯ä»¥ç†è§£çš„ï¼Œæ²¡æœ‰åˆ·æ–°ï¼Œå…¥å£ main.js æ²¡æœ‰æ”¹å˜ï¼Œæ‰€ä»¥è¿˜éœ€è¦ç‰¹æ®Šå¤„ç†ã€‚\n\n2. å‰åç«¯ç»Ÿä¸€ç‰ˆæœ¬å·ï¼Œè·³è½¬æ—¶æç¤ºéœ€è¦æ›´æ–°\n\nåç«¯è¿”å›çš„ API ä¸­ä¼šå¸¦ç€çº¦å®šå¥½çš„é€‚ç”¨äºå‰ç«¯çš„ç‰ˆæœ¬å·ï¼Œè€Œå‰ç«¯æ‰“åŒ…æ—¶ä¹Ÿä¼šé€šè¿‡ CI å†™å…¥è¯¥ç‰ˆæœ¬ï¼ˆå¯ä»¥æ˜¯ reduxã€ cookie æˆ–è€… æœ¬åœ°å­˜å‚¨ç­‰ï¼‰ï¼Œåœ¨ä»»ä¸€è¯·æ±‚ API çš„åœ°æ–¹ï¼Œå‰ç«¯ç»Ÿä¸€æ‹¦æˆªæ¯”å¯¹ä¸¤ä¸ªç‰ˆæœ¬å·æ˜¯å¦ç»Ÿä¸€ï¼Œè‹¥ä¸ç»Ÿä¸€åˆ™è‡ªåŠ¨åˆ·æ–°é¡µé¢ï¼Œæµç¨‹å›¾å¦‚ä¸‹ï¼š\n\n\n```mermaid\ngraph TD\nå‰ç«¯æ‰“åŒ…å†™å…¥ç‰ˆæœ¬ --\u003e ç”¨æˆ·ç‚¹å‡»åˆ‡æ¢è·¯ç”±æ—¶è·å–APIå®æ—¶ç‰ˆæœ¬å·\nç”¨æˆ·ç‚¹å‡»åˆ‡æ¢è·¯ç”±æ—¶è·å–APIå®æ—¶ç‰ˆæœ¬å· --\u003e ä¸å‰ç«¯ç‰ˆæœ¬å·ä¸ç›¸åŒæ—¶æç¤ºåˆ·æ–°\n```\n![](/img/posts/2023-8-27/2023-8-27-5.png)\n\nè¿™ç§æ–¹æ¡ˆå°±æ˜¯ç»å¸¸è¦æç¤ºç”¨æˆ·ï¼Œåœ¨å¤šæ¬¡å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶å¯¹ç”¨æˆ·ä½“éªŒä¸å¤ªå‹å¥½ï¼Œä½†æ˜¯å¯ä»¥ä¿è¯ç”¨æˆ·å§‹ç»ˆæ‹¿åˆ°æƒ³è¦çš„ç‰ˆæœ¬ã€‚\n\n3. æœåŠ¡å™¨æ‰“åŒ…å­˜æ”¾å†å²èµ„æº\n\nå°±åƒæ–‡ç« å¼€å¤´å¼•ç”¨æ–‡ç« æ‰€è¯´ï¼Œèµ„æºæœåŠ¡å™¨å¯ä»¥è¿™æ ·å­˜æ”¾èµ„æºï¼š\n\n```shell\nâ”€console-fe\nâ”‚  â”œâ”€20230101\nâ”‚  â”‚  â”œâ”€bundle\nâ”‚  â”‚  â”œâ”€static\nâ”‚  â”‚  â””â”€main.sdf67hda.js\nâ”‚  â”œâ”€20230302\nâ”‚  â”‚  â”œâ”€bundle\nâ”‚  â”‚  â”œâ”€static\nâ”‚  â”‚  â””â”€main.qd52s5f7.js\nâ”‚  â”œâ”€index.html\n...\n```\nåœ¨éƒ¨ç½²æ—¶ï¼ŒCI æ‰“åŒ…æ—¶è®¾ç½®ä¸€ä¸ªç‰ˆæœ¬ï¼š`BUILD_PATH = \"20230101\"`ï¼Œåœ¨é¡¹ç›®ä¸­ï¼Œåªæœ‰ä¸€ä¸ªç»Ÿä¸€çš„ `index.html`ï¼ŒCI éƒ¨ç½²æ—¶ï¼Œåœ¨è¯¥æ–‡ä»¶å†™å…¥åˆ¶å®šç›®å½•ä¸‹çš„è„šæœ¬å…¥å£ï¼š\n\n```js\n\u003cscript src=\"/20230302/main.qd52s5f7.js\"\u003e\u003c/script\u003e\n```\nè¿™æ ·ï¼Œå°±ç®—ç”¨æˆ·ä¸åˆ·æ–°é¡µé¢ï¼Œæ–°éƒ¨ç½²çš„èµ„æºä¸ä¼šå½±å“æ—§çš„èµ„æºï¼Œåªè¦æ§åˆ¶å¥½æ‰“åŒ…çš„å¤§å°ï¼Œå®šæœŸæ¸…ç†è€æ—§ç‰ˆæœ¬æ–‡ä»¶å°±å¯ä»¥äº†ã€‚\n\nè¿™ä¸ªæ–¹æ¡ˆçš„ç¼ºç‚¹æ˜¯ç”¨æˆ·ä¾§ç‰ˆæœ¬å¯èƒ½ä¸ç»Ÿä¸€ï¼Œç”¨æˆ·å¯èƒ½ä¼šçœ‹åˆ°æ—§çš„ç‰ˆæœ¬ã€‚ä½†æ˜¯æ¥å…¥ç°åº¦ç³»ç»Ÿå°±ä¼šæ¯”è¾ƒæ–¹ä¾¿ï¼Œæœ‰åˆ©æœ‰å¼Šã€‚\n\n\n**ç»¼åˆæ–¹æ¡ˆ**\n\nç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸Šè¿°æ–¹æ¡ˆçš„ä¼˜ç‚¹ï¼Œæå‡ºä¸€ä¸ªç»¼åˆæ–¹æ¡ˆï¼š\n\n- è®¾ç½®ä¸ç¼“å­˜ index.html\n- CI æ‰“åŒ…æ—¶æŒ‰ç…§æ–¹æ¡ˆ3ï¼Œå®ç°å†å²èµ„æºå…±å­˜\n- æ¥å…¥ç°åº¦ç³»ç»Ÿï¼Œå®ç°æ¥å£è·å–å½“å‰ç”¨æˆ·å‰ç«¯èµ„æºç›®å½•ï¼Œæ¯”å¦‚ï¼š`/20230302/main.qd52s5f7.js`\n- å‰åç«¯çº¦å®šå¥½å½“å‰ç™»å½•çš„ç°åº¦ç”¨æˆ·çš„ç‰ˆæœ¬ï¼ŒAPI è¿”å›ç‰ˆæœ¬ä¿¡æ¯ã€‚\n\nè¿™æ ·ï¼Œåœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡è¯·æ±‚é¡µé¢æ—¶ï¼Œå‰ç½®è°ƒç”¨ç°åº¦ APIï¼Œ[ç°åº¦ç³»ç»Ÿ](https://juejin.cn/post/7212054600162132029)å‘ŠçŸ¥ nginx æœåŠ¡å™¨è½¬å‘ç»™å‰ç«¯é¡µé¢ã€‚\n\nåœ¨ç”¨æˆ·åˆ·æ–°é¡µé¢æ—¶ï¼Œä¼šå†æ¬¡è°ƒç”¨ç°åº¦ API å¹¶æ›´æ–°å‰ç«¯ç¼“å­˜ï¼Œæ‹¿åˆ°æœ€æ–°çš„èµ„æºã€‚åœ¨ç”¨æˆ·åŸåœ°ç‚¹å‡» menu è·³è½¬è·¯ç”±æ—¶ï¼Œèµ„æºä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œåœ¨ API ä¸­è·å–ç°åº¦ç³»ç»Ÿä¸­ç™»å½•ç”¨æˆ·ç‰ˆæœ¬å·ï¼Œè¿”å›ç»™å‰ç«¯è¯¥çº¦å®šå¥½çš„ç‰ˆæœ¬ï¼ˆBUILD_PATHï¼‰ï¼Œå‰ç«¯åˆ¤æ–­ç‰ˆæœ¬ä¸ä¸€è‡´æ—¶æç¤ºç”¨æˆ·åˆ·æ–°æˆ–è€…è‡ªè¡Œåˆ·æ–°é¡µé¢å³å¯ã€‚\n\n----\n\nä¸çŸ¥é“å¤§å®¶è¿˜æœ‰ä»€ä¹ˆæ›´å¥½çš„æ–¹æ¡ˆå—ï¼Ÿæ¬¢è¿ä¸€èµ·å­¦ä¹ äº¤æµï¼"])</script><script>self.__next_f.push([1,"28:T2f67,"])</script><script>self.__next_f.push([1,"å®˜ç½‘åœ°å€ï¼š[React](https://react.dev/)\n\n\n## 1. \\\u003cProfiler\u003e\n  \n\n`\u003cProfiler\u003e` å¸®åŠ©å¼€å‘è€…ç¨‹å¼åŒ–åœ°è®¡ç®—æ¸²æŸ“æ€§èƒ½ã€‚\n\n### æ¥å— props\n\n-   `id`: æƒ³è¦æµ‹é‡æ€§èƒ½çš„ç»„ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦\n-   `onRender`: ç»„ä»¶æ ‘æ›´æ–°æ—¶è°ƒç”¨ï¼Œä¼ é€’çš„æ“¦å‡€ä¹¦ä¸­åŒ…å«æµ‹è¯•ç»„ä»¶ä¿¡æ¯å’Œæ€§èƒ½ä¿¡æ¯ã€‚å‚æ•°ä¿¡æ¯å¦‚ä¸‹ï¼š\n\n|å‚æ•°|æè¿°|\n|-|-|\n|id|è¯¥æ¸²æŸ“å…ƒç´ çš„å”¯ä¸€æ ‡è¯†ï¼Œå°±æ˜¯ä½ è‡ªå·±åœ¨Profilerä¸­æ‰“çš„id|\n|phase|æšä¸¾ï¼š `mount`, `update` or `nested-update`ã€‚æ ‡è¯†æ¸²æŸ“ç»„ä»¶æ¸²æŸ“çš„ç±»å‹|\n|actualDuration|æ¸²æŸ“åŒ…è£¹ç»„ä»¶åŠå…¶å­ç»„ä»¶æ‰€èŠ±è´¹çš„æ¯«ç§’æ•°ã€‚è¿™å¯ä»¥æµ‹è¯•å­æ ‘åˆ©ç”¨è®°å¿†å‡½æ•°ï¼ˆä¾‹å¦‚ memo å’Œ useMemoï¼‰çš„ä½¿ç”¨æƒ…å†µã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ­¤å€¼åœ¨åˆå§‹æŒ‚è½½ååº”æ˜¾è‘—é™ä½ï¼Œå› ä¸ºè®¸å¤šåä»£èŠ‚ç‚¹åªéœ€è¦åœ¨å…¶ç‰¹å®šä¾èµ–å‘ç”Ÿå˜åŒ–æ—¶æ‰éœ€è¦é‡æ–°æ¸²æŸ“ã€‚|\n|baseDuration|ä¼°è®¡åœ¨æ²¡æœ‰ä»»ä½•ä¼˜åŒ–çš„æƒ…å†µä¸‹é‡æ–°å‘ˆç°æ•´ä¸ªå­æ ‘æ‰€éœ€çš„æ—¶é—´çš„æ¯«ç§’æ•°ã€‚å®ƒæ˜¯é€šè¿‡æ±‡æ€»æ ‘ä¸­æ¯ä¸ªç»„ä»¶çš„æœ€æ–°æ¸²æŸ“æŒç»­æ—¶é—´æ¥è®¡ç®—çš„ã€‚æ­¤å€¼ä¼°è®¡æ¸²æŸ“çš„æœ€åæƒ…å†µæˆæœ¬ï¼ˆä¾‹å¦‚ï¼Œåˆå§‹æŒ‚è½½æˆ–æ²¡æœ‰è®°å¿†å‡½æ•°çš„æ ‘ï¼‰ã€‚å°†å®é™…æŒç»­æ—¶é—´ä¸å®ƒè¿›è¡Œæ¯”è¾ƒï¼Œçœ‹çœ‹è®°å¿†å‡½æ•°æ˜¯å¦æœ‰æ•ˆã€‚|\n|startTime|react å¼€å§‹æ¸²æŸ“æ—¶çš„æ—¶é—´æˆ³|\n|endTime|React å½“å‰æ›´æ–°ç»„ä»¶è¢« commit ï¼ˆç†è§£ä¸º fiber è°ƒåº¦ç»Ÿä¸€æ›´æ–°çœŸå® domï¼‰æ—¶çš„æ—¶é—´æˆ³ã€‚æ­¤å€¼åœ¨ commit ä¸­çš„æ‰€æœ‰ profiler ä¹‹é—´å…±äº«ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶å¯¹å®ƒä»¬è¿›è¡Œåˆ†ç»„ã€‚|\n\n### æ³¨æ„äº‹é¡¹\n\næ€§èƒ½åˆ†æä¼šå¢åŠ ä¸€äº›é¢å¤–çš„å¼€é”€ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹åœ¨ç”Ÿäº§ç‰ˆæœ¬ä¸­ä¼šç¦ç”¨å®ƒã€‚\n\n### ä½¿ç”¨æ¡ˆä¾‹\n\n1. è®¡ç®—å•ä¸ªç»„ä»¶æ¸²æŸ“æ€§èƒ½\n\n```js\n\u003cApp\u003e\n  \u003cProfiler id=\"Sidebar\" onRender={onRender}\u003e\n    \u003cSidebar /\u003e\n  \u003c/Profiler\u003e\n  \u003cPageContent /\u003e\n\u003c/App\u003e\n```\næ­¤æ—¶ï¼Œä½ è¿˜å¯ä»¥åœ¨ [React Developer Tools](https://react.dev/learn/react-developer-tools) ä¸­æŸ¥çœ‹ Profiler é¡µç­¾ï¼Œé‡Œè¾¹æœ‰å…·ä½“ä¿¡æ¯ï¼š\n\n\n![image.png](/img/posts/2023-8-24/2023-8-24-1.png)\n\n2. å¤šä¸ªç»„ä»¶æ€§èƒ½æµ‹è¯•\n\n```js\n\u003cApp\u003e\n  \u003cProfiler id=\"Sidebar\" onRender={onRender}\u003e\n    \u003cSidebar /\u003e\n  \u003c/Profiler\u003e\n  \u003cProfiler id=\"Content\" onRender={onRender}\u003e\n    \u003cContent\u003e\n      \u003cProfiler id=\"Editor\" onRender={onRender}\u003e\n        \u003cEditor /\u003e\n      \u003c/Profiler\u003e\n      \u003cPreview /\u003e\n    \u003c/Content\u003e\n  \u003c/Profiler\u003e\n\u003c/App\u003e\n```\nå¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨åŒä¸€ä¸ªå‡½æ•°å°±è¡Œã€‚\n\n\u003e Profiler ä¼šå½±å“æ€§èƒ½ï¼Œä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨\n\n\n## 2. \\\u003cSuspense\u003e\n\n`\u003cSuspense\u003e` åŒ…è£¹ä¸€ä¸ªéœ€è¦æ‡’åŠ è½½çš„ç»„ä»¶ã€‚\n\n### æ¥æ”¶ props\n\n- `children`: æ‡’åŠ è½½çš„ç»„ä»¶ã€‚åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ä¼šç”¨ fallback å‡½æ•°å¡«å……ç©ºç™½åŒºåŸŸ.\n- `fallback`: æ‡’åŠ è½½ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹ä¸­çš„æ›¿ä»£å“ï¼ˆplaceholderï¼‰ï¼Œæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶è¿”å›å€¼å¯ä»¥æ¥å—ä»»ä½•æœ‰æ•ˆçš„ React Nodeï¼Œæ¯”å¦‚ loading å›¾æ ‡æˆ–è€…éª¨æ¶å±ç­‰ã€‚å½“ ç»„ä»¶å»¶è¿ŸåŠ è½½è¿‡ç¨‹ä¸­ï¼ŒSuspense ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°Â fallbackï¼ŒåŠ è½½ç»“æŸåè‡ªåŠ¨æ¢å›åˆ° childrenã€‚å¤šå±‚ Suspense åŒ…è£¹çš„æƒ…å†µæ—¶ï¼Œä¼šå›è½åˆ°æœ€è¿‘çš„ä¸€å±‚ fallbackã€‚\n\n### æ³¨æ„äº‹é¡¹\n\n- React ä¸ä¼šä¸ºåœ¨é¦–æ¬¡æŒ‚è½½ä¹‹å‰è¢« Suspense çš„æ¸²æŸ“ä¿ç•™ä»»ä½•çŠ¶æ€ã€‚å½“ç»„ä»¶åŠ è½½å®Œæ¯•åï¼ŒReact å°†ä»å¤´å¼€å§‹é‡è¯•æ¸²æŸ“æŒ‚èµ·çš„æ¸²æŸ“æ ‘ã€‚\n- å¦‚æœ Suspense æ¸²æŸ“æ ‘çš„å†…å®¹å·²ç»æ˜¾ç¤ºåå†æ¬¡æŒ‚èµ·ï¼Œåˆ™â€œfallbackâ€å°†å†æ¬¡æ˜¾ç¤ºï¼Œé™¤éå¯¼è‡´å®ƒçš„æ›´æ–°æ˜¯ç”±startTransition å¼•èµ·çš„ã€‚\n- å¦‚æœ React éœ€è¦éšè—å·²ç»å¯è§çš„å†…å®¹ï¼Œç”±äºå®ƒå†æ¬¡æŒ‚èµ·äº†ï¼Œæ‰€ä»¥ä¼šæ¸…ç†æ¸²æŸ“æ ‘ä¸­çš„å¸ƒå±€æ•ˆæœã€‚å½“å†…å®¹å‡†å¤‡å¥½å†æ¬¡æ˜¾ç¤ºæ—¶ï¼ŒReact å°†å†æ¬¡è§¦å‘å¸ƒå±€é‡ç»˜ã€‚è¿™æ ·ï¼Œåœ¨ç»„ä»¶éšè—æ—¶å°±ä¸ä¼šå†åšå¸ƒå±€é‡ç»˜çš„è®¡ç®—äº†ã€‚\n- React åœ¨ Suspense ä¸­é›†æˆäº†ä¸€äº›åº•å±‚ä¼˜åŒ–ï¼Œå¦‚*æµæœåŠ¡å™¨æ¸²æŸ“*å’Œ*é€‰æ‹©æ€§æ°´åˆ*ï¼ˆHydrationï¼‰ã€‚åœ¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶å¯ä»¥ç”¨åˆ°ã€‚\n\n\u003e Suspense **ä¸åœ¨** Effect å‰¯ä½œç”¨ æˆ–è€… event handler ä¸­ç›‘æµ‹\n\n### ä½¿ç”¨æ¡ˆä¾‹\n\n1. ä½¿ç”¨ fallback çš„ loading æ•ˆæœ\n\n```js\nconst [show, setShow] = useState(false);\n\n\u003cbutton onClick={() =\u003e setShow(true)}\u003e\u003c/button\u003e\n...\n\nif (show) {\n    return (\n        \u003cSuspense fallback={\u003cLoading /\u003e}\u003e\n          \u003cAlbums artistId={artist.id} /\u003e\n        \u003c/Suspense\u003e\n    )\n}\n\n...\nfunction Loading() {\n  return \u003ch2\u003eğŸŒ€ Loading...\u003c/h2\u003e;\n}\n```\n\n2. ä¸€æ¬¡æ€§æ‡’åŠ è½½å¤šä¸ªç»„ä»¶\n\n```js\n\u003cSuspense fallback={\u003cLoading /\u003e}\u003e\n    \u003cBiography artistId={artist.id} /\u003e\n    \u003cPanel\u003e\n      \u003cAlbums artistId={artist.id} /\u003e\n    \u003c/Panel\u003e\n\u003c/Suspense\u003e\n```\n\nè¢« Suspense åŒ…è£¹çš„èŒƒå›´è§†ä¸ºä¸€ä¸ªç»Ÿä¸€çš„æ›´æ–°å•å…ƒã€‚ä¸¤ä¸ªç»„ä»¶åªæœ‰ä¸€ä¸ªå¤„äºåŠ è½½ä¸­æ—¶ï¼Œæ•´ä¸ªæ˜¾ç¤ºéƒ½ä¼šå˜ä¸ºæŒ‡ç¤ºå™¨ fallbackã€‚åœ¨æ‰€æœ‰ç»„ä»¶å‡†å¤‡å®Œæ¯•åï¼Œä¼šä¸€æ¬¡æ€§æ¸²æŸ“å‡ºæ¥ã€‚\n\næ¢ç§æ€è€ƒæ–¹æ¡ˆï¼Œä¸Šé¢çš„ä»£ç æ˜¯æœ‰é—®é¢˜çš„ï¼Œå¤šä¸ªå¼‚æ­¥ç»„ä»¶ä¸å»ºè®®åˆ†å¼€å†™ï¼Œåº”è¯¥æŒ‰ç…§ä¸šåŠ¡åŒºåˆ†ï¼Œç»Ÿä¸€ä½¿ç”¨ Details ç»„ä»¶å°è£…ï¼š\n\n```js\n\u003cSuspense fallback={\u003cLoading /\u003e}\u003e\n  \u003cDetails artistId={artist.id} /\u003e\n\u003c/Suspense\u003e\n```\n\n3. ä½¿ç”¨åµŒå¥— Suspense\n\n```js\n\u003cSuspense fallback={\u003cBigSpinner /\u003e}\u003e\n    \u003cBiography artistId={artist.id} /\u003e\n    \u003cSuspense fallback={\u003cAlbumsGlimmer /\u003e}\u003e\n      \u003cPanel\u003e\n        \u003cAlbums artistId={artist.id} /\u003e\n      \u003c/Panel\u003e\n    \u003c/Suspense\u003e\n\u003c/Suspense\u003e\n```\n\nä¸Šé¢çš„ Biography ç»„ä»¶çš„åŠ è½½ä¸ä¼šå—åˆ° Albums åŠ è½½çš„å½±å“ã€‚sequence çš„è¿ä½œæµç¨‹ï¼š\n\n- å½“ `Biography` æœªåŠ è½½æ—¶,Â ç»Ÿä¸€æ˜¾ç¤º `BigSpinner` æ–¹æ¡ˆã€‚\n- ä¸€æ—¦Â `Biography`Â åŠ è½½ç»“æŸ,Â `BigSpinner`Â å°±ä¼šè¢«æ›¿æ¢æ‰ã€‚\n- æ­¤æ—¶ `Albums` å¼€å§‹åŠ è½½Â `AlbumsGlimmer`Â æ˜¾ç¤ºåœ¨å¯¹åº”åŒºåŸŸã€‚\n- ä¸€æ—¦Â `Albums`Â åŠ è½½ç»“æŸï¼Œåˆ™ç»“æŸæ¸²æŸ“ã€‚\n\nSuspense è¾¹ç•Œè®¾ç½®å°±ç±»ä¼¼äºå †æ ˆçš„ pop æ“ä½œï¼Œæ˜¯æœ‰å±‚çº§å…³ç³»çš„ï¼Œæœ€ä¸Šå±‚çš„æœ€å…ˆåŠ è½½ã€‚ç†è®ºä¸Š Suspense å¯ä»¥ç”¨åœ¨ä»»ä¸€ä¸ªç»„ä»¶çš„ä»»ä½•ä¸€ä¸ªåœ°æ–¹ï¼Œä½†æ˜¯ä¸å»ºè®®åœ¨å„ä¸ªä¸šåŠ¡ç»„ä»¶å¹¿æ³›çš„ä½¿ç”¨ï¼Œå…·ä½“çš„ç”¨æˆ·ä½“éªŒè®¾è®¡ä¸­çš„æ¸²æŸ“é¡ºåºåº”è¯¥ç»†ç²’åº¦åˆ°å…·ä½“çš„ç»„ä»¶æ§åˆ¶å‡½æ•°ï¼ˆusetate/useEffect ç­‰ï¼‰ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ‡’åŠ è½½æŠ€æœ¯ã€‚\n\n4. è¾“å…¥æ¡†è¾“å…¥æ—¶ï¼Œå‰ç«¯æ¨¡æ‹Ÿå¼‚æ­¥æŸ¥è¯¢æœç´¢ç»“æœ\n\nå¦‚ä¸‹ï¼š\n\n```js\nconst [query, setQuery] = useState('');\n...\n\u003c\u003e\n  \u003clabel\u003e\n    Search albums:\n    \u003cinput value={query} onChange={e =\u003e setQuery(e.target.value)} /\u003e\n  \u003c/label\u003e\n  \u003cSuspense fallback={\u003ch2\u003eLoading...\u003c/h2\u003e}\u003e\n    \u003cSearchResults query={query} /\u003e\n  \u003c/Suspense\u003e\n\u003c/\u003e\n```\nä¸Šé¢çš„ä¾‹å­ï¼ŒsetQuery è§¦å‘äº†ç»„ä»¶çš„é‡æ¸²æŸ“ï¼ŒSearchResults å°±ä¼šå‡ºç°åŠ è½½ç•Œé¢ã€‚è¿™å¯ä»¥ç”¨æ¥åœ¨å‰ç«¯æœç´¢çš„ç»„ä»¶ä¸­æ¨¡æ‹ŸåŠ è½½åŠ¨ç”»ã€‚\n\nå½“ç„¶ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ useDeferredValue æ¥sä½¿UIæ¸²æŸ“æ›´æµç•…ï¼š\n\n```js\nconst deferredQuery = useDeferredValue(query);\n\n...\n// ä¸€ä¸ªåŠé€æ˜çš„åŠ è½½åŠ¨ç”»\n\u003cdiv style={{\n  opacity: query !== deferredQuery ? 0.5 : 1 \n}}\u003e\n    \u003cSearchResults query={deferredQuery} /\u003e\n\u003c/div\u003e\n```\n\n5. é˜»æ­¢å·²æ¸²æŸ“å…ƒç´ è¢«éšè— [ä¾‹å­](https://codesandbox.io/s/s5tn9m?file=%2FApp.js\u0026utm_medium=sandpack)\n\næˆ‘ä»¬å¯ä»¥è¿™æ ·å†™æ¥æ‡’åŠ è½½ä¸€ä¸ªè·¯ç”± ï¼š\n\n```js\nexport default function App() {\n  return (\n    \u003cSuspense fallback={\u003cBigSpinner /\u003e}\u003e\n      \u003cRouter /\u003e\n    \u003c/Suspense\u003e\n  );\n}\n\nfunction Router() {\n  const [page, setPage] = useState('/');\n  const [isPending, startTransition] = useTransition();\n\n  function navigate(url) {\n    startTransition(() =\u003e {\n      setPage(url);\n    });\n  }\n\n  let content;\n  \n  // å¤„ç†æ¨¡æ‹Ÿè·¯ç”±é€»è¾‘èµ‹å€¼å¹¶contentçš„æ“ä½œçœç•¥\n  \n  return (\n    \u003cLayout isPending={isPending}\u003e\n      {content}\n    \u003c/Layout\u003e\n  );\n}\n``` \n\nä¸Šé¢çš„ä¾‹å­ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºç»„ä»¶åŠ è½½æ—¶ï¼Œ Layout ç»„ä»¶ä¹Ÿä¼šæ¶ˆå¤±å¹¶æ›¿æ¢ä¸º BigSpinnerã€‚ ä½†æ˜¯ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¢«åŒ…è£¹çš„ç»„ä»¶ä½¿ç”¨äº† `startTransition`ï¼Œè¿™å‘Šè¯‰ Reactï¼Œ Router ç»„ä»¶çš„æ¸²æŸ“ä¸æ˜¯ç´§æ€¥çš„ï¼Œå¯ä»¥ç¼“ä¸€ç¼“ï¼Œæ­¤æ—¶ï¼Œåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ç»“æŸä¹‹å‰ï¼Œç•Œé¢ä¼šä¿ç•™ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å›¾å½¢ã€‚æ‰€ä»¥å³ä½¿ Suspense åŒ…è£¹äº†æœ€å¤–å±‚ï¼Œä½† Layout ç»„ä»¶å¹¶ä¸ä¼šé‡æ¸²æŸ“ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡æ¸²æŸ“ç»“æŸåæ‰å˜åŒ–ã€‚\n\n6. åœ¨ navigate æ—¶é‡ç½® Suspense\n\nä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ transition æ¸²æŸ“é˜¶æ®µï¼ŒUI ä¼šé¿å…éšè—æ‰å·²ç»æ¸²æŸ“å‡ºæ¥çš„æ•°æ®ï¼Œä½†æ˜¯åœ¨è·¯ç”±å¯¼èˆªæ—¶ï¼Œæ°æ°éœ€è¦å‘Šè¯‰ React ç»™æˆ‘ç«‹å³é”€æ¯åŸæ¥çš„æ•°æ®å¹¶å±•ç¤ºä½ å‡†å¤‡å¥½çš„ fallbackã€‚ä½ å¯ä»¥è¿™æ ·åšï¼š\n\n```jsx\n\u003cProfilePage key={queryParams.id} /\u003e\n```\n\næˆ‘ä»¬ä¸¾ä¸€ä¸ªä½¿ç”¨åœºæ™¯ä¾‹å­ï¼Œä¸€ä¸ªç”¨æˆ·çš„ ProfilePage ä¸å¦ä¸€ä¸ªç”¨æˆ·çš„ ProfilePage å†…å®¹ä¸åŒã€‚é€šè¿‡æŒ‡å®šä¸€ä¸ªé”®ï¼Œä½ å¯ä»¥ç¡®ä¿ React å°†ä¸åŒç”¨æˆ·çš„ ProfilePage è§†ä¸ºä¸åŒçš„ç»„ä»¶ï¼Œå¹¶åœ¨å¯¼èˆªè¿‡ç¨‹ä¸­é‡ç½® Suspense è¾¹ç•Œã€‚\n\n\u003e ä¸Šé¢æ˜¯å®˜ç½‘çš„è§£é‡Šï¼Œç”¨äººè¯è¯´ï¼Œå°±æ˜¯ key å˜åŒ–äº†ï¼Œtransition ä¸ä¼šç¼“å­˜åŸæ¥æ¸²æŸ“çš„ UI äº†ï¼Œè€Œæ˜¯éšç€è·¯ç”±åˆ‡æ¢è¿›å…¥æ‡’åŠ è½½çš„ fallback\n\n7. æ˜¾ç¤ºæœåŠ¡å™¨é”™è¯¯\n\nå¦‚æœä½ ä½¿ç”¨äº†æœåŠ¡ç«¯æ¸²æŸ“ï¼Œå¹¶ä¸”ä¸€ä¸ªç»„ä»¶åœ¨æœåŠ¡ç«¯æŠ¥äº†é”™åï¼ŒReact ä¸ä¼šç»ˆæ­¢æœåŠ¡ç«¯çš„æ¸²æŸ“ï¼Œè€Œæ˜¯å¾€ä¸Šå±‚æ‰¾æœ€è¿‘çš„\\\u003cSuspense\u003eï¼Œä½¿ç”¨å…¶ fallback è¿›è¡Œæ›¿æ¢é”™è¯¯åŒºåŸŸï¼›å¦ä¸€æ–¹é¢ï¼Œåœ¨å®¢æˆ·ç«¯å‡ºç°é”™è¯¯åï¼Œå®¢æˆ·ç«¯ä¼šç›´æ¥æŠ›å‡ºé”™è¯¯ï¼Œå¦‚æœå®¢æˆ·ç«¯å¹¶æœªå‡ºç°é”™è¯¯ï¼Œåˆ™ç”¨æˆ·æ— æ³•æ„ŸçŸ¥æœåŠ¡ç«¯å‡ºé”™äº†ã€‚\n\nå¯ä»¥åœ¨æœåŠ¡ç«¯ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š\n\n```js\n\u003cSuspense fallback={\u003cLoading /\u003e}\u003e\n  \u003cChat /\u003e\n\u003c/Suspense\u003e\n\nfunction Chat() {\n  if (typeof window === 'undefined') {\n    throw Error('Chat should only render on the client.');\n  }\n  // ...\n}\n```\næ­¤æ—¶ï¼Œåœ¨æœåŠ¡ç«¯åˆ™ä¼šæŠ›å‡ºé”™è¯¯ï¼Œåœ¨å®¢æˆ·ç«¯åˆ™æ­£å¸¸æ˜¾ç¤º Chatã€‚\n\n8. åšå…¨å±€è·¯ç”±æ‡’åŠ è½½\n\nå¯ä»¥ç»“åˆ lazy ä½¿ç”¨ï¼Œåšè·¯ç”±çš„æ‡’åŠ è½½æ¥æé«˜é¡µé¢æ€§èƒ½ï¼š\n\n```js\nconst container = document.getElementById('root');\nconst root = createRoot(container); // createRoot(container!) if you use TypeScript\n\nroot.render(\n  \u003cBrowserRouter basename={config.basename}\u003e\n    \u003cCustomRoutes /\u003e\n  \u003c/BrowserRouter\u003e\n);\n```\n\nåœ¨ `\u003cCustomRoutes /\u003e` ä¸­ï¼š\n\n```js\nconst Home = lazy(() =\u003e import('./Home'))\nconst About = lazy(() =\u003e import('./About'))\n\n\u003cRoutes\u003e\n  \u003cSuspense fallback={\u003cLoading type=\"home\" /\u003e}\u003e\n    \u003cRoute path=\"/\" element={\u003cHome /\u003e} /\u003e\n  \u003c/Suspense\u003e\n  \u003cSuspense fallback={\u003cLoading type=\"about\" /\u003e}\u003e\n    \u003cRoute path=\"about\" element={\u003cAbout /\u003e} /\u003e \n  \u003c/Suspense\u003e\n\u003c/Routes\u003e\n```\nä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨ location pathname åˆ‡æ¢æ—¶ï¼Œä¼šåŠ è½½ä¸åŒçš„ fallback åŠ è½½åŠ¨ç”»ï¼ŒåŠ è½½ç»“æŸåï¼Œæ˜¾ç¤ºå¯¹åº”çš„æ¸²æŸ“å…ƒç´ ã€‚\n\n----\n\næ­¤å¤–ï¼Œ react ä¸­è¿˜æœ‰ä¸¤ä¸ªç»„ä»¶ï¼š`\u003cFragment\u003e`,`\u003cStrictMode\u003e`ï¼Œå› ä¸ºåŠŸèƒ½æ¯”è¾ƒå•ä¸€ï¼ŒèŒ„ä½¿ç”¨è¾ƒä¸ºç®€å•ï¼Œè¿™é‡Œåšç®€å•æè¿°ã€‚\n\n## 3. \\\u003cFragment\u003e\n\nç”±äº react æ¸²æŸ“å¿…é¡»æœ‰ä¸€ä¸ªæ ¹ç»„ä»¶ï¼Œä½†æ˜¯åˆä¸æƒ³ç ´ååŸæ¥çš„ dom ç»“æ„ï¼Œreact å®ç°äº†è¿™ä¹ˆä¸ªè™šæ‹Ÿçš„å®¹å™¨ã€‚ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š\n\n```js\nfunction Post() {\n  return (\n    \u003c\u003e\n      \u003cPostTitle /\u003e\n      \u003cPostBody /\u003e\n    \u003c/\u003e\n  );\n}\n```\nåœ¨ fiber å®é™…æ¸²æŸ“çœŸå® dom æ—¶ï¼ŒFragment ä¼šè¢«æ¸…é™¤æ‰ï¼Œä¸ä¼šå ç”¨ dom æ ‘ç©ºé—´ã€‚å½“éœ€è¦å†å¾ªç¯åˆ—è¡¨ä¸­ä½¿ç”¨æ—¶ï¼Œå¾€å¾€éœ€è¦æ·»åŠ å…ƒç´ çš„ key å±æ€§ï¼Œè¿™å°±ä¸èƒ½ä½¿ç”¨åŒ¿åæ ‡ç­¾ï¼Œè€Œè¦ä½¿ç”¨å…¨åï¼š\n\n```js\nfunction Blog() {\n  return posts.map(post =\u003e\n    \u003cFragment key={post.id}\u003e\n      \u003cPostTitle title={post.title} /\u003e\n      \u003cPostBody body={post.body} /\u003e\n    \u003c/Fragment\u003e\n  );\n}\n```\n\n\u003e Fragment æ²¡æœ‰ä»»ä½•å±æ€§ï¼Œæ·»åŠ æ ·å¼ä¹Ÿæ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚ä¸€çº§ Fragment çš„æ¸²æŸ“ä¸ä¼šè§¦å‘ç»„ä»·é‡æ¸²æŸ“ï¼Œä½†æ˜¯å¤šçº§ Fragment åˆ™ä¼šå¯¼è‡´é‡æ¸²æŸ“ï¼Œä¾‹å¦‚ä» `\u003c\u003e\u003c\u003e\u003cChild /\u003e\u003c/\u003e\u003c/\u003e` åˆ° `\u003cChild /\u003e`ï¼Œå­ç»„ä»¶ state ä¼šé‡ç½®ã€‚\n\n## 4. \\\u003cStrictMode\u003e\n\nå¸®åŠ©åœ¨å¼€å‘æ¨¡å¼å‘ç°æ›´å¤šçš„æ½œåœ¨ bugã€‚ä½¿ç”¨æ–¹å¼ï¼š\n\n```js\nconst root = createRoot(document.getElementById('root'));\nroot.render(\n  \u003cStrictMode\u003e\n    \u003cApp /\u003e\n  \u003c/StrictMode\u003e\n);\n```\n\nä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå¼€å‘ç¯å¢ƒä¼šæœ‰å¦‚ä¸‹å˜åŒ–ï¼š\n\n-   ç»„ä»¶éƒ½ä¼šè¢«æ¸²æŸ“ä¸¤æ¬¡ï¼Œä»¥å‘ç°ä¸€äº›éçº¯å‡½æ•°ã€‚ä¾‹å¦‚ï¼š\n\n```js\n// é”™è¯¯å†™æ³•\nexport default function StoryTray({ stories }) {\n  const items = stories;\n  items.push({ id: 'create', label: 'Create Story' });\n  return (\n    \u003cul\u003e\n      {items.map(story =\u003e (\n        \u003cli key={story.id}\u003e\n          {story.label}\n        \u003c/li\u003e\n      ))}\n    \u003c/ul\u003e\n  );\n}\n```\n-   å‰¯ä½œç”¨å‡½æ•°ä¼šè¢«æ‰§è¡Œä¸¤éï¼Œä»¥å‘ç°æ²¡æœ‰è¢«æ¸…ç†ï¼ˆclean upï¼‰çš„å‰¯ä½œç”¨è®¢é˜…ã€‚\n-   ä¼šæ£€æŸ¥æ˜¯å¦ç”¨äº†ä¸€äº›ä¸åˆé€‚çš„ APIï¼Œæ¯”å¦‚ findDOMNode\n\nå½“ç„¶ï¼Œä¸¥æ ¼æ¨¡å¼ä¹Ÿå¯ä»¥éƒ¨åˆ†åŠ åœ¨å±€éƒ¨ç»„ä»¶ä¸Šï¼š\n\n```js\n\u003cStrictMode\u003e\n    \u003cmain\u003e\n      \u003cSidebar /\u003e\n      \u003cContent /\u003e\n    \u003c/main\u003e\n\u003c/StrictMode\u003e\n```\n----\n\nå®Œï¼ï¼"])</script><script>self.__next_f.push([1,"29:T2df4,"])</script><script>self.__next_f.push([1,"å®˜ç½‘åœ°å€ï¼š[React](https://react.dev/)\n\n\n## 1. useTransition\n\nuseTransition å¯ä»¥è®©ä½ ä¸é˜»å¡ UI æ¸²æŸ“æ¥æ›´æ–° state çš„å€¼ã€‚å¯ä»¥ç†è§£ä¸ºå®ç°æ›´æµç•…çš„é¡µé¢è¿‡æ¸¡ã€‚ä½¿ç”¨æ–¹å¼ä¸ºï¼š\n\n```js\n// ä¸€ä¸ªåˆ‡æ¢ tab é¡µç­¾çš„ä¾‹å­\nfunction TabContainer() {\n  const [isPending, startTransition] = useTransition();\n  const [tab, setTab] = useState('about');\n\n  function selectTab(nextTab) {\n    startTransition(() =\u003e {\n      setTab(nextTab);\n    });\n  }\n  // ...\n}\n```\n\nå…¶ä¸­ï¼š\n\n- isPendingï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå½“å‰æ˜¯å¦é˜»å¡\n- startTransitionï¼šå¼€å¯è¿‡æ¸¡ï¼Œå¹¶å¯ä¿®æ”¹ state\n\n### æ³¨æ„äº‹é¡¹\n\n- ä½œä¸ºä¸€ä¸ª hookï¼Œåªèƒ½åœ¨å‡½æ•°å¼ç»„ä»¶æˆ–è€…è‡ªå®šä¹‰ hook é‡Œè¢«è°ƒç”¨ï¼Œå¦‚æœæƒ³è¦å•ç‹¬ä½œä¸º API è°ƒç”¨ï¼Œå¯ä½¿ç”¨ [`startTransition`](https://react.dev/reference/react/startTransition)\n- ä»…ä»…å¯ä»¥åœ¨ setState ä¸­è§¦å‘ï¼Œè‹¥æƒ³è¦åœ¨ props å˜åŒ–åè§¦å‘ï¼Œéœ€ä½¿ç”¨ [`useDeferredValue`](https://react.dev/reference/react/useDeferredValue)\n- startTransition é‡Œçš„æ–¹æ³•ä¸èƒ½æœ‰å¼‚æ­¥å‡½æ•°ï¼Œè®¾ç½®å¼‚æ­¥ä¼šæ‰“ä¹±æ¸²æŸ“é¡ºåºï¼Œè¿™ä¸ªæ¸²æŸ“å°±å¤±å»ä½œç”¨äº†ã€‚\n- æ ‡è®°ä¸º transition çš„ state ä¼šè¢«å…¶ä»– state çš„æ›´æ–°æ‰“æ–­ã€‚å¦‚æœæ‚¨åœ¨ transition ä¸­æ›´æ–°å›¾è¡¨ç»„ä»¶ï¼Œä½†åœ¨å›¾è¡¨å¤„äºé‡æ–°æ¸²æŸ“è¿‡ç¨‹ä¸­å¼€å§‹åœ¨å¦å¤–çš„ input ä¸­é”®å…¥è¾“å…¥ï¼Œåˆ™ React å°†åœ¨å¤„ç†è¾“å…¥æ›´æ–°åé‡æ–°å¯åŠ¨å›¾è¡¨ç»„ä»¶çš„æ¸²æŸ“å·¥ä½œã€‚\n- ä¸èƒ½ç”¨äºæ§åˆ¶æ–‡æœ¬è¾“å…¥\n- å¦‚æœæœ‰å¤šä¸ªæ­£åœ¨è¿›è¡Œçš„ transitionï¼ŒReact ç›®å‰ä¼šå°†å®ƒä»¬æ‰¹å¤„ç†åœ¨ä¸€èµ·ã€‚æ­¤åŠŸèƒ½å¯èƒ½ä¼šåœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­åˆ é™¤\n\n### ä½¿ç”¨æ¡ˆä¾‹\n\n1. åˆ‡æ¢ tab å¡é¡¿é—®é¢˜ï¼š\n\nè¿™é‡Œæœ‰å‡ ä¸ªtabï¼Œtabå†…å®¹å¦‚ä¸‹ï¼š\n\n```js\n// tab 1 ä¸€ä¸ªæŒ‰é’®\n\u003cbutton onClick={() =\u003e {\n  onClick();\n}}\u003e\n  {children}\n\u003c/button\u003e\n\n// tab 2 ä¸€ä¸ª p\nreturn (\n    \u003cp\u003eWelcome to my profile!\u003c/p\u003e\n);\n\n// tab 3 ä¸€ä¸ªå¤æ‚åˆ—è¡¨\nlet items = [];\nfor (let i = 0; i \u003c 500; i++) {\n    items.push(\u003cSlowPost key={i} index={i} /\u003e);\n}\nreturn (\n    \u003cul className=\"items\"\u003e\n      {items}\n    \u003c/ul\u003e\n);\n\nfunction SlowPost({ index }) {\n  let startTime = performance.now();\n  while (performance.now() - startTime \u003c 1) {\n    // äººä¸ºæ¨¡æ‹Ÿçš„å¡é¡¿\n  }\n\n  return (\n    \u003cli className=\"item\"\u003e\n      Post #{index + 1}\n    \u003c/li\u003e\n  );\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œtab3åŒ…å« 500 ä¸ªå…ƒç´ ï¼Œé¡µé¢æ¸²æŸ“åŠ¿å¿…ä¼šå¡é¡¿1-2ç§’ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ª tab åˆ‡æ¢ç»„ä»¶ï¼š\n\n```js\nexport default function TabContainer() {\n  const [isPending, startTransition] = useTransition();\n  const [tab, setTab] = useState(1);\n\n  function selectTab(nextTab) {\n    setTab(nextTab);      \n  }\n\n  return (\n    \u003c\u003e\n      \u003cTabButton\n        isActive={tab === 1}\n        onClick={() =\u003e selectTab(1)}\n      \u003e\n        About\n      \u003c/TabButton\u003e\n      ...\n      \u003cTabButton\n        isActive={tab === 3}\n        onClick={() =\u003e selectTab(3)}\n      \u003e\n        Posts (slow)\n      \u003c/TabButton\u003e\n      ...\n    \u003c/\u003e\n  );\n}\n```\nä¸Šé¢çš„ä¾‹å­ï¼ŒTabButton æ˜¯ä¸€ä¸ªå…¬å…±å­ç»„ä»¶ï¼Œæ˜¯å‡ ä¸ªé¡¶éƒ¨çš„æŒ‰é’®ï¼Œç”¨äºæ¥å—äº‹ä»¶åˆ‡æ¢ tabï¼š\n\n```js\n\u003cbutton onClick={() =\u003e {\n  // è°ƒç”¨çˆ¶ç»„ä»¶TabContainerçš„ selectTab æ–¹æ³•\n  onClick();\n}}\u003e\n  {children}\n\u003c/button\u003e\n```\n\nPosts é¡µç­¾ï¼ˆtab3ï¼‰åœ¨ active çš„æ—¶å€™å°±ä¼šåŠ è½½æ¸²æŸ“ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹é¡µé¢çš„ååº”ï¼š\n\n\n![image.png](/img/posts/2023-8-18/2023-8-18-1.png)\n\næˆ‘ä»¬æ¥å…¥ useTransition è¯•è¯•ï¼š\n\n```js\nconst [isPending, startTransition] = useTransition();\n  const [tab, setTab] = useState('about');\n\n  function selectTab(nextTab) {\n    startTransition(() =\u003e {\n      setTab(nextTab);      \n    });\n  }\n```\n\nå†æ¬¡åˆ‡æ¢ tab çœ‹çœ‹æ•ˆæœï¼š\n\n![image.png](/img/posts/2023-8-18/2023-8-18-2.png)\n\næˆªå›¾çœ‹çš„ä¸æ˜æ˜¾ï¼Œæˆ‘åœ¨å›¾ä¸ŠæŠŠæ•ˆæœç”¨æ–‡å­—æ ‡è¯†å‡ºæ¥äº†ã€‚ä¹Ÿå°±æ˜¯è¯´è·Ÿ startTransition ç›¸å…³çš„ state çš„å˜åŒ–å¼•èµ·çš„æ¸²æŸ“éƒ½ä¼šè¿›å…¥è¿‡æ¸¡ä¸­ã€‚\n\n2. å­ç»„ä»¶æ›´æ”¹çˆ¶ç»„ä»¶ state\n\nä¸Šé¢çš„ä¾‹å­ï¼Œä½ ä¹Ÿå¯ä»¥å°†æ›´æ”¹ state çš„æ“ä½œæ”¾åœ¨å­ç»„ä»¶ä¸­ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬æ”¹å†™ tabButton ç»„ä»¶ï¼š\n\n```js\n\u003cbutton onClick={() =\u003e {\n  startTransition(() =\u003e {\n    // è°ƒç”¨çˆ¶ç»„ä»¶TabContainerçš„ selectTab æ–¹æ³•\n    onClick();\n  });\n}}\u003e\n  {children}\n\u003c/button\u003e\n```\nè€Œåœ¨çˆ¶ç»„ä»¶ä¸­ï¼Œå°±å¯ä»¥ç›´æ¥è®¾ç½® state äº†ï¼š\n\n```js\nfunction selectTab(nextTab) { \n  setTab(nextTab); \n}\n```\n\n3. é¡µé¢ä¸Šæ˜¾ç¤ºé˜»å¡æ¸²æŸ“æ—¶çš„è¿›åº¦\n\nè¿™ä¸ªå°±æ˜¯ useTransition çš„è¿”å›å€¼ isPending çš„åº”ç”¨ï¼Œä»–ä¸º true æ—¶è¡¨ç¤ºè¿™ä¸ªè¿‡æ¸¡åŠ¨ç”»è¿˜åœ¨è¿›è¡Œä¸­ã€‚\n\n```js\nconst [isPending, startTransition] = useTransition();\n \nif (isPending) {\n  return \u003cb className=\"pending\"\u003e{children}\u003c/b\u003e;\n}\n```\n\n4. ä¸ Suspends ç»“åˆï¼Œåšç»„ä»¶æ‡’åŠ è½½\n\næ²¿ç”¨ç¬¬äºŒä¸ªä¾‹å­çš„ä»£ç ï¼Œå­ç»„ä»¶tabButtonå®ç°useTransitionï¼Œæˆ‘ä»¬åªæ”¹çˆ¶ç»„ä»¶ï¼š\n\n```js\n\u003cSuspense fallback={\u003ch1\u003eğŸŒ€ Loading...\u003c/h1\u003e}\u003e\n  \u003cTabButton\n    isActive={tab === 'about'}\n    onClick={() =\u003e setTab('about')}\n  \u003e\n    About\n  \u003c/TabButton\u003e\n  ...\n\u003c/Suspense\u003e\n```\nè¿™æ ·åœ¨ç¬¬ä¸€æ¬¡åŠ è½½æ—¶å°±ä¼šå‡ºç° fallbackæç¤ºï¼š\n\n\n![image.png](/img/posts/2023-8-18/2023-8-18-3.png)\n\nä½¿ç”¨ Suspense çš„å¥½å¤„åœ¨äºï¼Œå¤æ‚ç»„ä»¶åªéœ€åŠ è½½ä¸€æ¬¡ï¼Œç¬¬äºŒæ¬¡åˆ‡æ¢åŠ è½½æ—¶å°±è¢«ç¼“å­˜äº†ï¼Œå¯ä»¥å¾ˆå¿«çš„æ¸²æŸ“.\n\n5. è‡ªå®šä¹‰ä¸€ä¸ªè‡ªå·±çš„ react è·¯ç”±ï¼ï¼ˆå½“ç„¶ä¸æ˜¯çœŸçš„è·¯ç”±ï¼‰\n\n\næˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·å®šä¹‰ä¸€ä¸ª Router å‡½æ•°ï¼š\n\n```js\nfunction Router() {\n  const [page, setPage] = useState('/');\n  const [isPending, startTransition] = useTransition();\n\n  function navigate(url) {\n    startTransition(() =\u003e {\n      setPage(url);\n    });\n  }\n\n  let content;\n  if (page === '/') {\n    content = (\n      \u003cIndexPage navigate={navigate} /\u003e\n    );\n  } else if (page === '/the-beatles') {\n    content = (\n      \u003cArtistPage\n        artist={{\n          id: 'the-beatles',\n          name: 'The Beatles',\n        }}\n      /\u003e\n    );\n  }\n  return (\n    \u003cLayout isPending={isPending}\u003e\n      {content}\n    \u003c/Layout\u003e\n  );\n}\n```\næ¥åˆ†æä¸€ä¸‹ï¼Œä¸Šé¢ Layout ç»„ä»¶æ˜¯è‡ªå·±å®šä¹‰çš„ä¸€ä¸ªå®¹å™¨ç»„ä»¶ï¼Œå†…éƒ¨ç›´æ¥æŠ›å‡º children å±æ€§å³å¯ï¼›ä¸Šé¢åˆ¤æ–­å½“å‰çš„çŠ¶æ€ page æ˜¯ `'/the-beatles'` å’Œ `'/'` æ—¶ï¼Œè‡ªåŠ¨æ¸²æŸ“ä¸åŒçš„ç»„ä»¶ï¼›å…¶ä¸­ï¼Œ`navigate` å‡½æ•°ç”¨äºå¯¼èˆªè·³è½¬ï¼Œä»–å…¶å®æ“ä½œçš„å°±æ˜¯ä¸€ä¸ªå¸¦ Transition çš„ setPageï¼Œè¿™æ ·å°±å®ç°äº†ä¸€ä¸ªå¹³æ»‘çš„è·¯ç”±åˆ‡æ¢ã€‚\n\n\n### Q\u0026A\n\n1. ä¸ºå•¥æˆ‘çš„ input ä¸­ useTransition ä¸ç”Ÿæ•ˆï¼Ÿï¼Ÿ\n\nå› ä¸ºä½ è¯•å›¾ç”¨ä»–æ¥æ§åˆ¶è¾“å…¥æ¡†ï¼Œè¿™æ˜¯ä¸æ”¯æŒçš„ï¼š\n\n```js\nconst [text, setText] = useState('');\n// ...\nfunction handleChange(e) {\n  // âŒ Can't use transitions for controlled input state\n  startTransition(() =\u003e {\n    setText(e.target.value);\n  });\n}\n// ...\nreturn \u003cinput value={text} onChange={handleChange} /\u003e;\n```\nè¿™æ˜¯å› ä¸º useTransition æ˜¯éé˜»å¡æ¸²æŸ“çš„ï¼Œä½†æ˜¯è¾“å…¥æ¡†æ¯”è¾ƒç‰¹æ®Šï¼Œä»–çš„ change äº‹ä»¶å¿…é¡»æ˜¯åŒæ­¥æ›´æ–°çš„ï¼Œå¦‚æœä½ éè¦ä½¿ç”¨å¹³æ»‘è¿‡æ¸¡æ¥æ§åˆ¶è¾“å…¥ç»„ä»¶ï¼Œæœ‰å¦‚ä¸‹ä¸¤ç§æ–¹æ¡ˆï¼š\n\n- å®šä¹‰ä¸¤ä¸ª stateï¼Œä¸€ä¸ªç”¨äºæ§åˆ¶è¾“å…¥ï¼Œä¸€ä¸ªç”¨äºç›‘å¬è¾“å…¥å€¼å˜åŒ–ååŒæ­¥æ›´æ–°\n- ä½¿ç”¨ [`useDeferredValue`](https://react.dev/reference/react/useDeferredValue) æ¥ä»£æ›¿\n\n2. æˆ‘çš„ state å˜åŒ–ä¼¼ä¹æ²¡æœ‰å®ç°è¿‡æ¸¡ï¼Œè¿˜æ˜¯è¢«é˜»å¡äº†ï¼Ÿ\n\nå› ä¸ºä½ åœ¨ startTransition ä½¿ç”¨å¼‚æ­¥äº†ï¼š\n\n```js\n// æ¡ˆä¾‹1\nstartTransition(() =\u003e {\n  // âŒ Setting state *after* startTransition call\n  setTimeout(() =\u003e {\n    setPage('/about');\n  }, 1000);\n});\n\n// æ¡ˆä¾‹2\nstartTransition(async () =\u003e {\n  await someAsyncFunction();\n  // âŒ Setting state *after* startTransition call\n  setPage('/about');\n});\n```\nå¦‚æœéå¾—ä½¿ç”¨ setTimeoutï¼Œå¯ä»¥è¿™æ ·ï¼š\n\n```js\n// æ¡ˆä¾‹1\nsetTimeout(() =\u003e {\n  startTransition(() =\u003e {\n    // âœ… Setting state *during* startTransition call\n    setPage('/about');\n  });\n}, 1000);\n\n// æ¡ˆä¾‹2\nawait someAsyncFunction();\nstartTransition(() =\u003e {\n  // âœ… Setting state *during* startTransition call\n  setPage('/about');\n});\n```\n\n3. æˆ‘çš„ä»£ç æ‰§è¡Œé¡ºåºä¸å¤ªå¯¹ï¼šit will print 1, 2, 3:\n\n```js\nconsole.log(1);\nstartTransition(() =\u003e {\n  console.log(2);\n  setPage('/about');\n});\nconsole.log(3);\n```\nä½†æ˜¯ï¼Œ1 2 3 å°±åº”è¯¥æ˜¯æœŸæœ›çš„é¡ºåºï¼Œä¸åŒäº setTimeoutï¼ŒstartTransition è¿˜æ˜¯ç«‹å³æ‰§è¡Œå‡½æ•°çš„ï¼Œåªæ˜¯æ¸²æŸ“ä¸åŒæ­¥è€Œå·²ï¼Œä»–çš„ç®€å•å®ç°ç±»ä¼¼äºï¼š\n\n```js\nlet isInsideTransition = false;\n\nfunction startTransition(scope) {\n  isInsideTransition = true;\n  scope();\n  isInsideTransition = false;\n}\n\nfunction setState() {\n  if (isInsideTransition) {\n    // ... schedule a transition state update ...\n  } else {\n    // ... schedule an urgent state update ...\n  }\n}\n```\nå…¶å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ isInsideTransition = trueï¼Œåœ¨æ‰§è¡Œå®Œå›è°ƒå‡½æ•°åï¼Œç½®ä¸º falseï¼›è®¾ç½® state æ—¶åˆ¤æ–­ä¸º true æ—¶è¡¨ç¤ºåœ¨è¿‡æ¸¡ä¸­ï¼Œæ­¤æ—¶æ‰§è¡Œè¿‡æ¸¡çš„æ“ä½œã€‚æ‰€ä»¥å¯ä»¥çœ‹åˆ°ï¼Œä»–å¹¶ä¸é˜»å¡ scope çš„æ‰§è¡Œã€‚\n\n\n## 2. useDeferredValue\n\nä¸€ä¸ªå¯ä»¥è®©ä½ å»¶è¿Ÿï¼ˆdeferï¼‰æ›´æ–°UIçš„ hookã€‚\n\n- æ¥æ”¶å‚æ•° valueï¼šä½ æƒ³è¦å»¶è¿Ÿçš„å€¼ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹ã€‚\n- è¿”å›å€¼ï¼šåœ¨åˆå§‹æ¸²æŸ“æœŸé—´ï¼Œè¿”å›çš„å»¶è¿Ÿå€¼å°†ä¸ä½ æä¾›çš„å€¼ç›¸åŒã€‚åœ¨æ›´æ–°æœŸé—´ï¼ŒReact å°†é¦–å…ˆå°è¯•ä½¿ç”¨æ—§å€¼é‡æ–°æ¸²æŸ“ï¼ˆå› æ­¤å®ƒå°†è¿”å›æ—§å€¼ï¼‰ï¼Œç„¶åå°è¯•ä½¿ç”¨æ–°å€¼åœ¨åå°é‡æ–°æ¸²æŸ“ï¼ˆå› æ­¤å®ƒå°†è¿”å›æ›´æ–°çš„å€¼ï¼‰ã€‚\n\n### ä½¿ç”¨æ¡ˆä¾‹\n\n1. å¼¥è¡¥useTransitionä¸è¶³ï¼šç›‘å¬inputè¾“å…¥å¹¶å¹³æ»‘è¿‡æ¸¡\n\n```js\nimport { Suspense, useState } from 'react';\nimport SearchResults from './SearchResults.js';\n\nexport default function App() {\n  const [query, setQuery] = useState('');\n  const deferredQuery = useDeferredValue(query);\n  \n  return (\n    \u003c\u003e\n      \u003clabel\u003e\n        Search albums:\n        \u003cinput value={query} onChange={e =\u003e setQuery(e.target.value)} /\u003e\n      \u003c/label\u003e\n      \u003cSuspense fallback={\u003ch2\u003eLoading...\u003c/h2\u003e}\u003e\n        \u003cSearchResults query={deferredQuery} /\u003e\n      \u003c/Suspense\u003e\n    \u003c/\u003e\n  );\n}\n```\nä¸Šé¢çš„ä¾‹å­ï¼Œæ¯å½“è¾“å…¥æ¡†è¾“å…¥æ—¶ï¼ŒSuspense çš„ fallback å°†ä¸å†æ¸²æŸ“ï¼Œè€Œæ˜¯ç›´æ¥å¹³æ»‘è¿‡æ¸¡æ˜¾ç¤ºæœ€æ–°çš„å€¼ï¼Œè¿™å°±ä½¿å¾—æ˜¾ç¤ºæ›´åŠ ç¨³å®šï¼Œä¸ä¼šæŠ–åŠ¨ã€‚\n\n\n![image.png](/img/posts/2023-8-18/2023-8-18-4.png)\n\nä¸Šå›¾ä¸­ï¼Œè¾“å…¥å€¼ï¼Œè¾“å…¥æ¡†ç«‹é©¬å˜åŒ–ï¼Œä¸‹é¢æ˜¾ç¤ºåŒºåŸŸæ¼”ç¤ºå˜åŒ–ï¼Œä½†ä¸ä¼šæ˜¾ç¤º fallback çš„ loadingã€‚\n\n2. æ·»åŠ æ¸²æŸ“è¿‡åº¦åŠ¨ç”»\n\nåœ¨ä¸Šé¢ä¾‹å­çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ ä¸€ä¸ªé€æ˜æ•ˆæœï¼š\n\n```js\n // æ—§å€¼å’Œæ–°å€¼ä¸ä¸€æ ·ï¼Œè¡¨ç¤ºåœ¨è¿‡æ¸¡ä¸­ï¼Œè¿‡æ¸¡å®Œæ¯•å query ä¼šå˜ä¸ºä¸ deferredQuery ä¸€æ ·\n const isStale = query !== deferredQuery;\n ...\n \u003cSuspense fallback={\u003ch2\u003eLoading...\u003c/h2\u003e}\u003e\n    \u003cdiv style={{\n      opacity: isStale ? 0.5 : 1,\n      transition: isStale ? 'opacity 0.2s 0.2s linear' : 'opacity 0s 0s linear'\n    }}\u003e\n      \u003cSearchResults query={deferredQuery} /\u003e\n    \u003c/div\u003e\n\u003c/Suspense\u003e\n```\nå¦‚å›¾ï¼Œåœ¨è¾“å…¥è¿‡ç¨‹ä¸­ï¼Œç»“æœæ–‡å­—å˜ä¸ºåŠé€æ˜ï¼š\n\n![image.png](/img/posts/2023-8-18/2023-8-18-5.png)\n\n3. ä¼˜åŒ–é•¿åˆ—è¡¨æ¸²æŸ“\n\nSlowList å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè‚¥è‚ å¤šæ•°æ®çš„é•¿åˆ—è¡¨ï¼Œæ¯ä¸€ä¸ªåˆ—è¡¨éƒ½æœ‰ä¸€ä¸ªå…¬å…±çš„å€¼è¦æ§åˆ¶ï¼Œå«åš deferredTextï¼Œæˆ‘ä»¬è¿™æ ·å®ç°ï¼š\n\n```js\nexport default function App() {\n  const [text, setText] = useState('');\n  const deferredText = useDeferredValue(text);\n  return (\n    \u003c\u003e\n      \u003cinput value={text} onChange={e =\u003e setText(e.target.value)} /\u003e\n      \u003cSlowList text={deferredText} /\u003e\n    \u003c/\u003e\n  );\n}\n\n```\nè¿™æ ·è¿‡æ¸¡æ˜¯å°±ä¸ä¼šå‡ºç°çŸ­æ—¶é—´ç•Œé¢å¡é¡¿ä¸å¯äº¤äº’çš„æƒ…å†µï¼Œä¸ç„¶å°±ä¼šè¿™æ ·ï¼š\n\n![image.png](/img/posts/2023-8-18/2023-8-18-6.png)\n\nä¸Šå›¾ä¸ä½¿ç”¨useDeferredValueï¼Œæ²¡è¾“å…¥ä¸€ä¸‹ï¼Œå°±ä¼šå¡ä¸€ä¸‹ï¼Œé¡µé¢é˜»å¡ã€‚ä½¿ç”¨äº† useDeferredValue å°±ä¼šä¸€æ­¥æ¸²æŸ“ï¼Œä¸ä¼šé˜»å¡ä½ è¾“å…¥å•¦ï¼å¯ä»¥å»å®˜ç½‘ä¾‹å­è¯•è¯•ï¼š[codesandbox.io/s/r6hcz2?file=%2FApp.js\u0026utm_medium=sandpack](https://codesandbox.io/s/r6hcz2?file=%2FApp.js\u0026utm_medium=sandpack)\n\n\u003e `SlowList` ç»„ä»¶åº”è¯¥æ”¾åœ¨ memo é‡Œï¼Œä¸ç„¶ä¼˜åŒ–ä¼šå¤±æ•ˆã€‚æ¯æ¬¡deferredTextå˜åŒ–æ—¶ï¼ŒAppç»„ä»·ç”±äºçŠ¶æ€å˜åŒ–äº†ï¼Œä¼šé‡æ–°æ¸²æŸ“ï¼Œå¯¼è‡´ SlowList å˜ä¸ºäº†æ–°çš„ç»„ä»¶äº†ã€‚\n\n-----\nå®Œï¼"])</script><script>self.__next_f.push([1,"2a:T1850,"])</script><script>self.__next_f.push([1,"å®˜ç½‘åœ°å€ï¼š[React](https://react.dev/)\n\n## 1. useId\n\n`useId` æ˜¯ä¸€ä¸ªç”Ÿæˆå”¯ä¸€Idçš„hookã€‚\n\nå…¶ä¸æ¥æ”¶å‚æ•°ï¼Œè¿”å›å€¼å°±æ˜¯ç”Ÿæˆçš„Idï¼Œè¿™ä¸ªIdå¯ä»¥ä¿è¯åœ¨å½“å‰çš„ç»„ä»¶å†…éƒ¨ä¸é‡å¤ï¼Œä¸ç®¡ç»„ä»¶åå¤æ¸²æŸ“å¤šå°‘æ¬¡ã€‚\n\n\u003e æ³¨æ„ï¼Œè¿™å¯æ˜¯ä¸€ä¸ª hookï¼Œä¸èƒ½åœ¨ for å¾ªç¯ä¸­ä½¿ç”¨ï¼Œè¿™å°±å¼ºåˆ¶ä½ å…»æˆå¥½ä¹ æƒ¯ï¼šé¢å‘ç»„ä»¶ç¼–ç¨‹ã€‚\n\n#### ä½¿ç”¨æ¡ˆä¾‹\n\nä¸€ä¸ªå¯†ç æ¡†ç»„ä»¶ï¼š\n\n```jsx\nimport { useId } from 'react';\n\nfunction PasswordField() {\n  const passwordHintId = useId();\n  return (\n    \u003c\u003e\n      \u003clabel\u003e\n        Password:\n        \u003cinput\n          type=\"password\"\n          aria-describedby={passwordHintId}\n        /\u003e\n      \u003c/label\u003e\n      \u003cp id={passwordHintId}\u003e\n        The password should contain at least 18 characters\n      \u003c/p\u003e\n    \u003c/\u003e\n  );\n}\n```\n\nä¸Šé¢ä¾‹å­ä¸­ï¼Œaria-describedby æ˜¯ [HTML accessibility](https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA)å±æ€§ï¼Œç”¨äºå’Œå…¶ä»–å…ƒç´ å…³è”ä»¥æ–¹ä¾¿é˜…è¯»å™¨è¯»å–ã€‚\n \n\u003e ç¬”è€…è®¤ä¸º React ä¸­ useId å¾ˆé¸¡è‚‹ï¼Œä¸èƒ½ç”¨äºå¾ªç¯æ¸²æŸ“åˆ—è¡¨ï¼Œå¤§å¤šæ•°åœºæ™¯éƒ½ä¸å¤ªç”¨çš„ä¸Šï¼Œè‡³å°‘ç›®å‰æ˜¯è¿™æ ·ã€‚\n\n## 2. useSyncExternalStore\n\nç”¨äºè®¢é˜…ç¬¬ä¸‰æ–¹ store çš„hookã€‚è¿™ä¸ª hook å¯ä»¥è®©æˆ‘ä»¬ä¸ä½¿ç”¨ redux/useReducer/useState æ¥è·å¾—å­˜å‚¨çŠ¶æ€çš„èƒ½åŠ›ã€‚\n\nä½¿ç”¨æ–¹å¼ï¼š\n\n```js\nconst snapshot = useSyncExternalStore(subscribe, getSnapshot, getServerSnapshot)\n```\n\nå…¶ä¸­ï¼š\n\n- `subscribe`ï¼šè®¢é˜…çš„å›è°ƒå‚æ•°ï¼Œå¯ç”¨äºå­˜å‚¨ storeã€‚å…¶å¿…é¡»è¿”å›ä¸€ä¸ª å–æ¶ˆè®¢é˜…çš„æ¸…ç†å‡½æ•°ã€‚\n- `getSnapshot`ï¼šç”¨äºè¿”å›ç»„ä»¶æ‰€éœ€çš„å­˜å‚¨åŒºä¸­çš„æ•°æ®å¿«ç…§çš„å‡½æ•°ã€‚å½“å­˜å‚¨æœªæ›´æ”¹æ—¶ï¼Œå¯¹ getSnapshot çš„é‡å¤è°ƒç”¨å¿…é¡»è¿”å›ç›¸åŒçš„å€¼ã€‚å¦‚æœå­˜å‚¨æ›´æ”¹å¹¶ä¸”è¿”å›å€¼ä¸åŒï¼ˆObject.is ï¼‰ï¼Œå³ä¸æ˜¯çº¯å‡½æ•°ï¼ŒReact å°†é‡æ–°æ¸²æŸ“ç»„ä»¶\n- `getServerSnapshot`ï¼šå¯é€‰å‚æ•°ã€‚è¿”å›å­˜å‚¨ä¸­æ•°æ®çš„åˆå§‹å¿«ç…§çš„å‡½æ•°ã€‚ä»…åœ¨ æœåŠ¡ç«¯æ¸²æŸ“æœŸé—´æˆ–è€…å®¢æˆ·ç«¯ hydration æ—¶ä½¿ç”¨ã€‚å¦‚æœçœç•¥æ­¤å‚æ•°ï¼ŒSSRåº”ç”¨ä¸­ï¼ŒæœåŠ¡å™¨ä¸Šå‘ˆç°ç»„ä»¶å°†å¼•å‘é”™è¯¯ã€‚\n- `snapshot`: å½“å‰ store çš„å¿«ç…§ (æ˜¯ store çš„æ·±æ‹·è´)\n\n### ä½¿ç”¨æ¡ˆä¾‹\n\n- 1ã€è‡ªå®šä¹‰ store å®ç° todoListï¼š\n\n```js\nimport { useSyncExternalStore } from 'react';\nimport { todosStore } from './todoStore.js';\n\nexport default function TodosApp() {\n  const todos = useSyncExternalStore(todosStore.subscribe, todosStore.getSnapshot);\n  return (\n    \u003c\u003e\n      \u003cbutton onClick={() =\u003e todosStore.addTodo()}\u003eAdd todo\u003c/button\u003e\n      \u003chr /\u003e\n      \u003cul\u003e\n        {todos.map(todo =\u003e (\n          \u003cli key={todo.id}\u003e{todo.text}\u003c/li\u003e\n        ))}\n      \u003c/ul\u003e\n    \u003c/\u003e\n  );\n}\n\n// todoStore.js\nlet nextId = 0;\nlet todos = [{ id: nextId++, text: 'Todo #1' }];\nlet listeners = [];\n\nexport const todosStore = {\n  addTodo() {\n    todos = [...todos, { id: nextId++, text: 'Todo #' + nextId }]\n    emitChange();\n  },\n  subscribe(listener) {\n    listeners = [...listeners, listener];\n    return () =\u003e {\n      listeners = listeners.filter(l =\u003e l !== listener);\n    };\n  },\n  getSnapshot() {\n    return todos;\n  }\n};\n\nfunction emitChange() {\n  for (let listener of listeners) {\n    listener();\n  }\n}\n```\n\nä¸Šé¢çš„ä¾‹å­ï¼Œè‡ªå®šä¹‰çš„ subscribe è¯»å–äº†æ‰€æœ‰ç›‘å¬å™¨å‡½æ•°ï¼Œä½¿ç”¨æ•°ç»„æ¥ç»´æŠ¤ã€‚æ¸…ç†å‡½æ•°ä¸­ï¼Œè¿‡æ»¤æ‰äº†å½“å‰çš„ç›‘å¬å™¨ï¼› getSnapshot åˆ™è¿”å›äº† storeã€‚\n\n\u003e ä¸€èˆ¬ä¸Šï¼Œ`useSyncExternalStore` API é€šå¸¸ç”¨äºé›†æˆ non-React ä»£ç .\n\n- 2,ã€ä¼ é€’ä¸€ä¸ªç›‘å¬äº‹ä»¶ï¼Œåˆ¤æ–­å½“å‰ç½‘ç»œè¿æ¥çŠ¶æ€ï¼š\n\n```js\nimport { useSyncExternalStore } from 'react';\n\nexport default function ChatIndicator() {\n  const isOnline = useSyncExternalStore(subscribe, getSnapshot);\n  return \u003ch1\u003e{isOnline ? 'âœ… Online' : 'âŒ Disconnected'}\u003c/h1\u003e;\n}\n\nfunction getSnapshot() {\n  return navigator.onLine;\n}\n\nfunction subscribe(callback) {\n  window.addEventListener('online', callback);\n  window.addEventListener('offline', callback);\n  return () =\u003e {\n    window.removeEventListener('online', callback);\n    window.removeEventListener('offline', callback);\n  };\n}\n```\nä¸Šé¢çš„è®¢é˜…äº‹ä»¶ä¸­ï¼Œç›‘å¬äº†åŸç”Ÿ online äº‹ä»¶ï¼Œå°†ç›‘å¬å™¨å½“åšå›è°ƒ callbackï¼Œè¿™æ ·ï¼Œå½“ navigator.onLine å˜åŒ–æ—¶ï¼ŒisOnline å°±ä¼šæ”¹å˜ã€‚\n\n- 3ã€ä¸è‡ªå®šä¹‰ hook ç»„åˆ\n\nä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªå°è£…åœ¨ä¸€ä¸ª hook é‡Œï¼š\n\n```js\nexport function useOnlineStatus() {\n  const isOnline = useSyncExternalStore(subscribe, getSnapshot);\n  return isOnline;\n}\n\n...\n```\nç°åœ¨å°±å¯ä»¥åœ¨å…¶ä»–ç»„ä»¶ä¸­ä½¿ç”¨äº†ï¼š\n\n```js\nfunction StatusBar() {\n  const isOnline = useOnlineStatus();\n  return \u003ch1\u003e{isOnline ? 'âœ… Online' : 'âŒ Disconnected'}\u003c/h1\u003e;\n}\n```\n\n- 4ã€æœåŠ¡ç«¯æ¸²æŸ“æ—¶é…ç½®\n\nå¦‚æœä½¿ç”¨äº†æœåŠ¡ç«¯æ¸²æŸ“ï¼Œè¿™å°±æ„å‘³ç€ä½ ä¸èƒ½å†ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦çš„APIï¼Œä¸Šé¢åˆ¤æ–­æ˜¯å¦åœ¨çº¿çš„ä¾‹å­å°±ä¸æˆç«‹äº†ã€‚æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹å†™ï¼š\n\n```js\nimport { useSyncExternalStore } from 'react';\n\nexport function useOnlineStatus() {\n  const isOnline = useSyncExternalStore(subscribe, getSnapshot, getServerSnapshot);\n  return isOnline;\n}\n\nfunction getSnapshot() {\n  return navigator.onLine;\n}\n\nfunction getServerSnapshot() {\n  return true; // Always show \"Online\" for server-generated HTML\n}\n\nfunction subscribe(callback) {\n  // ...\n}\n```\nä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé€šè¿‡ç¬¬ä¸‰ä¸ªå‚æ•° getServerSnapshot é…ç½®SSRï¼Œreturn å€¼å°±æ˜¯æ¸²æŸ“æ—¶è·å–åˆ°çš„ store çš„å€¼ã€‚\n\ngetServerSnapshot å‡½æ•°ç±»ä¼¼äº getSnapshotï¼Œä½†å®ƒä»…åœ¨ä¸¤ç§æƒ…å†µä¸‹æ‰§è¡Œï¼š\n\n1. ç”Ÿæˆ HTML æ—¶ï¼Œåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚\n2. å®ƒåœ¨ [hydration](https://react.dev/reference/react-dom/client/hydrateRoot) æœŸé—´åœ¨å®¢æˆ·ç«¯ä¸Šè¿è¡Œï¼Œå³å½“ React è·å–æœåŠ¡å™¨ HTML å¹¶ä½¿å…¶äº¤äº’æ—¶ã€‚\n\nä»–æä¾›ä¸€ä¸ªåœ¨é¡µé¢å¯äº¤äº’ä¹‹å‰çš„åˆå§‹å¿«ç…§å€¼ã€‚å¦‚æœæœåŠ¡å™¨å‘ˆç°æ²¡æœ‰æœ‰æ„ä¹‰çš„åˆå§‹å€¼ï¼Œåˆ™ä¼šå¿½ç•¥æ­¤å‚æ•°å¹¶å¼ºåˆ¶åœ¨å®¢æˆ·ç«¯ä¸Šæ¸²æŸ“ã€‚\n\n\u003e ä½¿ç”¨æ—¶éœ€ç¡®ä¿ getServerSnapshot åœ¨åˆå§‹å®¢æˆ·ç«¯æ¸²æŸ“ä¸Šè¿”å›çš„æ•°æ®ä¸åœ¨æœåŠ¡å™¨ä¸Šè¿”å›çš„æ•°æ®å®Œå…¨ç›¸åŒã€‚\n\n\u003e ä¾‹å¦‚ï¼Œå¦‚æœ getServerSnapshot åœ¨æœåŠ¡å™¨ä¸Šè¿”å›äº†ä¸€äº›é¢„å¡«å……çš„å­˜å‚¨å†…å®¹ï¼Œåˆ™éœ€è¦å°†æ­¤å†…å®¹ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚ä¸€ç§æ–¹æ³•æ˜¯åœ¨æœåŠ¡å™¨æ¸²æŸ“æœŸé—´æ‰“ä¸€ä¸ª\\\u003cscript\u003eæ ‡ç­¾ï¼Œç”¨äºè®¾ç½®å…¨å±€å˜é‡ï¼Œç±»ä¼¼ `window.MY_STORE_DATA`ï¼Œç„¶ååœ¨ getServerSnapshot ä¸­ä»å®¢æˆ·ç«¯ä¸Šå…¨å±€è¯»å–ã€‚\n\n----\nå®Œï¼"])</script><script>self.__next_f.push([1,"2b:T2984,"])</script><script>self.__next_f.push([1,"- å®˜ç½‘åœ°å€ï¼š[React](https://beta.reactjs.org/)\n\n## 1. useContext\n\n`useContext` æ˜¯ä¸€ä¸ªä¼ é€’ç»„ä»¶ä¸Šä¸‹æ–‡çš„é’©å­ï¼Œæä¾›è¯»å–å’Œè®¢é˜…åŠŸèƒ½ã€‚\n\n\n### æ¥æ”¶å‚æ•°\n\n- contextï¼šæ˜¯ [`createContext`](https://react.dev/reference/react/createContext) åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ï¼Œä»–ä¸ä¿æŒä¿¡æ¯ï¼Œä»–æ˜¯ä¿¡æ¯çš„è½½ä½“ã€‚å£°æ˜äº†å¯ä»¥ä»ç»„ä»¶è·å–æˆ–è€…ç»™ç»„ä»¶æä¾›ä¿¡æ¯ã€‚åœ¨ provider ä¸­å¯ä»¥ä¼ é€’å…·ä½“çš„å€¼ã€‚\n\n### è¿”å›å€¼\n\n- contextValueï¼šè¿”å›ä¼ é€’çš„åªè¯»contextè½½ä½“çš„å€¼ã€‚æ˜¯è°ƒç”¨å †æ ˆä¸­ç»„ä»¶ä¸Šæ–¹æœ€è¿‘çš„ SomeContext.Provider å‡ºæ¥çš„å€¼ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„Providerï¼Œåˆ™è¿”å›çš„å€¼å°†æ˜¯ä¼ é€’ç»™è¯¥contextçš„ createContext çš„ defaultValueã€‚å…¶è¿”å›çš„å€¼å§‹ç»ˆæ˜¯æœ€æ–°çš„ã€‚å¦‚æœä¸Šä¸‹æ–‡å‘ç”Ÿå˜åŒ–ï¼ŒReact ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“è¯»å–contextçš„ç»„ä»¶ã€‚\n\n### æ³¨æ„äº‹é¡¹\n\n- useContext() ä¸å—åŒä¸€ç»„ä»¶å†…`\u003cContext.Provider\u003e`çš„å½±å“ã€‚useContext è¦æƒ³æ‹¿åˆ° provideræä¾›çš„ä¸Šä¸‹æ–‡ï¼Œä¸€å®šæ”¾åœ¨`\u003cContext.Provider\u003e`å†…éƒ¨åµŒå¥—çš„ç»„ä»¶ä¸­ã€‚\n- `\u003cContext.Provider\u003e`ä¼ é€’çš„contextçš„å€¼ï¼Œå¦‚æœå€¼å˜åŒ–äº†ï¼ˆObject.is åˆ¤æ–­æ³•ï¼‰ï¼Œå…¶ä¸‹å„çº§ç»„ä»¶å°±ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚å¯ä½¿ç”¨ memo è¿™ä¸ªAPIæ¥é˜»æ­¢é‡æ¸²æŸ“ã€‚\n- ç¡®ä¿ä¼ é€’contextçš„å¯¹è±¡å’Œè¯»å–contextçš„å¯¹è±¡æ˜¯åŒä¸€ä¸ªcontextï¼Œæœ€å¥½æå–ä¸ºå…¬å…±ç»„ä»¶ï¼Œä½¿ç”¨æ—¶å¼•ç”¨è¿™ä¸ªå•ä¾‹å³å¯ã€‚\n\n\u003e useContext() æ€»æ˜¯åœ¨è°ƒç”¨å®ƒçš„ç»„ä»¶ä¸Šçº§å¯»æ‰¾æœ€æ¥è¿‘çš„Providerã€‚å®ƒé€çº§å‘ä¸Šæœç´¢ï¼Œå¹¶ä¸”æ’é™¤æ‰ ä½¿ç”¨ useContext() çš„åŒçº§ç»„ä»¶ä¸­çš„Providerã€‚\n\n### å„ç§å‚è€ƒæ¡ˆä¾‹\n\n#### 1. ä¼ é€’ä¸»é¢˜é¢œè‰²\n\nåˆ›å»ºä¸€ä¸ª contextï¼š\n\n```js\nconst ThemeContext = createContext(null);\n```\n\nå®šä¹‰æ ¹ç»„ä»¶ï¼š\n\n```js\nexport default function MyApp() {\n  return (\n    \u003cThemeContext.Provider value=\"dark\"\u003e\n      \u003cForm /\u003e\n    \u003c/ThemeContext.Provider\u003e\n  )\n}\n```\nä»–å¾€ä¸‹æä¾›äº†ä¸€ä¸ª context çš„åˆå§‹å€¼ï¼Œå« darkã€‚åœ¨å­ç»„ä»¶ä¸­ï¼Œä½¿ç”¨ useContext å¼•å…¥ ThemeContextï¼Œè·å–åˆ°è¿™ä¸ªcontextè½½ä½“å…·ä½“çš„å€¼ï¼š\n\n```js\nfunction Panel({ title, children }) {\n  const theme = useContext(ThemeContext);\n  const className = 'panel-' + theme;\n  return (\n    \u003csection className={className}\u003e\n      \u003ch1\u003e{title}\u003c/h1\u003e\n      {children}\n    \u003c/section\u003e\n  )\n}\n```\n\n#### 2. åˆ‡æ¢ä¸»é¢˜é¢œè‰²\n\nåœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬æ·»åŠ æ›´æ–°ä¸»é¢˜é¢œè‰²çš„åŠŸèƒ½ã€‚é¦–å…ˆåœ¨æ ¹ç»„ä»¶åŠ å…¥ä¸»é¢˜çš„stateå’Œæ”¹å˜çš„è¡¨å•å…ƒç´ ï¼š\n\n```js\n// MyApp\nconst [theme, setTheme] = useState('light');\n\n// ...\n\u003cThemeContext.Provider value={theme}\u003e\n   // ...\n   \u003cinput\n      type=\"checkbox\"\n      checked={theme === 'dark'}\n      onChange={(e) =\u003e {\n        setTheme(e.target.checked ? 'dark' : 'light')\n      }}\n    /\u003e\n// ...\n\u003c/ ThemeContext.Provider\u003e\n```\n\nç”±äº context æ˜¯åªè¯»çš„ï¼Œæ‰€ä»¥å­ç»„ä»¶ä¸éœ€è¦ä»»ä½•ä¿®æ”¹ã€‚æ ¹ç»„ä»¶ä¸­ç‚¹å‡» checkbox å°±å¯ä»¥æ”¹å˜å­ç»„ä»¶ä¸­çš„ classname äº†ã€‚\n\n\n#### 3. å¤šcontextåµŒå¥—çš„æƒ…å†µ\n\næˆ‘ä»¬åœ¨æ ¹ç»„ä»¶ä¸­å®šä¹‰ä¸¤ä¸ª Providerï¼š\n\n```js\nconst ThemeContext = createContext(null);\nconst CurrentUserContext = createContext(null);\n\n// ...\n\n\u003cThemeContext.Provider value={theme}\u003e\n  \u003cCurrentUserContext.Provider\n    value={{\n      currentUser,\n      setCurrentUser\n    }}\n  \u003e\n    \u003cWelcomePanel /\u003e\n// ...\n  \u003c/ CurrentUserContext.Provider\u003e\n\u003c/ ThemeContext.Provider\u003e\n```\n\nè¿™æ ·åœ¨å­ç»„ä»¶ WelcomePanel ä¸­å°±å¯ä»¥è·å–ï¼š\n\n```js\nconst {currentUser} = useContext(CurrentUserContex);\nconst {theme} = useContext(ThemeContext);\n```\nå¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ä¸åŒçš„ context è½½ä½“ï¼Œå¯ä»¥è·å–åˆ°ä¸åŒä½œç”¨åŸŸçš„å€¼ã€‚\n\n#### 4. å°è£…ä¸ºé«˜é˜¶ç»„ä»¶ï¼\n\nä¸Šé¢çš„ä»£ç ï¼Œcontext éƒ½äº¤ç»™æ ¹ç»„ä»¶ç»´æŠ¤ï¼Œä»£ç è€¦åˆæ€§æ¯”è¾ƒé«˜ï¼Œå¯ä»¥ç»Ÿä¸€æå‡ºæ¥ä¸€ä¸ªæ–°ç»„ä»¶MyProvidersï¼š\n\n```js\nfunction MyProviders({ children, theme }) {\n  const [currentUser, setCurrentUser] = useState(null);\n  return (\n    \u003cThemeContext.Provider value={theme}\u003e\n      \u003cCurrentUserContext.Provider\n        value={{\n          currentUser,\n          setCurrentUser\n        }}\n      \u003e\n        {children}\n      \u003c/CurrentUserContext.Provider\u003e\n    \u003c/ThemeContext.Provider\u003e\n  );\n}\n```\n\nè¿™æ ·å†åº”ç”¨è¿™ä¸ªç»„ä»¶å°±ä¼šæ–¹ä¾¿å¾ˆå¤šï¼š\n\n```js\n\u003cMyProviders theme={theme} setTheme={setTheme}\u003e\n  // ...\n\u003c/MyProviders\u003e\n```\n\n\u003e P.S. ä¸Šé¢çš„ä¾‹å­æœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œä¸€ä¸ªå…¨å±€çš„ Contextï¼ŒåŠ ä¸Š useReducerï¼ˆuseStateï¼‰ å°±æ˜¯ä¸€ä¸ªå°å‹çš„ reduxï¼Œæ¯”å¦‚ä¸‹é¢çš„[ä¾‹å­](https://codesandbox.io/s/3pzgg8?file=/AddTask.js\u0026utm_medium=sandpack)ï¼š\n\n```js\nexport function TasksProvider({ children }) {\n  const [tasks, dispatch] = useReducer(\n    tasksReducer,\n    initialTasks\n  );\n\n  return (\n    \u003cTasksContext.Provider value={tasks}\u003e\n      \u003cTasksDispatchContext.Provider value={dispatch}\u003e\n        {children}\n      \u003c/TasksDispatchContext.Provider\u003e\n    \u003c/TasksContext.Provider\u003e\n  );\n}\n```\n\n#### 5. åŒä¸€ä¸ªcontextï¼Œå±€éƒ¨ä¿®æ”¹çŠ¶æ€\n\næ¯”å¦‚åœ¨å…¨å±€ç™½è‰²èƒŒæ™¯ä¸‹ï¼Œæƒ³è¦åœ¨å±€éƒ¨çš„ç»„ä»¶ä¸­ä½¿ç”¨å…¶ä»–ä¸»é¢˜è‰²ï¼Œå¯ä»¥è¿™æ ·å®šä¹‰ï¼š\n\n```js\n\u003cThemeContext.Provider value=\"light\"\u003e\n  ...\n  \u003cThemeContext.Provider value=\"dark\"\u003e\n    \u003cFooter /\u003e\n  \u003c/ThemeContext.Provider\u003e\n  ...\n\u003c/ThemeContext.Provider\u003e\n```\n\n#### 6. æ€§èƒ½ä¼˜åŒ–ï¼šåœ¨ä¼ å€¼æ—¶é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“\n\nè€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š\n\n```js\n\u003cAuthContext.Provider value={{ currentUser, login }}\u003e\u003c/ AuthContext.Provider\u003e\n```\n\nä¼ é€’çš„contextæ˜¯ä¸€ä¸ªå¯¹è±¡(currentUser)å’Œä¸€ä¸ªå‡½æ•°(login)ï¼Œåœ¨é¡¶å±‚ç»„ä»¶é‡æ¸²æŸ“æ—¶ï¼Œä»–ä»¬å¯èƒ½ä¼šè¢«é‡æ–°åˆ›å»ºï¼Œè¿›è€Œé€ æˆcontexté‡æ¸²æŸ“ã€‚æ‰€ä»¥è¿™é‡Œå¯¹æ³¨å…¥çš„è¢«å­—é¢é‡å€¼ä¹Ÿè¦åšç¼“å­˜ï¼š\n\n```js\nconst login = useCallback((response) =\u003e {...})\n\nconst contextValue = useMemo(() =\u003e ({  \n  currentUser,  \n  login  \n}), [currentUser, login]);\n\n// ä½¿ç”¨\n\u003cAuthContext.Provider value={contextValue}\u003e\u003c/ AuthContext.Provider\u003e\n// ...\n```\n\n### Q\u0026A\n\n#### 1. æˆ‘çš„ç»„ä»¶ä¸ºä»€ä¹ˆæ‹¿ä¸åˆ°contextæä¾›çš„æ•°æ®\n\næ’æŸ¥å¯èƒ½çš„åŸå› ï¼š\n\n- ä½ åœ¨ `\u003cSomeContext.Provider\u003e` åŒä¸€çº§ç»„ä»¶ä¸­ä½¿ç”¨äº† useContext() \n- ä½ æ²¡æœ‰ç”¨ `\u003cSomeContext.Provider\u003e` åŒ…è£¹ä¸Šçº§ç»„ä»¶\n- ç”±äºæ‰“åŒ…é—®é¢˜æˆ–è€…ä»£ç å¼•å…¥çš„é—®é¢˜ï¼Œä½ æä¾›contextçš„åœ°æ–¹å’Œä½¿ç”¨contextçš„åœ°æ–¹ï¼Œå¼•ç”¨çš„ä¸æ˜¯ä¸€ä¸ªContextå¯¹è±¡ã€‚æ¯”å¦‚ä½ ä½¿ç”¨å…¨å±€å˜é‡æŒ‚è½½äº†å¤šä¸ª contextï¼š`window.SomeContext1`Â andÂ `window.SomeContext2`ï¼Œä½ éœ€è¦ä½¿ç”¨ `===` æå‰åˆ¤æ–­æ˜¯å¦ç›¸åŒã€‚\n\n\n#### 2. å³ä½¿æˆ‘è®¾ç½®äº†åˆå§‹å€¼ï¼Œä½†æ˜¯æ€»æ˜¯åœ¨è·å–å€¼çš„æ—¶å€™æ‹¿åˆ° `undefined`\n\nä½ åœ¨ Provider æ—¶å¿˜è®°ä¼ é€’ value å±æ€§äº†ã€‚\n\n## 2. useRef\n\nç”¨äºè®¾ç½®ä¸€ä¸ªå¯å˜çš„å¼•ç”¨å€¼ï¼Œä¸éšç»„ä»¶æ¸²å˜åŒ–ã€‚ä¸ `useState` ä¸åŒï¼Œ`useRef` è¿”å›çš„å¼•ç”¨å¯¹è±¡åœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ä¿æŒä¸å˜ï¼Œè®¾ç½®å¼•ç”¨å€¼ä¹Ÿä¸ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚\n\n\u003e P.S. ç”±äº useRef æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œå…¶å†…éƒ¨çš„å€¼æ˜¯ä¸€ä¸ª current å¯¹è±¡æ¥æ¥å—çš„ï¼Œæ‰€ä»¥æœ‰äº›ä¸ç¡®å®šæ˜¯å¦æœ‰åˆå§‹å€¼çš„æƒ…å†µä¸‹ï¼Œéœ€è¦åˆ¤æ–­ ref.current æ˜¯å¦ä¸ºç©ºã€‚\n\n### å‚è€ƒæ¡ˆä¾‹\n\n###### 1. ç‚¹å‡»è®¡æ•°å™¨\n\næ³¨æ„ï¼Œè¿™ä¸ªè®¡æ•°å€¼çš„å˜åŒ–ï¼Œä¸ä¼šå¼•èµ·ç»„ä»¶é‡æ¸²æŸ“ï¼Œåœ¨ä¸éœ€è¦æ¸²æŸ“çš„åœºåˆé€‚ç”¨ã€‚æ‰€ä»¥åœ¨jsxä¸­è¿™ä¹ˆå†™æ˜¯ä¸ä¼šèµ·ä½œç”¨çš„ âŒï¼š`\u003cspan\u003e{ref.current}\u003c/span\u003e`\n\n```js\nlet ref = useRef(0);\n\nfunction handleClick() {\n  ref.current = ref.current + 1;\n  alert('You clicked ' + ref.current + ' times!');\n}\n```\n\n###### 2. è·å–inputçš„ç„¦ç‚¹\n\nuseRef å¯ä»¥æŒ‚è½½åœ¨åŸç”Ÿå…ƒç´ ä¸Šæ¥è·å–å…¶DOMå¯¹è±¡æœ¬èº«ã€‚\n\n```js\nconst inputRef = useRef(null);\n\nfunction handleClick() {\n  inputRef.current.focus();\n}\n\n\u003cinput ref={inputRef} /\u003e\n```\n\n###### 3. æ§åˆ¶å…ƒç´ æ»šåŠ¨\n\nH5 æœ‰ä¸ªAPIå« `scrollIntoView`, è·å–åˆ° DOM å…ƒç´ åå¯ä»¥æ§åˆ¶å°†å…¶æ»šåŠ¨åˆ°ç‰¹å®šçš„ä½ç½®ï¼š\n\n```js\nconst listRef = useRef(null);\n\nfunction scrollToIndex(index) {\n    const listNode = listRef.current;\n    // This line assumes a particular DOM structure:\n    const imgNode = listNode.querySelectorAll('li \u003e img')[index];\n    imgNode.scrollIntoView({\n      behavior: 'smooth',\n      block: 'nearest',\n      inline: 'center'\n    });\n}\n\n// ...\n\u003cul ref={listRef}\u003e\n  \u003cli onClick={scrollToIndex(0)}\u003e\u003cimg ... /\u003e\u003c/li\u003e\n  \u003cli onClick={scrollToIndex(1)}\u003e\u003cimg ... /\u003e\u003c/li\u003e\n  \u003cli onClick={scrollToIndex(2)}\u003e\u003cimg ... /\u003e\u003c/li\u003e\n\u003c/ul\u003e\n```\n\n###### 4. æ§åˆ¶ video æ’­æ”¾\n\n```js\n// æ§åˆ¶æ–¹æ³•ä»£ç ç‰‡æ®µ\nif (!isPlaying) {\n  ref.current.play();\n} else {\n  ref.current.pause();\n}\n\n...\n// dom å®šä¹‰\n\u003cvideo\n    width=\"250\"\n    ref={ref}\n    onPlay={() =\u003e setIsPlaying(true)}\n    onPause={() =\u003e setIsPlaying(false)}\n  \u003e\n    \u003csource\n      src=\"https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4\"\n      type=\"video/mp4\"\n    /\u003e\n\u003c/video\u003e\n```\n\n###### 5. è‡ªå®šä¹‰ç»„ä»¶è®¾ç½® ref å±æ€§\n\nå› ä¸ºé»˜è®¤å‡½æ•°å¼ç»„ä»¶ä¸ä¼šå¾€å¤–æš´éœ² refs å±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦ç”¨ `forwardRef` å°†æˆ‘ä»¬çš„è‡ªå®šä¹‰ç»„ä»¶åŒ…è£¹åå¯¼å‡ºï¼š\n\n```js\n// å°† ref ç»™åˆ° input\nconst MyInput = forwardRef((props, ref) =\u003e {\n  return \u003cinput {...props} ref={ref} /\u003e;\n});\n```\næ¥ç€åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨åŒ…è£¹å¥½çš„ç»„ä»¶ï¼š\n\n```js\n\u003cMyInput ref={inputRef} /\u003e\n```\nä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæƒ³è¦æ‹¿åˆ°å­ç»„ä»¶å†…éƒ¨çš„ input å…ƒç´ å®ä¾‹ï¼Œåªéœ€ï¼š\n\n```js\ninputRef.current.focus();\n```\n\n## 3. useImperativeHandle\n\nè¿™ä¸ª hook éœ€è¦ç»“åˆ ref ä½¿ç”¨ï¼Œç”¨äºæ§åˆ¶åœ¨è‡ªå®šä¹‰ç»„ä»¶ä¸­å‘å¤–æš´éœ²å“ªäº›ç»„ä»¶å±æ€§æˆ–æ–¹æ³•ã€‚\n\nä¸Šé¢çš„ useRef åªèƒ½æ§åˆ¶è‡ªå®šä¹‰ç»„ä»¶æœ¬èº«çš„ DOMï¼Œå¦‚æœæƒ³è¦åœ¨çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶æœ¬èº«çš„æˆå‘˜æ–¹æ³•ï¼Œå°±éœ€è¦ç»“åˆ `useImperativeHandle` æ¥ä½¿ç”¨äº†ã€‚\n\n### æ¥æ”¶å‚æ•°\n\n- refï¼šç»„ä»¶forwardRefåŒ…è£¹åæš´éœ²å‡ºæ¥çš„ref\n- æ§åˆ¶å‡½æ•°ï¼šå…¶è¿”å›å€¼æ˜¯ä¸ªå¯¹è±¡ï¼Œåˆ—ä¸¾äº†æš´éœ²çš„æ–¹æ³•çš„å˜é‡\n\n### å‚è€ƒæ¡ˆä¾‹\n\n###### 1. å°è£…ä¸€ä¸‹ä¸Šé¢èšç„¦inputçš„åŠŸèƒ½\n\næˆ‘ä»¬å°†ä¸Šé¢åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨ `inputRef.current.focus();` çš„è¿‡ç¨‹ï¼Œåœ¨å­ç»„ä»¶ä¸­æš´éœ²æˆä¸€ä¸ªæ–¹æ³•ï¼š\n\n```js\n// MyInput\nuseImperativeHandle(ref, () =\u003e {\n    return {\n      focus() {\n        inputRef.current.focus();\n      },\n    }\n})\n```\n\nåœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨ï¼š\n\n```jsx\nref.current.focus();\n\n...\n\u003cMyInput label=\"Enter your name:\" ref={ref} /\u003e\n```\n\n###### 2. æš´éœ²å­ç»„ä»¶çš„æ–¹æ³•ç»™çˆ¶ç»„ä»¶\n\nå­ç»„ä»¶ï¼š\n\n```js\nuseImperativeHandle(ref, () =\u003e ({\n  getData: () =\u003e getData(filter),\n  refreshTable: () =\u003e refreshTable()\n}));\n```\n\nçˆ¶ç»„ä»¶ï¼š\n\n```js\ntableRef.current \u0026\u0026 tableRef.current.refreshTable();\n\n...\n\u003cCommonTable loading={loading} ref={tableRef}\u003e...\u003c/CommonTable\u003e\n```\n\nä¸Šé¢çš„ä»£ç ï¼Œå®ç°äº†åœ¨è‡ªå®šä¹‰è¡¨æ ¼ç»„ä»¶æ—¶ï¼Œé€šè¿‡çˆ¶ç»„ä»¶æ¥è°ƒç”¨è¡¨æ ¼ç»„ä»¶å†…éƒ¨æ–¹æ³•é‡æ–°è·å–æ•°æ®å’ŒåŸåœ°åˆ·æ–°çš„åŠŸèƒ½ã€‚\n\n\u003e P.S. ä¸è¦è¿‡åº¦ä½¿ç”¨ refs åŠŸèƒ½ã€‚ä»…ä»…éœ€è¦åœ¨ä¸€äº›èšç„¦ã€æ»šåŠ¨ã€åŠ¨ç”»å’Œé€‰ä¸­ç­‰ç­‰ä¸èƒ½é€šè¿‡propsä¼ é€’çš„å‘½ä»¤å¼çš„è¡Œä¸ºä¸Šä½¿ç”¨å³å¯ã€‚ä¸Šé¢çš„çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶çš„ä¾‹å­ï¼Œå®Œå…¨å¯ä»¥ç”¨ useEffect + props æˆ–è€… Events è§£å†³ã€‚"])</script><script>self.__next_f.push([1,"2c:T3fca,"])</script><script>self.__next_f.push([1,"- å®˜ç½‘åœ°å€ï¼š[React](https://beta.reactjs.org/)\n\n## 1. ä½¿ç”¨åœºæ™¯å¯¹æ¯”\n\n- `useEffect`: ç”¨äºå‰¯ä½œç”¨æ•è·ï¼Œåœ¨ dom å…ƒç´ æ¸²æŸ“ä¹‹åè°ƒç”¨ï¼Œå¸¸ç”¨äºé¡µé¢æ•°æ®å¤„ç†å·¥ä½œã€‚\n- `useLayoutEffect`: useEffect çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œåœ¨ DOM æ›´æ–°ä¹‹ååŒæ­¥æ‰§è¡Œï¼Œä½†åœ¨æµè§ˆå™¨ç»˜åˆ¶ä¹‹å‰æ‰§è¡Œï¼Œå¸¸ç”¨äºé¡µé¢å…ƒç´ å¸ƒå±€å·¥ä½œï¼Œå¯èƒ½ä¼šé˜»å¡é¡µé¢æ¸²æŸ“ã€‚\n- `useInsertionEffect`: useEffect çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œåœ¨ DOM æ›´æ–°å‰æ‰§è¡Œã€‚å¸¸ç”¨äº CSS-in-JS æ’å…¥åŠ¨æ€æ ·å¼ã€‚\n\n\n## 2. useEffect\n\nuseEffect æ˜¯ä¸€ä¸ªæ•è·å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œç”¨æ¥ä»£æ›¿ç±»å¼ç»„ä»¶ä¸­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚å£°æ˜æ–¹å¼å¦‚ä¸‹ï¼š\n\n```js\nuseEffect(setup, dependencies)\n```\n\n### å‚è€ƒèŒƒä¾‹\n\næ³¨æ„éœ€åœ¨ç»„ä»¶é¡¶å±‚ä½¿ç”¨\n\n```js\nfunction ChatRoom({ roomId }) {\n  const [serverUrl, setServerUrl] = useState('https://localhost:1234');\n\n  useEffect(() =\u003e {\n    const connection = createConnection(serverUrl, roomId);\n    connection.connect();\n    return () =\u003e {\n      connection.disconnect();\n    };\n  }, [serverUrl, roomId]);\n  // ...\n}\n```\n\n### æ¥æ”¶å‚æ•°\n\n1. setupï¼šå…·æœ‰ Effect é€»è¾‘çš„è®¾ç½®å‡½æ•°ã€‚å½“ä½ çš„ç»„ä»¶è¢«æ·»åŠ åˆ° DOM æ—¶ï¼ŒReact å°†è¿è¡Œä½ çš„è®¾ç½®å‡½æ•°ã€‚åœ¨æ¯æ¬¡ä½¿ç”¨æ›´æ”¹çš„ä¾èµ–é¡¹é‡æ–°æ¸²æŸ“åï¼ŒReact å°†é¦–å…ˆä½¿ç”¨æ—§å€¼è¿è¡Œæ¸…ç†å‡½æ•°ï¼ˆå¦‚æœä½ æä¾›äº†å®ƒï¼‰ï¼Œç„¶åä½¿ç”¨æ–°å€¼è¿è¡Œä½ çš„è®¾ç½®å‡½æ•°ã€‚åœ¨ä½ çš„ç»„ä»¶ä» DOM ä¸­ç§»é™¤åï¼ŒReact å°†è¿è¡Œä½ çš„æ¸…ç†å‡½æ•°ã€‚\n\nå…¶ä¸­æ¸…ç†å‡½æ•°èŒƒä¾‹å¦‚ä¸‹ï¼š\n\n```js\nuseEffect(\n    // è®¾ç½®å‡½æ•°\n    () =\u003e {\n        const connection = createConnection(serverUrl, roomId);\n        connection.connect();\n\n        // æ¸…ç†å‡½æ•°\n        return () =\u003e {\n            connection.disconnect();\n        };\n    },\n    // ä¾èµ–\n    [serverUrl, roomId]\n);\n```\n2. ä¾èµ–é¡¹ï¼ˆå¯é€‰ï¼‰ï¼šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé€šè¿‡ `Object.is` æ¥ä¾æ¬¡åˆ¤æ–­å„ä¸ªä¾èµ–é¡¹æ˜¯å¦å˜åŒ–ï¼Œè‹¥æœ‰è‡³å°‘ä¸€ä¸ªå‘ç”Ÿå˜åŒ–ï¼Œåˆ™æ‰§è¡Œè®¾ç½®å‡½æ•°å’Œæ¸…ç†å‡½æ•°ã€‚å¦‚æœæœ‰å¤šä¸ªä¾èµ–é¡¹æ›´æ–°ï¼Œåœ¨ä¸€ä¸ªfiberæ›´æ–°å‘¨æœŸå†…ï¼Œè®¾ç½®å‡½æ•°å’Œæ¸…ç†å‡½æ•°ä¹Ÿ**åªä¼šæ‰§è¡Œä¸€æ¬¡**ã€‚è‹¥çœç•¥æ­¤å‚æ•°ï¼Œè®¾ç½®å‡½æ•°å’Œæ¸…ç†å‡½æ•°å°†åœ¨æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶æ‰§è¡Œã€‚\n\n### è¿”å›å‚æ•°\n\nundefined\n\n### æ³¨æ„äº‹é¡¹\n\n1. ä»–æ˜¯ä¸€ä¸ªhookï¼Œåªèƒ½åœ¨å‡½æ•°å¼ç»„ä»¶æœ€å¤–å±‚ä½¿ç”¨ï¼Œä¸”ä¸èƒ½æ”¾åœ¨å¾ªç¯å’Œæ¡ä»¶è¯­å¥ä¸­ã€‚\n2. ä»–çš„ä½œç”¨æ˜¯æ£€æµ‹ä¾èµ–é¡¹å˜åŒ–åæ‰§è¡Œï¼Œè‹¥ä¸ºç©ºæ•°ç»„ä¾èµ–ï¼Œåˆ™é»˜è®¤åœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡ã€‚\n3. ä¸¥æ ¼æ¨¡å¼ä¸‹ `useEffect` æœ‰ä¸€ç§ç‰¹æ®Šè¡Œä¸ºï¼Œå³åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹å‰ä¼šè¿è¡Œä¸€ä¸ªé¢å¤–çš„è®¾ç½®å’Œæ¸…ç†å¾ªç¯ï¼Œè¿™ä¸ªå¾ªç¯çš„ç›®çš„æ˜¯ä¸ºäº†éªŒè¯è®¾ç½®é€»è¾‘å’Œæ¸…ç†é€»è¾‘æ˜¯å¦ç›¸äº’åŒ¹é…ï¼Œä»¥åŠæ¸…ç†é€»è¾‘æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®åœ°åœæ­¢æˆ–æ’¤é”€è®¾ç½®é€»è¾‘æ‰€åšçš„æ“ä½œã€‚å¦‚æœä½ åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹é‡åˆ°äº†ä¸ `setup å’Œ cleanup` ç›¸å…³çš„é—®é¢˜ï¼Œå®˜æ–¹å»ºè®®ä½ å®ç°é€‚å½“çš„æ¸…ç†å‡½æ•°æ¥è§£å†³ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨ç»„ä»¶å¸è½½æˆ–é‡æ–°æ¸²æŸ“æ—¶è¿›è¡Œå¿…è¦çš„æ¸…ç†æ“ä½œï¼Œé¿å…æ½œåœ¨çš„é—®é¢˜å’Œé”™è¯¯ã€‚\n4. å¦‚æœä¾èµ–é¡¹ä¸­çš„éƒ¨åˆ†å˜é‡æˆ–è€…å‡½æ•°å®šä¹‰åœ¨äº†ç»„ä»¶å†…éƒ¨ï¼Œå°±ä¼šæœ‰é£é™©ï¼šç»„ä»¶æ¯æ¬¡æ¸²æŸ“å¯¼è‡´è¿™ä¸ªå‡½æ•°æˆ–è€…å˜é‡é‡æ–°åŠ è½½ï¼Œè¿›è€Œå¯¼è‡´ `useEffect` æ¯æ¬¡éƒ½æ‰§è¡Œã€‚è€ƒè™‘æå–ä¿®æ”¹é€»è¾‘ä»£ç æˆ–è€…ä½¿ç”¨ `useCallback` æŠ€æœ¯ã€‚\n5. `useEffect` æ˜¯åœ¨ dom æµç»˜åˆ¶å®Œæˆåæ‰§è¡Œçš„ï¼Œå¦‚æœä½ æƒ³è¦é¡µé¢åˆå§‹åŒ–è¿‡ç¨‹ä¸­åœ¨è¯¥å‡½æ•°ä¸­å¤„ç† dom ç»“æ„ï¼Œå¯ä»¥è€ƒè™‘æ”¾åœ¨ useLayoutEffect ä¸­ã€‚\n6. `useEffect` ä»…åœ¨å®¢æˆ·ä¾§èƒ½ä½¿ç”¨ï¼ŒæœåŠ¡ä¾§ä½¿ç”¨è¯¦è§æˆ‘ä¹‹åçš„æ–‡ç« ã€‚\n\n### è¿è¡Œæµç¨‹\n\næˆ‘ä»¬ä½¿ç”¨ä¸Šé¢çš„èŠå¤©å®¤çš„ä¾‹å­æ¥è§£é‡Šä¸€ä¸‹ `useEffect` è¿è¡Œæµç¨‹ã€‚React ä¼šåœ¨å¿…è¦æ—¶è°ƒç”¨ä¸€æ¬¡æˆ–å¤šæ¬¡ä½ çš„è®¾ç½®å’Œæ¸…ç†å‡½æ•°ã€‚\n\n1. ç»„ä»¶åˆå§‹åŒ–æ—¶ï¼ŒuseEffect çš„è®¾ç½®å‡½æ•°æ‰§è¡Œä¸€æ¬¡\n2. ä¾èµ–é¡¹æ›´æ–°æ—¶ï¼š\n- ä½¿ç”¨æ—§çš„propså’Œstateï¼Œæ¸…ç†å‡½æ•°æ‰§è¡Œä¸€æ¬¡\n- ä½¿ç”¨æ–°çš„propså’Œstateï¼Œè®¾ç½®å‡½æ•°æ‰§è¡Œä¸€æ¬¡\n3. ç»„ä»¶é”€æ¯æˆ–è€…é‡æ¸²æŸ“æ—¶ï¼Œæ¸…ç†å‡½æ•°ä¼šæ‰§è¡Œä¸€æ¬¡\n\n\u003e useEffect çš„ä½œç”¨åœ¨äºæä¾›ä¸€ç§å°† `React`éå—æ§çš„ç³»ç»Ÿä¸ `React` çš„çŠ¶æ€é“¾æ¥çš„ä¸€ä¸ªåª’ä»‹ã€‚`React`éå—æ§ç³»ç»Ÿæ¯”å¦‚ setIntervalã€addEventListenerã€animation.start() ç­‰ã€‚å¦‚æœæ²¡æœ‰éå—æ§ç³»ç»Ÿå‚ä¸ï¼ŒuseEffect å¾€å¾€ä¸æ˜¯å¿…é¡»çš„ã€‚\n\n### å„ç§ä½¿ç”¨ä¾‹å­\n\n#### 1. ç›‘å¬é¼ æ ‡äº‹ä»¶\n\nä¸‹é¢çš„ä¾‹å­ï¼Œç›‘å¬äº†é¼ æ ‡æŒ‡é’ˆæ»‘åŠ¨äº‹ä»¶ï¼Œå¹¶åœ¨é¼ æ ‡æŒ‡é’ˆä¸‹æ–¹è®¾ç½®è·Ÿéšçš„åœ†å½¢é˜´å½±è£…é¥°ï¼š\n\n```js\nimport { useState, useEffect } from 'react';\n\nexport default function App() {\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n\n  useEffect(() =\u003e {\n    function handleMove(e) {\n      setPosition({ x: e.clientX, y: e.clientY });\n    }\n    window.addEventListener('pointermove', handleMove);\n    return () =\u003e {\n      window.removeEventListener('pointermove', handleMove);\n    };\n  }, []);\n\n  return (\n    \u003cdiv style={{\n      position: 'absolute',\n      backgroundColor: 'pink',\n      borderRadius: '50%',\n      opacity: 0.6,\n      transform: `translate(${position.x}px, ${position.y}px)`,\n      pointerEvents: 'none',\n      left: -20,\n      top: -20,\n      width: 40,\n      height: 40,\n    }} /\u003e\n  );\n}\n```\n\n#### 2. è®¾ç½®ä¸€æ®µåŠ¨ç”»ï¼ˆéƒ¨åˆ†ä»£ç ï¼‰\n\nç‚¹å‡»æŒ‰é’®ï¼Œåœ¨é¡µé¢æ¸å˜çš„æ˜¾ç¤ºä¸€ä¸ªå—çº§å…ƒç´ ï¼ˆ[å®Œæ•´ä»£ç ](https://codesandbox.io/s/ld0mxv?file=/animation.js:463-472\u0026utm_medium=sandpack)ï¼‰ï¼š\n\n```js\nuseEffect(() =\u003e {\n    const animation = new FadeInAnimation(ref.current);\n    animation.start(1000);\n    return () =\u003e {\n      animation.stop();\n    };\n  }, []);\n```\n\n#### 3. è¿½è¸ªå…ƒç´ ç»è¿‡å¯è§†åŒºåŸŸï¼ˆéƒ¨åˆ†ä»£ç ï¼‰\n\nä¸‹é¢çš„ä»£ç ï¼Œåœ¨æ‰“äº† ref çš„ div è¿›å…¥å¯è§†åŒºåŸŸåï¼Œæ·»åŠ èƒŒæ™¯è‰²å’Œå­—ä½“è‰²ï¼Œç¦»å¼€å¯è§†åŒºåŸŸåæ ·å¼å¤åŸï¼š\n\n```js\nuseEffect(() =\u003e {\n    const div = ref.current;\n    const observer = new IntersectionObserver(entries =\u003e {\n      const entry = entries[0];\n      if (entry.isIntersecting) {\n        document.body.style.backgroundColor = 'black';\n        document.body.style.color = 'white';\n      } else {\n        document.body.style.backgroundColor = 'white';\n        document.body.style.color = 'black';\n      }\n    });\n    observer.observe(div, {\n      threshold: 1.0\n    });\n    return () =\u003e {\n      observer.disconnect();\n    }\n  }, []);\n```\n\n#### 4. åœ¨è‡ªå®šä¹‰ Hook ä¸­ä½¿ç”¨\n\næˆ‘ä»¬è¿˜ä»¥ä¸Šé¢èŠå¤©å®¤çš„ä¾‹å­åšè¯´æ˜ã€‚ä¸Šé¢çš„åŠŸèƒ½æ˜¯ roomId å’Œ service åˆ‡æ¢å°±è‡ªåŠ¨å…³é—­æ—§çš„é“¾æ¥ï¼Œæ‰“å¼€æ–°çš„é“¾æ¥ï¼Œæ‰€æœ‰çš„èŠå¤©é“¾æ¥åŠ¨ä½œéƒ½ä¸€æ ·ï¼Œå¯ä»¥æå–æˆå…¬å…±ç»„ä»¶æ¥ä½¿ç”¨ï¼š\n\n```js\nfunction useChatRoom({ serverUrl, roomId }) {\n  useEffect(() =\u003e {\n    const options = {\n      serverUrl: serverUrl,\n      roomId: roomId\n    };\n    const connection = createConnection(options);\n    connection.connect();\n    return () =\u003e connection.disconnect();\n  }, [roomId, serverUrl]);\n}\n```\n\nè¿™æ ·ï¼Œåªéœ€è¦ä½¿ç”¨è¿™ä¸ªå‡½æ•°å°±èƒ½å®ŒæˆèŠå¤©å®¤çš„é“¾æ¥å·¥ä½œï¼š\n\n```js\nuseChatRoom({  \n    roomId: roomId,  \n    serverUrl: serverUrl  \n});\n```\n\nå½“ç„¶äº†ï¼Œ[å…¨å±€éå—æ§äº‹ä»¶ï¼ˆaddEventListenerï¼‰](https://codesandbox.io/s/b006ec?file=/useWindowListener.js\u0026utm_medium=sandpack)ã€[å¯è§†åŒºåŸŸç›‘å¬](https://codesandbox.io/s/m9drvd?file=/useIntersectionObserver.js\u0026utm_medium=sandpack)ä¹Ÿå¯ä»¥å°è£…ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ Hook æ¥ä½¿ç”¨ã€‚\n\n#### 5. ä½¿ç”¨å®šæ—¶å™¨æ“ä½œ state\n\nå¦‚æœæƒ³è¦åœ¨ `useState` é‡Œä½¿ç”¨å®šæ—¶å™¨æ“ä½œçŠ¶æ€å€¼ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·å†™ï¼š\n\n```js\nunction Counter() {  \n    const [count, setCount] = useState(0);  \n\n    useEffect(() =\u003e {  \n        const intervalId = setInterval(() =\u003e {  \n            setCount(count + 1); // You want to increment the counter every second...  \n        }, 1000)  \n\n        return () =\u003e clearInterval(intervalId);  \n    }, [count]); // ğŸš© ... but specifying `count` as a dependency always resets the interval.  \n    // ...  \n}\n```\n\nä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œcount æ˜¯ä¸€ä¸ªå“åº”å€¼ï¼Œåœ¨ useEffect ä¸­å¼•å…¥äº†ä»–çš„ä¾èµ–ï¼ŒåŒæ—¶ï¼Œè¿™æ˜¯å‡½æ•°ä¸­åˆæ”¹å˜äº†ä»–çš„å€¼ï¼Œè¿™å°±å¯¼è‡´äº† setInterval å‡½æ•°ä¼šè¢«åå¤çš„æ‰§è¡Œï¼Œå®šæ—¶å™¨æ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‡ºæ¥ã€‚ä»£ç é€»è¾‘å‡ºç°é”™è¯¯ä¸è¯´ï¼Œä¹Ÿæµªè´¹äº†å†…å­˜ç©ºé—´ã€‚\n\nè§£å†³æ–¹æ¡ˆå…¶å®å¾ˆç®€å•ï¼Œä¸Šä¸€ç¯‡æ–‡ç« è®² `useState` çš„æ—¶å€™æåˆ°è¿‡ï¼ŒuseState å†…éƒ¨å¯ä»¥ä¼ ä¸€ä¸ªå‡½æ•°ï¼Œä»–çš„å‚æ•°å°±æ˜¯ä¸Šä¸€æ¬¡æ›´æ–°å®Œä¹‹åçš„çŠ¶æ€å€¼ï¼Œæ‰€ä»¥è¿™é‡Œå¹¶ä¸éœ€è¦å»æ‹¿ count è¿™ä¸ªå˜é‡ï¼š\n\n```js\nuseEffect(() =\u003e {\n  const intervalId = setInterval(() =\u003e {\n    setCount(c =\u003e c + 1); // âœ… Pass a state updater\n  }, 1000);\n  return () =\u003e clearInterval(intervalId);\n}, []); // âœ… Now count is not a dependency\n```\n\n### å…³äºä¾èµ–\n\nä¸æ¨èä¸å¼•å…¥å¿…é¡»çš„ä¾èµ–æˆ–è€…æ·»åŠ é¢å¤–çš„ä¸éœ€è¦çš„ä¾èµ–é¡¹ã€‚ä½ çš„ä¾èµ–é¡¹çš„é€‰æ‹©å–å†³äº `useEffect` åŒ…è£¹çš„ä»£ç ã€‚\n\nä¾èµ–çš„é€‰æ‹©ä¸ä»…åŒ…æ‹¬è®¾ç½®å‡½æ•°å†…æ‰€åº”ç”¨çš„å˜é‡ã€å‡½æ•°ï¼Œè¿˜åº”è€ƒè™‘åˆ°å„ä¸ªå˜é‡ã€å‡½æ•°å„è‡ªçš„å¼•ç”¨ä¾èµ–ã€‚å¦‚æœå¼•ç”¨çš„å‡½æ•°å†…çš„å˜é‡å˜åŒ–å¼•èµ·äº†è¯¥å‡½æ•°é‡æ–°è®¾ç½®ï¼Œè¿›è€Œä¾¿ä¼šè§¦å‘ `useEffec` æ‰§è¡Œã€‚\n\nåœ¨ä¸Šé¢çš„èŠå¤©å®¤ä¾‹å­ä¸­ï¼ŒrootId æ˜¯é€šè¿‡ç”¨æˆ·ä¸‹æ‹‰åˆ‡æ¢å¾—æ¥çš„ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªå“åº”å¼æ•°æ®ï¼›ä½†æ˜¯ serverUrl æ˜¯ä¸€ä¸ªå¸¸é‡å­—ç¬¦ä¸²ï¼Œå®Œå…¨ä¸éœ€è¦æ”¾åœ¨ state é‡Œï¼Œè¿›è€Œä¹Ÿå¯ä»¥ç§»å‡ºä¾èµ–é¡¹ï¼š\n\n```js\nuseEffect(() =\u003e {  \n    const connection = createConnection(serverUrl, roomId);  \n    connection.connect();  \n\n    return () =\u003e connection.disconnect();  \n}, [roomId]); // âœ… All dependencies declared\n```\n\nå¦‚æœåŒ…è£¹çš„å‡½æ•°æ²¡æœ‰ä»»ä½•å¯å“åº”çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±ç”¨ä¸€ä¸ªç©ºæ•°ç»„å³å¯ã€‚\n\n### é£é™©é¡¹\n\nå¯ä»¥é€šè¿‡ä¸€å®šçš„æ³¨é‡Šæ¬ºéª—ä¾èµ–é¡¹æ£€æŸ¥ï¼Œæ¯”å¦‚ï¼š\n\n```js\nuseEffect(() =\u003e {\n  // ...\n  // ğŸ”´ Avoid suppressing the linter like this:\n  // eslint-ignore-next-line react-hooks/exhaustive-deps\n}, []);\n```\n\nè¿™ç§æƒ…å†µåœ¨ä½ è‚¥è‚ æ˜ç¡®åŒ…è£¹å‡½æ•°çš„ä¾èµ–å…³ç³»æ—¶æ‰å¯ä½¿ç”¨ï¼Œä½†æ˜¯è¿™åŒæ ·ä¸åˆ©äºå›¢é˜Ÿåˆä½œä¸­çš„ä»£ç ç»´æŠ¤ã€‚å¦‚æœåŒ…è£¹å‡½æ•°ä¸­çš„å˜é‡æˆ–è€…å‡½æ•°åœ¨ä»£ç è¿­ä»£ç»´æŠ¤è¿‡ç¨‹ä¸­å˜æˆäº†å“åº”å¼çš„ï¼Œä½†æ˜¯è¿™é‡ŒåˆæŠ‘åˆ¶äº†å‘Šè­¦æç¤ºï¼Œå¯èƒ½ä¼šå‡ºç°éš¾ä»¥æ’æŸ¥çš„é—®é¢˜ã€‚\n\n\u003e P.S. å¯èƒ½ä½ ä¼šè§‰å¾—: æˆ‘ä½¿ç”¨ç©ºæ•°ç»„å°±æ˜¯è¡¨ç¤ºç»„ä»¶åˆå§‹åŒ–åŠ è½½æ—¶è°ƒç”¨çš„å•Šï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç»™æˆ‘å¼¹è­¦å‘Šï¼Ÿè¿™é‡Œï¼Œä½œè€…å»ºè®®ï¼Œä¸è¦åœ¨å‡½æ•°å¼ç»„ä»¶é‡Œè°ˆç”Ÿå‘½å‘¨æœŸï¼Œè¿™é‡Œåªæœ‰å“åº”å¼å‰¯ä½œç”¨å’Œå¸¸é‡ã€‚\n\n## 3. å®éªŒæ€§APIï¼šuseEffectEvent\n\n\u003e è¯¥APIè¿˜å¤„äºè¯•éªŒé˜¶æ®µï¼Œæ­£å¼releaseç‰ˆå°šæœªå‘å¸ƒã€‚\n\nç†è®ºä¸Šï¼Œä¾èµ–æ›´æ–°äº†ï¼Œè®¾ç½®å‡½æ•°å°±ä¼šé‡æ–°æ‰§è¡Œï¼Œè€ƒè™‘ä¸‹é¢è®°å½•é¡µé¢è®¿é—®é‡çš„ä»£ç ï¼š\n\n```js\nfunction Page({ url, shoppingCart }) {  \n    useEffect(() =\u003e { \n        // ...\n        logVisit(url, shoppingCart.length);  \n    }, [url, shoppingCart]); // âœ… All dependencies declared  \n    // ...  \n}\n```\nurlå’ŒshoppingCartå˜åŒ–ï¼Œéƒ½ä¼šé‡æ–°è°ƒç”¨logVisitå‡½æ•°æ¥å¢åŠ è®¿é—®è®¡æ•°ã€‚ä½†æ˜¯ï¼Œä½ åªå¸Œæœ›è®¿é—®urlå˜åŒ–æ—¶æ‰å¢åŠ è®¿é—®é‡ï¼ŒshoppingCartå˜åŒ–æ—¶logVisitä¸è¦é‡æ–°æ‰§è¡Œï¼Œä½†æ˜¯åœ¨æ‰§è¡Œæ—¶ï¼Œè´­ç‰©è½¦åˆå¾—æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿ\n\nç›´æ¥ç§»é™¤ä¾èµ–å¯èƒ½ä¼šå½±å“å‡½æ•°å†…éƒ¨å…¶ä»–åœ°æ–¹çš„å˜åŒ–ã€‚æ­¤æ—¶å¯ä»¥ä½¿ç”¨ `useEffectEvent`:\n\n```js\nfunction Page({ url, shoppingCart }) {\n  const onVisit = useEffectEvent(visitedUrl =\u003e {\n    // éå“åº”å¼çš„ï¼Œå³å¯ä»¥æ‹¿åˆ°å®æ—¶å…¶ä»–å“åº”å¼æ•°æ®ï¼Œåˆé¿å…äº†ä»–çš„å˜åŒ–å¼•èµ·å¤–éƒ¨æ›´æ–°\n    logVisit(visitedUrl, shoppingCart.length)\n  });\n\n  useEffect(() =\u003e {\n    onVisit(url);\n  }, [url]); // âœ… All dependencies declared\n  // ...\n}\n```\nä¸Šé¢çš„ä»£ç ï¼Œåœ¨urlå˜åŒ–åï¼Œä¼šæ‰§è¡ŒonVisit -\u003e logVisitå‡½æ•°ï¼Œè¢« `useEffectEvent` åŒ…è£¹çš„å‡½æ•°ä¸æ˜¯å“åº”å¼çš„ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨äº†å“åº”å€¼shoppingCartï¼Œæ—¢å¯ä»¥åŠæ—¶æ‹¿åˆ°æœ€æ–°çš„è´­ç‰©è½¦ä¿¡æ¯ï¼Œåˆé¿å…äº†è´­ç‰©è½¦å˜åŒ–å¼•èµ·åŒ…è£¹onVisitå‡½æ•°çš„ç»„ä»¶çš„å˜åŒ–ã€‚\n\n\u003e P.S. ä»–çš„ä½¿ç”¨æ–¹å¼åŒ useEvent\n\n## 4. useLayoutEffect\n\n`useLayoutEffect` æ˜¯ `useEffect` çš„ä¸€ä¸ªç‰ˆæœ¬ã€‚ä¸€èˆ¬ç”¨åœ¨æ§åˆ¶é¡µé¢æ¸²æŸ“çš„å·¥ä½œä¸­ï¼Œå…¶åœ¨é¡µé¢æ¸²æŸ“è¿‡ç¨‹ä¹‹å‰è°ƒç”¨ã€‚ï¼ˆä¼šå½±å“æ€§èƒ½ï¼‰\n\n### ä½¿ç”¨åœºæ™¯\n\n#### 1.é¡µé¢åˆå§‹åŒ–æ—¶è·å–çŸ©å½¢çš„é«˜åº¦\n\nåœ¨å…ƒç´ æ¸²æŸ“ä¹‹å‰ï¼Œè·å–ä¸€ä¸ª ref æŒ‡å‘å…ƒç´ çš„é«˜åº¦ï¼Œå¹¶è®¾ç½®ç»™ç»„ä»¶çš„stateï¼š\n\n```js\nimport { useState, useRef, useLayoutEffect } from 'react';\n\nfunction Tooltip() {\n  const ref = useRef(null);\n  const [tooltipHeight, setTooltipHeight] = useState(0);\n\n  useLayoutEffect(() =\u003e {\n    const { height } = ref.current.getBoundingClientRect();\n    setTooltipHeight(height);\n  }, []);\n  // ...\n}\n```\n\n#### 2. åœ¨é¡µé¢é‡ç»˜ä¹‹å‰æ”¹åŠ¨å¸ƒå±€\n\nä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œtooltip ç»„ä»¶éœ€è¦åœ¨é¡µé¢æ¸²æŸ“æ—¶è·å–æŒ‚è½½å…ƒç´ çš„é«˜åº¦ï¼Œè¿›è€Œç¡®è®¤åœ¨å“ªä¸ªæ–¹å‘ä¸Šæ¸²æŸ“ï¼š\n\n```js\nuseLayoutEffect(() =\u003e {\n    const { height } = ref.current.getBoundingClientRect();\n    setTooltipHeight(height);\n    console.log('Measured tooltip height: ' + height);\n  }, []);\n\n  let tooltipX = 0;\n  let tooltipY = 0;\n  if (targetRect !== null) {\n    tooltipX = targetRect.left;\n    tooltipY = targetRect.top - tooltipHeight;\n    if (tooltipY \u003c 0) {\n      // It doesn't fit above, so place below.\n      tooltipY = targetRect.bottom;\n    }\n  }\n  \n  // ...\n  \n  return createPortal(\n    \u003cTooltipContainer x={tooltipX} y={tooltipY} contentRef={ref}\u003e\n      {children}\n    \u003c/TooltipContainer\u003e,\n    document.body\n  );\n```\nå®Œæ•´ä¾‹å­è§[å®˜ç½‘demo](https://codesandbox.io/s/bj8hpt?file=/TooltipContainer.js\u0026utm_medium=sandpack)\n\n### æ³¨æ„äº‹é¡¹\n\nåœ¨ä½¿ç”¨react SSRæ—¶ï¼Œåˆå§‹çš„ HTMLæ¸²æŸ“ä¼šæ—©äº js è„šæœ¬ï¼Œä½†æ˜¯åœ¨æœåŠ¡ç«¯æ²¡æœ‰å¸ƒå±€ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨ js è„šæœ¬åŠ è½½å®Œæ¯•åï¼Œé¡µé¢å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œæ±‡æ€»å¦‚ä¸‹ï¼š\n\n1.  ä¸ä¸€è‡´çš„æ¸²æŸ“ç»“æœï¼šç”±äºæœåŠ¡ç«¯æ¸²æŸ“å’Œå®¢æˆ·ç«¯æ¸²æŸ“çš„æ‰§è¡Œç¯å¢ƒä¸åŒï¼Œ`useLayoutEffect` åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å¯èƒ½ä¼šäº§ç”Ÿä¸ä¸€è‡´çš„ç»“æœã€‚è¿™å¯èƒ½å¯¼è‡´åœ¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶å‡ºç°é—ªçƒã€å¸ƒå±€é”™ä¹±æˆ–ä¸ç¬¦åˆé¢„æœŸçš„è¡Œä¸ºã€‚\n2.  æ— æ•ˆçš„ DOM æ“ä½œï¼š`useLayoutEffect` åœ¨æœåŠ¡ç«¯æ‰§è¡Œæ—¶ï¼Œæ— æ³•ç›´æ¥è®¿é—®åˆ°çœŸå®çš„ DOMã€‚å› æ­¤ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µå¯¹ DOM è¿›è¡Œçš„æ“ä½œå¯èƒ½ä¼šå¯¼è‡´é”™è¯¯æˆ–æ— æ•ˆçš„ç»“æœã€‚\n3.  æ€§èƒ½é—®é¢˜ï¼šç”±äº `useLayoutEffect` çš„æ‰§è¡Œæ˜¯åŒæ­¥çš„ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªæ¸²æŸ“å‘¨æœŸéƒ½ä¼šè¢«è°ƒç”¨ï¼Œå¯èƒ½ä¼šå¯¹æœåŠ¡å™¨çš„æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚åœ¨å¤§è§„æ¨¡çš„ SSR é¡¹ç›®ä¸­ï¼Œé¢‘ç¹çš„åŒæ­¥ DOM æ“ä½œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™å’Œå“åº”æ—¶é—´å»¶é•¿ã€‚\n\n\u003e å»ºè®®ï¼šæœåŠ¡ç«¯æ¸²æŸ“çš„é¡¹ç›®ä¸­ä½¿ç”¨ `useEffect` æ›¿ä»£ï¼Œå¹¶ä½¿ç”¨ [`\u003cSuspense\u003e`](https://react.dev/reference/react/Suspense) æ‡’åŠ è½½ç»„ä»¶ï¼Œæˆ–è€…ä½¿ç”¨ hydration æ¨¡å¼å¼€å‘ã€‚\n\n## 5. useInsertionEffect\n\n`useInsertionEffect` æ˜¯ `useEffect` çš„ä¸€ä¸ªç‰ˆæœ¬ã€‚å…¶åœ¨ DOM å˜æ›´ä¹‹å‰è§¦å‘ï¼Œæ˜¯ä¸€ä¸ªç»“åˆ CSS-in-JS çš„æ ·å¼ä¿®æ”¹çš„è‡ªå®šä¹‰ hookã€‚\n\n### ä½¿ç”¨åœºæ™¯\n\n###### ä» CSS-in-JS åº“ä¸­æ’å…¥åŠ¨æ€æ ·å¼\n\nåœ¨è¿è¡Œä¸­çš„ä»£ç ä¸­ï¼ŒåŠ¨æ€æ’å…¥ style æ ·å¼ï¼Œæœ‰ä¸¤ä¸ªå¼Šç«¯ï¼š\n\n1. è¿«ä½¿æµè§ˆå™¨æ›´é¢‘ç¹åœ°é‡æ–°è®¡ç®—æ ·å¼ã€‚\n2. å¦‚æœè¿è¡Œæ—¶æ³¨å…¥å‘ç”Ÿåœ¨ React ç”Ÿå‘½å‘¨æœŸçš„é”™è¯¯æ—¶é—´ï¼Œå®ƒå¯èƒ½ä¼šéå¸¸æ…¢ã€‚\n\nä½¿ç”¨ useInsertionEffect å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›ä¸€ç§æ–¹æ¡ˆï¼Œè§£å†³ä¸Šé¢ç¬¬äºŒä¸ªé—®é¢˜ã€‚ï¼ˆç¬¬ä¸€ä¸ªé—®é¢˜ç›®å‰ä¸å¯è§£ï¼‰ï¼š\n\n```js\nlet isInserted = new Set();\nfunction useCSS(rule) {\n  useInsertionEffect(() =\u003e {\n    // As explained earlier, we don't recommend runtime injection of \u003cstyle\u003e tags.\n    // But if you have to do it, then it's important to do in useInsertionEffect.\n    if (!isInserted.has(rule)) {\n      isInserted.add(rule);\n      document.head.appendChild(getStyleForRule(rule));\n    }\n  });\n  return rule;\n}\n\nfunction Button() {\n  const className = useCSS('...');\n  return \u003cdiv className={className} /\u003e;\n}\n```\n\nuseInsertionEffect åŒæ ·ä¸é€‚ç”¨äºæœåŠ¡ç«¯æ¸²æŸ“ï¼Œåœ¨ä¹¦å†™æ—¶éœ€è¦é¢å¤–åˆ¤æ–­ï¼š\n\n```js\nlet collectedRulesSet = new Set();\n\nfunction useCSS(rule) {\n  if (typeof window === 'undefined') {\n    collectedRulesSet.add(rule);\n  }\n  useInsertionEffect(() =\u003e {\n    // ...\n  });\n  return rule;\n}\n```\n\n\u003e P.S. ä»–æ˜¯å¦‚ä½•è§£å†³ç¬¬äºŒæ¡é—®é¢˜çš„ï¼šå¦‚æœåœ¨æ¸²æŸ“æœŸé—´æ’å…¥æ ·å¼å¹¶ä¸” React æ­£åœ¨å¤„ç†éé˜»å¡æ›´æ–°ï¼Œåˆ™æµè§ˆå™¨å°†åœ¨æ¸²æŸ“ç»„ä»¶æ ‘æ—¶æ¯å¸§é‡æ–°è®¡ç®—æ ·å¼ï¼Œè¿™å¯èƒ½ä¼šéå¸¸æ…¢ã€‚useInsertionEffect æ¯”åœ¨ useLayoutEffect æˆ– useEffect ä¸­æ’å…¥æ ·å¼è¦å¥½ï¼Œå› ä¸ºå®ƒç¡®ä¿å½“å…¶ä»– Effects åœ¨ç»„ä»¶ä¸­è¿è¡Œæ—¶ï¼Œ\\\u003cstyle\\\u003e æ ‡ç­¾å·²ç»è¢«æ’å…¥ã€‚å¦åˆ™ï¼Œå¸¸è§„ Effects ä¸­çš„å¸ƒå±€è®¡ç®—å°†ç”±äºè¿‡æ—¶çš„æ ·å¼è€Œå‡ºé”™ã€‚\n\n----\n\næœ¬æœŸå®Œäº†ï¼Œå€ºè§ï¼"])</script><script>self.__next_f.push([1,"2d:T3988,"])</script><script>self.__next_f.push([1,"å®˜ç½‘åœ°å€ï¼š[React](https://beta.reactjs.org/)\n\n## 1. useState\n\nuseState å¯ä»¥è¯´æ˜¯ä½¿ç”¨çš„æœ€é¢‘ç¹çš„ä¸€ä¸ª hook äº†ã€‚æ¥ä¸‹æ¥çœ‹çœ‹å®˜ç½‘æ€ä¹ˆè§£é‡Šä»–çš„ç”¨æ³•ã€‚ä»–æ˜¯ä¸€ä¸ªåœ¨å‡½æ•°å¼ç»„ä»¶å†…æ·»åŠ æš‚å­˜çŠ¶æ€çš„å‡½æ•°ï¼Œåœ¨ç»„ä»¶æ›´æ–°æ¸²æŸ“æ—¶ï¼Œèƒ½å¤Ÿä¿ç•™stateé‡Œå˜é‡çš„çŠ¶æ€ä¸è¢«åˆå§‹åŒ–ã€‚\n\nåŒå…¶ä»– hook ä¸€æ ·ï¼Œä¸èƒ½åœ¨å¾ªç¯å’Œåˆ¤æ–­æ¡ä»¶é‡Œä½¿ç”¨ï¼Œå®˜æ–¹æ¨èåœ¨ç»„ä»¶é¡¶éƒ¨ä½¿ç”¨ï¼š\n\n```js\nimport { useState } from 'react';  \n\nfunction MyComponent() {  \n    const [age, setAge] = useState(28);  \n    const [name, setName] = useState('Taylor');  \n    const [todos, setTodos] = useState(() =\u003e createTodos());  \n    // ...\n}\n```\n\n### æ¥å—å‚æ•°ï¼šinitialState\n\næ¥å—ä¸€ä¸ªåˆå§‹åŒ–çš„å€¼ã€‚åœ¨stateåˆ›å»ºæ—¶ï¼Œä¼šå°†å€¼è®°å½•ä¸ºè¿™ä¸ªåˆå§‹åŒ–çš„å€¼ï¼Œä¸ä¼ é»˜è®¤æ˜¯ `undefined`ã€‚\n\n\u003e P.S. å¦‚æœåˆå§‹åŒ–å€¼ä¼ ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå°†è¢«ä½œä¸ºåˆå§‹åŒ–å‡½æ•°ã€‚è¦æ±‚å¿…é¡»æ˜¯çº¯å‡½æ•°ï¼Œä¸å¸¦ä»»ä½•å‚æ•°ï¼Œå¹¶ä¸”åº”è¯¥æœ‰è¿”å›å€¼ã€‚åˆå§‹åŒ–å‡½æ•°çš„è¿”å›å°†è¢«è®°å½•ä¸ºåˆå§‹çŠ¶æ€ã€‚è¯¥åˆå§‹åŒ–å‡½æ•°åªä¼šåŠ è½½ä¸€æ¬¡ï¼Œåœ¨ä¸‹ä¸€ä¸ªç»„ä»¶æ¸²æŸ“æ—¶ï¼Œä¸ä¼šè¢«é‡æ–°æ‰§è¡Œ\n\n### è¿”å›å€¼\n\nä»–çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„è§£æ„çš„å˜é‡ã€‚\n\n- çŠ¶æ€\n\nç¬¬ä¸€ä¸ªå˜é‡æ˜¯çŠ¶æ€å˜é‡æœ¬èº«\n\n- è®¾ç½®çŠ¶æ€å‡½æ•°\n\nç¬¬äºŒä¸ªå˜é‡æ˜¯è®¾ç½®çŠ¶æ€çš„å‡½æ•°ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ä¼šé‡æ–°è®¾ç½®stateå€¼å¹¶è§¦å‘ç»„ä»¶çš„ re-render.\n\nè®¾ç½®çŠ¶æ€çš„å‡½æ•°ä½¿ç”¨èŒƒä¾‹ï¼š\n\n```js\nconst [name, setName] = useState('Edward');  \n\nfunction handleClick() {  \n    setName('Taylor');  \n    setAge(a =\u003e a + 1);  \n    // ...\n}\n```\n\n### å…³äºè®¾ç½®å‡½æ•°ï¼ˆæ¯”å¦‚ setNameï¼‰\n\n- å…¥å‚\n\nå‚æ•°æ˜¯è¦è®¾ç½®çš„æ–°çŠ¶æ€çš„å€¼ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹ã€‚\n\n\u003e P.S. å¦‚æœä½ ä¼ äº†ä¸€ä¸ªå‡½æ•°è¿›å»ï¼ˆæ¯”å¦‚ä¸Šé¢çš„ setNameï¼‰ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«ä½œä¸ºæ›´æ–°å‡½æ•°å¯¹å¾…ã€‚åŒæ ·å¿…é¡»æ˜¯çº¯å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯æ›´æ–°ä¹‹å‰çš„çŠ¶æ€å€¼ï¼Œå‡½æ•°çš„è¿”å›å€¼ä¼šè¢«ä½œä¸ºæ–°çš„çŠ¶æ€å€¼ã€‚React ä¼šæŠŠä½ çš„æ›´æ–°å‡½æ•°æ”¾åˆ°ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—é‡Œï¼ˆfiberè°ƒåº¦å™¨ï¼‰ï¼Œåœ¨ä¸‹ä¸€ä¸ªæ¸²æŸ“å‘¨æœŸåˆ°æ¥æ—¶ï¼Œfiberä¼šéå†é˜Ÿåˆ—ï¼ŒæŒ‰ç…§ä¸€å®šçš„ä¼˜å…ˆçº§æ‰§è¡Œå‡½æ•°å¹¶æ¸…ç©ºå¯¹åˆ—ã€‚\n\n- è¿”å›å€¼\n\n### æ–°çš„çŠ¶æ€å€¼\n\n- â­ï¸ è®¾ç½®çŠ¶æ€å‡½æ•°çš„æ³¨æ„äº‹é¡¹\n\n1. çŠ¶æ€åªåœ¨ä¸‹æ¬¡æ›´æ–°æ—¶å¼‚æ­¥å˜åŒ–ï¼Œå¦‚æœåœ¨è®¾ç½®çŠ¶æ€åç«‹å³è¯»å–çŠ¶æ€å€¼ï¼Œè¯»å–åˆ°çš„è¿˜æ˜¯è€çš„çŠ¶æ€ã€‚\n2. å¦‚æœæä¾›çš„æ–°å€¼ä¸å½“å‰çŠ¶æ€ç›¸åŒï¼ˆç”± Object.is æ¯”è¾ƒç¡®å®šï¼‰ï¼Œ`React` å°†è·³è¿‡é‡æ–°æ¸²æŸ“ç»„ä»¶åŠå…¶å­ç»„ä»¶ã€‚\n3. `React` æ˜¯æ‰¹é‡åˆå¹¶æ›´æ–° state çš„ã€‚å¤šä¸ªçŠ¶æ€æ›´æ–°æ“ä½œä¼šè¢«æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç„¶ååœ¨é€‚å½“çš„æ—¶æœºè¿›è¡Œåˆå¹¶å’Œæ‰¹é‡å¤„ç†ã€‚è¿™å¯ä»¥é˜²æ­¢åœ¨å•ä¸ªäº‹ä»¶æœŸé—´å¤šæ¬¡é‡æ–°æ¸²æŸ“ã€‚åœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œéœ€è¦å¼ºåˆ¶ `React` æå‰æ›´æ–°ç•Œé¢ï¼Œä¾‹å¦‚è®¿é—® DOMï¼Œå¯ä»¥ä½¿ç”¨ flushSyncã€‚\n4. åœ¨æ¸²æŸ“æœŸé—´è°ƒç”¨ set å‡½æ•°åªå…è®¸åœ¨å½“å‰æ¸²æŸ“ç»„ä»¶ä¸­ã€‚ `React` å°†ä¸¢å¼ƒå…¶è¾“å‡ºå¹¶ç«‹å³ä½¿ç”¨æ–°çŠ¶æ€å†æ¬¡æ¸²æŸ“ã€‚ï¼ˆä¸‹è¾¹æœ‰åœ¨æ¸²æŸ“æ—¶è®¾ç½®çŠ¶æ€å€¼çš„ä¾‹å­ï¼‰\n5. åœ¨ä¸¥æ ¼æ¨¡å¼ + å¼€å‘ç¯å¢ƒä¸‹ï¼Œåˆå§‹åŒ–å‡½æ•°ä¼šè¢«è°ƒç”¨ä¸¤æ¬¡æ¥å¸®åŠ©ä½ è°ƒè¯•é”™è¯¯ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯çº¯å‡½æ•°ï¼Œç¬¬äºŒæ¬¡ç»“æœä¼šè¢«å¿½ç•¥æ‰ã€‚\n\n### æ³¨æ„äº‹é¡¹\n\n1. ä½œä¸ºä¸€ä¸ªhookï¼Œä»–åœ¨å‡½æ•°å¼ç»„ä»¶å†…æ˜¯å•å‘é“¾è¡¨å­˜å‚¨çš„ï¼Œæ‰€ä»¥å¿…é¡»æ”¾åœ¨ç»„ä»¶é¡¶å±‚ä½¿ç”¨ã€‚å¦‚æœä½ éœ€è¦åœ¨å¾ªç¯æˆ–è€…æ¡ä»¶è¯­å¥é‡Œä½¿ç”¨ï¼Œå°±æå–æˆå•ç‹¬çš„ç»„ä»¶ä½¿ç”¨ã€‚\n2. åœ¨ä¸¥æ ¼æ¨¡å¼ + å¼€å‘ç¯å¢ƒä¸‹ï¼Œåˆå§‹åŒ–å‡½æ•°ä¼šè¢«è°ƒç”¨ä¸¤æ¬¡æ¥å¸®åŠ©ä½ è°ƒè¯•é”™è¯¯ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯çº¯å‡½æ•°ï¼Œç¬¬äºŒæ¬¡ç»“æœä¼šè¢«å¿½ç•¥æ‰ã€‚\n\n### å„ç§ä½¿ç”¨ä¾‹å­\n\n#### 1. åœ¨è®¾ç½®çŠ¶æ€åç«‹å³è¯»å–çŠ¶æ€å€¼\n\n```js\nfunction handleClick() {\n    const [name, setName] = useState('Taylor');\n    //...\n    setName('Robin');  \n    console.log(name); // Still \"Taylor\"!  \n}\n```\n\nå¦‚æœæƒ³è¦è·å–åˆ°å˜åŒ–åçš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ `useEffect`\n\n#### 2. åŸºç¡€ä½¿ç”¨ï¼šå¤šçŠ¶æ€ä¸è¡¨å•ç»“åˆ\n\n```jsx\nimport { useState } from 'react';\n\nexport default function Form() {\n  const [name, setName] = useState('Taylor');\n  const [age, setAge] = useState(42);\n\n  return (\n    \u003c\u003e\n      \u003cinput\n        value={name}\n        onChange={e =\u003e setName(e.target.value)}\n      /\u003e\n      \u003cbutton onClick={() =\u003e setAge(age + 1)}\u003e\n        Increment age\n      \u003c/button\u003e\n      \u003cp\u003eHello, {name}. You are {age}.\u003c/p\u003e\n    \u003c/\u003e\n  );\n}\n```\n\n#### 3. åœ¨å®šæ—¶å™¨ä¸­ä½¿ç”¨\n\nåœ¨å®šæ—¶å™¨å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨ç»„ä»¶ï¼š\n\n```js\nconst [count, setCount] = useState(0);\n\nconst counterIntervalFunction = () =\u003e {\n  console.log(count);\n  setCount(count + 1)\n};\n\n// ...\nconst interval = setInterval(counterIntervalFunction, 1000);\n```\n\nä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå®šæ—¶å™¨ä¸­è¯•å›¾ä¿®æ”¹stateçš„å€¼ï¼Œä½†æ˜¯ï¼Œå› ä¸ºé—­åŒ…çš„åŸå› ï¼ŒcounterIntervalFunctionä¸­æ‰“å°çš„ç»“æœæ¯æ¬¡éƒ½æ˜¯ 1ï¼Œå¹¶æ²¡æœ‰å®ç°ç´¯åŠ çš„æ•ˆæœã€‚\n\næ­¤æ—¶å¯ä»¥ä½¿ç”¨ç¬¬äºŒç§å†™æ³•ï¼š\n\n```js\nsetCount(prev =\u003e prev + 1)\n```\n\nä¹Ÿå¯ä»¥å€ŸåŠ© useRefï¼š\n\n```js\nconst ref = useRef({ count });\nuseEffect(() =\u003e { \n    ref.current = { count }\n}, [count]);\n```\nè¿™æ ·ï¼Œåœ¨ counterIntervalFunction é‡Œæ‹¿ ref.current.count å°±å¯ä»¥å•¦ã€‚å½“ç„¶äº†ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠæ•´ä¸ªå®šæ—¶å™¨éƒ½æ”¾åœ¨åŸºäºcountçš„ `useEffect` ä¸­ï¼Œä¸€æ ·å¯ä»¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚\n\n#### 4. åŸºäºä¸Šä¸€æ¬¡çŠ¶æ€æ›´æ–°çŠ¶æ€å€¼\n\n```js\nfunction handleClick() {  \n    // é”™è¯¯å†™æ³•\n    setAge(age + 1); // setAge(42 + 1)  \n    setAge(age + 1); // setAge(42 + 1)  \n    setAge(age + 1); // setAge(42 + 1)  \n    \n    // æ­£ç¡®å†™æ³• âœ…\n    setAge(a =\u003e a + 1); // setAge(42 =\u003e 43)  \n    setAge(a =\u003e a + 1); // setAge(43 =\u003e 44)  \n    setAge(a =\u003e a + 1); // setAge(44 =\u003e 45)\n}\n```\n\n#### 5. stateæ˜¯ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¿®æ”¹stateéœ€è¦æ”¹å˜å¼•ç”¨\n\n```js\n// ä¸ç”Ÿæ•ˆ\nform.firstName = 'Taylor';\n\n// æ¨è\nsetForm({  \n    ...form,  \n    firstName: 'Taylor'  \n});\n```\n\n#### 6. é¿å…åˆå§‹åŒ–å‡½æ•°é‡å¤æ‰§è¡Œ\n\nè€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š\n\n```js\nfunction TodoList() {  \n    const [todos, setTodos] = useState(createInitialTodos());  \n    // ...\n}\n```\n\nè™½ç„¶createInitialTodosæœ‰æ•ˆæ‰§è¡Œåªæœ‰ç»„ä»¶æŒ‚è½½æ—¶ä¸€æ¬¡ï¼Œä½†åœ¨ä¹‹åç»„ä»¶å†æ¬¡re-renderæ—¶éƒ½ä¼šè¢«æ‰§è¡Œï¼Œè¿™å°±é€ æˆäº†èµ„æºæµªè´¹ã€‚å…¶å®ä½ åªéœ€è¦ä¼ é€’åˆå§‹åŒ–å‡½æ•°å£°æ˜å°±è¡Œäº†ï¼š\n\n```js\nfunction TodoList() {  \n    const [todos, setTodos] = useState(createInitialTodos);  \n    // ...\n}\n```\n\n#### 7. é‡ç½®çŠ¶æ€å€¼\n\nå¯ä»¥å€ŸåŠ© `React` æœ€å¸¸è§çš„ key å€¼æ¥é‡ç½®çŠ¶æ€ï¼š\n\n```js\nimport { useState } from 'react';\n\nexport default function App() {\n  const [version, setVersion] = useState(0);\n\n  function handleReset() {\n    setVersion(version + 1);\n  }\n\n  return (\n    \u003c\u003e\n      \u003cbutton onClick={handleReset}\u003eReset\u003c/button\u003e\n      \u003cForm key={version} /\u003e\n    \u003c/\u003e\n  );\n}\n\nfunction Form() {\n  const [name, setName] = useState('Taylor');\n\n  return (\n    \u003c\u003e\n      \u003cinput\n        value={name}\n        onChange={e =\u003e setName(e.target.value)}\n      /\u003e\n      \u003cp\u003eHello, {name}.\u003c/p\u003e\n    \u003c/\u003e\n  );\n}\n```\n\nä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒæŠŠä¸€ä¸ª state å½“åškeyä¼ é€’ç»™è¡¨å•ç»„ä»¶ï¼Œå½“éœ€è¦é‡ç½®è¡¨å•ç»„ä»¶æ—¶ï¼Œæ”¹å˜è¿™ä¸ªkeyå€¼ï¼ŒReactç»„ä»¶å°±ä¼šè‡ªè‡ªåŠ¨ re-create ä¸€æ¬¡è¡¨å•ï¼Œè¾¾åˆ°äº†é‡ç½®çš„ç›®çš„ï¼Œé‡ç½®åï¼Œè¡¨å•ç»„ä»¶é‡Œçš„æ‰€æœ‰stateéƒ½ä¼šé‡ç½®ã€‚\n\n#### 8. ç»„ä»¶æ¸²æŸ“æœŸé—´ æ”¹å˜ state\n\nä¸€èˆ¬ä¸Šï¼ŒçŠ¶æ€å€¼çš„ä¿®æ”¹éƒ½ä¼šæ”¾åœ¨ä¸€ä¸ªäº‹ä»¶çš„handleBaré‡Œï¼Œä½†æ˜¯ï¼Œæœ‰æ—¶å€™ä½ æƒ³è¦åœ¨é™¤äº†äº‹ä»¶ä»¥å¤–çš„å“åº”ä¸­æ”¹å˜çŠ¶æ€å€¼ ï¼ˆæ¯”å¦‚ props æ”¹å˜çš„æ—¶å€™ï¼‰ï¼Œåº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿä¸‹é¢ç»™å‡ºä¸€ä¸ªèŒƒä¾‹ï¼š\n\n```js\nimport { useState } from 'react';\n\nexport default function CountLabel({ count }) {\n  const [prevCount, setPrevCount] = useState(count);\n  const [trend, setTrend] = useState(null);\n  if (prevCount !== count) {\n    setPrevCount(count);\n    setTrend(count \u003e prevCount ? 'increasing' : 'decreasing');\n  }\n  return (\n    \u003c\u003e\n      \u003ch1\u003e{count}\u003c/h1\u003e\n      {trend \u0026\u0026 \u003cp\u003eThe count is {trend}\u003c/p\u003e}\n    \u003c/\u003e\n  );\n}\n```\nä¸Šé¢çš„ä¾‹å­ä½¿ç”¨èµ·æ¥éœ€æ³¨æ„ï¼Œ`prevCount !== count`çš„åˆ¤æ–­æ¡ä»¶ä¸èƒ½çœå»ï¼Œä¸ç„¶å°±ä¼šé™·å…¥åå¤ set çŠ¶æ€çš„æ­»å¾ªç¯é‡Œã€‚\n\nå½“ç„¶äº†ï¼Œä½ ä¹Ÿå¯ä»¥åƒä¸Šä¸€ç¯‡æ–‡ç« é‚£æ ·ï¼Œä½¿ç”¨ useMemo è·å¾—è®¡ç®—å±æ€§ã€‚\n\n### Q\u0026A\n\n#### 1. æˆ‘å·²ç»æ›´æ–°äº†çŠ¶æ€ï¼Œä½†æ˜¯console.logæ‰“å°äº†æ—§çš„å€¼\n\n```js\nfunction handleClick() {  \n    console.log(count); // 0  \n    setCount(count + 1); // Request a re-render with 1  \n    console.log(count); // Still 0!  \n    \n    setTimeout(() =\u003e {  \n        console.log(count); // Also 0!  \n    }, 5000);  \n}\n```\n\nå› ä¸ºReact çš„stateç±»ä¼¼äºå¿«ç…§ï¼Œæ›´æ–°äº†çŠ¶æ€åï¼Œå¹¶ä¸å½±å“ä¹‹å‰å·²ç»åœ¨fiberä»»åŠ¡äº‹ä»¶å¾ªç¯é‡Œçš„çŠ¶æ€ã€‚å¦‚æœéœ€è¦ç«‹å³ä½¿ç”¨ï¼Œå¯ä»¥å€ŸåŠ©ä¸´æ—¶å˜é‡ï¼š\n\n```js\nconst nextCount = count + 1;  \n\nsetCount(nextCount);  \n\nconsole.log(count); // 0  \n\nconsole.log(nextCount); // 1\n```\n\n#### 2. æˆ‘å·²ç»æ›´æ–°äº†çŠ¶æ€ï¼Œä½†æ˜¯ç•Œé¢ä¸å˜åŒ–\n\nå‰åä¸¤æ¬¡ä¿®æ”¹çš„çŠ¶æ€ï¼Œå¦‚æœç›¸ç­‰ï¼ˆObject.isï¼‰çš„è¯ï¼Œå°±ä¸ä¼šå»è§¦å‘æ¸²æŸ“ã€‚é”™è¯¯ç¤ºèŒƒï¼š\n\n```js\nobj.x = 10; // ğŸš© Wrong: mutating existing object  \nsetObj(obj); // ğŸš© Doesn't do anything\n```\n\næ­£ç¡®ä½¿ç”¨æ–¹å¼ï¼š\n\n```js\n// âœ… Correct: creating a new object\nsetObj({\n  ...obj,\n  x: 10\n});\n```\n\n#### 3. æ§åˆ¶å°æŠ¥é”™ â€œToo many re-renders. React limits the number of renders to prevent an infinite loop.â€\n\nä¸€èˆ¬è¿™ç§æƒ…å†µå°±æ˜¯ç»„ä»¶æ¸²æŸ“è¿›å…¥äº†æ­»å¾ªç¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¯èƒ½çš„ä¾‹å­åŠè§£å†³æ–¹æ¡ˆï¼š\n\n```js\n// ğŸš© Wrong: calls the handler during render\nreturn \u003cbutton onClick={handleClick()}\u003eClick me\u003c/button\u003e\n\n// âœ… Correct: passes down the event handler\nreturn \u003cbutton onClick={handleClick}\u003eClick me\u003c/button\u003e\n\n// âœ… Correct: passes down an inline function\nreturn \u003cbutton onClick={(e) =\u003e handleClick(e)}\u003eClick me\u003c/button\u003e\n```\n\n#### 4. æˆ‘æƒ³è¦æŠŠä¸€ä¸ªå‡½æ•°ä½œä¸º stateï¼Œä½†æ˜¯å´å½“æˆäº†åˆå§‹å‡½æ•°æ‰§è¡Œäº†\n\nä¸Šé¢çš„è®²è¿‡ï¼ŒuseState çš„å…¥å‚å¦‚æœæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™ä¼šå°†å‡½æ•°æ‰§è¡Œç»“æœä½œä¸ºåˆå§‹å‡½æ•°ã€‚å¦‚æœä¸€å®šè¦ä¼ ä¸€ä¸ªå‡½æ•°ä½œä¸ºçŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨é«˜é˜¶å‡½æ•°ï¼š\n\n```js\nconst [fn, setFn] = useState(() =\u003e someFunction);\n\nfunction handleClick() {\n  setFn(() =\u003e someOtherFunction);\n}\n```\n\n## 2. useReducer\n\nuseReducer æ˜¯ä¸€ä¸ªä¸€èˆ¬åŒ–çš„ useStateï¼Œæ¯” useState å¤šäº†ä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°å¯ä»¥æ ¹æ®ä¸åŒçš„åˆ†å‘çŠ¶æ€æ¥ç›¸åº”çš„æ”¹å˜çŠ¶æ€ã€‚å¯ä»¥è¿™ä¹ˆç†è§£ï¼ŒuseReducer æ˜¯ä¸€ä¸ªæå‰å†™å¥½äº†æ€ä¹ˆå¤„ç† state çš„å‡½æ•°çš„ useStateã€‚\n\nå£°æ˜æ ¼å¼ï¼š\n\n```js\nconst [state, dispatch] = useReducer(reducer, initialArg, init)\n```\n\n### æ¥æ”¶å‚æ•°\n\n1. reducer\n\nreducer å‡½æ•°æŒ‡å®šå¦‚ä½•æ›´æ–°çŠ¶æ€ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ã€‚\n\n2. initialArg\n\nçŠ¶æ€çš„åˆå§‹å€¼\n\n3. init\n\nå¯é€‰åˆå§‹åŒ–å¤„ç†å‡½æ•°ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™åˆå§‹çŠ¶æ€è®¾ç½®ä¸º initialArgã€‚å¦åˆ™ï¼Œåˆå§‹çŠ¶æ€è®¾ç½®ä¸ºè°ƒç”¨ `init(initialArg)` çš„ç»“æœã€‚\n\n### è¿”å›å€¼\n\n1. state ä¸ºå½“å‰çš„çŠ¶æ€å€¼\n2. dispatch å‡½æ•°ï¼Œç”¨äºæ›´æ–°çŠ¶æ€\n\n### æ³¨æ„äº‹é¡¹\n\nä½¿ç”¨æ–¹å¼åŒ useState\n\n### åŸºæœ¬ä½¿ç”¨\n\n```js\nimport { useReducer } from 'react';\n\nfunction reducer(state, action) {\n  // ...\n}\n\nconst [state, dispatch] = useReducer(reducer, { age: 42 });\n\nfunction handleClick() {\n  dispatch({ type: 'incremented_age' });\n  // ...\n}\n```\n\n#### dispatch å‡½æ•°\n\næ¥å—ä¸€ä¸ª state å’Œ actionã€‚action å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„å€¼ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæ ‡å¿—ä½ + payload çš„å½¢å¼ï¼›åŒæ—¶ï¼Œdispatch å‡½æ•°æ²¡æœ‰è¿”å›å€¼ã€‚\n\n### ä½¿ç”¨ä¾‹å­\n\n###### 1. ä¸formè¡¨å•ç»“åˆ\n\n```jsx\nimport { useReducer } from 'react';\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'incremented_age': {\n      return {\n        ...state,\n        age: state.age + 1\n      };\n    }\n    case 'changed_name': {\n      return {\n        name: action.nextName,\n        age: state.age\n      };\n    }\n  }\n  \n  // è¿™é‡Œå¤„ç†æœªçŸ¥æƒ…å†µï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æŠ›å‡ºé”™è¯¯\n  throw Error('Unknown action: ' + action.type);\n}\n\nconst initialState = { name: 'Taylor', age: 42 };\n\nexport default function Form() {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  function handleButtonClick() {\n    dispatch({ type: 'incremented_age' });\n  }\n\n  function handleInputChange(e) {\n    dispatch({\n      type: 'changed_name',\n      nextName: e.target.value\n    }); \n  }\n\n  return (\n    \u003c\u003e\n      \u003cinput\n        value={state.name}\n        onChange={handleInputChange}\n      /\u003e\n      \u003cbutton onClick={handleButtonClick}\u003e\n        Increment age\n      \u003c/button\u003e\n      \u003cp\u003eHello, {state.name}. You are {state.age}.\u003c/p\u003e\n    \u003c/\u003e\n  );\n}\n```\n\nè¡¨å•å…ƒç´ çš„ value æ˜¯ stateå†…éƒ¨çš„å€¼ï¼Œåœ¨è¡¨å•å…ƒç´ æ”¹å˜çš„äº‹ä»¶ä¸­ï¼Œdispatchè¿™ä¸ªreducerï¼Œdispatché‡Œä¼ äº†ä¸ª typeå’Œä¸€ä¸ª payload é¡¹ï¼šnextNameï¼Œæ­¤æ—¶ï¼Œreducerå°±å¯ä»¥æ¥æ”¶å‚æ•°äº†ï¼šstateå°±æ˜¯å½“å‰å˜æ›´å‰çš„çŠ¶æ€å€¼ï¼Œactionå°±æ˜¯ dispatch ä¼ é€’çš„å‚æ•°ã€‚\n\n\u003e P.S. reducer å‡½æ•°é‡Œä¸èƒ½ç›´æ¥æ”¹ stateï¼š`state.age = state.age + 1;`ï¼Œä»–åº”è¯¥è¿”å›ä¸€ä¸ªæ–°çš„å¼•ç”¨çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šè‡ªåŠ¨è¢« useReducer è®¾ç½®ã€‚\n\n###### 2. é¿å…é‡æ–°æ‰§è¡Œåˆå§‹å‡½æ•°\n\nè€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š\n\n```js\nfunction createInitialState(username) {  \n    // ...  \n}  \n\nfunction TodoList({ username }) {  \n    const [state, dispatch] = useReducer(reducer, createInitialState(username));  \n    // ...\n}\n```\n\nç¬¬äºŒä¸ªå‚æ•°æœ¬æ¥æ˜¯åˆå§‹åŒ–çŠ¶æ€çš„ä½ç½®ï¼Œä¼ äº†ä¸ªå‡½æ•°è°ƒç”¨ï¼Œè€Œä¸æ˜¯å‡½æ•°å£°æ˜ï¼Œåœ¨æ¯æ¬¡ç»„ä»¶re-renderæ—¶éƒ½ä¼šè¢«æ‰§è¡Œï¼Œå½±å“æ€§èƒ½ã€‚\n\nè€ƒè™‘å¦‚ä¸‹æ”¹é€ ï¼š\n\n```js\nconst [state, dispatch] = useReducer(reducer, username, createInitialState);\n```\nç¬¬äºŒä¸ªå‚æ•°è¿˜æ˜¯é™æ€çš„åˆå§‹å€¼ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è‡ªå®šä¹‰çš„åˆå§‹åŒ–å¤„ç†å‡½æ•°ï¼Œåœ¨åˆå§‹åŒ–æ—¶ï¼Œä¼šå°† `createInitialState(username)` çš„è¿”å›å€¼ä½œä¸ºåˆå§‹å€¼ã€‚\n\n### Q\u0026A\n\n###### 1. dispatch åå¦‚ä½•ä½¿ç”¨æœ€æ–°çš„çŠ¶æ€å€¼\n\nä¸ useState ç±»ä¼¼ï¼Œéœ€ä½¿ç”¨å±€éƒ¨å˜é‡ï¼š\n\n```js\nconst action = { type: 'incremented_age' };\ndispatch(action);\n\nconst nextState = reducer(state, action);\nconsole.log(state);     // { age: 42 }\nconsole.log(nextState); // { age: 43 }\n```\n\n###### 2. æˆ‘çš„ reducer ä¸ºä»€ä¹ˆæ€»æ˜¯è¢«æ‰§è¡Œäº†å¤šæ¬¡ï¼Ÿ\n\nè¿™ä¸ªè¿˜æ˜¯è·Ÿä¸¥æ ¼æ¨¡å¼å’Œå¼€å‘ç¯å¢ƒæœ‰å…³ç³»çš„ã€‚å¼€å‘ç¯å¢ƒä¼šå¸®ä½ æ£€æµ‹ä½ çš„ reducer æ˜¯å¦æ˜¯çº¯å‡½æ•°ã€‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š\n\n```js\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'added_todo': {\n      // ğŸš© Mistake: mutating state\n      state.todos.push({ id: nextId++, text: action.text });\n      return state;\n    }\n    // ...\n  }\n}\n```\nä¸Šé¢çš„ reducer å°±ä¸æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œæ‰§è¡Œä¸¤æ¬¡ï¼Œtodosæ•°ç»„æ•°æ®å°±ä¼šé”™ä¹±ï¼Œå¼€å‘è€…å°±å¾ˆå®¹æ˜“å‘ç°é—®é¢˜å¹¶åŠæ—¶æ”¹æ­£ã€‚ä¸‹é¢ç»™å‡ºæ­£ç¡®çš„å‚è€ƒï¼š\n\n```js\n// âœ… Correct: replacing with new state\nreturn {\n  ...state,\n  todos: [\n    ...state.todos,\n    { id: nextId++, text: action.text }\n  ]\n};\n```\n\n\u003e ä¸çŸ¥ä¸è§‰ï¼Œå†™åˆ°è¿™é‡Œå·²ç» 1W å­—äº†...\n\n----\n\næœ¬æœŸçš„å®˜ç½‘è§£è¯»å°±åˆ°è¿™é‡Œå•¦ï¼Œå€ºè§ï¼"])</script><script>self.__next_f.push([1,"2e:T2d8e,"])</script><script>self.__next_f.push([1,"React å®˜ç½‘å‡ºäº† beta ç‰ˆçš„æ–°ç‰ˆæœ¬ï¼Œä»æ—§æ²¡æœ‰ä¸­æ–‡ç‰ˆã€‚å¯¹äºå›½å†…ä¸å°‘å¼€å‘è€…æ¥è¯´å¢åŠ äº†ä¸å°‘éº»çƒ¦ã€‚æˆ‘è¿™é‡Œä»¥å‰ç«¯å¼€å‘çš„è§’åº¦å½’çº³æ€»ç»“ä¸€ä¸‹ï¼ŒæŠŠå…¶ä¸­å¤§å®¶é‡ç‚¹ä½¿ç”¨çš„éƒ¨åˆ†ä»‹ç»ç»™å¤§å®¶ã€‚\n\nå®˜ç½‘åœ°å€ï¼š[React](https://beta.reactjs.org/)\n\næˆ‘ä»¬å…ˆä»ç”¨çš„æœ€å¤šçš„ hook éƒ¨åˆ†å¼€å§‹ã€‚\n\n## 1. [useCallback]\n\nuseCallback è¿”å›ä¸€ä¸ªè®°å¿†åŒ–çš„å›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åªæœ‰åœ¨ä¾èµ–é¡¹æ”¹å˜æ—¶æ‰ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™æ˜¯å¯¹å›è°ƒå‡½æ•°è¿›è¡Œæ€§èƒ½ä¼˜åŒ–çš„ä¸€ç§æ–¹å¼ï¼Œä»¥ç¡®ä¿å­ç»„ä»¶ä¸ä¼šåœ¨çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶é‡å¤æ¸²æŸ“ã€‚\n\nå®šä¹‰ï¼š\n\n```js\nconst cachedFn = useCallback(fn, dependencies);\n```\n\n### ä½¿ç”¨\n\n```js\nimport { useCallback } from 'react';\n\nexport default function ProductPage({ productId, referrer, theme }) {\n  const handleSubmit = useCallback(\n    (orderDetails) =\u003e {\n      post('/product/' + productId + '/buy', {\n        referrer,\n        orderDetails,\n      });\n    },\n    [productId, referrer],\n  );\n}\n```\n\n### å‚æ•°\n\n- fnï¼šæƒ³è¦ç¼“å­˜çš„å‡½æ•°\n- ä¾èµ–é¡¹ï¼šç¼“å­˜æ›´æ–°çš„æ¡ä»¶\n\n### è¿”å›å€¼\n\n- åˆå§‹åŒ–æ—¶ï¼Œè¿”å›ç¼“å­˜çš„åŸå§‹å‡½æ•°\n- ä¾èµ–é¡¹æ²¡æœ‰å˜åŒ–ï¼ˆObject.is åˆ¤æ–­ï¼‰ï¼Œè¿”å›ä¸Šæ¬¡ç¼“å­˜çš„å‡½æ•°ï¼Œå¦åˆ™è¿”å›æœ€æ–°çš„å‡½æ•°\n\n### æ³¨æ„äº‹é¡¹\n\n- ç»„ä»¶æ–‡ä»¶ä¿®æ”¹åï¼Œç¼“å­˜ä¼šå¤±æ•ˆ\n- åˆå§‹åŒ–åï¼Œsuspends åŠ è½½å‰çš„ç»„ä»¶ï¼Œä¸ä¼šç¼“å­˜å‡½æ•°\n\n### Future\n\n- æœ‰æœ›åœ¨è™šæ‹Ÿåˆ—è¡¨å®ç°æ»šåŠ¨åŒºåŸŸå¤–çš„å…ƒç´ åœæ­¢ç¼“å­˜\n\n### ä½¿ç”¨åœºæ™¯\n\n#### åœ¨ç»„ä»¶ re-render æ—¶è·³è¿‡é‡æ¸²æŸ“\n\nå®˜æ–¹æ¡ˆä¾‹ï¼š\n\n```js\n// å‡è®¾æ²¡æœ‰ä½¿ç”¨ useCallback çš„ ProductPage\nexport default function ProductPage({ productId, referrer, theme }) {\n  const handleSubmit = (orderDetails) =\u003e {\n    post('/product/' + productId + '/buy', {\n      referrer,\n      orderDetails,\n    });\n  }\n\n  return (\n    \u003cdiv className={theme}\u003e\n      \u003cShippingForm onSubmit={handleSubmit} /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nå½“ theme å˜åŒ–æ—¶ï¼ŒShippingForm ä¼šè¢«é‡æ–°æ¸²æŸ“ï¼Œé¡µé¢éš¾å…é€ æˆé˜»å¡ã€‚æ¥ä¸‹æ¥ä¼˜åŒ– ShippingFormã€‚\n\n\u003e å®˜æ–¹æ³¨é‡Šï¼šBy default, when a component re-renders, React re-renders all of its children recursively. \n\nä¸ºäº†è§„é¿ç”± props å˜åŒ–é€ æˆçš„ä¸å¿…è¦çš„æ¸²æŸ“ï¼Œå¯ä»¥ä½¿ç”¨ memoï¼š\n\n```js\nconst ShippingFormMemo = memo(function ShippingForm({ onSubmit }) {\n  // ...\n});\n```\n\nä¸Šé¢è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ props æ£€æµ‹å‡ºå˜åŒ–å‰åä¸€æ ·æ—¶ï¼Œè¢« memo åŒ…è£¹çš„ç»„ä»¶ä¸åšé‡æ–°æ¸²æŸ“ã€‚æ­¤æ—¶ï¼Œ**useCallback å°±èƒ½èµ·åˆ°ä½œç”¨äº†**ã€‚ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœä½ ä¸ä½¿ç”¨ useCallbackï¼Œç»„ä»¶æ¸²æŸ“å‰åï¼Œjs ä¼šåˆ›å»ºä¸¤æ¬¡ handleSubmitï¼Œä»–ä»¬åœ¨å†…å­˜ä¸­åœ°å€ä¸ä¸€æ ·ï¼Œè‡ªç„¶æ˜¯ä¸åŒçš„æ•°æ®ï¼Œæ­¤æ—¶ memo å°±å¤±æ•ˆäº†ï¼\n\næ‰€ä»¥ä¸ºäº† memo èƒ½å¤Ÿèµ·ä½œç”¨ï¼Œè¢«ä»–åŒ…è£¹çš„ ç»„ä»¶ä¸­çš„propsçš„å±æ€§åº”è¯¥ä½¿ç”¨ useCallbackã€‚\n\n#### åœ¨ç¼“å­˜ä¸­ä½¿ç”¨ state\n\n```js\nfunction TodoList() {\n  const [todos, setTodos] = useState([]);\n\n  const handleAddTodo = useCallback(\n    (text) =\u003e {\n      const newTodo = { id: nextId++, text };\n      setTodos([...todos, newTodo]);\n    },\n    [todos],\n  );\n  // ...\n}\n```\n\nè®¾ç½® state çš„è¯­å¥å¯ä»¥å†™æˆä¸‹é¢å½¢å¼ï¼š\n\n```js\nconst handleAddTodo = useCallback((text) =\u003e {\n  const newTodo = { id: nextId++, text };\n  setTodos((todos) =\u003e [...todos, newTodo]);\n}, []); // âœ… No need for the todos dependency\n```\n\n#### é˜²æ­¢ useEffect è¿‡å¤šè§¦å‘\n\nçœ‹ä¸‹é¢èŠå¤©å®¤çš„ä¾‹å­ï¼š\n\n```js\nfunction createOptions() {\n  return {\n    serverUrl: 'https://localhost:1234',\n    roomId: roomId,\n  };\n}\n\nuseEffect(() =\u003e {\n  const options = createOptions();\n  const connection = createConnection();\n  connection.connect();\n  return () =\u003e connection.disconnect();\n}, [createOptions]);\n```\n\nç”¨ createOptions ä¼šé€ æˆå¾ªç¯æ£€æµ‹ï¼Œå¯¼è‡´ä¸€ç›´è°ƒç”¨ useEffect çš„æ­»å¾ªç¯ã€‚æ­¤æ—¶ï¼Œå¯ä»¥å°† createOptions ä¹Ÿç¼“å­˜ä¸€ä¸‹å³å¯ï¼š\n\n```js\nconst createOptions = useCallback(() =\u003e {\n  return {\n    serverUrl: 'https://localhost:1234',\n    roomId: roomId,\n  };\n}, [roomId]);\n```\n\næ­¤æ—¶ï¼Œæ—¢ç„¶æœ‰ä¸€ä¸ªå¼•ç”¨é“¾ï¼Œæ ¹æºéƒ½ä¾èµ– roomIdï¼Œæ‰€ä»¥å¯ä»¥åˆå¹¶ï¼Œå› æ­¤æœ‰æ›´è¿›ä¸€æ­¥çš„æ”¹è¿›æ–¹æ¡ˆï¼š\n\n```js\nuseEffect(() =\u003e {\n  function createOptions() {\n    // âœ… No need for useCallback or function dependencies!\n    return {\n      serverUrl: 'https://localhost:1234',\n      roomId: roomId,\n    };\n  }\n\n  const options = createOptions();\n  const connection = createConnection();\n  connection.connect();\n  return () =\u003e connection.disconnect();\n}, [roomId]); // âœ… Only changes when roomId changes\n```\n\n#### è‡ªå®šä¹‰ hook æ—¶ä½¿ç”¨\n\nè‡ªå®šä¹‰ hook æ—¶ï¼Œæ¨èæ‰€æœ‰çš„å‡½æ•°ç¼“å­˜ä¸€ä¸‹ï¼Œä»¥ä¾¿äºåœ¨å¤–éƒ¨ä½¿ç”¨æ—¶ä¸ç•™æ€§èƒ½é—®é¢˜çš„å‘ï¼Œä¾¿äºéšæ—¶ä¼˜åŒ–æ€§èƒ½ï¼š\n\n```js\nfunction useRouter() {\n  const { dispatch } = useContext(RouterStateContext);\n\n  const navigate = useCallback(\n    (url) =\u003e {\n      dispatch({ type: 'navigate', url });\n    },\n    [dispatch],\n  );\n\n  const goBack = useCallback(() =\u003e {\n    dispatch({ type: 'back' });\n  }, [dispatch]);\n\n  return {\n    navigate,\n    goBack,\n  };\n}\n```\n\n### QA\n\n- å¦‚ä½•åœ¨å¾ªç¯åˆ—è¡¨é‡Œä½¿ç”¨ useCallback\n\nä¸å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¼šç ´å hook çš„é“¾è¡¨ç»“æ„ã€‚æ¨èçš„åšæ³•æ˜¯å°†å…¬å…±ç»„ä»¶æå–å‡ºæ¥ï¼Œåœ¨æå–çš„å…¬å…±ç»„ä»¶ä¸­ä½¿ç”¨ã€‚\n\n## 2. [useMemo]\n\nuseMemo ä¸ useCallback çš„åŸç†ç±»ä¼¼ã€‚å®ƒæ˜¯ç”¨æ¥ç¼“å­˜è®¡ç®—ç»“æœçš„ï¼Œç±»ä¼¼äº vue çš„è®¡ç®—å±æ€§ã€‚\n\nå®šä¹‰ï¼š\n\n```js\nconst cachedValue = useMemo(calculateValue, dependencies)\n```\n\n### ä½¿ç”¨\n\n```js\nimport { useMemo } from 'react';  \n\nfunction TodoList({ todos, tab }) {  \n    const visibleTodos = useMemo(  \n        () =\u003e filterTodos(todos, tab),  \n        [todos, tab]  \n    );  \n    // ...  \n}\n```\n\n### å‚æ•°\n\n- fnï¼šç”¨æˆ·è¿”å›æƒ³è¦ç¼“å­˜çš„æ•°å€¼ï¼Œå¯ä»¥ä¼ é€’å‚æ•°\n- ä¾èµ–é¡¹ï¼šç¼“å­˜æ›´æ–°çš„æ¡ä»¶\n\n### å“åº”å¼è¿”å›å€¼\n\n- åˆå§‹åŒ–æ—¶ï¼Œè¿”å›ä¸€æ¬¡ fn çš„è¿”å›å€¼\n- ä¾èµ–é¡¹æ²¡æœ‰å˜åŒ–ï¼ˆObject.is åˆ¤æ–­ï¼‰ï¼Œè¿”å›ä¸Šæ¬¡ç¼“å­˜çš„å€¼ï¼Œå¦åˆ™è¿”å›æœ€æ–°çš„è®¡ç®—å€¼ï¼Œå¹¶å†æ¬¡ç¼“å­˜\n\n### æ³¨æ„äº‹é¡¹\n\n- åªèƒ½åœ¨å‡½æ•°å¼ç»„ä»¶é¡¶éƒ¨ä½¿ç”¨\n- åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒReactä¼šè°ƒç”¨è®¡ç®—å‡½æ•°ä¸¤æ¬¡ï¼Œä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾æ„å¤–æ‚è´¨ã€‚è¿™åªæ˜¯**å¼€å‘è¡Œä¸º**ï¼Œä¸å½±å“ç”Ÿäº§ã€‚å¦‚æœæ‚¨çš„è®¡ç®—å‡½æ•°æ˜¯çº¯çš„ï¼Œè¿™ä¸ä¼šå½±å“ç»„ä»¶çš„é€»è¾‘ã€‚å…¶ä¸­ä¸€ä¸ªè°ƒç”¨çš„ç»“æœå°†è¢«å¿½ç•¥ã€‚\n- ç¼“å­˜è¢«ä¸¢å¼ƒçš„æƒ…å†µï¼šåœ¨å¼€å‘ä¸­ï¼Œå½“ç¼–è¾‘ç»„ä»¶æ–‡ä»¶æ—¶ï¼ŒReactä¼šä¸¢å¼ƒç¼“å­˜ã€‚åœ¨å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåœ¨ suspends åŠ è½½å‰çš„ç»„ä»¶ï¼Œä¸ä¼šç¼“å­˜å‡½æ•°ï¼ŒReactå°†ä¸¢å¼ƒç¼“å­˜ã€‚\n\n### Future\n\n- æœªæ¥æœŸæœ›æ·»åŠ å¯¹è™šæ‹ŸåŒ–åˆ—è¡¨çš„å†…ç½®æ”¯æŒã€‚æ­¤æ—¶ä¼šè‡ªåŠ¨ä¸¢å¼ƒä¸åœ¨å¯è§†çª—å£å†…çš„åˆ—è¡¨ç¼“å­˜ã€‚\n\n### ä½¿ç”¨åœºæ™¯\n\n#### è·³è¿‡æ²¡å¿…è¦çš„å€¼é‡è®¡ç®—\n\nè¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ä½¿ç”¨åœºæ™¯ï¼Œåœ¨ä¾èµ–æ²¡æœ‰å˜åŒ–æ—¶ï¼Œä½¿ç”¨ç¼“å­˜å€¼ï¼Œè€Œä¸ç”¨é‡æ–°è®¡ç®—ï¼š\n\n```js\nimport { useMemo } from 'react';\n\nfunction TodoList({ todos, tab, theme }) {\n  const visibleTodos = useMemo(() =\u003e filterTodos(todos, tab), [todos, tab]);\n  // ...\n}\n```\n\nè¿™é‡Œçš„è®¡ç®—å‡½æ•°ï¼Œå¯ç®€å•å¯å¤æ‚ã€‚å¦‚æœè®¡ç®—å‡½æ•°å¾ˆç®€å•ï¼Œé‚£ä¹ˆä¸ç¼“å­˜ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºè®¡ç®—ä¼šå¾ˆå¿«ã€‚ç„¶è€Œï¼Œå¦‚æœè¦è¿‡æ»¤æˆ–è½¬æ¢å¤§å‹æ•°ç»„æˆ–è€…å¤æ‚çš„æ•°æ®ç»“æ„æ—¶ï¼Œæˆ–è¿›è¡Œä¸€äº›è€—æ—¶çš„è®¡ç®—ï¼ˆ`console.time`æ¥æµ‹è¯•ï¼‰æ—¶ï¼Œç¼“å­˜å°±å¾ˆæœ‰å¿…è¦äº†ã€‚\n\n#### è·³è¿‡æ²¡å¿…è¦çš„ç»„ä»¶é‡æ¸²æŸ“\n\nè¿˜ä»¥ä¸Šé¢çš„å¾…åŠåˆ—è¡¨çš„ä¾‹å­ï¼š\n\n```js\nexport default function TodoList({ todos, tab, theme }) {\n  // Every time the theme changes, this will be a different array...  \n  const visibleTodos = filterTodos(todos, tab);\n  \n  return (\n    \u003cdiv className={theme}\u003e\n      \u003cList items={visibleTodos} /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nä¸Šé¢çš„ä»£ç ï¼ŒåŸºäº React çš„æ¸²æŸ“åŸç†ï¼Œå½“ä¸€ä¸ªç»„ä»¶é‡æ¸²æŸ“ï¼Œå…¶å­ç»„ä»¶ä¼šå…¨éƒ¨é‡æ¸²æŸ“ã€‚æ‰€ä»¥ theme å˜åŒ–åï¼ŒList ç»„ä»¶å°±ä¼šè¢«é‡æ¸²æŸ“ã€‚æˆ‘ä»¬ä½¿ç”¨ memo æ£€æµ‹ props å˜åŒ–ï¼š\n\n```js\nimport { memo } from 'react';\n\nconst List = memo(function List({ items }) {\n  // ...\n});\n```\n\nä½†è¿˜æ˜¯ä¹‹å‰çš„é—®é¢˜ï¼Œprops ä¼ å…¥çš„å¯¹è±¡ä¹Ÿåº”è¯¥ç¼“å­˜ã€‚æ¯æ¬¡ TodoList é‡æ¸²æŸ“ï¼ŒvisibleTodos åˆ—è¡¨æ˜¯ä¸€ä¸ªä¸åŒçš„å€¼äº†ï¼Œæ‰€ä»¥ï¼ŒList çš„ memo ä¼šå¤±æ•ˆã€‚å› ä¸º visibleTodos ä¸æ˜¯å‡½æ•°ï¼Œæˆ‘ä»¬ä¸ç”¨ useCallbackï¼Œæˆ‘ä»¬ä½¿ç”¨ useMemoï¼š\n\n```js\nconst visibleTodos = useMemo(\n  () =\u003e filterTodos(todos, tab),\n  [todos, tab] // ...so as long as these dependencies don't change...\n);\n```\n\n#### ç¼“å­˜ä¸€ä¸ª hook çš„ä¾èµ–å…³ç³»\n\nå‡è®¾æœ‰ä¸ªåœ¨ç»„ä»¶å†…éƒ¨æ–°åˆ›å»ºçš„å¯¹è±¡ï¼š\n\n```js\nfunction Dropdown({ allItems, text }) {\n  const searchOptions = { matchMode: 'whole-word', text };\n\n  const visibleItems = useMemo(() =\u003e {\n    return searchItems(allItems, searchOptions);\n  }, [allItems, searchOptions]); // ğŸš© Caution: Dependency on an object created in the component body\n  // ...\n}\n```\nä¸Šé¢ä¾‹å­ä¸­ï¼ŒsearchOptions å°±æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ¯æ¬¡æ¸²æŸ“ç»„ä»¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚è¿™å°±åˆä¼šé€ æˆ ä¸‹è¾¹ useMemo å¤±æ•ˆï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š\n\n```js\nconst searchOptions = useMemo(() =\u003e {  \n  return { matchMode: 'whole-word', text };  \n}, [text]); // âœ… Only changes when text changes\n```\n\nå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸¤ä¸ª useMemo åˆå¹¶ä¸€ä¸ªï¼š\n\n```js\nconst visibleItems = useMemo(() =\u003e {\n  const searchOptions = { matchMode: 'whole-word', text };\n  return searchItems(allItems, searchOptions);\n}, [allItems, text]); // âœ… Only changes when allItems or text changes\n```\n\n#### ç¼“å­˜å‡½æ•°\n\nä¸¾ä¸€ä¸ªè¡¨å•æäº¤çš„ä¾‹å­ï¼š\n\n```js\nexport default function ProductPage({ productId, referrer }) {\n  function handleSubmit(orderDetails) {\n    post('/product/' + productId + '/buy', {\n      referrer,\n      orderDetails,\n    });\n  }\n\n  return \u003cForm onSubmit={handleSubmit} /\u003e;\n}\n```\n\nhandleSubmit æ¯æ¬¡é‡æ¸²æŸ“éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¯¼è‡´ Form å­ç»„ä»¶ä¹Ÿé‡æ¸²æŸ“äº†ã€‚é™¤äº†ä½¿ç”¨ useCallbackï¼Œè¿˜å¯ä»¥ä½¿ç”¨ useMemoï¼š\n\n```js\nconst handleSubmit = useMemo(() =\u003e {\n  return (orderDetails) =\u003e {\n    post('/product/' + product.id + '/buy', {\n      referrer,\n      orderDetails,\n    });\n  };\n}, [productId, referrer]);\n```\n\nåªéœ€è¦è®© useMemo çš„ fn è¿”å›ä¸€ä¸ªå‡½æ•°å°±è¡Œäº†ã€‚å®˜æ–¹å»ºè®®ï¼Œç¼“å­˜å‡½æ•°ä½¿ç”¨ useCallbackï¼Œè¿™æ ·ä¼šé¿å…å¤šå†™ä¸€ä¸ªåŒ…è£¹å‡½æ•°è€Œé€ æˆä»£ç å¯è¯»æ€§ä¸‹é™ã€‚\n\n### QA\n\n- **ä¸ºä»€ä¹ˆæˆ‘çš„è®¡ç®—å€¼æ¯æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œä¸¤æ¬¡**\n\nå› ä¸ºï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒReactå°†è°ƒç”¨æŸäº›å‡½æ•°ä¸¤æ¬¡è€Œä¸æ˜¯ä¸€æ¬¡ã€‚è€Œä¸”è¿™åªåœç•™åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œåªè¦ä½ çš„ç»„ä»¶å’Œè®¡ç®—å‡½æ•°æ˜¯çº¯çš„ï¼Œè¿™å°±ä¸ä¼šå½±å“é€»è¾‘ã€‚ä½†æ˜¯ä¸ºäº†è®©ä»£ç æ›´å¥å£®ï¼Œä¸‹é¢çš„ä»£ç å°±æ˜¯å¯æ”¹è¿›çš„ï¼š\n\n```js\nconst visibleTodos = useMemo(() =\u003e {\n  // ğŸš© Mistake: mutating a prop\n  todos.push({ id: 'last', text: 'Go for a walk!' });\n  const filtered = filterTodos(todos, tab);\n  return filtered;\n}, [todos, tab]);\n```\ntodosä½œä¸ºä¾èµ–é¡¹ ä¼šè¢« push ä¸¤æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š\n\n```js\nconst visibleTodos = useMemo(() =\u003e {\n  const filtered = filterTodos(todos, tab);\n  // âœ… Correct: mutating an object you created during the calculation\n  filtered.push({ id: 'last', text: 'Go for a walk!' });\n  return filtered;\n}, [todos, tab]);\n```\nè¿™æ ·å°±ä¿è¯äº† useMemo ä¾èµ–çš„ä¸€è‡´æ€§ã€‚å³ä½¿è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œé‚£ä¸ªå¯¹è±¡ä¹Ÿä¸ä¼šè¢« push ä¸¤ä¸ªç›¸åŒçš„å¯¹è±¡ã€‚\n\n- **ä¸ºä»€ä¹ˆæˆ‘çš„ useMemo è¿”å›äº† undefined**\n\né”™è¯¯ä»£ç ç¤ºä¾‹ï¼š\n\n```js\n// ğŸ”´ You can't return an object from an arrow function with () =\u003e {\nconst searchOptions = useMemo(() =\u003e {\n  matchMode: 'whole-word',\n  text: text\n}, [text]);\n```\nåŸå› ï¼šæ²¡æœ‰å†™è¿”å›å€¼ã€‚ä½ åº”è¯¥æŠŠæƒ³è¦çš„å¯¹è±¡ return è¿”å›å‡ºå»ã€‚å¯èƒ½å¯¹ç®­å¤´å‡½æ•°çš„ä½¿ç”¨è¿˜ä¸å¤ªç†Ÿæ‚‰ã€‚\n\n- **å¦‚ä½•åœ¨å¾ªç¯åˆ—è¡¨é‡Œä½¿ç”¨ useMemo**\n\nä¸å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¼šç ´å hook çš„é“¾è¡¨ç»“æ„ã€‚æ¨èçš„åšæ³•æ˜¯å°†å…¬å…±ç»„ä»¶æå–å‡ºæ¥ï¼Œåœ¨æå–çš„å…¬å…±ç»„ä»¶ä¸­ä½¿ç”¨ã€‚"])</script><script>self.__next_f.push([1,"2f:T1da3,"])</script><script>self.__next_f.push([1,"\u003e æœ‰åˆ†äº«æ‰æœ‰è¿›æ­¥ï¼Œæ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡æ­£\n\næœ€è¿‘åœ¨å¼€å‘ä¸€ä¸ªå›½é™…ç«™é¡¹ç›®ï¼Œæ¶‰åŠåˆ°çš„ä»»åŠ¡æµè½¬å¯èƒ½ä¼šè·¨å¤šä¸ªå›½å®¶å’Œåœ°åŒºï¼Œè¿™å°±æ¶‰åŠåˆ°æ—¶é—´å·®çš„é—®é¢˜äº†ã€‚æœ¬æ–‡å°±æ¥æ¢³ç†ä¸€ä¸‹æˆ‘åœ¨å®é™…å¼€å‘ä¸­æ¶‰åŠåˆ°çš„å‰ç«¯æ—¶åŒºçš„é€»è¾‘å¤„ç†æ–¹æ¡ˆã€‚\n\n## 1. å®é™…ä¸šåŠ¡åœºæ™¯\n\nåœ¨ Asia/shanghai æ—¶åŒºä¸‹åˆ›å»ºå®šæ—¶æµè½¬ä»»åŠ¡æ—¶ï¼Œäº§å“ä¼šæœ‰è¦æ±‚ï¼šè®¾ç½®ä¸ºè¿ªæ‹œæ—¶é—´çš„ `2023-06-24 23:00:00` ç‚¹è§¦å‘ä»»åŠ¡æµç¨‹ï¼Œè¿™å°±ç‰µæ‰¯åˆ°æ—¶åŒºè½¬æ¢çš„é—®é¢˜ï¼›åŒæ—¶ï¼Œåœ¨ Asia/shanghai æ—¶åŒºä¸‹åˆ›å»ºçš„ä»»åŠ¡ï¼Œåœ¨ä¸–ç•Œå…¶ä»–å„ä¸ªæ—¶åŒºä¸‹çœ‹åˆ°çš„åº”è¯¥æ˜¯ä¸åŒçš„æ—¶é—´ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦æ ¼å¼åŒ–ä¸ºåŒä¸€ä¸ªæ—¶é—´ï¼ˆåˆ›å»ºåœ°çš„ï¼‰æ ¼å¼ï¼Œå¹¶æ ‡æ˜ `UTC +8`ã€‚\n\n\u003e æˆ‘ä»¬æ¥ä¸¾ä¸ªè¿‘ä¸€ç‚¹çš„ä¾‹å­ï¼š æ‹¿ä¸œäº¬ä¸¾ä¾‹ï¼Œæ˜¯ `UTC+9` æ—¶åŒºï¼Œæ¯”æˆ‘ä»¬å¿«äº†ä¸€ä¸ªæ—¶åŒºã€‚å¦‚æœåœ¨ Asia/shanghai æ—¶åŒºä¸‹é€‰æ‹©äº†è®¾å®šåœ¨ä¸œäº¬çš„ `2023-06-24 00:00:00` ä¸‹è§¦å‘ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶é—´ä»¥ä¸œäº¬æ—¶é—´æ ¼å¼åŒ–ä¸ºæ—¶é—´æˆ³åï¼Œåœ¨ä¸Šæµ·æœ¬åœ°æ ¼å¼åŒ–ï¼Œåº”è¯¥æ˜¯ `2023-06-23 23:00:00`\n\nåŸºäºä¸Šé¢çš„ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘è¿™é‡Œç»™å‡ºäº†å‡ ç§å¤„ç†æ–¹æ¡ˆï¼š\n\n## 2. æ–¹æ¡ˆä¸€ã€åç«¯è°ƒæ•´æ—¶åŒº\n\nå¯ä»¥ç›´æ¥æŠŠé€‰æ‹©çš„æ—¶é—´å­—ç¬¦ä¸² `2023-06-24 00:00:00` å’Œéœ€è¦è®¾ç½®çš„å½“åœ°æ—¶é—´çš„æ—¶åŒº `Asia/Tokyo` ç»™åˆ°åç«¯ï¼Œåç«¯æ¥æ ¹æ®æ—¶åŒºå°†æ—¶é—´å­—ç¬¦ä¸²æ ¼å¼åŒ–ä¸ºç›¸å¯¹äºä¸œäº¬çš„æ—¶é—´æˆ³ã€‚\n\nä»¥ Go ä¸ºä¾‹ï¼Œtime åŒ…ä¸‹å°±æœ‰æŒ‰ç…§æ—¶åŒºæ ¼å¼åŒ–çš„å‡½æ•°ï¼š\n\n```go\nlayout := \"2006-01-02 15:04:05\"\nvalue := \"2023-06-24 00:00:00\"\nlocation := time.LoadLocation(\"Asia/Tokyo\")\nt := time.ParseInLocation(layout, value, location)\n\nfmt.Println(\"Parsed time:\", t.unix())\n```\n\nè¿™æ ·å°±èƒ½åœ¨æ•°æ®åº“é‡Œå­˜ä¸‹æ‰€é€‰æ—¶é—´çš„æ—¶åŒºå’Œç»å¯¹çš„æ—¶é—´æˆ³äº†ã€‚\n\nè¿™æ—¶ä½ ä¼šé—®ï¼Œé‚£ä¹ˆæˆ‘å‰ç«¯å¦‚ä½•è·å–åˆ° `Asia/Tokyo` è¿™ä¸ªæ­£ç¡®çš„æ—¶åŒºæ ¼å¼ç»™åˆ°åç«¯å‘¢ï¼Ÿ\n\n1. ä½¿ç”¨ moment-timezone åº“\n\n```js\nimport moment from 'moment-timezone';\n\nmoment.tz.names(); // [\"Africa/Abidjan\", \"Africa/Accra\", \"Africa/Addis_Ababa\", ...]\n```\n\né€‰æ‹©å®Œæ—¶åŒºåï¼Œå¯ä»¥é€šè¿‡ `const zone = moment.tz.zone('Asia/Tokyo');` æ¥è·å–æ—¶åŒºå¯¹è±¡ï¼Œå¯¹è±¡é‡Œä¾¿æœ‰äº† offset ç­‰ä¿¡æ¯ã€‚\n\nå®é™…åœ¨é¡¹ç›®è½åœ°ä¸­ï¼Œmomentåº“æ¯”è¾ƒå¤§ï¼Œä¸€èˆ¬ä½¿ç”¨ dayjs ä»£æ›¿ï¼Œä½†æ˜¯ dayjs ä¸­æ²¡æœ‰ç›¸å…³çš„æ—¶åŒº APIï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶åŒºåˆ—è¡¨ï¼Œæˆ‘åœ¨æœ¬åœ°ä½¿ç”¨ moment è·å–åˆ°ä»¥ååšäº†æœ¬åœ°çš„ç‰¹æ®Šæ ¼å¼åŒ–ï¼Œå¹¶ä½œä¸ºé™æ€æ–‡ä»¶æŒ‚è½½åœ¨ CDN ä¸Šäº†ï¼Œæ•°ç»„ç»“æ„å¦‚ä¸‹ï¼š\n\n```js\n[\n  {\n    value: 'Japan Standard Time',\n    abbr: 'JST',\n    offset: 9,\n    isdst: false,\n    text: '(UTC+09:00) Osaka, Sapporo, Tokyo',\n    UTC: ['Asia/Dili', 'Asia/Jayapura', 'Asia/Tokyo', 'Etc/GMT-9', 'Pacific/Palau']\n  },\n  {\n    value: 'China Standard Time',\n    abbr: 'CST',\n    offset: 8,\n    isdst: false,\n    text: '(UTC+08:00) Beijing, Chongqing, Hong Kong, Urumqi',\n    UTC: ['Asia/Hong_Kong', 'Asia/Macau', 'Asia/Shanghai']\n  },\n  // ...\n]\n```\n\nä¸Šé¢çš„ offset æ˜¯ç›¸å¯¹äº UTC æ ‡å‡†æ—¶åŒºçš„åå·®ï¼Œè¯¥å€¼å¯ä»¥ä» moment çš„ zone å¯¹è±¡ä¸­è·å–ã€‚\n\n\u003e Zone å¯¹è±¡é‡Œ offsets å¸¸è§çš„æœ‰ PST æ—¶åŒº å’Œ PDT æ—¶åŒºï¼Œå‰è€…ä¸ºå¤ªå¹³æ´‹æ ‡å‡†æ—¶é—´ï¼ˆè‹±æ–‡ï¼š*Pacific Standard Time*ï¼Œç¸®å¯«ï¼š*PST*ï¼‰ï¼ŒUTC-8ï¼›åè€…ä¸ºå¤ä»¤æ—¶é—´ï¼ˆå¤å­£ï¼‰ç§°ä¸ºå¤ªå¹³æ´‹å¤ä»¤æ—¶é–“ï¼ˆè‹±æ–‡ï¼šPacific Daylight Timeï¼Œç¸®å¯«ï¼š*PDT*ï¼‰ï¼ŒUTC-7ï¼›ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªï¼Œæ ¹æ®åå·®åšåŠ å‡å³å¯ã€‚\n\n2. ä½¿ç”¨åŸç”Ÿçš„ Intl å¯¹è±¡\n\nå¦‚æœä¸éœ€è¦äº¤äº’é€‰æ‹©æ—¶åŒºåˆ—è¡¨ï¼Œåªæ˜¯åœ¨é¡µé¢ä¸Šæ ¹æ®å½“åœ°æ—¶åŒºæ ¼å¼åŒ–æ—¶é—´æˆ³ï¼Œå¯ä»¥ä½¿ç”¨jsåŸç”Ÿçš„ Intl å¯¹è±¡ï¼š\n\n```js\nconst timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;\nconsole.log(timeZone); // Asia/Shanghai\n```\n\nè€Œä¸”è¯¥æ–¹æ³•çš„å…¼å®¹æ€§ç›®å‰å·²ç»æ¯”è¾ƒå¥½äº†ï¼š\n\n\n![image.png](/img/posts/2023-6-26/2023-6-26-1.png)\n\nè¿™æ ·åœ¨ä¸­å›½çš„é¡µé¢ä¸Šè¿™æ ·æ˜¾ç¤ºï¼š\n\n```\n(Asia/Shanghai UTC +8) 2023-06-23 23:00:00\n```\n\nåœ¨æ—¥æœ¬çš„é¡µé¢è¿™æ ·æ˜¾ç¤ºï¼š\n\n```\n(Asia/Tokyo UTC +9) 2023-06-24 00:00:00\n```\n\n## 3. æ–¹æ¡ˆäºŒã€å‰ç«¯æ ¼å¼åŒ–ä¸ºæ—¶é—´æˆ³\n\nè¿™ç§æ–¹æ¡ˆä¸ä¾èµ–åç«¯ï¼Œå‰ç«¯é€‰æ‹©æ—¶åŒºï¼Œå‰ç«¯è½¬æ¢ä¸ºç»å¯¹å€¼æ—¶é—´æˆ³ç»™åˆ°åç«¯ã€‚è·å–æ—¶åŒºåˆ—è¡¨çš„æ–¹å¼å‚è§æ–¹æ¡ˆä¸€ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ‰‹åŠ¨æ—¶åŒºè½¬æ¢çš„æ€è·¯ï¼Œè·å–åˆ°åº”è¯¥è½¬æ¢ä¸ºä¸Šæµ·æ—¶é—´çš„æ—¶é—´å­—ç¬¦ä¸²ï¼Œå³ï¼Œå°† `2023-06-24 00:00:00` è½¬æ¢ä¸º `2023-06-23 23:00:00`ã€‚\n\nåœ¨è·å–åˆ°æ—¶åŒº `timeZoneOffset` ï¼ˆè¿™é‡Œæ˜¯ 9ï¼‰ å’Œ æ—¶é—´å­—ç¬¦ä¸² `time` ï¼ˆè¿™é‡Œæ˜¯ 2023-06-24 00:00:00ï¼‰åï¼Œå‰ç«¯æŒ‰ç…§å½“åœ°æ—¶é—´æ¨¡æ‹Ÿæ—¶åŒºå˜åŒ–æ¥å¤„ç†ï¼š\n\n```js\n// æ¨¡æ‹Ÿè½¬æ¢ä¸ºæ ‡å‡† UTC æ—¶é—´ï¼Œè¿™é‡Œå‡å»9ä¸ªå°æ—¶å³å¯\nconst UTC = dayjs(time).add(-timeZoneOffset, 'hour');\n// è·å–æµè§ˆå™¨å½“åœ°æ—¶é—´çš„å°æ—¶å·®ï¼ŒoffsetHours å¦‚æœåœ¨ä¸Šæµ·ï¼Œå°±æ˜¯ 8\nconst date = new Date();\nconst offsetHours = -(date.getTimezoneOffset() / 60);\n// å°†ä¸Šé¢çš„ UTC åŠ ä¸Šæµè§ˆå™¨æœ¬åœ°çš„æ—¶å·® \nconst result = dayjs(UTC).add(offsetHours, 'hour');\n```\n\né€šè¿‡ä¸Šè¿°æ“ä½œï¼Œå°±å°†ä¸œäº¬æ—¶é—´çš„ `2023-06-24 00:00:00` è½¬æ¢ä¸ºä¸Šæµ·æ—¶åŒºçš„ `2023-06-23 23:00:00`ï¼Œæ­¤æ—¶åœ¨å°†è¿™ä¸ª result è½¬æ¢ä¸ºæ—¶é—´æˆ³å³å¯ï¼š\n\n```js\nresult.unix() // 1687532400\n```\n\n\n## 4. æ–¹æ¡ˆä¸‰ã€dayjsæ ¼å¼åŒ–ä¸ºæ—¶é—´æˆ³\n\nè¯¥æ–¹æ¡ˆä¸ºæ–¹æ¡ˆäºŒçš„å˜ç§ï¼Œåªæ˜¯ä¸ç”¨åŸç”Ÿæ“ä½œæ—¶åŒºå·®æ¥è®¡ç®—ï¼Œè€Œæ˜¯ä½¿ç”¨ dayjs å†…ç½®çš„æ–¹æ³•æ›¿ä»£ä¹‹ï¼š\n\n```js\nconst d = dayjs.tz('2023-06-24 00:00:00', 'Asia/Tokyo')\nconsole.log(d.format()) // 2023-06-24T00:00:00+09:00\nconsole.log(d.unix()) // 1687532400\n```\n\n\n![image.png](/img/posts/2023-6-26/2023-6-26-2.png)\n\nè¯¥æ–¹æ³•çš„å‰ææ˜¯å¼•å…¥æ—¶åŒºæ’ä»¶ï¼š\n\n```js\nimport timezone from 'dayjs/plugin/timezone';\n\ndayjs.extend(timezone);\n```\n\nè¿™ç§æ–¹æ¡ˆçš„ç¼ºç‚¹æ˜¯å¿…é¡»æå‰ä¼ å…¥æ—¶åŒºå­—ç¬¦ä¸²ã€‚æ–¹æ¡ˆäºŒä¸éœ€è¦ä»»ä½•æ¡ä»¶ï¼Œåªéœ€è¦çŸ¥é“æ˜¯ UTC å‡ çš„æ—¶åŒºå°±å¯ä»¥äº†ã€‚\n\n## 5. é€†å‘ï¼šæ—¶é—´æˆ³å±•ç¤ºä¸ºç»™å®šæ—¶åŒºçš„æ—¶é—´\n\nä¸Šé¢è®²äº†æ€ä¹ˆæŠŠæœ¬åœ°æ—¶é—´é€‰æ‹©å™¨é€‰ä¸­çš„æŒ‡å®šæ—¶åŒºçš„æ—¶é—´ï¼ˆdayjsï¼‰æŒ‰ç…§æ‰€é€‰æ—¶åŒºæ ¼å¼åŒ–ä¸ºæ—¶é—´æˆ³ã€‚ä¸‹é¢è¯´çš„æ˜¯ä»–çš„é€†å‘ï¼šæ€ä¹ˆä»æ—¶é—´æˆ³æ ¼å¼åŒ–ä¸ºæ‰€åœ¨æ—¶åŒºçš„æ—¶é—´å­—ç¬¦ä¸²ã€‚\n\n\u003e æ¯”å¦‚æ—¶é—´æˆ³ï¼š1688439600ï¼Œä»–åœ¨åŒ—äº¬æ—¶é—´æ˜¯ 2023-7-4 11:00:00ï¼Œåœ¨ä¸œäº¬æ—¶é—´ï¼ˆUTC +9ï¼‰åº”è¯¥å¿«ä¸€ä¸ªå°æ—¶\n\næŒ‰ç…§ä¸Šè¾¹çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯”æµè§ˆå™¨æ‰€åœ¨æ—¶åŒºå’Œç»™å®š offset çš„å·®å€¼æ¥æ¯”å¯¹ï¼Œè¿›è€Œå°†æ—¶é—´åŠ æˆ–è€…å‡å¯¹åº”çš„å°æ—¶æ•°å³å¯ï¼š\n\n```js\n// ä¼ å…¥ 1688439600ï¼Œ9\nexport const showWithTimeZone = (timestamp, timeZoneOffset) =\u003e {\n  if (typeof timeZoneOffset === 'number') {\n    const date = new Date();\n    const offsetHours = -(date.getTimezoneOffset() / 60);\n\n    // ç»™å®šæ—¶åŒºä¸æµè§ˆå™¨æœ¬åœ°æ—¶åŒºçš„å·®å¼‚\n    const offset = timeZoneOffset - offsetHours;\n    // ç›´æ¥åŠ æ³•å³å¯ï¼Œå¦‚æœæ—¶åŒºå¿«ï¼Œå°±æ˜¯æ­£æ•°ï¼Œå¦è‡ªæ˜¯è´Ÿæ•°\n    const result = dayjs(timestamp * 1000).add(offset, 'hour');\n\n    return {\n      format: `(UTC ${timeZoneOffset \u003e 0 ? '+' + timeZoneOffset : timeZoneOffset + ''}) ${result.format('YYYY-MM-DD HH:mm:ss')}`\n    };\n  }\n};\n```\n\nå¦‚æ­¤ï¼Œåœ¨ç•Œé¢å°±ä¼šçœ‹åˆ°ï¼š\n\n\n![image.png](/img/posts/2023-6-26/2023-6-26-3.png)\n\n## 6. æ€»ç»“\n\nä¸ªäººä½¿ç”¨çš„æ˜¯æ–¹æ¡ˆä¸‰å’Œæ–¹æ¡ˆä¸€çš„ç»“åˆï¼Œè·å–åˆ°æ—¶åŒºåˆ—è¡¨å¹¶ç¼“å­˜CDNåï¼Œå‰ç«¯é€‰æ‹©æ—¶åŒºå¹¶è½¬æ¢ä¸ºç»å¯¹å€¼æ—¶é—´æˆ³ï¼Œåç«¯è¿›è¡ŒäºŒæ¬¡æ ¡éªŒå¹¶åœ¨åˆ—è¡¨æ˜¾ç¤ºçš„åœ°æ–¹æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚\n\n\u003e éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç½‘ä¸Šè·å–åˆ°çš„æ—¶åŒºåç§»å¯èƒ½ä¼šæœ‰å»¶è¿Ÿï¼ˆæœ‰äº›åŸå¸‚ä¼šä¸åœè°ƒæ•´æ—¶åŒºï¼‰ï¼Œæ¯”å¦‚æŸæ—çš„æ—¶åŒºï¼Œæˆ‘åœ¨åˆ—è¡¨é‡Œçš„æ˜¯ +1ï¼Œä½†æ˜¯ç½‘ä¸Šæœåˆ°çš„æœ€æ–°æ¶ˆæ¯æ˜¯ GMT+2 çš„ï¼Œä½†æ˜¯ä»Šå¹´10æœˆä»½åˆä¼šè°ƒå› +1ã€‚æˆ‘è¿™é‡Œå°±è¿˜ä»¥momentè·å–çš„æ•°æ®ä¸ºå‡†äº†ã€‚\n\n\n![image.png](/img/posts/2023-6-26/2023-6-26-4.png)"])</script><script>self.__next_f.push([1,"30:T484f,"])</script><script>self.__next_f.push([1,"\u003e æœ¬æ–‡é’ˆå¯¹ ESLint 8+ ç‰ˆæœ¬\n\n## 1. é…ç½®æ–‡ä»¶æ ¼å¼\n\nESLint é…ç½®æ–‡ä»¶å¯ä»¥ä½¿ç”¨å¤šç§æ–‡ä»¶æ ¼å¼ï¼Œå¸¸ç”¨çš„æœ‰ä»¥ä¸‹å‡ ç§ï¼š\n\n-   .eslintrc.jsï¼šä½¿ç”¨ JavaScript ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ªé…ç½®å¯¹è±¡ã€‚\n-   .eslintrc.yamlã€.eslintrc.ymlï¼šä½¿ç”¨ YAML è¯­è¨€ç¼–å†™çš„é…ç½®æ–‡ä»¶ã€‚\n-   .eslintrc.jsonï¼šä½¿ç”¨ JSON æ ¼å¼ç¼–å†™çš„é…ç½®æ–‡ä»¶ã€‚\n-   .eslintrc.cjsï¼šä½¿ç”¨è¿™ç§é…ç½®æ—¶ï¼Œä¸­éœ€è¦åœ¨`package.json`ä¸­é…ç½®`type\":\"module\"`ã€‚\n-   eslintConfigï¼šä½¿ç”¨npmåŒ…è¿›è¡Œé…ç½®ã€‚\n-   .eslintrcï¼šæ™®é€šé…ç½®æ–‡ä»¶\n\næ­¤å¤–è¿˜æœ‰è¡Œå†…é…ç½®ï¼š\n\n-   `/* eslint-disable */` å’Œ `/* eslint-enable */`ï¼Œç¦ç”¨å¯ç”¨è§„åˆ™\n-   `/* global */`ï¼Œå®šä¹‰å…¨å±€å˜é‡\n-   `/* eslint */`ï¼Œé…ç½®è§„åˆ™\n-   `/* eslint-env */`ï¼ŒæŒ‡å®šå½“å‰è¿è¡Œç¯å¢ƒ\n\nç°åœ¨ï¼Œæœ‰ä¸€ç§æ–°çš„é…ç½®æ–‡ä»¶ç±»å‹ï¼š`eslint.config.js`ï¼Œå®˜æ–¹å°†åœ¨ v9 ç‰ˆæœ¬å…¨é¢ä½¿ç”¨è¯¥é…ç½®ç±»å‹ã€‚\n\n\n\nå…¶ä¸­ï¼Œæ¨èä½¿ç”¨ .js æ–‡ä»¶æ ¼å¼ï¼Œå› ä¸ºå®ƒå¯ä»¥ä½¿ç”¨ JavaScript çš„æ‰€æœ‰ç‰¹æ€§ï¼Œæ–¹ä¾¿ç¼–å†™å¤æ‚çš„é…ç½®è§„åˆ™ã€‚æœ¬æ–‡ä»¥æ¨èçš„æ ¼å¼ä¸ºä¾‹æ¥è®²è§£é…ç½®:\n\n```js\n// .eslintrc.js\nmodule.exports = {\n...\n}\n```\n\n```js\n//eslint.config.js\nexport default [\n\n]\n```\n\n## 2. å¸¸ç”¨é…ç½®é¡¹\n\n### root\n\næŒ‡å®šESLintåœ¨æŸ¥æ‰¾é…ç½®æ–‡ä»¶æ—¶çš„èµ·å§‹ä½ç½®ã€‚\n\nå‡è®¾ç°åœ¨ç›®å½•å±‚çº§å¦‚ä¸‹ï¼š\n\n```bash\nproject/\nâ”œâ”€â”€ package.json\nâ”œâ”€â”€ .eslintrc.js\nâ”œâ”€â”€ src/\nâ”‚   â”œâ”€â”€ .eslintrc.js\nâ”‚   â””â”€â”€ index.js\nâ””â”€â”€ test/\n    â”œâ”€â”€ .eslintrc.js\n    â””â”€â”€ test.js\n```\n\næˆ‘ä»¬åœ¨ é¡¶å±‚.eslintrc.js ä¸­é…ç½® rootï¼š\n\n```\n// project/.eslintrc.js\nmodule.exports = {\n  root: true,\n  // ...\n}\n```\nè¿™å‘Šè¯‰äº†ESLintåº”è¯¥ä½¿ç”¨æ­¤æ–‡ä»¶ä½œä¸ºèµ·å§‹ä½ç½®æ¥æŸ¥æ‰¾å…¶ä»–é…ç½®æ–‡ä»¶ã€‚è¿™å°†ç¡®ä¿ESLintå§‹ç»ˆä½¿ç”¨project/.eslintrc.jsä½œä¸ºé¡¹ç›®ä¸­æ‰€æœ‰æ–‡ä»¶çš„é…ç½®æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å­ç›®å½•ä¸­çš„å…¶ä»–é…ç½®æ–‡ä»¶ã€‚\n\nå¦‚æœåœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­æ²¡æœ‰æŒ‡å®š\"root\"å­—æ®µï¼ŒESLintä¼šä½¿ç”¨æœ€è¿‘çš„é…ç½®æ–‡ä»¶æ¥æ£€æµ‹ä»£ç ï¼Œå¦‚æœå½“å‰ç›®å½•ä¸‹æ²¡æœ‰é…ç½®æ–‡ä»¶ï¼ŒESLintä¼šç»§ç»­å‘ä¸ŠæŸ¥æ‰¾çˆ¶ç›®å½•ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸ºæ­¢ã€‚\n\n### env\n\nç”¨æ¥æŒ‡å®šæ ¡éªŒç¯å¢ƒã€‚å®ƒå‘Šè¯‰ ESLint ä»£ç è¿è¡Œåœ¨å“ªä¸ªç¯å¢ƒä¸­ï¼Œä»è€Œå¸®åŠ© ESLint æ›´å¥½åœ°ç†è§£æ‚¨çš„ä»£ç å¹¶æ£€æµ‹æ½œåœ¨çš„é—®é¢˜ã€‚\n\né…ç½®å¦‚ä¸‹ï¼š\n\n```js\nenv: {\n  es6: true /** å¯ç”¨é™¤äº†modulesä»¥å¤–çš„æ‰€æœ‰ ES6 ç‰¹æ€§,å¼€å¯åä¼šè‡ªåŠ¨è®¾ç½®ecmaVersionä¸º6 */,\n  node: true /** Node.js å…¨å±€å˜é‡å’Œ Node.js ä½œç”¨åŸŸ */,\n  browser: true /** æµè§ˆå™¨å…¨å±€å˜é‡ */,\n  commonjs: true /**  CommonJS å…¨å±€å˜é‡å’Œ CommonJS ä½œç”¨åŸŸ (ç”¨äº Browserify/WebPack æ‰“åŒ…çš„åªåœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„ä»£ç ) */,\n  jest: false /** Jest å…¨å±€å˜é‡ */,\n  jquery: false /** jQuery å…¨å±€å˜é‡ */,\n  'shared-node-browser': false /** Node.js å’Œ Browser é€šç”¨å…¨å±€å˜é‡ */,\n  worker: false /** Web Workers å…¨å±€å˜é‡ */,\n  amd: false /** å°† require() å’Œ define() å®šä¹‰ä¸ºåƒ amd ä¸€æ ·çš„å…¨å±€å˜é‡ */,\n  mocha: false /** æ·»åŠ æ‰€æœ‰çš„ Mocha æµ‹è¯•å…¨å±€å˜é‡ */,\n  jasmine: false /** æ·»åŠ æ‰€æœ‰çš„ Jasmine ç‰ˆæœ¬ 1.3 å’Œ 2.0 çš„æµ‹è¯•å…¨å±€å˜é‡ã€‚ */,\n  phantomjs: false /** phantomjs å…¨å±€å˜é‡ */,\n  protractor: false /** protractor å…¨å±€å˜é‡ */,\n  qunit: false /** QUnit å…¨å±€å˜é‡ */,\n  prototypejs: false /** Prototype.js å…¨å±€å˜é‡ */,\n  shelljs: false /** ShellJS å…¨å±€å˜é‡ */,\n  meteor: false /** Meteor å…¨å±€å˜é‡ */,\n  mongo: false /** MongoDB å…¨å±€å˜é‡ */,\n  applescript: false /** AppleScript å…¨å±€å˜é‡ */,\n  nashorn: false /** Java 8 Nashorn å…¨å±€å˜é‡ */,\n  serviceworker: false /** Service Worker å…¨å±€å˜é‡ */,\n  atomtest: false /** Atom æµ‹è¯•å…¨å±€å˜é‡ */,\n  embertest: false /** Ember æµ‹è¯•å…¨å±€å˜é‡ */,\n  webextensions: false /** WebExtensions å…¨å±€å˜é‡ */,\n  greasemonkey: false /** GreaseMonkey å…¨å±€å˜é‡ */,\n}\n```\n\n### parser\n\næŒ‡å®šç”¨äºè§£æJavaScriptä»£ç çš„è§£æå™¨ã€‚ESLinté»˜è®¤ä½¿ç”¨ esprima è§£æå™¨ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡\"parser\"é…ç½®æ¥ä½¿ç”¨å…¶ä»–è§£æå™¨ã€‚\n\nå¸¸ç”¨çš„è§£æå™¨å¦‚ä¸‹ï¼š\n\n1. esprimaï¼šé»˜è®¤çš„è§£æå™¨ï¼Œç”¨äºè§£æECMAScript 5åˆ°ECMAScript 2021ä¹‹é—´çš„JavaScriptä»£ç ã€‚\n2.  @babel/eslint-parserï¼šç”±Babelé¡¹ç›®æä¾›çš„è§£æå™¨ï¼Œç”¨äºè§£æES6+ä»£ç ã€‚\n3.  @typescript-eslint/parserï¼šç”±TypeScriptå›¢é˜Ÿæä¾›çš„è§£æå™¨ï¼Œç”¨äºè§£æTypeScriptä»£ç ã€‚\n4.  eslint-plugin-htmlï¼šç”¨äºè§£æHTMLæ–‡ä»¶ä¸­çš„JavaScriptä»£ç ã€‚\n5.  vue-eslint-parserï¼šç”¨äºè§£æVueå•æ–‡ä»¶ç»„ä»¶ä¸­çš„JavaScriptä»£ç ã€‚\n\n### parserOptions\n\nç»™é…ç½®çš„è§£æå™¨æ·»åŠ å¯é€‰é…ç½®é¡¹ã€‚\n\nå¦‚æœä½¿ç”¨çš„æ˜¯é»˜è®¤parseré…ç½®ï¼Œå¯ä»¥æœ‰å¦‚ä¸‹é…ç½®ï¼š\n```js\n// .eslintrc.js\nmodule.exports = {\n  parser: \"esprima\",\n  parserOptions: {\n    ecmaVersion: 2022, \n    sourceType: \"module\",\n    range: true,\n    loc: true,\n  },\n  // ...\n}\n```\nå­—æ®µè§£æï¼š\n\n-   `ecmaVersion`: æŒ‡å®šè¦è§£æçš„ ECMAScript ç‰ˆæœ¬ã€‚å¯ä»¥è®¾ç½®ä¸ºæ•°å­—ï¼ˆå¦‚ 3ã€5ã€6ã€7ã€8ã€9ã€10ã€11ã€12ã€13ã€2020ã€2021 ç­‰ï¼‰æˆ–å­—ç¬¦ä¸²ï¼ˆå¦‚ `\"latest\"`ï¼‰ã€‚é»˜è®¤ä¸º `5`ã€‚\n-   `sourceType`: æŒ‡å®šè¦è§£æçš„æ¨¡å—ç³»ç»Ÿç±»å‹ã€‚å¯é€‰å€¼ä¸º `\"script\"`ï¼ˆé»˜è®¤ï¼‰æˆ– `\"module\"`ã€‚\n-   `ecmaFeatures`: ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºå¯ç”¨æˆ–ç¦ç”¨ ECMAScript ä¸­çš„ç‰¹å®šè¯­è¨€åŠŸèƒ½ã€‚å¯ç”¨çš„é€‰é¡¹åŒ…æ‹¬ï¼š\n    -   `globalReturn`ï¼šå…è®¸åœ¨å…¨å±€ä½œç”¨åŸŸä¸­ä½¿ç”¨ return è¯­å¥ã€‚\n    -   `impliedStrict`ï¼šå…è®¸åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹è§£æä¸ºä¸¥æ ¼æ¨¡å¼ã€‚\n    -   `jsx`ï¼šå¯ç”¨ JSX è¯­æ³•ã€‚\n    -   `experimentalObjectRestSpread`ï¼šå¯ç”¨å¯¹è±¡çš„ rest å’Œ spread æ“ä½œç¬¦ã€‚\n-   `allowImportExportEverywhere`: å…è®¸åœ¨ä»£ç çš„ä»»ä½•ä½ç½®ä½¿ç”¨ import å’Œ export è¯­å¥ã€‚é»˜è®¤ä¸º `false`ã€‚\n-   `codeFrame`: å½“å‘ç”Ÿè¯­æ³•é”™è¯¯æ—¶ï¼Œæä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚é»˜è®¤ä¸º `true`ã€‚\n-   `requireConfigFile`: å¦‚æœè®¾ç½®ä¸º `true`ï¼Œåˆ™å¿…é¡»æä¾› `tsconfig.json` æˆ– `.eslintrc.*` æ–‡ä»¶æ¥é…ç½®è§£æå™¨ã€‚é»˜è®¤ä¸º `false`ã€‚\n-   `babelOptions`: ä¼ é€’ç»™ `@babel/parser` çš„é€‰é¡¹å¯¹è±¡ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š\n```js\nbabelOptions: {\n  ecmaVersion: \"es2020\",\n  ecmaFeatures: {\n    globalReturn: true,\n    jsx: true,\n  },\n  lib: [\"ES2020\"],\n},\n```\n-   `tsconfigRootDir`: æŒ‡å®š TypeScript é…ç½®æ–‡ä»¶çš„æ ¹ç›®å½•ã€‚é»˜è®¤ä¸ºè§£æ `tsconfig.json` æ–‡ä»¶çš„ç›®å½•ã€‚\n\nå¦‚æœä½¿ç”¨@babel/eslint-parserè§£æå™¨ï¼Œåˆ™å¯ä»¥æœ‰å¦‚ä¸‹é…ç½®ï¼š\n\n```js\n// .eslintrc.js\nmodule.exports = {\n  parser: \"@babel/eslint-parser\",\n  parserOptions: {\n    ecmaVersion: 2022,\n    sourceType: \"module\",\n    ecmaFeatures: {\n      jsx: true,  //æ”¯æŒ jsx\n    },\n  },\n  // ...\n}\n```\n\nè‹¥ä½¿ç”¨ @typescript-eslint/parserï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼š\n\n```js\n// .eslintrc.js\nmodule.exports = {\n  parser: \"@typescript-eslint/parser\",\n  \"parserOptions\": {\n    \"ecmaVersion\": 2021,\n    \"sourceType\": \"module\",\n    \"project\": \"./tsconfig.json\",\n    \"tsconfigRootDir\": \"./\",\n    \"extraFileExtensions\": [\".tsm\"]\n  },\n}\n```\n\n### globals\n\næŒ‡å®šå…¨å±€å˜é‡çš„ä¸€ä¸ªé…ç½®é¡¹ã€‚åœ¨ JavaScript ä¸­ï¼Œå¦‚æœä¸€ä¸ªå˜é‡æ²¡æœ‰ç»è¿‡å£°æ˜å°±è¢«ä½¿ç”¨ï¼Œä¼šå¯¼è‡´è¯¥å˜é‡è¢«å½“ä½œå…¨å±€å˜é‡å¤„ç†ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ½œåœ¨çš„é—®é¢˜ã€‚é€šè¿‡é…ç½® `globals`ï¼Œæˆ‘ä»¬å¯ä»¥å‘Šè¯‰ ESLint è¿™äº›å˜é‡æ˜¯å…¨å±€å˜é‡ï¼Œä»è€Œé¿å…å‡ºç°è¿™ç§é—®é¢˜ã€‚\n\n`globals` å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé”®ä¸ºå…¨å±€å˜é‡çš„åç§°ï¼Œå€¼ä¸ºè¯¥å˜é‡çš„ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥æ˜¯ `readonly`ã€`writable` æˆ– `off`ã€‚ä¾‹å¦‚ï¼š\n\n```js\n{\n  \"globals\": {\n    \"foo\": \"writable\",\n    \"bar\": \"readonly\",\n    \"baz\": \"off\"\n  }\n}\n```\n\nåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ`foo` å’Œ `bar` éƒ½è¢«æŒ‡å®šä¸ºå…¨å±€å˜é‡ï¼Œ`foo` å¯ä»¥è¢«å†™å…¥ï¼Œè€Œ `bar` æ˜¯åªè¯»çš„ï¼Œ`baz` è¢«å…³é—­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒESLint ä¸ä¼šå¯¹å®ƒè¿›è¡Œä»»ä½•æ£€æŸ¥ã€‚\n\nå¯ä»¥å°† `globals` è§†ä¸ºä¸€ä¸ªç™½åå•ï¼Œå…¶ä¸­åŒ…å«äº†æ˜ç¡®æŒ‡å®šçš„å…¨å±€å˜é‡ï¼Œè€Œå…¶ä»–æœªè¢«åˆ—å‡ºçš„å˜é‡ä¼šè¢«è®¤ä¸ºæ˜¯æœªå®šä¹‰çš„ï¼Œä»è€Œé¿å…äº†ä¸ç»æ„åœ°ä½¿ç”¨æœªå£°æ˜çš„å˜é‡è€Œå¯¼è‡´çš„é”™è¯¯ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨å…¨å±€å˜é‡å¯èƒ½ä¼šé™ä½ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå› æ­¤åº”è¯¥è°¨æ…ä½¿ç”¨ï¼Œå¹¶ä¸”åªåœ¨ç¡®å®éœ€è¦ä½¿ç”¨å…¨å±€å˜é‡æ—¶æ‰ä½¿ç”¨ã€‚åŒæ—¶ï¼Œ`globals` å¯èƒ½ä¹Ÿä¼šå¯¼è‡´ä¸€äº›ä¸å¯é¢„æµ‹çš„é—®é¢˜ï¼Œå› æ­¤å»ºè®®ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨ã€‚\n\n### rules\n\né…ç½®æ–‡ä»¶ä¸­æœ€å¸¸ç”¨çš„é…ç½®é¡¹ä¹‹ä¸€ï¼Œç”¨äºè®¾ç½® ESLint çš„è§„åˆ™å’Œè§„åˆ™çš„é”™è¯¯ç­‰çº§ã€‚`rules` é…ç½®é¡¹æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„æ¯ä¸ªå±æ€§è¡¨ç¤ºä¸€ä¸ªè§„åˆ™ï¼Œå±æ€§å€¼è¡¨ç¤ºè¯¥è§„åˆ™çš„é”™è¯¯ç­‰çº§ã€‚\n\né…ç½®æ–¹å¼ï¼š\n\n```js\n\"rules\": {\n    \"eqeqeq\": \"off\",  // å…³é—­å‘Šè­¦\n    \"no-undef\": \"warn\", // è­¦å‘Šçº§åˆ«\n    \"react/prop-types\": \"error\", // é”™è¯¯çº§åˆ«\n}\n```\n\né…ç½®é¡¹è¿˜æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼š\n\n```js\n\"semi\": [\"error\", \"always\"] // è¦æ±‚åœ¨è¯­å¥æœ«å°¾å§‹ç»ˆä½¿ç”¨åˆ†å·ã€‚\n\"semi\": [\"error\", \"never\"] // è¦æ±‚åœ¨è¯­å¥æœ«å°¾ä¸ä½¿ç”¨åˆ†å·ã€‚\n```\n\nå½“ç„¶äº†ï¼Œä¹Ÿå¯ä»¥è¿™æ ·å†™æ¥æ‹¦æˆªç‰¹å®šçš„æ–‡ä»¶ï¼š\n\n```js\noverrides: [\n  {\n    files: [\"*.ts\", \"*.tsx\"],\n    rules: {\n      \"no-undef\": \"off\",\n      \"react/prop-types\": \"off\",\n      \"semi\": \"off\"\n    },\n  },\n],\n```\nè¦æ³¨æ„è§„åˆ™é›†ä¹‹é—´çš„é¡ºåºé—®é¢˜ï¼Œåé¢çš„è§„åˆ™é›†ä¼šè¦†ç›–å‰é¢çš„è§„åˆ™é›†ã€‚å¦‚æœéœ€è¦ä¿ç•™å‰é¢çš„è§„åˆ™é›†ä¸­çš„è§„åˆ™ï¼š\n\n```js\n\"rules\": Object.assign({}, require(\"eslint-config-airbnb/rules\"))\n```\n\n\nå¸¸è§çš„ruleæœ‰å¦‚ä¸‹è¿™äº›ï¼Œ\n\n-   `no-var`: ç¦æ­¢ä½¿ç”¨ `var` å…³é”®å­—å£°æ˜å˜é‡ï¼Œä½¿ç”¨ `let` æˆ– `const` ä»£æ›¿ã€‚\n-   `no-unused-vars`: ç¦æ­¢å£°æ˜å˜é‡ä½†æœªä½¿ç”¨ï¼Œå‡å°‘ä»£ç å†—ä½™ã€‚\n-   `no-console`: ç¦æ­¢ä½¿ç”¨ `console` è¯­å¥ï¼Œé¿å…ä»£ç åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚\n-   `semi`: è¦æ±‚åœ¨è¯­å¥æœ«å°¾ä½¿ç”¨åˆ†å·ï¼Œè§„èŒƒä»£ç é£æ ¼ã€‚\n-   `indent`: è¦æ±‚ä½¿ç”¨æŒ‡å®šçš„ç¼©è¿›é£æ ¼ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€‚\n-   `quotes`: è¦æ±‚åœ¨å­—ç¬¦ä¸²å‘¨å›´ä½¿ç”¨æŒ‡å®šçš„å¼•å·ç±»å‹ï¼Œè§„èŒƒä»£ç é£æ ¼ã€‚\n-   `no-undef`: ç¦æ­¢ä½¿ç”¨æœªå£°æ˜çš„å˜é‡ï¼Œå‡å°‘é”™è¯¯å‡ºç°çš„æ¦‚ç‡ã€‚\n-   `no-extra-parens`: ç¦æ­¢å‡ºç°ä¸å¿…è¦çš„æ‹¬å·ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€‚\n-   `no-multiple-empty-lines`: ç¦æ­¢å‡ºç°å¤šè¡Œç©ºç™½è¡Œï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€‚\n-   `no-trailing-spaces`: ç¦æ­¢è¡Œæœ«å‡ºç°ç©ºæ ¼ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€‚\n-   `no-unreachable`: ç¦æ­¢å‡ºç°æ— æ³•åˆ°è¾¾çš„ä»£ç ï¼Œå‡å°‘ä»£ç å†—ä½™ã€‚\n-   `no-useless-return`: ç¦æ­¢å‡ºç°ä¸å¿…è¦çš„ `return` è¯­å¥ï¼Œå‡å°‘ä»£ç å†—ä½™ã€‚\n\nReact\n\n-   `react/jsx-uses-react`: æ£€æµ‹æ˜¯å¦ä½¿ç”¨äº† React åº“ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨åˆ™æŠ¥é”™ã€‚\n-   `react/jsx-uses-vars`: æ£€æµ‹æ˜¯å¦å£°æ˜äº† JSX å˜é‡ï¼Œå¦‚æœå£°æ˜äº†ä½†æœªä½¿ç”¨åˆ™æŠ¥é”™ã€‚\n-   `react/jsx-no-undef`: æ£€æµ‹æ˜¯å¦ä½¿ç”¨äº†æœªå®šä¹‰çš„ JSX å˜é‡ï¼Œå¦‚æœä½¿ç”¨äº†åˆ™æŠ¥é”™ã€‚\n-   `react/jsx-indent`: è¦æ±‚ JSX å…ƒç´ çš„ç¼©è¿›ä¸ºæŒ‡å®šæ•°é‡çš„ç©ºæ ¼ã€‚\n-   `react/jsx-indent-props`: è¦æ±‚ JSX å±æ€§çš„ç¼©è¿›ä¸ºæŒ‡å®šæ•°é‡çš„ç©ºæ ¼ã€‚\n-   `react/no-unescaped-entities`: ç¦æ­¢åœ¨ JSX ä¸­ä½¿ç”¨æœªè½¬ä¹‰çš„ HTML å®ä½“å­—ç¬¦ã€‚\n-   `react/prop-types`: æ£€æµ‹æ˜¯å¦ä¸ºç»„ä»¶å£°æ˜äº† props ç±»å‹å®šä¹‰ï¼Œå¦‚æœæ²¡æœ‰åˆ™æŠ¥é”™ã€‚\n\nVue\n\n-   `vue/html-indent`: è¦æ±‚æ¨¡æ¿ä¸­çš„ç¼©è¿›ä¸ºæŒ‡å®šæ•°é‡çš„ç©ºæ ¼ã€‚\n-   `vue/no-unused-components`: æ£€æµ‹æ˜¯å¦æ³¨å†Œäº†ä½†æœªä½¿ç”¨çš„ç»„ä»¶ï¼Œå¦‚æœæœ‰åˆ™æŠ¥é”™ã€‚\n-   `vue/no-unused-vars`: æ£€æµ‹æ˜¯å¦å£°æ˜äº†ä½†æœªä½¿ç”¨çš„å˜é‡ï¼Œå¦‚æœæœ‰åˆ™æŠ¥é”™ã€‚\n-   `vue/require-prop-types`: è¦æ±‚ç»„ä»¶å£°æ˜ props ç±»å‹å®šä¹‰ã€‚\n-   `vue/require-default-prop`: è¦æ±‚ç»„ä»¶å£°æ˜ props çš„é»˜è®¤å€¼ã€‚\n-   `vue/require-v-for-key`: è¦æ±‚ä½¿ç”¨ v-for æŒ‡ä»¤æ—¶ä¸ºæ¯ä¸ªé¡¹æä¾›å”¯ä¸€çš„ key å±æ€§ã€‚\n\nç­‰ç­‰..\n\né™¤æ­¤ä¹‹å¤–ï¼Œä¸åŒçš„æ’ä»¶è¿˜æœ‰å¯¹åº”çš„ruleï¼Œå¯æŸ¥çœ‹å¯¹åº”æ–‡æ¡£æ¥é…ç½®ã€‚\n\n### plugins\n\nç”¨æ¥æŒ‡å®šæ’ä»¶çš„ä¸€ä¸ªé€‰é¡¹ã€‚æ’ä»¶æ˜¯ä¸€ç§æ‰©å±• ESLint åŠŸèƒ½çš„æ–¹å¼ï¼Œå¯ä»¥ç”¨äºæ£€æŸ¥ç‰¹å®šç±»å‹çš„é—®é¢˜æˆ–è€…åº”ç”¨ç‰¹å®šçš„ç¼–ç è§„èŒƒã€‚ESLint æ’ä»¶é€šå¸¸æ˜¯ä¸€ä¸ª npm åŒ…ï¼ŒåŒ…å«ä¸€ç»„è§„åˆ™å’Œç›¸å…³çš„é…ç½®ï¼Œé€šè¿‡ `plugins` é€‰é¡¹å°†å…¶å¼•å…¥åˆ°é¡¹ç›®ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™äº›è§„åˆ™æ¥æ£€æŸ¥ä»£ç äº†ã€‚\n\nESLint æ’ä»¶é€šå¸¸éœ€è¦é…åˆå¯¹åº”çš„è§„åˆ™è¿›è¡Œä½¿ç”¨ï¼Œå¯ä»¥é€šè¿‡ `extends` é€‰é¡¹æ¥ç»§æ‰¿æ’ä»¶çš„è§„åˆ™ã€‚å¸¸ç”¨çš„æ’ä»¶å¦‚ä¸‹ï¼š\n\n1.  `eslint-plugin-import`ï¼šç”¨äºæ£€æŸ¥æ¨¡å—å¯¼å…¥çš„è§„èŒƒæ€§ï¼ŒåŒ…æ‹¬è·¯å¾„ã€æ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶å†…å®¹ç­‰æ–¹é¢çš„æ£€æŸ¥ã€‚\n2.  `eslint-plugin-react`ï¼šç”¨äºæ£€æŸ¥ React ä»£ç çš„è§„èŒƒæ€§ï¼ŒåŒ…æ‹¬ JSX è¯­æ³•ã€ç»„ä»¶ä½¿ç”¨å’Œç”Ÿå‘½å‘¨æœŸç­‰æ–¹é¢çš„æ£€æŸ¥ã€‚\n3.  `eslint-plugin-vue`ï¼šç”¨äºæ£€æŸ¥ Vue.js ä»£ç çš„è§„èŒƒæ€§ï¼ŒåŒ…æ‹¬æ¨¡æ¿ã€ç»„ä»¶å’ŒæŒ‡ä»¤ç­‰æ–¹é¢çš„æ£€æŸ¥ã€‚\n4.  `eslint-plugin-jest`ï¼šç”¨äºæ£€æŸ¥ Jest æµ‹è¯•ä»£ç çš„è§„èŒƒæ€§ï¼ŒåŒ…æ‹¬æµ‹è¯•åç§°ã€åŒ¹é…å™¨å’Œæ–­è¨€ç­‰æ–¹é¢çš„æ£€æŸ¥ã€‚\n5.  `eslint-plugin-node`ï¼šç”¨äºæ£€æŸ¥ Node.js ä»£ç çš„è§„èŒƒæ€§ï¼ŒåŒ…æ‹¬ API ä½¿ç”¨ã€æ–‡ä»¶ç³»ç»Ÿå’Œå­è¿›ç¨‹ç­‰æ–¹é¢çš„æ£€æŸ¥ã€‚\n6.  `eslint-plugin-prettier`ï¼šç”¨äºå°† Prettier ä»£ç æ ¼å¼åŒ–é›†æˆåˆ° ESLint ä¸­ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ¥è‡ªåŠ¨ä¿®å¤ä»£ç æ ¼å¼é—®é¢˜ã€‚\n7.  `eslint-plugin-security`ï¼šç”¨äºæ£€æŸ¥ä»£ç ä¸­çš„å®‰å…¨é—®é¢˜ï¼ŒåŒ…æ‹¬è·¨ç«™ç‚¹è„šæœ¬æ”»å‡»ã€å‘½ä»¤æ³¨å…¥å’Œ SQL æ³¨å…¥ç­‰æ–¹é¢çš„æ£€æŸ¥ã€‚\n\nç­‰ç­‰...\n\nè¿™é‡Œä»¥ eslint-plugin-react ä¸ºä¾‹è®²è§£é…ç½®ï¼š\n\nå®‰è£…ï¼š\n\n```\nnpm install eslint-plugin-react --save-dev\n```\n\nä½¿ç”¨ï¼š\n\n```js\n{\n  \"plugins\": [\"react\"],\n  \"extends\": [\"eslint:recommended\", \"plugin:react/recommended\"],\n  \"rules\": {\n    \"react/jsx-props-no-spreading\": \"off\",\n    \"react/jsx-props-no-spreading\": [\n      \"error\",\n      {\n        \"exceptions\": [\"Component\"],\n        \"html\": \"enforce\",\n        \"custom\": \"ignore\"\n      }\n    ]\n  }\n}\n```\n\nåœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œä½¿ç”¨äº† `eslint:recommended` å’Œ `plugin:react/recommended` æ‰©å±•ï¼Œåˆ†åˆ«è¡¨ç¤ºä½¿ç”¨äº† ESLint æ¨èçš„è§„åˆ™å’Œ `eslint-plugin-react` çš„æ¨èè§„åˆ™ã€‚è¿™äº›è§„åˆ™å¯ä»¥é€šè¿‡ `rules` é…ç½®é¡¹è¿›è¡Œä¿®æ”¹å’Œè¦†ç›–ã€‚\n\n### extends\n\nç”¨æ¥ç»§æ‰¿å’Œæ‰©å±• ESLint è§„åˆ™é›†çš„é…ç½®é¡¹ã€‚é€šè¿‡ `extends`ï¼Œå¯ä»¥å°†ç°æœ‰çš„è§„åˆ™é›†åˆå¹¶åˆ°è‡ªå·±çš„è§„åˆ™é…ç½®ä¸­ï¼Œä¹Ÿå¯ä»¥åŸºäºç°æœ‰çš„è§„åˆ™é›†è¿›è¡Œæ‰©å±•å’Œå®šåˆ¶åŒ–ã€‚å…¶ä¸ pluginsçš„åŒºåˆ«æ˜¯ï¼Œå‰è€…é›†æˆäº†åè€…çš„åŠŸèƒ½ï¼Œè€Œä¸”è‡ªå¸¦äº†é…ç½®è§„åˆ™rulesã€‚\n\nESLint æä¾›äº†å¤šä¸ªå†…ç½®è§„åˆ™é›†ï¼ŒåŒ…æ‹¬ `eslint:recommended`ã€`plugin:@typescript-eslint/recommended`ã€`plugin:react/recommended`ã€`plugin:vue/recommended` ç­‰ã€‚é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® `extends` ä¸ºå†…ç½®è§„åˆ™é›†çš„åç§°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å†…ç½®è§„åˆ™é›†ä¸­çš„è§„åˆ™ã€‚\n\né™¤äº†å†…ç½®è§„åˆ™é›†å¤–ï¼Œè¿˜æœ‰è®¸å¤šç¬¬ä¸‰æ–¹è§„åˆ™é›†å¯ä»¥ä½¿ç”¨ï¼Œæ¯”å¦‚ `airbnb`ã€`standard`ã€`prettier` ç­‰ã€‚\n\nå¦‚æœéœ€è¦åŒæ—¶ä½¿ç”¨å¤šä¸ªè§„åˆ™é›†ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„çš„æ–¹å¼å°†å¤šä¸ªè§„åˆ™é›†åˆå¹¶åˆ°ä¸€èµ·ï¼š\n\n```js\n{\n  \"extends\": [\n    \"eslint:recommended\",\n    \"plugin:@typescript-eslint/recommended\",\n    \"plugin:react/recommended\",\n    \"plugin:vue/recommended\"\n  ]\n}\n```\n\nå¦‚æœéœ€è¦å®šä¹‰è‡ªå·±çš„è§„åˆ™é›†ï¼Œå¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„æŒ‡å®šè§„åˆ™é›†çš„ä½ç½®:\n\n```js\n{\n  \"extends\": \"./path/to/my-rule-set\"\n}\n```\nextends çš„ä¼˜å…ˆçº§æ˜¯ä»ä½åˆ°é«˜çš„ï¼Œåé¢çš„è§„åˆ™ä¼šè¦†ç›–å‰é¢çš„è§„åˆ™ï¼Œæœ€ç»ˆä»¥æœ€åä¸€ä¸ªè§„åˆ™é›†ä¸ºå‡†ï¼›è€Œå½“ä¸€ä¸ªè§„åˆ™åœ¨å¤šä¸ªè§„åˆ™é›†ä¸­å®šä¹‰æ—¶ï¼Œåè¾¹çš„ä¼šè¦†ç›–å‰é¢çš„ã€‚ä¾‹å¦‚ï¼š\n\n```js\n// eslint-config-a.js\nmodule.exports = {\n  rules: {\n    'no-console': 'off',\n    'no-alert': 'error'\n  }\n};\n\n// eslint-config-b.js\nmodule.exports = {\n  extends: ['eslint-config-a'],\n  rules: {\n    'no-console': 'error',\n    'no-debugger': 'warn'\n  }\n};\n```\neslint-config-b ä¸­ï¼Œno-consoleä½¿ç”¨errorï¼Œè€Œä¸æ˜¯offã€‚\n\n### settings\n\nä¸€ä¸ªå¯é€‰çš„é¡¶å±‚å±æ€§ï¼Œå®ƒå¯ä»¥ç”¨æ¥é…ç½®ä¸€äº›é¢å¤–çš„ã€è‡ªå®šä¹‰çš„ä¿¡æ¯ï¼Œä¾›æ’ä»¶å’Œè§„åˆ™ä½¿ç”¨ã€‚å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªå±æ€§ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„ `settings` å±æ€§åŠå…¶ä½œç”¨ï¼š\n\n-   `react`ï¼šè¯¥å±æ€§ç”¨äºé…ç½® React ç›¸å…³çš„ç¯å¢ƒå’Œé€‰é¡¹ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒå¯ä»¥åŒ…å«ä»¥ä¸‹å±æ€§ï¼š\n    -   `version`ï¼šReact çš„ç‰ˆæœ¬å·ï¼Œå¦‚æœä¸è®¾ç½®è¯¥å±æ€§ï¼Œåˆ™æ’ä»¶ä¼šå°è¯•è‡ªåŠ¨æ£€æµ‹ React çš„ç‰ˆæœ¬ã€‚\n    -   `pragma`ï¼šJSX çš„æ³¨é‡Šè¯­æ³•ï¼Œå¦‚æœä½ ä½¿ç”¨äº†ç±»ä¼¼äº `/** @jsx h */` çš„æ³¨é‡Šæ¥æŒ‡å®š JSX çš„è½¬æ¢å‡½æ•°ï¼Œåˆ™éœ€è¦è®¾ç½®è¯¥å±æ€§ã€‚\n    -   `fragment`ï¼šä½¿ç”¨ Fragment ç»„ä»¶çš„åç§°ï¼Œå¦‚æœä½ ä½¿ç”¨äº† Fragment ç»„ä»¶ï¼Œåˆ™éœ€è¦è®¾ç½®è¯¥å±æ€§ã€‚\n    -   `linkComponents`ï¼šé…ç½®è‡ªå®šä¹‰ç»„ä»¶é“¾æ¥çš„è§„åˆ™ï¼Œç”¨äºè§£å†³ç»„ä»¶åœ¨æŸäº›æƒ…å†µä¸‹æ— æ³•é“¾æ¥çš„é—®é¢˜ã€‚\n-   `import/resolver`ï¼šè¯¥å±æ€§ç”¨äºé…ç½®å¯¼å…¥æ¨¡å—æ—¶çš„è§£æå™¨ï¼Œé€šå¸¸ç”¨äºè§£å†³è·¯å¾„é—®é¢˜ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒå¯ä»¥åŒ…å«ä»¥ä¸‹å±æ€§ï¼š\n    -   `node`ï¼šè¯¥å±æ€§ç”¨äºè§£æ Node.js æ¨¡å—ã€‚\n    -   `webpack`ï¼šè¯¥å±æ€§ç”¨äºè§£æ Webpack æ¨¡å—ã€‚\n    -   `typescript`ï¼šè¯¥å±æ€§ç”¨äºè§£æ TypeScript æ¨¡å—ã€‚\n    -   `alias`ï¼šé…ç½®æ¨¡å—è·¯å¾„çš„åˆ«åï¼Œç”¨äºè§£å†³è·¯å¾„é—®é¢˜ã€‚\n    -   `extensions`ï¼šé…ç½®æ¨¡å—çš„æ‰©å±•åï¼Œç”¨äºè§£å†³æ¨¡å—æ–‡ä»¶ç±»å‹çš„é—®é¢˜ã€‚\n-   `polyfills`ï¼šè¯¥å±æ€§ç”¨äºé…ç½®ä¸€äº›éœ€è¦åœ¨ä»£ç ä¸­æ‰‹åŠ¨å¼•å…¥çš„ Polyfillï¼Œé€šå¸¸ç”¨äºè§£å†³å…¼å®¹æ€§é—®é¢˜ã€‚\n-   `react-native/style-sheet-object-names`ï¼šè¯¥å±æ€§ç”¨äºé…ç½® React Native ä¸­ä½¿ç”¨çš„ StyleSheet å¯¹è±¡åç§°ã€‚\n-   `jest`ï¼šè¯¥å±æ€§ç”¨äºé…ç½® Jest æµ‹è¯•æ¡†æ¶ç›¸å…³çš„ä¿¡æ¯ã€‚\n-   `svelte3`ï¼šè¯¥å±æ€§ç”¨äºé…ç½® Svelte 3 ç›¸å…³çš„ä¿¡æ¯ã€‚\n\nç­‰ç­‰...\n\n## 3. æ–°é…ç½®æ–‡ä»¶\n\nESLintå°†åœ¨ 9.0ç‰ˆæœ¬å¯ç”¨æ–°çš„é…ç½®æ–‡ä»¶æ ¼å¼`eslint.config.js`ï¼Œå…¶æ¢äº†ä¸€ç§æ–°çš„é…ç½®æ–¹å¼ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```js\nexport default [\n  {\n    rules: {\n      semi: \"error\",\n      \"prefer-const\": \"error\"\n    }\n  },\n  {\n    files: [\"src/**/*.js\"],\n    ignores: [\"**/*.config.js\"],\n    rules: {\n      semi: \"off\"\n    }\n  }\n]\n```\n\nå…·ä½“æ–°çš„åŠ¨å‘ï¼Œå¯ä»¥å…³æ³¨[å®˜ç½‘](https://eslint.org/docs/latest/use/configure/configuration-files-new)çš„æ›´æ–°ã€‚\n\n\n## 4. å‘å¸ƒnpm\n\nå»ºç«‹ä¸€ä¸ªæ–‡ä»¶ä»“åº“ï¼š\n\n\n![image.png](/img/posts/2023-4-21/2023-4-21-1.png)\n\nindex.jså†™å…¥é…ç½®ï¼š\n\n![image.png](/img/posts/2023-4-21/2023-4-21-2.png)\n\n\npackage.jsonå†™å…¥ï¼š\n\n\n![image.png](/img/posts/2023-4-21/2023-4-21-3.png)\n\nç™»å½•npmï¼š\n\n```shell\nnpm login --registry=http://registry.npm.pre.xxx.com\n```\n\næ‰§è¡Œå‘å¸ƒè„šæœ¬ï¼ˆpatchä¸ºä¾‹ï¼‰ï¼š\n\n```shell\nnpm run publish:patch\n```\n\nåœ¨å‰ç«¯é¡¹ç›®ä¸­ä½¿ç”¨é…ç½®ï¼š\n\n\n![image.png](/img/posts/2023-4-21/2023-4-21-4.png)\n\nå½“ç„¶äº†ï¼Œä½¿ç”¨å‰è®°å¾— `yarn -D` ä¸€ä¸‹å•¦ã€‚\n\nå‰©ä½™çš„é…ç½®huskyç­‰å·¥ä½œï¼Œå°±å¯ä»¥å‚è§æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼š[å‰ç«¯é¡¹ç›®é…ç½® git hook + prettier + eslint](https://juejin.cn/post/7172430884673421342)\n\n----\n\næ€»ç»“ï¼šeslinté…ç½®æ–‡ä»¶å•ç‹¬å°è£…åœ¨ä¸€ä¸ªç‹¬ç«‹åº“ä¸­ï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤å‡çº§ï¼Œçµæ´»æ€§æ›´å¼ºï¼Œé€‚åˆå‰ç«¯å¤šé¡µé¢åº”ç”¨æˆ–è€…å¾®æœåŠ¡åº”ç”¨çš„åœºæ™¯ã€‚\n\nè‡³æ­¤ï¼Œå‰ç«¯æ ¡éªŒå·¥å…· eslintå°±é…ç½®å®Œæˆå•¦ï¼"])</script><script>self.__next_f.push([1,"31:T29d8,"])</script><script>self.__next_f.push([1,"## 1. å†™åœ¨å‰é¢çš„è¯\n\nç°åº¦è¿™ä¸ªæ¦‚å¿µï¼Œæ¥è‡ªæ•°å­—å›¾åƒé¢†åŸŸï¼Œæœ€åˆæ˜¯æè¿°é»‘ç™½æ•°å­—å›¾åƒçš„ç°åº¦å€¼ï¼ŒèŒƒå›´ä» `0` åˆ° `255`ï¼Œ`0` è¡¨ç¤ºé»‘è‰²ï¼Œ`255` è¡¨ç¤ºç™½è‰²ï¼Œä¸­é—´çš„æ•°å€¼è¡¨ç¤ºä¸åŒç¨‹åº¦çš„ç°è‰²ã€‚\n\nç°åº¦ç³»ç»Ÿçš„è¯ç”Ÿæºäºäº¤å‰å­¦ç§‘çš„å»ºè®¾ï¼Œåœ¨äº’è”ç½‘ä¸Šä¹Ÿä¸ä¾‹å¤–ã€‚å¯¹äºä¸€ä¸ªè½¯ä»¶äº§å“ï¼Œåœ¨å¼€å‘å’Œå‘å¸ƒçš„æ—¶å€™è‚¯å®šå¸Œæœ›ç”¨æˆ·èƒ½å¤Ÿé¡ºåˆ©çš„çœ‹åˆ°æƒ³è®©å…¶çœ‹åˆ°çš„å†…å®¹ã€‚ä½†æ˜¯ï¼Œå‘å¸ƒæ²¡æœ‰ä¸€å¸†é£é¡ºçš„ï¼Œå¦‚æœåœ¨å‘å¸ƒçš„æŸä¸ªç¯èŠ‚å‡ºäº†é—®é¢˜ï¼Œæ¯”å¦‚æ‰“é”™äº†é•œåƒæˆ–è€…ç”±äºéƒ¨ç½²ç¯å¢ƒä¸åŒè§¦å‘äº†éšè—çš„bugï¼Œå¯¼è‡´ç”¨æˆ·çœ‹åˆ°äº†é”™è¯¯çš„é¡µé¢æˆ–è€…æ—§çš„é¡µé¢ï¼Œè¿™å°±å‡ºç°äº†ç”Ÿäº§äº‹æ•…ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µå‡ºç°ï¼Œå€Ÿé‰´æ•°å­—å›¾åƒå¤„ç†çš„ç†å¿µï¼Œè®¾è®¡å¸ˆä»¬è®¾è®¡å‡ºäº†ä¸€ç§ä»‹äº `0` å’Œ `1` ä¹‹é—´çš„`è¿‡æ¸¡ç³»ç»Ÿ`çš„æ¦‚å¿µï¼šè®©ç³»ç»Ÿå¯ä»¥é¢„å…ˆå‘å¸ƒï¼Œå¹¶è®¾ç½®å¯è§èŒƒå›´ï¼Œå°±åƒæœ‹å‹åœˆä¸€æ ·ï¼Œç­‰åˆ°é£é™©å¯æ§åï¼Œå†å¯¹å…¬ä¼—å¯è§ã€‚è¿™å°±æ˜¯ç°åº¦ç³»ç»Ÿã€‚\n\nç°åº¦ç³»ç»Ÿç‰ˆæœ¬çš„å‘å¸ƒåŠ¨ä½œç§°ä½œ `ç°åº¦å‘å¸ƒ`ï¼Œåˆåé‡‘ä¸é›€å‘å¸ƒï¼Œæˆ–è€…ç°åº¦æµ‹è¯•ï¼Œä»–æ˜¯æŒ‡åœ¨é»‘ä¸ç™½ä¹‹é—´èƒ½å¤Ÿå¹³æ»‘è¿‡æ¸¡çš„ä¸€ç§å‘å¸ƒæ–¹å¼ã€‚åœ¨å…¶ä¸Šå¯ä»¥è¿›è¡ŒA/B testingï¼Œå³è®©ä¸€éƒ¨åˆ†ç”¨æˆ·ç»§ç»­ç”¨äº§å“ç‰¹æ€§Aï¼Œä¸€éƒ¨åˆ†ç”¨æˆ·å¼€å§‹ç”¨äº§å“ç‰¹æ€§Bï¼Œå¦‚æœç”¨æˆ·å¯¹Bæ²¡æœ‰ä»€ä¹ˆåå¯¹æ„è§ï¼Œé‚£ä¹ˆé€æ­¥æ‰©å¤§èŒƒå›´ï¼ŒæŠŠæ‰€æœ‰ç”¨æˆ·éƒ½è¿ç§»åˆ°Bä¸Šé¢æ¥ã€‚(æ¦‚å¿µæ¥è‡ªçŸ¥ä¹)\n\nå¯¹äºå‰ç«¯é¢†åŸŸï¼Œæ¼”è¿›åˆ°ç°åœ¨ï¼Œç°åº¦ç³»ç»Ÿä¸»è¦æœ‰å¦‚ä¸‹å‡ ç‚¹åŠŸèƒ½ï¼š\n\n1. å¢é‡ç°åº¦ï¼šå°çš„patchå¯ä»¥å¢é‡çš„æ·»åŠ åœ¨å‘å¸ƒç‰ˆæœ¬ä¸Šï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¼€å…³ä¸€é”®å…³é—­\n2. ç”¨æˆ·ç°åº¦ï¼šå¢é‡å’Œå…¨é‡ç‰ˆæœ¬éƒ½å¯å¯¹ä¸åŒç¾¤ä½“æˆ–è€…æŸå‡ ä¸ªç‰¹å®šçš„ç”¨æˆ·è¿›è¡Œç°åº¦å¯è§\n3. ç‰ˆæœ¬å›é€€ï¼šæ¯ä¸€ä¸ªç‰ˆæœ¬éƒ½åœ¨ç°åº¦ç³»ç»Ÿé‡Œå¯è§ï¼Œå¯ä»¥ä¸€é”®å›é€€\n\nå‰ç«¯ç°åº¦ç³»ç»Ÿå·¥ä½œæµç¨‹å›¾å¦‚ä¸‹ï¼š\n\n\n```mermaid\nsequenceDiagram\nå‰ç«¯é¡¹ç›®--\u003eç°åº¦ç³»ç»Ÿ: éƒ¨ç½²é˜¶æ®µ\nå‰ç«¯é¡¹ç›®-\u003e\u003eç°åº¦ç³»ç»Ÿ: 1.CI æ‰“åŒ…åå†™å…¥æ‰“åŒ…èµ„æºï¼ŒçŠ¶æ€åˆå§‹åŒ–\nå‰ç«¯é¡¹ç›®--\u003eç°åº¦ç³»ç»Ÿ: è®¿é—®é˜¶æ®µ\nå‰ç«¯é¡¹ç›®-\u003e\u003eç°åº¦ç³»ç»Ÿ: 1.é¡µé¢è®¿é—®ï¼Œè¯·æ±‚å½“å‰ç™»å½•ç”¨æˆ·å¯¹åº”çš„èµ„æºç‰ˆæœ¬\nç°åº¦ç³»ç»Ÿ--\u003e\u003eå‰ç«¯é¡¹ç›®: 2.ä»å¯¹åº”ç‰ˆæœ¬çš„èµ„æºç›®å½•è¿”å›å‰ç«¯èµ„æº\n```\n\n![](/img/posts/2023-3-19/2023-3-19-1.png)\n---\n\n## 2. ç°åº¦è§„åˆ™\n\nå…³äºç°åº¦èµ„æºä¼˜å…ˆçº§çš„è¯´æ˜å¦‚ä¸‹ï¼š\n\n| ç°åº¦ç­–ç•¥ | ä¼˜å…ˆçº§ |\n| --- | --- |\n| æœªç”Ÿæ•ˆ | ä½ |\n| ç”Ÿæ•ˆ | é«˜ |\n| å…¨é‡ | ä¸€èˆ¬ |\n\nå¦‚æ­¤å°±èµ·åˆ°äº†`ç°åº¦`çš„ä½œç”¨ï¼šå…¨é‡è¡¨ç¤ºæ‰€æœ‰äººéƒ½å¯ä»¥çœ‹ï¼›ç”Ÿæ•ˆè¡¨ç¤ºåªæœ‰åœ¨è§„åˆ™ä¸­çš„ç”¨æˆ·æ‰å¯ä»¥çœ‹åˆ°è¿™éƒ¨åˆ†å¢é‡æ›´æ–°ï¼Œä¼˜å…ˆçº§æœ€é«˜ï¼›æœªç”Ÿæ•ˆè¡¨ç¤ºä¸ç°åº¦ï¼Œä¼˜å…ˆçº§æœ€ä½ã€‚\n\n## 3. ç°åº¦ç³»ç»Ÿæ•°æ®åº“è®¾è®¡\n\n\u003e `ä¸ºä»€ä¹ˆç°åº¦ç³»ç»Ÿæœ‰åç«¯`ï¼šå‰ç«¯é¡¹ç›® CI éƒ¨ç½²åï¼Œä¼šäº§ç”Ÿä¸€ä¸ª commit å·å’Œä¸€ä¸ªé•œåƒè®°å½•ï¼Œå¹¶ä¸”æ‰“åŒ…åçš„æ–‡ä»¶å­˜æ”¾åœ¨æœåŠ¡å™¨ä¸­æŸä¸€ä¸ªæ·±å±‚çš„æ–‡ä»¶å¤¹ç›®å½•ä¸­ï¼Œç°åº¦ç³»ç»Ÿéœ€è¦å­˜å…¥è¯¥éƒ¨ç½²çš„ç›®å½•åœ°å€ï¼Œä¾¿äºåœ¨åˆ‡æ¢ç°åº¦æ—¶æŸ¥æ‰¾ä¸åŒç‰ˆæœ¬çš„æ–‡ä»¶ã€‚\n\n\nå…ˆä»‹ç»ä¸€ä¸ªè¦éƒ¨ç½²çš„å‰ç«¯é¡¹ç›®ï¼ˆä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„å‰ç«¯é¡¹ç›®åŠ¨æ€è°ƒæ•´ï¼‰ã€‚\n\næœ¬é¡¹ç›®é’ˆå¯¹çš„å‰ç«¯é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºå¾®æœåŠ¡æ¶æ„çš„é¡¹ç›®ï¼Œ\n\nä¸‹é¢æ˜¯è®¾è®¡ERå›¾ï¼š\n\n\n![image.png](/img/posts/2023-3-19/2023-3-19-2.png)\n\næˆ‘ä»¬ä¾æ­¤æ¥åˆ†æï¼š\n\n### å­é¡¹ç›®è¡¨\n\nè¯¥è¡¨ç”¨äºå­˜æ”¾æ‰€æœ‰å­é¡¹ç›®çš„ä¿¡æ¯ï¼Œæ–°å»ºä¸€ä¸ªå¾®æœåŠ¡å­é¡¹ç›®æ—¶ï¼Œä¼šåœ¨è¿™ä¸ªè¡¨é‡Œæ–°å»ºä¸€ä¸ªæ¡ç›®ï¼Œæ•°æ®ç¤ºæ„å¦‚ä¸‹ï¼š\n\n\n![image.png](/img/posts/2023-3-19/2023-3-19-3.png)\n\n### ç°åº¦ç”¨æˆ·è¡¨\n\nç”¨äºç°åº¦ç³»ç»Ÿç™»å½•çš„ç”¨æˆ·ï¼Œæ‹¥æœ‰ç°åº¦æƒé™çš„äººæ‰å¯ä»¥åŠ å…¥ã€‚\n\n### èµ„æºè¡¨\n\nèµ„æºè¡¨å­˜æ”¾é¡¹ç›®åœ¨ CI ä¸­å†™å…¥çš„ commit ä¿¡æ¯å’Œ build å®Œä»¥ååœ¨æœåŠ¡å™¨çš„å­˜æ”¾ä½ç½®ï¼Œæ•°æ®ç¤ºæ„å¦‚ä¸‹ï¼š\n\n\n![image.png](/img/posts/2023-3-19/2023-3-19-4.png)\n\nå…¶ä¸­ `branch` æ˜¯è·‘CIçš„åˆ†æ”¯ï¼Œ`data` å­˜æ”¾æ‰“åŒ…èµ„æºç›®å½•ä¿¡æ¯ï¼Œä¸€èˆ¬ç»“æ„å¦‚ä¸‹ï¼š\n\n\n![image.png](/img/posts/2023-3-19/2023-3-19-5.png)\n\n`gitProjectId` å­˜æ”¾è¯¥äº§å“åœ¨ gitlab ä¸­çš„é¡¹ç›®å·ï¼Œ `status` è¡¨ç¤ºæ„å»ºçŠ¶æ€ï¼š0ï¼šæ„å»ºå®Œæˆ 1ï¼šéƒ¨ç½²å®Œæˆ 2ï¼šæ„å»ºå¤±è´¥ï¼Œ3ï¼šéƒ¨ç½²å¤±è´¥ã€‚\n\nè¿™é‡Œç®€å•æä¸€ä¸‹ CI æ˜¯å¦‚ä½•å†™å…¥ç°åº¦ç³»ç»Ÿæ•°æ®åº“çš„ï¼Œè¿‡å¤šè¯¦æƒ…ä¸åšè§£é‡Šï¼Œå†™å…¥æ•°æ®åº“æ–¹å¼å¾ˆå¤šï¼Œè¿™åªæ˜¯å…¶ä¸­ä¸€ç§å®ç°æ–¹å¼ã€‚\n\n1. é¦–å…ˆåœ¨ CI build ç¯èŠ‚å¾€æœåŠ¡å™¨å†™å…¥æ‰“åŒ…ä¿¡æ¯çš„ JSONï¼š\n\n![image.png](/img/posts/2023-3-19/2023-3-19-6.png)\n\nå…¶ä¸­ build.sh è´Ÿè´£æŠŠä¼ å…¥çš„å‚æ•°å†™åˆ°ä¸€ä¸ª json ä¸­ã€‚ä¸Šå›¾ä¸­æ˜¯å¾€æ ¹ç›®å½•copyï¼Œæ–¹ä¾¿ä¸‹ä¸€ä¸ª CI jobè¯»å–jsonæ–‡ä»¶çš„ç¤ºæ„å›¾ã€‚\n\n2. åœ¨ CI éƒ¨ç½²ç¯èŠ‚ï¼Œé€šè¿‡è°ƒç”¨è„šæœ¬åˆ›å»ºèµ„æºï¼š\n\n\n![image.png](/img/posts/2023-3-19/2023-3-19-7.png)\n\nå…¶ä¸­ run_gray.js:\n\n```js\nconst { ENV, file, branch, projectId, gitProjectId, user, commitMsg } = require('yargs').argv;\n\naxios({\n    url: URL,\n    method: \"POST\",\n    headers: {\n        remoteUser: user\n    },\n    data: {\n        Action: \"CreateResource\",\n        projectId,\n        branch,\n        commitMsg,\n        gitProjectId,\n        channel: Channel,\n        data: fs.readFileSync(file, 'utf8'),\n        status: \"0\"\n    }\n}).then(...)\n```\nå…¶ä¸­ status çš„å˜åŒ–ï¼Œåœ¨ CI éƒ¨ç½²æœåŠ¡å™¨å®Œæˆåï¼Œè¿½åŠ ä¸€ä¸ª `UpdateResource` åŠ¨ä½œå³å¯ï¼š\n\n```\nif [[ $RetCode != 0 ]]; then curl \"$STARK_URL\" -X 'POST' -H 'remoteUser: '\"$GITLAB_USER_NAME\"'' -H 'Content-Type: application/json' -d '{\"Action\": \"UpdateResource\", \"id\": \"'\"$ResourceId\"'\", \"status\": \"2\"}' \u003e test.log \u0026\u0026 echo `cat test.log`; fi\n```\n\n### ç°åº¦ç­–ç•¥è¡¨\n\nç°åº¦ç­–ç•¥æ˜¯å¯¹ç°åº¦èµ„æºçš„è°ƒåŠ¨é…ç½®ã€‚å…¶è®¾è®¡å¦‚ä¸‹ï¼š\n\n![image.png](/img/posts/2023-3-19/2023-3-19-8.png)\n\nå…¶ä¸­ï¼Œ`prijectId` è¡¨ç¤ºç°åº¦çš„é¡¹ç›®ï¼Œ`resourceId` è¡¨ç¤ºä½¿ç”¨çš„èµ„æºï¼Œ`rules` é…ç½®äº†å¯¹åº”çš„ç”¨æˆ·æˆ–ç”¨æˆ·ç»„ï¼ˆçœ‹ä½ æ€ä¹ˆé…ç½®äº†ï¼Œæˆ‘è¿™é‡Œåªé…ç½®äº†å•ç‹¬çš„ userIdï¼‰ï¼Œ`status` æ˜¯ç°åº¦çš„çŠ¶æ€ï¼Œæˆ‘è®¾ç½®äº†ä¸‰ç§ï¼š\n\n- default: æœªç”Ÿæ•ˆ\n- failure: ç”Ÿæ•ˆ\n- success: å…¨é‡\n\nçŠ¶æ€ç”Ÿæ•ˆè¡¨ç¤ºæ˜¯å¢é‡å‘å¸ƒçš„æ„æ€ã€‚\n\nåˆ°è¿™é‡Œï¼Œæ•°æ®åº“è®¾è®¡å°±å®Œæ¯•äº†ã€‚\n\n---\n\n## 4. ç°åº¦ç³»ç»Ÿæ¥å£APIå¼€å‘\n\næœ‰äº†æ•°æ®åº“ï¼Œè¿˜éœ€è¦æä¾›èƒ½å¤Ÿæ“ä½œæ•°æ®åº“çš„æœåŠ¡ï¼Œä¸Šè¾¹åˆ›å»ºèµ„æºçš„æ¥å£å°±æ˜¯è°ƒç”¨çš„ç°åº¦è‡ªå·±çš„APIå®ç°çš„ã€‚ä¸»è¦çš„APIåˆ—è¡¨å¦‚ä¸‹ï¼š\n\n\n| åç§° | æè¿° |\n| --- | --- |\n| getResourcesByProjectId | è·å–å•ä¸ªäº§å“ä¸‹æ‰€æœ‰èµ„æº |\n| getResourcesById | é€šè¿‡ä¸»é”®è·å–èµ„æº |\n| createResource | åˆ›å»ºä¸€ä¸ªèµ„æº |\n| updateResource | æ›´æ–°ä¸€ä¸ªèµ„æº |\n| getIngressesByProjectId | è·å–å•ä¸ªäº§å“ä¸‹ç°åº¦ç­–ç•¥ä»»åŠ¡åˆ—è¡¨ |\n| getIngressById | é€šè¿‡ä¸»é”®è·å–å•ä¸ªç°åº¦ç­–ç•¥ä»»åŠ¡è¯¦æƒ… |\n| createIngress | åˆ›å»ºä¸€ä¸ªç­–ç•¥ |\n| updateIngress | æ›´æ–°ä¸€ä¸ªç­–ç•¥ |\n\nå‰©ä½™çš„æ¥å£æœ‰ç”¨æˆ·å¤„ç†çš„ï¼Œæœ‰å­é¡¹ç›®ç®¡ç†çš„ï¼Œè¿™é‡Œä¸åšè¯¦è¿°ã€‚é™¤äº†ä¸Šè¾¹çš„å¿…é¡»çš„æ¥å£å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæœ€é‡è¦çš„æ¥å£ï¼Œé‚£å°±æ˜¯è·å–å½“å‰ç™»å½•ç”¨æˆ·éœ€è¦çš„èµ„æºç‰ˆæœ¬çš„æ¥å£ã€‚åœ¨ç”¨æˆ·è®¿é—®æ—¶ï¼Œéœ€è¦é¦–å…ˆè°ƒç”¨ç°åº¦ç³»ç»Ÿçš„è¿™ä¸ªæ¥å£æ¥è·å–èµ„æºåœ°å€ï¼Œç„¶åæ‰èƒ½é‡å®šå‘åˆ°ç»™è¯¥ç”¨æˆ·çœ‹çš„é¡µé¢ä¸­å»ï¼š\n\n| åç§° | æè¿° | æ¥æ”¶å‚æ•° | è¾“å‡º |\n| --- | --- | --- | --- |\n| getConsoleVersion | è·å–å½“å‰ç”¨çš„äº§å“ç‰ˆæœ¬ | userIdï¼Œproducts | resourceé”®å€¼å¯¹åˆ—è¡¨ |\n\n`getConsoleVersion` æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å½“å‰ç™»å½•çš„ç”¨æˆ· IDï¼Œ ä¸€ä¸ªæ˜¯å½“å‰ç”¨æˆ·è®¿é—®çš„å¾®æœåŠ¡ç³»ç»Ÿä¸­æ‰€åŒ…å«çš„äº§å“åˆ—è¡¨ã€‚è¯¥æ¥å£åšäº†å¦‚ä¸‹å‡ æ­¥æ“ä½œï¼š\n\n1. éå† productsï¼Œè·å–æ¯ä¸€ä¸ªäº§å“çš„ projectId\n2. å¯¹äºæ¯ä¸€ä¸ª projectIdï¼Œè”æŸ¥èµ„æºè¡¨ï¼Œåˆ†åˆ«è·å–å¯¹åº”çš„ resourceId\n3. å¯¹äºæ¯ä¸€ä¸ªresourceIdï¼Œç»“åˆ userIdï¼Œå¹¶è”æŸ¥ç°åº¦ç­–ç•¥è¡¨ï¼Œç­›é€‰å‡ºèµ·ä½œç”¨çš„ç°åº¦ç­–ç•¥ä¸­å¯ç”¨çš„èµ„æº\n4. è¿”å›æ¯ä¸€ä¸ªèµ„æºçš„ data ä¿¡æ¯ã€‚\n\nå…¶ä¸­ç¬¬ä¸‰æ­¥å¤„ç†ç›¸å¯¹ç¹çä¸€äº›ï¼Œæ¯”å¦‚è¯´ï¼Œä¸€ä¸ªèµ„æºæœ‰ä¸¤ä¸ªèµ·ä½œç”¨çš„ç°åº¦èµ„æºï¼Œä¸€ä¸ªæ˜¯å¢é‡çš„ï¼Œä¸€ä¸ªæ˜¯å…¨é‡çš„ï¼Œè¿™é‡Œåº”è¯¥æ‹¿å¢é‡çš„ç‰ˆæœ¬ï¼Œå› ä¸ºä»–ä¼˜å…ˆçº§æ›´é«˜ã€‚\n\n\nè·å–ç”¨æˆ·ç‰ˆæœ¬çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š\n\n\n```mermaid\ngraph TD\nç”¨æˆ·ç™»å½•é¡µé¢ --\u003e è·å–æ‰€æœ‰äº§å“ä¸‹çš„èµ„æºåˆ—è¡¨\nè·å–æ‰€æœ‰äº§å“ä¸‹çš„èµ„æºåˆ—è¡¨ --\u003e æ ¹æ®ç°åº¦ç­–ç•¥ç­›é€‰èµ„æºä¸­è¯¥ç”¨æˆ·å¯ç”¨çš„éƒ¨åˆ† --\u003e è¿”å›äº§å“ç»´åº¦çš„èµ„æºå¯¹è±¡\n```\n\n![](/img/posts/2023-3-19/2023-3-19-9.png)\n\næœ€åè¿”å›çš„èµ„æºå¤§æ¦‚é•¿è¿™ä¸ªæ ·å­ï¼š\n\n```js\ninterface VersionResponse {\n    [productId: number]: ResourceVersion;\n}\n\ninterface ResourceVersion {\n    files: string[];\n    config: ResourceConfig;\n    dependencies: string[];\n}\n```\n\nå…¶ä¸­ files å°±æ˜¯ JSON è§£æåçš„ä¸Šè¿° data ä¿¡æ¯çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå› ä¸ºæ‰“åŒ…åçš„æ–‡ä»¶å¾€å¾€æœ‰ csså’Œå¤šä¸ªjsã€‚\n\nè‡³äºè¿™ä¸ªåç«¯ä½¿ç”¨ä»€ä¹ˆè¯­è¨€ï¼Œä»€ä¹ˆæ¡†æ¶æ¥å†™ï¼Œå¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯ä¸€å®šè¦ç¨³å®šï¼Œä»–è¦æŒ‚æ‰äº†ï¼Œç”¨æˆ·å°±è¿›ä¸å»ç³»ç»Ÿäº†ï¼Œå®¹ç¾å’Œå®¹é”™è¦åšå¥½ï¼›å¦‚æœæ˜¯ä¸ªå®¢æˆ·æ¯”è¾ƒå¤šçš„ç½‘ç«™ï¼Œå¹¶å‘åˆ†æµä¹Ÿè¦è€ƒè™‘è¿›å»ã€‚\n\n## 5. å‰ç«¯é¡µé¢å±•ç¤º\n\nå‰ç«¯é¡µé¢å°±éšä¾¿ä½¿ç”¨äº†ä¸€ä¸ªå‰ç«¯æ¡†æ¶æ­äº†ä¸€ä¸‹ï¼Œé€‰å‹ä¸æ˜¯é‡ç‚¹ï¼Œç»„ä»¶åº“èƒ½å¤Ÿæ»¡è¶³è¦æ±‚å°±è¡Œï¼š\n\n- ç™»å½•\n\n![image.png](/img/posts/2023-3-19/2023-3-19-10.png)\n\n- æŸ¥çœ‹èµ„æº\n\n\n![image.png](/img/posts/2023-3-19/2023-3-19-11.png)\n\n- é…ç½®ç­–ç•¥\n\n\n![image.png](/img/posts/2023-3-19/2023-3-19-12.png)\n\n\n![image.png](/img/posts/2023-3-19/2023-3-19-13.png)\n\n---\n\néƒ¨ç½²ä»¥åï¼Œå®é™…è¿è¡Œé¡¹ç›®çœ‹çœ‹æ•ˆæœï¼š\n\n\n![image.png](/img/posts/2023-3-19/2023-3-19-14.png)\n\nå¯ä»¥çœ‹åˆ°ï¼Œåœ¨è°ƒç”¨ä¸šåŠ¡æ¥å£ä¹‹å‰ï¼Œä¼˜å…ˆè°ƒç”¨äº† getConsoleVersionæ¥è·å–ç‰ˆæœ¬ï¼Œå…¶è¿”å›å€¼æ˜¯ä»¥äº§å“ä¸º key çš„é”®å€¼å¯¹ï¼š\n\n\n![image.png](/img/posts/2023-3-19/2023-3-19-15.png)\n\n## 6. è®¿é—®è½¬å‘\n\nè¿™é‡Œæ‹¿åˆ°éƒ¨ç½²ä¿¡æ¯åï¼ŒæœåŠ¡å™¨è¦è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†çš„ã€‚æˆ‘è¿™é‡Œæ˜¯æŠŠå®ƒå°è£…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œå¸¦ç€å‚æ•°ä¼ ç»™äº†å¾®æœåŠ¡çš„ hook å»äº†ï¼ˆå¾®æœåŠ¡ç³»ç»Ÿéœ€è¦ï¼‰ï¼›**å¦‚æœä½ æ˜¯å•é¡µåº”ç”¨ï¼Œå¯èƒ½éœ€è¦æŠŠå·¥ä½œé‡å¿ƒæ”¾åœ¨ Nginx çš„è½¬å‘ä¸Šï¼ŒNginxå†…éƒ¨æœåŠ¡è¯»å–ç°åº¦ç³»ç»Ÿæ•°æ®åº“æ¥æ‹¿åˆ°ç‰ˆæœ¬ç›®å½•ï¼Œç„¶ååˆ‡æ¢è·¯ç”±è½¬å‘ï¼ˆå¯èƒ½åªæ˜¯æ”¹å˜ä¸€ä¸ªè·¯ç”±å˜é‡ï¼‰ã€‚** ï¼ˆä½ ä¹Ÿå¯ä»¥å‚ç…§æˆ‘ [nginx ç›¸å…³æ–‡ç« ](https://juejin.cn/post/7211702508371656759)ï¼‰ï¼Œä¸‹é¢æˆ‘ç®€å•çš„ç»™ä¸ªç¤ºæ„å›¾ï¼š\n\n\n```mermaid\ngraph TD\nç°åº¦ç³»ç»Ÿé…ç½®ç°åº¦ç­–ç•¥ --\u003e Nginx+Lua+Mysqlè·å–ç°åº¦ç­–ç•¥å¹¶å†™å…¥Nginxå˜é‡\nNginx+Lua+Mysqlè·å–ç°åº¦ç­–ç•¥å¹¶å†™å…¥Nginxå˜é‡ --\u003e NginxæœåŠ¡å™¨é…ç½®èµ„æºè½¬å‘\n```\n\n![](/img/posts/2023-3-19/2023-3-19-16.png)\n\n## 7. æ€»ç»“\n\nå‰ç«¯ç°åº¦ç³»ç»Ÿï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªåå°ç®¡ç†ç³»ç»Ÿã€‚ä»–é…ç½®å’Œç®¡ç†äº†ä¸åŒç‰ˆæœ¬çš„å‰ç«¯éƒ¨ç½²èµ„æºå’Œå¯¹åº”çš„ç”¨æˆ·ç­–ç•¥ï¼Œåœ¨éœ€è¦çš„æ—¶å€™è¿›è¡Œé…ç½®ã€‚\n\næ¥ä¸‹æ¥çš„æ–‡ç« æˆ‘ä¼šé…å¥—æ€§çš„è®²ä¸€ä¸‹ `Nginx` å’Œ `Docker` çš„å‰ç«¯å…¥é—¨ä½¿ç”¨ï¼Œæ•¬è¯·æœŸå¾…ï¼\n\nå®Œï¼å¤§å®¶å¯¹ç°åº¦ç³»ç»Ÿæœ‰ä»€ä¹ˆå¥½çš„å»ºè®®ï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºè®¨è®ºå“¦ï¼\n\n---"])</script><script>self.__next_f.push([1,"32:T4612,"])</script><script>self.__next_f.push([1,"å¯¹äºä¸€ä¸ªå‰ç«¯å¼€å‘ï¼Œè™½ç„¶æœåŠ¡å™¨å¼€å‘éƒ¨ç½²ä¸æ˜¯ä¸»è¦ä¸šåŠ¡ï¼Œä½†æ˜¯ï¼Œç‹¬ç«‹å¼€å‘å‰ç«¯é¡¹ç›®æ€»å½’æ˜¯æŒ‚è½½åœ¨æœåŠ¡å™¨ä¸Šæ‰èƒ½è·‘èµ·æ¥çš„ï¼Œä¸èƒ½æ€»æŒ‡æœ›è¿ç»´æ¥åšè¿™ä¸ªå·¥ä½œã€‚è€Œä¸”ï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œä¸å¯èƒ½å¯¹é¡¹ç›®éƒ¨ç½²ä¸€ç‚¹éƒ½ä¸äº†è§£ã€‚\n\næœ¬æ–‡å°±è®²ä¸€ä¸‹ä½œä¸ºä¸€ä¸ªå‰ç«¯å¼€å‘åº”è¯¥è¦æŒæ¡çš„åŸºæœ¬çš„ nginx æœåŠ¡.\n\n\u003e å…³äº nginx ä¸ CI é…åˆçš„ä½¿ç”¨ï¼Œè§æˆ‘çš„æ–‡ç« ï¼šhttps://juejin.cn/post/7183517146729693221\n\n## 1. æ¦‚å¿µ\n\n- æ­£å‘ä»£ç†\n\nç‰¹ç‚¹ï¼šç”¨æˆ·ä¸»åŠ¨å»è”ç³»åˆ†å‘è®¾å¤‡ï¼Œåˆ†å‘è®¾å¤‡æ¥åˆ¤æ–­åˆ†å‘çš„ç›®æ ‡æœåŠ¡å™¨ã€‚æ­¤æ—¶ï¼Œ**ç”¨æˆ·å¯¹äºæœåŠ¡å™¨æœªçŸ¥**ã€‚\n\nè·¯ç”±å™¨æ˜¯æ­£å‘ä»£ç†çš„ä¸€ä¸ªä¾‹å­ï¼Œä¸ç”¨æˆ·åœ¨ä¸€ä¾§ï¼Œæœ‰æœ€å¤§å¸¦å®½é™åˆ¶ã€‚\n\n![image.png](/img/posts/2023-3-18/2023-3-18-1.png)\n\n- åå‘ä»£ç†\n\nåå‘ä»£ç†ä¸€èˆ¬æ˜¯éƒ¨ç½²åœ¨æœåŠ¡ä¾§çš„ï¼Œçµæ´»å¾ˆå¤šï¼Œå¯ä»¥åšè´Ÿè½½åˆ†æµå’Œæ‰©å±•åŠŸèƒ½ç­‰ã€‚ä½†æ˜¯å¯¹äºç”¨æˆ·è€Œè¨€ï¼Œåå‘ä»£ç†æœåŠ¡å™¨å°±ç›¸å½“äºç›®æ ‡æœåŠ¡å™¨ï¼Œå³ç”¨æˆ·ç›´æ¥è®¿é—®åå‘ä»£ç†æœåŠ¡å™¨å°±å¯ä»¥è·å¾—ç›®æ ‡æœåŠ¡å™¨çš„èµ„æºã€‚æ­¤æ—¶ï¼Œ**æœåŠ¡å™¨å¯¹äºç”¨æˆ·æœªçŸ¥**ï¼Œæé«˜äº†å®‰å…¨æ€§ã€‚\n\n![image.png](/img/posts/2023-3-18/2023-3-18-2.png)\n\nnginx ä¾¿æ˜¯é«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç† web æœåŠ¡å™¨\n\nä¸€ä¸ªnginxçš„ä½¿ç”¨ä¾‹å­å°±æ˜¯è™šæ‹Ÿä¸»æœºï¼šå¤šä¸ªåŸŸåç»‘å®šä¸€ä¸ªä¸»æœºï¼Œç”± nginx è½¬å‘ä¸åŒçš„èµ„æºã€‚\n\n## 2. å®‰è£…ä¸éƒ¨ç½²å‰ç«¯åº”ç”¨\n\n- å¹³å°ï¼šCentOS7 è™šæ‹Ÿæœº\n- å®‰è£…ç‰ˆæœ¬ï¼šç›®å‰æœ€æ–° 1.21.6\n- ä¸‹è½½åœ°å€ï¼š[nginx å®˜ç½‘](https://nginx.p2hp.com/en/download.html)\n\n\nå®‰è£…åŒ…è§£å‹åè¿›å…¥ç›®å½•\n\n![image.png](/img/posts/2023-3-18/2023-3-18-3.png)\n\nå®‰è£…ä¾èµ–\n\n```\nyum install -y gcc\nyum install -y pcre-devel\nyum install -y zlib zlib-devel\n```\n\nå¼€å§‹å®‰è£… (å®‰è£…ç›®å½•/usr/local/nginx)\n\n```sh\n./configure --prefix=/usr/local/nginx\n\nmake\n\nmake install\n```\n\nå®‰è£…æˆåŠŸï¼ŒæŸ¥çœ‹å®‰è£…ç›®å½•\n\n\n![image.png](/img/posts/2023-3-18/2023-3-18-4.png)\n\næµ‹è¯•è¿è¡Œ\n\næ‰§è¡Œ `./sbin/nginx` (ä¹Ÿå¯ä»¥ä½¿ç”¨å…¨å±€ nginx å‘½ä»¤)\n\n![image.png](/img/posts/2023-3-18/2023-3-18-5.png)\n\nå¯ä»¥çœ‹åˆ°è¿›ç¨‹å·²ç»å¯åŠ¨\n\n```\nps -ef | grep nginx\n```\n\n![image.png](/img/posts/2023-3-18/2023-3-18-6.png)\n\nä¸ºäº†æµ‹è¯•ï¼Œå…ˆå…³é—­é˜²ç«å¢™ï¼š\n\n```\nsystemctl stop firewalld.service\n```\n\næ­£å¼çº¿ä¸Šä½¿ç”¨çš„ï¼Œå¯ä»¥é…ç½®é˜²ç«å¢™æ”¾è¡Œç«¯å£ã€‚\n\né…ç½® nginx é…ç½®æ–‡ä»¶ï¼š\n\n```\nvim ./conf/nginx.conf\n```\n\n![image.png](/img/posts/2023-3-18/2023-3-18-7.png)\n\nå…¶ä¸­ location æ ¹ç›®å½•ä½ç½®æ˜¯å·²ç» build å¥½çš„ä¸€ä¸ª vue åº”ç”¨ï¼š\n\n![image.png](/img/posts/2023-3-18/2023-3-18-8.png)\n\né‡å¯\n\n```\nnginx -s reload\n```\n\næµè§ˆå™¨æŸ¥çœ‹ ï¼ˆä½¿ç”¨ ip addr æŒ‡ä»¤å¯ä»¥æŸ¥çœ‹ipï¼‰\n\n![image.png](/img/posts/2023-3-18/2023-3-18-9.png)\n\n---\n\u003e ä¸Šè¿°åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ä¹Ÿæœ‰æ‰€æåŠï¼Œç›¸é¢æ›´æ·±å…¥çš„è®²ä¸€ä¸‹é…ç½®æ–‡ä»¶çš„ä½¿ç”¨\n---\n\n## 3. é…ç½®æ–‡ä»¶æœ€å°é›†\n\né…ç½®æ–‡ä»¶æœ€å°é›†æ˜¯ä¸€ä¸ªèƒ½å¤Ÿæ”¯æ’‘ nginx æ­£å¸¸è·‘èµ·æ¥çš„æœ€å°çš„é…ç½®é¡¹é›†åˆï¼Œè¿æ³¨é‡Šä¸€å¹¶å†™åœ¨ä¸‹é¢ï¼Œä¾›å¤§å®¶å‚è€ƒï¼š\n\n```json\n// ./conf/nginx.conf\nworker_process 1; // å¹¶è¡Œæ‰§è¡Œçš„ä»»åŠ¡æ•°ï¼Œä¸€èˆ¬æŒ‰ç…§CPUå†…æ ¸é…ç½®\nevents: {\n    worker_connections 1024; // é…ç½®å•ä¸ªworkerè¿›ç¨‹æœ€å¤§çš„è¿æ¥æ•°ï¼Œnginx é»˜è®¤è¿æ¥æ•°æ˜¯1024\n}\n\nhttp { // æ”¯æŒ http åè®®è®¿é—®çš„æœåŠ¡\n    include      mime.types; // å½“å‰ç›®å½•ä¸‹çš„é…ç½®çš„æ–‡ä»¶ç±»å‹æ–‡ä»¶ï¼Œä½¿ç”¨é»˜è®¤å³å¯ã€‚å›¾ç‰‡éŸ³é¢‘ä¼šè‡ªåŠ¨è§£æç»™æµè§ˆå™¨ï¼Œä¸èƒ½è§£æçš„ä¸€å¾‹æŒ‰ç…§äºŒè¿›åˆ¶æµä¸‹è½½\n    default_type  application/octet-stream; // é»˜è®¤æ–‡ä»¶ç±»å‹ äºŒè¿›åˆ¶æµä¸‹è½½\n    sendfile        on;  // æ˜¯å¦å…è®¸ç›®æ ‡æœåŠ¡å™¨ç»•è¿‡ nginx æœåŠ¡å™¨ç›´æ¥è¿”å›ç»“æœç»™ç”¨æˆ·\n    keepalive_timeout  65;  // è¶…æ—¶æ—¶é—´\n    \n    server { // éš¶å±äº http çš„ä¸€ä¸ª æœåŠ¡å™¨\n        listen       10087;  // ç«¯å£\n        server_name  localhost;  // æœåŠ¡éƒ¨ç½²çš„ipåœ°å€ï¼Œå¯ä»¥æ˜¯åŸŸå\n        charset utf-8;\n        location / {  // é…ç½® uri\n\t    root   /root/web/dist;  // è‡ªå®šä¹‰çš„èµ„æºç›®å½•ï¼Œå¯ä»¥æ˜¯ç»å¯¹ç›®å½•ï¼›è‹¥å‰è¾¹ä¸åŠ  /, åˆ™è¡¨ç¤ºç›¸å¯¹ç›®å½•ï¼Œç›¸å¯¹çš„æ˜¯ nginx ä¸»ç›®å½•\n            index  index.html index.htm;\n        }\n\n        error_page  404             404.html;  // 404é¡µé¢é…ç½®ï¼Œç›¸å¯¹è·¯ç”±\n        error_page   500 502 503 504   50x.html; // åŒä¸Š\n        location = /50x.html {\n            root   html;  // 50x æ—¶ï¼Œèµ„æºæŒ‡å‘ htmlç›®å½•ä¸‹å¯»æ‰¾\n        }\n        location = /404.html {\n            root   html;  // åŒä¸Š\n        }\n    } // end server\n} // end http\n```\n\n## 4. å¤šç«™ç‚¹é…ç½®\n\nå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªèµ„æºç›®å½•ï¼Œä½ å¯ä»¥ç†è§£ä¸ºä¸¤ä¸ªé¡¹ç›®çš„ build ç›®å½•ï¼š\n\n```\n/root/web/vue/dist\n/root/web/react/dist\n```\n\næˆ‘ä»¬é€šè¿‡é…ç½®æ–‡ä»¶æ¥æ§åˆ¶ä¸åŒçš„è®¿é—® url åˆ†åˆ«åˆ†å‘ç»™è¿™ä¸¤ä¸ªèµ„æºã€‚\n\n```json\nserver {\n    listen       80;  \n    server_name  www.vue.com;  \n    location / {  \n        root   /root/web/vue/dist; \n        index  index.html index.htm;\n    }\n}\n\nserver {\n    listen       8080;  \n    server_name  www.react.com;  \n    location / {  \n        root   /root/web/react/dist; \n        index  index.html index.htm;\n    }\n}\n```\n\nè¿™æ ·ï¼Œè®¿é—® www.vue.com å°±ä¼šè¿›å…¥ vue çš„é¡¹ç›®ï¼Œè®¿é—® www.react.com:8080 ä¼šè¿›å…¥ react çš„é¡¹ç›®ã€‚\n\næ³¨æ„ï¼šhttps çš„åŸŸåéœ€è¦åœ¨äº‘ç«¯é…ç½® ip ç»‘å®šä¸º nginx çš„æœåŠ¡å™¨ã€‚\n\n## 5. server_name åŒ¹é…\n\nserver_name æ”¯æŒæ¨¡ç³ŠåŒ¹é…å’Œé€šé…ç¬¦åŒ¹é…ã€‚\n\n- é€šé…ç¬¦ï¼š *.xxx.com ã€www.baidu.*\n\næ‰€æœ‰ .xxx.com ç»“å°¾çš„éƒ½å¯ä»¥åŒ¹é…åˆ°\n\n- å®Œå…¨åŒ¹é…ï¼šwww.react.com\n- æ­£åˆ™åŒ¹é…ï¼š~^[0-9]+\\.xxx\\.com$ (è§„åˆ™ï¼š~å¼€å¤´)\n\n\nåŒ¹é…ä¼˜å…ˆçº§ï¼š\n\n1. å®Œå…¨åŒ¹é…\n2. é€šé…ç¬¦åœ¨å‰çš„\n3. é€šé…ç¬¦åœ¨åçš„\n4. æ­£åˆ™åŒ¹é…\n\nå¦‚æœéƒ½ä¸åŒ¹é…\n\n1. ä¼˜å…ˆé€‰æ‹©listené…ç½®é¡¹åæœ‰ default æˆ– default_server çš„\n2. ä¸Šè¿°éƒ½ä¸æ»¡è¶³ï¼Œåˆ™å»æ‰¾ç«¯å£é…ç½®çš„ä½ç½®æœ€é å‰çš„server\n\n## 6. è´Ÿè½½å‡è¡¡é…ç½®\n\nä½¿ç”¨åœºæ™¯ï¼šè®¿é—®åŒä¸€ä¸ªåŸŸåï¼Œä½†æ˜¯ç›®æ ‡åœ°å€å¯ä»¥æ˜¯å¤šä¸ªï¼Œæ ¹æ®ä½¿ç”¨æƒ…å†µå’Œç©ºé—²ç¨‹åº¦è‡ªåŠ¨åˆ†é…ä¸€ä¸ªä½¿ç”¨ã€‚upstream ç”¨äºè®¾ç½®å¤šå°åˆ†å‘ä¸»æœºçš„é›†åˆã€‚\n\n```json\nhttp {\n    ...\n    upstream my_server {\n        server 10.123.345.456:8000;\n        server 10.123.345.457:8000;\n    }\n\n    server {\n        location / {\n            proxy_pass http://my_server;\n        }\n    }\n}\n\n```\n\nè¿™æ ·é…ç½®åï¼Œå®é™…è®¿é—® http://192.168.122.1 è®¿é—®æ—¶ï¼Œç³»ç»Ÿä¼šåœ¨ 456 å’Œ 457 ä¸¤ä¸ª ipæœåŠ¡é€‰æ‹©ä¸€ä¸ªåˆ†å‘ï¼Œé›¨éœ²å‡æ²¾ã€‚\n\nå½“ç„¶ä½ ä¹Ÿå¯ä»¥é…ç½®ä¸¤ä¸ªæœåŠ¡å™¨çš„è½®è¯¢æƒé‡(è®¿é—®æ¦‚ç‡)ã€‚\n\n```json\nserver 10.123.345.456:8000 weight=8;\nserver 10.123.345.457:8000 weight=1;\nserver 10.123.345.457:8000 backup;  // æ ‡è¯†å¤‡ç”¨æœºï¼Œå®åœ¨æ˜¯æ²¡æœ‰å¯ç”¨çš„æœºå™¨æ—¶å¯ç”¨\n```\n\nå¦‚æœæƒ³è¦æŸä¸€ä¸ªæœåŠ¡å™¨ä¸å‚ä¸è´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥å¦‚ä¸‹é…ç½®ï¼š\n\n```json\nserver 10.123.345.456:8000 down;\n```\n\n## 7. é…ç½®åŠ¨é™åˆ†ç¦»\n\né€‚åˆå°ä¸­å‹ç½‘ç«™ï¼Œé™æ€èµ„æºä¸å¤ªå¤šçš„åœºæ™¯ã€‚åŸç†æ˜¯ç”¨æˆ·è¯·æ±‚é¡µé¢æ—¶ï¼Œæå–å‡ºé™æ€èµ„æºï¼Œç­‰ä¸‹æ¬¡ç”¨æˆ·è®¿é—®ç›¸åŒé¡µé¢æ—¶ï¼Œé™æ€èµ„æºå¯ä»¥ä¸ç”¨å†æ¬¡æ‰¾æœåŠ¡å™¨è·å–ï¼Œè€Œæ˜¯å–ç¼“å­˜çš„å†…å®¹ã€‚\n\né…ç½®å¦‚ä¸‹ï¼š\n\n\n```json\nhttp {\n    ...\n    upstream my_server {\n        server 10.123.345.456:8000;\n        server 10.123.345.457:8000;\n    }\n\n    server {\n        location / {\n            proxy_pass http://my_server;\n        }\n        \n        location ~.*\\.(js|png|jpg|svg|css)$ {  // é™æ€èµ„æº\n            root   html;\n            index  index.html index.htm;\n        }\n    }\n}\n```\n\n## 8. é…ç½® URLRewrite\n\nç”¨äºéšè—æœåŠ¡å™¨çœŸå®urlè·¯å¾„ã€‚\n\n```js\nhttp {\n    ...\n    upstream my_server {\n        server 10.123.345.456:8000;\n        server 10.123.345.457:8000;\n    }\n\n    server {\n        location / {\n            rewrite ^/([0-9]+).html$ /index/pageNum=$1 break;\n            proxy_pass http://my_server;\n        }\n        \n    }\n}\n```\n\nä¸Šè¾¹å°±ä½¿ç”¨äº†ä¸€ä¸ª rewrite æ¥é…ç½®äº†è½¬å‘ã€‚\n\nè¿™ä¸ªä¾‹å­éšè—äº†é¡µé¢çš„åˆ†é¡µä¿¡æ¯ï¼šè®¿é—® /2.html å°±ç›¸å½“äºè®¿é—®äº† /index/pageNum=2 è·¯å¾„ã€‚\n\nåŒ¹é…å…³é”®å­—ï¼š\n\n- breakï¼šåœæ­¢æ‰€æœ‰rewriteåŒ¹é…\n- lastï¼šæœ¬æ¡åŒ¹é…å®Œæˆåï¼Œç»§ç»­å‘ååŒ¹é…å…¶ä»–çš„ location çš„ rewrite\n- redirectï¼šè¿”å› 302 é‡å®šå‘åˆ°çœŸå®åœ°å€ï¼Œè€Œä¸æ˜¯ç”¨å‡åœ°å€\n- permanentï¼š301 æ°¸ä¹…é‡å®šå‘åˆ°çœŸå®åœ°å€ ï¼ˆé€‚ç”¨äºçˆ¬è™«ï¼‰\n\n## 9. é…ç½®é˜²ç›—é“¾\n\nç›—é“¾ï¼ˆHotlinkingï¼‰æ˜¯æŒ‡åœ¨ä¸€ä¸ªç½‘ç«™ä¸Šï¼Œä½¿ç”¨åˆ«äººç½‘ç«™ä¸Šçš„å›¾ç‰‡æˆ–å…¶ä»–åª’ä½“èµ„æºæ¥è£…é¥°è‡ªå·±çš„ç½‘ç«™ï¼Œè€Œä¸è·å¾—è¯¥èµ„æºçš„æ‰€æœ‰è€…è®¸å¯çš„è¡Œä¸ºã€‚ç›—é“¾å¯ä»¥å¯¼è‡´è¢«ç›—ç”¨è€…çš„å¸¦å®½å’Œæµé‡å—åˆ°æ¶ˆè€—ï¼Œç”šè‡³å¯èƒ½ä½¿å…¶ç½‘ç«™é€Ÿåº¦å˜æ…¢æˆ–å´©æºƒã€‚\n\né˜²ç›—é“¾ä¹Ÿæ˜¯èµ„æºèŠ‚çœä¼˜åŒ–çš„å¿…å¤‡é…ç½®ã€‚nginx ä¸­æ ¹æ® http è¯·æ±‚å¤´çš„ referer åˆ¤æ–­æ¥æºå¯ä»¥åšåˆ°æ‹¦æˆªã€‚\n\nä¸€ä¸ªé…ç½®é˜²ç›—é“¾çš„ä¾‹å­å¦‚ä¸‹ï¼š\n\n```json\nlocation ~* \\.(jpg|jpeg|png|gif)$ {\n    valid_referers none blocked xxx.com;\n    if ($invalid_referer) {\n        return 403;\n    }\n}\n```\n\nä»¥ä¸Šä»£ç è¡¨ç¤ºï¼Œå¦‚æœè®¿é—®çš„å›¾ç‰‡URLçš„`referer`ä¸æ˜¯ xxx.comï¼Œåˆ™è¿”å› 403 ç¦æ­¢è®¿é—®ã€‚å¦‚æœè®¿é—®çš„URLæ²¡æœ‰refererï¼Œåˆ™ä¹Ÿä¼šè¢«ç¦æ­¢è®¿é—®ã€‚\n\né…ç½®é¡¹ä»‹ç»ï¼š\n\n- noneï¼šrefererä¸å­˜åœ¨æ—¶å¯ä»¥è®¿é—®ï¼Œä¸è®¾ç½®åˆ™æ‰€æœ‰è®¿é—®ä¸æ˜¯ xxx.com éƒ½ç¦æ­¢\n- blockedï¼šrefererå€¼è¢«é˜²ç«å¢™æˆ–è€…ä»£ç†æœåŠ¡å™¨åˆ é™¤æˆ–ä¼ªè£…æ—¶å¯ä»¥è®¿é—®ã€‚ä¸€èˆ¬æ˜¯ä¸å¸¦ http å‰ç¼€çš„è®¿é—®æ”¾è¡Œé…ç½®ã€‚\n\næ¥ä¸‹æ¥é…ç½®é”™è¯¯æç¤ºé¡µé¢ï¼š\n\nå‡è®¾æœ‰ä¸ªé¡µé¢ ï¼š `403.html`, éœ€è¦é…ç½®ç¦æ­¢è®¿é—®æ—¶æ˜¾ç¤ºï¼š\n\n```json\nerror_page 403 /403.html\nlocation = /403.html {\n    root   html;  // èµ„æºæŒ‡å‘ htmlç›®å½•ä¸‹å¯»æ‰¾\n}\n```\n\næˆ–è€…åœ¨ return 403 æ—¶è®¾ç½®ï¼š`rewrite` åˆ°ä¸€ä¸ªé…ç½®å¥½çš„èµ„æºä¹Ÿå¯ä»¥ã€‚\n\n## 10. å®‰å…¨é«˜å¯ç”¨æ–¹æ¡ˆé…ç½®\n\nå®‰å…¨é«˜å¯ç”¨çš„æ„ä¹‰ï¼šåœ¨ä¸é¢å¤–æ·»åŠ æœºå™¨çš„æƒ…å†µä¸‹åšåˆ°ä¸downæœºåŠ¨æ€åˆ‡æ¢æœºå™¨ï¼Œä»è€Œè¾¾åˆ°æœåŠ¡æŒç»­å¯ç”¨ \n\n### keepalived\n\nå®‰è£…\n\n```sh\nyum install keepalived\n```\n\nç¼–è¾‘é…ç½®ï¼ˆ/etc/keepalived.confï¼‰:\n\n```json\nglobal_defs {\n    router_id lb111\n}\n\nvrrp_instance_test {  // è‡ªå®šä¹‰ test å®ä¾‹\n    state MASTER   // ä¸»\n    interface eth01  // ä½ æœºå™¨ä¸Šç½‘å¡çš„åå­—\n    virtual_router_id 33  // è™šæ‹Ÿè·¯ç”±idï¼Œä¸»ä»è¦ä¸€æ ·\n    priority 100 // ä¼˜å…ˆçº§é«˜çš„æœºå™¨å°±ä¸º master\n    advert_int 1 // é—´éš”æ£€æµ‹æ—¶é—´\n    authentication {  // è®¤è¯é…ç½®ï¼ŒåŒä¸€ç»„ä¿æŒä¸€è‡´å³å¯\n        auth_type PASS  \n        auth_pass 1111  \n    }\n    virtual_ipaddress {\n        192.168.44.1  // æœ¬å°æœºå™¨çš„è™šæ‹Ÿåœ°å€\n    }\n}\n```\n\nä¸Šé¢æ˜¯ç¬¬ä¸€å°æœºå™¨çš„é…ç½®ï¼Œåœ¨ç¬¬äºŒå°è™šæ‹Ÿæœºä¸Šä¹Ÿé…ç½®ä¸€ä¸‹ç±»ä¼¼çš„é…ç½®ï¼Œè®¾ç½®ï¼š\n\n```json\nglobal_defs {\n    router_id lb110  // ä¿®æ”¹è·¯ç”±å·\n}\n\nvrrp_instance_test {  // åŒä¸€ä¸ªå®ä¾‹\n    state BACKUP   // ä»\n    interface eth01  \n    virtual_router_id 33\n    priority 50 // å‡ä½ä¼˜å…ˆçº§\n    advert_int 1\n    authentication { \n        auth_type PASS  \n        auth_pass 1111  \n    }\n    virtual_ipaddress {\n        192.168.44.1  // æœ¬å°æœºå™¨çš„è™šæ‹Ÿåœ°å€\n    }\n}\n```\n\nä¸¤å°æœºå™¨åˆ†åˆ«å¯åŠ¨ä¸€ä¸‹ï¼š\n\n```\nsystemctl start keepalived\n```\n\næ­¤æ—¶åœ¨å¤–ç½‘å¯ä»¥pingé€šçš„ipæ˜¯ï¼š 192.168.44.1ã€‚\n\næˆ‘ä»¬è®© MASTER æœºå™¨å…³æœºåï¼Œå†pingä¸€ä¸‹ 192.168.44.1ï¼Œå‘ç°ä»ç„¶å¯ä»¥ï¼Œæ­¤æ—¶åœ¨å¤‡ä»½åŠä½¿ç”¨æŒ‡ä»¤ `ip addr` æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ° æœ‰ä¸€ä¸ª 192.168.44.1 çš„è™šæ‹Ÿipã€‚è¿™è¯´æ˜é«˜å¯ç”¨ç”Ÿæ•ˆäº†ï¼Œè¿™ç§é…ç½®å« ipæ¼‚ç§»ã€‚\n\nä¸Šè¿°æƒ…å†µåªèƒ½ä¿è¯ keepalived è¿›ç¨‹æŒ‚æ‰æ—¶èµ·ä½œç”¨ï¼Œæ›´é«˜çº§çš„ç”¨æ³•æ˜¯è·‘ä¸€ä¸ªè„šæœ¬ï¼Œæ£€æµ‹æœ¬æœºçš„ nginz æœåŠ¡è¿›ç¨‹ï¼Œå¦‚æœæœåŠ¡å¼‚å¸¸ï¼Œåˆ™ kill æ‰æœ¬æœºçš„ keepalived è¿›ç¨‹ã€‚\n\n\n### https ä¸ TLS\n\nhttp åè®®å¾€å¾€æ˜¯ä¸å®‰å…¨çš„ï¼Œå³ä½¿æœ‰é˜²ç«å¢™ï¼Œä½†æ˜¯æ²¡åŠæ³•é˜²å¾¡æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«åŠ«æŒï¼š\n\n![image.png](/img/posts/2023-3-18/2023-3-18-10.png)\n\næ­¤æ—¶å°±éœ€è¦å¯¹ä¼ è¾“è¿‡ç¨‹çš„æ¶ˆæ¯è¿›è¡ŒåŠ å¯†ã€‚åŠ å¯†æ–¹å¼æœ‰å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ã€‚\n\nå¯¹ç§°åŠ å¯†çš„åŠ å¯†å’Œè§£å¯†äº’ä¸ºé€†è¿‡ç¨‹ï¼Œè§„åˆ™æ˜¯å›ºå®šçš„ï¼Œå­˜æ”¾åœ¨æœåŠ¡å™¨ç«¯æˆ–è€…å®¢æˆ·ç«¯ï¼Œè¿™ä¸ªåŠ å¯†ç®—æ³•ä¼ è¾“è¿‡ç¨‹ä¸­ä¹Ÿå®¹æ˜“è¢«è·å–ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯å¤ªå®‰å…¨ã€‚\n\n- éå¯¹ç§°åŠ å¯†\n\néå¯¹ç§°åŠ å¯†ä¼šè®¾ç½®ä¸€ä¸ªå…¬é’¥ï¼Œç”¨äºä¼ é€’ï¼›æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆ†åˆ«è®¾ç½®ä¸€ä¸ªç§é’¥ï¼Œè‡ªå·±ä¿å­˜ï¼ŒåŠ å¯†æ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. ç”¨æˆ·é€šè¿‡æœåŠ¡å™¨443ç«¯å£ä¸‹è½½å…¬é’¥ï¼Œå¹¶ä¼ é€’è‡ªå·±çš„å…¬é’¥ç»™æœåŠ¡å™¨ã€‚\n2. å†æ¬¡è¯·æ±‚æœåŠ¡å™¨ï¼Œç”¨**æœåŠ¡å…¬é’¥+å¯¹ç§°åŠ å¯†ç®—æ³•**æ¥åŠ å¯†æ˜æ–‡ï¼Œç”Ÿæˆå¯†æ–‡\n3. ä¼ é€’å¯†æ–‡ç»™æœåŠ¡å™¨\n4. æœåŠ¡ç«¯ç”¨**æœåŠ¡ç§é’¥+åŠ å¯†ç®—æ³•**è§£å¼€å¯†æ–‡ï¼Œå¾—åˆ°æ˜æ–‡\n5. ç±»ä¼¼çš„ï¼ŒæœåŠ¡ç«¯æ ¹æ®æ˜æ–‡è¯·æ±‚å’Œç”¨æˆ·ä¼ é€’çš„ç”¨æˆ·å…¬é’¥è¿›è¡Œå“åº”ï¼š**ç”¨æˆ·å…¬é’¥+ç®—æ³•çš„å¯†æ–‡**\n6. ç”¨æˆ·ç”¨**ç”¨æˆ·ç§é’¥+ç®—æ³•è§£å¯†**è·å–æ•°æ®\n\nå…¶ä¸­éœ€æ³¨æ„ï¼Œå…¬é’¥åŠ å¯†çš„æ•°æ®å…¬é’¥è‡ªå·±æ˜¯è§£ä¸å¼€çš„ï¼Œè€Œä¸”è¦ä¿è¯éƒ½æ˜¯å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ã€‚\n\nä½†æ˜¯ï¼Œå¦‚æœæœåŠ¡å™¨è¢«ä¼ªé€ äº†ï¼Œå…¬é’¥æ˜¯åäººç»™çš„ï¼Œé‚£ä½ çš„æ•°æ®åŠ å¯†å†å¥½ä¹Ÿæ²¡ç”¨äº†ï¼Œè¿™å°±æ˜¯ä¸­é—´äººæ”»å‡»ã€‚\n\n- TLS\n\nä¸ºäº†è§£å†³ä¸­é—´äººæ”»å‡»ï¼Œéœ€è¦å¯¹ä½¿ç”¨è€…è¿›è¡Œèº«ä»½è®¤è¯ï¼Œè¿™å°±å¼•å…¥äº†æ•°å­—è¯ä¹¦ã€‚å¸¸è§çš„æ–¹å¼æ˜¯æ‰¾ä¸€ä¸ªç¬¬ä¸‰æ–¹å…¬è®¤çš„å¥½äººï¼ˆCAï¼‰æ¥é¢å‘è¿™ä¸ªè¯ä¹¦æ¥è®¤è¯å…¬é’¥ã€‚\n\næœåŠ¡å™¨ä¼šç”³è¯·å…¬é’¥ç»™CAæ¥è·å–è¯ä¹¦ï¼ŒCAåˆ¤æ–­ä½ æ˜¯å¦æœ‰æ‰€è®¤è¯æœºæ„çš„ç®¡ç†æƒé™å’Œæ‹¥æœ‰æƒé™ï¼Œé€šè¿‡åé¢å‘æ•°å­—è¯ä¹¦ï¼ˆCAè‡ªå·±çš„ç§é’¥+åŠ å¯†ç®—æ³•ï¼‰ï¼›æœåŠ¡å™¨æ‹¿åˆ°è¯ä¹¦åï¼Œç»™ç”¨æˆ·ä¼ é€’çš„å°±æ˜¯è¿™ä¸ªè¯ä¹¦äº†ï¼Œç”¨æˆ·ç”¨CAå…¬é’¥è§£å¯†å‡ºæœåŠ¡å™¨å…¬é’¥æ¥ä½¿ç”¨ã€‚\n\næ­¤æ—¶ï¼Œä¸­é—´äººè·å–ä¸åˆ°CAçš„ç§é’¥ï¼Œæ‰€ä»¥ç”¨æˆ·ç«¯æµè§ˆå™¨å°±ä¸è®¤è¿™ä¸ªä¸­é—´äººï¼Œä»¥æ­¤è¾¾åˆ°é‰´ä¼ªã€‚ç”¨æˆ·åªè¦ä½¿ç”¨çš„æ˜¯æ­£ç‰ˆæ“ä½œç³»ç»Ÿå’Œæ­£è§„æµè§ˆå™¨ï¼Œå°±èƒ½ä¿è¯æ•°å­—è¯ä¹¦çš„è·å–ã€‚è¿™æœŸé—´ä½¿ç”¨äº† TLS ç®—æ³•ç”Ÿæˆäº†ä¸¤ç»„éšæœºæ•°ï¼Œé€šè¿‡éå¯¹ç§°åŠ å¯†ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¾¾æˆä¸€è‡´ï¼Œç”Ÿæˆäº†ä¸€ä¸ªåªæœ‰ä»–ä»¬è‡ªå·±çŸ¥é“çš„å¯¹ç§°åŠ å¯†è§„åˆ™ï¼Œæˆ‘è¿™é‡Œå€Ÿç”¨[bç«™](https://www.bilibili.com/video/BV1KY411x7Jp) æŠ€æœ¯è›‹è€å¸ˆçš„è§£é‡Šå›¾ï¼š\n\n\n![image.png](/img/posts/2023-3-18/2023-3-18-11.png)\n\nä¸Šå›¾çš„æ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. æœåŠ¡å™¨ç”Ÿæˆä¸€å¥—ç§é’¥å’Œå…¬é’¥\n2. å¯ä»¥å…ˆç”Ÿæˆä¸€ä¸ªéšæœºæ•°1ï¼Œå¹¶ä¼ ç»™æœåŠ¡ç«¯ï¼Œè¯·æ±‚å…¬é’¥\n3. æœåŠ¡ç«¯ç”Ÿæˆéšæœºæ•°2ï¼Œå¸¦ä¸Šå…¬é’¥ã€è¯ä¹¦ä¸€èµ·ç»™å®¢æˆ·ç«¯\n4. ç°åœ¨å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ã€é»‘å®¢éƒ½çŸ¥é“äº†å…¬é’¥ã€éšæœºæ•°1å’Œéšæœºæ•°2\n5. å®¢æˆ·ç«¯ç”Ÿæˆéšæœºæ•°3ï¼Œç»“åˆå…¬é’¥åŠ å¯†åç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯é€šè¿‡ç§é’¥è§£å¯†åå¾—åˆ°æ˜æ–‡\n6. å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å„è‡ªé€šè¿‡ éšæœºæ•°1/2/3ç”Ÿæˆä¸€ä¸ªä¼šè¯ç§˜é’¥ï¼Œè¿™ä¸ªä¼šè¯ç§˜é’¥å°±æ˜¯å¯¹ç§°åŠ å¯†çš„ç§˜é’¥ï¼Œä¸”ä¸åœ¨ç½‘ç»œä¸Šä¼ é€’ã€‚\n7. æ¥ä¸‹æ¥å°±æ˜¯å¯¹ç§°åŠ é€šä¿¡ç¯èŠ‚ï¼Œè€Œé»‘å®¢ç›®å‰åªçŸ¥é“å…¬é’¥ã€éšæœºæ•°1å’Œéšæœºæ•°2ï¼Œæ— æ³•ç ´è§£é€šä¿¡ã€‚\n\n\nè¿™é‡Œè®²ä¸€ä¸‹ nginx å¦‚ä½•é…ç½® httpsã€‚ä½ éœ€è¦æœ‰ä¸€ä¸ªæœåŠ¡çš„å…¬ç½‘ipï¼ˆå‡è®¾ 123.456.789.111ï¼‰å’Œè´­ä¹°çš„åŸŸåï¼ˆå‡è®¾ www.abc.com ï¼‰å¹¶ç”³è¯·å¥½äº†åŸŸåè§£æå’Œæ•°å­—è¯ä¹¦ï¼ˆ.key å’Œ .pem æ–‡ä»¶ï¼‰:\n\n```json\nserver {\n    listen 443 ssl;\n    server_name localhost;  // åŸŸåå·²ç»å’Œipç»‘å®šï¼Œå†™ localhostä¹Ÿæ˜¯èƒ½è§£æçš„\n    ssl_certificate xxxx.pem;\n    ssl_certificate_key xxxx.key;\n    underscores_in_headers on; // å…è®¸è¯·æ±‚å¤´å‡ºç°ä¸‹åˆ’çº¿\n    root html;\n}\n```\n\n\n## 11. å˜é‡çš„ä½¿ç”¨\n\nè·Ÿå…¶ä»–æŠ€æœ¯çš„é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œnginx ä¹Ÿèƒ½ä½¿ç”¨å˜é‡ï¼š\n\n```json\nlocation / { \n    set $name \"zhangsan\"; \n    return 200 \"$name\"; \n}\n```\n\nä¸Šé¢å°±è®¾ç½®äº†ä¸€ä¸ªå˜é‡å« nameï¼Œå¹¶ä¸”ç›´æ¥è¿”å› 200 çš„è¯·æ±‚ï¼Œåœ¨é¡µé¢ä¸Šæ˜¾ç¤º name çš„å€¼ã€‚å…¶æ ¼å¼æ˜¯ï¼š\n\n```sh\nset $å˜é‡å å˜é‡å€¼\n```\n\nå½“ç„¶äº†ï¼Œnginx ä¹Ÿè‡ªå¸¦äº†ä¸€äº›å˜é‡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼š\n\n- `$request`  å®Œæ•´çš„åŸå§‹çš„è¯·æ±‚è¡Œï¼Œä¾‹å¦‚ï¼šGET /nginx/index?a=1\u0026b=2 HTTP/1.1\n- `$request_uri`  å®Œæ•´çš„åŸå§‹è¯·æ±‚URIï¼Œè®¿é—®çš„URLé™¤å»åŸŸå(æˆ–IP)å’Œ port, å¦‚: /nginx/index?a=1\u0026b=2\n- `$args` è¯·æ±‚è¡Œä¸­çš„å…¨éƒ¨å‚æ•° ä¾‹å¦‚ï¼ša=1\u0026b=2\n- `$remote_addr` å®¢æˆ·ç«¯ipåœ°å€\n- `$remote_port` å®¢æˆ·ç«¯ç«¯å£\n\n...\n\nnginx é…ç½®æ–‡ä»¶çš„å˜é‡å¯ä»¥ç»Ÿä¸€è®¾ç½®åœ¨æ–‡ä»¶çš„é¡¶éƒ¨ï¼Œè¿™æ ·åœ¨æ•´ä¸ªæ–‡ä»¶ä¸­éƒ½å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªå˜é‡ï¼š\n\n```sh\nset $my_var \"hello\";\n```\n\nå¼•ç”³ï¼šå˜é‡å€¼çš„è®¡ç®—\n\n```json\nlocation / { \n    set $my_var 10; \n    add_header X-Test $my_var; // æˆåŠŸå“åº”æ—¶ï¼Œæ·»åŠ å“åº”å¤´\n    add_header X-Total $my_var*2; \n}\n```\nä¸Šé¢çš„ä¾‹å­å°±æ˜¯å˜é‡ç®€å•çš„æ•°å€¼è®¡ç®—ã€‚\n\n\n## 12. ä¸šåŠ¡åœºæ™¯æ¡ˆä¾‹\n\n### æ¡ˆä¾‹ä¸€\n\n- **é¡¹ç›®ä»‹ç»**ï¼šå‰ç«¯å¾®æœåŠ¡é¡¹ç›®\n- **éœ€æ±‚**ï¼šå„ä¸ªå­æœåŠ¡çš„éƒ¨ç½²ï¼Œéœ€è¦æ ¹æ®ç°åº¦ç³»ç»Ÿä¼ é€’è¿‡æ¥çš„é™æ€èµ„æºç›®å½•åœ°å€æ¥åŠ¨æ€åˆ‡æ¢è½¬å‘åœ°å€\n- **ä¸šåŠ¡ä»‹ç»**ï¼šè¿™æ˜¯æˆ‘å‚ä¸çš„ä¸€ä¸ªå‰ç«¯ä¸šåŠ¡åœºæ™¯ï¼Œè®¿é—®å¾®æœåŠ¡å­åº”ç”¨æ—¶ï¼Œå¾®æœåŠ¡å¯åŠ¨å™¨ä¼šè°ƒç”¨ç°åº¦ç³»ç»Ÿæ¥å£è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„äº§å“æƒé™åˆ—è¡¨ï¼Œå¹¶è¿”å›ç»™å‰ç«¯æ‰“åŒ…å¥½çš„å‰ç«¯é¡µé¢é™æ€èµ„æºåœ°å€ã€‚è¿™ä¸ªåœ°å€ä¼šæ ¹æ®ç”¨æˆ·æƒé™å’Œç°åº¦ç­–ç•¥å˜åŒ–ã€‚\n\nç°åœ¨æœ‰ä¸Šé¢ä¸€ä¸ªå·¥ä½œï¼Œéœ€è¦é…ç½®nginxæ¥å®ŒæˆåŠ¨æ€è½¬å‘çš„å·¥ä½œï¼Œè®©ç”¨æˆ·çœ‹åˆ°ä¸åŒç‰ˆæœ¬çš„å‰ç«¯é¡¹ç›®ã€‚\n\n#### è§£æ\n\nå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå˜é‡æ¥æ ‡è¯†èµ„æºåœ°å€ï¼Œåœ¨å‰ç«¯æœåŠ¡buildçš„CIä¸­ä¿®æ”¹è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ›´æ”¹å˜é‡å€¼ã€‚\n\nä¸€ä¸ªç¤ºä¾‹ï¼š\n\n```json\nset $uri \"/root/web/vue/dist\";\n\nserver {\n    listen       80;  \n    server_name  www.test.com;  \n    location / {  \n        root   $uri; \n        index  index.html index.htm;\n    }\n}\n```\n\nåœ¨ CI ä¸­ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼šset $uri \"/root/web/react/dist\"ï¼Œé‡å¯ nginx åå³å¯ã€‚\n\n\u003e å¤§å®¶æœ‰æ›´å¥½çš„åŠæ³•çš„è¯ï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºè®¨è®ºå“¦\n\n### æ¡ˆä¾‹äºŒ\n\n- **ä½¿ç”¨åœºæ™¯**ï¼šåœ¨å‰ç«¯é¡¹ç›®éƒ¨ç½²æ–°ç‰ˆæœ¬åï¼Œç”¨æˆ·æ²¡åŠæ³•æ„ŸçŸ¥åˆ·æ–°ï¼Œåœ¨ä¸å¼ºåˆ¶åˆ·æ–°çš„å‰æä¸‹ï¼Œçœ‹åˆ°çš„ä»ç„¶æ˜¯æ—§ç‰ˆæœ¬ã€‚\n- **éœ€æ±‚**ï¼šéœ€è¦è®¾ç½®æœåŠ¡å™¨é…ç½®ï¼Œåœ¨å‰åç«¯ç‰ˆæœ¬ä¸ä¸€è‡´æ—¶å¼ºåˆ¶åˆ·æ–°\n\n#### è§£æ\n\nè¿™ä¸ªé—®é¢˜æœ‰å¤šç§è§£å†³æ–¹å¼ã€‚\n\nå¯ä»¥é…ç½® nginxï¼Œé«˜é€Ÿæµè§ˆå™¨ä¸è¦ç¼“å­˜ï¼š\n\n```json\nlocation / {\n    add_header Cache-Control \"no-cache, must-revalidate\"\n}\n```\n\næˆ–è€…é…ç½®å¼ºåˆ¶æµè§ˆå™¨ç¼“å­˜ï¼Œå¸¸ç”¨çš„åŠæ³•æ˜¯æ·»åŠ hashæˆ–è€…ç‰ˆæœ¬å·æ¥è®©æµè§ˆå™¨é‡æ–°ä¸‹è½½èµ„æºï¼š\n\n```js\n\u003clink rel=\"stylesheet\" href=\"/css/main.css?version=v2\"\n```"])</script><script>self.__next_f.push([1,"33:T1f5a,"])</script><script>self.__next_f.push([1,"ä¸Šä¸€èŠ‚è®²äº†å¦‚ä½•åœ¨ CentOS ä¸Šå®‰è£… gitlabï¼Œæœ¬èŠ‚è®²ä¸€ä¸‹å¦‚ä½•å®ç° gitlab CI/CDã€‚\n\n## 1. å®‰è£…é…ç½® gitlab-runner\n\næ‰§è¡ŒæŒ‡ä»¤\n\n```shell\nmwget https://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/yum/el7/gitlab-runner-11.5.1-1.x86_64.rpm\n```\n\nå®‰è£…\n\n```shell\nrpm -i gitlab-runner-11.5.1-1.x86_64.rpm\n```\n\næŸ¥çœ‹ç‰ˆæœ¬\n\n```shell\ngitlab-runner -v\n```\n\n![image.png](/img/posts/2023-1-1/2023-1-1-1.png)\n\næ³¨å†Œï¼š\n`gitlab-runner register`ï¼Œ\nä¼šæç¤ºè¾“å…¥URLï¼Œ\n\n![image.png](/img/posts/2023-1-1/2023-1-1-2.png)\n\nè¿™ä¸ªåœ¨ä»“åº“çš„é…ç½®çš„ Runners é‡Œå¯ä»¥æŸ¥åˆ°\n\n![image.png](/img/posts/2023-1-1/2023-1-1-3.png)\n\næ¥ä¸‹æ¥æç¤ºè¾“å…¥ gitlab-ci tokenï¼Œé…ç½®é‡Œç´§æŒ¨ç€åˆšæ‰çš„URLçš„å°±æ˜¯Tokenï¼Œç²˜è´´è¿‡å»å›è½¦å°±å¯ä»¥å•¦ã€‚\n\nä¸€è·¯æŒ‰ç…§æç¤ºè¾“å…¥å°±è¡Œï¼Œè¾“å…¥tagä¸º  test-deployï¼Œæœ€åä¼šæç¤ºé€‰æ‹©å“ªç§æ‰§è¡Œå™¨ executorï¼š\n\n![image.png](/img/posts/2023-1-1/2023-1-1-4.png)\n\nçœ‹ä½ ç†Ÿæ‚‰å“ªä¸ªå•¦ï¼Œè¿™é‡Œä»¥ shellä¸ºä¾‹ã€‚\n\né…ç½®å¥½åï¼Œéœ€è¦å°†gitlabÂ æ ¡éªŒä¸€ä¸‹\n\n![image.png](/img/posts/2023-1-1/2023-1-1-5.png)\n\nåœ¨webé¡µé¢æŸ¥çœ‹ä¸€ä¸‹ runnersé…ç½®ï¼Œåˆšåˆšçš„æ³¨å†Œrunnerå·²ç»å­˜åœ¨å•¦ï¼š\n\n\n![image.png](/img/posts/2023-1-1/2023-1-1-6.png)\n\nç‚¹å‡»ç¼–è¾‘æŒ‰é’®è¿›å…¥runnerç¼–è¾‘ï¼š\n\n![image.png](/img/posts/2023-1-1/2023-1-1-7.png)\nå‹¾ä¸Šå›¾ä¸­æ‰€ç¤ºé€‰é¡¹è®©æ²¡æœ‰æ‰“æ ‡ç­¾çš„é¡¹ç›®ä¹Ÿèƒ½ä½¿ç”¨ã€‚æˆ‘è¿™é‡Œ æ‰“äº† test-deploy çš„æ ‡ç­¾ã€‚åŒä¸€ä¸ªæ ‡ç­¾çš„ CI ç”¨çš„æ˜¯ä¸€ä¸ª Runnerã€‚\n\n## 2. é¡¹ç›®buildä¸Nginxéƒ¨ç½²\n\nå…ˆä¸ä½¿ç”¨gitlabæµæ°´çº¿ï¼Œè‡ªå·±å®ç°ä¸€ä¸‹è¯¥é¡¹ç›®çš„buildä¸nginxéƒ¨ç½²ã€‚\n\næœ¬æ–‡å‡†å¤‡çš„é¡¹ç›®å°±æ˜¯ä¸€ä¸ªviteåˆ›å»ºçš„ vue3 ç©ºé¡¹ç›®ï¼š\n\n![image.png](/img/posts/2023-1-1/2023-1-1-8.png)\n\næŸ¥çœ‹ä»–çš„ package.jsonï¼š\n\n```json\n\"scripts\": {\n    \"dev\": \"vite\",\n    \"build\": \"vite build\",\n    \"preview\": \"vite preview\"\n}\n```\n\næ‰§è¡Œï¼š\n\n```shell\nyarn build\n```\nå¯ä»¥çœ‹åˆ°æ‰“åŒ…æ–‡ä»¶å·²ç»ç”Ÿæˆäº†ï¼š\n\n![image.png](/img/posts/2023-1-1/2023-1-1-9.png)\n\næ¥ä¸‹æ¥å°±æ˜¯åœ¨ æœåŠ¡å™¨ï¼ˆè¿˜ä»¥è¿™ä¸ªCentOSè™šæ‹Ÿæœºä¸ºä¾‹ï¼‰ä¸Šå®‰è£…ä¸€ä¸‹ Nginxï¼ŒæŠŠæ‰“åŒ…çš„æ–‡ä»¶ä¸¢è¿›å»å°±å¯ä»¥äº†ã€‚\n\n### Nginx å®‰è£…\n\n- å‰ç½®ä¾èµ–å®‰è£…\n\n```shell\nyum -y install gcc gcc-c++ autoconf pcre-devel zlib-devel openssl openssl-devel make automake\nyum -y install httpd vim\n```\n\n- å®‰è£… Nginx\n\n```shell\n## ç”¨æˆ·ç›®å½•ä¸‹ï¼Œä¸‹è½½å…å®‰è£…ç‰ˆ (ä¹Ÿå¯ä»¥ç”¨ yum)\ncd ~\nmwget http://nginx.org/download/nginx-1.18.0.tar.gz\n\n## è§£å‹ç¼©\ntar zxvf nginx-1.18.0.tar.gz\n\n## è¿›å…¥å®‰è£…ç›®å½• ï¼ˆä½ åœ¨å“ªé‡Œè§£å‹ç¼©çš„ï¼Œæ–‡ä»¶å°±åœ¨å“ªï¼‰\n## é…ç½®å®‰è£…è¿è¡Œç›®å½•\n./configure --prefix=/usr/local/nginx\n\n## ç¼–è¯‘å®‰è£…\nmake \u0026\u0026 make install\n\n## é…ç½®ç¯å¢ƒå˜é‡ ï¼ˆæˆ‘è¿™é‡Œåªé…ç½®ç”¨æˆ·çº§åˆ«ï¼‰\n## åœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹\nvim .bash_profile\n\n## è¿½åŠ \nPATH=$PATH:$HOME/bin:/usr/local/nginx/sbin\n\n## ä¿å­˜é€€å‡ºåç”Ÿæ•ˆé…ç½®\nsource ./.bash_profile\n```\n\næ­¤æ—¶åœ¨ä»»æ„ç›®å½•ä¸‹æ‰§è¡Œï¼š\n\n```shell\nnginx -v\n```\nä¾¿å¯ä»¥çœ‹åˆ°æ‰“å°çš„ç‰ˆæœ¬å·äº†ã€‚\n\n![image.png](/img/posts/2023-1-1/2023-1-1-10.png)\n\n### å¯åŠ¨Nginx\n\n```shell\nå®‰è£…å®Œæ¯•ï¼Œè¿›å…¥Nginxä¸‹çš„sbinç›®å½•å¹¶å¯åŠ¨nginx\ncd /usr/local/nginx/sbin\n./nginx\n```\n\n\n### é…ç½® Nginx\n\n\u003e è¿™é‡Œè®² Nginx åªæ˜¯ä¸ºäº†è¾…åŠ© CI/CD è®²è§£ï¼Œé…ç½®è¯¦ç»†ä¸åšè¿‡å¤šå±•å¼€\n\nè‹¥æ˜¯ yum å®‰è£…çš„ï¼Œé…ç½®æ–‡ä»¶åœ¨ `/etc/nginx/nginx.conf` ä¸­ï¼Œæˆ‘è¿™ä¸ªæ˜¯å…å®‰è£…ç‰ˆçš„ï¼Œé…ç½®æ–‡ä»¶åœ¨ `/usr/local/nginx` ä¸­ï¼š\n\n```shell\nvi /usr/local/nginx/conf/nginx.conf\n```\næŒ‰ç…§è‡ªå·±çš„å–œå¥½é…ç½®ï¼Œæ‰¾å¯¹æ–‡ä»¶ç›®å½•å³å¯ï¼ˆå»ºè®®å•å¼€ä¸€ä¸ªå…¨å±€ç›®å½•ï¼‰ï¼š\n\n\n![image.png](/img/posts/2023-1-1/2023-1-1-11.png)\n\næˆ‘ä»¬æŠŠ é¡¹ç›® dist ç›®å½•æ”¾å…¥å¯¹åº”é…ç½®çš„ä½ç½®ï¼ˆå»ºè®®ä¸è¦åœ¨è‡ªå®šä¹‰çš„ç”¨æˆ·ä¸‹ï¼Œä¸ç„¶ CI ä½¿ç”¨çš„è´¦æˆ· ä¼šæ‹¿ä¸åˆ°ï¼‰ï¼š\n\n\n![image.png](/img/posts/2023-1-1/2023-1-1-12.png)\n\næŒ‰ç…§ä¸Šä¸€èŠ‚çš„è®²è§£ï¼Œé…ç½®äº†é˜²ç«å¢™å’Œè™šæ‹ŸæœºNATé…ç½®ï¼Œå¼€é€š 10087 ç«¯å£åï¼Œåœ¨ windowsä¸­è®¿é—®è™šæ‹Ÿæœºè¿™ä¸ªç«¯å£ http://192.168.137.128:10087\n\n\n![image.png](/img/posts/2023-1-1/2023-1-1-13.png)\næˆåŠŸï¼\n\n## 3. é…ç½®CI\n\nåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º .gitlab-ci.yml æ–‡ä»¶æ¥ç¼–å†™æ‰§è¡Œæµç¨‹ã€‚\n\nåœ¨ç¼–å†™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¸…æ¥šä¸€ä¸ªäº‹æƒ…ï¼ŒCI/CD æ‰€è¦å®Œæˆçš„å·¥ä½œå°±æ˜¯ä¸Šè¾¹æˆ‘ä»¬æ‰‹åŠ¨ build å®Œä»¥åï¼Œå†æŠŠ dist ç›®å½•ç§»åŠ¨åˆ° nginx é…ç½®çš„ç›®å½•ä¸‹å¹¶ä¸”é‡å¯ Nginxï¼Œåªæ˜¯å˜æˆäº†æµæ°´çº¿è‡ªåŠ¨åŒ–éƒ¨ç½²è€Œå·²ï¼Œçœå»äº†ç¹æ‚çš„éƒ¨ç½²å·¥ä½œã€‚\n\nç¡®å®šæµæ°´çº¿åˆ†ä¸¤æ­¥ï¼šæ‰“åŒ… å’Œ éƒ¨ç½²ï¼š\n\n```yaml\nstages:\n  - build\n  - deploy\n```\n\næµæ°´çº¿æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Œæ•…runneråªç”¨ä¸€ä¸ªå°±å¯ä»¥ï¼Œyml ä¸­ tags è®¾ç½®ä¸ºåŒä¸€ä¸ªå°±è¡Œã€‚\n\næˆ‘ä»¬å†™ä¸€äº› build çš„è„šæœ¬æµ‹è¯•ï¼š\n\n```yaml\nbuild:\n  stage: build\n  tags:\n    - test-deploy\n  only:\n    - master\n  script:\n    - pwd \u0026\u0026 ls -al\n    - npm install --registry https://registry.npm.taobao.org \u0026\u0026 npm run build\n    - cd $CI_PROJECT_DIR \u0026\u0026 ls\n    - cp -r ./dist /home/gitlab-runner/web/backup/ \n  cache:\n    paths:\n      - node_modules/\n```\n\n\u003e æœ€åçš„ cp æ˜¯ä¸ºäº†åœ¨ deploy èƒ½æ‹¿åˆ° build çš„æ–‡ä»¶ã€‚cp çš„æ—¶å€™åˆ«å¿˜äº†ç»™æ–‡ä»¶å¤¹æƒé™\n\næ¨é€åˆ° master åå‘ç° CI æŒ‚äº†ï¼š\n\n\n![image.png](/img/posts/2023-1-1/2023-1-1-14.png)\n\nåŸæ¥æ˜¯ runner ç¯å¢ƒé‡Œæ²¡æœ‰nodeç¯å¢ƒï¼Œé€šè¿‡å¦‚ä¸‹è„šæœ¬æ¥çœ‹çœ‹runnerçš„æ‰§è¡Œä½ç½®ï¼š\n\n```yaml\nbefore_script:\n    - whoami\n    - pwd\n    - locate npm\n    - echo ${PATH}\n    - node -v\n ```\n \næ‰“å°ç»“æœï¼š\n\n![image.png](/img/posts/2023-1-1/2023-1-1-15.png)\n\nå¯ä»¥çœ‹åˆ°ï¼ŒPATH é‡Œæ˜¯æœ‰æˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸Šé…ç½®çš„ node çš„å…¨å±€å˜é‡çš„ï¼Œä½†æ˜¯è¿™é‡Œè¯»ä¸åˆ°ã€‚åº”è¯¥æ˜¯æœåŠ¡å™¨ç™»å½•è´¦æˆ·ä¸åŒé€ æˆçš„ã€‚\n\n\n![image.png](/img/posts/2023-1-1/2023-1-1-16.png)\n\næº node æˆ‘æ˜¯é…ç½®åœ¨ root ä¸‹çš„å…¨å±€å˜é‡ï¼Œè€Œ CI æ˜¯è·‘åœ¨è‡ªåŠ¨åˆ›å»ºçš„ gitlab-runner è´¦æˆ·ä¸‹çš„ï¼Œæ­¤æ—¶åªè¦åœ¨runnerè´¦æˆ·ä¸‹å†å®‰è£…ä¸€æ¬¡ï¼Œé…ç½®å¥½ç¯å¢ƒå˜é‡å°±æå®šå•¦ã€‚å†æµ‹è¯•ä¸€ä¸‹ï¼š\n\n\n![image.png](/img/posts/2023-1-1/2023-1-1-17.png)\n\nå¯ä»¥çœ‹åˆ° node å·²ç»æ‹¿åˆ°ï¼Œç›´æ¥ä¸Š buildï¼š\n\n\n![image.png](/img/posts/2023-1-1/2023-1-1-18.png)\n\nå¯ä»¥çœ‹åˆ° npm build æˆåŠŸå•¦ï¼Œé‚£ä¹ˆæ‰“å®ŒåŒ…çš„ dist è¦å¦‚ä½•éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šå‘¢ï¼Ÿ\n\n## 4. é…ç½®CD\n\né¦–å…ˆè¿›å…¥æŸ¥çœ‹ä¸€ä¸‹ ä¸Šä¸€æ­¥ cp çš„å…¬å…±ç›®å½•ï¼š\n\n\n![image.png](/img/posts/2023-1-1/2023-1-1-19.png)\n\nå¯ä»¥çœ‹åˆ°å·²ç»æœ‰å•¦ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ deploy é˜¶æ®µå¤„ç†è¿™äº›æ–‡ä»¶äº†ã€‚\n\nå¤ä¹ ä¸€ä¸‹ä¸Šä¸€èŠ‚ï¼ŒNginx éƒ¨ç½²ç›®å½•æ˜¯ï¼š/root/web/distï¼Œæˆ‘ä»¬è¯•ç€ cp ä¸€ä¸‹ï¼š\n\n```yaml\ndeploy:\n  stage: deploy\n  tags:\n    - test-deploy\n  only:\n    - master\n  script:\n    - echo \"deploy\"\n    - pwd \u0026\u0026 ls -al\n    - cp -r /home/gitlab-runner/web/backup/dist /root/web/dist\n```\n\nå‘ç°è¯»å–ä¸äº† root ä¸‹çš„ç›®å½•ï¼š\n\n\n![image.png](/img/posts/2023-1-1/2023-1-1-20.png)\n\næ‰€ä»¥æ”¹è¿›ä¸€ä¸‹ Nginx éƒ¨ç½²ç›®å½•ï¼š\n\n\n![image.png](/img/posts/2023-1-1/2023-1-1-21.png)\n\nä¿®æ”¹ deployï¼š\n```yaml\n- cp -r /home/gitlab-runner/web/backup/dist /home/gitlab-runner/web/\n```\n\næ­¤æ—¶ 10087 ç«¯å£å·²ç»è·‘ä¸èµ·æ¥äº†ã€‚æˆ‘ä»¬æäº¤ä¸€ä¸‹ CI å†è·‘ä¸€æ¬¡ï¼š\n\n\n![image.png](/img/posts/2023-1-1/2023-1-1-22.png)\n\næˆåŠŸå¤åˆ¶è¿‡å»äº†ã€‚\n\næ­¤æ—¶åœ¨ windowsä¸‹å†çœ‹çœ‹ï¼š\n\n\n![image.png](/img/posts/2023-1-1/2023-1-1-23.png)\n\næˆåŠŸï¼\n\næˆ‘ä»¬æ”¹åŠ¨ä¸€ä¸‹ä»£ç æäº¤æµ‹è¯•ä¸€ä¸‹ï¼š\n\n\n![image.png](/img/posts/2023-1-1/2023-1-1-24.png)\n\npush åˆ° master ä¸Šï¼Œç­‰ CI/CD è·‘å®Œååˆ·æ–°ç½‘é¡µï¼š\n\n\n![image.png](/img/posts/2023-1-1/2023-1-1-25.png)\n\nè‡ªåŠ¨åŒ–éƒ¨ç½²å®Œæˆï¼ï¼\n\n## 5. å°ç»“\n\n1. å®‰è£… runner\n2. é…ç½® nginx\n3. ä¹¦å†™ .gitlab-ci.yml\n\n```yaml\nstages:\n  - build\n  - deploy\n\nbuild:\n  stage: build\n  tags:\n    - test-deploy\n  only:\n    - master\n  before_script:\n    - whoami\n    - pwd\n    - echo ${PATH}\n    - node -v\n  script:\n    - pwd \u0026\u0026 ls -al\n    - npm install --registry https://registry.npm.taobao.org \u0026\u0026 npm run build\n    - cd $CI_PROJECT_DIR \u0026\u0026 ls\n    - cp -r ./dist /home/gitlab-runner/web/backup/\n  cache:\n    paths:\n      - node_modules/\n\ndeploy:\n  stage: deploy\n  tags:\n    - test-deploy\n  only:\n    - master\n  script:\n    - echo \"deploy\"\n    - pwd \u0026\u0026 ls -al\n    - cp -r /home/gitlab-runner/web/backup/dist /home/gitlab-runner/web/\n```\n\n4. éƒ¨ç½²ç›®å½•æ£€æŸ¥ä¸æµ‹è¯•ä»£ç "])</script><script>self.__next_f.push([1,"34:T190d,"])</script><script>self.__next_f.push([1,"ä¹‹å‰ä¸€ç›´æ¯”è¾ƒå¿Œè®³åœ¨å‰ç«¯é¡¹ç›®ä¸­ä½¿ç”¨å…¨å±€çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œå®‰è£…åŒ…æ¯”è¾ƒå¤§ï¼Œé…ç½®èµ·æ¥æ¯”è¾ƒç¹çï¼Œæ¯”å¦‚ Reduxã€‚ä½†æ˜¯éšç€é¡¹ç›®ä¸šåŠ¡çš„å¢å¤šï¼Œä¸€äº›çŠ¶æ€å¾ˆéš¾åšåˆ°ç»„ä»¶é—´å…±äº«ï¼Œæ¯”å¦‚ç™»å½•çŠ¶æ€. é€šçŸ¥æ¶ˆæ¯ç­‰ã€‚\n\n\n## 1. å‰ç«¯çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ\n\nä¸‹é¢æ¥å¯¹æ¯”ä¸€ä¸‹ å‰ç«¯é¡¹ç›®ä¸­å…¨å±€çŠ¶æ€ç®¡ç†çš„å‡ ç§æ–¹å¼ã€‚\n\n1. localStorage / sessionStorage\n\n2. cookie\n\n3. Context å…¨å±€ä¸Šä¸‹æ–‡\n\n4. çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œæ¯”å¦‚ Redux. Piniaç­‰\n\n\n### 1. localStorage\n\nå…ˆè¯´ç¬¬ä¸€ç§ï¼Œå¯ä»¥å­˜åœ¨æµè§ˆå™¨æœ¬åœ°çš„ä¸€ç§å­˜å‚¨æ–¹å¼ã€‚ç¡®å®é¡¹ç›®ä¸­ç»å¸¸åœ¨ç”¨ï¼š\n\n```js\nexport function setLocalStorage(key, value) {\n    try {\n        window.localStorage.setItem(key, JSON.stringify(value));\n    } catch (e) {\n        console.log(e.message)\n    }\n}\n\nexport function getLocalStorage(key) {\n    const value = window.localStorage.getItem(key);\n    try {\n        return JSON.parse(value);\n    } catch (e) {\n        return value;\n    }\n}\n```\n\n- ä¼˜åŠ¿\n    1. èƒ½å¤Ÿé•¿æœŸå‚¨å­˜æ•°æ®\n    2. åŒä¸€ä¸ªåŸŸä¸‹å…±äº«åŒä¸€ä¸ªå¯¹è±¡\n    3. ä¸ä¼šéš HTTP è¯·æ±‚å‘é€\n    4. é¡µé¢çº§åˆ«ä½¿ç”¨\n- ç¼ºç‚¹\n    1. ä¸åŒçš„æµè§ˆå™¨çª—å£ä¸‹ï¼Œä¿¡æ¯ä¼šç›¸äº’å¹²æ‰°\n    2. åœ¨æµè§ˆå™¨çš„éšç§æ¨¡å¼ä¸‹ä¸å¯ä»¥è¯»å–\n    3. ç”±äºæœåŠ¡å…³é—­åä¿¡æ¯è¿˜èƒ½å­˜åœ¨åœ¨æµè§ˆå™¨ç¼“å­˜ä¸­ï¼Œæ•…ä¸é€‚å®œå­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚ç™»å½•ä¿¡æ¯ç­‰\n    4. ç”±äºä½¿ç”¨äº† window å¯¹è±¡ï¼Œéæµè§ˆå™¨ç¯å¢ƒä¸å¯ä½¿ç”¨\n    5. æ— æ³•å“åº”å¼è§¦å‘æ‰€æœ‰ç»„ä»¶åŒæ­¥æ›´æ–°çŠ¶æ€ï¼ˆè¿™ä¹Ÿæ˜¯reduxå­˜åœ¨çš„æ„ä¹‰ï¼‰\n- å»ºè®®\n   - å­˜å‚¨å¸¸ç”¨çš„ä¸‹æ‹‰èœå•é€‰æ‹©é¡¹. å…¬ç”¨åˆ—è¡¨. æšä¸¾ç­‰ã€‚\n\n\n### 2. Cookie\n\n- ä¼˜åŠ¿\n    1. å¯ä»¥å‰åç«¯å…±äº«\n    2. åŒä¸€ä¸ªåŸŸä¸‹å…±äº«åŒä¸€ä¸ªå¯¹è±¡\n- ç¼ºç‚¹\n    1. é™åˆ¶å¤§å°4Kï¼Œåªèƒ½å­˜ä¸€äº›å…¬å…±å˜é‡ï¼Œä½¿ç”¨åœºæ™¯ä¸é€‚åˆç”¨äºç¼“å­˜\n    2. å­˜åœ¨é¢å¤–çš„å®‰å…¨é…ç½®æˆæœ¬\n    3. è·¨åŸŸå­˜åœ¨é—®é¢˜ï¼Œéœ€è¦é¢å¤–çš„é…ç½®æˆæœ¬\n    4. ä¸å¤Ÿçµæ´»ï¼Œä¸èƒ½é€‚åº”è¶Šæ¥è¶Šå¤šçš„å…¨å±€çŠ¶æ€çš„æ·»åŠ \n\n### 3. Context\n\nContext ä¼ é€’ä¿¡æ¯æ˜¯ç»„ä»¶çº§åˆ«çš„ï¼Œå¾€å¾€åŒ…è£¹åœ¨éœ€è¦å…±äº«å‚æ•°çš„ç»„ä»¶é›†åˆçš„æœ€å¤–å±‚ï¼š\n\n```js\nconst BasicContext = React.createContext({});\n\n\u003cBasicContext.Provider value={{ ...context, ...systemStore }} \u003e\n    ...\n\u003c/BasicContext.Provider\u003e\n```\n\nContext ä¸äº§ç”Ÿæ•°æ®æ¥æºï¼Œå¾€å¾€å’Œç¼“å­˜ä¸€èµ·ä½¿ç”¨ï¼Œæ¯”å¦‚ systemStore å¯ä»¥æ˜¯ getLocalStorage æ‹¿åˆ°çš„ä¸€å †æ•°æ®çš„é›†åˆï¼Œè¢«ä»–åŒ…è£¹çš„å­å…ƒç´ ä¾¿éƒ½å¯ä»¥å…±äº«åŒä¸€ä»½ä¸Šä¸‹æ–‡æ•°æ®ã€‚\n\n- ä¼˜åŠ¿\n    1. ä½¿ç”¨ç®€å•ï¼Œä¸éœ€è¦é¢å¤–é…ç½®\n    2. ç»„ä»¶çº§åˆ«ä½¿ç”¨\n- ç¼ºç‚¹\n    1. åªæä¾›ä¸€ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¿…é¡»å’Œå…¶ä»–çš„çŠ¶æ€ç®¡ç†å·¥å…·ä¸€èµ·ä½¿ç”¨\n    2. å—æ¡†æ¶é™åˆ¶\n    3. contextç›¸å½“äºå…¨å±€å˜é‡ï¼Œ éš¾ä»¥è¿½æº¯æ•°æ®æº\n    4. è€¦åˆåº¦é«˜ï¼Œå³ä¸åˆ©äºç»„ä»¶å¤ç”¨ä¹Ÿä¸åˆ©äºæµ‹è¯•\n    5. æ²¡åŠæ³•åå‘ä¿®æ”¹çŠ¶æ€å€¼ï¼Œå­ç»„ä»¶åªèƒ½è¢«åŠ¨è¯»å–\n\n### Mobx\n\nä½¿ç”¨æ¡†æ¶çº§åˆ«çš„çŠ¶æ€ç®¡ç†å·¥å…·å¯ä»¥ç”¨æ¥å­˜å‚¨ä¸´æ—¶çš„å‰ç«¯å±‚çº§çš„å…¬å…±çŠ¶æ€ï¼š\n\n\n- ä¼˜åŠ¿\n    1. ä¾¿äºä»£ç ç®¡ç†\n    2. ç»„ä»¶çº§åˆ«ä½¿ç”¨\n    3. è¯»å†™æ–¹ä¾¿ï¼Œæ²¡æœ‰å®‰å…¨é—®é¢˜\n- ç¼ºç‚¹\n    1. å—æ¡†æ¶é™åˆ¶\n    2. éœ€è¦é¢å¤–çš„é…ç½®\n    3. ä¸šåŠ¡è€¦åˆåº¦é«˜ï¼Œç”¨æˆ·å†™ä¸šåŠ¡å¿…é¡»ç…§é¡¾åˆ°çŠ¶æ€çš„é…ç½®\n    4. ...\n\nMobx æ˜¯ä¸€ç§ç›¸å¯¹èƒ½å¤Ÿå…‹æœé…ç½®ç¹çé—®é¢˜çš„å·¥å…·ï¼Œè¿™æ¬¡åœ¨é¡¹ç›®å¼€å‘ä¸­å°±å¼•å…¥äº† Mobxï¼Œä½¿ç”¨å“åº”å¼+å‡½æ•°å¼æ¨¡å¼ï¼Œå¹¶å°† Reducerå’ŒActionåˆä¸ºä¸€ä½“ï¼Œä½¿å¾—Mobxç›¸å¯¹äº Redux ç®€å•è®¸å¤šã€‚\n\n## 2. Mobx ä½¿ç”¨\n\nè¿™é‡Œä»¥å®ç°ä¸€ä¸ªè¿è¥ç³»ç»Ÿå†…éƒ¨å½“å‰å¾…å®¡æ ¸é¡¹ç›®çš„æ•°é‡æç¤ºä¸ºä¾‹ï¼Œè®²è§£ Mobx åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­çš„ä½¿ç”¨ã€‚\n\n- å®‰è£…\n\n```js\nyarn add mobx mobx-react-lite\n```\n\n- å¼•å…¥ï¼šæ–°å»º stores.js\n\n```js\nimport { runInAction } from \"mobx\"\nimport { useLocalObservable } from 'mobx-react-lite';\n\n// è‡ªå·±å®šä¹‰çš„ APIè¯·æ±‚ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ª Promise\nimport { GetAuditingDataCount } from '../../src/apis/usms';\n\nexport const Store = () =\u003e {\n\n  // åˆ›å»ºè§‚å¯Ÿè€…\n  const storeContext = useLocalObservable(() =\u003e ({\n    // çŠ¶æ€\n    auditCount: {},\n    get getAuditCount() { return this.auditCount; },\n    // è¯·æ±‚APIçš„action\n    reloadAuditCount() {\n      GetAuditingDataCount().then(res =\u003e {\n        runInAction(() =\u003e {\n          this.auditCount = res?.Data || {}\n        })\n      })\n    },\n    // é‡ç½®çŠ¶æ€\n    resetAuditCount() {\n      runInAction(() =\u003e {\n        this.auditCount = {};\n      })\n    }\n  }));\n\n  return { storeContext }\n}\n\n```\nä¸Šé¢å°±åˆ›å»ºäº†ä¸€ä¸ªè¯»å–å½“å‰å¾…å®¡æ ¸æ•°é‡çš„storeã€‚\n\n- ä¸šåŠ¡ä¸­ä½¿ç”¨ï¼šä½¿ç”¨ observer åŒ…è£¹è¦ç”¨åˆ°çŠ¶æ€çš„ç»„ä»¶ï¼Œnameåœ¨è¿™ä¸ªç»„ä»¶å†…éƒ¨å°±å»ºç«‹äº†ç›‘å¬\n\n```js\nimport { observer } from \"mobx-react-lite\";\n\nfunction Menu() {\n  ...\n}\n\nexport default observer(Menus)\n```\n\nå€ŸåŠ© Context ä¼ å€¼ç»™ Menuï¼š\n\n```js\n// å¼•å…¥è‡ªå®šä¹‰çš„ store\nimport { Store as MobxStore } from '../stores';\n\nconst { storeContext } = MobxStore();\n\n// å•ç‹¬ä¸€ä¸ªæ–‡ä»¶å†™å…¥ï¼šconst BasicContext = React.createContext({});\n\u003cBasicContext.Provider value={{ storeContext }} \u003e\n    ...\n    \u003cMenu /\u003e\n    ...\n\u003c/BasicContext.Provider\u003e\n```\n\nMenu ç»„ä»¶å†…éƒ¨ä½¿ç”¨ï¼š\n\n```js\nimport BasicContext from '../../BasicContext'\n\nconst context = useContext(BasicContext);\n\nconst storeContext = context.storeContext || {};\n```\nå¦‚æ­¤å°±æ‹¿åˆ°äº†é‚£ä¸ª store çš„å•ä¾‹ï¼Œè¿›è€Œåœ¨æ¸²æŸ“æ—¶å°±å¯ä»¥è¿™æ ·å†™ï¼š\n\n```js\n\u003cMenu.SubMenu\n    title={\n      \u003cspan\u003e\n        {menu.icon}\n        // è¿™é‡Œæ˜¯é‡ç‚¹ï¼Œå¯ç›´æ¥è·å–çŠ¶æ€æ•°æ® storeContext?.auditCount?.TotalCount\n        {menu.auditCount ? \u003cBadge offset={[4, 0]} dot={(storeContext?.auditCount?.TotalCount || 0) \u003e 0}\u003e\n          \u003cspan\u003e{menu.name}\u003c/span\u003e\n        \u003c/Badge\u003e : \u003cspan\u003e{menu.name}\u003c/span\u003e}\n      \u003c/span\u003e\n    }\n    key={menu.key}\n    \u003e\n    {genMenus(menu.children)}\n\u003c/Menu.SubMenu\u003e\n```\n\næ•°æ®å˜æ›´ï¼š\n\n```js\n// å®¡æ ¸æ¥å£\n\nAuditAPI(...).then(() =\u003e {\n    ...\n    // åˆ·æ–° mobx çŠ¶æ€\n    storeContext.reloadAuditCount();\n});\n```\nå½“å®¡æ ¸çŠ¶æ€å˜åŒ–æ—¶ï¼ŒåŠ¨æ€è°ƒç”¨APIé‡æ–°è®¾ç½®storesé‡Œçš„å€¼åï¼Œæ‰€æœ‰è¢« observe çš„ç»„ä»¶éƒ½ä¼šè‡ªåŠ¨å˜åŒ–ï¼š\n\n\n![image.png](/img/posts/2022-12-26/2022-12-26-1.png)\n\n\n## 3. æ€»ç»“\n\nä¸æ˜¯ä¸‡ä¸å¾—å·²ï¼Œå°½é‡ä¸è¦ä¸Šå…¨å±€çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨ Context + sessionStorage ä»£æ›¿å³å¯ã€‚åœ¨éœ€è¦å®æ—¶æˆ–è§¦å‘å¼æ›´æ–°çŠ¶æ€çš„åœ°æ–¹ï¼Œå¦‚æœä¸èƒ½ä¸Š webSocketï¼Œå®åœ¨è¦ç”¨ï¼Œå°±ä½¿ç”¨é…ç½®ç®€å•ï¼Œè€¦åˆæ€§ä½çš„å·¥å…·ã€‚åŒæ—¶è¿˜è¦ç…§é¡¾åˆ°å®‰å…¨æ€§ï¼Œæ¨èé…ç½®ï¼šContext + Mobx."])</script><script>self.__next_f.push([1,"35:Tbff,"])</script><script>self.__next_f.push([1,"åœ¨éƒ¨ç½²å‰ç«¯æœåŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å®ç°ç™»å½•ä¿¡æ¯å…±äº«çš„åŠŸèƒ½ï¼Œè‹¥å„ä¸ªæœåŠ¡æ˜¯åœ¨åŒä¸€ä¸ªåŸŸåä¸‹çš„ï¼Œåˆ™å¯ä»¥å…±äº«cookieã€‚ä½†æ˜¯ï¼Œå…¬å¸å¯¹å¤–äº§å“å¾€å¾€éƒ½æ˜¯å•ç‹¬éƒ¨ç½²åŸŸåçš„ï¼Œæ¯”å¦‚äº§å“é¡µé¢ã€é—¨æˆ·ç½‘ç«™ç­‰ï¼Œä»–ä»¬è‹¥éœ€è¦æ‹¿åˆ°å½“å‰ç™»å½•ä¿¡æ¯ï¼Œå°±éœ€è¦ç‰¹æ®Šé…ç½®äº†ã€‚\n\näº§å“éƒ¨ç½²é…ç½®ï¼š\n\n- ç™»å½•é¡µé¢ï¼š https://passport.xxx.com\n- å¾®æœåŠ¡äº§å“ç³»ç»Ÿï¼šhttps://console.xxx.com\n- é—¨æˆ·ç½‘ç«™ï¼šhttps://www.xxx.com\n- äº§å“æ–‡æ¡£ï¼šhttps://docs.xxx.com\n\nå¯ä»¥çœ‹åˆ°çº¿ä¸Šéƒ¨ç½²åï¼Œå…¬å¸äº§å“çš„äºŒçº§åŸŸåè™½ç„¶æ˜¯ä¸ä¸€æ ·ï¼Œä½†æ˜¯ä¸€çº§åŸŸåä¸€æ ·ï¼ŒæŠŠcookieçš„Domainè®¾ç½®ä¸º `.xxx.com` å°±å¯ä»¥å…±äº«äº†ã€‚ä½†æ˜¯å¦‚æœæ˜¯æœ¬åœ°å¼€å‘å°±å¤´ç–¼äº†ã€‚æœ¬åœ°å¼€å‘ï¼Œä¼šå…ˆè·³è½¬åˆ°éƒ¨ç½²å¥½çš„ç™»å½•é¡µï¼š`passport.xxx.admin.com`ï¼Œç„¶åå†è·³è½¬å› `localhost` ï¼Œæ­¤æ—¶ï¼Œæ¥æºçš„ä¸€çº§åŸŸåä¸ä¸€æ ·ï¼Œå°±ä¼šå‡ºç°cookieæ²¡åŠæ³•å…±äº«çš„é—®é¢˜äº†ã€‚\n\nè¿™é‡Œæä¾›ä¸‰ç§è·¨åŸŸcookieæ–¹æ¡ˆä¾›é€‰æ‹©ã€‚\n\n## 1. åç«¯é…ç½®\n\næˆ‘ä»¬çŸ¥é“ cookie æœ‰å‡ ä¸ªå±æ€§ï¼š\n\n![image.png](/img/posts/2022-12-25/2022-12-25-1.png)\n\nHttpOnly å’Œ Secure ç”¨äºé™åˆ¶åªèƒ½ https ä¼ é€’ä¸å¯è¯»çš„å®‰å…¨ cookieï¼›å¦å¤–ä¸€ä¸ªå±æ€§ SameSite å¯ä»¥è®¾ç½®ä¸‰ä¸ªå€¼ï¼š`Strict`ã€`Lax`ã€`None`ï¼š\n\n- `Strict`ï¼šå®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹è·å–cookieï¼Œè·¨ç«™ç‚¹æ—¶ï¼Œä»»ä½•æƒ…å†µä¸‹éƒ½ä¸ä¼šå‘é€cookie\n- `Lax`ï¼šé˜²èŒƒè·¨ç«™ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ç¦æ­¢è·å–cookieï¼Œé™¤éå¯¼èˆªåˆ°ç›®æ ‡ç½‘å€çš„GETè¯·æ±‚ï¼ˆé“¾æ¥ã€é¢„åŠ è½½ã€GETè¡¨å•ï¼‰\n- `None`ï¼šæ²¡æœ‰é™åˆ¶ã€‚å¿…é¡»åŒæ—¶è®¾ç½®`Secure`å±æ€§ï¼ˆCookie åªèƒ½é€šè¿‡ HTTPS åè®®å‘é€ï¼‰ï¼Œå¦åˆ™æ— æ•ˆï¼Œéœ€è¦ chrome \u003e 80ï¼Œå…¼å®¹æ€§æœ‰é—®é¢˜ï¼š\n\n![image.png](/img/posts/2022-12-25/2022-12-25-2.png)\n\næ­¤æ—¶ï¼Œåªè¦è®¾ç½® åªæ”¯æŒhttps ä¸” samesite=Noneï¼Œä¾¿ä¼šåœ¨ https ä¸‹æºå¸¦ cookie äº†ã€‚ä½†æ˜¯è¿™åªé€‚ç”¨äº httpsï¼Œå¼€å‘ç¯å¢ƒå¤§å¤šæ˜¯ httpï¼Œä¸èƒ½ç”¨ã€‚\n\n## 2. å‰ç«¯é…ç½®\n\nå‰ç«¯ä¹Ÿæ˜¯å¯ä»¥è®¾ç½® cookie çš„ï¼Œè€Œä¸”å¯ä»¥æŒ‡å®šåŸŸåã€‚åœ¨ç™»å½•é¡µé¢ç™»å½•åè®¾ç½® cookieï¼š\n\n```js\nlet host = window.location.host;\n\nif (host.indexOf('passport.xxx.admin.com') \u003e -1) {\n    host = '.xxx.admin.com';\n}\n\nwindow.document.cookie = `${name}=${value};domain=${host}`;\n```\n\n\n## 3. è·³è½¬æ—¶è®¾ç½®å›è°ƒå‚æ•°\n\né’ˆå¯¹å‰ç«¯é…ç½®çš„è¡¥å……æ–¹æ¡ˆï¼Œæ­¤æ–¹æ³•ä¹Ÿé€‚åˆ iframe ä¼ å‚æ–¹å¼ã€‚\n\nåœ¨ `localhost` è¿›å…¥å¼€å‘é¡µé¢ï¼Œæ­¤æ—¶æ£€æµ‹åˆ°æ²¡æœ‰ cookie ä¿¡æ¯ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼š `passport.xxx.admin.com`, è·³è½¬æ—¶å›å¸¦å‚æ•°ï¼š\n\n```shell\nhttp://passport.xxx.admin.com?origin=localhost\n```\n\nç™»å½•é¡µé¢ç™»å½•åï¼Œç›´æ¥è¯»å–è·¯ç”±å‚æ•°ä¸­çš„ originï¼Œå¹¶è®¾ç½®å¸¦ç€ host çš„ cookieï¼š\n\n```js\nwindow.document.cookie = `${name}=${value};domain=${origin}`;\n```\nè®¾ç½®å®Œæ¯•åé‡å®šå‘é¡µé¢è·³è½¬å› origin å³å¯å®ç° cookie æºå¸¦ã€‚\n\n\n## 4. å¯¹æ¯”\n\n- åç«¯é…ç½®å€¾å‘äºå‰åç«¯ä¼ é€’ cookie æ—¶ä½¿ç”¨ï¼Œè‹¥åªæ˜¯å‰ç«¯å…±äº« cookieï¼Œä¸éœ€è¦å‘ŠçŸ¥åç«¯æ—¶åˆ™ä¸å¯ç”¨\n- å‰ç«¯é…ç½®å¯ä»¥å®ç°åç«¯æ— æ„Ÿçš„cookieä¼ é€’ï¼Œä½†æ˜¯å®‰å…¨æ€§ä¸é«˜ï¼Œä¸å¯ä¼ é€’æ˜æ–‡ï¼Œå°½é‡åªç”¨åœ¨å¼€å‘ç¯å¢ƒã€‚\n\n--------\nå®Œ ï¼"])</script><script>self.__next_f.push([1,"36:T18f4,"])</script><script>self.__next_f.push([1,"åœ¨å›¢é˜Ÿä»£ç ç§æœ‰ä»“åº“ä¸­ï¼Œäº’è”ç½‘å…¬å¸ä¸­gitlabåº”è¯¥æ˜¯é¦–é€‰çš„ï¼Œä¸ä»…ä»…æ˜¯ä¸ªä»“åº“ï¼Œå…¶æ”¯æŒç§æœ‰åŒ–éƒ¨ç½²å’Œå…·å¤‡ç‹¬æœ‰çš„CI/CDï¼Œä¼˜åŠ¿æ˜æ˜¾ã€‚gitlab æœ‰å…è´¹çš„ç¤¾åŒºç‰ˆï¼ˆCEï¼‰ä¹Ÿæœ‰æ”¶è´¹çš„ä¼ä¸šç‰ˆï¼ˆEEï¼‰ï¼Œå›½å†…è¿˜æœ‰æç‹ç‰ˆï¼ˆJHï¼‰ã€‚æœ¬æ–‡ä»¥ CE ä¸ºä¾‹è®²è§£ã€‚\n\næœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨æœåŠ¡å™¨ï¼ˆä»¥centOS7ä¸ºä¾‹ï¼‰ä¸Šå®‰è£…gitlabï¼Œå¹¶å®ç°webç«¯è´¦å·é…ç½®ä¸sshé…ç½®ä»“åº“ã€‚\n\n\u003e å›½å†…å¯ä»¥ä½¿ç”¨ gitlab åœ¨å›½å†…çš„ä»£ç† [æç‹](https://gitlab.cn/install/) æ¥å®‰è£…ï¼Œå¾ˆå¤šè®¾ç½®éƒ½å·²ç»åšå¥½äº†ï¼Œä¹Ÿä¸å­˜åœ¨ç½‘ç»œé—®é¢˜ï¼Œå¯ä»¥çœå»å¾ˆå¤šç¹é‡çš„é…ç½®å·¥ä½œã€‚æœ¬æ–‡è¿˜æ˜¯ä»¥æ¸…åçš„é•œåƒæºä¸ºä¾‹ã€‚\n\n## 1. å®‰è£…å‰æ£€æŸ¥\n\nåœ¨å®‰è£…å‰ï¼Œå¯ä»¥æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦å®‰è£…æœ‰æ—§ç‰ˆæœ¬ï¼Œå¸è½½æ‰ä»–ï¼\n\næŒ‰é¡ºåºæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š\n\n```shell\n## åœæ­¢gitlab\ngitlab-ctl stop\n\n## å¸è½½ (è¯·ç¡®å®šç‰ˆæœ¬`ce/ee/jh`ç­‰ã€‚è‹¥æ‰¾ä¸åˆ°åŒ…è¯´æ˜ä¸Šæ¬¡æ²¡æœ‰å®‰è£…æˆåŠŸ)\nrpm -e gitlab-ce\n\n## æ£€æŸ¥ä¸€ä¸‹è¿›ç¨‹\nps aux | grep gitlab\n```\n\n\n![image.png](/img/posts/2022-12-24/2022-12-24-1.png)\n\n```shell\n## æ¸…é™¤æ‰ service çš„è¿›ç¨‹\nkill -9 9956\n\n## åˆ é™¤æ‰€æœ‰åŒ…å«gitlabæ–‡ä»¶ ï¼ˆé€’å½’æŸ¥æ‰¾æœ‰äº›æ…¢ï¼Œå¯ä»¥ä¸åšï¼‰\nfind / -name gitlab | xargs rm -rf\n```\n\n## 2. å®‰è£…\n\n- æ“ä½œç³»ç»Ÿï¼šCentOS7\n- gitlabï¼šGitLab-ce æ¸…åæºé•œåƒ ï¼ˆgitlab-ce-11.5.3-ce.0.el7.x86_64.rpmï¼‰\n\n### å‰ç½®å®‰è£…\n\nåœ¨ç³»ç»Ÿé˜²ç«å¢™ä¸­æ‰“å¼€ HTTPã€HTTPS å’Œ SSH è®¿é—®ã€‚å¦‚æœæ‰“ç®—ä»…ä»æœ¬åœ°ç½‘ç»œè®¿é—®æç‹GitLabï¼Œåˆ™å¯ä»¥è·³è¿‡å®ƒã€‚\n\n```shell\n## å…¨éƒ¨ç²˜è´´ä¸€èµ·ä¸¢åˆ°ç»ˆç«¯é‡Œ\nsudo yum install -y curl policycoreutils-python openssh-server perl\nsudo systemctl enable sshd\nsudo systemctl start sshd\n\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --permanent --add-service=https\nsudo systemctl reload firewalld\n```\n\nsshé…ç½®ï¼š\n\n```shell\nsudo yum install curl policycoreutils openssh-server openssh-clients\n```\n\né…ç½®é‚®ä»¶é€šçŸ¥ï¼ˆå¯é€‰ï¼‰\n\n```shell\nsudo yum install postfix\nsudo systemctl enable postfix\nsudo systemctl start postfix\n```\n\nä¿®æ”¹é‚®ä»¶é…ç½®ï¼švi /etc/postfix/main.cf\n\n```shell\ninet_interfaces = allÂ Â  Â Â Â  Â Â  Â  //ä¹‹å‰åº”è¯¥æ˜¯localhost\n```\n\nå¯åŠ¨ postfixï¼š\n\n```shell\nservice postfix start\nsystemctl status postfix.service\nsudo systemctl enable postfix\n```\n\nç”±äºå›½å†… wgeté€Ÿåº¦è¾ƒæ…¢ï¼Œå¯ä»¥ä½¿ç”¨ mwgetï¼š(è¿™ä¸€å †ä¸¢åˆ°ç»ˆç«¯é‡Œ)\n\n```shell\nwget http://jaist.dl.sourceforge.net/project/kmphpfm/mwget/0.1/mwget_0.1.0.orig.tar.bz2\nyum install bzip2 gcc-c++ openssl-devel intltool -y\nbzip2 -d mwget_0.1.0.orig.tar.bz2\ntar -xvf mwget_0.1.0.orig.tar \ncd mwget_0.1.0.orig\n./configure \nmake\nmake installã€€\n```\n\n### ä¸‹è½½ä¸å®‰è£… gitlab\n\nä¸‹è½½é•œåƒæºï¼š\n\n```shell\nmwget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-11.5.3-ce.0.el7.x86_64.rpm\n```\n\nå®‰è£…ï¼š\n\n```shell\nrpm -i gitlab-ce-11.5.3-ce.0.el7.x86_64.rpm\n```\næˆ‘è¿™é‡Œå‡ºç°äº†ç£ç›˜ç©ºé—´ä¸è¶³çš„é—®é¢˜ï¼š\n\n![image.png](/img/posts/2022-12-24/2022-12-24-2.png)\n\nçœ‹äº†ä¸€ä¸‹ï¼Œä¸€å…±ä½¿ç”¨äº† 6Gï¼š\n\n![image.png](/img/posts/2022-12-24/2022-12-24-3.png)\n\næŸ¥çœ‹å¯ç”¨ç©ºé—´ï¼š\n\n![image.png](/img/posts/2022-12-24/2022-12-24-4.png)\næ ¹è·¯å¾„ä¸‹åªå‰©5Gä¸åˆ°äº†ï¼Œæ¸…ç†äº†åˆ é™¤åæœªé‡Šæ”¾ç£ç›˜çš„æ–‡ä»¶åå†è¯•ã€‚\n\nè€å¿ƒç­‰å¾…åä¼šæœ‰å®‰è£…æˆåŠŸæç¤º\n\n\n![image.png](/img/posts/2022-12-24/2022-12-24-5.png)\n\næ­¤æ—¶æŸ¥çœ‹gitlabç‰ˆæœ¬ï¼š\n\n```shell\ncat /opt/gitlab/embedded/service/gitlab-rails/VERSION\n\n## 11.5.3\n```\n\u003e ä¹Ÿå¯ä»¥ä½¿ç”¨ docker å®‰è£…ï¼šhttps://docs.gitlab.cn/jh/install/docker.html\n\n## 3. å®‰è£…åé…ç½®\n\n### é‡ç½®rootè´¦æˆ·\n\nç¼–è¾‘Â `/etc/gitlab/gitlab.rb`ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰å¹¶è®¾ç½®ï¼š\n\n```shell\ngitlab_rails['initial_root_password'] = 'passport'\n```\nåŒç›®å½•ä¸‹çš„ initial_root_password ä¹Ÿä¿®æ”¹ä¸€ä¸‹ï¼Œå¦‚æœæœ‰çš„è¯ã€‚å½“ç„¶ä¹Ÿå¯ä»¥é‡ç½®å¯†ç ï¼š\n\n```shell\n## 1. è·å–ç®¡ç†å‘˜æƒé™\nsudo su\n## 2. è¿›å…¥æ§åˆ¶å°\ngitlab-rails console production\n## 3. æŸ¥æ‰¾rootç”¨æˆ·\nuser = User.where(id: 1).first\n## 4. è®¾ç½®\nuser.password = 'passport' #è®¾ç½®æ–°çš„å¯†ç \nuser.password_confirmation = 'passport'  #ç¡®è®¤å¯†ç \n## 5. ä¿å­˜\nuser.save!\n## å½“å‘ç°=\u003e trueæ—¶è¡¨ç¤ºé‡ç½®æˆåŠŸ\n\n## 6. é€€å‡º\nctrl+d or exit\n```\n\n### é…ç½®web URL\nç¼–è¾‘Â `/etc/gitlab/gitlab.rb`\n\n```shell\n## é…ç½®æœ¬æœºipå¯è®¿é—®çš„åœ°å€\nexternal_url \"http://127.0.0.1:10086\"\n```\n\næœ€åç”Ÿæ•ˆé…ç½®ï¼š\n\n```shell\ngitlab-ctl reconfigure\n```\n\næŸ¥çœ‹çŠ¶æ€\n\n```shell\ngitlab-ctl status\n```\n\n## 4. Web è®¿é—®\n\næµè§ˆå™¨é‡Œæ‰“å¼€åˆšåˆšé…ç½®çš„ url åœ°å€ï¼š\n\n\n![image.png](/img/posts/2022-12-24/2022-12-24-6.png)\n\n\u003e å¦‚æœå‡ºç°äº† 502 é”™è¯¯ï¼Œå¯èƒ½æ˜¯ç«¯å£è¢«å ç”¨äº†ï¼Œä¹Ÿå¯èƒ½æ˜¯å†…å­˜ä¸è¶³äº†\n\nè¾“å…¥é…ç½®å¥½çš„å¯†ç ï¼š\n- root/password\n\nè¿›å…¥ç•Œé¢ï¼š\n\n\n![image.png](/img/posts/2022-12-24/2022-12-24-7.png)\n\n## 5. å®¢æˆ·ç«¯è®¿é—®\n\n### è®¾ç½® CentOS å¤–éƒ¨å¯è®¿é—®ï¼š\n\næ‰§è¡ŒæŒ‡ä»¤ï¼š\n\n```shell\niptables -F  \niptables -P INPUT ACCEPTï¼ˆè®¾ç½®é»˜è®¤å…è®¸è§„åˆ™ï¼‰\n```\né…ç½®é˜²ç«å¢™ï¼Œå…è®¸10086ç«¯å£è®¿é—®ï¼š\n\n```shell\n## /etc/sysconfig/iptables-config\n\n## æ·»åŠ \n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 10086 -j ACCEPT\n```\nå¼€æ”¾ç«¯å£ï¼š\n```shell\nfirewall-cmd --zone=public --add-port=10086/tcp --permanent\n```\n\n\nå¦‚æœæ˜¯çœŸå®çš„ç‰©ç†æœºï¼Œåªè¦åœ¨ä¸€ä¸ªå±€åŸŸç½‘ä¸‹ç¨ä½œé…ç½®ä¾¿å¯ä»¥è®¿é—®ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„è™šæ‹Ÿæœºæ­å»ºçš„ CentOS ç¯å¢ƒï¼Œæ‰€ä»¥éœ€è¦å¦‚ä¸‹é…ç½®ï¼š\n\n\n![image.png](/img/posts/2022-12-24/2022-12-24-8.png)\n\nè™šæ‹Ÿæœºç¼–è¾‘é‡Œçš„è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ä¸­æ‰“å¼€NATè®¾ç½®ä¸­çš„æ·»åŠ ï¼šï¼ˆè™šæ‹Ÿæœºæ“ä½œç³»ç»Ÿipï¼š192.168.137.128ï¼‰\n\n![image.png](/img/posts/2022-12-24/2022-12-24-9.png)\n\nç„¶ååœ¨ windows çš„é˜²ç«å¢™é…ç½®é‡Œæ·»åŠ è™šæ‹Ÿæœºçš„IPå³å¯ã€‚\n\n\u003e æ³¨æ„ï¼šä¸€å®šè¦é€‰æ‹© VWnet8 ç½‘ç»œ\n\nwindows ä¸‹è®¿é—®ï¼š\n\n\n![image.png](/img/posts/2022-12-24/2022-12-24-10.png)\n\nç¬¬ä¸€éƒ¨åˆ†å°±å®Œæˆäº†ã€‚\n\n-----\n\n## 6. ç”¨æˆ·ç®¡ç†ä¸ä»“åº“ç®¡ç†\n\n1. åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼šç›´æ¥ä½¿ç”¨ç•Œé¢çš„æ³¨å†Œè¡¨å•å¡«å†™å³å¯ã€‚\n2. ä½¿ç”¨è¯¥ç”¨æˆ·åˆ›å»ºä¸€ä¸ªä»“åº“ï¼š\n\n![image.png](/img/posts/2022-12-24/2022-12-24-11.png)\n\n3. æ­¤æ—¶å·²ç»çœ‹åˆ°æç¤ºäº†ï¼Œæˆ‘ä»¬é…ç½®ä¸€ä¸‹ sshkeyï¼Œé…ç½®è¿‡ç¨‹çœç•¥ï¼Œå¤§å®¶éƒ½ä¼šã€‚\n\n![image.png](/img/posts/2022-12-24/2022-12-24-12.png)\n\n4. åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ª vue é¡¹ç›®ã€‚\n\n5. å°†è¯¥ä»“åº“æ¨é€è‡³è¿œç«¯ä»“åº“åï¼ŒæŸ¥çœ‹ç•Œé¢ï¼š\n\n\n![image.png](/img/posts/2022-12-24/2022-12-24-13.png)\n\n\nä»‹ç»å°±åˆ°è¿™é‡Œå•¦ï¼æœ‰æ„Ÿå…´è¶£çš„å¯ä»¥å…³æ³¨ä¸‹æœŸ CI/CD çš„é…ç½®ã€‚è°¢è°¢ï¼ï¼"])</script><script>self.__next_f.push([1,"37:T1e29,"])</script><script>self.__next_f.push([1,"å‰ç«¯é¡¹ç›®é™¤äº†ç›®å‰çš„çº¯å•é¡µåº”ç”¨ï¼Œè¿˜æœ‰SSRçš„åº”ç”¨ï¼Œä¾‹å¦‚ nuxt å’Œ nextjsï¼Œå…¶åŒºåˆ«åœ¨äºå‰è€…æ˜¯å•ç‹¬çš„å‰ç«¯é¡µé¢éƒ¨ç½²ï¼Œè€Œåè€…ä½¿ç”¨äº†ä¸€ä¸ªå†…éƒ¨çš„ node å°å‹æœåŠ¡å™¨æ¥åšåˆ°æœåŠ¡å™¨é¡µé¢ç›´å‡ºçš„æ•ˆæœã€‚\n\nä¸‹é¢æˆ‘ä»¬å°±é’ˆå¯¹è¿™ä¸¤ç§å¸¸è§çš„å‰ç«¯é¡¹ç›®ï¼Œè®²è®²ä»–ä»¬ä¸Šçº¿éƒ¨ç½²çš„æµç¨‹ã€‚\n\n## 1. éƒ¨ç½²å•é¡µåº”ç”¨\n\n\nå•é¡µåº”ç”¨ï¼Œä¸€èˆ¬ä½¿ç”¨ä¸€ç§æˆ–å¤šç§å‰ç«¯æ¡†æ¶ï¼Œåœ¨å‘å¸ƒä¸Šçº¿æ—¶ï¼Œä¸€èˆ¬ä¼šæ‰“åŒ…ï¼ˆwebpack + babelï¼‰ä¸ºæœ€ä¼˜åŒ–çš„é™æ€èµ„æºï¼Œç„¶åä½¿ç”¨å•ç‹¬çš„æœåŠ¡å™¨ï¼ˆnginxï¼‰æ¥æŒ‚è½½è¯¥èµ„æºã€‚\n\n- é¦–å…ˆæˆ‘ä»¬æ¥æ‰“åŒ…èµ„æº\n\nå‡è®¾æˆ‘ä»¬çš„é¡¹ç›®å« opsï¼Œå…¶ä¸­ package.json æ˜¯è¿™ä¹ˆå†™çš„ï¼š\n\n```sh\n\"build\": \"react-scripts build\",\n```\n\nåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­å†™ä¸€ä¸ªè„šæœ¬ç”¨äºæ‰“åŒ…æ–‡ä»¶ï¼šbuild.shï¼š\n\n```sh\n## æ‰“åŒ…çš„è„šæœ¬ï¼ˆåªå±•ç¤ºå¿…è¦æ­¥éª¤ï¼‰\n#!/usr/bin/env bash\n\n## æ¥å— ENV\nenv=$1\n\n## è¿™é‡Œå¯ä»¥åŒºåˆ†å¼€å‘å’Œçº¿ä¸Šçš„ä¸åŒenvé…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬æ˜¯è¯·æ±‚çš„èµ„æºå’ŒAPIçš„urlä¸åŒ\nif [ $env = \"pre\" ];then\n    cp .env_pre .env\nelif [ $env = \"prod\" ];then\n    cp .env_prod .env\nelse\n    exit 1\nfi\n\n# yarnæ‰“åŒ…\nyarn build\n\n# æ‰“åŒ…dockeré•œåƒ\n# é»˜è®¤æ¨é€åˆ° hub.xxx.com/ops\n\ntime=$(date \"+%Y%m%d%H%M%S\")\ntag=\"$time\"\n\napp_name=ops\"_\"\"$env\"\ndefault_registry=hub.xxx.com\ndefault_project=ops\ndefault_user=admin\ndefault_pwd=xxxxxxxx\ndockerfile=Dockerfile\nnginx_conf=\"./scripts/nginx_\"\"$env\"\".conf\"\n\necho $(date \"+%Y-%m-%d %H:%M:%S\")-å¼€å§‹åˆ¶ä½œé•œåƒ\ndocker build --platform linux/amd64 --rm --build-arg NGINX_CONF=$nginx_conf -t $app_name:latest . \necho $(date \"+%Y-%m-%d %H:%M:%S\")-é•œåƒåˆ¶ä½œå®Œæˆ\n\necho $(date \"+%Y-%m-%d %H:%M:%S\")-å¼€å§‹æ‰“tag\ndocker tag $app_name:latest $default_registry/$default_project/$app_name\\:$tag\necho $(date \"+%Y-%m-%d %H:%M:%S\")-æ‰“tagå®Œæˆ\n\necho $(date \"+%Y-%m-%d %H:%M:%S\")-å¼€å§‹pushé•œåƒ\ndocker login -u $default_user -p $default_pwd $default_registry\ndocker push $default_registry/$default_project/$app_name\\:$tag\necho $(date \"+%Y-%m-%d %H:%M:%S\")-pushé•œåƒå®Œæˆ\n\necho $(date \"+%Y-%m-%d %H:%M:%S\")-åˆ é™¤æœ¬åœ°é•œåƒ\ndocker rmi $app_name\\:latest\ndocker rmi $default_registry/$default_project/$app_name\\:$tag\n\necho \"æ‰§è¡Œå‘å¸ƒè„šæœ¬è¯·è¾“å…¥tagï¼š\"\necho $tag\n```\nå…¶ä¸­ docker çš„ç™»å½•ç”¨æˆ·åå¯†ç éœ€è¦è‡ªå·±é…ç½®å³å¯ã€‚ Dockerfileå¦‚ä¸‹ï¼š\n\n```\nFROM nginx:1.19.1\nARG NGINX_CONF=\"\"\n\n# æœåŠ¡å™¨ä¸Šèµ„æºçš„åœ°å€\nWORKDIR /data/ops\n\n# å¾€ç›®å½•é‡Œæ‹·è´æ‰“åŒ…çš„æ–‡ä»¶å¤¹ buildï¼Œè¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥\nADD build build\n\n# è¿™é‡Œåœ¨dockeré‡Œæ‰§è¡Œäº†nginxé…ç½®ï¼Œè¿™é‡Œä¸ä½¿ç”¨é»˜è®¤é…ç½®\nCOPY ./scripts/run.sh ./\nCOPY \"${NGINX_CONF}\" /etc/nginx/conf.d/default.conf\n\nEXPOSE 80\nENTRYPOINT [\"sh\", \"./run.sh\"]  \n```\nä¸Šè¾¹æ‰§è¡Œçš„ run.sh è„šæœ¬æˆ‘è¿™é‡Œæ˜¯ä»å®¢æˆ·ç«¯æ‹·è´åˆ°äº†æœåŠ¡å™¨ä¸Šï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥å†™åœ¨æœåŠ¡å™¨ä¸­ï¼Œå…¶ä½œç”¨æ˜¯å¯åŠ¨dockeré•œåƒä¸Šçš„ nginxï¼ˆå®‰è£…ç›®å½• /etc/init.d/nginxï¼Œnginxé…ç½®è¿™é‡Œçœç•¥ï¼‰ã€‚run.sh å¦‚ä¸‹ï¼š\n\n```sh\n#!/usr/bin/env bash\n\n#start udnr web...\n/etc/init.d/nginx start\n```\n\nå…¶ä¸­æœ¬åœ°çš„ nginxé…ç½®æ–‡ä»¶ `nginx_conf=\"./scripts/nginx_\"\"$env\"\".conf\"` æ˜¯ç”¨äº docker å®¹å™¨å†…éƒ¨çš„ nginxï¼Œè¦†ç›–é»˜è®¤é…ç½®ã€‚è¿™é‡Œæˆ‘é…ç½®äº†æœåŠ¡çš„è¯·æ±‚è·¯å¾„ä»¥åŠå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„è¯·æ±‚APIåœ°å€çš„åå‘ä»£ç†ï¼Œè¿™é‡Œä¸è¿‡å¤šå±•å¼€ï¼š\n\n```sh\n## ./scripts/nginx_prod.conf ä¸ºä¾‹\nupstream dashboard {\n    server 10.69.164.xxx:21001;\n}\n\n...\n\nlocation / {\n    try_files   /index.html =404;\n    root        /data/ops/build;\n}\n\nlocation ~ .*.(js|gif|png|map|jpg|css|ico|html|less)$ {\n    root            /data/ops/build;\n    proxy_redirect  off;\n    expires         30d;\n    error_page 405  =200 http://$host$request_uri;\n}\n\nlocation /dashboard {\n    proxy_pass         http://dashboard/;\n    proxy_set_header   Host $Host;\n}\n```\n\nbuild.sh è„šæœ¬æ‰§è¡Œå®Œæ¯•åï¼Œä¼šç”Ÿæˆä¸€ä¸ªæŒ‚è½½äº†é¡¹ç›®buildèµ„æºçš„Dockeré•œåƒï¼Œå¹¶è¾“å‡ºäº†å…¶ Tagã€‚\n\n- æ¥ä¸‹æ¥æˆ‘ä»¬æ¥éƒ¨ç½²è¿™ä¸ª docker é•œåƒ\n\nåˆšåˆšçš„æ“ä½œéƒ½æ˜¯åœ¨å®¢æˆ·ç«¯æ“ä½œçš„ï¼ˆå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬ï¼Œä¹Ÿå¯ä»¥å†™åœ¨CIé‡Œï¼‰ã€‚ç°åœ¨æˆ‘ä»¬ç™»å½•æœåŠ¡å™¨ï¼š\n\n```sh\nssh root@172.xx.xxx.72\n\ncd /data/ops/\n```\n\nå…¶ä¸­ deploy.shï¼š\n\n```sh\n#!/bin/bash\nif [ ! -n \"$1\" ]\nthen\necho \"You should give me a image tag.\"\nelse\necho \"The image tag is $1\"\n\noldtag=`cat .env`\n\n## è·å–ä¸Šä¸€æ¬¡æˆåŠŸçš„tagï¼Œä¾¿äºåœ¨æ‰“åŒ…å¤±è´¥æ—¶åŠæ—¶å›é€€\necho \"The old image tag is $oldtag\"\n\npath=$(pwd)\n\n# è®°å½•æ–°çš„tagåˆ°å®¹å™¨çš„.envä¸­\nsed -i \"s/$oldtag/TAG=$1/g\" $path/.env\n\n# docker-compose config\ndocker login -u ops -p ä½ çš„å¯†ç  hub.xxx.com\n# é‡æ–°å¯åŠ¨å®¹å™¨ï¼Œå› ä¸º build æ–‡ä»¶å¤¹æ›¿æ¢äº†ï¼Œæ‰€ä»¥æ˜¯æœ€æ–°çš„æ‰“åŒ…ä¿¡æ¯\ndocker-compose up -d\n\nfi\n```\n\nç°åœ¨åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š\n\n```sh\nsh deploy.sh tagåç§°\n```\næ­¤æ—¶åœ¨æœåŠ¡å™¨ä¸Šå°±å¯åŠ¨èµ·æ¥äº†ä¸€ä¸ªå‰ç«¯å•é¡µåº”ç”¨äº†ï¼Œå¯ä»¥é€šè¿‡ip+ç«¯å£å·æ¥è®¿é—®äº†ã€‚\n\n\n## 2. éƒ¨ç½²SSRåº”ç”¨\n\nSSRå‰ç«¯æ¡†æ¶æˆ‘ä»¬ä»¥ nextjs ä¸ºä¾‹æ¥è®²ä¸€ä¸‹å¦‚ä½•ä¸ docker ç»“åˆéƒ¨ç½²ã€‚\n\n- é¦–å…ˆæ¥éƒ¨ç½²æ‰“åŒ…åº”ç”¨\n\nå‡è®¾é¡¹ç›®çš„ package.jsonæ˜¯è¿™ä¹ˆå†™çš„ï¼š\n\n```json\n\"scripts\": {\n    \"build\": \"next build --profile\",\n    \"start\": \"next start\",\n}\n```\nnextjséƒ¨ç½²åˆ°æœåŠ¡å™¨æ—¶ï¼Œéœ€è¦å…ˆ `yarn build`ï¼Œç„¶ååœ¨æ‰“å¥½åŒ…çš„ .next åŒç›®å½•ä¸Šæ‰§è¡Œ `yarn start` ä»¥æ­¤æ¥å¯åŠ¨ä¸€ä¸ªå°å‹çš„SSRç›´å‡ºæœåŠ¡å™¨ã€‚\n\næ˜ç™½äº†è¿™ä¸ªåï¼Œæˆ‘ä»¬é¦–å…ˆæ¥æ‰“åŒ…ã€‚æ‰“åŒ…çš„æ“ä½œé™¤äº†å†™åœ¨shellé‡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥å†™åœ¨ Dockerfile é‡Œï¼š\n\n```\n# å®‰è£…ä¸€äº›linuxç³»ç»Ÿå¿…é¡»çš„ä¾èµ–å’Œé…ç½®ç¯å¢ƒï¼Œå¹¶ä¸ºä¸‹ä¸€æ­¥buildå®‰è£…node_modules\nFROM node:16-alpine AS deps\nRUN apk add --no-cache libc6-compat\nWORKDIR /app\nCOPY package.json yarn.lock ./\nRUN yarn install --frozen-lockfile\n\n# æ‹·è´æ‰“åŒ…éœ€è¦çš„èµ„æºï¼Œæ‰§è¡Œbuildã€‚é»˜è®¤çš„ï¼Œbuildå®Œåï¼Œå½“å‰ç›®å½•ä¸‹ä¼šæœ‰ä¸€ä¸ª.nextç›®å½•ç”Ÿæˆ\nFROM node:alpine AS builder\nWORKDIR /app\nCOPY . .\nCOPY --from=deps /app/node_modules ./node_modules\nRUN yarn build \u0026\u0026 yarn install --production --ignore-scripts --prefer-offline\n\n# æ·»åŠ ç”¨æˆ·ç»„\nFROM node:alpine AS runner\nWORKDIR /app\n\nENV NODE_ENV production\nRUN addgroup -g 1001 -S nodejs\nRUN adduser -S nextjs -u 1001\n\n# æ‰“åŒ…ä»¥åï¼Œä¸€äº›é…ç½®æ–‡ä»¶åœ¨æ‰“åŒ…çš„ç›®å½•ä¸‹æ²¡æœ‰ï¼Œéœ€è¦æ‰‹åŠ¨copy\nCOPY --from=builder /app/next.config.js ./                      # nextçš„é…ç½®æ–‡ä»¶\nCOPY --from=builder /app/next-i18next.config.js ./              # å¦‚æœéœ€è¦next-i18nextæ”¯æŒï¼Œè¿™é‡Œä¹Ÿéœ€è¦æ‹·è´è‡ªå·±åœ¨æ ¹ç›®å½•æ”¾ç½®çš„é…ç½®æ–‡ä»¶\n\nCOPY --from=builder --chown=nextjs:nodejs /app/public ./public  # å…¬å…±èµ„æº\nCOPY --from=builder --chown=nextjs:nodejs /app/.next ./.next    # æ‰“åŒ…åçš„æºä»£ç \nCOPY --from=builder /app/node_modules ./node_modules            # å®‰è£…å¥½çš„ä¾èµ–\nCOPY --from=builder /app/package.json ./package.json            # åŒ…ä¿¡æ¯\n```\n\nå¯ä»¥çœ‹åˆ° docker æ˜¯å¾ˆå¼ºå¤§çš„ï¼Œä¸€ä¸ªæ–‡ä»¶å°±æŠŠä¾èµ–å®‰è£…ã€buildå’Œèµ„æºæ‹·è´å®Œæˆäº†ã€‚\n\n- æ¥ä¸‹æ¥æ˜¯å¯åŠ¨æ‰“åŒ…çš„é¡¹ç›®\n\nç”±äºnextjså†…ç½®çš„nodeæœåŠ¡ï¼Œç›´æ¥å¯ä»¥ `next start` å¯åŠ¨ï¼Œæ•…ä¸éœ€è¦é¢å¤–é…ç½® nginxã€‚å¯ä»¥åœ¨ä¸Šè¾¹çš„Dockerfile é‡Œè¿½åŠ å¯åŠ¨çš„æŒ‡ä»¤ï¼š\n\n```\n# ä½¿ç”¨åˆšåˆšæ·»åŠ çš„ç”¨æˆ·\nUSER nextjs\n\n# æš´éœ²dockerç«¯å£3000\nEXPOSE 3000\n\nENV PORT 3000\n\n# æ‰§è¡Œ yarn start\nCMD [\"yarn\", \"start\"]\n```\nåˆ°æ­¤ï¼Œä¸€ä¸ª nextjs åº”ç”¨å°±åœ¨æœåŠ¡å™¨çš„ 3000 ç«¯å£å¯åŠ¨èµ·æ¥äº†ã€‚\n\n\n----\n\n\næµç¨‹æ€»ç»“å¦‚ä¸‹ï¼š\n\n1. ä½¿ç”¨dockeræˆ–è€…shellè¿›è¡Œæ‰“åŒ…ï¼Œè·å–æ‰“åŒ…çš„èµ„æºæ–‡ä»¶ç›®å½•\n2. å°†èµ„æºæ–‡ä»¶ã€é…ç½®é¡¹ã€ä¾èµ–ç­‰æ‹·è´åˆ°dockerå®¹å™¨ä¸­è‡ªå®šä¹‰çš„å·¥ä½œç›®å½•ä¸‹\n3. åœ¨dockerè¯¥å·¥ä½œç›®å½•ä¸‹æ‰§è¡ŒæŒ‡ä»¤å¯åŠ¨dockerä¸­çš„nginxæˆ–è€…å…¶ä»–çš„æœåŠ¡å™¨\n\nåˆ°è¿™é‡Œï¼Œå‰ç«¯é¡¹ç›®éƒ¨ç½²å°±å®Œæˆäº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿå¦‚æœæƒ³è¦çœ‹ä¸CI/CDç»“åˆçš„è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹ï¼Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰è®²è¿° gitlab CI çš„æ–‡ç« ã€‚"])</script><script>self.__next_f.push([1,"38:T104a,"])</script><script>self.__next_f.push([1,"æœ€è¿‘åœ¨å¼€å‘è‡ªå·±è‡ªå»ºçš„ç±»åº“å’Œç»„ä»¶åº“ï¼Œæ¶‰åŠåˆ°å„ç§åŒ…ç‰ˆæœ¬çš„ç®¡ç†é—®é¢˜ã€‚åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹æˆ‘æ˜¯æ€ä¹ˆç®¡ç†è‡ªå·±è‡ªå·±å¼€å‘åº“çš„ç‰ˆæœ¬çš„ã€‚\n\n\n## 1. éœ€è¦è§£å†³çš„é—®é¢˜\n\n1. åŒä¸€å¥—ç±»åº“éœ€è¦å‘å¸ƒä¸åŒçš„å¯å®‰è£…ç‰ˆæœ¬\n2. éœ€è¦åŒºåˆ†ç¨³å®šç‰ˆå’Œæµ‹è¯•ç‰ˆ\n\n\n## 2. å»ºç«‹ä¸€ä¸ªåº“\n\næˆ‘è¿™ä¸ªåº“æ˜¯ç»™å†…éƒ¨å¾®æœåŠ¡æ§åˆ¶å°æä¾›å…¬å…±ä¾èµ–çš„ï¼Œç”¨äºç»Ÿä¸€ç®¡ç†ä¾èµ–çš„ç‰ˆæœ¬ã€‚ç›®å½•ä¸€ç»“æ„å¦‚ä¸‹ï¼š\n\n![image.png](/img/posts/2022-12-1/2022-12-1-1.png)\n\nå®ç°åŠŸèƒ½å¾ˆç®€å•ï¼Œé€šè¿‡åœ¨é¡¹ç›®ä¸­å®‰è£…è¿™ä¸ªåº“ï¼Œå¯ä»¥è·å¾—ä¸€å¥—å®Œæ•´çš„ä¾èµ–åŒ…å’Œwebpacké…ç½®æ–‡ä»¶ï¼Œè¾…åŠ©ä»¥ cli å‘½ä»¤è¡Œå·¥å…·åŠ æŒï¼Œå°±å¯ä»¥èµ·åˆ°åŒæ—¶ç®¡ç† å…¬å…±ä¾èµ–å’Œwebpackå…¬å…±é…ç½®çš„æ•ˆæœã€‚\n\næ¥ä¸‹æ¥çœ‹çœ‹åœ¨å­åº”ç”¨ä¸­çš„ä½¿ç”¨ï¼š\n\n\n![image.png](/img/posts/2022-12-1/2022-12-1-2.png)\n\næ¥ç€åªéœ€ yarn ä¸€ä¸‹å°±å¯ä»¥å®‰è£…ä¸Šä¾èµ–äº†ã€‚ç”±äºæœ¬æœŸè®²çš„æ˜¯è¿™ä¸ªåŒ…å¦‚ä½•å‘å¸ƒä¸åŒçš„ç‰ˆæœ¬ï¼Œæ•…ä¸Šè¿°é…ç½®ä¸åšè¯¦ç»†è¯´æ˜ï¼Œå¦‚æœæœ‰å¯¹ å‰ç«¯å‘½ä»¤è¡Œå·¥å…·ï¼ˆcliï¼‰æ„Ÿå…´è¶£çš„ï¼Œå¯ä»¥æœŸå¾…æˆ‘åæœŸçš„æ–‡ç« ã€‚\n\n## 3. æ‰“ä¸€ä¸ªç‰ˆæœ¬\n\næ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š\n\n```shell\n# å¯é€‰ (minor / major)\nnpm version patch\n```\nè¿™ä¸ªæƒ³å¿…å¤§å®¶éƒ½çŸ¥é“ï¼Œnpm åŒ…çš„ç‰ˆæœ¬æ˜¯ä¸‰æ®µå¼çš„ï¼Œä¸­é—´ä»¥ . éš”å¼€ï¼Œä»å·¦å¾€å³åˆ†åˆ«æ˜¯ major(ä¸»ç‰ˆæœ¬)ã€minorï¼ˆå°ç‰ˆæœ¬ï¼‰ã€patchï¼ˆè¡¥ä¸åŒ…ï¼‰ã€‚\n\næ‰§è¡Œå®ŒæŒ‡ä»¤åå¯ä»¥çœ‹åˆ°ç‰ˆæœ¬å·çš„ç¬¬ä¸‰æ®µè‡ªå¢äº†ï¼š\n\n\n![image.png](/img/posts/2022-12-1/2022-12-1-3.png)\n\næ¥ä¸‹æ¥å‘å¸ƒnpmï¼Œè¿™é‡Œéœ€è¦æå‰ç™»å½•npmï¼Œå¤§å®¶éƒ½ä¼šï¼Œä¸åšè¿‡å¤šè®¨è®ºï¼Œç½‘ä¸Šå¾ˆå¤šè¯´æ˜äº†ï¼š\n\n```shell\nnpm publish\n```\n\nå‘å¸ƒå®Œä»¥åï¼Œä½ æ‰€é…ç½®çš„npmä»“åº“é‡Œå°±æœ‰äº†ä½ è¿™ä¸ªé¡¹ç›®çš„ç‰ˆæœ¬äº†ã€‚\n\næ¥ä¸‹æ¥åœ¨å…¶ä»–é¡¹ç›®æ ¹ç›®å½•é‡Œï¼š\n\n```shell\nyarn add -D @xxx/xxx-console-dev-libs\n```\nå¦‚æ­¤ä¾¿å®‰è£…äº†ä¸€ä¸ªæ­£å¼å‘å¸ƒçš„ç‰ˆæœ¬äº†ã€‚\n\n## 4. æ­£å¼ç‰ˆä¸æµ‹è¯•ç‰ˆ\n\n### æ­£å¼ç‰ˆ\n\næˆ‘ä»¬åœ¨ä¸€ä¸ªæ–°åˆ›å»ºçš„çº¯å‡€é¡¹ç›®é‡Œæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤æŸ¥çœ‹å½“å‰é¡¹ç›®å…¨éƒ¨npmç‰ˆæœ¬ï¼š\n\n```shell\nnpm dist-tag ls\n```\nå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ˜¾ç¤ºï¼š\n\n![image.png](/img/posts/2022-12-1/2022-12-1-4.png)\n\nlatestç‰ˆæœ¬å°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šè¾¹å‘å¸ƒçš„é‚£ç§æ­£å¼ç‰ˆï¼Œé»˜è®¤å®‰è£…æ—¶ä¸éœ€è¦å¸¦ç€ç‰ˆæœ¬å·ï¼Œé»˜è®¤ä¼šå»æ‹¿ latestã€‚é‚£å¦‚æœéœ€è¦å®‰è£…å¾€æœŸçš„æ­£å¼ç‰ˆæœ¬ï¼Œå¯ä»¥å¦‚ä¸‹ï¼š\n\n```shell\nyarn add @xxx/xxx-console-dev-libs@1.0.8\n```\n\n### æµ‹è¯•ç‰ˆ\n\nnpm ä¼šæœ‰å†…ç½®çš„ä»£è¡¨ç‰ˆæœ¬æµ‹è¯•çš„åç§°ç¬¦å·ã€‚ä¸€ä¸ªè½¯ä»¶åœ¨æ­£å¼å‘å¸ƒå‰ï¼Œéƒ½ä¼šæœ‰ `alpha`, `beta` ç‰ˆï¼Œåˆ†åˆ«ä»£è¡¨å†…æµ‹ç‰ˆå’Œå…¬æµ‹ç‰ˆï¼ŒnpmåŒ…ä¹Ÿæ˜¯è½¯ä»¶ï¼Œä¹Ÿä¸ä¾‹å¤–ã€‚\n\nå¦‚æœç±»åº“å¼€å‘åˆ°æŸä¸€ä¸ªç¨‹åº¦ï¼Œæƒ³è®©å†…éƒ¨çš„äººè¯•ä¸€ä¸‹ï¼Œåˆä¸æƒ³å½±å“è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸­å®‰è£…çš„ç‰ˆæœ¬çš„è¯ï¼Œå¯ä»¥è¿™æ ·ï¼š\n\n```shell\nnpm version 1.0.13-alpha.0\n\nnpm publish --tag alpha\n```\n\næ­¤æ—¶ package.json ä¸­çš„ç‰ˆæœ¬ä¼šå˜æˆï¼š\n\n![image.png](/img/posts/2022-12-1/2022-12-1-5.png)\n\nè¿™ä¾¿æ˜¯ä¸€ä¸ªå†…æµ‹ç‰ˆäº†ï¼Œå†…æµ‹ç”¨æˆ·æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ä¾¿å¯ä»¥å®‰è£… alpha çš„æœ€æ–°æµ‹è¯•ç‰ˆï¼š\n\n```shell\nyarn add @xxx/xxx-console-dev-libs@alpha\n```\n\nå†…æµ‹ç‰ˆä¹Ÿå¯ä»¥æ›´æ–°ï¼š\n\n```shell\nnpm version prerelease --preid alpha\n\nnpm publish --tag alpha\n```\n\nå¯ä»¥çœ‹åˆ°ç‰ˆæœ¬ä¹Ÿæ˜¯é€’å¢çš„ï¼š\n\n![image.png](/img/posts/2022-12-1/2022-12-1-6.png)\n\nåŒç†ï¼Œå…¬æµ‹ç‰ˆä¹Ÿä¸€æ ·ï¼š\n\n```shell\n// æ‰“ç‰ˆæœ¬\nnpm version 1.0.13-beta.0 \n// æ‰“tag\nnpm publish --tag beta\n// æ›´æ–°ç‰ˆæœ¬\nnpm version prerelease --preid beta\n```\n\n\u003e ä¸Šé¢æ‰“ tag æ˜¯ä¸ºäº† npm dist-tag èƒ½å¤ŸæŸ¥åˆ°å¯¹åº”çš„ç‰ˆæœ¬ï¼Œä»¥æ­¤æ¥åŒºåˆ†å®‰è£…ã€‚å‚æ•° preid è¡¨ç¤ºé¢„å‘çš„æ˜¯alpha/bataçš„æµ‹è¯•ç‰ˆ\n\næœ€ååˆ«å¿˜äº† git æ¨é€çš„æ—¶å€™æ‰“ä¸Š tagï¼Œè¿™æ ·ä¾¿äºç®¡ç†ï¼š\n\n```shell\ngit push --tags\n```\n\nçœ‹ä¸€ä¸‹æˆ‘å®é™…å¼€å‘çš„ä»“åº“é‡Œçš„ç‰ˆæœ¬(npm dist-tag ls)ï¼š\n\n![image.png](/img/posts/2022-12-1/2022-12-1-7.png)\n\n\u003e æµ‹è¯•ç‰ˆè¿˜å¯ä»¥ npm version prepatch æ¥å‘å¸ƒï¼ŒåŸç†ä¸€æ ·ï¼š1.0.1 --\u003e 1.0.1-0\n\n\næœ€åä¸€ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæµ‹è¯•ç‰ˆå¦‚æœæƒ³è¦è½¬æ­£ï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š\n\n```shell\nnpm version minor\n```\n\u003e è‹¥ä½ ä¹‹å‰æ˜¯åœ¨ 12 ç‰ˆæœ¬ç›´æ¥å‡ä¸Šçš„ 13.beta, è¿™é‡Œå¯ä»¥ patch å°±è¡Œ\n\nä¹‹å‰ï¼š\n\n![image.png](/img/posts/2022-12-1/2022-12-1-8.png)\n\nä¹‹åï¼š\n\n![image.png](/img/posts/2022-12-1/2022-12-1-9.png)\n\n-----\n\nå®Œ ï¼"])</script><script>self.__next_f.push([1,"39:T519e,"])</script><script>self.__next_f.push([1,"React Router v6ç‰ˆæœ¬ï¼Œå¬è¯´åˆæ›´æ–°äº†ä¸€ç‰ˆï¼Œå®˜ç½‘æ–‡æ¡£ä¹Ÿæ›´æ–°äº†ï¼ˆ6.4.2ï¼‰ã€‚è¿™é‡Œå°±æ±‡æ€»ç¿»è¯‘ä¸€ä¸‹æ–‡æ¡£æ›´æ–°çš„å†…å®¹ã€‚\n\näº†è§£å…¶ä»– React Router v6 çš„å®˜ç½‘æ–‡æ¡£ï¼Œå¯ä»¥çœ‹æˆ‘æœ¬ä¸“æ å¾€æœŸçš„æ–‡ç« ã€‚\n\n## 1. å…³äº Routers\n\nAPIåˆ›å»ºrouterå¯¹è±¡ï¼š\n\n### createBrowserRouter\n\nç±»å‹å®šä¹‰ï¼š\n\n```js\nfunction createBrowserRouter(\n  routes: RouteObject[],\n  opts?: {\n    basename?: string;\n    window?: Window;\n  }\n): RemixRouter;\n```\n\nè¿™ä¸ª API ç”¨äºä½¿ç”¨jsä»£ç åˆ›å»ºä¸€ä¸ª History routerã€‚ç¬¬äºŒä¸ªå±æ€§æ˜¯å¯é€‰å‚æ•°ï¼š\n\n- basenameï¼šç›¸å¯¹è·¯ç”±æ ¹åœ°å€\n- windowï¼šé‡æ–°æŒ‡å®šwindowå¯¹è±¡ï¼Œå¸¸ç”¨äºæµ‹è¯•ç¯å¢ƒæˆ–è€…éæµè§ˆå™¨ç¯å¢ƒ\n\nä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š\n\n\n```js\nimport {\n  createBrowserRouter,\n  RouterProvider,\n} from \"react-router-dom\";\n\nconst router = createBrowserRouter([\n  {\n    path: \"/\",\n    element: \u003cRoot /\u003e,\n    loader: rootLoader,\n    children: [\n      {\n        path: \"team\",\n        element: \u003cTeam /\u003e,\n        loader: teamLoader,\n      },\n    ],\n  },\n]);\n\nReactDOM.createRoot(document.getElementById(\"root\")).render(\n  \u003cRouterProvider router={router} /\u003e\n);\n```\n\n### createHashRouter\n\nä½¿ç”¨æ–¹å¼åŒ createBrowserRouterï¼Œåˆ›å»ºä¸€ä¸ªåŸºäºé”šç‚¹å¯¼èˆªçš„ routerã€‚\n\n### createMemoryRouter\n\nmemory routeræ˜¯ä¸€ä¸ªèƒ½å¤Ÿè‡ªå·±ç®¡ç† history stack çš„ History routerã€‚å¸¸ç”¨äºå¼€å‘å·¥å…·ï¼ˆä¾‹å¦‚StoryBookï¼‰. æµ‹è¯•æˆ–éæµè§ˆå™¨ç¯å¢ƒã€‚\n\nç±»å‹å®šä¹‰ï¼š\n\n```js\nfunction createMemoryRouter(\n  routes: RouteObject[],\n  opts?: {\n    basename?: string;\n    initialEntries?: InitialEntry[];\n    initialIndex?: number;\n    window?: Window;\n  }\n): RemixRouter;\n```\n\nä½¿ç”¨æ–¹å¼ï¼š\n\n```js\nimport {\n  RouterProvider,\n  createMemoryRouter,\n} from \"react-router-dom\";\nimport * as React from \"react\";\nimport {\n  render,\n  waitFor,\n  screen,\n} from \"@testing-library/react\";\nimport \"@testing-library/jest-dom\";\nimport CalendarEvent from \"./routes/event\";\n\ntest(\"event route\", async () =\u003e {\n  const FAKE_EVENT = { name: \"test event\" };\n  const routes = [\n    {\n      path: \"/events/:id\",\n      element: \u003cCalendarEvent /\u003e,\n      loader: () =\u003e FAKE_EVENT,\n    },\n  ];\n\n  const router = createMemoryRouter(routes, {\n    initialEntries: [\"/\", \"/events/123\"],\n    initialIndex: 1,\n  });\n\n  render(\u003cRouterProvider router={router} /\u003e);\n\n  await waitFor(() =\u003e screen.getByRole(\"heading\"));\n  expect(screen.getByRole(\"heading\")).toHaveTextContent(\n    FAKE_EVENT.name\n  );\n});\n```\n\nå…¶ä¸­çš„å‚æ•°ï¼š\n\n- initialEntriesï¼šåˆå§‹åŒ–çš„ history stack\n- initialIndexï¼šåˆå§‹åŒ–æ˜¾ç¤ºçš„ history stack çš„ä¸‹æ ‡\n\n\n### RouterProvider\n\nç»™ä¸Šè¿°åˆ›å»ºrouterçš„APIæä¾›ä¸€ä¸ªå®¹å™¨ã€‚å…¶æœ‰ç¬¬äºŒä¸ªå‚æ•° `fallbackElement={\u003cSpinnerOfDoom /\u003e}`ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªåœ¨è·¯ç”±åŠ è½½è¿‡ç¨‹ä¸­ loadingçš„è‡ªå®šä¹‰ç»„ä»¶ã€‚\n\n## 2. å…³äº Route ç»„ä»¶\n\n### æ·»åŠ æ–°å±æ€§ loader\n\nè·¯ç”±åœ¨æ¸²æŸ“ä¹‹å‰åŠ è½½çš„åŠ è½½å™¨ã€‚å½“è·¯ç”±è·³è½¬æ—¶ï¼Œloaderå‡½æ•°ä¼šå¼‚æ­¥çš„æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨ç›®æ ‡è·¯ç”±ç»„ä»¶ä¸­å¯ä»¥è·å–åˆ°ã€‚\n\nä½¿ç”¨æ–¹å¼ï¼š\n```js\n {\n    element: \u003cTeam /\u003e,\n    path: \":teamId\",\n    loader: async ({ params }) =\u003e {\n      return fetch(`/api/teams/${params.teamId}.json`);\n    },\n  },\n```\n\nå‚æ•° params æ˜¯è·¯ç”±å‚æ•°ã€‚å¯ä»¥è¿”å›ä»»ä½•ä½ æƒ³è¦çš„å†…å®¹ï¼Œæ¨èä½¿ç”¨ fetch æˆ–è€… Promiseã€‚\n\nloader åŠ è½½çš„æ•°æ®å¯ä»¥åœ¨è·³è½¬ä¹‹åçš„ç•Œé¢ é€šè¿‡ useLoaderData è·å–ã€‚ä½¿ç”¨æ–¹å¼è§ä¸‹é¢ hooks çš„æ›´æ–°å†…å®¹ã€‚\n\n### æ·»åŠ æ–°å±æ€§ action\n\næä¾›ä¸€ç§è·¯ç”±åˆ‡æ¢æ—¶è§¦å‘çš„æ–¹æ³•ã€‚è¯¥æ–¹å¼å…è®¸åœ¨è·¯ç”±è·³è½¬æ—¶æ¨é€ä¸€ä¸ª ajax è¯·æ±‚å‡ºå»ã€‚\n\nä½¿ç”¨æ–¹å¼ï¼š\n\n```js\n// å®šä¹‰\n\u003cRoute\n  path=\"/song/:songId/edit\"\n  element={\u003cEditSong /\u003e}\n  action={async ({ params, request }) =\u003e {\n    let formData = await request.formData();\n    return fakeUpdateSong(params.songId, formData);\n  }}\n  loader={({ params }) =\u003e {\n    return fakeGetSong(params.songId);\n  }}\n/\u003e\n\n// forms\n\u003cForm method=\"post\" action=\"/songs\" /\u003e;\n\u003cfetcher.Form method=\"put\" action=\"/songs/123/edit\" /\u003e;\n\n// imperative submissions\nlet submit = useSubmit();\nsubmit(data, {\n  method: \"delete\",\n  action: \"/songs/123\",\n});\nfetcher.submit(data, {\n  method: \"patch\",\n  action: \"/songs/123/edit\",\n});\n\n```\n\nè§¦å‘æ–¹å¼ä¸ºéGETç±»çš„è¯·æ±‚ï¼Œå¹¶æä¾›ä¸¤ä¸ªå‚æ•°ï¼š\n\n- params è·¯ç”±åŠ¨æ€å‚æ•°\n- request fetchè¯·æ±‚çš„å®ä¾‹\n\n### errorElement\n\nåªé€‚ç”¨äºAPIåŠ¨æ€åˆ›å»ºçš„routerã€‚ä½¿ç”¨æ–¹å¼ï¼š\n```jsx\n\u003cRoute\n  path=\"/invoices/:id\"\n  // if an exception is thrown here\n  loader={loadInvoice}\n  // here\n  action={updateInvoice}\n  // or here\n  element={\u003cInvoice /\u003e}\n  // this will render instead of `element`\n  errorElement={\u003cErrorBoundary /\u003e}\n/\u003e;\n\nfunction Invoice() {\n  return \u003cdiv\u003eHappy {path}\u003c/div\u003e;\n}\n\nfunction ErrorBoundary() {\n  let error = useRouteError();\n  console.error(error);\n  // Uncaught ReferenceError: path is not defined\n  return \u003cdiv\u003eDang!\u003c/div\u003e;\n}\n```\næä¾›ä¸€ç§è·¯ç”±è·³è½¬é”™è¯¯åçš„è¡¥æ•‘æ–¹æ¡ˆã€‚åœ¨action. loaderæˆ–è€…ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹ä¸­æŠ›å‡ºé”™è¯¯åï¼Œå¯ä»¥åœ¨è¿™é‡Œæ•è·å¹¶ä»£æ›¿æ˜¾ç¤ºè‡ªå®šä¹‰çš„é”™è¯¯ç•Œé¢ã€‚\n\n### shouldRevalidate\n\nä½œä¸ºä¸€ä¸ªä¼˜åŒ–é¡¹ï¼Œç”¨äºå¯¹loaderåšæ ¡éªŒã€‚ä»–æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è·¯ç”± loader è·å–æ•°æ®ä¹‹å‰è°ƒç”¨ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœè¿”å›å¸ƒå°”å€¼ï¼Œæœ¬æ¬¡ loader å‡½æ•°å°†ä¸ä¼šè°ƒç”¨ï¼Œç•Œé¢æ•°æ®ä¸ä¼šæ”¹å˜ã€‚\n\nä½¿ç”¨æ–¹å¼ï¼š\n```jsx\n\u003cRoute\n  path=\"meals-plans\"\n  element={\u003cMealPlans /\u003e}\n  loader={loadMealPlans}\n  shouldRevalidate={({ currentUrl }) =\u003e {\n    // only revalidate if the submission originates from\n    // the `/meal-plans/new` route.\n    return currentUrl.pathname === \"/meal-plans/new\";\n  }}\n\u003e\n  \u003cRoute\n    path=\"new\"\n    element={\u003cNewMealPlanForm /\u003e}\n    // `loadMealPlans` will be revalidated after\n    // this action...\n    action={createMealPlan}\n  /\u003e\n  \u003cRoute\n    path=\":planId/meal\"\n    element={\u003cMeal /\u003e}\n    // ...but not this one because origin the URL\n    // is not \"/meal-plans/new\"\n    action={updateMeal}\n  /\u003e\n\u003c/Route\u003e\n```\n\n## 3. å…³äºè·¯ç”±ç»„ä»¶\n\n### Await\n\næ˜¯ä¸€ç§ç±»ä¼¼äº React è·¯ç”±æ‡’åŠ è½½ï¼ˆlazyï¼‰çš„å·¥å…·ã€‚ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š\n\n```jsx\nimport { Await, useLoaderData } from \"react-router-dom\";\n\nfunction Book() {\n  const { book, reviews } = useLoaderData();\n  return (\n    \u003cdiv\u003e\n      \u003ch1\u003e{book.title}\u003c/h1\u003e\n      \u003cp\u003e{book.description}\u003c/p\u003e\n      \u003cReact.Suspense fallback={\u003cReviewsSkeleton /\u003e}\u003e\n        \u003cAwait\n          resolve={reviews}\n          errorElement={\n            \u003cdiv\u003eCould not load reviews ğŸ˜¬\u003c/div\u003e\n          }\n          children={(resolvedReviews) =\u003e (\n            \u003cReviews items={resolvedReviews} /\u003e\n          )}\n        /\u003e\n      \u003c/React.Suspense\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Form\n\nv6ç‰ˆè·¯ç”±ï¼Œå¯¹äº plain HTMLÂ form è¿›è¡Œäº†ä¸€ä¸ªåŒ…è£…ã€‚ç›®å‰ä»…ä»…åœ¨ä½¿ç”¨ API åˆ›å»ºè·¯ç”±å®ä¾‹çš„åœºæ™¯ä¸­ä½¿ç”¨ã€‚\n\n```jsx\nimport { Form } from \"react-router-dom\";\n\nfunction NewEvent() {\n  return (\n    \u003cForm method=\"post\" action=\"/events\"\u003e\n      \u003cinput type=\"text\" name=\"title\" /\u003e\n      \u003cinput type=\"text\" name=\"description\" /\u003e\n      \u003cbutton type=\"submit\"\u003eCreate\u003c/button\u003e\n    \u003c/Form\u003e\n  );\n}\n```\n\nå±æ€§å‚æ•°ä»‹ç»ï¼š\n\n- actionï¼šform submit çš„ urlã€‚å’ŒåŸç”Ÿformå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œä»–çš„é»˜è®¤urlæ˜¯æœ€è¿‘åŒ¹é…åˆ°çš„ç›¸å¯¹è·¯ç”±\n- methodï¼šè¡¨å•æäº¤çš„æ–¹æ³•\n- replaceï¼šæ”¹å˜ history stack çš„åˆ‡æ¢æ–¹å¼\n- relativeï¼šè®¾ç½®ç›¸å¯¹è·¯ç”±çš„æ ¹è·¯ç”±\n- reloadDocumentï¼šè·³è¿‡ React Router å¹¶ä½¿ç”¨æµè§ˆå™¨çš„å†…ç½®è¡Œä¸ºæäº¤è¡¨å•\n\nç»¼åˆä½¿ç”¨æ¡ˆä¾‹ï¼š\n\n\u003e **æ€»ç»“**ï¼šaction å¯ä»¥æ¥å— element ç»„ä»¶ä¸­ä¼ å…¥çš„è¯·æ±‚å®ä¾‹ï¼Œåœ¨actionä¸­è¿›è¡Œä½¿ç”¨ã€‚è€Œç´§æ¥ç€ï¼Œelement ç»„ä»¶ä¸­ï¼Œåˆå¯ä»¥é€šè¿‡ useLoaderData ä½¿ç”¨ loader é‡ŒåŠ è½½è¿›æ¥çš„æ•°æ®ã€‚\n\n```jsx\n\u003cRoute\n  path=\"/projects/:id\"\n  element={\u003cProject /\u003e}\n  loader={async ({ params }) =\u003e {\n    return fakeLoadProject(params.id)\n  }}\n  action={async ({ request, params }) =\u003e {\n    switch (request.method) {\n      case \"put\": {\n        let formData = await request.formData();\n        let name = formData.get(\"projectName\");\n        return fakeUpdateProject(name);\n      }\n      case \"delete\": {\n        return fakeDeleteProject(params.id);\n      }\n      default {\n        throw new Response(\"\", { status: 405 })\n      }\n    }\n  }}\n/\u003e;\n\nfunction Project() {\n  let project = useLoaderData();\n\n  return (\n    \u003c\u003e\n      \u003cForm method=\"put\"\u003e\n        \u003cinput\n          type=\"text\"\n          name=\"projectName\"\n          defaultValue={project.name}\n        /\u003e\n        \u003cbutton type=\"submit\"\u003eUpdate Project\u003c/button\u003e\n      \u003c/Form\u003e\n\n      \u003cForm method=\"delete\"\u003e\n        \u003cbutton type=\"submit\"\u003eDelete Project\u003c/button\u003e\n      \u003c/Form\u003e\n    \u003c/\u003e\n  );\n}\n```\n\n### ScrollRestoration\n\nç”¨äºåœ¨æµè§ˆå™¨ locationå˜åŒ–åï¼Œä¿æŒæ»šåŠ¨æ¡çš„ä½ç½®ã€‚ä»…ä»…åœ¨ API åˆ›å»ºè·¯ç”±å¯¹è±¡æ—¶æœ‰æ•ˆã€‚\n\næ¨èåœ¨æ ¹è·¯ç”±ä¸­ä½¿ç”¨ï¼Œä½¿ç”¨æ–¹å¼ï¼š\n\n```jsx\nimport { ScrollRestoration } from \"react-router-dom\";\n\nfunction RootRouteComponent() {\n  return (\n    \u003cdiv\u003e\n      {/* ... */}\n      \u003cScrollRestoration\n        getKey={(location, matches) =\u003e {\n          // default behavior\n          return location.key;\n        }}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nå‚æ•°ï¼š\n\n- getKeyï¼šReact Router ç¼“å­˜æ»šåŠ¨ä½ç½®çš„key\n- preventScrollResetï¼šå½“åˆ›å»ºä¸€ä¸ªæ–°çš„ scroll keyæ—¶ï¼Œé¡µé¢æ»šåŠ¨ä½ç½®ä¼šè¢«é‡ç½®åœ¨é¡¶éƒ¨ã€‚ä½ å¯ä»¥å°†è¯¥å‚æ•°è®¾ç½®ä¸º true æ¥é˜»æ­¢é¡µé¢è¢«é‡ç½®å›é¡¶éƒ¨\n\n\u003chr /\u003e\n\n\n## 4. Hooks\n\n### useActionData\n\næä¾›ä¸Šä¸€ä¸ªè·³è½¬æ—¶ action çš„è¿”å›å€¼ã€‚å¦‚æœæ²¡æœ‰è¿”å›å€¼ï¼Œåˆ™æ˜¯ undefinedã€‚\n\nä½¿ç”¨æ–¹å¼ï¼ˆæœ€å¸¸ç”¨çš„å°±æ˜¯è¡¨å•éªŒè¯ï¼‰ï¼š\n\n```jsx\nimport {\n  useActionData,\n  Form,\n  redirect,\n} from \"react-router-dom\";\n\nexport default function SignUp() {\n  // 2. è·å– action è¿”å›å€¼\n  const errors = useActionData();\n\n  return (\n    \u003cForm method=\"post\"\u003e\n      \u003cp\u003e\n        \u003cinput type=\"text\" name=\"email\" /\u003e\n        {errors?.email \u0026\u0026 \u003cspan\u003e{errors.email}\u003c/span\u003e}\n      \u003c/p\u003e\n\n      \u003cp\u003e\n        \u003cinput type=\"text\" name=\"password\" /\u003e\n        {errors?.password \u0026\u0026 \u003cspan\u003e{errors.password}\u003c/span\u003e}\n      \u003c/p\u003e\n\n      \u003cp\u003e\n        \u003cbutton type=\"submit\"\u003eSign up\u003c/button\u003e\n      \u003c/p\u003e\n    \u003c/Form\u003e\n  );\n}\n\nexport async function action({ request }) {\n  const formData = await request.formData();\n  const email = formData.get(\"email\");\n  const password = formData.get(\"password\");\n  const errors = {};\n\n  // validate the fields\n  if (typeof email !== \"string\" || !email.includes(\"@\")) {\n    errors.email =\n      \"That doesn't look like an email address\";\n  }\n\n  if (typeof password !== \"string\" || password.length \u003c 6) {\n    errors.password = \"Password must be \u003e 6 characters\";\n  }\n\n  // return data if we have errors\n  if (Object.keys(errors).length) {\n    // 1. action ä¸­ return ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯ redirect\n    return errors;\n  }\n\n  // otherwise create the user and redirect\n  await createUser(email, password);\n  return redirect(\"/dashboard\");\n}\n```\n\n### useAsyncError\n\nè¿”å› Await ç»„ä»¶ çš„rejectçš„å€¼ï¼š\n\n```jsx\nimport { useAsyncError, Await } from \"react-router-dom\";\n\nfunction ErrorElement() {\n  const error = useAsyncError();\n  return (\n    \u003cp\u003eUh Oh, something went wrong! {error.message}\u003c/p\u003e\n  );\n}\n\n\u003cAwait\n  resolve={promiseThatRejects}\n  errorElement={\u003cErrorElement /\u003e}\n/\u003e;\n```\n\n### useAsyncValue\n\nè¿”å› Await ç»„ä»¶çš„ resolve å€¼ï¼š\n\n```jsx\nfunction ProductVariants() {\n  const variants = useAsyncValue();\n  return \u003cdiv\u003e{/* ... */}\u003c/div\u003e;\n}\n\n// Await creates the context for the value\n\u003cAwait resolve={somePromiseForProductVariants}\u003e\n  \u003cProductVariants /\u003e\n\u003c/Await\u003e;\n```\n\n### useFetcher\n\n\u003e useFetcherä»…ä»…åœ¨ä½¿ç”¨ API åˆ›å»ºrouterå®ä¾‹ä¸­æœ‰æ•ˆã€‚\n\n\nå½“ä½ éœ€è¦ï¼š\n\n- è·å–ä¸ UI è·¯ç”±æ— å…³çš„æ•°æ®ï¼ˆå¼¹å‡ºæ¡†. åŠ¨æ€è¡¨å•ç­‰ï¼‰\n- æ— éœ€å¯¼èˆªå³å¯å°†æ•°æ®æäº¤çš„æ“ä½œï¼ˆå…±äº«ç»„ä»¶ï¼Œå¦‚å®æ—¶é€šè®¯æ³¨å†Œï¼‰\n- å¤„ç†åˆ—è¡¨ä¸­çš„å¤šä¸ªå¹¶å‘æäº¤ï¼ˆå…¸å‹çš„â€œå¾…åŠäº‹é¡¹åº”ç”¨ç¨‹åºâ€åˆ—è¡¨ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å•å‡»å¤šä¸ªæŒ‰é’®ï¼Œå¹¶ä¸”æ‰€æœ‰æŒ‰é’®éƒ½åº”åŒæ—¶å¤„äºå¾…å¤„ç†çŠ¶æ€ï¼‰\n- æ— é™æ»šåŠ¨å®¹å™¨\n\nç­‰ç­‰ï¼ŒuseFetcher å¯ä»¥å¸®åŠ©åˆ°ä½ ï¼š\n\n```jsx\nimport { useFetcher } from \"react-router-dom\";\n\nfunction SomeComponent() {\n  const fetcher = useFetcher();\n\n  // æäº¤åŠ¨ä½œ\n  React.useEffect(() =\u003e {\n    fetcher.submit(data, options);\n    fetcher.load(href);\n  }, [fetcher]);\n\n  // å¯ä»¥ç›´æ¥è·å–æ•°æ®\n  fetcher.state;\n  fetcher.formData;\n  fetcher.formMethod;\n  fetcher.formAction;\n  fetcher.data;\n\n  // ä¸ä¼šè§¦å‘è·¯ç”±å¯¼èˆªçš„è¡¨å•\n  return \u003cfetcher.Form /\u003e;\n}\n```\n\n\nfetchers æœ‰å¾ˆå¤šå†…ç½®çš„è¡Œä¸ºï¼š\n\n- ä¸­æ–­æ—¶ï¼Œè‡ªåŠ¨å¤„ç†fetchå–æ¶ˆ\n- ä½¿ç”¨ POST. PUT. PATCH. DELETE æäº¤æ—¶ï¼Œé¦–å…ˆè°ƒç”¨è¯¥æ“ä½œï¼š\n    - æ“ä½œå®Œæˆåï¼Œé¡µé¢ä¸Šçš„æ•°æ®å°†é‡æ–°éªŒè¯ä»¥æ•è·å¯èƒ½å‘ç”Ÿçš„ä»»ä½•çªå˜ï¼Œè‡ªåŠ¨ä½¿æ‚¨çš„ UI ä¸æ‚¨çš„æœåŠ¡å™¨çŠ¶æ€ä¿æŒåŒæ­¥\n- å½“å¤šä¸ª fetcher åŒæ—¶è¿è¡Œæ—¶ï¼Œå®ƒä¼šï¼š\n    - åœ¨ä»–ä»¬æ¯æ¬¡ç™»é™†æ—¶æäº¤æœ€æ–°çš„å¯ç”¨æ•°æ®\n    - ç¡®ä¿æ²¡æœ‰é™ˆæ—§çš„è´Ÿè½½è¦†ç›–æ›´æ–°çš„æ•°æ®ï¼Œæ— è®ºå“åº”è¿”å›çš„é¡ºåºå¦‚ä½•\n- é€šè¿‡å‘ˆç°æœ€è¿‘çš„ errorElement æ¥å¤„ç†æœªæ•è·çš„é”™è¯¯ï¼ˆå°±åƒæ¥è‡ª \\\u003cLink\u003e æˆ– \\\u003cForm\u003e çš„æ­£å¸¸å¯¼èˆªï¼‰\n- å¦‚æœæ‚¨çš„æ“ä½œ/åŠ è½½ç¨‹åºè¢«è°ƒç”¨è¿”å›é‡å®šå‘ï¼Œå°†é‡å®šå‘åº”ç”¨ç¨‹åºï¼ˆå°±åƒæ¥è‡ª \\\u003cLink\u003e æˆ– \\\u003cForm\u003e çš„æ­£å¸¸å¯¼èˆªä¸€æ ·ï¼‰\n\n\n\nå…¶ä¸­å„ä¸ªå±æ€§çš„è®²è§£ï¼š\n\n- `fetcher.state`: æäº¤çš„çŠ¶æ€ï¼Œæšä¸¾å¦‚ä¸‹ï¼š\n    -   **idle**Â - nothing is being fetched.\n    -   **submitting**Â - A route action is being called due to a fetcher submission using POST, PUT, PATCH, or DELETE\n    -   **loading**Â - The fetcher is calling a loader (from aÂ `fetcher.load`) or is being revalidated after a separate submission orÂ `useRevalidator`Â call\n- `fetcher.Form`: ä¸ä¼šå¯¼èˆªçš„è¡¨å•\n- `fetcher.load`: é€šè¿‡ router loader åŠ è½½æ•°æ®ï¼š \n```js\nif (fetcher.state === \"idle\" \u0026\u0026 !fetcher.data) {\n    fetcher.load(\"/some/route\");\n}\n```\n- `fetcher.submit`: æ¨¡æ‹Ÿfetcher.Form çš„æäº¤åŠ¨ä½œã€‚æ¯”å¦‚ä¸€ä¸ªç”¨æˆ·ç™»å‡ºçš„æ“ä½œï¼š\n\n```jsx\nimport { useFetcher } from \"react-router-dom\";\nimport { useFakeUserIsIdle } from \"./fake/hooks\";\n\nexport function useIdleLogout() {\n  const fetcher = useFetcher();\n  const userIsIdle = useFakeUserIsIdle();\n\n  useEffect(() =\u003e {\n    if (userIsIdle) {\n      fetcher.submit(\n        { idle: true },\n        { method: \"post\", action: \"/logout\" }\n      );\n    }\n  }, [userIsIdle]);\n}\n```\n\n- `fetcher.data`: loader æˆ–è€… action è¿”å›çš„æ•°æ®ä¼šå­˜å‚¨åœ¨è¿™é‡Œ\n- `fetcher.formData`: å½“ä½¿ç”¨`\u003cfetcher.Form\u003e`Â orÂ `fetcher.submit()`æ—¶ï¼ŒformData å¯ä»¥ç”¨æ¥è·å–æäº¤æ•°æ®ï¼š\n\n```jsx\nfunction TaskCheckbox({ task }) {\n  let fetcher = useFetcher();\n\n  // é€šè¿‡ get æ–¹æ³•å¯ä»¥è·å–åˆ°formDataå†…çš„å€¼ï¼Œåå‘å½±å“æäº¤è¡¨å•çš„æ¸²æŸ“\n  let status =\n    fetcher.formData?.get(\"status\") || task.status;\n\n  let isComplete = status === \"complete\";\n\n  return (\n    \u003cfetcher.Form method=\"post\"\u003e\n      \u003cbutton\n        type=\"submit\"\n        name=\"status\"\n        value={isComplete ? \"incomplete\" : \"complete\"}\n      \u003e\n        {isComplete ? \"Mark Incomplete\" : \"Mark Complete\"}\n      \u003c/button\u003e\n    \u003c/fetcher.Form\u003e\n  );\n}\n```\n\n- `fetcher.formAction`: è·å–å½“å‰æäº¤çš„ action çš„ url\n- `fetcher.formMethod`: è·å–å½“å‰æäº¤çš„ action çš„ method\n\n\n### useFetchers\n\nè¿”å›æ‰€æœ‰fetcherçš„æ•°ç»„ï¼Œä½†ä¸æºå¸¦Â `load`,Â `submit`, Â `Form`Â ä¿¡æ¯ã€‚\n\n### useFormAction\n\nç±»å‹å®šä¹‰ï¼š\n```tsx\ndeclare function useFormAction(\n  action?: string,\n  { relative }: { relative?: RelativeRoutingType } = {}\n): string;\n```\n\nå¯¹action çš„urlåŒ…è£…äº†ä¸€å±‚ï¼Œä¼šè‡ªåŠ¨è§£æç›¸å¯¹è·¯å¾„ã€‚è¯¥ä½¿ç”¨ä¸å¤ªå¸¸è§ã€‚\n\nä½¿ç”¨æ–¹å¼ï¼š\n```jsx\nimport { useFormAction } from \"react-router-dom\";\n\nfunction DeleteButton() {\n  return (\n    \u003cbutton\n      formAction={useFormAction(\"destroy\")}\n      formMethod=\"post\"\n    \u003e\n      Delete\n    \u003c/button\u003e\n  );\n}\n```\n\n### useLoaderData\n\nç”¨æˆ·è·å–route loaderçš„è¿”å›å€¼ã€‚\n\nä½¿ç”¨æ–¹å¼ï¼š\n```jsx\nimport {\n  createBrowserRouter,\n  RouterProvider,\n  useLoaderData,\n} from \"react-router-dom\";\n\nfunction loader() {\n  return fetchFakeAlbums();\n}\n\nexport function Albums() {\n  const albums = useLoaderData();\n  // ...\n}\n\nconst router = createBrowserRouter([\n  {\n    path: \"/\",\n    loader: loader,\n    element: \u003cAlbums /\u003e,\n  },\n]);\n\nReactDOM.createRoot(el).render(\n  \u003cRouterProvider router={router} /\u003e\n);\n```\n\nuseLoaderData ä¸ä¼šé‡å¤æå–æ•°æ®ã€‚å®ƒåªæ˜¯è¯»å– React Router å†…éƒ¨ç®¡ç†çš„ fetch çš„ç»“æœï¼Œå½“å®ƒç”±äºè·¯ç”±ä¹‹å¤–çš„åŸå› é‡æ–°æ¸²æŸ“æ—¶ï¼Œæ‚¨æ— éœ€æ‹…å¿ƒå®ƒä¼šé‡æ–°è·å–ã€‚è¿™ä¹Ÿæ„å‘³ç€è¿”å›æ•°æ®å’Œæ¸²æŸ“ä¹‹é—´ï¼Œdataæ˜¯ç¨³å®šçš„ï¼Œå› æ­¤æ‚¨å¯ä»¥å®‰å…¨åœ°å°†å…¶ä¼ é€’ç»™ React é’©å­ï¼ˆå¦‚ useEffectï¼‰ä¸­çš„ä¾èµ–æ•°ç»„ã€‚åªæœ‰åœ¨æ“ä½œæˆ–æŸäº›å¯¼èˆªåå†æ¬¡è°ƒç”¨åŠ è½½ç¨‹åºæ—¶ï¼Œå®ƒæ‰ä¼šæ›´æ”¹ã€‚\n\n\n### useMatches\n\nè¿”å›å½“å‰åŒ¹é…çš„è·¯ç”±é¡¹ã€‚ä½¿ç”¨æ¡ˆä¾‹ï¼šé¢åŒ…å±‘å¯¼èˆªï¼š\n\n```jsx\n// è·¯ç”±è¡¨\n\u003cRoute element={\u003cRoot /\u003e}\u003e\n  \u003cRoute\n    path=\"messages\"\n    element={\u003cMessages /\u003e}\n    loader={loadMessages}\n    handle={{\n      // you can put whatever you want on a route handle\n      // here we use \"crumb\" and return some elements,\n      // this is what we'll render in the breadcrumbs\n      // for this route\n      crumb: () =\u003e \u003cLink to=\"/message\"\u003eMessages\u003c/Link\u003e,\n    }}\n  \u003e\n    \u003cRoute\n      path=\"conversation/:id\"\n      element={\u003cThread /\u003e}\n      loader={loadThread}\n      handle={{\n        // `crumb` is your own abstraction, we decided\n        // to make this one a function so we can pass\n        // the data from the loader to it so that our\n        // breadcrumb is made up of dynamic content\n        crumb: (data) =\u003e \u003cspan\u003e{data.threadName}\u003c/span\u003e,\n      }}\n    /\u003e\n  \u003c/Route\u003e\n\u003c/Route\u003e\n\n// å¯¼èˆªç»„ä»¶\nfunction Breadcrumbs() {\n  let matches = useMatches();\n  let crumbs = matches\n    // first get rid of any matches that don't have handle and crumb\n    .filter((match) =\u003e Boolean(match.handle?.crumb))\n    // now map them into an array of elements, passing the loader\n    // data to each one\n    .map((match) =\u003e match.handle.crumb(match.data));\n\n  return (\n    \u003col\u003e\n      {crumbs.map((crumb, index) =\u003e (\n        \u003cli key={index}\u003e{crumb}\u003c/li\u003e\n      ))}\n    \u003c/ol\u003e\n  );\n}\n```\n\n### useNavigation\n\nè·å–è·¯ç”±åŠ è½½è¿‡ç¨‹ä¸­çš„å„ç§å¯¼èˆªå‚æ•°ï¼Œä½¿ç”¨åœºæ™¯ï¼š\n\n- å…¨å±€åŠ è½½ loading\n- éœ€è¦å…¨å±€ç¦ç”¨ form\n- æäº¤æ—¶è¡¨å•å¤„ç†ä¸­çš„åŠ¨ç”»\n- ...\n\nä½¿ç”¨æ–¹å¼ï¼š\n\n```jsx\nimport { useNavigation } from \"react-router-dom\";\n\nfunction SomeComponent() {\n  const navigation = useNavigation();\n  navigation.state; // idle â†’ submitting â†’ loading â†’ idle\n  navigation.location;\n  navigation.formData;\n  navigation.formAction;\n  navigation.formMethod;\n}\n```\n\n### useRevalidator\n\nç”¨äºé‡æ–°éªŒè¯æ•°æ®çš„åœºæ™¯ï¼Œä½¿ç”¨æ–¹å¼ï¼š\n```jsx\nimport { useRevalidator } from \"react-router-dom\";\n\nfunction WindowFocusRevalidator() {\n  let revalidator = useRevalidator();\n\n  useFakeWindowFocus(() =\u003e {\n    revalidator.revalidate();\n  });\n\n  return (\n    \u003cdiv hidden={revalidator.state === \"idle\"}\u003e\n      Revalidating...\n    \u003c/div\u003e\n  );\n}\n```\n\n### useRouteError\n\nåœ¨ errorElementå±æ€§ç»„ä»¶å†…éƒ¨ä½¿ç”¨ï¼Œè¿”å›ä»»ä½•è·¯ç”±ä¸­å‡ºç°çš„é”™è¯¯ã€‚ä½¿ç”¨æ–¹å¼ï¼š\n\n```jsx\nfunction ErrorBoundary() {\n  const error = useRouteError();\n  console.error(error);\n  return \u003cdiv\u003e{error.message}\u003c/div\u003e;\n}\n\n\u003cRoute\n  errorElement={\u003cErrorBoundary /\u003e}\n  loader={() =\u003e {\n    // unexpected errors in loaders/actions\n    something.that.breaks();\n  }}\n  action={() =\u003e {\n    // stuff you throw on purpose in loaders/actions\n    throw new Response(\"Bad Request\", { status: 400 });\n  }}\n  element={\n    // and errors thrown while rendering\n    \u003cdiv\u003e{breaks.while.rendering}\u003c/div\u003e\n  }\n/\u003e;\n```\n\n### useRouteLoaderData\n\næ”¶é›†è·¯ç”±æ ‘ä¸Šæ‰€æœ‰çš„loaderæ•°æ®ã€‚åœ¨éœ€è¦å…¨å±€æŠŠæ§å¤šåµŒå¥—è·¯ç”±å‚æ•°æ—¶æ¯”è¾ƒæœ‰ç”¨ã€‚\n\nä½¿ç”¨æ–¹å¼ï¼š\n\n```jsx\ncreateBrowserRouter([\n  {\n    path: \"/\",\n    loader: () =\u003e fetchUser(),\n    element: \u003cRoot /\u003e,\n    id: \"root\",\n    children: [\n      {\n        path: \"jobs/:jobId\",\n        loader: loadJob,\n        element: \u003cJobListing /\u003e,\n      },\n    ],\n  },\n]);\n\n...\nconst user = useRouteLoaderData(\"root\");\n```\n\né€šè¿‡è·¯ç”±çš„idæ¥è¯†åˆ«è·¯ç”±æ ‘çš„èµ·ç‚¹ã€‚\n\n### useSubmit\n\nåŠ¨æ€æäº¤è¡¨å•ã€‚ä½¿ç”¨æ–¹å¼ï¼š\n```jsx\nimport { useSubmit, Form } from \"react-router-dom\";\n\nfunction SearchField() {\n  let submit = useSubmit();\n  return (\n    \u003cForm\n      onChange={(event) =\u003e {\n        submit(event.currentTarget, { method: \"post\", action: \"/check\" });\n      }}\n    \u003e\n      \u003cinput type=\"text\" name=\"search\" /\u003e\n      \u003cbutton type=\"submit\"\u003eSearch\u003c/button\u003e\n    \u003c/Form\u003e\n  );\n}\n```\n\n## 5. æ–°å¢å°å·¥å…·\n\n### json\n\njsonè½¬æ¢å·¥å…·ï¼š\n\n```jsx\nimport { json } from \"react-router-dom\";\n\nconst loader = async () =\u003e {\n  const data = getSomeData();\n  return json(data);\n};\n```\n\n### redirect\n\né‡å®šå‘ã€‚åœ¨ loader å’Œ action ä¸­æ¨èä½¿ç”¨ï¼Œè€Œä¸æ˜¯ useNavigateï¼Œä»–ç­‰ä»·äºå¦‚ä¸‹æ“ä½œï¼š\n\n```js\nnew Response(\"\", {\n  status: 302,\n  headers: {\n    Location: someUrl,\n  },\n});\n```\nä½¿ç”¨æ¡ˆä¾‹ï¼š\n```jsx\nimport { redirect } from \"react-router-dom\";\n\nconst loader = async () =\u003e {\n  const user = await getUser();\n  if (!user) {\n    return redirect(\"/login\");\n  }\n};\n```"])</script><script>self.__next_f.push([1,"3a:T2246,"])</script><script>self.__next_f.push([1,"æœ¬æœŸè®²ä¸€ä¸‹ `React Router v6` çš„utilsåº“ä¸­çš„å†…ç½®æ–¹æ³•ã€‚æœ¬æ–‡åªåœ¨æ˜é‡‘å‘å¸ƒã€‚\n\n\u003e ä¸“æ è¯´æ˜ï¼šå¯¹äºreact-router v6ç‰ˆæœ¬ï¼Œæœ‰åŒäº‹åæ˜ ç¼ºå°‘ç›¸å¯¹å®Œæ•´çš„ä¸­æ–‡æ–‡æ¡£ï¼ŒæŸ¥çœ‹ä¸æ–¹ä¾¿ã€‚ä¸ºäº†ä¾¿äºä½¿ç”¨ï¼Œä½œè€…å¯¹[å®˜ç½‘æ–‡æ¡£](https://link.juejin.cn/?target=https%3A%2F%2Freactrouter.com%2Fdocs%2Fen%2Fv6 \"https://link.juejin.cn/?target=https%3A%2F%2Freactrouter.com%2Fdocs%2Fen%2Fv6\")è¿›è¡Œé’ˆå¯¹æ€§ç¿»è¯‘ï¼Œä¾¿äºv6ç‰ˆæœ¬æ›´å¹¿æ³›çš„è¢«ä½¿ç”¨ã€‚\n\n\n## 1. createRoutesFromChildren\n\nç±»å‹å®šä¹‰ï¼š\n\n```ts\ndeclare function createRoutesFromChildren(\n  children: React.ReactNode\n): RouteObject[];\n\n// è¿”å›å€¼\ninterface RouteObject {\n  caseSensitive?: boolean;\n  children?: RouteObject[];\n  element?: React.ReactNode;\n  index?: boolean;\n  path?: string;\n}\n```\n`createRoutesFromChildren`Â é€šå¸¸åœ¨Â `\u003cRoute\u003e`Â å­å…ƒç´ ä¸­ä½¿ç”¨ï¼Œç”¨äºç”Ÿæˆå­ route çš„é…ç½®é¡¹ã€‚å¯ä»¥æŠŠ `\u003cRoute\u003e` ç±»å‹çš„ react element å¯¹è±¡ï¼Œå˜æˆäº†æ™®é€šçš„ route å¯¹è±¡ç»“æ„ã€‚å…¶å†…éƒ¨é€šè¿‡ React.Children.forEach æŠŠ Route ç»„ä»¶ç»™ç»“æ„åŒ–ï¼Œå¹¶ä¸”å†…éƒ¨è°ƒç”¨é€’å½’ï¼Œæ·±åº¦é€’å½’ children ç»“æ„ã€‚\n\nç¤ºä¾‹ï¼š\n\nè¾“å…¥\n```js\n\u003cRoutes\u003e \n    \u003cRoute element={\u003cHome /\u003e} path=\"/home\" /\u003e \n    \u003cRoute element={\u003cList/\u003e} path=\"/list\" /\u003e \n    \u003cRoute element={\u003cLayout/\u003e} path=\"/children\" \u003e \n        \u003cRoute element={\u003cChild1/\u003e} path=\"/children/child1\" /\u003e \n        \u003cRoute element={\u003cChild2/\u003e} path=\"/children/child2\" /\u003e \n    \u003c/Route\u003e \n\u003c/Routes\u003e\n```\nè¾“å‡º\n\n![1](/img/posts/2022-9-19/2022-9-19-1.png)\n\n## 2. createSearchParams\n\nç±»å‹å®šä¹‰ï¼š\n\n\n```ts\ndeclare function createSearchParams(\n  init?: URLSearchParamsInit\n): URLSearchParams;\n```\n\n`createSearchParams` é€šå¸¸ä¸ `useSearchParams` é…å¯¹ä½¿ç”¨ï¼Œç”¨äº search ä¼ å‚æ—¶æ„å»ºå‚æ•°ã€‚\n\nç¤ºä¾‹ï¼š\n\n```js\n// ä¼ å‚æ–¹å¼ 1\nnavigate({\n    pathname: \"/class\",\n    search: `?id=${id}\u0026grade=${grade}`\n})\n\n// ä¼ å‚æ–¹å¼ 2\nconst params = { id: '1', grade: '2' };\nnavigate({\n    pathname: \"/class\",\n    search: `?${createSearchParams(params)}`\n})\n```\n\n## 3. generatePath\n\nç±»å‹å®šä¹‰ï¼š\n\n```ts\ndeclare function generatePath(\n  path: string,\n  params?: Params\n): string;\n```\n\nåŠ¨æ€ç”Ÿæˆå¯è·³è½¬çš„ pathï¼Œ å¯è‡ªåŠ¨åŒ¹é…å¹¶å¡«å……åŠ¨æ€å‚æ•°ã€‚\n\nç¤ºä¾‹ï¼š\n```js\ngeneratePath(\"/users/:id\", { id: \"42\" }); // \"/users/42\"\ngeneratePath(\"/files/:type/*\", {\n  type: \"img\",\n  \"*\": \"cat.jpg\",\n}); // \"/files/img/cat.jpg\"\n```\n\n## 4. Location\n\nReact Router ä¸­ \"location\" çš„æ¥å£å®šä¹‰ã€‚\n\n## 5. matchPath\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function matchPath\u003c\n  ParamKey extends string = string\n\u003e(\n  pattern: PathPattern | string,\n  pathname: string\n): PathMatch\u003cParamKey\u003e | null;\n\ninterface PathMatch\u003cParamKey extends string = string\u003e {\n  params: Params\u003cParamKey\u003e;\n  pathname: string;\n  pattern: PathPattern;\n}\n\ninterface PathPattern {\n  path: string;\n  caseSensitive?: boolean;\n  end?: boolean;\n}\n```\n\næ¯”è¾ƒå¸¸ç”¨çš„å‡½æ•°ã€‚æ˜¯hook `[useMatch](https://reactrouter.com/en/main/hooks/use-match)` çš„è¡¥å……ï¼Œç”¨äºéå‡½æ•°å¼ç»„ä»¶ä¸­ã€‚\n\nç¤ºä¾‹ï¼š\n\n```js\nmatchPath('/children/child1/:id', '/children/child1/1') \n```\n![2](/img/posts/2022-9-19/2022-9-19-2.png)\nä¸ªäººè§‰å¾—æ²¡å•¥ç”¨çš„æ–¹æ³•ï¼Œä½ éƒ½çŸ¥é“ä¼ å…¥ pathname äº†ï¼Œè¿˜åŒ¹é…ä¸ªderã€‚\n\n---\nP.S. 2023å¹´2æœˆè¿½åŠ \n\næˆ‘é”™äº†ï¼ï¼ä»Šå¤©é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå†å†™ä¸€ä¸ªé¢åŒ…å±‘å¯¼èˆªçš„æ—¶å€™ï¼ŒåŒ¹é…å¸¦æœ‰è·¯å¾„å‚æ•°çš„è·¯ç”±è¿›è¡Œé€‰æ‹©æ€§é«˜äº®ï¼Œè¿˜çœŸå¾—ä½¿ç”¨ matchPathï¼Œçœçš„è‡ªå·±å†™æ­£åˆ™æ ¡éªŒäº†ï¼š\n\n![3](/img/posts/2022-9-19/2022-9-19-3.png)\n\n(è“è‰²æ˜¯location.pathnameï¼Œçº¢è‰²æ˜¯éå† Menué…ç½®æ‹¿åˆ°çš„urlï¼Œç»¿è‰²æ˜¯matchPathè¿”å›çš„ï¼Œè‹¥ä¸æ˜¯nullåˆ™è¡¨ç¤ºåŒ¹é…åˆ°äº†ï¼)\n\n## 6. matchRoutes\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function matchRoutes(\n  routes: RouteObject[],\n  location: Partial\u003cLocation\u003e | string,\n  basename?: string\n): RouteMatch[] | null;\n\ninterface RouteMatch\u003cParamKey extends string = string\u003e {\n  params: Params\u003cParamKey\u003e;\n  pathname: string;\n  route: RouteObject;\n}\n```\n\nè¿™ä¸ªæ˜¯v6ç‰ˆåŒ¹é…è·¯ç”±çš„æ ¸å¿ƒç®—æ³•ï¼Œå®˜æ–¹æš´éœ²å‡ºæ¥äº†ï¼Œä¾›å¼€å‘è€…è‡ªå®šä¹‰ä½¿ç”¨ã€‚\n\nç¤ºä¾‹ï¼š\n\n```js\nconst routes = [\n  {\n    path: '/',\n    component: \u003cHome /\u003e\n  },\n  {\n    path: '/list',\n    component: \u003cList /\u003e\n  },\n  {\n    path: '/children',\n    component: \u003cLayout /\u003e,\n    children: [\n      {\n        path: 'child1',\n        component: \u003cChild1 /\u003e\n      },\n      {\n        path: 'child2/:id',\n        component: \u003cChild2 /\u003e\n      },\n    ]\n  }\n]\n...\n\n\u003cBrowserRouter\u003e\n  \u003cRoutes\u003e\n      {routes.map((route, index) =\u003e \u003cRoute key={index} element={route.component} path={route.path} \u003e\n        {route.children \u0026\u0026 \u003c\u003e\n          {route.children.map((cRoute, cIndex) =\u003e \u003cRoute key={cIndex} element={cRoute.component} path={cRoute.path} /\u003e)}\n        \u003c/\u003e}\n      \u003c/Route\u003e )}\n  \u003c/Routes\u003e\n\u003c/BrowserRouter\u003e\n\nmatchRoutes(routes, '/children/child1')\n```\n\n![4](/img/posts/2022-9-19/2022-9-19-4.png)\nå¯ä»¥çœ‹åˆ°ï¼Œ matchRoutes å°†æ‰€æœ‰çš„åŒ¹é…è·¯å¾„ä¸Šçš„è·¯ç”±éƒ½æŒ‰ç…§é¡ºåºè¿”å›å•¦ã€‚å¯ä»¥é€šè¿‡ route.path æ¥è·å–åŸå§‹è·¯ç”±è¡¨ä¸­çš„ pathã€‚\n\n\n## 7. renderMatches\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function renderMatches(\n  matches: RouteMatch[] | null\n): React.ReactElement | null;\n```\n\nå®ƒçš„ä½œç”¨æ˜¯æŠŠ matchRoutes åŒ¹é…åˆ°çš„ component æ¸²æŸ“å‡ºæ¥ã€‚è¯´çš„å®¹æ˜“ï¼Œç½‘ä¸Šçš„ä½¿ç”¨æ¡ˆä¾‹å°‘ä¹‹åˆå°‘ï¼Œå®˜æ–¹æ–‡æ¡£åˆå¤ªè¿‡æ•·è¡ï¼Œåªèƒ½å»è¯»æºç äº†ï¼š\n\n```tsx\n// react-router/packages/lib/hooks.tsx\nexport function _renderMatches(\n  matches: RouteMatch[] | null,\n  parentMatches: RouteMatch[] = []\n): React.ReactElement | null {\n  if (matches == null) return null;\n\n  return matches.reduceRight((outlet, match, index) =\u003e {\n    return (\n      \u003cRouteContext.Provider\n        children={\n          match.route.element !== undefined ? match.route.element : outlet\n        }\n        value={{\n          outlet,\n          matches: parentMatches.concat(matches.slice(0, index + 1)),\n        }}\n      /\u003e\n    );\n  }, null as React.ReactElement | null);\n}\n```\nå¯ä»¥çœ‹åˆ°ï¼Œå®ƒæ˜¯å°†åŒ¹é…åˆ°çš„è·¯ç”±æ•°ç»„ä»å³å‘å·¦æ‘˜å–ï¼Œç»Ÿä¸€æ”¾åˆ°ä¸€ä¸ª context é‡Œäº†ã€‚è€Œä¸”ï¼Œä»æºç é‡Œçœ‹åˆ°ï¼ŒuseRoutes çš„è¿”å›å€¼å°±æ˜¯ä¸€ä¸ª _renderMatchesï¼Œæˆ‘ä»¬å¯ä»¥å‚ç…§æºç çš„è°ƒç”¨æ–¹å¼è¿›è¡Œä½¿ç”¨ã€‚\n\nè€ƒè™‘è·¯ç”±ï¼š\n\n```js\nconst routes = [\n    {\n      path: '/',\n      component: \u003cHome /\u003e\n    },\n    {\n      path: '/list',\n      component: \u003cList /\u003e\n    },\n    {\n      path: '/children',\n      component: \u003cLayout /\u003e,\n      children: [\n        {\n          path: 'child1',\n          component: \u003cChild1 /\u003e\n        },\n        {\n          path: 'child2/:id',\n          component: \u003cChild2 /\u003e\n        },\n      ]\n    },\n  ]\n```\n\nä½¿ç”¨æ–¹å¼ï¼š\n\n```js\nrenderMatches(matchRoutes(routes, '/children/child2/1'))\n```\nmatchRoutes è¿”å›çš„å€¼æ˜¯ï¼š\n\n![5](/img/posts/2022-9-19/2022-9-19-5.png)\nä¸ _renderMatches æ¥å—çš„å‚æ•°ä¸€è‡´ã€‚\n\nåœ¨ matches.reduceRight ä¸­ï¼Œä¼šå°† match.route.element é€šè¿‡ context çš„ children çš„å½¢å¼æŒ‚è½½ã€‚ä¸çŸ¥é“æ˜¯ä¸æ˜¯å¼€å‘è€…çš„ç¬”è¯¯ï¼Œchildren é‡Œä½¿ç”¨äº† match.route.elementï¼Œè€Œä¸Šå›¾ä¸­åŒ¹é…çš„æ•°ç»„æ˜æ˜æ˜¯ route.componentï¼Œå¯¼è‡´ç›´æ¥ä½¿ç”¨æ¸²æŸ“ä¸å‡ºæ¥ä»»ä½•æ•°æ®ï¼Œæˆ‘æ”¹åŠ¨ä¸€ä¸‹è¿™ä¸ªå‡½æ•°å°±æœ‰æ•°æ®äº†ï¼š\n\n```jsx\nconst Context = createContext({});\n\nconst matches = matchRoutes(routes, '/children/child2/1');\n\nreturn matches \u0026\u0026 matches.reduceRight((outlet, match, index) =\u003e {\n    return (\n      \u003cContext.Provider\n        children={\n          match.route.component !== undefined ? match.route.component : outlet\n        }\n        value={{\n          outlet,\n        }}\n      /\u003e\n    );\n}, null as React.ReactElement | null);\n```\nä½†æ˜¯ä»–ä¼ çš„è¿™ä¸ª outlet å‚æ•°ï¼Œå¹¶ä¸èƒ½è¢«è‡ªåŠ¨è¯†åˆ«ä¸º \\\u003cOutlet /\u003e æ ‡ç­¾ï¼Œæ‰€ä»¥åªèƒ½æ¸²æŸ“å‡ºæ¥ Layoutï¼Œ å­ç»„ä»¶ä»ç„¶æ¸²æŸ“ä¸å‡ºæ¥ã€‚\n          \n è¯‘è€…è‡ªå·±å†™äº†ä¸ªDemoï¼Œæ¥å¤ç°ä¸€ä¸‹ä»–è¿™ä¸ªç®—æ³•ï¼š\n \n```tsx\n// ä¸»\n\u003cContext.Provider\n  value={{\n    outlet: \u003cContext.Provider\u003e\n      \u003cChild2 /\u003e\n    \u003c/Context.Provider\u003e\n  }}\n\u003e\n  \u003cLayout /\u003e\n\u003c/Context.Provider\u003e\n\n// Layout\nfunction Layout () {\n    return \u003cContext.Consumer\u003e\n      {values =\u003e {\n        return \u003c\u003e\n           'Layout\n           {values.outlet ? values.outlet : \u003cOutlet /\u003e}\n        \u003c/\u003e\n      }}\n    \u003c/Context.Consumer\u003e\n}\n```\nå¯ä»¥æ­£å¸¸æ¸²æŸ“ï¼š\n\n![6](/img/posts/2022-9-19/2022-9-19-6.png)\n\næ€»ç»“ï¼šrenderMatches ä¸è¦ç”¨ï¼Œå‘äººã€‚åµŒå¥— Outlet çš„æ€æƒ³å¾ˆå¥½ï¼Œä½†ç»ˆç©¶æ˜¯ç»™å†…éƒ¨ä½¿ç”¨çš„å†…éƒ¨ APIï¼Œä¸šåŠ¡ä¸Šä¸è¦ç”¨ã€‚\n\n## 8. resolvePath\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function resolvePath(\n  to: To,\n  fromPathname?: string\n): Path;\n\ntype To = string | Partial\u003cPath\u003e;\n\ninterface Path {\n  pathname: string;\n  search: string;\n  hash: string;\n}\n```\n\né€šè¿‡ç»™å®šçš„ç›¸å¯¹è·¯ç”± to æ¥è·å–ä¸€ä¸ªèƒ½å¤Ÿ navigate çš„ç»å¯¹è·¯å¾„ pathã€‚æ˜¯hook useResolvedPath çš„å®ç°æ–¹æ³•ã€‚\n\n\n```js\nresolvePath('children/child2/:id') // /children/child2/:id\n```\n\n\u003chr /\u003e\n\nå®Œï¼"])</script><script>self.__next_f.push([1,"3b:T2bf7,"])</script><script>self.__next_f.push([1,"\u003e ä¸“æ è¯´æ˜ï¼šå¯¹äºreact-router v6ç‰ˆæœ¬ï¼Œæœ‰åŒäº‹ååº”ç¼ºå°‘ç›¸å¯¹å®Œæ•´çš„ä¸­æ–‡æ–‡æ¡£ï¼ŒæŸ¥çœ‹ä¸æ–¹ä¾¿ã€‚ä¸ºäº†ä¾¿äºä½¿ç”¨ï¼Œä½œè€…å¯¹[å®˜ç½‘æ–‡æ¡£](https://link.juejin.cn/?target=https%3A%2F%2Freactrouter.com%2Fdocs%2Fen%2Fv6 \"https://reactrouter.com/docs/en/v6\")è¿›è¡Œé’ˆå¯¹æ€§ç¿»è¯‘ï¼Œä¾¿äºv6ç‰ˆæœ¬æ›´å¹¿æ³›çš„è¢«ä½¿ç”¨ã€‚\n\n\n\u003e ä½œè€…è¯´æ˜ï¼šæœ¬æœŸçš„hooksä»…ä»…åœ¨å‡½æ•°å¼ç»„ä»¶é‡Œç”Ÿæ•ˆï¼Œè‹¥æƒ³è¦åœ¨ç±»å¼ç»„ä»¶é‡Œä½¿ç”¨ç›¸åº”åŠŸèƒ½ï¼Œå¯å‚è§æœ¬ä¸“æ ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œè‡ªå·±å†™ä¸€ä¸ª withRouter å‡½æ•°ã€‚\n\n## 1. useHref\n\nç±»å‹å®šä¹‰ï¼š\n\n```ts\ndeclare function useHref(to: To): string;\n```\n`useHref` è¿”å›ä¸€ä¸ªå®Œæ•´çš„è·¯ç”±URLï¼ŒæŒ‡å‘å‚æ•°Â `to`Â å®šä½çš„åœ°å€, è¿™ä¸ªåœ°å€å¯ä»¥è„±ç¦» React Routerç¯å¢ƒã€‚ä½¿ç”¨ç¤ºä¾‹ï¼š\n\n```js\n// æ·±å±‚è·¯ç”±ä¸­\nuseHref({ to: 'dashboard' }) // /home/test/dashboard\n```\n\n## 2. useInRouterContext\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function useInRouterContext(): boolean;\n```\nå½“ç»„ä»¶ä½¿ç”¨äº†`\u003cRouter\u003e`æ¸²æŸ“æ—¶ï¼Œè¯¥é’©å­è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚è¿™å¯¹äºä¸€äº›éœ€è¦çŸ¥é“ç»„ä»¶æ˜¯å¦åœ¨ React Router ä¸Šä¸‹æ–‡ä¸­çš„ç¬¬ä¸‰æ–¹æ‰©å±•éå¸¸æœ‰ç”¨ã€‚\n\n## 3. useLinkClickHandler\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function useLinkClickHandler\u003c\n  E extends Element = HTMLAnchorElement\n\u003e(\n  to: To,\n  options?: {\n    target?: React.HTMLAttributeAnchorTarget;\n    replace?: boolean;\n    state?: any;\n  }\n): (event: React.MouseEvent\u003cE, MouseEvent\u003e) =\u003e void;\n```\nå…¶è¿”å›ä¸€ä¸ªèƒ½å¤Ÿå®ç°`\u003cLink\u003e`æ ‡ç­¾åŠŸèƒ½çš„æ›¿ä»£æ€§çš„å‡½æ•°ï¼Œç”¨äºåœ¨è‡ªå®šä¹‰è·³è½¬æ—¶ä½¿ç”¨ï¼Œå‚æ•°åŒLinkæ ‡ç­¾ï¼š\n\n```jsx\nimport {\n  useHref,\n  useLinkClickHandler,\n} from \"react-router-dom\";\n\nconst StyledLink = styled(\"a\", { color: \"fuchsia\" });\n\nconst Link = React.forwardRef(\n  (\n    {\n      onClick,\n      replace = false,\n      state,\n      target,\n      to,\n      ...rest\n    },\n    ref\n  ) =\u003e {\n    let href = useHref(to);\n    // è°ƒç”¨handleClickï¼Œç›¸å½“äºç‚¹å‡»äº†ä¸€ä¸ª\u003cLink\u003eæ ‡ç­¾\n    let handleClick = useLinkClickHandler(to, {\n      replace,\n      state,\n      target,\n    });\n\n    return (\n      \u003cStyledLink\n        {...rest}\n        href={href}\n        onClick={(event) =\u003e {\n          onClick?.(event);\n          if (!event.defaultPrevented) {\n            handleClick(event);\n          }\n        }}\n        ref={ref}\n        target={target}\n      /\u003e\n    );\n  }\n);\n```\n\n## 4. useLinkPressHandler\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function useLinkPressHandler(\n  to: To,\n  options?: {\n    replace?: boolean;\n    state?: any;\n  }\n): (event: GestureResponderEvent) =\u003e void;\n```\nåŠŸèƒ½åŒ useLinkClickHandlerï¼Œ åªä¸è¿‡æ˜¯åœ¨ç§»åŠ¨ç«¯ä½¿ç”¨çš„ï¼ˆå¸¸ç”¨äº react-nativeï¼‰ï¼Œä½¿ç”¨ç¤ºä¾‹ï¼š\n```tsx\nimport { TouchableHighlight } from \"react-native\";\nimport { useLinkPressHandler } from \"react-router-native\";\n\nfunction Link({\n  onPress,\n  replace = false,\n  state,\n  to,\n  ...rest\n}) {\n  let handlePress = useLinkPressHandler(to, {\n    replace,\n    state,\n  });\n\n  return (\n    \u003cTouchableHighlight\n      {...rest}\n      onPress={(event) =\u003e {\n        onPress?.(event);\n        if (!event.defaultPrevented) {\n          handlePress(event);\n        }\n      }}\n    /\u003e\n  );\n}\n```\n\n## 5. useLocation\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function useLocation(): Location;\n\ninterface Location extends Path {\n  state: unknown;\n  key: Key;\n}\n```\n\nè¿™ä¸ªå°±æ¯”è¾ƒå¸¸ç”¨äº†ã€‚ä»–è¿”å›å½“å‰è·¯ç”±çŠ¶æ€ä¸‹çš„ location ä¿¡æ¯, å¯ç”¨äºè·¯ç”±ä¼ å‚ã€‚ä½¿ç”¨æ–¹å¼ï¼š\n```jsx\nimport { useLocation } from 'react-router-dom';\n\nfunction App() {\n  let location = useLocation(); // hash, key, pathname, search, state\n}\n```\n\n## 6. useMatch\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function useMatch\u003cParamKey extends string = string\u003e(\n  pattern: PathPattern | string\n): PathMatch\u003cParamKey\u003e | null;\n```\n\nå…¶æ¥å—ä¸€ä¸ªç›¸å¯¹è·¯ç”±å­—ç¬¦ä¸²ï¼Œè¿”å›åŒ¹é…åˆ°çš„è·¯ç”±è¡¨æ•°æ®ã€‚ç¤ºä¾‹ï¼š\n\n```js\nuseMatch('/')\n```\nè¿”å›å€¼ï¼š\n\n![image.png](/img/posts/2022-8-26/2022-8-26-1.png)\n\n## 7. useNavigate\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function useNavigate(): NavigateFunction;\n\ninterface NavigateFunction {\n  (\n    to: To,\n    options?: { replace?: boolean; state?: any }\n  ): void;\n  (delta: number): void;\n}\n```\n\nä»–è¿”å›ä¸€ä¸ªå¯ä»¥ç”¨äºè·¯ç”±å¯¼èˆªçš„å‡½æ•°ã€‚æœ‰ä¸€ä¸ªå‚æ•° replaceï¼Œå¦‚æœä¼ ä¸º trueï¼Œè·¯ç”±ä¼šåœ¨ history stack ä¸­æ›¿æ¢å½“å‰çš„ currentï¼Œ è€Œä¸æ˜¯æ–° push ä¸€ä¸ªçŠ¶æ€ã€‚ä½¿ç”¨ç¤ºä¾‹ï¼š\n\n```jsx\nimport { useNavigate } from \"react-router-dom\";\n\n// è¡¨å•æäº¤åè·³è½¬é¡µé¢\nfunction SignupForm() {\n  let navigate = useNavigate();\n\n  async function handleSubmit(event) {\n    event.preventDefault();\n    await submitForm(event.target);\n    navigate(\"../success\", { replace: true });\n  }\n\n  return \u003cform onSubmit={handleSubmit}\u003e{/* ... */}\u003c/form\u003e;\n}\n```\n\nå½“ç„¶ä¹Ÿå¯ä»¥ä¸ä¼ è·¯ç”±çš„ pathï¼Œç›´æ¥ä¼ æ•°å­—ï¼š\n\n```js\nnavigate(-1)\n```\nè¡¨ç¤ºæµè§ˆå™¨å›é€€æˆ–è€…å‰è¿›ã€‚\n\n## 8. useNavigationType\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function useNavigationType(): NavigationType;\n\ntype NavigationType = \"POP\" | \"PUSH\" | \"REPLACE\";\n```\n\nè¿”å›è·¯ç”±è·³è½¬çš„çŠ¶æ€ï¼Œè¡¨ç¤ºå½“å‰é¡µé¢æ˜¯æ€ä¹ˆæ ·è¢«ç”¨æˆ·è·³è½¬è¿‡æ¥çš„ï¼Œå¯é€‰å‚æ•°ï¼špop, push, replace\n\n## 9. useOutlet\n\nç±»å‹å®šä¹‰ï¼š\n\n```ts\ndeclare function useOutlet(): React.ReactElement | null;\n```\n\nè¿”å›åµŒå¥—è·¯ç”±ä¸­ï¼Œè¢« `\u003cOutlet\u003e` å ä½çš„å­å…ƒç´ çš„è·¯ç”±å¯¹è±¡ã€‚é€šå¸¸åœ¨å­è·¯ç”±å†…éƒ¨ä½¿ç”¨ã€‚ç¤ºä¾‹ï¼š\n\n```js\nfunction Dashboard() {\n  // æ‰“å° outlet\n  console.log(useOutlet())\n  return (\n    \u003cdiv\u003e\n      \u003ch1\u003eDashboard\u003c/h1\u003e\n      \u003cOutlet /\u003e\n    \u003c/div\u003e\n  );\n}\n\nfunction DashboardMessages() {\n  return 'DashboardMessages'\n}\n\nfunction DashboardTasks() {\n  return 'DashboardTasks'\n}\n\nfunction App() {\n  return (\n    \u003cRoutes\u003e\n      \u003cRoute path=\"/\" element={\u003cDashboard /\u003e}\u003e\n        {/* å­è·¯ç”± */}\n        \u003cRoute\n          path=\"messages\"\n          element={\u003cDashboardMessages /\u003e}\n        /\u003e\n        \u003cRoute path=\"tasks\" element={\u003cDashboardTasks /\u003e} /\u003e\n      \u003c/Route\u003e\n    \u003c/Routes\u003e\n  );\n}\n```\næ­¤æ—¶è®¿é—®è·¯ç”± `http://localhost:3000/messages`ï¼Œé¡µé¢å¦‚ä¸‹ï¼š\n\n![image.png](/img/posts/2022-8-26/2022-8-26-2.png)\n\næ§åˆ¶å°æ‰“å°ï¼š\n\n![image.png](/img/posts/2022-8-26/2022-8-26-3.png)\n\n## 10. useOutletContext\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function useOutletContext\u003c\n  Context = unknown\n\u003e(): Context;\n```\nç”¨äºçˆ¶å­è·¯ç”±å…±äº«çŠ¶æ€ã€‚ç¤ºä¾‹ï¼š\n```jsx\n// çˆ¶\nfunction Parent() {\n  const [count, setCount] = React.useState(0);\n  return \u003cOutlet context={[count, setCount]} /\u003e;\n}\n\n// å­\nimport { useOutletContext } from \"react-router-dom\";\n\nfunction Child() {\n  const [count, setCount] = useOutletContext();\n  const increment = () =\u003e setCount((c) =\u003e c + 1);\n  return \u003cbutton onClick={increment}\u003e{count}\u003c/button\u003e;\n}\n```\nå¦‚æœæ˜¯åœ¨tsç¯å¢ƒä¸‹ï¼Œä½¿ç”¨æ–¹å¼åˆæœ‰æ‰€ä¸åŒã€‚æ¨èè‡ªå®šä¹‰ä¸€ä¸ª contextï¼Œ è¿™æ ·æ–¹ä¾¿ç±»å‹å®šä¹‰ï¼š\n```tsx\n// çˆ¶\nimport * as React from \"react\";\nimport type { User } from \"./types\";\nimport { Outlet, useOutletContext } from \"react-router-dom\";\n\ntype ContextType = { user: User | null };\n\nexport default function Dashboard() {\n  const [user, setUser] = React.useState\u003cUser | null\u003e(null);\n\n  return (\n    \u003cdiv\u003e\n      \u003ch1\u003eDashboard\u003c/h1\u003e\n      \u003cOutlet context={{ user }} /\u003e\n    \u003c/div\u003e\n  );\n}\n\n// è‡ªå®šä¹‰ hook\nexport function useUser() {\n  return useOutletContext\u003cContextType\u003e();\n}\n\n// å­\nimport { useUser } from \"../dashboard\";\n\nexport default function DashboardMessages() {\n  const { user } = useUser();\n  return (\n    \u003cdiv\u003e\n      \u003ch2\u003eMessages\u003c/h2\u003e\n      \u003cp\u003eHello, {user.name}!\u003c/p\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## 11. useParams\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function useParams\u003c\n  K extends string = string\n\u003e(): Readonly\u003cParams\u003cK\u003e\u003e;\n```\n\nè¿”å›è·¯ç”±ä¼ å‚çš„é”®å€¼å¯¹å‚æ•°ï¼ˆä¸æ˜¯é—®å·ä¼ å‚ï¼Œé—®å·çš„åœ¨locationçš„searché‡Œï¼‰ã€‚å­è·¯ç”±ä¹Ÿä¼šç»§æ‰¿çˆ¶è·¯ç”±çš„æ‰€æœ‰å‚æ•°ã€‚ä½¿ç”¨ç¤ºä¾‹ï¼š\n```jsx\nimport * as React from 'react';\nimport { Routes, Route, useParams } from 'react-router-dom';\n\nfunction ProfilePage() {\n  // Get the userId param from the URL.\n  let { userId } = useParams();\n  // ...\n}\n\nfunction App() {\n  return (\n    \u003cRoutes\u003e\n      \u003cRoute path=\"users\"\u003e\n        \u003cRoute path=\":userId\" element={\u003cProfilePage /\u003e} /\u003e\n        \u003cRoute path=\"me\" element={...} /\u003e\n      \u003c/Route\u003e\n    \u003c/Routes\u003e\n  );\n}\n```\n\n## 12. useResolvedPath\n\nç±»å‹å®šä¹‰ï¼š\n\n```ts\ndeclare function useResolvedPath(to: To): Path;\n```\n\nè¿”å›ä¼ å…¥pathçš„å…¨è·¯å¾„ã€‚å¯è§£æå‡ºpathï¼Œhashï¼Œsearchï¼ˆlocationå¯¹è±¡ï¼‰\n\n\n## 13. useRoutes\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function useRoutes(\n  routes: RouteObject[],\n  location?: Partial\u003cLocation\u003e | string;\n): React.ReactElement | null;\n```\næ˜¯æ ‡ç­¾ `\u003cRoutes\u003e` çš„å‡½æ•°å¼å½¢å¼ã€‚ä½¿ç”¨æ—¶ä¹Ÿä¸éœ€è¦é¢å¤–çš„JSXã€‚ç¤ºä¾‹ï¼š\n```jsx\nimport * as React from \"react\";\nimport { useRoutes } from \"react-router-dom\";\n\nfunction App() {\n  let element = useRoutes([\n    {\n      path: \"/\",\n      element: \u003cDashboard /\u003e,\n      children: [\n        {\n          path: \"messages\",\n          element: \u003cDashboardMessages /\u003e,\n        },\n        { path: \"tasks\", element: \u003cDashboardTasks /\u003e },\n      ],\n    },\n    { path: \"team\", element: \u003cAboutPage /\u003e },\n  ]);\n\n  return element;\n}\n```\nä»–çš„è¿”å›å€¼è¦ä¹ˆæ˜¯åŒ¹é…åˆ°çš„Reactå…ƒç´ ï¼Œè¦ä¹ˆæ˜¯nullã€‚\n\n## 14. useSearchParams\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function useSearchParams(\n  defaultInit?: URLSearchParamsInit\n): [URLSearchParams, SetURLSearchParams];\n\ntype ParamKeyValuePair = [string, string];\n\ntype URLSearchParamsInit =\n  | string\n  | ParamKeyValuePair[]\n  | Record\u003cstring, string | string[]\u003e\n  | URLSearchParams;\n\ntype SetURLSearchParams = (\n  nextInit?: URLSearchParamsInit,\n  navigateOpts?: : { replace?: boolean; state?: any }\n) =\u003e void;\n```\n\nè§£æå½“å‰è·¯å¾„ï¼Œè¿”å›locationä¸­çš„searchï¼›å¹¶å¯é‡æ–°è®¾ç½® search å¹¶è§¦å‘è·³è½¬ã€‚ç¤ºä¾‹ï¼š\n```jsx\nimport * as React from \"react\";\nimport { useSearchParams } from \"react-router-dom\";\n\nfunction App() {\n  let [searchParams, setSearchParams] = useSearchParams();\n\n  function handleSubmit(event) {\n    event.preventDefault();\n    let params = serializeFormQuery(event.target);\n    setSearchParams(params);\n  }\n\n  return (\n    \u003cdiv\u003e\n      \u003cform onSubmit={handleSubmit}\u003e{/* ... */}\u003c/form\u003e\n    \u003c/div\u003e\n  );\n}\n```\nå…¶ä¸­ï¼Œ setSearchParams ç±»ä¼¼äº navigateï¼Œä½†æ˜¯ä»…ä»…ä¼ é€’ search å‚æ•°ã€‚\n\n## 15. useSearchParams (React Native)\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function useSearchParams(\n  defaultInit?: URLSearchParamsInit\n): [URLSearchParams, SetURLSearchParams];\n\ntype ParamKeyValuePair = [string, string];\n\ntype URLSearchParamsInit =\n  | string\n  | ParamKeyValuePair[]\n  | Record\u003cstring, string | string[]\u003e\n  | URLSearchParams;\n\ntype SetURLSearchParams = (\n  nextInit?: URLSearchParamsInit,\n  navigateOpts?: : NavigateOptions\n) =\u003e void;\n\ninterface NavigateOptions {\n  replace?: boolean;\n  state?: any;\n}\n```\nä½¿ç”¨æ–¹å¼åŒä¸Šã€‚ç¤ºä¾‹ï¼š\n```jsx\nimport * as React from \"react\";\nimport { View, SearchForm, TextInput } from \"react-native\";\nimport { useSearchParams } from \"react-router-native\";\n\nfunction App() {\n  let [searchParams, setSearchParams] = useSearchParams();\n  let [query, setQuery] = React.useState(\n    searchParams.get(\"query\")\n  );\n\n  function handleSubmit() {\n    setSearchParams({ query });\n  }\n\n  return (\n    \u003cView\u003e\n      \u003cSearchForm onSubmit={handleSubmit}\u003e\n        \u003cTextInput value={query} onChangeText={setQuery} /\u003e\n      \u003c/SearchForm\u003e\n    \u003c/View\u003e\n  );\n}\n```"])</script><script>self.__next_f.push([1,"3c:T3b47,"])</script><script>self.__next_f.push([1,"![WechatIMG105.jpeg](/img/posts/2022-8-23/2022-8-23-1.png)\n\n\u003e é•¿åˆ—è¡¨æ»šåŠ¨ï¼Œæ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„æ€§èƒ½ä¼˜åŒ–é—®é¢˜ï¼Œåœ¨æåˆ°æ€§èƒ½ä¼˜åŒ–æ—¶å´åˆæ˜¯é¿ä¸å¼€çš„è¯é¢˜ï¼Œå…¶ç›®æ ‡æ— éå°±æ˜¯`å°½å¯èƒ½åœ¨ä»»æ„æ—¶åˆ»å†…åªå…³æ³¨å¯è§†çª—å£åŒºåŸŸçš„æ•°æ®çš„æµç•…å±•ç¤ºï¼Œè€Œå¿½è§†è¢«é®æŒ¡åŒºåŸŸï¼ŒåŒæ—¶åˆä¸èƒ½å½±å“æ•°æ®çš„æ­£å¸¸æ¸²æŸ“ã€‚`æœ¬æ–‡å°½å¯èƒ½å…¨çš„æ€»ç»“ä¸€ä¸‹æ‰€æœ‰é•¿åˆ—è¡¨æ»šåŠ¨çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œä»¥ä¾›å‚è€ƒã€‚\n\u003e \n\u003e ï¼ˆæœ¬æ–‡ä»…åœ¨æ˜é‡‘å‘å¸ƒï¼‰\n\n\n## 0. å¼•\n\nå…ˆè¯´è¯´ DOM å…ƒç´ è¿‡å¤šï¼Œé¡µé¢ä¸ºä»€ä¹ˆä¼šå¡é¡¿å‘¢ï¼Ÿæœ‰æ²¡æœ‰æƒ³è¿‡è¿™ä¸ªé—®é¢˜ï¼Ÿ\n\nå…¶å®ç”¨ç›´è§‚æ„Ÿå—ä¹Ÿèƒ½è§‰å¯Ÿçš„å‡ºæ¥ï¼Œå› ä¸ºæµè§ˆå™¨è¦æ“å¿ƒçš„äº‹æƒ…å¤šäº†ã€‚ä¸€ä¸‹åŠ è½½å¾ˆå¤šçš„ä¸œè¥¿ï¼ŒHTML å…ƒç´  å ç”¨çš„å†…å­˜ä¼šä¸€ä¸‹å˜å¤šï¼Œæµè§ˆå™¨å•è–„çš„å°èº«æ¿å°±ä¼šåƒä¸æ¶ˆï¼Œå¦‚æœç»™æ¯ä¸ªdomåˆæ·»åŠ ç›‘å¬äº‹ä»¶ï¼Œå†åŠ ä¸Šæ„ˆåŠ å¤æ‚çš„ DOM ç»“æ„ï¼Œé©¬ä¸Šå°±ä¼šé›ªä¸ŠåŠ éœœã€‚\n\nå¯¹é•¿åˆ—è¡¨æ»šåŠ¨å‘¢ï¼Œåˆ™ä¼šæ›´è¿›ä¸€æ­¥ï¼Œæ¯æ¬¡æ»šåŠ¨å°±ä¼šè®©é¡µé¢æ‰€æœ‰å…ƒç´ è§¦å‘å›æµé‡ç»˜ï¼Œå› ä¸ºå…¶ä½ç½®å˜åŒ–äº†å˜›ã€‚ä½ æ‰“ä¸€äº›è€æ¸¸æˆï¼Œæ¯”å¦‚çº¢è­¦ï¼Œè§†çª—å†…å•ä½è¿‡å¤šæ—¶ï¼Œå°±ä¼šå¡é¡¿ï¼Œä½ ç”¨æœ€å¥½çš„æ˜¾å¡å’ŒCPUä¹Ÿè¿˜æ˜¯ä¼šå¡é¡¿ï¼Œä»–æ˜¯å› ä¸ºè€æ¸¸æˆçš„ä¼˜åŒ–åšçš„ä¸å¤Ÿå¥½ã€‚åŒç†ï¼Œwebç«¯ä¹Ÿéœ€è¦æ­¤ç±»ä¼˜åŒ–ï¼Œå¤„ç†é•¿åˆ—è¡¨æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼ï¼š\n\n1. åˆ†é¡µåŠ è½½ï¼šé¡µæ¬¡éƒ½æ˜¾ç¤ºå›ºå®šçš„æ¡æ•°ï¼Œæ€§èƒ½å¯æ§ã€‚\n2. æ— é™æ»šåŠ¨ï¼šåˆå§‹åŠ è½½ä¸€å°éƒ¨åˆ†ï¼Œè¶Šæ»šåŠ¨åŠ è½½è¶Šå¤šã€‚è¿™ç§å‡ºç°æ€§èƒ½é—®é¢˜åªæ˜¯æ—¶é—´é—®é¢˜ã€‚\n3. è™šæ‹Ÿæ»šåŠ¨ã€‚\n\nç¬¬ä¸€ä¸ªåˆ†é¡µåŠ è½½ä¸åœ¨ä»Šå¤©çš„è®¨è®ºèŒƒç•´ï¼Œè¿™é‡Œå°±2ã€3ä¸¤ç‚¹å¼€å§‹è°ˆè®ºã€‚\n\n## 1. æ‡’åŠ è½½\n\nå¯¹äºæ•°æ®å¾ˆå¤šçš„åˆ—è¡¨ï¼Œä¸€å¼€å§‹ç•Œé¢åˆå§‹åŒ–çš„æ—¶å€™è‚¯å®šä¸èƒ½æŠŠå…¨éƒ¨æ•°æ®éƒ½å¡åœ¨åˆ—è¡¨é‡Œï¼Œå…ˆåˆ«è¯´å‰ç«¯èƒ½ä¸èƒ½æ’‘å¾—ä½ï¼Œåç«¯æŸ¥è¯¢æ—¶é•¿éƒ½è¦çˆ†ç‚¸ã€‚\n\næœ€å¸¸è§çš„å°±æ˜¯æ‰‹æœºç«¯çš„å•†å“åˆ—è¡¨ï¼Œå¦‚ä¸‹å›¾ï¼š\n\n![WechatIMG102.jpeg](/img/posts/2022-8-23/2022-8-23-2.png)\n\nè®¾ç½®ä¸€ä¸ªå†…éƒ¨å¯æ»šåŠ¨çš„å®¹å™¨ï¼Œå›ºå®šé«˜åº¦ï¼Œé€šè¿‡è®¡ç®— `scrollheight` ä¸ `scrollTop` çš„å·®å€¼ä¸å®¹å™¨çš„é«˜åº¦å°±å¯çŸ¥é“æ˜¯å¦æ»šåŠ¨åˆ°äº†åº•éƒ¨ï¼š\n\n\n```jsx\n// htmlä¸­cssè®¾ç½®containeré«˜åº¦ 500px\n\u003cdiv class=\"container\"\u003e\n    \u003cdiv class=\"item\"\u003e1\u003c/div\u003e\n    \u003cdiv class=\"item\"\u003e2\u003c/div\u003e\n    \u003cdiv class=\"item\"\u003e3\u003c/div\u003e\n    ...\n\u003c/div\u003e\n\n// js\nconst container = document.querySelector('.container');\n\ncontainer.addEventListener('scroll', () =\u003e {\n  const offset = container.scrollHeight - container.scrollTop;\n  const delta = 50;\n  \n  console.log(offset)\n\n  if (offset \u003c= (500 + delta)) {\n    // å¯ä»¥è®¾ç½®æ»šåŠ¨é”ï¼Œé”å®šæ»šåŠ¨ç›‘å¬\n    const newDom = document.createElement('div');\n    newDom.setAttribute('class', 'item');\n    newDom.innerText = 'æˆ‘æ˜¯æ–°åŠ çš„';\n    container.appendChild(newDom)\n  }\n})\n```\n\n\nåœ¨ç”¨æˆ·æ»šåŠ¨åˆ°æœ€ä¸‹è¾¹è‡ªåŠ¨ç›‘å¬æ»šåŠ¨äº‹ä»¶åï¼Œè‡ªåŠ¨åŠ è½½å›ºå®šæ•°ç›®çš„å†…å®¹æˆ–è€…æç¤º \"åŠ è½½æ›´å¤š\" æ¥è®©ç”¨æˆ·ç‚¹å‡»åŠ è½½ã€‚å¦‚ä¸‹è¾¹çš„ç¤ºæ„å›¾æ‰€ç¤ºï¼Œå·²ç»æ»šåˆ°åº•åï¼ŒscrollHeight - scrollTop çš„è®¡ç®—å€¼å°±æ˜¯è§†çª—é«˜åº¦çš„ 500px äº†ï¼š\n\n![image.png](/img/posts/2022-8-23/2022-8-23-3.png)\n\n\nä¸Šé¢ç»™å‡ºäº†ç®€æ˜“å®ç°åŸç†ï¼Œè¿™é‡Œåªæ¢è®¨æ–¹æ¡ˆå®ç°ï¼Œå…·ä½“å®ç°å¯åŠ æ»šåŠ¨é”æˆ–è€…å»¶æ—¶æ¥é˜²æ­¢è¿‡å¿«æ·»åŠ å…ƒç´ ã€‚å¯ä»¥çœ‹åˆ°è¿™é‡Œè®¾ç½®äº†ä¸€ä¸ª $delta$ åç§»å€¼ 50 åƒç´ ï¼Œåœ¨æ»šåŠ¨åˆ°è·åº•éƒ¨ 50 åƒç´ æ—¶è§¦å‘å…ƒç´ æ’å…¥ã€‚\n\n\u003e æ»šåŠ¨é”å…¶å®å°±æ˜¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¼€å§‹æ»šåŠ¨æ—¶å®šæ—¶å™¨å¼€å§‹è®¡æ—¶ï¼Œåœ¨è®¡æ—¶æœŸé—´å¯ä»¥å–æ¶ˆè®¢é˜… scroll äº‹ä»¶æˆ–è€…ç¦ç”¨äº‹ä»¶å›è°ƒé€»è¾‘ï¼Œè®¡æ—¶ç»“æŸåæ‰§è¡Œä¸€æ¬¡æ¸²æŸ“åˆ—è¡¨çš„è®¡ç®—ã€‚\n\n- ä¼˜ç‚¹\n\nå®ç°ç›¸å¯¹ç®€å•ï¼Œä¸éœ€è¦é¢å¤–å¼•å…¥ç±»åº“ã€‚ä¸ç”¨è€ƒè™‘æ¯ä¸€ä¸ª item çš„é«˜åº¦æœ‰å¤šå°‘ã€‚\n\n- ç¼ºç‚¹ \n\n1. é¢‘ç¹ä¸‹æ‹‰ï¼Œä¼šé€ æˆæ»šåŠ¨æ¡è¶Šæ¥è¶ŠçŸ­ï¼Œä½¿å¾—æ•°æ®å±•ç¤ºæ˜¾å¾—è‡ƒè‚¿ï¼›\n2. å·²ç»åŠ è½½è¿‡çš„æ»šåŠ¨éšè—åŒºåŸŸçš„æ•°æ®å¹¶æ²¡æœ‰åšæ¸²æŸ“ä¸Šçš„å¤„ç†ï¼›\n3. å…¨å±€æœç´¢æˆ–é¡µé¢å›é€€åå†æ¬¡è¿›æ¥æŸ¥çœ‹åˆ—è¡¨ï¼Œæ»šåŠ¨çŠ¶æ€ä¼šä¸¢å¤±ï¼›\n\n\n## 2. IntersectionObserver + ç©ºdivå ä½\n\né¡¾åæ€ä¹‰ï¼Œè¿™ç§æ–¹å¼æ˜¯ä½¿ç”¨ç©ºçš„divå ä½éšè—åŒºåŸŸä¹‹å¤–çš„å…ƒç´ ï¼Œè¿™ç§å¾€å¾€å¯ä»¥å’Œç¬¬ä¸€ä¸ªæ–¹æ¡ˆç»„åˆä½¿ç”¨ã€‚è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼š\n\n```js\nconst container = document.querySelector('.container');\nconst items = Array.from(container.children) || [];\n\nitems.forEach(item =\u003e {\n  const intersectionObserver = new IntersectionObserver(\n    function (entries) {\n      // å¦‚æœä¸å¯è§ï¼Œå°±è¿”å›\n      if (!entries[0].isVisible) {\n        entries[0].target.backup = entries[0].target.innerHTML || entries[0].target.backup;\n        entries[0].target.innerHTML = '';\n        return;\n      }\n\n      // åœ¨å¯è§†åŒºåŸŸ\n      entries[0].target.innerHTML = \n      entries[0].target.backup || entries[0].target.innerHTML;\n    },\n    {\n      threshold: [0, 1],\n      /* required options*/\n      trackVisibility: true,\n      delay: 100  \n    });\n\n  // å¼€å§‹è§‚å¯Ÿ\n  intersectionObserver.observe(item);\n})\n```\næˆ‘è¿™é‡Œè®¾ç½® IntersectionObserver çš„é…ç½®å±æ€§thresholdä¸º `[0, 1]`ï¼Œè¡¨ç¤ºå®Œå…¨å¯è§å’Œå®Œå…¨ä¸å¯è§æ—¶æ‰å‡ºå‘å›è°ƒã€‚é€šè¿‡åˆ¤æ–­ `isVisible` å±æ€§æ¥æ§åˆ¶ `innerHTML` æ˜¾ç¤ºå†…å®¹ã€‚è¿™é‡Œä½ éœ€è¦ä¸€ä¸ªç¼“å­˜çš„mapï¼ˆæˆ‘è¿™é‡Œå­˜åœ¨äº†domçš„backupé‡Œï¼‰ï¼Œåœ¨å¯è§†æ—¶ï¼Œæ¢å¤ `innerHTML` çš„å€¼ã€‚\n\nè¿™æ ·åœ¨æ»šåŠ¨æ—¶æˆ‘ä»¬å†çœ‹çœ‹domç»“æ„ï¼š\n\n![image.png](/img/posts/2022-8-23/2022-8-23-4.png)\n\nå¯ä»¥çœ‹åˆ°ï¼Œä¸æ˜¾ç¤ºçš„åŒºåŸŸå·²ç»ç½®ä¸ºäº†ç©ºçš„diväº†ã€‚\n\n\n- ä¼˜ç‚¹\n1. ä½¿ç”¨åŸç”Ÿçš„H5 APIï¼Œå…¼å®¹æ€§å¥½ï¼›\n2. ç»“åˆç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œå¯ç›‘å¬åº•éƒ¨å…ƒç´ æ˜¯å¦å¯è§æ¥å®ç°æ— é™æ»šåŠ¨ï¼Œå®ç°ç®€å•ï¼›\n3. æ²¡æœ‰domæ’å…¥åˆ é™¤æ“ä½œï¼Œå¼€é”€æ¯”è¾ƒå°ï¼Œä¸ç ´ååŸæœ‰çš„ç»“æ„ï¼›\n4. ç©ºçš„divå ä½å¯ä»¥ä½¿æ»šåŠ¨æ¡çš„é«˜åº¦ä¸ä¼šè·³å˜ï¼›\n\n- ç¼ºç‚¹\n1. å°±ç®—æ˜¯ç©ºçš„divï¼Œä¹Ÿè¿˜æ˜¯ä¼šé€ æˆæ¸²æŸ“æµªè´¹ï¼›\n2. ç¼“å­˜mapé€ æˆç©ºé—´æµªè´¹ï¼Œç»´æŠ¤æˆæœ¬æé«˜ï¼›\n3. æ— é™æ»šåŠ¨å¤ªé¢‘ç¹ï¼Œæ»šåŠ¨æ¡è¿˜æ˜¯ä¼šç¼©ä¸ºä¸€ä¸ªç‚¹ï¼›\n4. å ä½divçš„é«˜åº¦å›ºå®šäº†ï¼Œå°±æ„å‘³ç€itemçš„é«˜åº¦éœ€è¦å›ºå®šï¼›\n\n## 3. æ•°æ®æˆªæ–­å¼å ä½\n\nè¿™ç§æ–¹æ¡ˆå¯ä»¥çœ‹åšæ˜¯ç¬¬äºŒç§æ–¹æ¡ˆçš„å‡çº§ç‰ˆã€‚å…¶ä¸ä½¿ç”¨å°çš„divå ä½ï¼Œè€Œæ˜¯åœ¨åˆ—è¡¨å¼€å¤´å’Œç»“å°¾ï¼Œåˆ†åˆ«ç”¨ä¸¤ä¸ªå¤§çš„divå ä½ï¼Œè¾¾åˆ°æ•°æ®æˆªæ–­çš„æ•ˆæœã€‚æˆ‘ä»¬çœ‹è‰å›¾ï¼š\n\n![1071661234958_.pic.jpg](/img/posts/2022-8-23/2022-8-23-5.png)\n\n`startIndex` å’Œ `endIndex` å°±æ˜¯æ•°æ®æ•°ç»„ä¸­çš„çœŸå®ä¸‹æ ‡ä½ç½®ï¼Œæ‰€ä»¥è¦æ›¿æ¢çš„åŒºé—´æ˜¯ $[0, startIndex) âˆª (endIndex, children.length - 1]$ã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠ startIndex ä¹‹å‰å’Œ endIndex ä¹‹åçš„éƒ¨åˆ†æ›¿æ¢ä¸ºdivã€‚è¿™é‡Œå› ä¸ºè¦ç”¨åˆ° scroll å±æ€§ï¼Œæ‰€ä»¥è¿˜æ˜¯ç”¨ scroll äº‹ä»¶æ¥ç›‘å¬ï¼ŒåŒæ—¶ç‰µæ‰¯åˆ°domç»“æ„çš„å˜åŠ¨ï¼Œæ‰€ä»¥è¿˜æ˜¯ä½¿ç”¨jsæ¥æ“ä½œdomã€‚\n\nå…ˆå®šä¹‰å®¹å™¨ï¼š\n\n```html\n// cssä¸æ˜¯é‡ç‚¹ï¼Œå¿½ç•¥\n\u003cdiv class=\"container\"\u003e\u003c/div\u003e\n```\nå®šä¹‰æ•°æ®å¹¶è·å–å…ƒç´ ï¼š\n```js\nconst data = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20];\nconst container = document.querySelector('.container');\n```\næ¥ä¸‹æ¥å®šä¹‰ä¸€ä¸‹æ·»åŠ åˆ—è¡¨çš„æ–¹æ³•ï¼š\n\n```js\nfunction addList(data, container) {\n  data.forEach(item =\u003e {\n    const dom = document.createElement('div');\n    dom.setAttribute('class', 'item');\n    dom.innerHTML = item;\n    container.appendChild(dom)\n  });\n}\n```\n\nå®šä¹‰æ»šåŠ¨äº‹ä»¶ç›‘å¬ï¼ˆå¯åŠ å…¥æ»šåŠ¨é”æˆ–è€…èŠ‚æµä¼˜åŒ–ï¼‰ï¼š\n\n```js\ncontainer.addEventListener('scroll', () =\u003e {\n  const scrollTop = container.scrollTop;\n\n  // ä¸Šè¾¹ç©ºç™½çš„é«˜åº¦\n  const topHeight = scrollTop;\n  const startIndex = Math.max(Math.ceil(topHeight / 40) - 2, 0);\n  const endIndex = startIndex + Math.ceil(500 / 40);\n\n  const show = data.slice(startIndex, endIndex + 1);\n\n  // è®¡ç®—ä¸‹è¾¹å‰©ä½™çš„éšè—åŒºåŸŸé«˜åº¦\n  const dataHeight = data.length * 40;\n  const bottomHeight = dataHeight - 500 - scrollTop;\n\n  const topDom = document.createElement('div');\n  const bottomDom = document.createElement('div');\n  topDom.style.height = topHeight + 'px';\n  bottomDom.style.height = bottomHeight + 'px';\n\n  // è¿˜æ²¡åˆ°åº•\n  if (bottomHeight \u003e -100) {\n    // æ¸…ç©º\n    container.innerHTML = '';\n    container.appendChild(topDom);\n    addList(show, container);\n    container.appendChild(bottomDom);\n  }\n});\n```\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œä¸èƒ½ä½¿ç”¨ container.scrollHeight æ¥è®¡ç®—é«˜åº¦äº†ï¼Œè¦é€šè¿‡æ•°æ®ä¹˜ä»¥æ¯ä¸€è¡Œé«˜åº¦è·å–ã€‚æœ€åçš„`bottomHeight \u003e -100`æ˜¯ä¸ºäº†é¿å…å‡ºç°è®¡ç®—è´Ÿæ•°è€Œé€ æˆçš„é¡µé¢æŠ–åŠ¨ã€‚ï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥å†™æ­»ä¸€ä¸ªé˜ˆå€¼ï¼Œé¡µé¢è¶³å¤Ÿé•¿æ—¶ï¼Œè¶…è¿‡è¿™ä¸ªé˜ˆå€¼ï¼Œé¦–å°¾ä¸¤ä¸ªdivé«˜åº¦å°±å®šæ­»ã€‚ï¼‰\n\næœ€ååœ¨é¡µé¢åˆå§‹åŒ–æ—¶åŠ è½½ä¸€æ¬¡åˆ—è¡¨ï¼š\n\n```js\nwindow.onload = function() {\n    addList(data, container)\n}\n```\næœ€åæˆ‘ä»¬åœ¨é¡µé¢ä¸Šæ»šåŠ¨ä¸€ä¸‹çœ‹çœ‹æ•ˆæœï¼š\n\n![image.png](/img/posts/2022-8-23/2022-8-23-12.png)\næˆåŠŸï¼ï¼\n\næ›´é‡è¦çš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ¡ˆå®Œç¾å¥‘åˆå•é¡µåº”ç”¨æ¡†æ¶ï¼Œæ‰€æœ‰çš„domæ“ä½œéƒ½å¯ä»¥ä½¿ç”¨æ¡†æ¶è¯­è¨€æ›¿ä»£ï¼Œæ¯”å¦‚ç”¨vueçš„v-for + è®¡ç®—å±æ€§å°±å¯ä»¥å®Œæˆã€‚ä¹‹å‰åœ¨bilibilié¢è¯•çš„æ—¶å€™ï¼Œå°±é—®äº†ä¸€ä¸‹æ˜¯å¦åšè¿‡è¿™ä¸ªæ–¹æ¡ˆğŸ˜‚ã€‚\n\n- ä¼˜ç‚¹\n1. é€šç”¨æ€§å¼ºï¼Œæ€§èƒ½æå‡æ˜æ˜¾\n2. å¯ä»¥ä½¿ç”¨è™šæ‹Ÿdomç­‰æ¡†æ¶å®ç°\n3. ä¸ç”¨æ‹…å¿ƒæ— é™æ»šåŠ¨åœºæ™¯ä¸‹æ»šåŠ¨æ¡ç¼©ä¸ºä¸€ä¸ªç‚¹ï¼Œå› ä¸ºä½ å®Œå…¨å¯ä»¥åŠ¨æ€æ§åˆ¶é¦–å°¾ä¸¤ä¸ªdivçš„é«˜åº¦ã€‚\n\n- ç¼ºç‚¹\n1. itemçš„é«˜åº¦å¾€å¾€éœ€è¦å›ºå®š\n2. æ»šåŠ¨æ¡æŠ–åŠ¨éœ€è¦ç‰¹æ®Šå¤„ç†\n\n\n## 4. CSS-`content-visibility`å®ç°å¯è§†åŒºåŸŸåˆ¤å®š\n\nå…ˆæ¥çœ‹ä¸€ä¸‹caniuseçš„å…¼å®¹æ€§ï¼š\n\n![image.png](/img/posts/2022-8-23/2022-8-23-6.png)\n\nä¸»æµçš„Chromeå’ŒEdgeå€’æ˜¯éƒ½æ”¯æŒã€‚ä»–æœ‰ä¸ª `auto` å±æ€§ï¼Œå…¶ä½œç”¨æ˜¯ï¼Œå¦‚æœè¯¥å…ƒç´ ä¸åœ¨å±å¹•ä¸Šï¼Œå¹¶ä¸”ä¸ç”¨æˆ·æ— å…³ï¼Œåˆ™ä¸ä¼šæ¸²æŸ“å…¶åä»£å…ƒç´ ã€‚\n\né‚£æˆ‘ä»¬å°±ä½¿ç”¨`content-visibility`æ¥å®ç°ä¸€ä¸‹è™šæ‹Ÿåˆ—è¡¨ã€‚\n\næˆ‘ä»¬å®šä¹‰domç»“æ„ï¼š\n\n```html\n\u003cdiv class=\"container\"\u003e\n    \u003cdiv class=\"item\"\u003e\n      \u003cul\u003e\n        \u003cli\u003e23423\u003c/li\u003e\n        \u003cli\u003e23423\u003c/li\u003e\n        \u003cli\u003e23423\u003c/li\u003e\n        \u003cli\u003e23423\u003c/li\u003e\n      \u003c/ul\u003e\n    \u003c/div\u003e\n    ... è‚¥è‚ å¤šæ•°æ®åœ¨è¿™é‡Œ\n\u003c/div\u003e\n```\n\næˆ‘ä»¬æ·»åŠ åˆ°100Wè¡Œï¼Œçœ‹ä¸€ä¸‹æ¸²æŸ“æ—¶é—´ï¼š\n\n![image.png](/img/posts/2022-8-23/2022-8-23-13.png)\n\næˆ‘ä»¬æ·»åŠ åˆ°400Wè¡Œï¼š\n\n![image.png](/img/posts/2022-8-23/2022-8-23-7.png)\nç›´æ¥å¡æ­»ï¼Œç§’æ€CPUï¼\n\n![image.png](/img/posts/2022-8-23/2022-8-23-8.png)\n\næ­¤æ—¶åŠ ä¸Šä¸€æ®µcssï¼š\n```css\n.itemÂ {\nÂ Â Â Â content-visibility:Â auto;\n}\n```\n100Wæ¡æ—¶ï¼š\n\n![image.png](/img/posts/2022-8-23/2022-8-23-9.png)\nå¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºæ•°æ®é‡å¤§çš„åˆ—è¡¨ï¼Œä¼˜åŒ–çš„æ•ˆæœå¾ˆæ˜æ˜¾ã€‚\n\n400Wè¡Œæ—¶å‹‰å¼ºèƒ½çœ‹åˆ°åˆ—è¡¨ï¼Œä½†æ˜¯è¿˜æ˜¯å¡ï¼š\n\n![image.png](/img/posts/2022-8-23/2022-8-23-10.png)\nçœ‹æ¥æ•°æ®è¶³å¤Ÿå¤šæ—¶ï¼Œå·²ç»ä¸æ˜¯ä¼˜åŒ–èƒ½å¤„ç†çš„äº†ã€‚\n\nå…¶å®ç°åŸç†ï¼Œå…¶å®è¿˜æ˜¯å±äºæ‡’åŠ è½½ï¼Œä¸åœ¨è§†å£åŒºåŸŸçš„åœ°æ–¹å°±ä¸æ¸²æŸ“ï¼Œåªä¸è¿‡æ˜¯cssé…ç½®åè®©æµè§ˆå™¨å¸®æˆ‘ä»¬åšäº†ã€‚æ­¤æ—¶å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸‹æ‹‰æ»šåŠ¨æ—¶ï¼Œçªç„¶å‡ºç°äº†ä¸€äº›æ•°æ®ï¼Œæ»šåŠ¨æ¡å¿…ç„¶ä¼šæŠ–åŠ¨ï¼Œæ­¤æ—¶åœ¨é…ç½®ä¸€ä¸ªcsså±æ€§å³å¯ï¼š\n```css\n.itemÂ {\nÂ Â Â Â contain-intrinsic-size:Â 120px;\n}\n```\nè¿™æ ·ï¼Œæµè§ˆå™¨å°±ä¼šçŸ¥é“æ¯ä¸€è¡Œçš„é«˜åº¦ï¼Œä¼šè‡ªåŠ¨æ’‘å¼€æ»šåŠ¨åŒºåŸŸã€‚\n\n- ä¼˜ç‚¹\n1. ä¸å½±å“ç½‘é¡µå…¨å±€æœç´¢\n2. ä½¿ç”¨ç®€å•ï¼Œçº¯css\n\n- ç¼ºç‚¹\n1. æœªåœ¨è§†çª—åŒºåŸŸçš„å¼‚æ­¥èµ„æºè¿˜æ˜¯ä¼šè¢«åŠ è½½\n2. ä¸»æµæµè§ˆå™¨å…¼å®¹æ€§å·®ï¼Œæ…ç”¨\n\n\n## 5. æ€»ç»“\n\nç»¼ä¸Šæ‰€è¿°ï¼Œå…³äºwebé•¿åˆ—è¡¨æ»šåŠ¨æ€§èƒ½ä¼˜åŒ–çš„ç®—æ³•ï¼Œè¦ä¹ˆæ˜¯æ¸…é™¤ä¸å¯è§åŒºåŸŸçš„domå…ƒç´ ï¼Œè¦ä¹ˆæ˜¯ç”¨æ›´ç®€å•çš„å…ƒç´ æ›¿æ¢ä¹‹ï¼Œå…¶ç›®çš„æ— éå°±æ˜¯ä¸ºäº†èƒ½å¤Ÿè®©æµè§ˆå™¨çš„æ¸²æŸ“å‹åŠ›å°ä¸€ç‚¹ã€‚\n\nå›åˆ°ä¸€å¼€å§‹ã€‚`æˆ‘ä»¬åœ¨æŠ€æœ¯é€‰å‹æ—¶ï¼Œåˆ°åº•è¦ä½¿ç”¨åˆ†é¡µå‘¢ï¼Œè¿˜æ˜¯é•¿æ»šåŠ¨å‘¢ï¼Ÿ`ä½œè€…å»ºè®®è¦è§†æƒ…å†µè€Œå®šï¼Œæ¯”å¦‚æ‰‹æœºç«¯çš„H5å°±ä¸é€‚åˆåˆ†é¡µï¼Œåˆ†é¡µæ“ä½œåœ¨å°ç©ºé—´å†…ä¸å‹å¥½ï¼Œé€‚åˆPCç«¯åº”ç”¨ã€‚æ— é™æ»šåŠ¨å‘¢ï¼Œé€‚ç”¨èŒƒå›´æ¯”è¾ƒå¹¿ï¼Œæ¯”å¦‚bilibiliä¸»ç«™PCç«¯çš„è¯„è®ºåˆ—è¡¨ï¼Œå°±æ˜¯æ— é™+è™šæ‹Ÿæ»šåŠ¨ï¼ˆå½“ç„¶bç«™ä¹Ÿåšäº†éƒ¨åˆ† åˆ†é¡µå¼ çš„ï¼‰ï¼›ä½†æ˜¯ï¼Œæ— é™æ»šåŠ¨å¯¹äºæœç´¢ä¸å‹å¥½ï¼Œæœç´¢ç»“æŸåæ‰¾ä¸åˆ°æ»šåŠ¨çš„ä½ç½®äº†ï¼Œè¿˜å¾—é‡æ–°æ»šï¼Œå“ˆå“ˆï¼åŒæ—¶æ— é™æ»šåŠ¨å¯¹äºå„ä¸ªæ¡ç›®é«˜åº¦ç›¸å·®è¿‡å¤§çš„åœºæ™¯ä¹Ÿä¸é€‚åˆã€‚\n\n\u003e ä¸‹å›¾ä¸­ï¼Œbç«™è¯„è®ºåˆ—è¡¨çš„äºŒçº§è¯„è®ºï¼Œå±•å¼€åä¾¿æ˜¯åˆ†é¡µçš„\n\n\n![image.png](/img/posts/2022-8-23/2022-8-23-11.png)\n\nè¯´å¥é¢˜å¤–è¯ï¼Œå‡ ä¹æ‰€æœ‰çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œéƒ½æ˜¯å—äº†ç°é˜¶æ®µæœ‰é™èµ„æºçš„é™åˆ¶ã€‚æƒ³å½“å¹´2Gæ—¶ä»£ï¼Œä¸€ä¸ªæœˆå¥—é¤åŒ…20MBéƒ½å·²ç»è§‰å¾—å¾ˆå¤§äº†ï¼Œæ‰‹æœºåˆ·ä¸€ä¸ªQQå®¶å›­ä»€ä¹ˆçš„éƒ½å¾ˆå¤Ÿç”¨ï¼Œé‚£ä¸ªæ—¶å€™ä¹Ÿæ²¡è§‰å¾—ç½‘é¡µæ…¢ã€‚ç„¶è€Œç°åœ¨ä¸»æµæµè§ˆå™¨éƒ½è‡ªå¸¦å¾ˆå¤šæ€§èƒ½ä¼˜åŒ–äº†ï¼Œä½†æ˜¯ä¼¼ä¹å¤§å®¶ä»ç„¶ä¸æ»¡è¶³\\[â”“(Â Â´âˆ€`Â )â”\\]ã€‚\n\néšç€æ—¶ä»£çš„è¿›æ­¥ï¼Œè®¡ç®—æœºç®—åŠ›è¿˜ä¼šæå‡ï¼Œåˆ°æ—¶å€™ç›®å‰çš„å‰ç«¯æ€§èƒ½ä¼˜åŒ–å¯èƒ½å°±æ²¡æœ‰æ„ä¹‰äº†ã€‚ä½†æ˜¯ç°åœ¨æ˜¾ç„¶è¿˜æ²¡åˆ°é‚£ä¸€æ­¥ã€‚\n\nå¾ˆå¤šå¹´ä»¥åï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç»™è¿™ä¸ªæ—¶ä»£å–ä¸ªåå­—ï¼Œå«â€œäº’è”ç½‘æ–°çŸ³å™¨æ—¶ä»£â€ã€‚è¿™ä¸ªæ—¶ä»£é‡Œï¼Œå®ç°ä¸€ä¸ªç¨‹åºéœ€è¦ä¸€ç¾¤å†™ä»£ç çš„äººå¥½å‡ ä¸ªæœˆçš„æŠ•å…¥ï¼Œä»£ç è´¨é‡å› äººè€Œå¼‚ï¼Œç»´æŠ¤èµ·æ¥ä¹Ÿå›°éš¾ï¼Œè¿ç»´æˆæœ¬ä¹Ÿé«˜ï¼Œè‡ªåŠ¨åŒ–ç¨‹åº¦è¿‡ä½ï¼Œå¤§å¤šæ•°ä»£ç çš„ç”Ÿå‘½å‘¨æœŸä¸è¶…è¿‡5å¹´ã€‚ä»–ä»¬èµ„æºæœ‰é™ï¼Œå¤©å¤©åœ¨ä¸ºèŠ‚çœå¸¦å®½å’Œå­˜å‚¨ç©ºé—´è€Œå‘æ„ï¼Œé‚£ä¸ªæ—¶ä»£ï¼Œè¢«è¿«æ€§èƒ½ä¼˜åŒ–åå€’æˆäº†ç¨‹åºå‘˜å¿…å¤‡çš„æŠ€èƒ½äº†ã€‚\n\nå®Œï¼\n\n\u003chr /\u003e\n\n## 6. é™„è¨€\n\nä¸‹é¢å°±æ€»ç»“ä¸€ä¸‹ä¸»æµå‰ç«¯æ¡†æ¶çš„ä½¿ç”¨ï¼ˆ å†…éƒ¨åŸç†è‡ªå·±çœ‹æºç å»ï¼ŒåŸç†éƒ½è®²äº†ï¼Œä»£ç è¿˜ä¸æƒ³è‡ªå·±å†™ï¼Œå¯æ˜¯ä¸ä¼šè¿›æ­¥çš„å‘¦~~ ï¼‰ï¼š\n\n### vue-virtual-scroll-list\n\nå¼•å…¥ï¼š\n```js\nimport VirtualList from 'vue-virtual-scroll-list'\n```\nä½¿ç”¨ï¼š\n```jsx\n\u003cvirtual-list style=\"height: 360px; overflow-y: auto;\" // make list scrollable\n  :data-key=\"'uid'\"\n  :data-sources=\"items\"\n  :data-component=\"itemComponent\"\n/\u003e\n...\n\nexport default {\n    name: 'root',\n    data () {\n      return {\n        itemComponent: Item,\n        items: [{uid: 'unique_1', text: 'abc'}, {uid: 'unique_2', text: 'xyz'}, ...]\n      }\n    },\n    components: { 'virtual-list': VirtualList }\n}\n\n// Itemæ˜¯æ¸²æŸ“ç»„ä»¶ï¼Œæ¥å—indexå’Œsourceå±æ€§\n```\n\nå®˜ç½‘åœ°å€ï¼š[vue-virtual-scroll-list](https://github.com/tangbc/vue-virtual-scroll-list#live-demo)\n\n### React-window\n\nå¼•å…¥ï¼š\n\n```js\nimport { FixedSizeList as List } from 'react-window';\n```\nä½¿ç”¨ï¼š\n\n```jsx\nconst Column = ({ index, style }) =\u003e (\n  \u003cdiv style={style}\u003eColumn {index}\u003c/div\u003e\n);\n\nconst Example = () =\u003e (\n  \u003cList\n    height={75}\n    itemCount={1000}\n    itemSize={100}\n    layout=\"horizontal\"\n    width={300}\n  \u003e\n    {Column}\n  \u003c/List\u003e\n);\n```\n\nå®˜ç½‘åœ°å€ï¼š[react-window](https://react-window.vercel.app/#/examples/list/fixed-size)\n\n### Angular-cdk\n\nå¼•å…¥ï¼š(å‰ææ˜¯å¼•å…¥cdkçš„module)\n\n```js\nimport {ChangeDetectionStrategy, Component} from '@angular/core';\n\n/** @title Basic virtual scroll */\n@Component({\n  selector: 'cdk-virtual-scroll-overview-example',\n  styleUrls: ['cdk-virtual-scroll-overview-example.css'],\n  templateUrl: 'cdk-virtual-scroll-overview-example.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class CdkVirtualScrollOverviewExample {\n  items = Array.from({length: 100000}).map((_, i) =\u003e `Item #${i}`);\n}\n```\nä½¿ç”¨ï¼š\n```html\n\u003ccdk-virtual-scroll-viewport itemSize=\"50\" class=\"example-viewport\"\u003e\n  \u003cdiv *cdkVirtualFor=\"let item of items\" class=\"example-item\"\u003e{{item}}\u003c/div\u003e\n\u003c/cdk-virtual-scroll-viewport\u003e\n```\n\nå®˜ç½‘åœ°å€ï¼š[Angular-CDK](https://v7.material.angular.io/cdk/scrolling/overview)\n\n\u003chr/\u003e\n\nThat's all ï¼"])</script><script>self.__next_f.push([1,"3d:T14d4,"])</script><script>self.__next_f.push([1,"## 1. å‰è¨€\n\næˆ‘ä»¬ç»§ç»­æˆ‘ä»¬çš„ React ç»„ä»¶åº“ç³»åˆ—ã€‚æœ¬ç¯‡ä»‹ç»å¦ä¸€ç§å¼¹å‡ºå±‚ - æ¨¡æ€æ¡†ç»„ä»¶ã€‚æœ¬æ–‡çš„ä»£ç å±•ç¤ºçš„æ˜¯ä¸»è¦çš„æ ¸å¿ƒä»£ç ï¼Œå…¨éƒ¨ä»£ç è§ä»“åº“ï¼š[Giteeä»“åº“](https://link.juejin.cn/?target=https%3A%2F%2Fgitee.com%2Fdh1992%2Fdux-ui-react%2F)ï¼Œç»„ä»¶æ ·å¼è§[ä¸»é¡µ](https://link.juejin.cn?target=https%3A%2F%2Fdh1992.gitee.io%2Fdux-ui-react%2F)ã€‚\n\næ¨¡æ€æ¡†å’Œä¸Šä¸€æœŸè®²çš„popoverç±»ä¼¼ï¼Œä¹Ÿæ˜¯å¼¹å‡ºå±‚ç»„ä»¶ã€‚ä¸åŒçš„æ˜¯ï¼Œæ¨¡æ€æ¡†ä¸éœ€è¦é€šè¿‡triggerè§¦å‘ï¼Œé€šè¿‡ç›‘å¬ä¼ å…¥çš„ `visible` å‚æ•°å³å¯ç¡®å®šæ˜¾ç¤ºè¿˜æ˜¯éšè—ã€‚\n\n## 2. å®šä¹‰å…¥å‚\n\nä¸€ä¸ªå¼¹çª—ï¼Œä¸€èˆ¬éœ€è¦ä¸€ä¸ªtitleï¼Œä¸€ä¸ªç»“å°¾çš„æŒ‰é’®æ”¾ç½®åŒºfooterã€‚è¿˜æœ‰å¼¹çª—çš„å°ºå¯¸sizeï¼ŒèƒŒæ™¯åŒºåŸŸçš„é®ç½©maskï¼Œæœ€åè¿˜æœ‰æ˜¾ç¤ºå‚æ•°visibleä»¥åŠå¼¹çª—çš„å„ç§äº‹ä»¶ï¼š\n\n| å±æ€§              | è¯´æ˜         |\n| --------------- | ---------- |\n| visible         | å—æ§ï¼Œæ§åˆ¶å¼¹å‡ºå±‚å±•ç¤º |\n| title       | æ ‡é¢˜       |\n| footer | è„šæ³¨       |\n| size           | æšä¸¾å‡ºå†…ç½®çš„å°ºå¯¸     |\n| mask          | æ˜¯å¦æ˜¾ç¤ºé®ç½©         |\n| visible  | æ§åˆ¶æ˜¾ç¤º      |\n| onClose | ç‚¹å‡»å…³é—­æŒ‰é’®çš„ç›¸åº”äº‹ä»¶ |\n| onOk | ç‚¹å‡»ç¡®å®šæŒ‰é’®çš„ç›¸åº”äº‹ä»¶ |\n| afterClose | å…³é—­ä¹‹åçš„äº‹ä»¶å›è°ƒ |\n\n## 3. rc-dialog å°è£…\n\nè¿™å¯¹å®šåˆ¶åŒ–å¼¹çª—ç»„ä»¶ï¼Œä½¿ç”¨rc-triggerä¼¼ä¹æœ‰äº›åŠ›ä¸ä»å¿ƒï¼Œrc-triggeré‡ç‚¹åœ¨äºå¤„ç†è§¦å‘çš„æ—¶æœºï¼Œå¼¹å‡ºå±‚è·Ÿéšç‚¹å‡»ä½ç½®ï¼Œé€‚åˆè½»é‡çº§çš„å¼¹å‡ºå±‚ï¼›æ¨¡æ€æ¡†é‡ç‚¹åœ¨äºå¤„ç†å†…å®¹å±•ç¤ºï¼Œéœ€è¦æ›´å¥½çš„å±•ç¤ºçº§çš„åº“æ¥æ”¯æŒã€‚\n\nè¿™é‡Œä½¿ç”¨ä¸“ç”¨çš„rc-dialogï¼š\n\n```jsx\nclass RcDialogWrap extends Component {\n  static propTypes = {\n    className: PropTypes.string,\n    wrapClassName: PropTypes.string,\n  };\n  render() {\n    const { className, wrapClassName, ...rest } = this.props as any;\n    return (\n      \u003cRcDialog\n        wrapClassName={classnames(className, wrapClassName)}\n        {...rest}\n      /\u003e\n    );\n  }\n}\n```\n`className` ä¸ºå¼¹çª—å†…å®¹æ ·å¼ç±»åï¼Œ`wrapClassName` ä¸ºå¼¹çª—å®¹å™¨æ ·å¼ç±»åã€‚\n\næˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å¼¹çª—ï¼Œè‚¯å®šéœ€è¦æ¯”rc-dialogæ›´å¤šçš„å‚æ•°å’ŒåŠŸèƒ½ï¼Œå› æ­¤æˆ‘å†ä½¿ç”¨ModalWrapåŒ…è£¹ä¸€ä¸‹åˆšåˆšçš„ç»„ä»¶ï¼š\n\n\n```js\nexport const ModalWrap = styleWrap()(\n  styled(RcDialogWrap)((props) =\u003e {\n    const {\n      theme: { designTokens: DT, fontSize },\n      mask,\n      customStyle,\n    } = props as any;\n    \n    return css`\n    \n      // å¼¹çª—å®¹å™¨\n      position: fixed;\n      overflow: auto;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      left: 0;\n      z-index: 1010;\n      -webkit-overflow-scrolling: touch;\n      outline: 0;\n    \n      ...\n    `\n  })\n);\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªå¼¹çª—ä½¿ç”¨fixedå®šä½ï¼Œå¹¶ä¸”å±…ä¸­æ”¾ç½®ï¼Œz-indexè®¾ç½®æ¯”è¾ƒå¤§ï¼Œç¡®ä¿åœ¨æœ€é¡¶å±‚å³å¯ã€‚\n\næˆ‘ä»¬å†æ¥çœ‹çœ‹ ModalWrapæ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼š\n\n\n```jsx\n...\n\u003cModalWrap\n  // é»˜è®¤çš„ä¸€äº›ç›´ä¼ å±æ€§ï¼Œæ¯”å¦‚ visible ç­‰\n  {...rest}\n  style={{\n    // æ¥å—è‡ªå®šä¹‰çš„widthæ ·å¼\n    width: width,\n    ...style,\n  }}\n  // prefixClsä¸ºç»„ä»¶åº“å‰ç¼€ï¼Œè¿™é‡Œä¸º dux-ui-modal\n  prefixCls={prefixCls}\n  // è¿™é‡Œç¦ç”¨rc-dialogè‡ªå¸¦çš„å…³é—­æŒ‰é’®\n  closable={false}\n  // ä¼ é€’rc-dialogå¯è¯†åˆ«çš„åŠ¨ç”»\n  animation=\"slide-fade\"\n  maskAnimation=\"fade\"\n  onClose={onClose}\n  title={[\n    \u003cdiv key=\"content\" className={`${prefixCls}-title-content`}\u003e\n      {title}\n    \u003c/div\u003e,\n\n    closable \u0026\u0026 (\n      \u003cIcon\n        key=\"close\"\n        type=\"remove_circle\"\n        className={`${prefixCls}-close`}\n        onClick={onClose}\n      /\u003e\n    ),\n  ]}\n  // ä½¿ç”¨äº†lodashï¼š_\n  footer={_.isFunction(footer) ? footer({ locale }) : footer}\n\u003e\n  // è·å–ref\n  \u003cdiv ref={this.savePopupContainer}\u003e\u003c/div\u003e\n  // å†…å®¹ç‰©\n  {children}\n\u003c/ModalWrap\u003e\n```\n\næˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ä¸Šé¢çš„ä»£ç ã€‚\n\n- animation å’Œ maskAnimation ä¸ºç›´ä¼ ç»™ rc-dialog çš„åŠ¨ç”»é…ç½®é¡¹ï¼›\n- onClose æ˜¯å…³é—­äº‹ä»¶ï¼Œç”±propsä¼ å…¥\n- title å°è£…äº†ä¼ å…¥çš„ title å…ƒç´ å’Œ å…³é—­æŒ‰é’®Iconï¼Œå¹¶ä»˜ç»™å…³é—­äº‹ä»¶onClose\n- footer ä¹Ÿæ˜¯ç›´ä¼ å‚æ•°ã€‚å¯è‡ªå®šä¹‰ï¼ŒåŒæ—¶ä¹Ÿå†…ç½®äº†ä¸€ç»„æ“ä½œè„šæ³¨ï¼š\n\n```js\ngetDefaultFooter = () =\u003e {\n    const { onOk, onClose, locale } = this.props as any;\n    return [\n      \u003cButton size=\"lg\" key=\"cancel\" onClick={onClose} style={{ marginRight: 8 }}\u003e\n        {locale.cancel}\n      \u003c/Button\u003e,\n      \u003cButton size=\"lg\" key=\"confirm\" onClick={onOk} styleType=\"primary\"\u003e\n        {locale.confirm}\n      \u003c/Button\u003e,\n    ];\n};\n```\n\nå¤–å£³å’Œäº‹ä»¶å¤„ç†çœ‹å®Œäº†ï¼Œå†çœ‹çœ‹å†…å®¹ç‰© children æ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚æˆ‘ä»¬ä¸ºäº†ä½¿ç”¨ä¾¿åˆ©ï¼Œå¯¹ç”¨æˆ·æš´éœ²å‡ºä¸€ä¸ªå†…ç½®çš„modal content ç»„ä»¶ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªåŠ äº†æ ·å¼çš„ divï¼š\n\n\n```jsx\nexport const SContent = styleWrap({ className: contentCls })(\n  styled.div((props) =\u003e {\n    const { maxHeight } = props as any;\n    return css`\n      padding: 16px 20px;\n      overflow: auto;\n      max-height: ${maxHeight};\n    `;\n  }),\n);\n```\n\n## 4. ä¸€ä¸ªğŸŒ°\n\næˆ‘ä»¬æ¥ä½¿ç”¨ä»¥ä¸‹åˆšåˆšå†™å¥½çš„ç»„ä»¶ï¼š\n\n\n```jsx\n...\nconst props = {\n    visible: true\n}\n\u003cModal\n    {...props}\n    onClose={() =\u003e this.close()}\n    afterClose={() =\u003e console.log('afterClose')}\n    onOk={() =\u003e console.log('onOk')}\n    title=\"this is title\"\n\u003e\n    \u003cModal.Content\u003ethis is content\u003c/Modal.Content\u003e\n\u003c/Modal\u003e\n```\n\nç•Œé¢å¦‚ä¸‹ï¼š\n\n\n![image.png](/img/posts/2022-6-28/2022-6-28-1.png)\n\n---\n\næ¨¡æ€æ¡†ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œæœ¬æ–‡å°±åˆ°æ­¤ç»“æŸå•¦~~"])</script><script>self.__next_f.push([1,"3e:T24ab,"])</script><script>self.__next_f.push([1,"## 1. å‰è¨€\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æˆ‘ä»¬ç»§ç»­æˆ‘ä»¬çš„ React ç»„ä»¶åº“ç³»åˆ—ã€‚æœ¬ç¯‡ä»‹ç»å¼¹å‡ºå±‚ PopOverä»¥åŠ tooltip çš„å®ç°ã€‚æœ¬æ–‡çš„ä»£ç å±•ç¤ºçš„æ˜¯ä¸»è¦çš„æ ¸å¿ƒä»£ç ï¼Œå…¨éƒ¨ä»£ç è§ä»“åº“ï¼š[Githubä»“åº“](https://github.com/heiheihoho1213/dux-ui)ï¼Œç»„ä»¶æ ·å¼è§[ä¸»é¡µ](https://heiheihoho1213.github.io/dux-ui/)ã€‚\n\n\n## 2. å®šä¹‰å…¥å‚\n\né¦–å…ˆï¼Œè¿˜æ˜¯å…ˆç¡®å®šä¸€ä¸‹ä¸€ä¸ªå¼¹å‡ºå±‚éƒ½éœ€è¦ä»€ä¹ˆå‚æ•°æ¥æ§åˆ¶å‘¢ã€‚ç›¸ä¿¡å¤§å®¶ä¹Ÿéƒ½ç”¨è¿‡Tooltipä¹‹ç±»çš„ç»„ä»¶ï¼Œè‚¯å®šæœ‰æ§åˆ¶æ˜¾ç¤ºéšè—çš„å±æ€§ï¼Œè¿˜æœ‰å±•å¼€æ–¹å‘ç­‰ï¼Œæˆ‘è¿™é‡Œæ€»ç»“äº†ä¸€ä¸‹åŸºç¡€çš„å±æ€§ï¼š\n\n\n| å±æ€§ | è¯´æ˜ |\n| --- | --- |\n| visible | å—æ§ï¼Œæ§åˆ¶å¼¹å‡ºå±‚å±•ç¤º |\n| trigger | è§¦å‘æ–¹å¼ |\n| placement | å±•å¼€æ–¹å‘ |\n| onVisibleChange | æ˜¾ç¤ºäº‹ä»¶ |\n| popup | å¼¹å‡ºå±‚çš„å…ƒç´  |\n| zIndex | å±‚çº§ |\n| popupClassName | å¼¹å‡ºå±‚ç±»å |\n\n\n## 3. rc-trigger\n\n[rc-trigger](https://www.npmjs.com/package/rc-trigger)æ˜¯ä¸€å¥—æµè¡Œçš„å¼€æºåº“ï¼Œé›†æˆäº†å„ç§è§¦å‘æ–¹å¼åˆ¤æ–­ã€å¼¹å‡ºå±‚æ¸²æŸ“ç­‰åŠŸèƒ½ã€‚æœ¬ç»„ä»¶åº“å°±ä½¿ç”¨è¯¥ç¬¬ä¸‰æ–¹åº“ã€‚\n\nå…ˆå¼•å…¥ä¸€ä¸‹ï¼š\n\n```js\nimport RcTrigger from 'rc-trigger';\n```\nç„¶åå£°æ˜ä¸€ä¸ªrcTriggerçš„ç»„ä»¶ï¼š\n\n```jsx\nclass RcTriggerWrap extends Component {\n  static propTypes = {\n    className: PropTypes.string,\n    popupClassName: PropTypes.string,\n    trueClassName: PropTypes.string,\n  };\n  render() {\n    const { className, popupClassName, trueClassName, ...rest } = this.props as any;\n    return (\n      \u003cRcTrigger\n        className={trueClassName}\n        popupClassName={classnames(className, popupClassName)}\n        {...rest}\n      /\u003e\n    );\n  }\n}\n```\n\næ¥ä¸‹æ¥ï¼Œç”¨styledæ ·å¼åŒ…è£¹ä¸€ä¸‹ï¼Œä¾¿äºæˆ‘ä»¬è‡ªå®šä¹‰æ ·å¼ï¼š\n\n```jsx\nimport styled from '@emotion/styled';\n\nexport const PopoverWrap = styled(RcTriggerWrap)`\n    /* æ”¾ç½®css */\n`;\n```\nè¿™ä¸ª`PopoverWrap`ä¾¿æ˜¯æˆ‘ä»¬ä¹‹åè¦ç”¨çš„å¼¹å‡ºå±‚ç»„ä»¶çš„å¤–å£³äº†ã€‚\n\nå¼¹å‡ºå±‚çš„ç»„ä»¶ï¼Œå…¶å®åªéœ€è¦å¯¹å¤–æš´éœ² `action` ã€`placement` å’Œ `popup`å±æ€§å°±è¡Œäº†ï¼Œæ‰€è°“åœ¨å¯¼å‡ºæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å†å°è£…ä¸€ä¸‹ã€‚\n\nåœ¨ç»„ä»¶åº“çš„index.tsxæ–‡ä»¶ä¸­ï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š\n\n\n```tsx\n...\nreturn \u003cPopoverWrap\n            action={trigger}\n            popupPlacement={placement}\n            popupTransitionName={\n              transitionName || animation ? animationPrefixCls + '-' + animation : null\n            }\n            popupVisible={popup == null ? false : this.state.visible}\n            popup={popup}\n            onPopupVisibleChange={this.onVisibleChange}\n            popupClassName={className}\n            getPopupContainer={getPopupContainer}\n      \u003e\n            {children}\n      \u003c/PopoverWrap\u003e\n```\n- `action`å¯¹åº”çš„æ˜¯rc-triggerçš„actionå±æ€§ï¼Œtriggeré€šè¿‡propsæ¥å—ã€‚æŒ‡çš„æ˜¯è§¦å‘å¼¹å‡ºçš„æ“ä½œï¼Œå¯é€‰é¡¹æœ‰ 'hover','click','focus','contextMenu'ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„å‚æ•°ï¼Œé»˜è®¤ä¸ºï¼š`['hover']`\n\n- `popupPlacement`å¯¹åº”çš„æ˜¯rc-triggerçš„popupPlacementå±æ€§ï¼Œé€šè¿‡propsæ¥å—ã€‚æ˜¯ä¸€ä¸ªæšä¸¾é¡¹ï¼Œæšä¸¾å®šä¹‰å¦‚ä¸‹ï¼š\n\n```ts\nplacement?:\n    | 'topLeft'\n    | 'top'\n    | 'topRight'\n    | 'bottomLeft'\n    | 'bottom'\n    | 'bottomRight'\n    | 'leftTop'\n    | 'left'\n    | 'leftBottom'\n    | 'rightTop'\n    | 'right'\n    | 'rightBottom';\n```\n\n- `popupTransitionName`å¯¹åº”rc-triggerçš„popupTransitionNameå±æ€§ï¼Œå®šä¹‰å¼¹å‡ºçš„åŠ¨ç”»ï¼Œæ˜¯å¯é€‰é¡¹ã€‚å¯é€šè¿‡propsæ¥å—animationå±æ€§æ¥å®šä¹‰ã€‚ç›®å‰ï¼Œrc-triggeråªæ”¯æŒä¸Šä¸‹æ–¹å‘çš„åŠ¨ç”»ï¼Œå…¶å†…éƒ¨ä½¿ç”¨äº†rc-animationï¼Œå¯é€‰é¡¹å¦‚ä¸‹ï¼š\n`\"fade\" | \"zoom\" | \"bounce\" | \"slide-up\"`\n\n- `popupVisible`å¯¹åº”rc-triggerçš„popupVisibleå±æ€§ï¼Œåœ¨ç”¨æˆ·ä¼ äº†popupåï¼Œé€šè¿‡props.visibleå±æ€§æ¥æ§åˆ¶ï¼Œè‹¥ç”¨æˆ·æ²¡æœ‰ä¼ popupï¼Œå¼ºè¡Œç½®ä¸ºfalse\n\n- `popup`å¯¹åº”rc-triggerçš„popupå±æ€§ï¼Œæ˜¯æœ€æ ¸å¿ƒçš„å‚æ•°ï¼Œå¯ä¼ ä¸€ä¸ªElementå…ƒç´ ï¼Œç”¨äºå¼¹å‡ºå±‚çš„å±•ç¤ºã€‚\n- `onPopupVisibleChange`å±æ€§åŒä¸Šï¼Œåœ¨popupå¼¹å‡ºæ—¶è§¦å‘ã€‚\n- `popupClassName`å¯¹åº”rc-tableçš„popupClassNameï¼Œç»™å¼¹å‡ºå±‚åŠ ä¸€ä¸ªç±»åã€‚\n- `getPopupContainer`å¯¹åº”rc-tableçš„getPopupContainerï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªå¼¹å‡ºå±‚å®¹å™¨ï¼Œéå¿…é€‰é¡¹ã€‚\n- æœ€åä¸èƒ½å°‘äº†å‚æ•° `children`, é€šè¿‡hoveræˆ–è€…clickè¿™ä¸ªchildrenæ‰èƒ½è§¦å‘å¼¹å‡ºå±‚çš„å˜åŒ–ã€‚rc-triggerç»„ä»¶å¯ä»¥éšæ€§çš„ä¼ ä¸€ä¸ªåŒåçš„childrenï¼Œæ–‡æ¡£é‡Œè™½ç„¶æ²¡æœ‰å†™æ˜ï¼Œä½†æ˜¯reactç»„ä»¶é»˜è®¤éƒ½å¯ä»¥è¿™æ ·ä¼ é€’ã€‚\n\n\n## 4. å®šä¹‰æ ·å¼\n\nå¯¹äºå¼¹å‡ºå±‚ç»„ä»¶çš„å¤–å£³PopoverWrapï¼Œè¿˜è®°å¾—ä¸Šè¾¹é¢„ç•™çš„æ ·å¼çš„ç©ºç™½äº†å—ï¼Œæˆ‘ä»¬è¿™é‡Œåˆ†æƒ…å†µè®¨è®ºã€‚\n\nå…ˆæŠŠå¤–å£³è®¾ç½®ä¸ºç»å¯¹å®šä½ï¼Œè¿™æ˜¯ä¸ºäº†é…åˆrc-triggerçš„topå’Œbottomæ ·å¼ï¼Œå¦å¤–ï¼Œæƒ³è¦å¼¹å‡ºå±‚è·Ÿéšç‚¹å‡»åŒºåŸŸï¼Œä¹Ÿå¿…é¡»ç»å¯¹å®šä½ï¼Œçˆ¶å…ƒç´ ä½¿ç”¨ç›¸å¯¹å®šä½ã€‚\n\n```tsx\nconst _prefixCls = 'dux-ui'; // é€šè¿‡å¯¼å…¥å…¨å±€å˜é‡è·å¾—\n\nexport const prefixCls = _prefixCls + '-popover';\nexport const animationPrefixCls = prefixCls + '-animation';\n\nexport const PopoverWrap = styled(RcTriggerWrap)`\n  \u0026.${prefixCls} {\n    // å¼¹å‡ºå±‚ç»å¯¹å®šä½\n    position: absolute;\n    z-index: 1030;\n    display: block;\n\n    \u0026-hidden {\n      display: none;\n    }\n  }\n  ...\n`;\n```\n\nåœ¨æ§åˆ¶å°é‡Œå¯ä»¥çœ‹åˆ°ï¼š\n\n![WeChat37acb5ff66ca4ccd10b4cf17b7162a84.png](/img/posts/2022-6-22/2022-6-22-1.png)\n\nrc-triggerä¼šåœ¨ä¼ å…¥çš„popupClassNameåæ‹¼æ¥ä¸€ä¸ªå¸¦æœ‰æ–¹å‘å‚æ•°çš„ç±»åï¼Œç”±æ­¤ï¼Œæˆ‘ä»¬æ¥å®šä¹‰å„è‡ªçš„æ ·å¼ï¼Œä»¥å·¦ä¸‹å’Œå·¦ä¸Šä¸ºä¾‹ï¼š\n\n\n```scss\n\u0026-enter-active.${prefixCls}-placement-bottomLeft,\n    \u0026-appear-active.${prefixCls}-placement-bottomLeft {\n    animation-name: ${slideUpIn};\n    animation-play-state: running;\n}\n\u0026-enter-active.${prefixCls}-placement-topLeft,\n    \u0026-appear-active.${prefixCls}-placement-topLeft {\n    animation-name: ${slideDownIn};\n    animation-play-state: running;\n}\n```\n\nåˆ†åˆ«é…ç½®ä½¿ç”¨ä¸åŒçš„åŠ¨ç”»ï¼Œå¦‚æœä¸æƒ³è‡ªå®šä¹‰åŠ¨ç”»ï¼Œä¹Ÿå¯ä»¥ä¸è®¾ç½®ã€‚\n\n\nå¦‚æœpropsä¸­å£°æ˜äº†åŠ¨ç”»ç±»å‹ï¼Œåˆ™ä¼šæœ‰ä¸€ä¸ªè¿™æ ·çš„ç±»åï¼š\n\n![WeChat2b4c3d7733fd94dae215a0b13c47490f.png](/img/posts/2022-6-22/2022-6-22-2.png)\n\n\nä»¥fadeä¸ºä¾‹ï¼Œå¯ä»¥è¿™æ ·å£°æ˜cssï¼š\n\n```css\nconst animationDuration = '0.1s';\n\n...\n\u0026-fade {\n  \u0026-enter,\n  \u0026-appear,\n  \u0026-leave {\n    animation-duration: ${animationDuration};\n    animation-fill-mode: both;\n  }\n  \u0026-enter,\n  \u0026-appear {\n    animation-name: ${fadeIn};\n  }\n  \u0026-leave {\n    animation-name: ${fadeOut};\n  }\n}\n```\n\nè‡³äºåŠ¨ç”»çš„å…·ä½“å†™æ³•ï¼Œæœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œä»¥æ·¡å…¥æ·¡å‡ºä¸ºä¾‹ï¼Œå®ç°ä¸€ç§ä½œä¸ºå‚è€ƒï¼š\n\n```css\nexport const fadeIn = keyframes`\n    from {\n        opacity: 0;\n    }\n\n    to {\n        opacity: 1;\n    }\n`;\nexport const fadeOut = keyframes`\n    from {\n        opacity: 1;\n    }\n\n    to {\n        opacity: 0;\n    }\n`;\n```\n\n## 5. ä¸€ä¸ªğŸŒ° \n\næœ‰äº†è¿™äº›åŸºæœ¬çš„é…ç½®ï¼Œä¸€ä¸ªå¼¹å‡ºå±‚ç»„ä»¶å°±èƒ½è·‘èµ·æ¥äº†ã€‚\n\næµ‹è¯•ï¼š\n\n```tsx\nconst Popup = () =\u003e (\n  \u003cdiv style={{ height: 30, border: '1px solid #ddd', background: '#fff' }}\u003eThis is a popup\u003c/div\u003e\n);\n\n\u003cPopover trigger={['hover']} popup={\u003cPopup /\u003e}\u003e\n    \u003cContent\u003e{'hover'}\u003c/Content\u003e\n\u003c/Popover\u003e\n```\n\né¢„è§ˆæ•ˆæœï¼š\n\n\n![WeChatee739043574f992511ff4658245bc54f.png](/img/posts/2022-6-22/2022-6-22-3.png)\n\næˆåŠŸï¼\n\n\n## 6. è¿›é˜¶ï¼šåšä¸€ä¸ªTooltip\n\nTooltipçš„åº•å±‚ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªpopoverï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹ã€‚\n\nç›´æ¥çœ‹returnçš„ç»“æœï¼š\n\n```tsx\n\u003cPopover\n      placement={placement}\n      popupClassName={...}\n      popup={popup}\n /\u003e\n```\nTooltipä¸åŒäºé€šç”¨å¼¹å‡ºå±‚çš„åœ°æ–¹åœ¨äºpopupçš„å†…å®¹ï¼Œä»–ä¼šæœ‰ä¸€ä¸ªç±»ä¼¼æ¼«ç”»å¯¹è¯æ¡†çš„å°ç®­å¤´ã€‚é‚£æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸‹popupï¼š\n\n\n```tsx\nexport const arrowWrapCls = popoverPrefixCls + '-span' + '-arrow-wrap';\nexport const arrowCls = popoverPrefixCls + '-span' + '-arrow-inner';\n\nconst popup = useMemo(() =\u003e {\n    return (\n      \u003cTooltipWrap\u003e\n        {arrow \u0026\u0026 (\n          \u003cArrow className={arrowWrapCls}\u003e\n            \u003cArrowInner className={arrowCls} /\u003e\n          \u003c/Arrow\u003e\n        )}\n        \u003cContentWrap customStyle={customStyle}\u003e\n          {popup}\n        \u003c/ContentWrap\u003e\n      \u003c/TooltipWrap\u003e\n    );\n  }, [popup, arrow, customStyle, theme]);\n```\n\nå¯ä»¥çœ‹åˆ°å…¶æ¥å—äº†å‡ ä¸ªæ–°çš„å‚æ•°ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥åˆ†æã€‚\n\n- `arrow`: ä¸€ä¸ªboolå€¼ï¼Œæ§åˆ¶æ˜¯å¦æ˜¾ç¤ºç®­å¤´ã€‚é»˜è®¤æ˜¯æ²¡æœ‰çš„ï¼š\n\n![image.png](/img/posts/2022-6-22/2022-6-22-4.png)\n\næˆ‘ä»¬æ¥å®šä¹‰ç®­å¤´çš„æ ·å¼ï¼Œä»¥ top çš„æ–¹å‘ä¸ºä¾‹ï¼š\n\n\n```css\nconst arrowMixin = css`\n  display: inline-block;\n  position: absolute;\n  width: 0;\n  height: 0;\n  border-width: 0;\n  border-color: transparent;\n  border-style: solid;\n`;\n\nexport const Arrow = styled('span')`\n  ${arrowMixin};\n`;\nexport const ArrowInner = styled('span')`\n  ${arrowMixin};\n`;\n\n.${arrowWrapCls}, .${arrowCls} {\n    margin-left: -${arrowWidth};\n    border-width: ${arrowWidth} ${arrowWidth} 0 ${arrowWidth};\n    border-bottom-color: transparent;\n    border-left-color: transparent;\n    border-right-color: transparent;\n}\n.${arrowWrapCls} {\n    bottom: -${arrowWidth};\n}\n.${arrowCls} {\n    bottom: ${borderWidth};\n}\n```\nå¯ä»¥çœ‹åˆ°ï¼Œç”¨ä¸€ä¸ªç»å¯¹å®šä½çš„spanåŒ…è£¹ï¼Œè®¾ç½®å®½é«˜æ˜¯0ï¼Œç„¶åè®¾ç½®å…¶ä¸Šã€å³ã€å·¦è¾¹æ¡†å®½åº¦åå†è®¾ç½®å‚ç›´æ–¹å‘çš„åæ–¹å‘ï¼Œå³ä¸‹ã€å·¦ã€å³è¾¹æ¡†ä¸ºé€æ˜è‰²ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªç®­å¤´å‡ºæ¥ï¼Œæ•ˆæœå›¾å¦‚ä¸‹ï¼š\n\n\n![image.png](/img/posts/2022-6-22/2022-6-22-5.png)\n\nåŒç†ï¼Œå¯è®¾ç½®å…¶ä»–æ–¹å‘çš„ç®­å¤´æ ·å¼~~\n\n- `popup`: æ˜¯å¼¹å‡ºå±‚å…ƒç´ ã€‚\n- `TooltipWrap`å’Œ`ContentWrap`æ˜¯styledåŒ…è£¹ç»„ä»¶ï¼Œæœ¬è´¨æ˜¯ä¸ªdivï¼Œå¯ä»¥è‡ªå®šä¹‰æ ·å¼ã€‚\n\n---\n\nè‡³æ­¤ï¼Œå¼¹å‡ºå±‚ç»„ä»¶ä¹Ÿè®²å®Œè¾£~~"])</script><script>self.__next_f.push([1,"3f:T3a4b,"])</script><script>self.__next_f.push([1,"## 1. å‡ºç°èƒŒæ™¯\n\nåº”å“åº”å¼ç¼–ç¨‹çš„éœ€æ±‚ï¼Œå‡ºç°äº† Rx è¿™æ ·çš„ä¸“é—¨ç”¨æ¥å¤„ç†æ•°æ®å“åº”å¼çš„åº“ã€‚Rxå®¶æ—æœ‰å¾ˆå¤š: RxJavaï¼ŒRxSwift, Rx.NETç­‰ï¼Œè¿™é‡Œä¸»è¦ä»‹ç» RxJs çš„ä½¿ç”¨ã€‚\n\nRxJs æ˜¯ä¸€ä¸ªç›¸å½“çµæ´»çš„ï¼Œä½¿ç”¨JavaScriptè¯­è¨€çš„æ•°æ®å“åº”å¼åº“ã€‚ä½¿ç”¨ç›¸å½“çš„çµæ´»ï¼ŒAPIç¹å¤šï¼Œå­¦ä¹ æˆæœ¬ä½ï¼Œç”¨å®˜ç½‘çš„è¯å«`å¯ä»¥æŠŠ RxJS å½“åšæ˜¯ç”¨æ¥å¤„ç†äº‹ä»¶çš„ Lodash `ã€‚\n\n## 2. å…³é”®è¯\n\nReactiveXã€è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å™¨æ¨¡å¼ã€å‡½æ•°å¼ç¼–ç¨‹ã€æ•°æ®ç®¡é“ã€‚\n\n## 3. RxJsç‰¹ç‚¹\n\n1.  çº¯å‡€æ€§ (Purity)ï¼šä½¿ç”¨çº¯å‡½æ•°æ¥äº§ç”Ÿå€¼\n\n\u003e ä¸‹å›¾ä¸­ï¼ŒfromEventä¾¿æ˜¯çº¯å‡½æ•°ï¼Œå‡½æ•°çš„è¾“å‡ºä¸éšå¤–éƒ¨å˜é‡çš„å½±å“\n\u003e ![1.png](/img/posts/2022-6-19/2022-6-19-1.png)\n\n2.  æµåŠ¨æ€§ (Flow)ï¼šRxJS æä¾›äº†ä¸€æ•´å¥—æ“ä½œç¬¦æ¥å¤„ç†æ•°æ®æµåŠ¨\n\n\u003e å¸¸ç”¨çš„è¿ç®—æœ‰ filterã€delayã€debounceTimeã€throttleTimeã€takeã€takeUntilã€distinctã€distinctUntilChanged\n\n![2.png](/img/posts/2022-6-19/2022-6-19-2.png)\n\n3.  ä»¥å€¼ (Values)ä¼ é€’ï¼šå¯¹äºæµç» observables çš„å€¼ï¼Œä½ å¯ä»¥å¯¹å…¶è¿›è¡Œè½¬æ¢ã€‚\n\n\u003e è¿˜æ˜¯ç‚¹å‡»äº‹ä»¶çš„ä¾‹å­ï¼Œä¸‹å›¾ä¸­çš„mapå’Œscanä¾¿å¯ä»¥å¯¹æµç»çš„æ•°æ®å€¼è¿›è¡Œæ˜ å°„å’Œæ•°å€¼è®¡ç®—\n\n![3.png](/img/posts/2022-6-19/2022-6-19-3.png)\n\n4.  Observable (å¯è§‚å¯Ÿå¯¹è±¡)\n\n\u003e Rxä¸­ä¸€åˆ‡éƒ½æ˜¯å¯è§‚å¯Ÿå¯¹è±¡ï¼Œæ•°æ®å€¼æ”¾åœ¨å¯è§‚å¯Ÿå¯¹è±¡ä¸­ã€‚å¯¹è±¡é€šè¿‡nextæ–¹æ³•å¾€æ•°æ®ç®¡é“é‡Œæ”¾å…¥å€¼ï¼Œåœ¨æ¥æ”¶ç«¯ï¼Œå¯ä»¥è®¢é˜…ï¼ˆsubscribeï¼‰åˆ›å»ºå‡ºæ¥çš„åŒä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡ï¼Œé€šè¿‡è®¢é˜…äº‹ä»¶**å¼‚æ­¥åœ°**æ‹¿åˆ°æ•°æ®å˜åŒ–çš„å†…å®¹ï¼Œå¹¶ä¸”å¯ä»¥å¤„ç†ä¼ è¾“å¼‚å¸¸ã€‚\n\n\u003e ä¸‹å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œsubscribeè¢«åˆ›å»ºæ—¶ï¼Œè‹¥ç®¡é“é‡Œæœ‰å€¼ï¼Œä»–ä¼šä¾æ¬¡éå†ä¸€ä¸‹å„ä¸ªå€¼ï¼ˆè¿™å¯ä»¥ç”¨ä½œå±€éƒ¨ç¼“å­˜ï¼‰ï¼Œå¹¶å¯è‡ªå®šä¹‰å¤„ç†å‡½æ•°ã€‚å¯¹äºå®ä»»åŠ¡ï¼ˆsetTimeoutï¼‰ä¼šå»¶ååˆ¤æ–­ã€‚\n\n![4.png](/img/posts/2022-6-19/2022-6-19-4.png)\n\nä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ä¸€ä¸ªå®Œæ•´çš„ subscribe è®¢é˜…å†…éƒ¨çš„æ„æˆã€‚nextå‡½æ•°æ¥å—ç®¡é“ä¼ å€¼ï¼›erroræ¥å—ä¼ å€¼å¼‚å¸¸åçš„é”™è¯¯ä¿¡æ¯ï¼›å½“å“åº”å¼å¯¹è±¡è°ƒç”¨completeå‡½æ•°åï¼Œæ‰§è¡Œcompleteå‡½æ•°ï¼Œå¹¶ç»“æŸè¯¥æ¬¡è®¢é˜…ã€‚\n\nä¸€èˆ¬ä¸Šï¼Œsubscribeå‡½æ•°è°ƒç”¨æ—¶ï¼Œåªæ¥å—ä¸€ä¸ªå‚æ•°çš„è¯ï¼Œé»˜è®¤å°±æ˜¯nextè¿‡æ¥çš„æ•°æ®å€¼ã€‚\n\n\u003e **ä¸å‡½æ•°ã€è¿­ä»£å™¨çš„åŒºåˆ«**\n\u003e\n\u003e *   å‡½æ•°å’Œ Observables éƒ½æ˜¯æƒ°æ€§è¿ç®—ã€‚å¦‚æœä½ ä¸è°ƒç”¨å‡½æ•°ï¼Œå°±ä¸ä¼šæ‰§è¡Œã€‚Observables ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå¦‚æœä½ ä¸â€œè°ƒç”¨â€å®ƒ(ä½¿ç”¨ subscribe)ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œ\n\u003e\n\u003e *   ES2015 å¼•å…¥äº† generator å‡½æ•°å’Œ iterators (function\\*)ï¼Œè¿™æ˜¯å¦å¤–ä¸€ç§ç±»å‹çš„æ‹‰å–ä½“ç³»ã€‚è°ƒç”¨ iterator.next() çš„ä»£ç æ˜¯æ¶ˆè´¹è€…ï¼Œå®ƒä¼šä» iterator(ç”Ÿäº§è€…) é‚£â€œå–å‡ºâ€å¤šä¸ªå€¼ã€‚\n\u003e\n\u003e Observable å¯ä»¥éšç€æ—¶é—´çš„æ¨ç§»â€œè¿”å›â€å¤šä¸ªå€¼ï¼Œè¿™æ˜¯å‡½æ•°æ‰€åšä¸åˆ°çš„ã€‚\n\nå­¦ä¹ RxJsï¼Œé¦–å…ˆå¾—å¼„æ‡‚ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼çš„ä¸»è¢«åŠ¨å…³ç³»ï¼š\n\n| ç”Ÿäº§è€…                 | æ¶ˆè´¹è€…                 |\n| ------------------- | ------------------- |\n| æ‹‰å–æ˜¯è¢«åŠ¨çš„: å½“è¢«è¯·æ±‚æ—¶äº§ç”Ÿæ•°æ®ã€‚  | æ‹‰å–æ˜¯ä¸»åŠ¨çš„: å†³å®šä½•æ—¶è¯·æ±‚æ•°æ®ã€‚   |\n| æ¨é€æ˜¯ä¸»åŠ¨çš„: æŒ‰è‡ªå·±çš„èŠ‚å¥äº§ç”Ÿæ•°æ®ã€‚ | æ¨é€æ˜¯è¢«åŠ¨çš„: å¯¹æ”¶åˆ°çš„æ•°æ®åšå‡ºååº”ã€‚ |\n\nRxJsæ˜¯ä¸»åŠ¨æ¨é€ã€è¢«åŠ¨æ¥å—æ¨¡å¼ã€‚ç®¡é“å…¥å£ï¼ˆå¯è®¢é˜…å¯¹è±¡ï¼Œæ¯”å¦‚Subjectï¼‰å¼ºè¡Œæ¨é€å€¼ï¼Œåœ¨å‡ºå£å¤„å¯é€‰æ‹©åœ°æ¥å—å’Œè¿‡æ»¤æ•°æ®ã€‚\n\nç¤ºä¾‹å‚è€ƒï¼š`\u003chttps://cn.rx.js.org/manual/overview.html#h21\u003e`\n\n## 4. å¸¸ç”¨è¿ç®—ç¬¦\n\n#### $1. of/from$\n\nå°†æ™®é€šå¯¹è±¡è½¬æ¢ä¸ºrxjså¯æ£€æµ‹çš„å“åº”å¼å¯¹è±¡\n\n![5.png](/img/posts/2022-6-19/2022-6-19-5.png)\n\n\u003e ä¸åŒç‚¹ï¼š ofè®¢é˜…åå¿ å®çš„æ‰“å°æºå¯¹è±¡ï¼Œfromä¼šå°†æºå¯¹è±¡è§£æ„åä¾æ¬¡æ‰“å°ã€‚æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒPromise.all ?\n\n#### $2. map$\n\n![6.png](/img/posts/2022-6-19/2022-6-19-6.png)\n\n\u003e é¡¾åæ€ä¹‰ï¼Œä¸æ•°ç»„çš„mapç±»ä¼¼ï¼Œå¯¹äºä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨pipeç®¡é“æŒ‡ä»¤è·å–å…¶ç®¡é“çš„å†…å®¹ï¼Œä¹‹åä¾¿å¯ä»¥ä½¿ç”¨å„ç§è¿ç®—ç¬¦æ¥å¤„ç†æ•°æ®å•¦ã€‚\n\n#### $3. concat å’Œ concatAll$\n\nåˆå¹¶Observableå¯¹è±¡å¹¶ä»¥æ­¤è¿”å›å…¶å€¼\n\nconcatï¼šé¦–å°¾ç›¸è¿ï¼Œå°†å„ä¸ªè®¢é˜…å€¼ç©¿èµ·æ¥è¾“å‡º\n\nä¾‹1ï¼š\n\n```js\n// RxJS v6+\nimport  {  of, concat }  from  'rxjs';\nconcat(\n  of(1,  2,  3),\n  // subscribed after first completes\n  of(4,  5,  6),\n  // subscribed after second completes\n  of(7,  8,  9)\n)\n// log: 1, 2, 3, 4, 5, 6, 7, 8, 9\n.subscribe(console.log);\n```\n\nä¾‹2ï¼š\n\n```js\nimport { concat, merge, defer, from } from 'rxjs'; \n\nconsole.log('Start')\nconst promiseA$ = defer(()=\u003efrom(new Promise((reslove, reject)=\u003e{\n  setTimeout(()=\u003e{\n    reslove('PromiseA')\n  }, 1000)\n})))\nconst promiseB$ = defer(()=\u003efrom(new Promise((reslove, reject)=\u003e{\n  setTimeout(()=\u003e{\n    reslove('PromiseB')\n  }, 1000)\n})))\n\n// ä¼šä¾æ¬¡é—´éš”ä¸€ç§’æ‰“å°Start, PromiseA, PromiseB\nconcat(promiseA$, promiseB$).subscribe(x =\u003e console.log(x));\n```\n\nconcatAllï¼šæ˜¯ä¸€ä¸ªé«˜é˜¶çš„å¤„ç†å‡½æ•°ï¼Œé¡ºåºæ¥å—ä¸Šæ¸¸æŠ›å‡ºçš„å„ä¸ªæ•°æ®æµä½œä¸ºå®ƒçš„æ•°æ®ï¼Œ è‹¥å‰é¢çš„æ•°æ®æµä¸èƒ½åŒæ­¥çš„å®Œç»“ï¼Œå®ƒä¼šæš‚å­˜åç»­æ•°æ®æµï¼Œå½“å‰æ•°æ®æµå®Œæˆåå®ƒæ‰ä¼šè®¢é˜…åä¸€ä¸ªæš‚å­˜çš„æ•°æ®æµã€‚å¯ä»¥æƒ³æˆæ˜¯æŠŠæ‰€æœ‰å…ƒç´  concat èµ·æ¥ã€‚å…¶å‰ç½®æ¡ä»¶å¼å¿…é¡»ä¼ è¿‡æ¥ä¸€ç»„ Observable å¯¹è±¡ã€‚\n\nä¾‹1ï¼š\n\n![7.png](/img/posts/2022-6-19/2022-6-19-7.png)\n\n\u003e concatAll ä¸€èˆ¬ç”¨äºå¤„ç†ä¸€æ¬¡æ€§æˆ–è€…çŸ­æ—¶é—´å†…æœ‰å¤šä¸ªç®¡é“æ•°æ®çš„æƒ…å†µã€‚æ¯”å¦‚å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œåœ¨ä»–å‰ç½®çš„è¿ç®—ç¬¦ï¼Œå¿…æœ‰ä¸€ä¸ªç±»ä¼¼äºmapçš„æ˜ å°„ï¼ŒconcatAll å¯ä»¥å°†ä¸€ä¸ª Observable å¯¹è±¡æ˜ å°„ä¸ºæ‹å¹³çš„å€¼æ¥ä¾æ¬¡å¤„ç†ã€‚\n\nä¸ä½¿ç”¨ concatAllï¼Œåªä½¿ç”¨mapæ—¶ï¼Œè¾“å‡ºç»“æœï¼š\n\n![image.png](/img/posts/2022-6-19/2022-6-19-8.png)\n\nä¾‹2ï¼šé‡å†™ä¸‹ä¸Šé¢ concat çš„ä¾‹2ï¼Œè¾“å‡ºç›¸åŒçš„ç»“æœ\n\n```js\nimport { concat, defer, from, of } from 'rxjs'; \nimport { tap, concatAll } from 'rxjs/operators';\n\nconsole.log('Start')\n\nconst promiseA$ = defer(() =\u003e from(new Promise((reslove, reject) =\u003e {\n  console.log('PromiseA is been Subscribed ')\n  setTimeout(()=\u003e{\n    reslove('PromiseA')\n  }, 1000)\n})))\n\nconst promiseB$ = defer(() =\u003e from(new Promise((reslove, reject) =\u003e {\n  console.log('PromiseB is been Subscribed ')\n  setTimeout(()=\u003e{\n    reslove('PromiseB')\n  }, 1000)\n})))\n\n// ä¼šä¾æ¬¡é—´éš”ä¸€ç§’æ‰“å°Start, PromiseA, PromiseB\nof(promiseA$, promiseB$).pipe(tap(console.log), concatAll()).subscribe(x =\u003e console.log(x));\n```\n\n#### $4. mergeAll$\n\nmergeAll ä¸ä¼šåƒ concatAll ä¸€æ ·é¦–å°¾ç›¸è¿è¾“å‡ºå€¼ï¼Œå…¶å¹¶è¡Œå¤„ç†æ‰€æœ‰çš„ Observableï¼Œä¸ä¿è¯è¾“å‡ºé¡ºåºã€‚\n\n![8.png](/img/posts/2022-6-19/2022-6-19-9.png)\n\n#### $5. è¡ç”Ÿæ“ä½œç¬¦ concatMap, mergeMap$\n\nconcatMap, mergeMap åˆ†åˆ«æ˜¯ `map + concatAll` å’Œ `map + mergeAll` çš„ç»“åˆä½“ã€‚\n\n![9.png](/img/posts/2022-6-19/2022-6-19-10.png)\n\nä¸Šé¢çš„å®æˆ˜ä¾‹å­ï¼Œæ¥å—ä¸€ä¸ªå¼¹çª—å…³é—­äº‹ä»¶ï¼Œåˆ¤æ–­å€¼æ˜¯å¦ä¸ºconfirmedï¼Œè‹¥æ˜¯ï¼Œåˆ™äº¤ç»™ mergeMapå¤„ç†ã€‚\n\nmergeMapæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„è¯·æ±‚æ•°æ®çš„æ“ä½œç¬¦ï¼Œè¯¦ç»†ä½¿ç”¨è§å®˜ç½‘ï¼š`\u003chttps://cn.rx.js.org/class/es6/Observable.js~Observable.html#instance-method-mergeMap\u003e`\n\nä¸‹é¢æ˜¯ä»–çš„æ‰§è¡ŒåŸç†ï¼š\n![10.png](/img/posts/2022-6-19/2022-6-19-11.png)\nä¸Šå›¾ä¸­ï¼Œç®—å­ç©¿äº†å¤„ç†å‡½æ•°ï¼š10\\*iï¼Œå°†ä¸¤ä¸ªæµä¸­çš„æ•°ç›¸ä¹˜ã€‚å¯ä»¥çœ‹åˆ°ç±»ä¼¼äºçŸ©é˜µä¹˜ç§¯çš„å½¢å¼ï¼Œåˆ†åˆ«ç›¸ä¹˜åè¾“å‡ºã€‚\n\nç±»ä¼¼çš„ï¼ŒconcatMap æ˜¯æŒ‰ç…§é¡ºåºæ’åˆ—çš„ï¼Œä½¿ç”¨åœºæ™¯æ›´åŠ å¹¿æ³›ã€‚æ¯ä¸ªæ–°çš„å†…éƒ¨ Observable ä¸å…ˆå‰çš„å†…éƒ¨ Observable é¦–å°¾ä¸²è”ç»„æˆã€‚ä»–è§£å†³äº† concat å’Œ concatAll çš„ä¸€ä¸ªé—®é¢˜ï¼šåä¸€ä¸ªæ•°æ®æµæ‹¿ä¸åˆ°å‰ä¸€ä¸ªæ•°æ®æµæŠ›å‡ºçš„æ•°æ®ã€‚\n\n\u003e æ³¨æ„ï¼šÂ `concatMap`ç­‰æ•ˆäºÂ `mergeMap` çš„å¹¶å‘å‚æ•°è®¾ç½® åˆ°Â `1`ã€‚\n\n![WeChat6cbaa584dbb91a47061695335ded81c5.png](/img/posts/2022-6-19/2022-6-19-12.png)\n\næˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ä¸Šé¢ concat çš„åŒä¸€ä¸ªä¾‹å­ï¼Œä¸è¿‡æ§åˆ¶ä¸€ä¸‹ä¸¤ä¸ªpromiseçš„å…ˆåé¡ºåºï¼Œè®©åä¸€ä¸ªpromiseè·å–å‰ä¸€ä¸ªpromiseçš„æ•°æ®ï¼š\n\n```js\nimport { concat, defer, from } from 'rxjs'; \nimport { concatAll, map, tap } from 'rxjs/operators'; \n\nconsole.log('Start')\n\nconst promiseA$ = defer(() =\u003e from(new Promise((reslove, reject)=\u003e{\n  setTimeout(() =\u003e {\n    reslove('PromiseA')\n  }, 1000)\n})))\n\n// è¿™æ˜¯ä¸€ä¸ªä¼šè¿”å›æ•°æ®æµpromiseB$çš„å‡½æ•°\nconst promiseB = data =\u003e from(new Promise((reslove, reject)=\u003e{\n  setTimeout(() =\u003e {\n    reslove(`${data} then PromiseB`)\n  }, 1000)\n}))\n\n// mapä¼šå°†æŠŠä¸Šæ¸¸å®Œæˆåçš„æ•°æ®é€šè¿‡promiseBè½¬æ¢æˆpromiseB$æ•°æ®æµ\n// å¹¶ä¼ é€’ç»™concatAll, concatAllå°†promiseB$è¿æ¥ä¸‹æ¸¸æ•°æ®æµ\n// è¿™é‡Œå°†åœ¨ä¸¤ç§’åæ‰“å°å‡º PromiseA then PromiseB\npromiseA$.pipe(\n  map(promiseB),\n  concatAll()\n).subscribe(x =\u003e console.log(x))\n```\n\næˆ‘ä»¬ä½¿ç”¨ concatMap æ”¹å†™ï¼š\n\n```js\nimport { concat, defer, from } from 'rxjs'; \nimport { concatMap, map, tap } from 'rxjs/operators'; \n\nconsole.log('Start')\n\nconst promiseA$ = defer(() =\u003e from(new Promise((reslove, reject)=\u003e{\n  setTimeout(() =\u003e {\n    reslove('PromiseA')\n  }, 1000)\n})))\n\n// è¿™æ˜¯ä¸€ä¸ªä¼šè¿”å›æ•°æ®æµpromiseB$çš„å‡½æ•°\nconst promiseB = data =\u003e new Promise((reslove, reject)=\u003e{\n  setTimeout(() =\u003e {\n    reslove(`${data} then PromiseB`)\n  }, 1000)\n})\n\n// concatMap å¯ä»¥æ¥æ”¶ä¸€ä¸ªè¿”å›Promiseçš„å‡½æ•°æˆ–è€…æ˜¯æ•°æ®æµ\n// è¿™é‡Œå°†åœ¨ä¸¤ç§’åæ‰“å°å‡º PromiseA then PromiseB\npromiseA$.pipe(\n  concatMap(promiseB)\n).subscribe(x =\u003e console.log(x))\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œå•å• concatMap å°±å¯ä»¥è®©åä¸€ä¸ªæ•°æ®æµæ¥å—å‰é¢æ•°æ®æµçš„æ•°æ®ï¼Œå…¶æœ¬è´¨å°±æ˜¯ map + concatAllã€‚\n\n**concatMap å¼•ç”³ï¼š**\n\nè€ƒè™‘ä¸€ä¸ªå®é™…çš„ä¸šåŠ¡åœºæ™¯ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªé¡µé¢ï¼Œé¡µé¢åˆå§‹åŒ–çš„æ—¶å€™æœ‰ä¸ªåˆå§‹åŒ–æ¥å£è·å–æ•°æ®ï¼Œé¡µé¢ä¸Šæœ‰ä¸ªä¸‹ä¸€æ­¥æŒ‰é’®ï¼Œè¿™ä¸ªæŒ‰é’®è§¦å‘çš„äº‹ä»¶éœ€è¦ä½¿ç”¨åˆå§‹åŒ–æ¥å£çš„æ•°æ®ã€‚\n\nå¯ä»¥è¿™æ ·å†™ï¼š\n\n```js\nimport { concat, defer, from, fromEvent } from 'rxjs'; \nimport { tap, concatMap } from 'rxjs/operators'; \n\n// ä½¿ç”¨promiseæ¥æ¨¡æ‹Ÿæ•°æ®è¯·æ±‚è¿‡ç¨‹\nconst req$ = defer(() =\u003e from(new Promise((reslove, reject)=\u003e{\n  setTimeout(() =\u003e {\n    reslove('This is init data')\n  }, 1000)\n})))\n\n// äº‹ä»¶æµ\nconst button$ = () =\u003e fromEvent(document.getElementById('button'), 'click')\n\n// ç‚¹å‡»æŒ‰é’®åè¾“å‡ºè¯·æ±‚å†…å®¹\n// è¿™é‡Œä¼šæ‰“å°å‡º This is init data\nreq$.pipe(\n  concatMap(button$, (data, event) =\u003e data)\n).subscribe(x =\u003e console.log(x))\n```\n\nconcatMapæ¥å—å¼‚æ­¥è¯·æ±‚çš„æ•°æ®ï¼Œç„¶åä¼ ç»™ button çš„ç‚¹å‡»äº‹ä»¶ Observable å¯¹è±¡ï¼Œé€šè¿‡è¯¥äº‹ä»¶ Observable å¯¹è±¡æ¥è¾“å‡ºç»“æœã€‚å¤„ç†äº‹ä»¶æ—¶ï¼Œ concatMap ç¬¬äºŒä¸ªå‚æ•°å°±æ´¾ä¸Šç”¨åœºäº†ã€‚\n\n#### $6. å®šæ—¶å™¨$\n\n```js\nimport { interval, timer } from 'rxjs';\n\nconst test_interval = interval(1000);\n\nconst test_timer = timer(1000, 5000);\n\nconst test_timer = timer(1000);\n\nexport {test_interval, test_timer}\n```\n\nintervalä¼šä¸åœçš„æŒ‰ç…§é—´éš”æ—¶é—´ç´¯åŠ æ•°å­—ï¼Œä»0å¼€å§‹ã€‚timeræ˜¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°æ—¶ï¼Œåœ¨æŒ‡å®šæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰åè¾“å‡ºä¸€ä¸ª0ï¼Œä¸¤ä¸ªå‚æ•°æ—¶ï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼ŒæŒ‡çš„æ˜¯ä»ç¬¬1ç§’å¼€å§‹ï¼Œæ¯éš”5ç§’å‡ºä¹¦ä¸€ä¸ªç´¯åŠ çš„å€¼ï¼Œä»0å¼€å§‹ã€‚\n\n#### $7. å¼‚å¸¸å¤„ç† throwError$\n\n```js\nimport { throwError, interval, of } from 'rxjs';\nimport { mergeMap } from 'rxjs/operators';\n\ninterval(1000).pipe(\nmergeMap(x =\u003e x === 2\n    ? throwError('Twos are bad')\n    : of('a', 'b', 'c')\n    ),\n).subscribe(x =\u003e console.log(x), e =\u003e console.error(e));\n```\n\nä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ç®—å­ throwErroræŠ›å‡ºé”™è¯¯ï¼ŒæŠ›å‡ºåï¼Œè®¢é˜…åœæ­¢ã€‚\n\n#### $8. zipAll$\n\nä¸‹å›¾ä¸­ï¼ŒzipAll å°† from æ“ä½œç¬¦è§£æ„å‡ºçš„æµå¼æ•°æ®åˆæ‹¼æ¥å›æ•°ç»„å½¢å¼ã€‚\n\n![12.png](/img/posts/2022-6-19/2022-6-19-13.png)\n\n#### $9. group ä¸ reduce$\n\nç±»ä¼¼ SQL ä¸­çš„ groupByï¼Œæ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›è¦groupçš„å¯¹è±¡keyå€¼ã€‚\n\n![13.png](/img/posts/2022-6-19/2022-6-19-14.png)\n\nè§£å¼€ tapçš„æ³¨é‡Šåï¼Œå¯ä»¥çœ‹åˆ°æ‰“å°çš„è¾“å‡ºï¼š\n\n![image.png](/img/posts/2022-6-19/2022-6-19-15.png)\n\nreduceç”¨æ¥èšåˆObservableä¸­çš„æ•°å€¼ã€‚\n\n#### $10. distinct$\n\nå»é‡ç®—å­ã€‚\n\nä½¿ç”¨RxJsæ¥æ•°ç»„å»é‡ï¼š\n\n![14.png](/img/posts/2022-6-19/2022-6-19-16.png)\n\n#### $11. takeUtill$\n\nç›´åˆ°æä¾›çš„ observable å‘å‡ºå€¼ï¼Œå®ƒä¾¿å®Œæˆ\n\nä¾‹1ï¼š\n\n![15.png](/img/posts/2022-6-19/2022-6-19-17.png)\n\n\u003e æ€è€ƒï¼šæ˜¯ä¸æ˜¯å¯ä»¥ç”¨æ¥ é˜²æŠ–èŠ‚æµ å‘¢\n\nä¾‹2ï¼šç›´åˆ°ç”¨æˆ·ç‚¹å‡»åï¼Œå¼€å¯å®šæ—¶å™¨\n\n![16.png](/img/posts/2022-6-19/2022-6-19-18.png)\n\n#### $12. takeLast$\n\nå–æµæ•°æ®çš„æœ€åä¸€ä¸ªï¼ˆåŒç†ï¼Œæœ‰ take(index: number)å‡½æ•°æ¥æ­£å‘æŒ‡å®šä¸‹æ ‡è·å–ï¼‰\n\n![17.png](/img/posts/2022-6-19/2022-6-19-19.png)\n\n#### $13. ä¸“ç”¨çš„é˜²æŠ–èŠ‚æµ$\n\nä¸Šé¢è¯´å¯ä»¥ç”¨takeUtilsæ¨¡æ‹Ÿé˜²æŠ–èŠ‚æµï¼Œå…¶å®Rxjsæœ‰ä¸“ç”¨çš„é˜²æŠ–èŠ‚æµå‡½æ•°ã€‚\n\n```js\nimport { debounceTime, throttleTime } from 'rxjs';\n\nObservable.fromEvent(document.getElementById(\"debounceTime\"), \"click\")\n    .debounceTime(1000)\n    .subscribe(() =\u003e console.log(\"debounceTime\"));\n    \nObservable.fromEvent(document.getElementById(\"throttleTime\"), \"click\")\n    .throttleTime(1000)\n    .subscribe(() =\u003e console.log(\"throttleTime\"));\n```\n\n#### $14. Subject å¯¹è±¡$\n\nSubjectç»§æ‰¿è‡ªObservableç±»ï¼ŒåŒæ ·å…·æœ‰æ•°æ®æµç›‘å¬ç‰¹æ€§ï¼Œå…¶ä½œä¸ºobservableçš„ä¸€ç§è½½ä½“ï¼Œå¤šç”¨äºç»„ä»¶ä¹‹é—´ä¼ é€’ã€‚\n\nå¯ä»¥æ¨é€(next)å’Œè¢«è®¢é˜…(subscribe)\n\n![18.png](/img/posts/2022-6-19/2022-6-19-20.png)\n\nBehaviorSubjectï¼šæ¯ä¸ªæ–°çš„è®¢é˜…å¯ä»¥æ‹¿åˆ°ç®¡é“ä¸­æœ€æ–°çš„é‚£æ¬¡æ•°æ®\n\n![19.png](/img/posts/2022-6-19/2022-6-19-21.png)\n\nAsyncSubjectï¼šcompleteæ—¶ä¼šè¾“å‡ºæœ€æ–°çš„ç®¡é“æ•°æ®ï¼Œå…¶ä½™æ—¶é—´ä¸è¾“å‡º\n\n![20.png](/img/posts/2022-6-19/2022-6-19-22.png)\n\nReplaySubjectï¼šæ¯æ¬¡æ–°è®¢é˜…æ—¶ï¼Œå¯æŒ‡å®šè·å–ç®¡é“ä¸­æœ€æ–°çš„Nä¸ªæ•°æ®\n\n![21.png](/img/posts/2022-6-19/2022-6-19-23.png)\n\n\u003e å¼•ç”³é˜…è¯»ï¼Œæ•°ç™¾ä¸ªæ“ä½œç¬¦ï¼šÂ http\\://[reactivex.io/documentation/operators.html](http://reactivex.io/documentation/operators.html)\n\n## 5. åº”ç”¨åœºæ™¯\n\n1.  å¤šäº‹ä»¶ç•Œé¢\n2.  æ›´åŠ å¤æ‚çš„äº¤äº’åœºæ™¯ï¼Œå°¤å…¶æ˜¯éœ€è¦ç»„ä»¶é—´å¤šçº§ä¼ é€’çš„æƒ…å†µ\n3.  éœ€è¦æºæºä¸æ–­çš„æµå‡ºæ•°æ®çš„åœºæ™¯\n\n## 6. ä¸ Promise å¯¹æ¯”\n\nå…±åŒç‚¹ï¼š\n\n1.  å¤„ç†å¼‚æ­¥\n\nä¾‹1ï¼š\n\n![22.png](/img/posts/2022-6-19/2022-6-19-24.png)\n\nä¾‹2ï¼š\n\n![23.png](/img/posts/2022-6-19/2022-6-19-25.png)\n\nä¸åŒï¼š\n\n1.  è®¾è®¡ç†å¿µä¸åŒï¼ˆå‘å¸ƒè®¢é˜…ã€è§‚å¯Ÿè€…+pipeï¼‰\n2.  ä¸­é€”å–æ¶ˆ\n\nåœ¨ä¸Šé¢å¼‚æ­¥å¤„ç†çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥é€‰æ‹©å–æ¶ˆå®šæ—¶å™¨ï¼šå³å–æ¶ˆè®¢é˜…\n\n![24.png](/img/posts/2022-6-19/2022-6-19-26.png)\n\n3.  å®Œå–„çš„å‡½æ•°å·¥å…·\n\n## 7. ä¸ React ç»“åˆ\n\nç¤ºä¾‹ï¼šç»„ä»¶é—´ä¼ é€’æ¶ˆæ¯\n\nçˆ¶ç»„ä»¶ï¼šå£°æ˜ä¸€ä¸ª subjectï¼Œé€šè¿‡ prop ä¼ é€’ç»™ å­ç»„ä»¶\n\n![25.png](/img/posts/2022-6-19/2022-6-19-27.png)\n\n![26.png](/img/posts/2022-6-19/2022-6-19-28.png)\n\nå­ç»„ä»¶ï¼šæ¥å—è¯¥ subjectï¼Œç„¶åå¾€é‡Œè¾¹æ¨é€å€¼ã€‚åŒç†ï¼Œçˆ¶ç»„ä»¶ä¹Ÿå¯ä»¥æ¨é€ï¼Œå­ç»„ä»¶æ¥ç›‘å¬ã€‚å¦‚æ­¤è¾¾åˆ° çˆ¶å­ç»„ä»¶ å…¨åŒå·¥é€šä¿¡ã€‚\n\n![27.png](/img/posts/2022-6-19/2022-6-19-29.png)\n\nç‚¹å‡»å­ç»„ä»¶çš„ä¸‰ä¸ªæŒ‰é’®ï¼Œå°±ä¼šçœ‹åˆ°çˆ¶ç»„ä»¶çš„è®¢é˜…è§¦å‘äº†ï¼\n\n![28.png](/img/posts/2022-6-19/2022-6-19-30.png)\n\nç‚¹å‡»åä¼šæœ‰ç›¸åº”è¾“å‡ºï¼Œæ¯”å¦‚ï¼š\n\n```\n1\n2\n3\n3\n```\n\næ¨èé¡¹ç›®ï¼š`\u003chttps://github.com/LeetCode-OpenSource/rxjs-hooks\u003e`\n\n\u003chr /\u003e\n\nå‚è€ƒï¼š\n\n*   [Rxjs Github](https://github.com/ReactiveX/rxjs)\n*   [ReactiveX å®˜ç½‘](https://reactivex.io/)"])</script><script>self.__next_f.push([1,"40:T732,"])</script><script>self.__next_f.push([1,"## 1. ä¼ªå…ƒç´ æ¨¡æ‹Ÿå®ç°å¾®è½¯logoé˜´å½±\n\n\u003e  CSS æ¢ç©¶ç³»åˆ—æ–‡ç« ä¹‹ä¼ªshadow\n\n```html\n\u003cdiv style={{ width: '100%', height: '500px', background: 'linear-gradient(90deg, hsl(199, 98%, 50%), hsl(199, 98%, 38%))', overflow: 'hidden' }}\u003e\n  \u003cdiv className={`${style.box}`}\u003e\n    \u003cdiv\u003e\u003c/div\u003e\n    \u003cdiv\u003e\u003c/div\u003e\n    \u003cdiv\u003e\u003c/div\u003e\n    \u003cdiv\u003e\u003c/div\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\n\n```html {{ title: 'HTML' }}\n\u003cdiv class='box'\u003e\n  \u003cdiv\u003e\u003c/div\u003e\n  \u003cdiv\u003e\u003c/div\u003e\n  \u003cdiv\u003e\u003c/div\u003e\n  \u003cdiv\u003e\u003c/div\u003e\n\u003c/div\u003e\n```\n\n```css {{ title: 'CSS' }}\n/* å…ˆä½¿ç”¨ grid å¸ƒå±€å®ç°å››ä¸ªæ–¹å—çš„å®šä½ */\n.box {\n  position: relative;\n  width: 20vmin;\n  height: 20vmin;\n  margin: 20vmin;\n  padding: 0;\n  z-index: 2;\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  grid-template-rows: repeat(2, 1fr);\n  grid-row-gap: 4%;\n  grid-column-gap: 4%;\n  grid-auto-flow: row;\n}\n\n/* è®¾ç½®ä¸¤ä¸ªä¼ªå…ƒç´ ï¼Œåˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªè¾¹çš„é˜´å½± */\n.box::before,\n.box::after {\n  content: \"\";\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 2;\n}\n\n.box::before {\n  /* transform-origin æ˜¯å˜å½¢åŸç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯¥å…ƒç´ å›´ç»•ç€é‚£ä¸ªç‚¹å˜å½¢æˆ–æ—‹è½¬ */\n  /*æ¯”å¦‚ï¼š0 50% è¡¨ç¤º x æ–¹å‘ä¸Šåœ¨æœ€å·¦è¾¹ï¼Œy æ–¹å‘ä¸Šåœ¨æœ€å·¦è¾¹é‚£æ¡è¾¹ä¸­é—´çš„ä½ç½® */\n  transform-origin: 0 0;\n  /* è·‘åˆ°æœ€å³è¾¹çš„ä¸Šè¾¹, scaleX ç¼©æ”¾ä¸€ä¸‹èŒƒå›´ï¼Œå¯ä»¥ä¸è¦ */\n  transform: translate(100%, 0) skewY(45deg) scaleX(.6);\n  background: linear-gradient(90deg, rgba(0, 0, 0, .3), transparent);\n  animation: shadowMoveY 5s infinite linear alternate;\n}\n\n.box::after {\n  transform-origin: 0 0;\n  transform: translate(0%, 100%) skewX(45deg) scaleY(.6);\n  background: linear-gradient(180deg, rgba(0, 0, 0, .3), transparent);\n}\n\n@keyframes shadowMoveY {\n  to {\n    transform: translate(100%, 0) skewY(20deg) scaleX(.6);\n  }\n}\n```\n\n![microsoft-logo](/img/posts/css/microsoft-logo.jpg)"])</script><script>self.__next_f.push([1,"41:T6cf,"])</script><script>self.__next_f.push([1,"```html\n\u003cdiv className={style.container}\u003e\n  \u003cdiv className={style.shadow}\u003eHover\u003c/div\u003e\n\u003c/div\u003e\n```\n\n#### è®¾ç½®åˆå§‹é¢œè‰²\n\nå…ˆè®¾ç½®å››ä¸ªè§’çš„é¢œè‰²ï¼ˆè®¾ç½®å®½é«˜. åœ†è§’. 0è¾¹æ¡† çš„ä»£ç çœç•¥ï¼‰ï¼š\n\n```html\n\u003cdiv class='shadow'\u003eHover\u003c/div\u003e\n```\n\n```css\n--color: #1e91e9;\n\n/* ç”¨å››ä¸ªé˜´å½±æ¨¡æ‹Ÿå››ä¸ªè±¡é™ï¼Œè¿™é‡Œåªè®¾ç½®ä¸€ä¸ªï¼Œå…¶å®åˆå§‹æ•ˆæœæ˜¯ä¸€æ ·çš„ */\nbox-shadow: 0 0 0 2px var(--color), 0 0 0 2px var(--color),\n  0 0 0 2px var(--color), 0 0 0 2px var(--color);\n```\n\n#### è®¾ç½®æµ®åŠ¨åŠ¨ç”»\n\n```css\n\n.shadow:hover {\n  --color: #1e91e9;\n  animation: border .5s ease forwards;\n}\n\n@keyframes border {\n  /* 1/4 æ—¶ï¼Œå³ä¸Šè§’ï¼šå‘å³åç§»ä¸º0ï¼Œå‘ä¸Šåç§»125ï¼Œä¸æ¨¡ç³Šï¼Œæ‰©æ•£2pxï¼Œå˜ä¸ºç°è‰² */\n  /* å·¦ä¸Šè§’ï¼šå‘å³åç§»ä¸º0ï¼Œå‘ä¸Šåç§»125ï¼Œä¸æ¨¡ç³Šï¼Œæ‰©æ•£2pxï¼Œå˜ä¸ºç°è‰² */\n  25% {\n    box-shadow: 0 -125px 0 2px var(--color),\n                -60px -60px 0 2px var(--color),\n                -60px 60px 0 2px var(--color),\n                60px 60px 0 2px var(--color),\n                0 0 0 2px #ccc;\n  }\n\n  50% {\n    box-shadow: 0 -125px 0 2px var(--color),\n                -125px 0px 0 2px var(--color),\n                -60px 60px 0 2px var(--color),\n                60px 60px 0 2px var(--color),\n                0 0 0 2px #ccc;\n  }\n\n  75% {\n    box-shadow: 0 -125px 0 2px var(--color),\n                -125px 0px 0 2px var(--color),\n                0px 125px 0 2px var(--color),\n                60px 60px 0 2px var(--color),\n                0 0 0 2px #ccc;\n  }\n\n  100% {\n    box-shadow: 0 -125px 0 2px var(--color),\n                -125px 0px 0 2px var(--color),\n                0px 125px 0 2px var(--color),\n                120px 40px 0 2px var(--color),\n                0 0 0 2px #ccc;\n  }\n}\n```"])</script><script>self.__next_f.push([1,"42:T60a,```html\n\u003cdiv className={style.container}\u003e\n  \u003cdiv className='flex-start'\u003e\n    \u003cdiv className={style.left}\u003eå·¦\u003c/div\u003e\n    \u003cp\u003ebox-shadow: -7px 0 5px -5px #ccc\u003c/p\u003e\n  \u003c/div\u003e\n  \u003cdiv className='flex-start'\u003e\n    \u003cdiv className={style.right}\u003eå³\u003c/div\u003e\n    \u003cp\u003ebox-shadow: 7px 0 5px -5px #ccc\u003c/p\u003e\n  \u003c/div\u003e\n  \u003cdiv className='flex-start'\u003e\n    \u003cdiv className={style.top}\u003eä¸Š\u003c/div\u003e\n    \u003cp\u003ebox-shadow: 0 -7px 5px -5px #ccc\u003c/p\u003e\n  \u003c/div\u003e\n  \u003cdiv className='flex-start'\u003e\n    \u003cdiv className={style.bottom}\u003eä¸‹\u003c/div\u003e\n    \u003cp\u003ebox-shadow: 0 7px 5px -5px #ccc\u003c/p\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\n```html\n\u003cdiv\u003e\n  å‚æ•°ï¼š x æ–¹å‘åç§»é‡ï¼ˆå³+ï¼‰ï¼Œ y æ–¹å‘åç§»é‡ ï¼ˆä¸‹+ï¼‰ï¼Œæ¨¡ç³ŠåŠå¾„ï¼Œæ‰©å¼ åŠå¾„\n\n  æ‰©å¼ åŠå¾„ä¼šæ ¹æ®æŒ‡å®šçš„å€¼å»æ‰©å¤§æˆ–ç¼©å°æŠ•å½±å°ºå¯¸ï¼Œå¦‚æœæˆ‘ä»¬ç”¨ä¸€ä¸ªè´Ÿçš„æ‰©å¼ åŠå¾„ï¼Œè€Œä»–çš„ç»å¯¹å€¼åˆšå¥½ç­‰äºæ¨¡ç³ŠåŠå¾„ï¼Œé‚£ä¹ˆæŠ•å½±çš„å°ºå¯¸å°±ä¼šä¸æŠ•å½±æ‰€å±çš„å…ƒç´ å°ºå¯¸å®Œå…¨ä¸€è‡´ï¼Œé™¤éä½¿ç”¨åç§»é‡æ¥ç§»åŠ¨ä»–ï¼Œå¦åˆ™æˆ‘ä»¬å°†çœ‹ä¸åˆ°ä»»ä½•æŠ•å½±ã€‚\n\u003c/div\u003e\n```\n\n```html\n\u003cdiv className={style.container}\u003e\n  \u003cdiv className='flex-start'\u003e\n    \u003cdiv className={style.left2}\u003eå·¦\u003c/div\u003e\n    \u003cp\u003ebox-shadow: -7px 0 5px 5px #ccc\u003c/p\u003e\n  \u003c/div\u003e\n  \u003cdiv className='flex-start'\u003e\n    \u003cdiv className={style.right2}\u003eå³\u003c/div\u003e\n    \u003cp\u003ebox-shadow: 7px 0 5px 5px #ccc\u003c/p\u003e\n  \u003c/div\u003e\n  \u003cdiv className='flex-start'\u003e\n    \u003cdiv className={style.top2}\u003eä¸Š\u003c/div\u003e\n    \u003cp\u003ebox-shadow: 0 -7px 5px 5px #ccc\u003c/p\u003e\n  \u003c/div\u003e\n  \u003cdiv className='flex-start'\u003e\n    \u003cdiv className={style.bottom2}\u003eä¸‹\u003c/div\u003e\n    \u003cp\u003ebox-shadow: 0 7px 5px 5px #ccc\u003c/p\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```43:Ta671,"])</script><script>self.__next_f.push([1,"## 0. å‰è¨€\n\n### 1ã€åç§°ç”±æ¥\n\nè¯´èµ·JavaScriptç›¸å…³çš„å†å²ï¼Œè¿˜å¾—è¿½æº¯åˆ°è®¡ç®—æœºåŠå…¶ç¼–ç¨‹è¯­è¨€è¯ç”Ÿä¹‹åˆçš„é‚£æ®µæ—¶é—´ã€‚\n\nåœ¨1959å¹´ï¼Œæ¬§æ´²çš„è®¡ç®—æœºäº§ä¸šå·²ç»å‡ºç°è“¬å‹ƒå‘å±•çš„è¿¹è±¡äº†ï¼Œç°ä»£æ„ä¹‰çš„è®¡ç®—æœºä¹Ÿè¶Šæ¥è¶Šå¤šåœ°å¼€å§‹åœ¨ç§‘ç ”æœºæ„ï¼Œæ”¿åºœç­‰ç¤¾ä¼šåœºæ‰€è¢«ä½¿ç”¨ï¼Œä½¿ç”¨çš„äººå¤šäº†ï¼Œè®¡ç®—æœºæ“ä½œæŠ€æœ¯å®ç°æ ‡å‡†åŒ–å°±è¢«æ¨ä¸Šäº†æ—¥ç¨‹ï¼Œä¾‹å¦‚ç¼–ç¨‹ï¼Œä»¥åŠè¾“å…¥å’Œè¾“å‡ºä»£ç è§„èŒƒç­‰ã€‚\n\nè¡Œä¸šæ ‡å‡†å¯¹äºè¡Œä¸šå‘å±•çš„é‡è¦æ€§ä¸è¨€è€Œå–»ã€‚ä¸ºäº†åè°ƒæ ‡å‡†åˆ¶å®šå·¥ä½œï¼Œæ¬§æ´²æ•°æ®å¤„ç†é¢†åŸŸå†å²æœ€æ‚ ä¹…çš„å…¬å¸ï¼ˆCompagnie des Machines Bullã€IBM World Trade Europe Corporation å’Œ International Computers and Tabulators Limitedï¼‰çš„è´Ÿè´£äººå‘æ‰€æœ‰å·²çŸ¥çš„è®¡ç®—æœºå‘å‡ºäº†è”åä¿¡ã€‚æ¬§æ´²åˆ¶é€ å•†é‚€è¯·è¿™äº›å…¬å¸æ´¾ä»£è¡¨å‚åŠ ä¼šè®®ã€‚è¿™æ¬¡ä¼šè®®äº 1960 å¹´ 4 æœˆ 27 æ—¥åœ¨å¸ƒé²å¡å°”ä¸¾è¡Œï¼›å†³å®šæˆç«‹ä¸€ä¸ªåˆ¶é€ å•†åä¼šï¼Œç§°ä¸ºæ¬§æ´²è®¡ç®—æœºåˆ¶é€ å•†åä¼šï¼ˆ`European Computer Manufacturers Association`ï¼‰æˆ–ç®€ç§° `ECMA`ï¼Œå¹¶æåäº†ä¸€ä¸ªå§”å‘˜ä¼šæ¥å‡†å¤‡è¯¥åä¼šçš„æˆç«‹å¹¶åˆ¶å®šç« ç¨‹å’Œè§„åˆ™ã€‚éšåçš„ 1961 å¹´ 5 æœˆ 17 æ—¥ï¼Œåä¼šæ­£å¼æˆç«‹ã€‚\n\nè¿™ä¾¿æ˜¯`ECMA`è¿™ä¸ªåå­—çš„æ¥æºã€‚\n\n`ECMA`èµ°å‘å…¨çƒåï¼Œåœ¨1994 å¹´æ›´åä¸ºï¼š`Ecma International`ã€‚å…¶å•†æ ‡â€œECMAâ€ç”±äºå†å²åŸå› è¢«ä¿ç•™äº†ä¸‹æ¥ï¼Œæ²¿ç”¨è‡³ä»Šã€‚\n\n### 2ã€ECMA-262æ ‡å‡†ï¼Œæ¢¦å¼€å§‹çš„åœ°æ–¹\n\n`EMCA`æ ‡å‡†å®¹çº³äº†å¤§é‡é€šä¿¡ã€è®¡ç®—æœºåŠå…¶ç›¸å…³è¡Œä¸šçš„æ ‡å‡†è§„èŒƒã€‚æˆ‘ä»¬æ‰¾ä¸€ä¸‹æœ¬æ–‡çš„ä¸»è§’ã€‚\n\nåœ¨[å®˜ç½‘](https://www.ecma-international.org/publications-and-standards/standards/)ä¸­æ‰’ä¸€å¼ å›¾ï¼š\n\n![image.png](/img/posts/2022-6-15/2022-6-15-1.png)\n\nå¯ä»¥çœ‹åˆ°ï¼Œç¬¬262å·æ ‡å‡†åˆå«`ECMAScript`ï¼Œæ˜¯ECMAå®šä¹‰çš„ä¸€å¥—è„šæœ¬è¯­è¨€ç¼–ç¨‹è§„èŒƒã€‚\n\n\u003e ECMAScript é€šå¸¸ç¼©å†™ä¸º ESã€‚\n\næ­£æ˜¯å› ä¸ºæœ‰è¿™ä¸ªæ ‡å‡†çš„å‡ºç°ï¼Œæ‰æœ‰äº† JavaScript çš„è“¬å‹ƒå‘å±•ï¼æ„Ÿè°¢å¤§ä½¬èµé¥­åƒï¼ï¼\n\nECMA-262æ˜¯ä¸€ç§è§„èŒƒï¼ˆå®˜ç½‘ä¸­å¯ä»¥æŸ¥åˆ°å„ä¸ªç‰ˆæœ¬çš„PDFææ¡ˆï¼‰ï¼Œè‡ªç„¶ä¼šæœ‰æ»¡è¶³è¿™ç§è§„èŒƒçš„å…·ä½“çš„è¯­è¨€è¢«åˆ›é€ å‡ºæ¥ã€‚æœ€è‘—åçš„å°±æ˜¯**JavaScript**\nï¼ˆç°åœ¨å•†æ ‡å±äºOracleï¼‰ï¼Œåœ¨1995å¹´ç”±[Netscape](https://baike.baidu.com/item/Netscape/2778944)å…¬å¸çš„Brendan Eichï¼Œåœ¨Netscapeå¯¼èˆªè€…æµè§ˆå™¨ä¸Šé¦–æ¬¡è®¾è®¡å®ç°è€Œæˆã€‚å› ä¸ºNetscapeä¸[Sun](https://baike.baidu.com/item/Sun/69463)åˆä½œï¼ŒNetscapeç®¡ç†å±‚å¸Œæœ›å®ƒå¤–è§‚çœ‹èµ·æ¥åƒJavaï¼Œå› æ­¤å–åä¸ºJavaScriptã€‚ä½†å®é™…ä¸Šå®ƒçš„è¯­æ³•é£æ ¼ä¸SelfåŠ[Scheme](https://baike.baidu.com/item/Scheme/8379129)è¾ƒä¸ºæ¥è¿‘ã€‚å…¶è®¾è®¡æ€è·¯å¦‚ä¸‹ï¼š\n\n1.  å€Ÿé‰´ C è¯­è¨€çš„åŸºæœ¬è¯­æ³•ã€‚\n2.  å€Ÿé‰´ Java è¯­è¨€çš„æ•°æ®ç±»å‹å’Œå†…å­˜ç®¡ç†ã€‚\n3.  å€Ÿé‰´ Scheme è¯­è¨€ï¼Œå°†å‡½æ•°æå‡åˆ°â€œç¬¬ä¸€ç­‰å…¬æ°‘â€ï¼ˆfirst classï¼‰çš„åœ°ä½ã€‚\n4.  å€Ÿé‰´ Self è¯­è¨€ï¼Œä½¿ç”¨åŸºäºåŸå‹ï¼ˆprototypeï¼‰çš„ç»§æ‰¿æœºåˆ¶ã€‚\n\n\u003e JavaScriptçš„æ˜¯ä¸€é—¨åŠ¨æ€å¼±ç±»å‹ã€åŸºäºåŸå‹çš„ä¸€ç§è§£é‡Šæ€§è®¡ç®—æœºè„šæœ¬è¯­è¨€ã€‚\n\nåœ¨æ²¡æœ‰ JavaScript çš„å¹´ä»£ï¼Œä¸€äº›ç®€å•çš„è¡¨å•éªŒè¯ï¼ˆå¦‚å¸¸è§çš„ å¯†ç å¤æ‚åº¦éªŒè¯ï¼‰éƒ½æ˜¯ç”±æœåŠ¡ç«¯è´Ÿè´£çš„ï¼Œè€Œä¸”å½“æ—¶çš„ç½‘ç»œé€Ÿåº¦æ˜¯éå¸¸æ…¢çš„ï¼Œè¿™ç§éªŒè¯æ–¹å¼ä¼šå¯¼è‡´ç½‘ç«™çš„å“åº”é€Ÿåº¦å˜å¾—æ›´æ…¢ï¼Œäºæ˜¯ä¾¿æœ‰äº†è¿™é—¨è¯­è¨€çš„è¯ç”Ÿã€‚\n\nå…¶æ¬¡è¿˜æœ‰å¾®è½¯è‡ªç ”çš„ä¸€å¥—è¯­è¨€ï¼Œå«`JScript`ï¼Œå…¶å£°ç§°å®Œå…¨éµå¾ª`ECMA-262`è§„èŒƒã€‚ä¸‹é¢åˆ—ä¸¾ä¸€ä¸‹äºŒè€…çš„åŒºåˆ«ï¼š\n\n| ç‰¹ç‚¹    | JavaScript                                       | JScript          |\n| ----- | ------------------------------------------------ | ---------------- |\n| è¿è¡Œå¹³å°  | å®¢æˆ·ç«¯,æœåŠ¡ç«¯                                          | å®¢æˆ·ç«¯,æœåŠ¡ç«¯          |\n| è§£é‡Šç¯å¢ƒ  | Netscape Livewireã€V8ï¼ˆChrome + nodeï¼‰ã€TraceMonkeyç­‰ | WSHã€ASPã€.Net     |\n| æ”¯æŒæµè§ˆå™¨ | æ‰€æœ‰ä¸»æµæµè§ˆå™¨                                          | ä¸»è¦æ˜¯IE3.0+        |\n| å‡ºç°æ—¶é—´  | æ¯”è¾ƒæ—©ï¼Œç”šè‡³æ—©äºECMA-262                                 | VBScriptç«äº‰å¤±è´¥åçš„äº§ç‰© |\n\n## 1. JavaScript 1.0 ï¼ˆ96å¹´ï¼‰\n\nå‘å¸ƒäº1996å¹´ï¼Œé€‚ç”¨äºNetscape Navigator2.0æµè§ˆå™¨ï¼Œåˆæ­¥ç¡®å®šäº†å®Œæ•´çš„JavaScriptçš„ä¸‰ä¸ªæ„æˆè¦ç´ ï¼š\n\n1.  ECMAScriptï¼ˆå§‘ä¸”è¿™ä¹ˆå«ï¼Œ1.3ç‰ˆæœ¬æ‰æ­£å¼å®Œå…¨å…¼å®¹ECMAè§„èŒƒï¼‰ã€‚JavaScript çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒè§„å®šäº† JavaScript çš„è¯­æ³•ã€ç±»å‹ã€è¯­å¥ã€ å…³é”®å­—ã€ä¿ç•™å­—ã€è¿ç®—ç¬¦å’Œå¯¹è±¡ã€‚\n\n2.  DOMï¼ˆDocument Object Modelï¼‰ã€‚é€šè¿‡æŠŠæ•´ä¸ªé¡µé¢æ˜ å°„æˆä¸€ä¸ªæ ‘ç»“æ„çš„æ–‡æ¡£ï¼Œæä¾› äº†ä¸€å¥—å¯ä»¥è®¿é—® HTML å’Œ XMLï¼ˆeXtensible Markup Languageï¼‰èŠ‚ç‚¹çš„ APIï¼ˆApplication Programming Interfaceï¼‰ï¼Œå¼€å‘è€…å¯ä»¥åˆ©ç”¨å®ƒè½»æ¾åœ°åˆ é™¤ã€æ·»åŠ ã€æ›¿æ¢æˆ–ä¿®æ”¹ä»»ä½•èŠ‚ç‚¹ã€‚\n\n3.  BOMï¼ˆBrowser Object Modelï¼‰ã€‚æä¾›äº†è®¿é—®æµè§ˆå™¨çª—å£çš„æ–¹æ³•ï¼Œå¼€å‘è€…å¯ä»¥æ§åˆ¶æµ è§ˆå™¨çª—å£è¿›è¡Œä¸€äº›è¯¸å¦‚ç§»åŠ¨çª—å£ä¹‹ç±»çš„æ“ä½œã€‚BOM éƒ¨åˆ†çš„æœ‰å…³å®šä¹‰ï¼Œé›¶æ•£åˆ†å¸ƒåœ¨å„ç§æ ‡ å‡†ä¸­ï¼Œä¸»è¦ä½äº HTML æ ‡å‡†ã€‚å…¶ä»–æ¯”å¦‚ WebRTC æ ‡å‡†ç­‰å†…ä¹Ÿå®šä¹‰äº†ä¸€äº›æ¥å£ã€‚\n\n\u003e 1.0é‡Œæœ‰ä¸€äº›ä»¥åå¾ˆå°‘ç”¨çš„å†·é—¨ç‰¹æ€§ã€‚æ¯”å¦‚å‡½æ•°ä¸ä½†æœ‰callï¼Œapplyæ–¹æ³•ï¼Œè¿˜æœ‰nameå’Œlengthï¼Œè¿˜æœ‰`arguments`ï¼ŒÂ `caller`ï¼ˆåœ¨1.2ç‰ˆç§»é™¤ï¼‰ï¼›Argumentsæ˜¯ä¸ªå¯¹è±¡è€Œä¸æ˜¯æ•°ç»„ï¼›å¯¹è±¡å¯ä»¥ç”¨æ•°å­—ä¸‹æ ‡è®¿é—®å±æ€§ï¼›æ²¡æœ‰===çš„å¼ºç±»å‹åˆ¤å®šï¼›å¯¹ä¸æ”¯æŒscriptæ ‡ç­¾çš„æµè§ˆå™¨åšç‰¹æ®Šæ³¨é‡Šå…¼å®¹ç­‰ã€‚\n\n## 2. JavaScript 1.1ï¼ˆ96å¹´ï¼‰\n\nå‘å¸ƒäº1996å¹´ä¸‹åŠå¹´ï¼Œé€‚é…äº†Netscape Navigator3.0 å’Œ IE3.0ã€‚å®Œå–„æ•°ç»„å¯¹è±¡å’Œæ–¹æ³•ã€‚\n\n## 3. JavaScript 1.2ï¼ˆ97å¹´ï¼‰\n\nå‘å¸ƒäº1997å¹´ï¼Œé€‚é…äº†Netscape Navigator4.0ï¼Œä½†ä¸æ”¯æŒ IE ç¯å¢ƒã€‚å¢åŠ äº†===çš„åˆ¤æ–­æ–¹å¼ã€‚\n\n## 4. JavaScript 1.3 ä¸ ECMAScript 1/2ï¼ˆ98å¹´ï¼‰\n\nå‘å¸ƒäº1998å¹´ã€‚å‰è¾¹è¯´JavaScriptå‡ºç°æ—¶é—´æ—©äºECMA-262ï¼ŒæŒ‡çš„å°±æ˜¯è¿™ä¸ªç‰ˆæœ¬çš„äº‹æƒ…ã€‚è¿™ä¸€å¹´ï¼ŒECMAæ ‡å‡†åŒ–äº†JavaScript1.1çš„åŸºæœ¬ç‰¹æ€§ï¼ŒåŒæ—¶JavaScriptä¹Ÿå‡çº§åˆ°1.3ï¼Œå¹¶æ·»åŠ äº†ä¸€äº›æ–°ç‰¹æ€§ï¼ˆæ²¡æœ‰æ ‡å‡†åŒ–switchè¯­å¥å’Œæ­£åˆ™è¡¨è¾¾å¼ï¼‰ã€‚è‡³æ­¤ï¼ŒJavaScriptæ‰é€æ­¥éµå¾ªECMAè§„èŒƒè¿›è¡Œå‡çº§æ¢ä»£ã€‚\n\nECMAScript 2æ ‡å‡†æ˜¯å¯¹v1çš„ä¸€ä¸ªç»´æŠ¤ç‰ˆæœ¬ï¼Œåªæ·»åŠ äº†è¯´æ˜ï¼Œä¹Ÿåœ¨åŒä¸€å¹´å‘å¸ƒã€‚\n\n## 5. JavaScript 1.4ï¼ˆ99å¹´ï¼‰\n\né€‚ç”¨äºNetscape serverçš„ä¸“ç”¨ç‰ˆæœ¬ã€‚\n\n## 6. JavaScript 1.5 ä¸ ECMAScript 3ï¼ˆ00å¹´ï¼‰\n\nå‘å¸ƒäº2000å¹´åº•ï¼Œå¼€å§‹æ”¯æŒ Mozilla Firefox å’Œ Opera æµè§ˆå™¨ï¼Œå¹¶æ ‡å‡†åŒ–äº†switchè¯­å¥ã€å¼‚å¸¸å¤„ç†( try/catch)å’Œæ­£åˆ™è¡¨è¾¾å¼ã€‚\n\n## 7. JavaScript 1.6ï¼ˆ05å¹´ï¼‰\n\n2005å¹´å‘å¸ƒã€‚é€æ­¥å¢åŠ äº†æ•°ç»„çš„æ‰©å±•æ–¹æ³•ã€å¢åŠ äº†Arrayå’ŒStringæ³›å‹ã€æ”¯æŒXMLæ‰©å±•ï¼ˆE4Xï¼‰ã€‚å¼€å§‹æ”¯æŒSafari 3.0ã€‚åŒå¹´ï¼ŒAjaxæŠ€æœ¯å‘å¸ƒã€‚\n\næ–°å¢çš„æ•°ç»„æ‰©å±•å¦‚ä¸‹ï¼ˆéƒ¨åˆ†æ‰©å±•åœ¨ES5ä¸­é€æ­¥è§„èŒƒåŒ–ï¼‰ï¼š\n\n| æ–°å¢æ‰©å±•          | æè¿°                                           |\n| ------------- | -------------------------------------------- |\n| indexOf()     | è¿”å›æŒ‡å®šé¡¹é¦–æ¬¡å‡ºç°çš„index                              |\n| lastIndexOf() | è¿”å›æŒ‡å®šé¡¹æœ€åä¸€æ¬¡å‡ºç°çš„index                            |\n| every()       | åœ¨æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªé¡¹è¿è¡Œä¸€ä¸ªå‡½æ•°ã€‚å¦‚æ–¹æ³•å¯ç”¨éå†æ¯ä¸€ä¸ªé¡¹éƒ½è¿”å›çš„trueï¼Œåˆ™è¿”å›true  |\n| filter()      | åœ¨æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªé¡¹è¿è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå¹¶å°†è¿™ä¸ªå‡½æ•°è¿”å›trueçš„é¡¹ä½œä¸ºä¸€ä¸ªæ•°ç»„è¿”å›       |\n| forEach()     | åœ¨æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªé¡¹è¿è¡Œä¸€ä¸ªå‡½æ•°                              |\n| map()         | åœ¨æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªé¡¹è¿è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå¹¶å°†æ‰€æœ‰çš„ç»“æœä½œä¸ºæ•°ç»„è¿”å›                |\n| some()        | åœ¨æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªé¡¹è¿è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•è®¿é—®çš„ä»»ä½•ä¸€ä¸ªé¡¹è¿”å›trueï¼Œåˆ™è¿”å›true |\n\næ³›å‹ï¼ˆéTSçš„é‚£ç§ï¼‰ä½¿ç”¨ï¼š\n\n```js\nfunctionÂ isLetter(character)Â {Â Â \n  returnÂ (characterÂ \u003e=Â \"a\"Â \u0026\u0026Â characterÂ \u003c=Â \"z\");Â Â \n}Â Â \n\n// åœ¨å­—ç¬¦ä¸²ä¸­ä½¿ç”¨æ•°ç»„çš„æ–¹æ³•\nifÂ (Array.every(str,Â isLetter))Â Â \n  alert(\"TheÂ stringÂ '\"Â +Â strÂ +Â \"'Â containsÂ onlyÂ letters!\");\n```\n\n## 8. JavaScript 1.7ï¼ˆ07å¹´ï¼‰\n\n2007å¹´å‘å¸ƒã€‚æ–°ç‰¹æ€§å¦‚ä¸‹ï¼š\n\n*   å­¦ä¹ äº†Pythonçš„è¯­æ³•ï¼Œå¹¶å¼•å…¥äº†Pythonic generatorsï¼ˆgeneratorå‡½æ•°ï¼‰ã€\n*   å¼•å…¥è§£æ„èµ‹å€¼\n*   Iteratorsï¼ˆè¿­ä»£å™¨ï¼‰\n*   let å£°æ˜\n\n\u003e è¿™ä»ç„¶æ˜¯ES3çš„å†…å®¹ï¼Œä¸è¦è®¤ä¸ºæ˜¯ES6æ‰æœ‰çš„ã€‚\n\n*   å¼€å§‹æ”¯æŒ Google Chrome1.0ã€‚\n\n## 9. ECMAScript 4\n\n2008å¹´è¢«åºŸå¼ƒçš„æ ‡å‡†ã€‚[æ­»äº¡åŸå› ](https://www.136.la/jingpin/show-14541.html)\n\n## 10. JavaScript 1.8 ï¼ˆ08-10å¹´ï¼‰ ä¸ ECMAScript 5 ï¼ˆ09å¹´ï¼‰\n\nåŒ…å«å¾ˆå¤špatchç‰ˆæœ¬ã€‚\n\n#### 2008å¹´å‘å¸ƒ 1.8.0\n\næ–°ç‰¹æ€§ï¼š\n\n| æ–°ç‰¹æ€§    | æè¿°                                   |\n| ------ | ------------------------------------ |\n| è¡¨è¾¾å¼é—­åŒ…  | è§ä¸‹é¢ä»£ç                                 |\n| ç”Ÿæˆå™¨è¡¨è¾¾å¼ | ä¸ªæ–°ç‰¹æ€§ä½¿ä½ å¯ä»¥ä½¿ç”¨ç±»ä¼¼æ•°ç»„æ¦‚å¿µçš„è¯­æ³•æ¥åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ç”Ÿæˆå™¨å¥æŸ„ï¼Œè§ä»£ç  |\n\nè¡¨è¾¾å¼é—­åŒ…ï¼š\n\n```js\n// JavaScript 1.7 ä»¥åŠæ›´è€çš„ç‰ˆæœ¬:\nfunction(x) { return x * x; }\n\n// JavaScript 1.8:\nfunction(x) x * x;\n```\n\nç”Ÿæˆå™¨è¡¨è¾¾å¼\n\n```js\n// ä½¿ç”¨1\nlet it = (i + 3 for (i in someObj));\ntry {\n    while (true) {\n        document.write(it.next() + \"\u003cbr\u003e\\n\");\n    }\n} catch (err if err instanceof StopIteration) {\n\n    document.write(\"End of record.\u003cbr\u003e\\n\");\n}\n\n// ä½¿ç”¨2\nfunction handleResults( results ) {\n    for ( let i in results )\n    ...\n}\nhandleResults( i for ( i in obj ) if ( i \u003e 3 ) );\n```\n\n#### åŒå¹´å‘å¸ƒ 1.8.1\n\næ–°ç‰¹æ€§ï¼š\n\n| æ–°ç‰¹æ€§                     | æè¿°                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n| ----------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| Object.getPrototypeOf() | è¿”å›æŒ‡å®šå¯¹è±¡çš„åŸå‹å¯¹è±¡ï¼Œè§[`ç¤ºä¾‹`](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Global_Objects/Object/GetPrototypeOf)                                                                                                                                                                                                                                                                                                                              |\n| Firefox 3.5 åŸç”Ÿæ”¯æŒ JSON   | -                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n| Stringå¯¹è±¡æ–°å¢æ–¹æ³•            | [`String`Â ](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/String)Â Â å¢åŠ Â Â [`trim()`Â ](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Global_Objects/String/Trim),Â Â Â [`trimLeft()`Â ](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Global_Objects/String/TrimLeft), å’ŒÂ Â Â [`trimRight()`Â ](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Global_Objects/String/TrimRight) |\n| å…¶ä»–ä¸€äº›æ¬¡è¦æ›´æ–°                | -                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n\n#### 2009å¹´å‘å¸ƒ 1.8.2\n\nä¸€äº›æ¬¡è¦æ›´æ–°ã€‚\n\n#### 2010å¹´å‘å¸ƒ 1.8.5ï¼Œå¹¶éµå¾ªECMAScript 5 ï¼ˆ2009å¹´å‘å¸ƒï¼‰è§„èŒƒ\n\nä¸€æ¬¡å¤§çš„æ›´æ–°ï¼Œå°†ä¹‹å‰JSå„ä¸ªç‰ˆæœ¬çš„æ–¹æ³•è¿›è¡Œç»Ÿä¸€æ±‡æ€»æ•´ç†ï¼Œå¹¶æ–°åŠ å…¥ä¸€æ‰¹APIï¼Œä¸€èµ·å†™å…¥è§„èŒƒï¼Œä½¿å¾—ESå’ŒJSçš„è´´åˆç¨‹åº¦æ›´æ·±ã€‚\n\n| æ–°ç‰¹æ€§       | æè¿°           |\n| --------- | ------------ |\n| æ·»åŠ äº†â€œä¸¥æ ¼æ¨¡å¼â€ | use 'strict' |\n| è§„èŒƒthiså…³é”®å­— | -            |\n| å¯¹ JSONæ”¯æŒ  | -            |\n| å­—ç¬¦ä¸²æ–¹æ³•     | è§ä¸‹åˆ—è¡¨         |\n| æ•°ç»„æ–¹æ³•      | è§ä¸‹åˆ—è¡¨         |\n| å„ç§å¯¹è±¡æ–¹æ³•    | è§ä¸‹åˆ—è¡¨         |\n\n*   **ä¸¥æ ¼æ¨¡å¼**\n\n1.  ä¸å…è®¸çœç•¥varå®šä¹‰å˜é‡\n2.  ä¸å…è®¸å‡½æ•°å½¢å‚åŒå\n3.  ä¸å…è®¸æ™®é€šå‡½æ•°ä¸­çš„thisä»£è¡¨window\n\n*   **thisè§„èŒƒ**\n\n1.  å…¨å±€thisã€æ™®é€šå‡½æ•°çš„this ã€ è‡ªè°ƒç”¨å‡½æ•°çš„thiséƒ½ä»£è¡¨window\n2.  äº‹ä»¶å‡½æ•°ä¸­çš„thisä»£è¡¨äº‹ä»¶æº\n3.  å¯¹è±¡æ–¹æ³•ä¸­çš„thisä»£è¡¨å½“å‰å¯¹è±¡\n4.  æ™®é€šå‡½æ•°è¢«è°è°ƒç”¨ï¼Œå‡½æ•°ä¸­thisæŒ‡å‘è°\n\n*   **ES5 æ–°å¢æ•°ç»„æ–¹æ³•/è§„èŒƒ**ï¼ˆéƒ¨åˆ†æ–¹æ³•js1.6ä¸­å·²ç»æœ‰è¿‡å®ç°ï¼Œåœ¨ES5æ­£å¼å†™å…¥è§„èŒƒï¼‰\n\n1.  Array.isArray()\n2.  Array.forEach()\n3.  Array.map()\n4.  Array.filter()\n5.  Array.reduce()\n6.  Array.reduceRight()\n7.  Array.every()\n8.  Array.some()\n9.  Array.indexOf()\n10. Array.lastIndexOf()\n\n*   **ES5æ–°å¢å­—ç¬¦ä¸²è§„èŒƒ**\n\n1.  String.trim()\n2.  charAt()\n3.  å¯å¯¹å­—ç¬¦ä¸²è¿›è¡Œå±æ€§è®¿é—®\n4.  å…è®¸å¤šè¡Œå­—ç¬¦ä¸²ï¼Œæ¯ä¸€è¡Œä½¿ç”¨åæ–œæ ç»“å°¾\n5.  String.fromCharCode() ç”¨äºä» Unicode ç ç‚¹è¿”å›å¯¹åº”å­—ç¬¦\n\n*   **ES5 æ–°å¢å„ç§å¯¹è±¡æ–¹æ³•**\n\n1.  JSON.parse()\n2.  JSON.stringify()\n3.  Date.now()\n4.  å±æ€§ Getter å’Œ Setter\n5.  æ–°çš„å¯¹è±¡å±æ€§å’Œæ–¹æ³•è§„èŒƒï¼Œè§ä¸‹è¡¨\n\n| æ–°çš„å¯¹è±¡å±æ€§å’Œæ–¹æ³•è§„èŒƒ                                         | æè¿°                                     |\n| --------------------------------------------------- | -------------------------------------- |\n| Object.defineProperty(object, property, descriptor) | æ·»åŠ æˆ–æ›´æ”¹å¯¹è±¡å±æ€§                              |\n| Object.defineProperties(object, descriptors)        | æ·»åŠ æˆ–æ›´æ”¹å¤šä¸ªå¯¹è±¡å±æ€§                            |\n| Object.getOwnPropertyDescriptor(object, property)   | è®¿é—®å±æ€§                                   |\n| Object.getOwnPropertyNames(object)                  | å°†æ‰€æœ‰å±æ€§ä½œä¸ºæ•°ç»„è¿”å›                            |\n| Object.keys(object)                                 | å°†å¯æšä¸¾å±æ€§ä½œä¸ºæ•°ç»„è¿”å›                           |\n| Object.hasOwnProperty(key)                          | æ˜¯å¦ä¸ºå¯¹è±¡è‡ªèº«å±æ€§                              |\n| Object.getPrototypeOf(object)                       | è·å–å¯¹è±¡åŸå‹                                 |\n| Object.preventExtensions(object)                    | é˜²æ­¢å‘å¯¹è±¡æ·»åŠ æ–°çš„å±æ€§                            |\n| Object.isExtensible(object)                         | å¦‚æœå¯ä»¥å°†å±æ€§æ·»åŠ åˆ°å¯¹è±¡ï¼Œåˆ™è¿”å› true                  |\n| Object.seal(object)                                 | é˜²æ­¢æ›´æ”¹å¯¹è±¡å±æ€§ï¼ˆè€Œä¸æ˜¯å€¼ï¼‰å¯¹è±¡ä¸å¯ä»¥æ–°å¢å±æ€§å’Œåˆ é™¤ ä½†æ˜¯å¯ä»¥ä¿®æ”¹      |\n| Object.isSealed(object)                             | å¦‚æœå¯¹è±¡è¢«å¯†å°ï¼Œåˆ™è¿”å› true                       |\n| Object.freeze(object)                               | é˜²æ­¢å¯¹å¯¹è±¡è¿›è¡Œä»»ä½•æ›´æ”¹ ä¸å¯ä»¥æ–°å¢å±æ€§å’Œåˆ é™¤ä¹Ÿä¸å¯ä¿®æ”¹ å®Œå…¨é”æ­»       |\n| Object.isFrozen(object)                             | å¦‚æœå¯¹è±¡è¢«å†»ç»“ï¼Œåˆ™è¿”å› true                       |\n| å…è®¸ä¿ç•™å­—ä½œä¸ºå±æ€§åç§°                                         | `var obj = {name: \"Bill\", new: \"yes\"}` |\n\n*   **ES5 è¯­æ³•æ›´æ”¹**\n\n1.  å¯¹å­—ç¬¦ä¸²çš„å±æ€§è®¿é—® \\[ ]\n2.  æ•°ç»„å’Œå¯¹è±¡å­—é¢é‡ä¸­çš„å°¾éšé€—å·ï¼ˆJSONé™¤å¤–ï¼‰\n3.  å¤šè¡Œå­—ç¬¦ä¸²å­—é¢é‡\n4.  ä½œä¸ºå±æ€§åç§°çš„ä¿ç•™å­—\n\n*   **ES5 æµè§ˆå™¨æ”¯æŒ**\n\nChrome 23ã€IE 10 å’Œ Safari 6 æ˜¯ç¬¬ä¸€æ‰¹å®Œå…¨æ”¯æŒ ECMAScript 5 çš„æµè§ˆå™¨ï¼š\n\n| Chrome23                                                                                                                                                                                | IE10/Edge                                                                                                                                                                           | Firefox21                                                                                                                                                                                | Safari6                                                                                                                                                                                 | Opera15                                                                                                                                                                                |\n| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| ![compatible\\_chrome.png](/img/posts/2022-6-15/chrome.png) | ![compatible\\_ie.png](/img/posts/2022-6-15/ie.png) | ![compatible\\_firefox.png](/img/posts/2022-6-15/firefox.png) | ![compatible\\_safari.png](/img/posts/2022-6-15/safari.png) | ![compatible\\_opera.png](/img/posts/2022-6-15/opera.png) |\n| 2012å¹´9æœˆ                                                                                                                                                                                 | 2012å¹´9æœˆ                                                                                                                                                                             | 2013å¹´4æœˆ                                                                                                                                                                                  | 2012å¹´7æœˆ                                                                                                                                                                                 | 2013å¹´7æœˆ                                                                                                                                                                                |\n\n## 11. ECMAScript 6 ï¼ˆ2015å¹´ï¼‰\n\n2015å¹´å‘å¸ƒES6ï¼Œåˆæ˜¯ä¸€æ¬¡é‡å¤§æ›´æ–°ï¼š\n\n| æ–°çš„ç‰¹æ€§å’Œæ‰©å±•  | æè¿°                                                                                                                                                        |\n| -------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| å˜é‡å£°æ˜     | **let**ï¼š js1.7ä¸­å·²ç»æœ‰è¿‡å®ç°ï¼Œè¿™é‡Œé‡æï¼Œè¯´æ˜å—çº§ä½œç”¨åŸŸçš„é‡è¦æ€§ï¼›**const**ï¼šå¸¸é‡ï¼›**å˜é‡è§£æ„èµ‹å€¼**ï¼š`let \\[a, b, c] = \\[1, 2, 3]; let { foo, bar } = { foo: 'aaa', bar: 'bbb' }; `               |\n| å¹‚ (\\*\\*) | æŒ‡æ•°è¿ç®—ç¬¦, Math.pow() ?                                                                                                                                       |\n| é»˜è®¤å‚æ•°å€¼    | å‡½æ•°å£°æ˜æ—¶å¯ä»¥åˆ¶å®šé»˜è®¤å‚æ•°                                                                                                                                             |\n| å­—ç¬¦ä¸²æ‰©å±•    | è§ä¸‹é¢åˆ—è¡¨                                                                                                                                                     |\n| æ­£åˆ™æ‰©å±•     | è§ä¸‹é¢åˆ—è¡¨                                                                                                                                                     |\n| æ•°ç»„æ‰©å±•     | è§ä¸‹é¢åˆ—è¡¨                                                                                                                                                     |\n| å¯¹è±¡æ‰©å±•     | è§ä¸‹é¢åˆ—è¡¨                                                                                                                                                     |\n| æ–°çš„æ•°å­—å±æ€§   | ES6 å°†ä»¥ä¸‹å±æ€§æ·»åŠ åˆ° Number å¯¹è±¡ï¼š EPSILONã€MIN\\_SAFE\\_INTEGERã€MAX\\_SAFE\\_INTEGER                                                                                     |\n| æ–°çš„æ•°å­—æ–¹æ³•   | Number.isInteger() ã€Number.isSafeInteger()ï¼Œ Mathä¹Ÿæ–°å¢äº†17ä¸ª[é™æ€æ–¹æ³•](https://es6.ruanyifeng.com/#docs/number#Math-%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%89%A9%E5%B1%95) |\n| æ–°çš„å…¨å±€æ–¹æ³•   | isFinite()ã€isNaN()                                                                                                                                        |\n| å‡½æ•°æ‰©å±•     | 1ã€å¼•å…¥ç®­å¤´å‡½æ•°ï¼šæ²¡æœ‰è‡ªå·±çš„thisã€æ²¡æœ‰é€’å½’ï¼Œäº‹ä»¶ç»‘å®šï¼Œè§£ç»‘å®šã€æ²¡æœ‰æ„é€ å™¨ã€ä¸å¯å…·ååŒ–ã€ä¹¦å†™ç®€å• 2ã€å¼•å…¥restå‚æ•° 3ã€å¢åŠ Function.prototype.toString()                                                            |\n| Symbol   | æ–°çš„åŸå§‹æ•°æ®ç±»å‹, è¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„å€¼                                                                                                                                        |\n| æ–°å¢æ•°æ®ç»“æ„   | Setå’ŒMap                                                                                                                                                   |\n| Proxy    | å¯¹è±¡ä»£ç†ï¼Œè¯¦è§é˜®è€å¸ˆçš„[è§£é‡Š](https://es6.ruanyifeng.com/#docs/proxy)                                                                                                   |\n| Reflect  | ä¸ºäº†æ“ä½œå¯¹è±¡è€Œæä¾›çš„æ–° API                                                                                                                                           |\n| å‰ç«¯å¼‚æ­¥ç­–ç•¥   | Promiseï¼ˆé€šå¸¸ä¸ES2017çš„asyncä¸€èµ·ä½¿ç”¨ï¼‰                                                                                                                              |\n| è¿­ä»£å™¨      | å°†Iterator ã€ for...of å¾ªç¯ å’Œ Generatorå‡½æ•°å†™å…¥è§„èŒƒ                                                                                                                 |\n| Classå£°æ˜  | å¢åŠ ç»§æ‰¿ã€æ¥å£ç­‰æ¦‚å¿µ                                                                                                                                                |\n| ESModule | jsåŸç”Ÿæ”¯æŒæ¨¡å—åŒ–                                                                                                                                                 |\n| æ–°å¢ææ¡ˆ     | è£…é¥°å™¨Decoratorã€do è¡¨è¾¾å¼ã€throw è¡¨è¾¾å¼ã€å‡½æ•°çš„éƒ¨åˆ†æ‰§è¡Œã€ç®¡é“è¿ç®—ç¬¦ã€Math.signbit()ã€åŒå†’å·è¿ç®—ç¬¦ã€Realm APIã€#!å‘½ä»¤ã€import.metaã€JSON æ¨¡å—                                                      |\n| æ–°å¢è§„æ ¼æ–‡ä»¶   | -                                                                                                                                                         |\n\n*   **å­—ç¬¦ä¸²æ‰©å±•**\n\n1.  å­—ç¬¦ä¸²Unicodeæ ‡è¯†æ³•ï¼Œå¹¶å…è®¸ç›´æ¥è¾“å…¥å­—ç¬¦\n2.  å¼•å…¥å­—ç¬¦ä¸²éå†å™¨\n3.  JSON.stringifyæ”¹é€ \n4.  å¼•å…¥æ¨¡æ¿å­—ç¬¦ä¸²ã€æ ‡ç­¾æ¨¡æ¿æ¸²æŸ“\n5.  æ–°å¢ä¸€äº›æ–¹æ³•ï¼Œè§ä¸‹è¡¨\n\n| å­—ç¬¦ä¸²æ–¹æ³•                  | æè¿°                                         |\n| ---------------------- | ------------------------------------------ |\n| String.fromCodePoint() | å¯ä»¥è¯†åˆ«å¤§äº`0xFFFF`çš„å­—ç¬¦                          |\n| String.raw()           | è¿”å›ä¸€ä¸ªæ–œæ éƒ½è¢«è½¬ä¹‰ï¼ˆå³æ–œæ å‰é¢å†åŠ ä¸€ä¸ªæ–œæ ï¼‰çš„å­—ç¬¦ä¸²ï¼Œå¾€å¾€ç”¨äºæ¨¡æ¿å­—ç¬¦ä¸²çš„å¤„ç†æ–¹æ³• |\n| codePointAt            | èƒ½å¤Ÿæ­£ç¡®å¤„ç† 4 ä¸ªå­—èŠ‚å‚¨å­˜çš„å­—ç¬¦ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦çš„ç ç‚¹ã€‚               |\n| normalize              | å°†å­—ç¬¦çš„ä¸åŒè¡¨ç¤ºæ–¹æ³•ç»Ÿä¸€ä¸ºåŒæ ·çš„å½¢å¼ï¼Œè¿™ç§°ä¸º Unicode æ­£è§„åŒ–ã€‚        |\n| startsWith             | è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨åŸå­—ç¬¦ä¸²çš„å¤´éƒ¨ã€‚                   |\n| endsWith               | è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨åŸå­—ç¬¦ä¸²çš„å°¾éƒ¨ã€‚                   |\n| repeat                 | è¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå°†åŸå­—ç¬¦ä¸²é‡å¤`n`æ¬¡ã€‚                    |\n| at                     | æ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°ï¼Œè¿”å›å‚æ•°æŒ‡å®šä½ç½®çš„å­—ç¬¦ï¼Œæ”¯æŒè´Ÿç´¢å¼•ï¼ˆå³å€’æ•°çš„ä½ç½®ï¼‰ã€‚      |\n\n*   **æ­£åˆ™æ‰©å±•**\n\n1.  RegExpæ„é€ å‡½æ•°å¢åŠ ç¬¬äºŒä¸ªå‚æ•°\n2.  ES6 å‡ºç°ä¹‹å‰ï¼Œå­—ç¬¦ä¸²å¯¹è±¡å…±æœ‰ 4 ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼š`match()`ã€`replace()`ã€`search()`å’Œ`split()`ã€‚ES6ä¸­RegExpé›†æˆäº†è¿™å››ä¸ªæ–¹æ³•ã€‚\n3.  `u`ä¿®é¥°ç¬¦\n4.  æ–°å¢RegExp.prototype.unicode å±æ€§\n5.  æ–°å¢RegExp.prototype.sticky å±æ€§\n6.  æ–°å¢RegExp.prototype.flags å±æ€§\n\n*   **æ•°ç»„æ‰©å±•**\n\n1.  å¼•å…¥æ‰©å±•è¿ç®—ç¬¦\n2.  Array.from()\n3.  Array.of()\n4.  å®ä¾‹æ–¹æ³•ï¼šcopyWithin()\n5.  å®ä¾‹æ–¹æ³•ï¼šfind() å’Œ findIndex()\n6.  å®ä¾‹æ–¹æ³•ï¼šfill()\n7.  å®ä¾‹æ–¹æ³•ï¼šentries()ï¼Œkeys() å’Œ values()\n8.  æ•°ç»„çš„ç©ºä½å®šä¹‰\n9.  Array.prototype.sort() çš„æ’åºç¨³å®šæ€§é—®é¢˜ï¼šå¸¸è§çš„æ’åºç®—æ³•ä¹‹ä¸­ï¼Œæ’å…¥æ’åºã€åˆå¹¶æ’åºã€å†’æ³¡æ’åºç­‰éƒ½æ˜¯ç¨³å®šçš„ï¼Œå †æ’åºã€å¿«é€Ÿæ’åºç­‰æ˜¯ä¸ç¨³å®šçš„ã€‚ä¸ç¨³å®šæ’åºçš„ä¸»è¦ç¼ºç‚¹æ˜¯ï¼Œå¤šé‡æ’åºæ—¶å¯èƒ½ä¼šäº§ç”Ÿé—®é¢˜ã€‚åœ¨ES2019æ‰è§£å†³ã€‚\n\n*   **å¯¹è±¡æ‰©å±•**\n\n1.  keyå’Œå˜é‡æ˜¯åŒä¸€ä¸ªå•è¯æ—¶ï¼Œå¯ç®€å†™\n2.  å±æ€§åè¡¨è¾¾å¼å†™æ³•ï¼š`obj['a' + 'bc'] = 123;`\n3.  æ–¹æ³•æœ‰nameå±æ€§\n4.  Object.assign()\n5.  å¯¹è±¡å±æ€§éå†æ–¹å¼ï¼šfor...inã€Object.keys(obj)ã€Object.getOwnPropertyNames(obj)ã€Object.getOwnPropertySymbols(obj)ã€Reflect.ownKeys(obj)\n6.  superå…³é”®å­—\n7.  å¯¹è±¡æ‰©å±•`...`\n8.  Object.is()ï¼šES5 æ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œåªæœ‰ä¸¤ä¸ªè¿ç®—ç¬¦ï¼šç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ`==`ï¼‰å’Œä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ`===`ï¼‰ã€‚å®ƒä»¬éƒ½æœ‰ç¼ºç‚¹ï¼Œå‰è€…ä¼šè‡ªåŠ¨è½¬æ¢æ•°æ®ç±»å‹ï¼Œåè€…çš„`NaN`ä¸ç­‰äºè‡ªèº«ï¼Œä»¥åŠ`+0`ç­‰äº`-0`ã€‚JavaScript ç¼ºä¹ä¸€ç§è¿ç®—ï¼Œåœ¨æ‰€æœ‰ç¯å¢ƒä¸­ï¼Œåªè¦ä¸¤ä¸ªå€¼æ˜¯ä¸€æ ·çš„ï¼Œå®ƒä»¬å°±åº”è¯¥ç›¸ç­‰ã€‚\n\n*   **ES6 æµè§ˆå™¨æ”¯æŒ**\n\nSafari 10 å’Œ Edge 14 æ˜¯é¦–å…ˆå®Œå…¨æ”¯æŒ ES6 çš„æµè§ˆå™¨ï¼š\n\n| Chrome 58                                                                                                                                                                               | Edge 14                                                                                                                                                                             | Firefox 54                                                                                                                                                                               | Safari 10                                                                                                                                                                               | Opera 55                                                                                                                                                                               |\n| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| ![compatible\\_chrome.png](/img/posts/2022-6-15/chrome.png) | ![compatible\\_ie.png](/img/posts/2022-6-15/ie.png) | ![compatible\\_firefox.png](/img/posts/2022-6-15/firefox.png) | ![compatible\\_safari.png](/img/posts/2022-6-15/safari.png) | ![compatible\\_opera.png](/img/posts/2022-6-15/opera.png) |\n| Jan 2017                                                                                                                                                                                | Aug 2016                                                                                                                                                                            | Mar 2017                                                                                                                                                                                 | Jul 2016                                                                                                                                                                                | Aug 2018                                                                                                                                                                               |\n\n\u003e ES6ä¹‹åæ²¡æœ‰å°æ•°å­—ç‰ˆæœ¬çš„ECMAScriptäº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä»¥å¹´ä»½ä¸ºä»£å·çš„ç‰ˆæœ¬ï¼Œå› ä¸ºæ¯ä¸€å¹´éƒ½ä¼šæœ‰ä¸€ä¸ªç‰ˆæœ¬ã€‚ç½‘ä¼ çš„ES7ã€ES8ä»€ä¹ˆçš„ï¼Œå…¶å®å®˜æ–¹æ²¡æœ‰è¿™ç§å«æ³•ã€‚\n\n## 12. ECMAScript 2016\n\n2016å¹´å‘å¸ƒã€‚\n\n| æ–°ç‰¹æ€§                      | æè¿°                                                |\n| ------------------------ | ------------------------------------------------- |\n| æ±‚å¹‚èµ‹å€¼                     | let x = 5; x \\*\\*= 2; // ç»“æœæ˜¯ 25                   |\n| Array.prototype.includes | -                                                 |\n| è£…é¥°å™¨                      | [åŠ¨æ€](https://github.com/tc39/proposal-decorators) |\n\n*   **ES2016 æµè§ˆå™¨æ”¯æŒ**\n\næ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ Array.prototype.includesï¼š\n\n| Chrome 47                                                                                                                                                                               | Edge 14                                                                                                                                                                             | Firefox 43                                                                                                                                                                               | Safari 9                                                                                                                                                                                | Opera 34                                                                                                                                                                               |\n| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| ![compatible\\_chrome.png](/img/posts/2022-6-15/chrome.png) | ![compatible\\_ie.png](/img/posts/2022-6-15/ie.png) | ![compatible\\_firefox.png](/img/posts/2022-6-15/firefox.png) | ![compatible\\_safari.png](/img/posts/2022-6-15/safari.png) | ![compatible\\_opera.png](/img/posts/2022-6-15/opera.png) |\n| 2015 å¹´ 12 æœˆ                                                                                                                                                                             | 2016 å¹´ 8 æœˆ                                                                                                                                                                          | 2015 å¹´ 12 æœˆ                                                                                                                                                                              | 2015 å¹´ 10 æœˆ                                                                                                                                                                             | 2015 å¹´ 12 æœˆ                                                                                                                                                                            |\n\n\u003chr /\u003e\n\næœ€è¿‘çš„ç‰ˆæœ¬å¿«é€Ÿæµè§ˆï¼š\n\n## 13. ECMAScript 2017\n\n2017å¹´å‘å¸ƒã€‚\n\n| æ–°ç‰¹æ€§     | æè¿°                                                              |\n| ------- | --------------------------------------------------------------- |\n| å¼‚æ­¥å£°æ˜    | async/await                                                     |\n| å¯¹è±¡æ”¯æŒå°¾é€—å· | `{ a: 1, b: 2, } `                                                |\n| å­—ç¬¦ä¸²æ‰©å±•   | String.padStart å’Œ String.padEndï¼Œå¢åŠ å­—ç¬¦ä¸²å‰åç¼©è¿›                       |\n| å¯¹è±¡æ‰©å±•    | Object.valuesã€Object.entriesã€Object.getOwnPropertyDescriptors() |\n\n## 14. ECMAScript 2018\n\n2018å¹´å‘å¸ƒã€‚\n\n| æ–°ç‰¹æ€§                   | æè¿°                                                      |\n| --------------------- | ------------------------------------------------------- |\n| å¼‚æ­¥è¿­ä»£                  | ES2018å¼•â¼Šå¼‚æ­¥è¿­ä»£å™¨ï¼Œå…è®¸ for...of å¾ªç¯å¯ä»¥å’Œ await â¼€èµ·ä½¿â½¤ï¼Œä»¥ä¸²â¾çš„â½…å¼è¿â¾å¼‚æ­¥æ“ä½œ |\n| Promiseæ‰©å±•             | Promise.finally()                                       |\n| Restå‚æ•°çš„Spreadå±æ€§       | å±•å¼€è¿ç®—ç¬¦ï¼šMath.max(...values) // values = \\[1,2,3,4]        |\n| æ­£åˆ™è¡¨è¾¾å¼å‘½åæ•è·ç»„            | ES2018å…è®¸å‘½åæ•è·ç»„ä½¿â½¤ç¬¦å·`?\u003cname\u003e`ï¼Œåœ¨æ‰“å¼€æ•è·æ‹¬å·(åâ½´å³å‘½å                |\n| æ­£åˆ™è¡¨è¾¾å¼åå‘æ–­è¨€             | `?\u003c= ã€?\\\u003c!  `                                             |\n| æ­£åˆ™è¡¨è¾¾å¼ s ä¿®é¥°ç¬¦ï¼šdotAll æ¨¡å¼ | [æ­£åˆ™æ‰©å±•](http://caibaojian.com/es6/regex.html)            |\n| æ­£åˆ™è¡¨è¾¾å¼Unicodeè½¬ä¹‰        | [æ­£åˆ™æ‰©å±•](http://caibaojian.com/es6/regex.html)            |\n\n*   å¼‚æ­¥è¿­ä»£ç¤ºä¾‹ï¼š\n\n```js\n// ä¸èµ·ä½œç”¨\nasync function process(array) {\n  for (let i of array) {\n    await doSomething(i);\n  }\n}\n\n// èµ·ä½œç”¨äº†\nasync function process(array) {\n  for await (let i of array) {\n    doSomething(i);\n  }\n}\n```\n\n## 15. ECMAScript 2019\n\n2019å¹´å‘å¸ƒã€‚\n\n| æ–°ç‰¹æ€§                             | æè¿°                                                                                   |\n| ------------------------------- | ------------------------------------------------------------------------------------ |\n| å­—ç¬¦ä¸²æ‰©å±•                           | `String.prototype.trimStart() , String.prototype.trimEnd()`ï¼ŒåŸæ¥çš„trimLeftå’ŒtrimRightè¢«åºŸå¼ƒ |\n| Object.fromEntries()            | Object.entriesçš„é€†è¿ç®—                                                                   |\n| æ•°ç»„æ‹å¹³                            | `Array.prototype.flat() ï¼Œ Array.prototype.flatMap()`                                 |\n| catch çš„å‚æ•°æ”¹ä¸ºå¯é€‰                   | å¯ä»¥çœç•¥catchç»‘å®šçš„å‚æ•°å’Œæ‹¬å·                                                                    |\n| Symbol.description              | -                                                                                    |\n| JSON Superset è¶…é›†                | å³jså…¼å®¹æ‰€æœ‰JSONæ”¯æŒçš„æ–‡æœ¬ã€‚åŸå§‹çš„JSON å†…å®¹å¯ä»¥æ­£å¸¸åŒ…å« U+2028è¡Œåˆ†éš”ç¬¦ ä¸ U+2029æ®µåˆ†éš”ç¬¦ï¼Œè€Œä¹‹å‰ç‰ˆæœ¬çš„ECMAScript å´ä¸è¡Œ       |\n| JSON.stringify() è½¬åŒ–ç‰¹æ®Šå­—ç¬¦         | ä¿®å¤äº†å¯¹äºä¸€äº›è¶…å‡ºèŒƒå›´çš„Â `Unicode`å±•ç¤ºé”™è¯¯çš„é—®é¢˜                                                        |\n| Array.sort                      | å˜ä¸ºç¨³å®šç®—æ³•                                                                               |\n| Function.prototype.toString()å¢å¼º | å¯ä»¥è¿”å›æ³¨é‡Šå’Œç©ºæ ¼                                                                            |\n| String.prototype.matchAll       | è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼åŠåˆ†ç»„æ•è·ç»“æœçš„è¿­ä»£å™¨                                                           |\n\n## 16. ECMAScript 2020\n\n2020å¹´å‘å¸ƒã€‚\n\n| æ–°ç‰¹æ€§                | æè¿°                                                                                                                           |\n| ------------------ | ---------------------------------------------------------------------------------------------------------------------------- |\n| Promise.allSettled | å½“æ‰€æœ‰promiseéƒ½resolveæˆ–rejectåï¼Œè¿”å›resolveæˆ–rejectçš„ç»“æœé›†åˆæ•°ç»„                                                                           |\n| é“¾åˆ¤æ–­è¿ç®—ç¬¦             | `const firstName = message?.body?.user?.firstName \\|\\| 'default';`                                                           |\n| ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦            | `var level = user.level ?? 'æš‚â½†ç­‰çº§';`                                                                                          |\n| åŠ¨æ€å¼•å…¥               | import(`/test.js`).then((module) =\\\u003e {}                                                                                      |\n| globalThiså¯¹è±¡       | `globalThis`Â æä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„æ–¹å¼æ¥è·å–ä¸åŒç¯å¢ƒä¸‹çš„å…¨å±€Â `this`Â å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯å…¨å±€å¯¹è±¡è‡ªèº«ï¼‰ã€‚ä¸åƒÂ `window`Â æˆ–è€…Â `self`Â è¿™äº›å±æ€§ï¼Œ`globalThis` ç¡®ä¿å¯ä»¥åœ¨æœ‰ã€æ— çª—å£çš„å„ç§ç¯å¢ƒä¸‹æ­£å¸¸å·¥ä½œ         |\n| å¼•å…¥bigint           | Numberæœ‰å–å€¼èŒƒå›´ \\[Number.MIN\\_SAFE\\_INTEGER, Number.MAX\\_SAFE\\_INTEGER], è¶…è¿‡è¿™ä¸ªèŒƒå›´ä¼šç²¾åº¦ä¸¢å¤±ï¼Œè¿™å°±éœ€è¦å¤§æ•°ç±»å‹ï¼švar bigIntNum = 9007199254740993n; |\n\n## 17. ECMAScript 2021\n\n2021å¹´å‘å¸ƒã€‚\n\n| æ–°ç‰¹æ€§         | æè¿°                                                                                                                                 |\n| ----------- | ---------------------------------------------------------------------------------------------------------------------------------- |\n| Promise.any | æ¥æ”¶ä¸€ä¸ªPromiseæ•°ç»„ï¼Œåªè¦å…¶ä¸­ä»»æ„ä¸€ä¸ªresolveï¼Œä¾¿é€šè¿‡ï¼Œå¦åˆ™æ‹’ç»                                                                                             |\n| replaceAll  | è¿”å›â¼€ä¸ªå…¨æ–°çš„å­—ç¬¦ä¸²ï¼Œæ‰€æœ‰ç¬¦åˆåŒ¹é…è§„åˆ™çš„å­—ç¬¦éƒ½å°†è¢«æ›¿æ¢æ‰                                                                                                       |\n| WeakRefs    | åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹è±¡çš„å¼•ç”¨æ˜¯å¼ºå¼•ç”¨çš„ï¼Œè¿™æ„å‘³ç€åªè¦æŒæœ‰å¯¹è±¡çš„å¼•ç”¨ï¼Œå®ƒå°±ä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚åªæœ‰å½“è¯¥å¯¹è±¡æ²¡æœ‰ä»»ä½•çš„å¼ºå¼•ç”¨æ—¶ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶æ‰ä¼šé”€æ¯è¯¥å¯¹è±¡å¹¶ä¸”å›æ”¶è¯¥å¯¹è±¡æ‰€å çš„å†…å­˜ç©ºé—´ã€‚è€Œ `WeakRef` å…è®¸ä¿ç•™å¯¹ä¸€ä¸ªå¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œè€Œä¸ä¼šé˜»æ­¢è¢«å¼±å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ã€‚ |\n| æ•°å­—å£°æ˜æ—¶å¯å¢åŠ åˆ†éš”ç¬¦ | `const num = 1_000_000_000  //1000000000`                                                                                          |\n| æ–°çš„é€»è¾‘è¿ç®—ç¬¦å’Œè¡¨è¾¾å¼ | è§ä¸‹é¢ä»£ç                                                                                                                               |\n\n```js\na ||= b\n//ç­‰ä»·äº\na = a || (a = b)\na \u0026\u0026= b\n//ç­‰ä»·äº\na = a \u0026\u0026 (a = b)\na ??= b\n//ç­‰ä»·äº\na = a ?? (a = b)\n```\n\n## 18. ECMAScript 2022\n\n2022å¹´å‘å¸ƒã€‚\n\n| æ–°ç‰¹æ€§                         | æè¿°                                                                                       |\n| --------------------------- | ---------------------------------------------------------------------------------------- |\n| classæ–°ç‰¹æ€§                    | 1ã€å¢åŠ privateå±æ€§ï¼Œ `class A { #a = 1 }`; 2ã€å¢åŠ classçš„staticæˆå‘˜æ–¹æ³•                                  |\n| top-level await             | å¯ä»¥ä½¿ç”¨type='module'çš„scriptæ ‡ç­¾å¼•å…¥ä¸€ä¸ªjsæ–‡ä»¶ï¼Œjsé‡Œä½¿ç”¨awaitè·å–å¼‚æ­¥æ•°æ®                                      |\n| æ•°ç»„å®ä¾‹æ–¹æ³•at(index)             | `a = [1,2,3]; const value = a.at(1)`                                                     |\n| errorå¤„ç†æ–°æ–¹å¼                  | `throw new Error('fail', { cause: 123 });` åœ¨catché‡Œè·å–ï¼š`catch(e) { console.log(e.cause) }` |\n| Object.hasOwn(obj, propKey) | åŒhasOwnPropertyï¼Œä½†æ”¯æŒæ‰€æœ‰å¯¹è±¡ç±»å‹çš„åˆ¤æ–­                                                             |\n\n## 19. ECMAScript 2023\n\n*   ä»å¤´åˆ°å°¾æœç´¢æ•°ç»„ï¼š`findLast()`Â ã€`findLastIndex()`\n*   Hashbang è¯­æ³•\n*   é€šè¿‡å‰¯æœ¬æ›´æ”¹æ•°ç»„ï¼š`toReversed()`ã€`toSorted()`ã€`toSpliced()`ã€`with()`\n*   Symbol ä½œä¸º WeakMap çš„é”®\n\n## 20. åè®°\n\néšç€ECMAScriptç‰ˆæœ¬çš„æ›´æ–°ï¼Œæ–‡ç« ä¼šæŒç»­ä¿æŒæ›´æ–°\\~\\~\n\n\u003chr /\u003e\n\nå‚è€ƒèµ„æ–™\n\n*   [ECMA-international å®˜ç½‘](https://www.ecma-international.org/)\n*   [Baiduç™¾ç§‘ - JavaScript](https://baike.baidu.com/item/JavaScript/321142?fr=aladdin)\n*   [Javascript.com](https://www.javascript.com/)\n*   [W3Cå­¦é™¢](https://www.w3school.com.cn/js/js_versions.asp)"])</script><script>self.__next_f.push([1,"44:T2710,"])</script><script>self.__next_f.push([1,"\u003e ä¸“æ è¯´æ˜ï¼šå¯¹äºreact-router v6ç‰ˆæœ¬ï¼Œæœ‰åŒäº‹ååº”ç¼ºå°‘ç›¸å¯¹å®Œæ•´çš„ä¸­æ–‡æ–‡æ¡£ï¼ŒæŸ¥çœ‹ä¸æ–¹ä¾¿ã€‚ä¸ºäº†ä¾¿äºä½¿ç”¨ï¼Œä½œè€…å¯¹[å®˜ç½‘æ–‡æ¡£](https://reactrouter.com/docs/en/v6)è¿›è¡Œé’ˆå¯¹æ€§ç¿»è¯‘ï¼Œä¾¿äºv6ç‰ˆæœ¬æ›´å¹¿æ³›çš„è¢«ä½¿ç”¨ã€‚\n\n## 1. \\\u003cLink\u003e\n\nç±»å‹å®šä¹‰ï¼š\n\n```ts\ndeclare function Link(props: LinkProps): React.ReactElement;\n\ninterface LinkProps\n  extends Omit\u003c\n    React.AnchorHTMLAttributes\u003cHTMLAnchorElement\u003e,\n    \"href\"\n  \u003e {\n  replace?: boolean;\n  state?: any;\n  to: To;\n  reloadDocument?: boolean;\n}\n\ntype To = Partial\u003cLocation\u003e | string;\n```\nå†…ç½®å…ƒç´ Â `\u003cLink\u003e`Â æ˜¯ç”¨äºé€šè¿‡ç‚¹å‡»è·³è½¬é¡µé¢çš„ã€‚ åœ¨Â `react-router-dom`ä¸­ï¼Œ`\u003cLink\u003e`Â ä¼šæ¸²æŸ“ä¸€ä¸ª`\u003ca\u003e`Â æ ‡ç­¾ï¼Œ æ ‡ç­¾çš„ `href`Â ä¸ºLinkçš„ `to` å±æ€§. ä¹Ÿå°±æ˜¯è¯´ï¼Œå³é”®ç‚¹å‡»ä¸€ä¸ª `\u003cLink\u003e`ä¹Ÿæ˜¯èµ·ä½œç”¨çš„. ä½ ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼š`\u003cLink reloadDocument\u003e`Â ï¼Œ ä»¥æ­¤æ¥é˜»æ­¢æµè§ˆå™¨é»˜è®¤äº‹ä»¶ã€‚\n\nä½¿ç”¨æ¡ˆä¾‹ï¼š\n\n```ts\nimport * as React from \"react\";\nimport { Link } from \"react-router-dom\";\n\nfunction UsersIndexPage({ users }) {\n  return (\n    \u003cdiv\u003e\n      \u003ch1\u003eUsers\u003c/h1\u003e\n      \u003cul\u003e\n        {users.map((user) =\u003e (\n          \u003cli key={user.id}\u003e\n            \u003cLink to={user.id}\u003e{user.name}\u003c/Link\u003e\n          \u003c/li\u003e\n        ))}\n      \u003c/ul\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n`\u003cLink to\u003e`Â çš„ `to` å‚æ•°ï¼Œå¦‚æœä¸æ˜¯ä»¥ `/` å¼€å¤´çš„è¯ï¼Œè¡¨ç¤ºæ˜¯ä¸€ä¸ªç›¸å¯¹è·¯ç”±ã€‚è·¯å¾„ä¸­å¯èƒ½ä¼šåŒ…å« `..`æ¥æ£€ç´¢ä¸Šä¸€çº§ï¼Œç±»ä¼¼ç›®å½•æŒ‡ä»¤çš„ `cd`ã€‚\n\n\nåœ¨ React Native ä¸­ä½¿ç”¨ï¼š\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function Link(props: LinkProps): React.ReactElement;\n\ninterface LinkProps extends TouchableHighlightProps {\n  children?: React.ReactNode;\n  onPress?(event: GestureResponderEvent): void;\n  replace?: boolean;\n  state?: any;\n  to: To;\n}\n```\n\n`\u003cLink\u003e` ç”¨äºå“åº”ç”¨æˆ·ç‚¹å‡»åè·³è½¬å…¶ä»–çš„ `View`, æ¸²æŸ“ä¸ºä¸€ä¸ªÂ `\u003ca\u003e`Â æ ‡ç­¾ã€‚ åœ¨Â `react-router-native`, ä¸­ï¼ŒÂ `\u003cLink\u003e`Â æ¸²æŸ“ä¸€ä¸ªÂ `TouchableHighlight`ã€‚å¯ä»¥ä½¿ç”¨[`TouchableHighlight`é…ç½®é¡¹](https://reactnative.dev/docs/touchablehighlight#props)æ¥è‡ªå®šä¹‰æ ·å¼å’Œè¡Œä¸ºã€‚\n\n```ts\nimport * as React from \"react\";\nimport { View, Text } from \"react-native\";\nimport { Link } from \"react-router-native\";\n\nfunction Home() {\n  return (\n    \u003cView\u003e\n      \u003cText\u003eWelcome!\u003c/Text\u003e\n      \u003cLink to=\"/profile\"\u003eVisit your profile\u003c/Link\u003e\n    \u003c/View\u003e\n  );\n}\n```\n\n## 2. \\\u003cNavLink\u003e\n\nç±»å‹å®šä¹‰ï¼š\n```ts\ndeclare function NavLink(\n  props: NavLinkProps\n): React.ReactElement;\n\ninterface NavLinkProps\n  extends Omit\u003c\n    LinkProps,\n    \"className\" | \"style\" | \"children\"\n  \u003e {\n  caseSensitive?: boolean;\n  children?:\n    | React.ReactNode\n    | ((props: { isActive: boolean }) =\u003e React.ReactNode);\n  className?:\n    | string\n    | ((props: {\n        isActive: boolean;\n      }) =\u003e string | undefined);\n  end?: boolean;\n  style?:\n    | React.CSSProperties\n    | ((props: {\n        isActive: boolean;\n      }) =\u003e React.CSSProperties);\n}\n```\n\n`\u003cNavLink\u003e`Â æ˜¯ç‰¹æ®Šç±»å‹çš„[`\u003cLink\u003e`](https://reactrouter.com/docs/en/v6/components/link)ï¼ŒÂ å¯ä»¥è®°å½• \"active\" çŠ¶æ€ã€‚ å¯ç”¨äºé¢åŒ…å±‘æˆ–è€…èœå•çš„é€‰ä¸­ç‚¹äº®ã€‚å¯¹äºç”¨æˆ·å’Œè¯»è€…æ¥è¯´ä¹Ÿæä¾›äº†ä¸Šä¸‹æ–‡çš„å¯¼èˆªè¯´æ˜ã€‚\n\né»˜è®¤çš„, `\u003cNavLink\u003e`æ¿€æ´»æ—¶ï¼Œä¼šåŠ ä¸Šç±»å`active`ï¼Œv5ä¸­ä¹Ÿæ˜¯è¿™ä¹ˆåšçš„. ä¸åŒçš„æ˜¯ï¼Œæ–°ç‰ˆæœ¬`v6.0.0-beta.3`Â ä¸­å±æ€§ç§»é™¤äº† `activeClassName`Â å’ŒÂ `activeStyle`ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯Â `style`Â æˆ–è€…Â `className`Â å±æ€§ï¼Œç”¨äºè‡ªå®šä¹‰è¡Œå†…æ ·å¼æˆ–è€…è‡ªå®šä¹‰ç±»åï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç©¿ä¸€ä¸ªå‡½æ•°ä½œä¸ºå±æ€§ç»™Â `\u003cNavLink\u003e`Â ç»„ä»¶æ¥è‡ªå®šä¹‰è¡Œä¸ºã€‚\n\nä¾‹å­ï¼š\n\n```ts\nimport * as React from \"react\";\nimport { NavLink } from \"react-router-dom\";\n\nfunction NavList() {\n  // This styling will be applied to a \u003cNavLink\u003e when the\n  // route that it links to is currently selected.\n  let activeStyle = {\n    textDecoration: \"underline\",\n  };\n\n  let activeClassName = \"underline\";\n\n  return (\n    \u003cnav\u003e\n      \u003cul\u003e\n        \u003cli\u003e\n          \u003cNavLink\n            to=\"messages\"\n            style={({ isActive }) =\u003e\n              isActive ? activeStyle : undefined\n            }\n          \u003e\n            Messages\n          \u003c/NavLink\u003e\n        \u003c/li\u003e\n        \u003cli\u003e\n          \u003cNavLink\n            to=\"tasks\"\n            className={({ isActive }) =\u003e\n              isActive ? activeClassName : undefined\n            }\n          \u003e\n            Tasks\n          \u003c/NavLink\u003e\n        \u003c/li\u003e\n        \u003cli\u003e\n          \u003cNavLink to=\"tasks\"\u003e\n            {({ isActive }) =\u003e (\n              \u003cspan\n                className={\n                  isActive ? activeClassName : undefined\n                }\n              \u003e\n                Tasks\n              \u003c/span\u003e\n            )}\n          \u003c/NavLink\u003e\n        \u003c/li\u003e\n      \u003c/ul\u003e\n    \u003c/nav\u003e\n  );\n}\n```\n\nå¦‚æœä½ å¾ˆç†Ÿæ‚‰ v5 çš„ APIï¼Œå¯ä»¥äºŒæ¬¡å°è£…ä¸€ä¸‹ä½¿ç”¨ï¼š\n```ts\nimport * as React from \"react\";\nimport { NavLink as BaseNavLink } from \"react-router-dom\";\n\nconst NavLink = React.forwardRef(\n  ({ activeClassName, activeStyle, ...props }, ref) =\u003e {\n    return (\n      \u003cBaseNavLink\n        ref={ref}\n        {...props}\n        className={({ isActive }) =\u003e\n          [\n            props.className,\n            isActive ? activeClassName : null,\n          ]\n            .filter(Boolean)\n            .join(\" \")\n        }\n        style={({ isActive }) =\u003e ({\n          ...props.style,\n          ...(isActive ? activeStyle : null),\n        })}\n      /\u003e\n    );\n  }\n);\n```\n\n`end` å±æ€§ç”¨äºæ§åˆ¶ä¸ä¼šçº§è”ç‚¹äº®ã€‚å¦‚æœæƒ³è¦åªåœ¨å®Œå…¨åŒ¹é…è·¯ç”±æ˜¯activeï¼Œè€Œä¸æ˜¯åœ¨è¯¥è·¯ç”±ä¸Šå‡ çº§è·¯å¾„éƒ½è¢«activeï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå±æ€§ã€‚ä¸‹é¢çš„ä¾‹å­ï¼Œåªä¼šåœ¨è·¯å¾„ä¸º `/` æ—¶åŒ¹é… activeï¼Œå…¶ä»–ä»»ä½•è·¯å¾„éƒ½ä¸ä¼šç‚¹äº®ï¼š\n\n```jsx\n\u003cNavLink to=\"/\" end\u003e\n  Home\n\u003c/NavLink\u003e\n```\n\n## 3. \\\u003cNavigate\u003e\n\nç±»å‹å®šä¹‰ï¼š\n\n```ts\ndeclare function Navigate(props: NavigateProps): null;\n\ninterface NavigateProps {\n  to: To;\n  replace?: boolean;\n  state?: any;\n}\n```\n\n`\u003cNavigate\u003e`Â è¢«æ¸²æŸ“æ—¶ï¼Œä¼šç«‹å³æ”¹å˜å½“å‰çš„location. å’Œhooks [`useNavigate`](https://reactrouter.com/docs/en/v6/hooks/use-navigate) å¯ä»¥è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœï¼Œä¼ é€’çš„å‚æ•°ä¹Ÿä¸€æ ·ã€‚\n\u003e **æç¤º:**\n\u003e\n\u003e `\u003cNavigate\u003e`å¯ä»¥åœ¨ä¸èƒ½ä½¿ç”¨è·¯ç”± hooks çš„åœ°æ–¹ä»£æ›¿ useNavigate\n\nä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¼šå…ˆæ‹¿åˆ°ç™»å½•çŠ¶æ€çš„userï¼Œè‹¥æ²¡æœ‰userï¼Œæ¸²æŸ“ç™»å½•è¡¨å•ï¼›å¦‚æœæ‹¿åˆ°äº†ç™»å½•ä¿¡æ¯ï¼Œåˆ™é€šè¿‡`\u003cNavigate\u003e`ç›´æ¥è·³è½¬åˆ° dashboard é¡µé¢ï¼š\n\n```jsx\nimport * as React from \"react\";\nimport { Navigate } from \"react-router-dom\";\n\nclass LoginForm extends React.Component {\n  state = { user: null, error: null };\n\n  async handleSubmit(event) {\n    event.preventDefault();\n    try {\n      let user = await login(event.target);\n      this.setState({ user });\n    } catch (error) {\n      this.setState({ error });\n    }\n  }\n\n  render() {\n    let { user, error } = this.state;\n    return (\n      \u003cdiv\u003e\n        {error \u0026\u0026 \u003cp\u003e{error.message}\u003c/p\u003e}\n        {user \u0026\u0026 (\n          \u003cNavigate to=\"/dashboard\" replace={true} /\u003e\n        )}\n        \u003cform\n          onSubmit={(event) =\u003e this.handleSubmit(event)}\n        \u003e\n          \u003cinput type=\"text\" name=\"username\" /\u003e\n          \u003cinput type=\"password\" name=\"password\" /\u003e\n        \u003c/form\u003e\n      \u003c/div\u003e\n    );\n  }\n}\n```\n\n\n## 4. \\\u003cOutlet\u003e\n\nç±»å‹å®šä¹‰ï¼š\n\n```ts\ninterface OutletProps {\n  context?: unknown;\n}\ndeclare function Outlet(\n  props: OutletProps\n): React.ReactElement | null;\n```\n\n`\u003cOutlet\u003e`Â å¯ç”¨äºçˆ¶è·¯ç”±ä¸­ï¼Œç”¨æ¥æ¸²æŸ“å­è·¯ç”±ç»„ä»¶. è¿™éœ€è¦å¼€å‘è€…åˆç†å®‰æ’åµŒå¥— UI çš„å¸ƒå±€. å½“ç›´æ¥è®¿é—®çˆ¶è·¯ç”±æ—¶ï¼Œä¼šè‡ªåŠ¨æ¸²æŸ“çˆ¶è·¯ç”±ä¸­é…ç½®äº† index å±æ€§çš„å­è·¯ç”±æ¥æ›¿ä»£ `Outlet`, å¦‚æœæ²¡æœ‰ index è·¯ç”±ï¼Œè¯¥ä½ç½®ä¸æ¸²æŸ“ã€‚\n\nä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œè®¿é—® `/` ä¼šæ¸²æŸ“ Dashboard ç»„ä»¶ï¼Œ Outletç•™ç™½ï¼› è®¿é—® `/tasks` åˆ™ä¼šæ¸²æŸ“ Dashboardï¼ŒOutletä½ç½®ä¼šæ¸²æŸ“ DashboardTasksï¼š\n\n```jsx\nfunction Dashboard() {\n  return (\n    \u003cdiv\u003e\n      \u003ch1\u003eDashboard\u003c/h1\u003e\n\n      \u003cOutlet /\u003e\n    \u003c/div\u003e\n  );\n}\n\nfunction App() {\n  return (\n    \u003cRoutes\u003e\n      \u003cRoute path=\"/\" element={\u003cDashboard /\u003e}\u003e\n        \u003cRoute\n          path=\"messages\"\n          element={\u003cDashboardMessages /\u003e}\n        /\u003e\n        \u003cRoute path=\"tasks\" element={\u003cDashboardTasks /\u003e} /\u003e\n      \u003c/Route\u003e\n    \u003c/Routes\u003e\n  );\n}\n```\n\nå½“ç„¶äº†ï¼Œçˆ¶å­ç»„ä»¶ä»ç„¶å¯ä»¥ä¼ å‚ï¼Œä½¿ç”¨ context å’Œ useOutletContext ç»„åˆæ‹³å³å¯ï¼Œè¯¦æƒ…å¯å‚è€ƒæœ¬ä¸“æ çš„ hook ä¸“é¢˜ã€‚\n\n## 5. \\\u003cRoutes\u003e ä¸ \\\u003cRoute\u003e\n\nç±»å‹å£°æ˜ï¼š\n\n```ts\ndeclare function Routes(\n  props: RoutesProps\n): React.ReactElement | null;\n\ninterface RoutesProps {\n  children?: React.ReactNode;\n  location?: Partial\u003cLocation\u003e | string;\n}\n\ndeclare function Route(\n  props: RouteProps\n): React.ReactElement | null;\n\ninterface RouteProps {\n  caseSensitive?: boolean;\n  children?: React.ReactNode;\n  element?: React.ReactNode | null;\n  index?: boolean;\n  path?: string;\n}\n```\n\n`\u003cRoutes\u003e`Â å’ŒÂ `\u003cRoute\u003e`Â æ˜¯ React Router ä¸­ä¸»è¦çš„é…ç½®ç±»å‹ã€‚å¯ä»¥æŠŠÂ `\u003cRoute\u003e`çœ‹åšæ˜¯ä¸€ä¸ª `if`Â åˆ¤æ–­ï¼šå¦‚æœÂ `path`Â åŒ¹é…äº†å½“å‰ URL, åˆ™ä¼šæ¸²æŸ“ä»–çš„Â `element`ï¼ä½¿ç”¨Â `\u003cRoute caseSensitive\u003e`å¯ä»¥å¯ç”¨è·¯ç”±å¤§å°å†™åŒ¹é…ã€‚\n\nå½“ location å˜åŒ–æ—¶,Â `\u003cRoutes\u003e`Â ä¼šéå†ä¸‹å±Â `children`Â çš„æ‰€æœ‰ `\u003cRoute\u003e`Â ä»¥è¯•å›¾å¯»æ‰¾æœ€ä½³åŒ¹é…çš„è·¯ç”±.Â `\u003cRoute\u003e`Â æ‰€åœ¨è·¯å¾„è·ŸåµŒå¥— UI çš„è·¯å¾„ä½ç½®æ˜¯ä¸€è‡´çš„ï¼Œæ‰€è§å³æ‰€å¾—çš„æ¸²æŸ“æ–¹å¼ã€‚\n\nä¾‹å­ï¼š\n\n```jsx\n\u003cRoutes\u003e\n  \u003cRoute path=\"/\" element={\u003cDashboard /\u003e}\u003e\n    \u003cRoute\n      path=\"messages\"\n      element={\u003cDashboardMessages /\u003e}\n    /\u003e\n    \u003cRoute path=\"tasks\" element={\u003cDashboardTasks /\u003e} /\u003e\n  \u003c/Route\u003e\n  \u003cRoute path=\"about\" element={\u003cAboutPage /\u003e} /\u003e\n\u003c/Routes\u003e\n```\n\n\u003e **Note:**\n\u003e\n\u003e Routes çš„ Javascriptæ›¿ä»£å“è§ [Â `useRoutes`Â ](https://reactrouter.com/docs/en/v6/hooks/use-routes).\n\n`\u003cRoute element\u003e`Â ä¼šé»˜è®¤å¾€ä¸‹æ¸²æŸ“ï¼Œå¹¶ä¸”æ‹¼æ¥è·¯å¾„ï¼Œæ‰€ä»¥ä¸æ˜¯æ¯ä¸€ä¸ª Route éƒ½éœ€è¦é…ç½®ä¸€ä¸ª element å±æ€§ã€‚\n\næ¯”å¦‚è¯´ä¸‹é¢çš„ä¾‹å­ï¼Œ è·¯å¾„ `/users/:id`ä¾ç„¶å¯ä»¥åŒ¹é…åˆ° UserProfile å…ƒç´ ï¼Œè€Œä¸ç”¨æ‹…å¿ƒè·¯å¾„è¢«æˆªæ–­ï¼š\n\n```jsx\n\u003cRoute path=\"users\"\u003e\n  \u003cRoute path=\":id\" element={\u003cUserProfile /\u003e} /\u003e\n\u003c/Route\u003e\n```\n\n\u003chr /\u003e\n\nã€å®Œã€"])</script><script>self.__next_f.push([1,"45:T1d12,"])</script><script>self.__next_f.push([1,"\u003e åŸæ–‡è·¯å¾„ï¼šhttps://reactrouter.com/docs/en/v6/routers/browser-router\n\n### BrowserRouter\n\nç±»å‹å£°æ˜ï¼š\n```ts\ndeclare function BrowserRouter(\n  props: BrowserRouterProps\n): React.ReactElement;\n\ninterface BrowserRouterProps {\n  basename?: string;\n  children?: React.ReactNode;\n  window?: Window;\n}\n```\n\nBrowserRouteræ˜¯React Routeræ¨èä½¿ç”¨çš„æ¥å£ã€‚BrowserRouteråŸºäºæµè§ˆå™¨å†…ç½®ï¼ˆH5 APIï¼‰çš„history stackæ¥å­˜å‚¨å½“å‰æµè§ˆå™¨åœ°å€æ çš„locationä¿¡æ¯ã€‚\n\n`\u003cBrowserRouter window\u003e`é»˜è®¤ä¼šä½¿ç”¨å½“å‰[documentçš„`defaultView`](https://developer.mozilla.org/en-US/docs/Web/API/Document/defaultView)ï¼Œä»–åœ¨ä¸šåŠ¡ä½¿ç”¨ä¸­è¿˜ä¹Ÿå¯ç”¨æ¥åœ¨å¦å¤–ä¸€ä¸ªæµè§ˆå™¨windowç¯å¢ƒä¸‹ï¼ˆæ¯”å¦‚iframeä¸­ï¼‰è¿½æº¯URLçš„å˜åŒ–ã€‚\n\n\nä½¿ç”¨èŒƒä¾‹ï¼š\n```jsx\nimport * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { BrowserRouter } from \"react-router-dom\";\n\nReactDOM.render(\n  \u003cBrowserRouter\u003e\n    {/* The rest of your app goes here */}\n  \u003c/BrowserRouter\u003e,\n  root\n);\n```\n\n### HashRouter\n\nç±»å‹å£°æ˜ï¼š\n```ts\ndeclare function HashRouter(\n  props: HashRouterProps\n): React.ReactElement;\n\ninterface HashRouterProps {\n  basename?: string;\n  children?: React.ReactNode;\n  window?: Window;\n}\n```\n\nHashRouterç”¨åœ¨åŸºäºæµè§ˆå™¨çš„webé¡¹ç›®ä¸­ï¼Œè€Œä¸”ä¸éœ€è¦é€šè¿‡åç«¯æœåŠ¡æ¥æ§åˆ¶è·¯ç”±è·³è½¬ã€‚ä»–çš„åŸç†æ˜¯åŸºäºæµè§ˆå™¨çš„é”šç‚¹ï¼Œé€šè¿‡è®¾ç½®ä¸åŒçš„é”šç‚¹æ¥è¾¾åˆ°è·³è½¬é¡µé¢çš„æ•ˆæœã€‚\n\n\nä¹Ÿå¯ä»¥æœ‰`\u003cHashRouter window\u003e`çš„å†™æ³•ï¼Œä½œç”¨åŒ`\u003cBrowserRouter window\u003e`ã€‚\n\nä½¿ç”¨èŒƒä¾‹ï¼š\n```jsx\nimport * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { HashRouter } from \"react-router-dom\";\n\nReactDOM.render(\n  \u003cHashRouter\u003e\n    {/* The rest of your app goes here */}\n  \u003c/HashRouter\u003e,\n  root\n);\n```\n\n\u003e å®˜æ–¹ä¼˜å…ˆæ¨èä½¿ç”¨BrowserRouterï¼Œä»–æ˜¯åŸºäºH5æ ‡å‡†åˆ¶å®šçš„ï¼Œæ›´åŠ è§„èŒƒï¼Œæœ‰åŸç”Ÿçš„APIå¯ä»¥ä½¿ç”¨ï¼›åŒæ—¶ï¼ŒBrowserRouterè¿˜å¯ä»¥å°†å½“å‰è·¯ç”±ä¿¡æ¯å‘é€ç»™serverï¼Œä¾¿äºæ•°æ®åŒæ­¥ï¼›æ­¤å¤–åœ¨ä¸€äº›ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œä¼šä¸¢å¤±hashä¿¡æ¯ï¼Œä»¥è‡³äºHashRouterä¸èƒ½ä½¿ç”¨ï¼Œæ¯”å¦‚å°†URLä½¿ç”¨å¾®ä¿¡åˆ†äº«ã€‚\n\n### HistoryRouter\n\nç±»å‹å£°æ˜ï¼š\n```jsx\ndeclare function HistoryRouter(\n  props: HistoryRouterProps\n): React.ReactElement;\n\ninterface HistoryRouterProps {\n  basename?: string;\n  children?: React.ReactNode;\n  history: History;\n}\n```\n\n`\u003cunstable_HistoryRouter\u003e`æä¾›ä¸€ä¸ªå°†historyä½œä¸ºpropçš„å®ä¾‹å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨å®ƒåœ¨éReactçš„ä¸Šä¸‹æ–‡ç¯å¢ƒæˆ–å…¨å±€å˜é‡ä¸­ä½¿ç”¨Routerã€‚\n\nèŒƒä¾‹ï¼š\n\n```jsx\nimport * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { unstable_HistoryRouter as HistoryRouter } from \"react-router-dom\";\nimport { createBrowserHistory } from \"history\";\n\nconst history = createBrowserHistory({ window });\n\nReactDOM.render(\n  \u003cHistoryRouter history={history}\u003e\n    {/* The rest of your app goes here */}\n  \u003c/HistoryRouter\u003e,\n  root\n);\n```\n\n\u003e æ­¤APIçš„å‰ç¼€ä¸ºâ€œunstable_â€ï¼Œå› ä¸ºæ‚¨å¯èƒ½ä¼šæ— æ„ä¸­å°†å†å²åº“çš„ä¸¤ä¸ªç‰ˆæœ¬éƒ½æ·»åŠ åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„å¼€å‘å·¥å…·å…è®¸ï¼Œå»ºè®®ä¸è¦å°†historyæ·»åŠ ä¸ºç›´æ¥ä¾èµ–é¡¹ï¼Œè€Œæ˜¯ä¾èµ–react-routeråŒ…ä¸­çš„åµŒå¥—ä¾èµ–é¡¹ã€‚ä¸€æ—¦æˆ‘ä»¬æœ‰äº†æ£€æµ‹ä¸åŒ¹é…ç‰ˆæœ¬çš„æœºåˆ¶ï¼Œè¿™ä¸ªAPIå°†åˆ é™¤å…¶â€œunstable_â€çš„å‰ç¼€ã€‚\n\n### MemoryRouter\n\nç±»å‹å£°æ˜ï¼š\n```jsx\ndeclare function MemoryRouter(\n  props: MemoryRouterProps\n): React.ReactElement;\n\ninterface MemoryRouterProps {\n  basename?: string;\n  children?: React.ReactNode;\n  initialEntries?: InitialEntry[];\n  initialIndex?: number;\n}\n```\n\n`\u003cMemoryRouter\u003e`å°†locationä¿¡æ¯å­˜åœ¨ä¸€ä¸ªæ•°ç»„ä¸­. ä¸åŒäºÂ `\u003cBrowserHistory\u003e`Â å’ŒÂ `\u003cHashHistory\u003e`, ä»–ä¸ä½¿ç”¨é¢å¤–çš„èµ„æºï¼ˆæ¯”å¦‚æµè§ˆå™¨history stackï¼‰ã€‚å®ƒé€‚ç”¨äºä½ æƒ³è¦å®Œå…¨æ§åˆ¶history stackçš„åœºæ™¯ã€‚æ¯”å¦‚å•å…ƒæµ‹è¯•ã€‚\n\nä»–æœ‰ä¸¤ä¸ªå‚æ•°ï¼š\n-   `\u003cMemoryRouter initialEntries\u003e`Â é»˜è®¤ä¸ºÂ `[\"/\"]`Â (å•ä¸€å…¥å£â€™/â€˜) ä»–æ˜¯å†å²å †æ ˆä¸­çš„ä½ç½®æ•°ç»„ã€‚è¿™äº›å¯¹è±¡å¯ä»¥æ˜¯åŒ…å«`{pathname, search, hash, state}`çš„å®Œæ•´ä½ç½®å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯ç®€å•çš„å­—ç¬¦ä¸²url\n-   `\u003cMemoryRouter initialIndex\u003e`Â é»˜è®¤ä¸ºÂ `initialEntries` çš„æœ€åä¸€ä¸ªç´¢å¼•ï¼Œå¯ä¼ é€’ä»»æ„çš„ç´¢å¼•ä½ç½®\n\n\u003e **Tip:**\n\u003e å¤§å¤šæ•°React Routerçš„æµ‹è¯•éƒ½æ˜¯ç”¨äº†`\u003cMemoryRouter\u003e`ä½œä¸ºè·¯ç”±å…¥å£, è¿™é‡Œæœ‰å¾ˆå¤šæµ‹è¯•èŒƒä¾‹ï¼š[browsing through our tests](https://github.com/remix-run/react-router/tree/main/packages/react-router/__tests__).\n\nä½¿ç”¨èŒƒä¾‹ï¼š\n```jsx\nimport * as React from \"react\";\nimport { create } from \"react-test-renderer\";\nimport {\n  MemoryRouter,\n  Routes,\n  Route,\n} from \"react-router-dom\";\n\ndescribe(\"My app\", () =\u003e {\n  it(\"renders correctly\", () =\u003e {\n    let renderer = create(\n      \u003cMemoryRouter initialEntries={[\"/users/mjackson\"]}\u003e\n        \u003cRoutes\u003e\n          \u003cRoute path=\"users\" element={\u003cUsers /\u003e}\u003e\n            \u003cRoute path=\":id\" element={\u003cUserProfile /\u003e} /\u003e\n          \u003c/Route\u003e\n        \u003c/Routes\u003e\n      \u003c/MemoryRouter\u003e\n    );\n\n    expect(renderer.toJSON()).toMatchSnapshot();\n  });\n});\n```\n\n### NaviteRouter\n\nç±»å‹å£°æ˜ï¼š\n```jsx\ndeclare function NativeRouter(\n  props: NativeRouterProps\n): React.ReactElement;\n\ninterface NativeRouterProps extends MemoryRouterProps {}\n```\n\n`\u003cNativeRouter\u003e`Â æ˜¯React Routeræ¨èçš„åœ¨[React Native](https://reactnative.dev/)Â Appä¸­ä½¿ç”¨çš„è·¯ç”±ç±»å‹ã€‚\n\nä»–æœ‰ä¸¤ä¸ªå¯é€‰å‚æ•°ï¼š\n-   `\u003cNativeRouter initialEntries\u003e`Â é»˜è®¤ä¸ºÂ `[\"/\"]`\n-   `\u003cNativeRouter initialIndex\u003e`Â Â é»˜è®¤ä¸ºÂ `initialEntries` çš„æœ€åä¸€ä¸ªç´¢å¼•\n\nä½¿ç”¨èŒƒä¾‹ï¼š\n```jsx\nimport * as React from \"react\";\nimport { NativeRouter } from \"react-router-native\";\n\nfunction App() {\n  return (\n    \u003cNativeRouter\u003e\n      {/* The rest of your app goes here */}\n    \u003c/NativeRouter\u003e\n  );\n}\n```\n\n### StaticRouter\n\nç±»å‹å£°æ˜ï¼š\n```jsx\ndeclare function StaticRouter(\n  props: StaticRouterProps\n): React.ReactElement;\n\ninterface StaticRouterProps {\n  basename?: string;\n  children?: React.ReactNode;\n  location?: Path | LocationPieces;\n}\n```\n\n`\u003cStaticRouter\u003e`ç”¨äºåœ¨Â [node](https://nodejs.org/) ä¸­æ¸²æŸ“React Routerã€‚å…¶é€šè¿‡ `location`Â prop æ¥æä¾›è·¯ç”±ä¿¡æ¯ã€‚\n\næœ‰ä¸€ä¸ªå¯é€‰å‚æ•°ï¼š\n-   `\u003cStaticRouter location\u003e`Â é»˜è®¤æ˜¯Â `\"/\"`\n\nä½¿ç”¨èŒƒä¾‹ï¼š\n```jsx\nimport * as React from \"react\";\nimport * as ReactDOMServer from \"react-dom/server\";\nimport { StaticRouter } from \"react-router-dom/server\";\nimport http from \"http\";\n\nfunction requestHandler(req, res) {\n  let html = ReactDOMServer.renderToString(\n    \u003cStaticRouter location={req.url}\u003e\n      {/* The rest of your app goes here */}\n    \u003c/StaticRouter\u003e\n  );\n\n  res.write(html);\n  res.end();\n}\n\nhttp.createServer(requestHandler).listen(3000);\n```\n\n### ~~Router ï¼ˆä¸æ¨èï¼‰~~\n\nç±»å‹å£°æ˜ï¼š\n```jsx\ndeclare function Router(\n  props: RouterProps\n): React.ReactElement | null;\n\ninterface RouterProps {\n  basename?: string;\n  children?: React.ReactNode;\n  location: Partial\u003cLocation\u003e | string;\n  navigationType?: NavigationType;\n  navigator: Navigator;\n  static?: boolean;\n}\n```\n\n`\u003cRouter\u003e`æ¥å£æ˜¯ä¸Šè¿°å…¶ä»–ç±»å‹Routeræ‰€å…±äº«çš„æ ¸å¿ƒç»„ä»¶ï¼Œä¸ºå…¶ä»–é«˜çº§Routeræä¾›ç†ç”±ä¿¡æ¯ä¸Šä¸‹æ–‡ï¼ˆ[context provider](https://reactjs.org/docs/context.html#contextprovider)ï¼‰ï¼Œä½¿ç”¨ä¼˜å…ˆçº§æœ€ä½ã€‚\n\nå¼€å‘è€…å‡ ä¹ä¸éœ€è¦ç›´æ¥ä½¿ç”¨è¿™ä¸ªAPIï¼Œæ¨èä½¿ç”¨ä¸Šè¾¹æ›´é«˜é˜¶çš„è·¯ç”±ã€‚\n\nä»–æœ‰ä¸€ä¸ªå‚æ•°ï¼š\n- `\u003cRouter basename\u003e` ä½¿ç”¨basenameå…±äº«ä¸€ä¸ªæ ¹è·¯ç”±ã€‚åœ¨å¤§å‹é¡¹ç›®æˆ–è€…å¤šå…¥å£å·¥ç¨‹åŒ–æ–‡ä»¶ä¸­ä½¿ç”¨æœ‰å¥‡æ•ˆã€‚\n\n\u003chr /\u003e\n\n\nThat's All. ä¸‹æœŸè®²å†…ç½®ç»„ä»¶çš„ä½¿ç”¨ã€‚"])</script><script>self.__next_f.push([1,"46:T6f41,"])</script><script>self.__next_f.push([1,"## 1. ä¸»è¦æ¦‚å¿µ\n\n\u003e åŸæ–‡è·¯å¾„ï¼šhttps://reactrouter.com/docs/en/v6/getting-started/concepts\n\nä½ å¯èƒ½ä¼šå¥½å¥‡ï¼ŒReact Routeræ˜¯æ€ä¹ˆè¿è¡Œèµ·æ¥çš„ï¼Œä»–åˆæ˜¯æ€ä¹ˆè¾…åŠ©æ„å»ºAppçš„ï¼Ÿæ¢å¥è¯è¯´ï¼Œè·¯ç”±routeråˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ\n\nå¦‚æœä½ æ›¾ç»æƒ³è¿‡ä¸Šè¿°é—®é¢˜ï¼Œæˆ–è€…ä½ æƒ³è¦æ›´æ·±å…¥çš„äº†è§£è·¯ç”±æœºåˆ¶ï¼Œé‚£ä¹ˆæœ¬ç¯‡æ–‡ç« å¯ä»¥å¸®åŠ©åˆ°ä½ ã€‚æœ¬æ–‡åŒ…å«React Routeræ‰€æœ‰æ ¸å¿ƒæ¦‚å¿µçš„è¯¦ç»†è§£é‡Šã€‚\n\nåŒæ—¶ä¹Ÿè¯·ä¸è¦å› ä¸ºè¿™ç¯‡æ–‡ç« è€Œé’»ç‰›è§’å°–ï¼ŒReact Routerçš„åŸºæœ¬ä½¿ç”¨è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œä¸šåŠ¡ä½¿ç”¨çš„è¯ï¼Œä¹Ÿä¸éœ€è¦æŒ–æ˜è¿™ä¹ˆæ·±å…¥ã€‚\n\nReact Routerå¯ä¸ä»…ä»…æ˜¯ä¸€ä¸ªurlçš„æ˜ å°„å‡½æ•°ï¼Œä»–æ˜¯ä¸€å¥—å…³äºæ„å»ºå®Œæ•´çš„ç”¨æˆ·ç•Œé¢çš„URLæ˜ å°„æœºåˆ¶ï¼Œæ‰€ä»¥ä¼šæœ‰æ›´å¤šçš„æ¦‚å¿µå’Œè§„èŒƒã€‚æˆ‘ä»¬å°†ä¼šåœ¨ä»¥ä¸‹ä¸‰ç‚¹æ¥è®¨è®ºï¼š\n\n1. è®¢é˜…å’Œä½¿ç”¨ [history stack](https://reactrouter.com/docs/en/v6/getting-started/concepts#history-stack)\n\n2. åœ¨è·¯ç”±ä¸­æ˜ å°„[URL](https://reactrouter.com/docs/en/v6/getting-started/concepts#url)\n\n3. é€šè¿‡æ˜ å°„æ¥æ¸²æŸ“å±‚çº§åµŒå¥—UI\n\n\n### å®šä¹‰ \n\né¦–å…ˆå…ˆæŠ›å‡ºä¸€äº›å®šä¹‰ã€‚ä¸åŒäºå‰åç«¯æ¡†æ¶çš„è®¾è®¡æ€è·¯ï¼Œæœ‰æ—¶å€™React Routerä¸­çš„ä¸€ä¸ªè¯ï¼Œåœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡è¯­ä¹‰ä¸­ä¼šæœ‰ä¸åŒçš„æ„æ€ã€‚ä¸‹é¢åˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„è¯æ±‡ï¼Œåœ¨ä¹‹åä¹Ÿä¼šè¯¦ç»†çš„æè¿°ï¼š\n\n- **URL** - å¾ˆå¤šäººè®¤ä¸ºURLå’Œrouteå¯äº’æ¢ï¼Œç„¶è€ŒReact Routerä¸­å´ä¸æ˜¯è¿™æ ·ã€‚\n- **Location** - æ˜¯React Routerç‹¬æœ‰çš„ï¼ŒåŸºäºwindow.locationçš„ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºå½“å‰ç”¨æˆ·æ‰€åœ¨åœ°ã€‚ä»–é€šå¸¸ç”¨æ¥è¡¨ç¤ºURLï¼Œä½†æ˜¯ä¼šé™„å¸¦é¢å¤–çš„è·¯ç”±ä¿¡æ¯ã€‚\n- **Location State** - ä¸€ä¸ªæœªè¢«ç¼–ç çš„URLè·¯ç”±ä½ç½®çŠ¶æ€ã€‚ç±»ä¼¼äºè·¯ç”±hashæˆ–è€…è·¯ç”±parmasï¼Œä¸åŒçš„æ˜¯stateæ˜¯å­˜å‚¨åœ¨æµè§ˆå™¨ç¼“å­˜ä¸­ã€‚\n- **History Stack** - å½“ç”¨æˆ·ä½¿ç”¨è·¯ç”±è·³è½¬æ—¶ï¼Œæµè§ˆå™¨ç»´æŠ¤ä¸€ä¸ªè·¯ç”±æ ˆï¼Œå¯¹äºæ ˆä¸­çš„æ¯ä¸€ä¸ªè·¯ç”±è¿›è¡Œè¿½æº¯ã€‚å¦‚æœä½ é•¿æŒ‰æµè§ˆå™¨ä¸­çš„å‘åæŒ‰é’®ï¼Œä½ ä¼šçœ‹åˆ°æµè§ˆå™¨çš„è·¯ç”±è·³è½¬å†å²ã€‚\n- **Client Side Routing (CSR)** - æ‰å¹³åŒ–HTMLæ–‡æ¡£è·³è½¬æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ç»´æŠ¤ä¸€ä¸ªhistory stackï¼Œç”¨æˆ·ä¾§çš„è·¯ç”±å¯ä»¥è®©å¼€å‘è€…åœ¨ä¸è®¿é—®åç«¯æœåŠ¡çš„å‰æä¸‹æ“ä½œè·¯ç”±å †æ ˆã€‚\n- **History** React Routerå†…ç½®å¯¹è±¡ï¼Œç”¨æˆ·å¯ä»¥ç”¨å®ƒè·å–è·¯ç”±è®¢é˜…ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†ä¸€äº›APIæ¥ç„¶ç”¨æˆ·æ“ä½œhistory stackã€‚\n- **History Action** - history stackçš„æ“ä½œï¼Œæœ‰Pop. Pushå’ŒReplaceã€‚å¯ä½¿ç”¨Pushæ¥æ–°æ·»åŠ ä¸€ä¸ªè·¯ç”±å…¥å£ï¼Œä½¿ç”¨Replaceä¹Ÿå¯ä»¥è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœï¼Œåªæ˜¯ä¼šåœ¨å †æ ˆä¸­æ›¿æ¢æ‰å½“å‰çš„è·¯ç”±ï¼Œä½¿ç”¨Popæ¥è·å–ä¸Šä¸€ä¸ªå†å²è·¯ç”±ï¼Œç”¨ä»¥æµè§ˆå™¨è¿”å›ã€‚\n- **Segment** - ä»‹äº'/'ä¹‹é—´çš„URLç‰‡æ®µã€‚æ¯”å¦‚ï¼Œâ€™/users/123â€˜å°±æœ‰ä¸¤ä¸ªç‰‡æ®µã€‚\n- **Path Pattern** - å¸¦å‚URLã€‚æ¯”å¦‚åŠ¨æ€ç‰‡æ®µ'/users/:userId'å’Œæ˜Ÿå·ç‰‡æ®µ'/docs/\\*'ã€‚æ˜¯ä¸€ç§React Routerè·¯ç”±çš„åŒ¹é…æ¨¡å¼ã€‚\n- **Dynamic Segment** - åŠ¨æ€ç‰‡æ®µï¼Œè§ä¸Šè¾¹æè¿°ã€‚'users/:userId'å¯ä»¥ç²¾ç¡®åŒ¹é…'users/123'.\n- **URL Params** - åŠ¨æ€è·¯ç”±ç‰‡æ®µè§£æå‡ºæ¥çš„è·¯ç”±å‚æ•°ã€‚\n- **Router** - æœ‰çŠ¶æ€è·¯ç”±ç»„ä»¶ã€‚å±‚çº§åµŒå¥—ä½¿ç”¨ã€‚\n- **Route Config** - è·¯ç”±æ ‘ã€‚é€šè¿‡åŒ¹é…æœºåˆ¶æ¥æ„å»ºè·¯ç”±åˆ†æ”¯ã€‚\n- **Route** - è·¯ç”±å…ƒç´ çš„åŸºç¡€ç»„ä»¶ã€‚æœ‰pathå’Œelementä¸¤ä¸ªå‚æ•°ã€‚pathæ˜¯åŒ¹é…æ¨¡å¼ï¼Œå½“pathåŒ¹é…æˆåŠŸåï¼Œelementä¸­çš„å…ƒç´ æ‰ä¼šè¢«æ¸²æŸ“ã€‚\n- **Nested Routes** - åµŒå¥—è·¯ç”±ã€‚è·¯ç”±å¯ä»¥æœ‰è‡ªå·±çš„å­©å­ï¼Œæ¯ä¸€ä¸ªè·¯ç”±éƒ½å®šä¹‰äº†URLç‰‡æ®µï¼Œå•ä¸ªURLå¯ä»¥åŒæ—¶åŒ¹é…è·¯ç”±æ ‘ä¸­çš„å¤šä¸ªè·¯ç”±ã€‚è¿™ä½¿å¾—å¯ä»¥ä½¿ç”¨outlet. ç›¸å¯¹è·¯ç”±ç­‰æ¥å¸ƒå±€åµŒå¥—domç»“æ„ã€‚\n- **Relative links** - ç›¸å¯¹è·¯ç”±ã€‚ä¸ä½¿ç”¨'/'å¼€å¤´çš„è·¯ç”±ã€‚ä»–ä¼šç»§æ‰¿çˆ¶çº§è·¯ç”±ä½œä¸ºå‰ç¼€æ¥è¿›è¡ŒåŒ¹é…ã€‚è¿™ä½¿å¾—æ·±å±‚æ¬¡çš„URLæ¸²æŸ“å˜å¾—å®¹æ˜“ï¼Œå› ä¸ºä½ ä¸ç”¨å†è€ƒè™‘å¦‚ä½•è·å¾—å®Œæ•´çš„ä¸Šä¸‹æ–‡è·¯ç”±äº†ã€‚\n- **Match** - å½“è·¯ç”±ä¸URLåŒ¹é…æ—¶ç”¨äºä¿å­˜ä¿¡æ¯çš„å¯¹è±¡ã€‚æ¯”å¦‚ï¼ŒåŒ¹é…çš„URLå‚æ•°å’Œè·¯å¾„åã€‚\n- **Matches** - åŒ¹é…å½“å‰ä½ç½®çš„è·¯ç”±æ•°ç»„ã€‚ç”¨äºåµŒå¥—è·¯ç”±ä¸­ã€‚\n- **Parent Route** - çˆ¶è·¯ç”±ã€‚\n- **Outlet** - çˆ¶è·¯ç”±ä¸­åŒ¹é…å­è·¯ç”±çš„æ¸²æŸ“æ’æ§½ã€‚\n- **Index Route** - outletä¸­é»˜è®¤æ¸²æŸ“çš„ç»„ä»¶ã€‚\n- **Layout Route** - æ²¡æœ‰pathçš„çˆ¶è·¯ç”±ã€‚ç”¨äºæŠŠå­è·¯ç”±åˆ†ç»„åˆ°ä¸€ä¸ªå¸ƒå±€å•å…ƒä¸­ã€‚\n\n### Historyå’ŒLocation\n\nåœ¨ä½¿ç”¨React Routerä¹‹å‰ï¼Œéœ€è¦å…ˆè®¢é˜…æµè§ˆå™¨è·¯ç”±å †æ ˆçš„å˜æ›´ã€‚æµè§ˆå™¨ä¼šç‹¬ç«‹ç»´æŠ¤è¯¥å †æ ˆçš„å˜åŒ–ï¼Œæ‰€ä»¥æµè§ˆå™¨è‡ªå¸¦çš„å‰è¿›å’Œåé€€æ‰èƒ½å¤Ÿä½¿ç”¨ã€‚ä¼ ç»Ÿwebå¼€å‘ä¸­ï¼Œç”¨æˆ·æ¯ç‚¹å‡»å‰è¿›æˆ–åé€€. æ¯å‘èµ·ä¸€ä¸ªè·¯ç”±è·³è½¬éƒ½ä¼šå‘åç«¯å‘èµ·è¯·æ±‚ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹çš„æ“ä½œæµç¨‹ï¼š\n\n1.  ç‚¹å‡»é“¾æ¥è·³è½¬åˆ°Â `/dashboard`\n2.  ç‚¹å‡»é“¾æ¥è·³è½¬åˆ°Â `/accounts`\n3.  ç‚¹å‡»é“¾æ¥è·³è½¬åˆ°Â `/customers/123`\n4.  ç‚¹å‡»åé€€æŒ‰é’®\n5.  ç‚¹å‡»é“¾æ¥è·³è½¬åˆ°Â `/dashboard`\n\né‚£ä¹ˆè·¯ç”±å †æ ˆå°†ä¼šæœ‰å¦‚ä¸‹çš„å˜åŒ–ï¼š\n1. \\[**`/dashboard`**\\]\n2.  \\[`/dashboard`,Â  **`/accounts`**\\]\n3.  \\[`/dashboard`,Â `/accounts`,Â  **`/customers/123`**\\]\n4.  \\[`/dashboard`,Â  **`/accounts`**,Â `/customers/123`\\]\n5.  \\[`/dashboard`,Â `/accounts`,Â  **`/dashboard`**\\]\n\n\u003e è¯‘è€…æ³¨è§£ï¼Œè¿™é‡Œç¬¬å››åˆ°ç¬¬äº”æ­¥ï¼Œ/customers/123è¢«æ›¿æ¢æ‰äº†ï¼Œç±»ä¼¼äºæ“ä½œäº†replaceï¼Œå¯èƒ½æ˜¯æµè§ˆå™¨åˆ¤æ–­ç¬¬4æ­¥æ˜¯backæ“ä½œå›æ¥çš„ï¼Œç¬¬äº”æ­¥ä¸­å¼ºåˆ¶ä½¿ç”¨äº†replaceã€‚\n\n#### History Object\n\nåœ¨ç”¨æˆ·ç«¯è·¯ç”±ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ä»£ç æ˜¾å¼çš„æ“ä½œæµè§ˆå™¨è·¯ç”±ã€‚æ¯”å¦‚è¯´ï¼Œå¯ä»¥å¦‚ä¸‹å†™ï¼š\n\n```js\n\u003ca\n  href=\"/contact\"\n  onClick={(event) =\u003e {\n    // stop the browser from changing the URL and requesting the new document\n    event.preventDefault();\n    // push an entry into the browser history stack and change the URL\n    window.history.pushState({}, undefined, \"/contact\");\n  }}\n/\u003e\n```\nä¸Šè¿°ä»£ç æ”¹å˜äº†URLï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¯¹UIè¿›è¡Œä»»ä½•çš„ä¿®æ”¹ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä»£ç æ¥æ”¹å˜è·¯ç”±çŠ¶æ€ï¼Œä»è€Œå½±å“UIçš„å˜åŒ–ã€‚ä½†é—®é¢˜æ˜¯ï¼Œæµè§ˆå™¨æ²¡æœ‰æä¾›éå¸¸å¥½çš„ç›‘å¬URLå˜åŒ–çš„æ–¹æ³•ã€‚\n\næˆ‘ä»¬å¯ä»¥æ¢ç§ç›‘å¬æ–¹å¼ï¼š\n\n\n```js\nwindow.addEventListener(\"popstate\", () =\u003e {\n  // URL changed!\n});\n```\n\nä¸Šè¿°æ–¹æ³•çœ‹èµ·æ¥ä¸é”™ï¼Œä½†æ˜¯ä»–åªåœ¨ç”¨æˆ·ç‚¹å‡»åé€€æˆ–è€…å‰è¿›æ—¶ç”Ÿæ•ˆã€‚åœ¨ç¨‹åºè°ƒç”¨`window.history.pushState`æˆ–`window.history.replaceState`æ—¶å´æ²¡æœ‰ä»»ä½•ç›‘å¬äº‹ä»¶å¯ä»¥ä½¿ç”¨ã€‚\n\nåœ¨React Routerä¸­ï¼Œhistoryå¯ä»¥å¸®åŠ©ä½ å®ç°ç›‘å¬ã€‚ä»–æä¾›å¯¹push. pop. replaceäº‹ä»¶çš„ç›‘å¬ï¼š\n\n```js\nlet history = createBrowserHistory();\nhistory.listen(({ location, action }) =\u003e {\n  // this is called whenever new locations come in\n  // the action is POP, PUSH, or REPLACE\n});\n```\nAppä¸éœ€è¦å†é¢å¤–åˆ›å»ºä»–ä»¬è‡ªå·±çš„historyå¯¹è±¡ï¼Œé€šè¿‡ç®€å•çš„ç›‘å¬å‡½æ•°ï¼Œå¯ä»¥å®Œæˆæ­£ç¡®çš„é‡æ–°æ¸²æŸ“ã€‚\n\n#### Location\n\næµè§ˆå™¨çš„windowè‡ªå¸¦æœ‰locationå¯¹è±¡ï¼Œä»–æä¾›URLçš„ç›¸å…³ä¿¡æ¯ï¼š\n\n```js\nwindow.location.pathname; // /getting-started/concepts/\nwindow.location.hash; // #location\nwindow.location.reload(); // force a refresh w/ the server\n```\n\nåœ¨React Routerä¸­çš„ä½¿ç”¨ç±»ä¼¼ï¼Œä½†æ˜¯ä¼šæ›´ç®€å•ï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š\n\n\n```js\n{\n  pathname: \"/bbq/pig-pickins\",\n  search: \"?campaign=instagram\",\n  hash: \"#menu\",\n  state: null,\n  key: \"aefz24ie\"\n}\n```\nå‰ä¸‰ä¸ªå‚æ•°`{ pathname, search, hash }`ç±»ä¼¼äºwindow.locationï¼Œåä¸¤ä¸ªå‚æ•°æ˜¯React Routerç‹¬æœ‰çš„ã€‚\n\n##### Location Pathname\n\nLocation Pathnameæ˜¯URLçš„ä¸€éƒ¨åˆ†ï¼Œæ¯”å¦‚å¯¹äºURLï¼š`https://example.com/teams/hotspurs`, ä»–çš„pathnameå°±æ˜¯`/teams/hotspurs`ã€‚è¿™éƒ¨åˆ†æ‰æ˜¯ç”¨äºè·¯ç”±åŒ¹é…çš„ã€‚\n\n##### Location Search\n\nURLæœ‰å¾ˆå¤šä¸åŒçš„ä½¿ç”¨é€‰é¡¹ï¼š\n\n- location search\n- search params\n- URL search params\n- query string\n\nåœ¨React Routerä¸­ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨location searchï¼Œå®ƒæ˜¯ä¸€ç§åºåˆ—åŒ–çš„`URLSearchParams`ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ä¹Ÿå¯ä»¥å«ä»–`URL search params`ï¼š\n\n```js\n// given a location like this:\nlet location = {\n  pathname: \"/bbq/pig-pickins\",\n  search: \"?campaign=instagram\u0026popular=true\",\n  hash: \"\",\n  state: null,\n  key: \"aefz24ie\",\n};\n\n// we can turn the location.search into URLSearchParams\nlet params = new URLSearchParams(location.search);\nparams.get(\"campaign\"); // \"instagram\"\nparams.get(\"popular\"); // \"true\"\nparams.toString(); // \"campaign=instagram\u0026popular=true\",\n```\nè§£æå‰çš„åºåˆ—åŒ–å­—ç¬¦ä¸²å«`search`ï¼Œç²¾å‡†è§£æåä¾¿æ˜¯`search params`äº†ã€‚è¯‘è€…è®¤ä¸ºè¿™é‡Œæè¿°çš„æ„æ€å°±æ˜¯è¯´å¯ä»¥å°†URLå­—ç¬¦ä¸²ç¿»è¯‘ä¸ºä¸€ä¸ªç»“æ„åŒ–çš„å‚æ•°å¯¹è±¡ã€‚å½“ä¸éœ€è¦è€ƒè™‘ç²¾ç¡®åº¦æ—¶ï¼Œè¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯å¯ä»¥äº’æ¢çš„ã€‚\n\n##### Location Hash\n\nURLä¸­çš„å“ˆå¸Œï¼ˆé”šç‚¹ï¼‰è¡¨ç¤ºå½“å‰é¡µé¢æ»šåŠ¨çš„ä½ç½®ã€‚åœ¨window.history.pushStateè¢«å¼•å…¥ä¹‹å‰ï¼Œwebå¼€å‘è€…åªèƒ½é€šè¿‡æ”¹å˜URLé”šç‚¹æ¥æ§åˆ¶æµè§ˆå™¨è·¯ç”±çš„å˜åŒ–ï¼Œè¿™ä¹Ÿæ˜¯åœ¨ä¸è®¿é—®åç«¯æœåŠ¡çš„å‰æä¸‹æ”¹å˜è·¯ç”±çš„å”¯ä¸€æ–¹å¼ã€‚ç°åœ¨æˆ‘ä»¬ä»ç„¶å¯ä»¥è¿™æ ·ä½¿ç”¨ä»–ã€‚\n\n##### Location State\n\nä½ å¯èƒ½ä¼šå¥½å¥‡H5çš„API`window.history.pushState()`ä¸ºä»€ä¹ˆä¼šå«åšpush stateï¼Œæˆ‘ä»¬åˆšåˆšæ”¹å˜äº†URLï¼Œç†è®ºä¸Šä¸æ˜¯åº”è¯¥å«åš`history.push`æ›´è´´åˆ‡ï¼Ÿå“ˆï¼Œæˆ‘ä»¬ä¹Ÿä¸æ˜¯æµè§ˆå™¨æ ‡å‡†çš„åˆ¶å®šè€…ï¼Œè¿™äº›é—®é¢˜æˆ‘ä»¬æš‚ä¸”ä¸è€ƒè™‘ï¼Œå°±è¿™ä¸ªAPIæœ¬èº«è€Œè¨€ï¼Œç¡®å®æ˜¯ä¸€ä¸ªä¸é”™çš„æµè§ˆå™¨æ–°ç‰¹æ€§ã€‚ï¼ˆä½œè€…éšæ€§ç¿»è¯‘ï¼Œå¤§æ„åŸºæœ¬æ˜¯è¿™æ ·ï¼‰ã€‚\n\næµè§ˆå™¨æä¾›çš„è¿™ä¸ªstateï¼Œå¯ä»¥è®©æˆ‘ä»¬è½»æ¾åœ°ä¼ é€’è·¯ç”±çŠ¶æ€ã€‚å½“æˆ‘ä»¬ç‚¹å‡»æµè§ˆå™¨åé€€æŒ‰é’®æ—¶ï¼Œé€šè¿‡`pushState`ä¾¿å¯ä»¥å¼•èµ·`history.state`çš„å˜åŒ–ï¼š\n\n\u003e è¯‘è€…æé†’ï¼šè¿™ç§çŠ¶æ€åœ¨åˆ·æ–°æµè§ˆå™¨åä¼šä¸¢å¤±ï¼Œéœ€è¦æ…ç”¨\n\n```js\nwindow.history.pushState(\"look ma!\", undefined, \"/contact\");\nwindow.history.state; // \"look ma!\"\n// user clicks back\nwindow.history.state; // undefined\n// user clicks forward\nwindow.history.state; // \"look ma!\"\n```\n\nReact Routeråˆ©ç”¨äº†æµè§ˆå™¨è‡ªå¸¦çš„åŠŸèƒ½ï¼Œå¯¹å…¶è¿›è¡Œäº†ä¸€äº›æŠ½è±¡å°è£…ï¼Œå¹¶å°†å€¼æ˜¾ç¤ºåœ¨locationä¸­ï¼Œè€Œä¸æ˜¯historyé‡Œã€‚\n\nä½ å¯ä»¥è¯•ç€ä½¿ç”¨location.stateï¼Œæ¯”å¦‚`location.hash`æˆ–è€…`location.search`ï¼Œè€Œä¸æ˜¯ç›´æ¥å°†è·¯ç”±å‚æ•°æ”¾åœ¨URLé‡Œï¼Œè¿™æ ·ä½ çš„URLä¼šæ¯”è¾ƒæ•´æ´ï¼Œä¼ é€’ä¼šç›¸å¯¹å®‰å…¨ã€‚\n\nä¸€ç»„æ¯”è¾ƒå¥½çš„ä½¿ç”¨æ¡ˆä¾‹ï¼š\n\n- å‘Šè¯‰ä¸‹ä¸ªé¡µé¢ä½ è·³è½¬è‡ªå“ªé‡Œï¼Œä»¥æ­¤æ¥åŠ¨æ€å¸ƒå±€UIã€‚ç”¨çš„æœ€å¤šçš„ä¾‹å­æ˜¯ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªitemï¼Œç„¶åæ‰“å¼€ä¸€ä¸ªå¼¹çª—æ˜¾ç¤ºè¯¦ç»†è®°å½•çš„ä½¿ç”¨åœºæ™¯ã€‚å¦‚æœä½ æƒ³ç›´æ¥æ˜¾ç¤ºåˆ°URLçš„è¯ï¼Œï¼ˆè¯‘è€…è®¤ä¸ºæ˜¯è¯¦æƒ…é¡µé¢å¯ä»¥å¼¹çª—æ˜¾ç¤ºåˆå¯ä»¥é¡µé¢æ˜¾ç¤ºçš„æ„æ€ï¼‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥è‡ªå®šä¹‰å¸ƒå±€ç»„ä»¶æ¥æ˜¾ç¤ºã€‚\n- ä¼ é€’é¡µé¢è®°å½•ä¿¡æ¯çš„ä¸€éƒ¨åˆ†ç»™è¦è·³è½¬çš„é¡µé¢ï¼Œé‚£ä¹ˆä¸‹ä¸ªé¡µé¢ä¼šç›´æ¥å°†è¿™ä¸€éƒ¨åˆ†æ¸²æŸ“å‡ºæ¥ï¼Œè¿›è€Œå¯ä»¥å€ŸåŠ©å·²æœ‰ä¿¡æ¯æ¸²æŸ“å‰©ä½™éƒ¨åˆ†ã€‚\n\nä»£ç å®ç°ä¸Šï¼Œå¯ä»¥ä½¿ç”¨`\u003cLink\u003e`æˆ–è€…`navigate`æ¥å®ç°æ”¹å˜stateï¼š\n\n```jsx\n\u003cLink to=\"/pins/123\" state={{ fromDashboard: true }} /\u003e;\n\nlet navigate = useNavigate();\nnavigate(\"/users/123\", { state: partialUser });\n```\n\nåœ¨è·³è½¬åçš„é¡µé¢ä¸­ä½¿ç”¨`useLocation`è·å–è·¯ç”±ä¿¡æ¯ï¼š\n\n```js\nlet location = useLocation();\nlocation.state;\n```\n\n\u003e location.stateæ˜¯ä¸€ä¸ªåºåˆ—åŒ–çš„å€¼ï¼Œä½¿ç”¨new Date()ä¼ é€’æ—¶é—´æ—¶ï¼Œä¼šè¢«è½¬åŒ–ä¸ºå­—ç¬¦ä¸²\n\n##### Location Key\n\næ¯ä¸€ä¸ªlocationåˆæœ‰è‡ªå·±å”¯ä¸€çš„keyã€‚è¿™å¯¹äºé”šç‚¹æ»šåŠ¨å¼è·¯ç”±è·³è½¬. å®¢æˆ·ç«¯æ•°æ®ç¼“å­˜ç­‰æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚æ¯ä¸€ä¸ªlocationè·å–å”¯ä¸€keyåï¼Œä½ éƒ½å¯ä»¥ä½¿ç”¨æ‰å¹³åŒ–æ•°ç»„. new Map()ï¼Œç”šè‡³æ˜¯locationStorageæ¥å°†å¯¹åº”ä¿¡æ¯æŠ½è±¡å‡ºæ¥ã€‚\n\nä¸¾ä¸ªğŸŒ°ï¼Œåœ¨ä¸€ä¸ªå•ä¸€çš„å®¢æˆ·ç«¯ï¼Œä¸è¯·æ±‚åç«¯æ•°æ®ï¼Œåœ¨ç”¨æˆ·ç‚¹å‡»åé€€æŒ‰é’®æ—¶ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹è®¾ç½®æ¥å­˜å‚¨è·¯ç”±ç¼“å­˜ï¼š\n\n```js\nlet cache = new Map();\n\nfunction useFakeFetch(URL) {\n  let location = useLocation();\n  let cacheKey = location.key + URL;\n  let cached = cache.get(cacheKey);\n\n  let [data, setData] = useState(() =\u003e {\n    // initialize from the cache\n    return cached || null;\n  });\n\n  let [state, setState] = useState(() =\u003e {\n    // avoid the fetch if cached\n    return cached ? \"done\" : \"loading\";\n  });\n\n  useEffect(() =\u003e {\n    if (state === \"loading\") {\n      let controller = new AbortController();\n      fetch(URL, { signal: controller.signal })\n        .then((res) =\u003e res.json())\n        .then((data) =\u003e {\n          if (controller.signal.aborted) return;\n          // set the cache\n          cache.set(cacheKey, data);\n          setData(data);\n        });\n      return () =\u003e controller.abort();\n    }\n  }, [state, cacheKey]);\n\n  useEffect(() =\u003e {\n    setState(\"loading\");\n  }, [URL]);\n\n  return data;\n}\n```\n\n### Matching\n\nåœ¨é¡µé¢åˆå§‹åŒ–æ¸²æŸ“å’Œhistory stackå˜åŒ–æ—¶ï¼ŒReact Routerä¼šé’ˆå¯¹è·¯ç”±é…ç½®é¡¹æ¥åŒ¹é…å‡ºä¸€å¥—æ¸²æŸ“ç»“æ„ã€‚\n\n#### Defining Routes\n\nè·¯ç”±é…ç½®ç±»ä¼¼ä¸€ä¸ªå±‚çº§æ ‘ï¼Œå°±åƒä¸‹é¢çš„ä¾‹å­ï¼š\n\n\n```jsx\n\u003cRoutes\u003e\n  \u003cRoute path=\"/\" element={\u003cApp /\u003e}\u003e\n    \u003cRoute index element={\u003cHome /\u003e} /\u003e\n    \u003cRoute path=\"teams\" element={\u003cTeams /\u003e}\u003e\n      \u003cRoute path=\":teamId\" element={\u003cTeam /\u003e} /\u003e\n      \u003cRoute path=\":teamId/edit\" element={\u003cEditTeam /\u003e} /\u003e\n      \u003cRoute path=\"new\" element={\u003cNewTeamForm /\u003e} /\u003e\n      \u003cRoute index element={\u003cLeagueStandings /\u003e} /\u003e\n    \u003c/Route\u003e\n  \u003c/Route\u003e\n  \u003cRoute element={\u003cPageLayout /\u003e}\u003e\n    \u003cRoute path=\"/privacy\" element={\u003cPrivacy /\u003e} /\u003e\n    \u003cRoute path=\"/tos\" element={\u003cTos /\u003e} /\u003e\n  \u003c/Route\u003e\n  \u003cRoute path=\"contact-us\" element={\u003cContact /\u003e} /\u003e\n\u003c/Routes\u003e\n```\n\n`\u003cRoutes\u003e`é€’å½’åœ°æ¸²æŸ“åŒ¹é…åˆ°çš„`props.children`ï¼Œæå–ä»–ä»¬çš„propså¹¶ç”Ÿæˆå¦‚ä¸‹çš„ç»“æ„ï¼š\n\n\n```jsx\nlet routes = [\n  {\n    element: \u003cApp /\u003e,\n    path: \"/\",\n    children: [\n      {\n        index: true,\n        element: \u003cHome /\u003e,\n      },\n      {\n        path: \"teams\",\n        element: \u003cTeams /\u003e,\n        children: [\n          {\n            index: true,\n            element: \u003cLeagueStandings /\u003e,\n          },\n          {\n            path: \":teamId\",\n            element: \u003cTeam /\u003e,\n          },\n          {\n            path: \":teamId/edit\",\n            element: \u003cEditTeam /\u003e,\n          },\n          {\n            path: \"new\",\n            element: \u003cNewTeamForm /\u003e,\n          },\n        ],\n      },\n    ],\n  },\n  {\n    element: \u003cPageLayout /\u003e,\n    children: [\n      {\n        element: \u003cPrivacy /\u003e,\n        path: \"/privacy\",\n      },\n      {\n        element: \u003cTos /\u003e,\n        path: \"/tos\",\n      },\n    ],\n  },\n  {\n    element: \u003cContact /\u003e,\n    path: \"/contact-us\",\n  },\n];\n```\n\näº‹å®ä¸Šï¼Œä½ å¯ä»¥ä¸ä½¿ç”¨`\u003cRoutes\u003e`ï¼Œä½¿ç”¨hook `useRoutes(routesGoHere)`ä¾ç„¶å¯ä»¥å®Œæˆä¸Šè¿°ä»»åŠ¡ã€‚å¦‚ä½ æ‰€è§ï¼Œè·¯ç”±å®šä¹‰ä¸­ï¼Œå¯ä»¥å£°æ˜å¤šé‡è·¯ç”±ç‰‡æ®µï¼Œæ¯”å¦‚`:itemId/edit`ï¼Œä¹Ÿå¯ä»¥å£°æ˜å•ä¸ªç‰‡æ®µï¼Œæ¯”å¦‚`:itemId`ã€‚æ‰€æœ‰çš„ç‰‡æ®µä¼šè¢«ç»„åˆåœ¨ä¸€ä¸ªæ¥æ„å»ºæœ€åçš„è·¯å¾„æ¨¡å¼ï¼ˆè·¯ç”±æ ‘ï¼‰ã€‚\n\n#### Match Params\n\nä»¥`/items/:itemId`è¿™ç§åŠ¨æ€è·¯ç”±ç‰‡æ®µä¸ºä¾‹ï¼Œä»–å¯ä¸æ˜¯é™æ€åŒ¹é…URLçš„ï¼Œä»»ä½•çš„å€¼ä¼¼ä¹éƒ½å¯ä»¥å½“åš`:itemId`æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚`/items/123`å’Œ`/items/å°è‚šè‚šè‚šè‚šè‚šå“¦`ã€‚è§£æå‡ºæ¥çš„å€¼å°±æ˜¯`URL params`ã€‚åœ¨æ¸²æŸ“ä¸€èŠ‚ï¼ˆRenderingï¼‰ä¼šè®²è¿°æ€ä¹ˆç”¨è¿™ä¸ªå‚æ•°ã€‚\n\n#### Ranking Routes\n\nå½“æˆ‘ä»¬è®¾ç½®å®Œè·¯ç”±é…ç½®åï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šå¾—åˆ°è¯¸å¦‚å¦‚ä¸‹çš„åŒ¹é…æ¨¡å¼ï¼š\n\n\n```js\n[\n  \"/\",\n  \"/teams\",\n  \"/teams/:teamId\",\n  \"/teams/:teamId/edit\",\n  \"/teams/new\",\n  \"/privacy\",\n  \"/tos\",\n  \"/contact-us\",\n];\n```\n\näº‹æƒ…å˜å¾—çªç„¶èŒƒç‰¹è¥¿èµ·æ¥ï¼Œä»¥è¯·æ±‚path `\"/teams/new\"`ä¸ºä¾‹ï¼Œä¸Šè¿°åˆ—è¡¨ä¸­å“ªä¸€ä¸ªåŒ¹é…æ¨¡å¼èƒ½å¤Ÿè¢«ç¿»ç‰Œå­ï¼Ÿæˆ‘çŒœæœ‰ä¸¤ä¸ªï¼š\n\n\n```\n/teams/new\n/teams/:teamId\n```\n\næ­¤æ—¶ï¼ŒReact Routerå°±éœ€è¦åšå‡ºæœ€ç»ˆå†³å®šï¼Œåˆ°åº•ç¿»å“ªä¸€ä¸ªçš„ç‰Œå­ï¼Œå¤§å¤šæ•°è·¯ç”±éƒ½ä¼šæŒ‰ç…§ä»–ä»¬å®šä¹‰çš„å…ˆåé¡ºåºè¿›è¡ŒåŒ¹é…ï¼Œå…ˆåˆ°å…ˆå¾—ã€‚ä½†æ˜¯ä½¿ç”¨è¿™ç§ç®—æ³•ï¼Œæˆ‘ä»¬è¿`/`éƒ½èƒ½åŒ¹é…åˆ°äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥æ›´åŠ å®Œç¾çš„æ’åºè¿™äº›åŒ¹é…æ¨¡å¼ï¼Œè¿›è€Œè¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„åŒ¹é…ç»“æœã€‚è¿™ä¹Ÿæ˜¯v6æ¯”è¾ƒæ™ºèƒ½çš„ä¸€ä¸ªä½“ç°ã€‚\n\nè¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç›´è§‚çš„æ„Ÿè§‰`/teams/new`åº”è¯¥æ˜¯æœ€ç»ˆçš„ç»“æœã€‚æˆ‘ä»¬æ‰€åšçš„å°±æ˜¯æ•™ä¼šäº†React Routerå»å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚åœ¨åŒ¹é…çš„è¿‡ç¨‹ä¸­ï¼ŒReact Routerä¼šæŒ‰ç…§ç‰‡æ®µåºå·è¿›è¡Œæ’åºï¼ˆåŒ…æ‹¬é™æ€çš„. åŠ¨æ€çš„å’Œæ˜Ÿå·ç‰‡æ®µç­‰ï¼‰ï¼ŒæŒ‘é€‰æœ€é€‚åˆçš„åŒ¹é…æ¨¡å¼ï¼Œè€Œå¯¹äºå¼€å‘è€…ï¼Œå†ä¹Ÿä¸ç”¨è€ƒè™‘è·¯ç”±é…ç½®çš„å…ˆåæ”¾ç½®é¡ºåºäº†ã€‚\n\n#### Pathless Routes\n\nè¿˜æœ‰ä¸€äº›ä¸å¸¦pathçš„è·¯ç”±ï¼š\n\n```html\n\u003cRoute index element={\u003cHome /\u003e} /\u003e\n\u003cRoute index element={\u003cLeagueStandings /\u003e} /\u003e\n\u003cRoute element={\u003cPageLayout /\u003e} /\u003e\n```\n\nå¯¹äºè¿™ç§æˆ‘ä»¬æ€ä¹ˆåŒ¹é…å‘¢ï¼ŸReact Routerçš„åŒ¹é…æ—¶ç›¸å½“å®½æ¾çš„ï¼Œ`\u003cLeagueStandings /\u003e`å’Œ`\u003cHome /\u003e`ç»„ä»¶æ˜¯indexè·¯ç”±ï¼Œ`\u003cPageLayout /\u003e`æ˜¯å¸ƒå±€è·¯ç”±ï¼Œæˆ‘ä»¬åœ¨æ¸²æŸ“ï¼ˆRenderingï¼‰è¿™ä¸€èŠ‚æ¥è®¨è®ºä»–æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Œè¿™ä¸¤è€…éƒ½ä¸åŒ¹é…æœ¬èº«æ²¡æœ‰å¤šå¤§å…³ç³»ã€‚\n\n\n#### Route Matches\n\nå½“è·¯ç”±å»åŒ¹é…URLæ—¶ï¼Œå†…éƒ¨éƒ½ä¼šè½¬åŒ–ä¸€ä¸ªåŒ¹é…å¯¹è±¡ï¼Œä»¥`\u003cRoute path=\":teamId\" element={\u003cTeam/\u003e}/\u003e`ä¸ºä¾‹ï¼š\n \n```jsx\n{\n  pathname: \"/teams/firebirds\",\n  params: {\n    teamId: \"firebirds\"\n  },\n  route: {\n    element: \u003cTeam /\u003e,\n    path: \":teamId\"\n  }\n}\n```\n\npathnameæ˜¯URLéƒ¨åˆ†ï¼Œä»£è¡¨çš„æ˜¯å…¨é‡è·¯å¾„ï¼›paramsæ˜¯é€šè¿‡URLè§£ææ¥çš„æš‚æ€è·¯ç”±å‚æ•°ï¼Œ`:teamId`å³ä¸º`params.teamId`ã€‚\n\nå› ä¸ºè·¯ç”±è¡¨æ˜¯ä¸€æ£µæ ‘ï¼Œå•ä¸ªURLå¯èƒ½ä¼šåŒ¹é…ä¹¦ä¸Šçš„å¤šä¸ªåˆ†æ”¯ï¼Œä»¥`/teams/firebirds`ä¸ºä¾‹ï¼š\n\n\n```diff \n\u003cRoutes\u003e\n+   \u003cRoute path=\"/\" element={\u003cApp /\u003e}\u003e\n    \u003cRoute index element={\u003cHome /\u003e} /\u003e\n+   \u003cRoute path=\"teams\" element={\u003cTeams /\u003e}\u003e\n+     \u003cRoute path=\":teamId\" element={\u003cTeam /\u003e} /\u003e\n      \u003cRoute path=\":teamId/edit\" element={\u003cEditTeam /\u003e} /\u003e\n      \u003cRoute path=\"new\" element={\u003cNewTeamForm /\u003e} /\u003e\n      \u003cRoute index element={\u003cLeagueStandings /\u003e} /\u003e\n    \u003c/Route\u003e\n  \u003c/Route\u003e\n  \u003cRoute element={\u003cPageLayout /\u003e}\u003e\n    \u003cRoute path=\"/privacy\" element={\u003cPrivacy /\u003e} /\u003e\n    \u003cRoute path=\"/tos\" element={\u003cTos /\u003e} /\u003e\n  \u003c/Route\u003e\n  \u003cRoute path=\"contact-us\" element={\u003cContact /\u003e} /\u003e\n\u003c/Routes\u003e\n```\né«˜äº®éƒ¨åˆ†æ˜¯ä»–çš„åŒ¹é…è·¯å¾„ã€‚React Routerä¼šåˆ›å»ºä¸€ä¸ªåŒ¹é…æ•°ç»„æ¥å­˜æ”¾åµŒå¥—çš„åŒ¹é…è·¯ç”±ï¼Œæ‰€ä»¥ä¼šç”Ÿæˆä¸€ä¸ªåµŒå¥—çš„UIç»“æ„ï¼š\n\n```jsx\n[\n  {\n    pathname: \"/\",\n    params: null,\n    route: {\n      element: \u003cApp /\u003e,\n      path: \"/\",\n    },\n  },\n  {\n    pathname: \"/teams\",\n    params: null,\n    route: {\n      element: \u003cTeams /\u003e,\n      path: \"teams\",\n    },\n  },\n  {\n    pathname: \"/teams/firebirds\",\n    params: {\n      teamId: \"firebirds\",\n    },\n    route: {\n      element: \u003cTeam /\u003e,\n      path: \":teamId\",\n    },\n  },\n];\n```\n\n### Rendering\n\næœ€åçš„é‡å¤´æˆï¼Œåœ¨æ‹¿åˆ°åŒ¹é…æ•°åï¼Œè¦å¦‚ä½•è¿›è¡Œæ¸²æŸ“å‘¢ï¼Ÿè€ƒè™‘å¦‚ä¸‹çš„ç»“æ„ï¼š\n\n\n```jsx\n// react 18+\nconst root = ReactDOM.createRoot(\n  document.getElementById(\"root\")\n);\nroot.render(\n  \u003cBrowserRouter\u003e\n    \u003cRoutes\u003e\n      \u003cRoute path=\"/\" element={\u003cApp /\u003e}\u003e\n        \u003cRoute index element={\u003cHome /\u003e} /\u003e\n        \u003cRoute path=\"teams\" element={\u003cTeams /\u003e}\u003e\n          \u003cRoute path=\":teamId\" element={\u003cTeam /\u003e} /\u003e\n          \u003cRoute path=\":teamId/edit\" element={\u003cEditTeam /\u003e} /\u003e\n          \u003cRoute path=\"new\" element={\u003cNewTeamForm /\u003e} /\u003e\n          \u003cRoute index element={\u003cLeagueStandings /\u003e} /\u003e\n        \u003c/Route\u003e\n      \u003c/Route\u003e\n      \u003cRoute element={\u003cPageLayout /\u003e}\u003e\n        \u003cRoute path=\"/privacy\" element={\u003cPrivacy /\u003e} /\u003e\n        \u003cRoute path=\"/tos\" element={\u003cTos /\u003e} /\u003e\n      \u003c/Route\u003e\n      \u003cRoute path=\"contact-us\" element={\u003cContact /\u003e} /\u003e\n    \u003c/Routes\u003e\n  \u003c/BrowserRouter\u003e\n);\n```\n\næˆ‘ä»¬ä½¿ç”¨è®¿é—®è·¯å¾„`/teams/firebirds`ä½œä¸ºä¾‹å­æ¥è§£é‡Šå¦‚ä½•æ¸²æŸ“è·¯ç”±ã€‚`\u003cRoutes\u003e`ä¼šè¯†åˆ«é…ç½®é¡¹ï¼Œé€šè¿‡ç²¾å‡†åŒ¹é…ååœ¨é¡µé¢ä¸Šæ„å»ºå¦‚ä¸‹ç»“æ„ï¼š\n\n```jsx\n\u003cApp\u003e\n  \u003cTeams\u003e\n    \u003cTeam /\u003e\n  \u003c/Teams\u003e\n\u003c/App\u003e\n```\n\næ¯ä¸€çº§åŒ¹é…é¡¹éƒ½æ”¾ç½®åœ¨å…¶çˆ¶è·¯ç”±å…ƒç´ ä¸­ï¼Œæœ€ç»ˆæ¸²æŸ“çš„ç»“æ„ä¸è·¯ç”±é…ç½®æ–‡ä»¶å®Œå…¨ä¸€æ ·ã€‚å¤§å¤šæ•°çš„ç½‘ç«™å’Œappéƒ½æœ‰è¿™æ ·çš„ç‰¹æ€§ï¼šå¥—å¨ƒå¼æ”¾ç½®å…ƒç´ ï¼Œæ¯ä¸€çº§å…ƒç´ éƒ½ä¼šæœ‰è‡ªå·±çš„å¯¼èˆªæ¥æ›´æ”¹è‡ªå·±çš„å­é¡µé¢å†…å®¹ã€‚\n\n#### Outlets\n\nåµŒå¥—å…ƒç´ æ ‘ä¸ä¼šè‡ªåŠ¨æ¸²æŸ“ï¼Œéœ€è¦ç”¨outletæ¥å‘Šè¯‰çˆ¶å…ƒç´ æ¸²æŸ“å­å…ƒç´ çš„åœ°æ–¹ã€‚`\u003cRoutes\u003e`ä¼šé¦–å…ˆæ¸²æŸ“å…ƒç´ æ ‘çš„é¡¶å±‚å…ƒç´ ï¼ˆæ¯”å¦‚`\u003cApp /\u003e`ï¼‰ï¼Œæ¥ä¸‹æ¥åŒ¹é…å…ƒç´ `\u003cTeams\u003e`ï¼š\n\n```jsx\nfunction App() {\n  return (\n    \u003cdiv\u003e\n      \u003cGlobalNav /\u003e\n      \u003cOutlet /\u003e\n      \u003cGlobalFooter /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nOutletç»„ä»¶ä¼šæ¸²æŸ“ä¸‹ä¸€ä¸ªmatchçš„å…ƒç´ ã€‚åŒç†ï¼Œ`\u003cTeams\u003e`ä¸­ä¹Ÿéœ€è¦ä¸€ä¸ªoutletæ¥æ¸²æŸ“`\u003cTeam /\u003e`ã€‚\n\nå¦‚æœURLæ˜¯`/contact-us`ï¼Œé‚£ä¹ˆå…ƒç´ æ ‘å°±ä¼šæ˜¯å¦‚ä¸‹ç»“æ„ï¼š\n```\n\u003cContact /\u003e\n```\nä»–æ²¡æœ‰åœ¨Appç»„ä»¶ä¹‹ä¸‹ï¼Œæ‰€ä»¥ä¼šå•ç‹¬æŒ‰ç…§è·¯ç”±å±‚çº§ç»“æ„æ¸²æŸ“ã€‚\n\nå¦‚æœURLæ˜¯`/teams/firebirds/edit`ï¼Œå…ƒç´ æ ‘ä¼šå˜æˆï¼š\n\n```jsx\n\u003cApp\u003e\n  \u003cTeams\u003e\n    \u003cEditTeam /\u003e\n  \u003c/Teams\u003e\n\u003c/App\u003e\n```\n\nOutletæ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œè¢«åŒ¹é…åˆ°åä¼šæ›¿æ¢ä¸ºåŒ¹é…çš„å­å…ƒç´ ï¼Œè€Œçˆ¶çº§å…ƒç´ ä¸ä¼šå˜åŒ–ã€‚\n\n\n#### Index Routes\n\nå¯¹äºå¦‚ä¸‹çš„è·¯ç”±é…ç½®ï¼š\n\n```jsx\n\u003cRoute path=\"teams\" element={\u003cTeams /\u003e}\u003e\n  \u003cRoute path=\":teamId\" element={\u003cTeam /\u003e} /\u003e\n  \u003cRoute path=\"new\" element={\u003cNewTeamForm /\u003e} /\u003e\n  \u003cRoute index element={\u003cLeagueStandings /\u003e} /\u003e\n\u003c/Route\u003e\n```\nå¦‚æœè®¿é—®è·¯å¾„`/teams/firebirds`ï¼Œé‚£ä¹ˆå…ƒç´ æ ‘å°±ä¼šæ˜¯å¦‚ä¸‹ç»“æ„ï¼š\n\n```jsx\n\u003cApp\u003e\n  \u003cTeams\u003e\n    \u003cTeam /\u003e\n  \u003c/Teams\u003e\n\u003c/App\u003e\n```\nä½†æ˜¯ï¼Œå¦‚æœè®¿é—®è·¯å¾„æ˜¯`/teams`ï¼Œé‚£ä¹ˆå…ƒç´ æ ‘å°±ä¼šæ˜¯ï¼š\n```jsx\n\u003cApp\u003e\n  \u003cTeams\u003e\n    \u003cLeagueStandings /\u003e\n  \u003c/Teams\u003e\n\u003c/App\u003e\n```\nè¿™é‡Œçš„ä¼˜å…ˆçº§æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿä¸ºä»€ä¹ˆå£°æ˜äº†indexå°±èƒ½å¤Ÿä¼˜å…ˆè¢«popå‡ºæ¥ï¼Ÿä»–ç”šè‡³éƒ½æ²¡æœ‰pathï¼å¾ˆæ˜¾ç„¶ï¼Œä¸æ˜¯é€šè¿‡pathçš„åŒ¹é…é€»è¾‘æ¥çš„ã€‚è¿™é‡Œä½¿ç”¨äº†ç‰¹æ®Šçš„index routesï¼ŒåŒæ ·æ˜¯æ¸²æŸ“åœ¨çˆ¶ç»„ä»¶ä¸‹çš„outletçš„ä½ç½®ã€‚è¿™é‡Œå¦‚æœä¸è®¾ç½®indexè·¯ç”±çš„è¯ï¼Œä»…ä»…è®¿é—®`/teams`ï¼Œæ¸²æŸ“çš„å…ƒç´ æ ‘ä¼šæ˜¯ä¸‹é¢è¿™æ ·ï¼š\n```jsx\n\u003cApp\u003e\n  \u003cTeams /\u003e\n\u003c/App\u003e\n```\n\nå¦‚æœteamsè·¯ç”±è¢«æ˜¾ç¤ºåœ¨å·¦ä¾§çš„ç›®å½•æ ‘ä¸‹æ—¶ï¼Œnameé¡µé¢å³ä¾§å°±ä¼šæ˜¯ç©ºç™½é¡µäº†ï¼éœ€è¦é»˜è®¤çš„é¡µé¢ç»„ä»¶æ¥å¡«å……ã€‚æ¢å¥è¯è¯´ï¼Œindexè·¯ç”±å°±æ˜¯åœ¨æ‰€æœ‰childæ²¡æœ‰åŒ¹é…çš„æ—¶å€™ç»™å‡ºçš„é»˜è®¤æ¸²æŸ“æ–¹æ¡ˆã€‚\n\n\næ ¹æ®ä¸šåŠ¡éœ€æ±‚çš„ä¸åŒï¼Œå¯èƒ½ä¼šéœ€è¦ä¸åŒçš„è·¯ç”±ç»“æ„ã€‚ä¸ç®¡çˆ¶è·¯ç”±ä¸‹çš„å­è·¯ç”±å¦‚ä½•æ’åºï¼Œæ€»æ˜¯æ— æ³•é¿å…ç”¨æˆ·ä¼šç›´æ¥è®¿é—®çˆ¶è·¯ç”±çš„è·¯å¾„ï¼Œå¦‚æœçˆ¶è·¯ç”±ä¸­ç”¨äº†outletçš„è¯å°±ä¼šäº§ç”Ÿç©ºç™½é¡µï¼Œindexå°±æ˜¯ç”¨æ¥å¡«å……ç©ºç™½çš„ï¼ˆ**è¯‘è€…**ï¼šä½œè€…çš„æè¿°æœ‰ä¸€äº›ç¹çï¼Œå…¶å®å°±æ˜¯ä¸€å¥è¯ï¼šé»˜è®¤è·¯ç”±ä½œä¸ºç©ºç™½å¡«å……ç‰©ï¼‰ã€‚\n\n\u003e æˆ‘å‘ç°React Routerçš„å®˜ç½‘è‡ªå·±æœ¬èº«å°±æ²¡æœ‰åšçš„å¾ˆå¥½ï¼ŒIndexæ˜¯ä¸æ˜¯å¿˜äº†\n\n![image.png](/img/posts/2022-6-7/2022-6-7-1.png)\n\n#### Layout Routes\n\nè€ƒè™‘å¦‚ä¸‹é«˜äº®éƒ¨åˆ†çš„è·¯å¾„ï¼š\n\n```diff\n\u003cRoutes\u003e\n+ \u003cRoute path=\"/\" element={\u003cApp /\u003e}\u003e\n    \u003cRoute index element={\u003cHome /\u003e} /\u003e\n    \u003cRoute path=\"teams\" element={\u003cTeams /\u003e}\u003e\n      \u003cRoute path=\":teamId\" element={\u003cTeam /\u003e} /\u003e\n      \u003cRoute path=\":teamId/edit\" element={\u003cEditTeam /\u003e} /\u003e\n      \u003cRoute path=\"new\" element={\u003cNewTeamForm /\u003e} /\u003e\n      \u003cRoute index element={\u003cLeagueStandings /\u003e} /\u003e\n    \u003c/Route\u003e\n  \u003c/Route\u003e\n+ \u003cRoute element={\u003cPageLayout /\u003e}\u003e\n+   \u003cRoute path=\"/privacy\" element={\u003cPrivacy /\u003e} /\u003e\n    \u003cRoute path=\"/tos\" element={\u003cTos /\u003e} /\u003e\n  \u003c/Route\u003e\n  \u003cRoute path=\"contact-us\" element={\u003cContact /\u003e} /\u003e\n\u003c/Routes\u003e\n```\n\nä»–çš„æ¸²æŸ“å…ƒç´ æ ‘æ˜¯ï¼š\n```jsx\n\u003cApp\u003e\n  \u003cPageLayout\u003e\n    \u003cPrivacy /\u003e\n  \u003c/PageLayout\u003e\n\u003c/App\u003e\n```\nå¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªå¹¶åˆ—çš„`\u003cRoute\u003e`ç«Ÿç„¶æ¸²æŸ“å‡ºäº†åŒ…å«å…³ç³»ã€‚è¿™ç§æƒ…å†µçš„å‡ºç°åªæ˜¯ä¸ºäº†ç®€åŒ–åœ¨åŒä¸€ä¸ªå¸ƒå±€ä¸­å¤šé‡å­è·¯ç”±\nåµŒå¥—çš„å…³ç³»ã€‚ä¸è¿‡ç¦ç”¨è¿™ç§åˆå¹¶ï¼Œåˆä¸æƒ³æ— é™åˆ¶åµŒå¥—ä¸‹å»çš„è¯ï¼Œå°±å¾—éœ€è¦æ¯”è¾ƒç¹ççš„é…ç½®äº†ï¼Œå¯èƒ½ä¼šå‡ºç°å¤§é‡é‡å¤çš„ç»„ä»¶ï¼š\n\n\u003e ä¸å»ºè®®è¿™æ ·å†™å“¦\n\n```jsx\n\u003cRoutes\u003e\n  \u003cRoute path=\"/\" element={\u003cApp /\u003e}\u003e\n    \u003cRoute index element={\u003cHome /\u003e} /\u003e\n    \u003cRoute path=\"teams\" element={\u003cTeams /\u003e}\u003e\n      \u003cRoute path=\":teamId\" element={\u003cTeam /\u003e} /\u003e\n      \u003cRoute path=\":teamId/edit\" element={\u003cEditTeam /\u003e} /\u003e\n      \u003cRoute path=\"new\" element={\u003cNewTeamForm /\u003e} /\u003e\n      \u003cRoute index element={\u003cLeagueStandings /\u003e} /\u003e\n    \u003c/Route\u003e\n  \u003c/Route\u003e\n  \u003cRoute\n    path=\"/privacy\"\n    element={\n      \u003cPageLayout\u003e\n        \u003cPrivacy /\u003e\n      \u003c/PageLayout\u003e\n    }\n  /\u003e\n  \u003cRoute\n    path=\"/tos\"\n    element={\n      \u003cPageLayout\u003e\n        \u003cTos /\u003e\n      \u003c/PageLayout\u003e\n    }\n  /\u003e\n  \u003cRoute path=\"contact-us\" element={\u003cContact /\u003e} /\u003e\n\u003c/Routes\u003e\n```\næ‰€ä»¥ï¼Œå«ä»–å¸ƒå±€è·¯ç”±æœ‰ç‚¹é—®é¢˜ï¼Œå› ä¸ºä»–å¹¶ä¸ä¼šå»å‚ä¸åŒ¹é…URLï¼Œä»–åªæ˜¯ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨è€Œåšçš„ä¸€ç§è·¯ç”±åˆå¹¶è€Œå·²ã€‚\n\n\u003e æ’ä¸€å¥ï¼Œæ— é™åˆ¶åµŒå¥—å¯ä»¥è¿™ä¹ˆå†™ï¼Œä¸è¿‡è·¯å¾„ä¼šé•¿ä¸€äº›ï¼š/layout/privacy\n\n\n```jsx\n\u003cRoutes\u003e\n  \u003cRoute path=\"/\" element={\u003cApp /\u003e}\u003e\n    \u003cRoute index element={\u003cHome /\u003e} /\u003e\n    \u003cRoute path=\"teams\" element={\u003cTeams /\u003e}\u003e\n      \u003cRoute path=\":teamId\" element={\u003cTeam /\u003e} /\u003e\n      \u003cRoute path=\":teamId/edit\" element={\u003cEditTeam /\u003e} /\u003e\n      \u003cRoute path=\"new\" element={\u003cNewTeamForm /\u003e} /\u003e\n      \u003cRoute index element={\u003cLeagueStandings /\u003e} /\u003e\n    \u003c/Route\u003e\n    \n    // åµŒå¥—é…ç½®\n    \u003cRoute path=\"layout\" element={\u003cPageLayout /\u003e}\u003e\n      \u003cRoute path=\"privacy\" element={\u003cPrivacy /\u003e} /\u003e\n      \u003cRoute path=\"tos\" element={\u003cTos /\u003e} /\u003e\n    \u003c/Route\u003e\n  \u003c/Route\u003e\n\u003c/Routes\u003e\n```\n\n### Navigating\n\nURLå˜åŒ–çš„è¿™ä¸ªåŠ¨ä½œå«åšå¯¼èˆªï¼ˆnavigationï¼‰ï¼Œåœ¨React Routerä¸­æœ‰ä¸¤ç§æ–¹æ³•ï¼š\n\n- `\u003cLink\u003e`\n- `navigate`\n\n#### Link\n\nè·¯ç”±å¯¼èˆªçš„ä¸»è¦æ–¹å¼ã€‚å½“ç”¨æˆ·ç‚¹å‡»æ”¹æ ‡ç­¾æ—¶ä¾¿ä¼šè§¦å‘æ“ä½œã€‚React Routerä¼šé˜»æ­¢æµè§ˆå™¨é»˜è®¤çš„äº‹ä»¶è¡Œä¸ºï¼Œå¹¶ä¸”å‘historyå †æ ˆä¸­pushä¸€ä¸ªæ–°çš„çŠ¶æ€ã€‚ç»§è€Œè§¦å‘locationçš„å˜åŒ–å’Œè·¯ç”±åŒ¹é…å…ƒç´ çš„æ¸²æŸ“ã€‚\n\nç„¶è€Œï¼Œlinkæœ‰å±€é™æ€§ï¼š\n\n- ä»ç„¶æ˜¯æ¸²æŸ“ä¸€ä¸ªaæ ‡ç­¾ï¼ˆå› æ­¤é”®ç›˜æ“ä½œ. å¯èšç„¦å’ŒSEOå¯ä»¥ä½¿ç”¨ï¼‰\n- æ²¡æœ‰é˜»æ­¢æµè§ˆå™¨çš„é»˜è®¤è¡Œä¸ºï¼Œæ¯”å¦‚å³é”®ç‚¹å‡»æˆ–è€…æŒ‰ä½ctrlåæ–°å»ºä¸€ä¸ªtabé¡µç­¾ã€‚\n\nåµŒå¥—è·¯ç”±ä¸ä»…ä»…æ˜¯æ¸²æŸ“å¸ƒå±€ï¼Œä»–ä¹Ÿèƒ½å¤„ç†ç›¸å¯¹è·¯ç”±ã€‚è¿˜æ‹¿ä¹‹å‰çš„ä¾‹å­ï¼š\n\n```jsx\n\u003cRoute path=\"teams\" element={\u003cTeams /\u003e}\u003e\n  \u003cRoute path=\":teamId\" element={\u003cTeam /\u003e} /\u003e\n\u003c/Route\u003e\n```\n\nåœ¨`\u003cTeams\u003e`ä¸­å¯ä»¥è¿™æ ·å†™ï¼š\n```jsx\n\u003cLink to=\"psg\" /\u003e\n\u003cLink to=\"new\" /\u003e\n```\nä»–ä»¬çš„è·¯å¾„å…¨ç¨‹æ˜¯`/teams/psg`Â å’ŒÂ `/teams/new`ï¼Œå¯ä»¥çœ‹åˆ°ä»–ä»¬ç»§æ‰¿äº†çˆ¶è·¯ç”±ä½œä¸ºå‰ç¼€ï¼Œå› æ­¤è·¯ç”±ç»„ä»¶ä¸éœ€è¦çœŸçš„çŸ¥é“å‰©ä½™çš„è·¯ç”±ä¿¡æ¯ã€‚å› æ­¤è·¯ç”±é…ç½®ä¼šéå¸¸çµæ´»ï¼Œå¯¹äºè¶Šæ¥è¶Šå¤æ‚çš„appï¼Œéœ€æ±‚å’Œè®¾è®¡éƒ½åœ¨ä¸åœçš„å˜åŒ–æ—¶ï¼Œè¿™ä¼šå¤§å¤§å‡å°‘å¼€å‘è€…çš„ç—›è‹¦ã€‚\n\n#### Navigate Function\n\nå¦ä¸€ç§æ–¹å¼ï¼Œå¿…é¡»åœ¨å‡½æ•°å¼ç»„ä»¶ï¼ˆRFCï¼‰ä¸­ä½¿ç”¨ï¼Œä½¿ç”¨`useNavigate`é’©å­è·å–navigateå‡½æ•°ï¼š\n```jsx\nlet navigate = useNavigate();\nuseEffect(() =\u003e {\n  setTimeout(() =\u003e {\n    navigate(\"/logout\");\n  }, 30000);\n}, []);\n```\n\nåœ¨formçš„æäº¤äº‹ä»¶ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼š\n\n```jsx\n\u003cform onSubmit={event =\u003e {\n  event.preventDefault();\n  let data = new FormData(event.target)\n  let urlEncoded = new URLSearchParams(data)\n  navigate(\"/create\", { state: urlEncoded })\n}} /\u003e\n```\n\nä»–å’Œlinkä¸­çš„toä½¿ç”¨æ–¹å¼æ˜¯ç±»ä¼¼çš„ã€‚ä½ å¯ä»¥ç”¨å®ƒæ›¿ä»£linkæ ‡ç­¾ï¼š\n\n```jsx\n\u003cli onClick={() =\u003e navigate(\"/somewhere\")} /\u003e\n```\n\nä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé™¤äº†é“¾æ¥å’Œè¡¨å•ä»¥å¤–ï¼Œå¾ˆå°‘æœ‰äº¤äº’ä¼šæ”¹å˜URLï¼ˆ**è¯‘è€…è¯´**ï¼šæ”¾å±ï¼è·³ä¸è·³è½¬è¿˜ä¸æ˜¯è€æ¿ä¸€å¥è¯ï¼Ÿå›¾ç‰‡ï¼Œaudioï¼Œspanç­‰ç­‰ï¼Œåªè¦æ˜¯èƒ½æƒ³åˆ°çš„å…ƒç´ çš†å¯è·³è½¬ğŸ¶ ï¼‰ï¼Œå› ä¸ºä»–ä¼šå¢åŠ å¯è®¿é—®æ€§å’Œç”¨æˆ·äº¤äº’çš„å¤æ‚åº¦ã€‚\n\n### Data Access\n\nè·¯ç”±çš„æ•°æ®æ— éå°±æ˜¯å‚æ•°çš„è·å–ï¼Œå‚æ•°çš„ä¿®æ”¹ï¼Œå¦‚ä¸‹ä½¿ç”¨å³å¯ï¼š\n```jsx\nlet location = useLocation();\nlet urlParams = useParams();\nlet [urlSearchParams, setUrlSearchParams] = useSearchParams();\n```\n\n### Review\n\næ€»ç»“ï¼\n\n1. å†™ä¸€ä¸‹ä½ çš„Appï¼š\n\n```jsx\nconst root = ReactDOM.createRoot(\n  document.getElementById(\"root\")\n);\nroot.render(\n  \u003cBrowserRouter\u003e\n    \u003cRoutes\u003e\n      \u003cRoute path=\"/\" element={\u003cApp /\u003e}\u003e\n        \u003cRoute index element={\u003cHome /\u003e} /\u003e\n        \u003cRoute path=\"teams\" element={\u003cTeams /\u003e}\u003e\n          \u003cRoute path=\":teamId\" element={\u003cTeam /\u003e} /\u003e\n          \u003cRoute path=\"new\" element={\u003cNewTeamForm /\u003e} /\u003e\n          \u003cRoute index element={\u003cLeagueStandings /\u003e} /\u003e\n        \u003c/Route\u003e\n      \u003c/Route\u003e\n      \u003cRoute element={\u003cPageLayout /\u003e}\u003e\n        \u003cRoute path=\"/privacy\" element={\u003cPrivacy /\u003e} /\u003e\n        \u003cRoute path=\"/tos\" element={\u003cTos /\u003e} /\u003e\n      \u003c/Route\u003e\n      \u003cRoute path=\"contact-us\" element={\u003cContact /\u003e} /\u003e\n    \u003c/Routes\u003e\n  \u003c/BrowserRouter\u003e\n);\n```\n\n2. `\u003cBrowserRouter\u003e`åˆ›å»ºhistoryæ¨¡å¼çš„è·¯ç”±ï¼ˆåŸåœ°åˆ·æ–°é¡µé¢éœ€è¦åç«¯å¤„ç†è·³è½¬ï¼Œæˆ–è€…é…ç½®Nginxæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦è¯·æ±‚åç«¯ï¼‰ï¼ŒpushçŠ¶æ€å€¼ï¼Œå¹¶ä¸”è®¢é˜…URLå˜åŒ–ã€‚\n\n3. `\u003cRoutes\u003e`å®¹çº³å­è·¯ç”±ï¼Œå¹¶ä¸”åˆ›å»ºè·¯ç”±é…ç½®å¯¹è±¡ï¼Œé€šè¿‡å½“å‰è·¯å¾„æ¥åŒ¹é…å…·ä½“çš„è·¯ç”±å¹¶åˆ›å»ºåŒ¹é…çš„å…ƒç´ æ ‘ï¼Œæœ€åæ¸²æŸ“æœ€ä¼˜çš„åŒ¹é…ã€‚\n\n4. æ¯ä¸ªçˆ¶è·¯ç”±ä¸­åº”è¯¥æœ‰ä¸€ä¸ª`\u003cOutlet /\u003e`\n\n5. outletä¼šæ¸²æŸ“çˆ¶è·¯ç”±ä¸­åŒ¹é…åˆ°çš„ä¸‹ä¸€ä¸ªå­è·¯ç”±å…ƒç´ ã€‚\n\n6. ç”¨æˆ·ç‚¹å‡»Linkè¿›è¡Œè·³è½¬ã€‚\n\n7. ä¹Ÿå¯ä½¿ç”¨navigate()è¿›è¡Œè·³è½¬ã€‚\n\n8. historyä¿®æ”¹URLåä¼šé€šçŸ¥`\u003cBrowserRouter\u003e`ã€‚\n\n9. `\u003cBrowserRouter\u003e`æ”¶åˆ°é€šçŸ¥ï¼Œè§¦å‘åŒ¹é…å’Œæ¸²æŸ“ï¼Œé‡æ–°ä»ç¬¬2æ­¥å¼€å§‹ã€‚\n\nThat's all !\n\n\u003chr /\u003e\n\næ–‡ç« è¾ƒé•¿ï¼Œç¿»è¯‘ä¸æ˜“ï¼Œéƒ½çœ‹åˆ°è¿™é‡Œäº†ï¼Œè¦ä¸ç‚¹ä¸ªèµå†èµ°å‘—ğŸ¶ ~~"])</script><script>self.__next_f.push([1,"47:T24e7,"])</script><script>self.__next_f.push([1,"## 1. å‰è¨€\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ç»è¿‡å‰å‡ ç¯‡æ–‡ç« çš„è®²è¿°ï¼Œæˆ‘ä»¬çš„ç»„ä»¶åº“å·²ç»åˆå…·è§„æ¨¡ï¼š[æºç ](https://github.com/heiheihoho1213/dux-ui)ã€‚ç°åœ¨æˆ‘ä»¬è®²è¿°ä¸€ä¸‹å¦‚ä½•å‘å¸ƒåˆ°npmä¸Šï¼Œå¹¶ä¸”é…ç½®ä¸€ä¸‹gitee pages.\n\næœ¬æ–‡æœ€ç»ˆéƒ¨ç½²ä¸»é¡µæ•ˆæœï¼š[UIåº“ä¸»é¡µ](https://heiheihoho1213.github.io/dux-ui/)ã€‚\n\n## 2. ä½¿ç”¨Webpackæ‰“åŒ…é™æ€æ–‡ä»¶\n\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;é¦–å…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬é¡¹ç›®çš„ç›®å½•ç»“æ„ï¼š\n\n![image.png](/img/posts/2022-5-22/2022-5-22-3.png)\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å¯ä»¥çœ‹åˆ°ï¼Œæœ¬ç»„ä»¶çš„é™æ€æ–‡ä»¶æ¯”è¾ƒå°‘ï¼Œä»…ä»…åœ¨staticä¸­æ”¾ç½®äº†Iconçš„å­—ä½“æ ·å¼æ–‡ä»¶ï¼Œæˆ‘ä»¬æƒ³æŠŠé™æ€æ–‡ä»¶è·Ÿæºç æ–‡ä»¶åˆ†å¼€æ”¾ç½®ï¼Œæ–¹ä¾¿ä»¥åè¿ç§»ï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿æ ·å¼çš„æŒ‰éœ€å¼•å…¥ã€‚æ‰€ä»¥æˆ‘ä»¬å°±å…ˆæ¥æ‰“åŒ…staticã€‚\n\n### webpack.config.js\n\n1. è®¾ç½®å…¥å£\n\n\n```js\nentry: {\n    // webpackåªè´Ÿè´£icon/cssæ‰“åŒ…\n    icon: path.resolve(__dirname, './static/style/icon.css'),\n},\n```\n\n2. é…ç½®é™æ€èµ„æºå‡ºå£çš„è·¯å¾„\n\n```js\n output: {\n    // ä¸iconç›¸å…³çš„jsæ”¾åœ¨scripts\n    filename: 'scripts/[name].[contenthash].min.js',\n    // é™æ€èµ„æºï¼ˆå­—ä½“æ ·å¼æ–‡ä»¶ï¼‰æ”¾åœ¨assets\n    assetModuleFilename: 'assets/[contenthash][ext]',\n    // å‘å¸ƒçš„åŒ…å\n    library: 'dux-ui',\n    // ä½¿ç”¨umdæ¨¡å¼ï¼Œæé«˜å…¼å®¹æ€§\n    libraryTarget: 'umd',\n    // æ¯æ¬¡buildæ—¶æ¸…ç©ºoutputç›®å½•\n    clean: true,\n },\n```\n\n3. é…ç½®æ’ä»¶ - å‹ç¼©css\n\n```js\nconst cssPlugin = new MiniCssExtractPlugin({\n  // cssæ”¾åœ¨stylesæ–‡ä»¶å¤¹ä¸‹\n  filename: 'styles/[name].min.css',\n});\n\n...\nplugins: [cssPlugin],\n```\n\n4. é…ç½®loaderå…¼å®¹csså’Œå­—ä½“æ–‡ä»¶ï¼ˆé‡è¦ï¼‰\n\n```js\nmodule: {\n    rules: [\n      {\n        test: /static\\/style\\/icon\\.css$/,\n        use: [\n          // 1. webpack5ä¸­, ä½¿ç”¨MiniCssExtractPlugin.loaderä»£æ›¿style-loader\n          {\n            loader: MiniCssExtractPlugin.loader,\n          },\n          'css-loader',\n        ],\n      },\n      {\n        // 2. webpack5 é…ç½® - è¯†åˆ«å­—ä½“æ–‡ä»¶\n        test: /.(svg|eot|ttf|woff)$/,\n        type: 'asset/resource',\n      },\n    ],\n  },\n```\n\n5. é…ç½®æ‰“åŒ…çš„æ–‡ä»¶å¤¹æ ¹è·¯å¾„ä¸ºdistã€‚æ–°å»ºä¸€ä¸ª webpack.dist.config.jsï¼š\n\n\n```js\nconst path = require('path');\n\nconst config = require('./webpack.config');\n\nconfig.output.path = path.resolve(__dirname, 'dist');\n```\n\nè¿è¡Œè„šæœ¬ï¼š\n\n`NODE_ENV=production npm run build:webpack -- --config webpack.dist.config.js`\n\næŸ¥çœ‹é¡¹ç›®è·¯å¾„ä¸Šå¤šå‡ºçš„æ–‡ä»¶ï¼š\n\n![image.png](/img/posts/2022-5-22/2022-5-22-4.png)\n\næ‰“åŒ…æˆåŠŸï¼\n\n\n## 4. ä½¿ç”¨Babelæ‰“åŒ…æºæ–‡ä»¶\n\n### .babelrc.json\n\n\n```json\n{\n  // import/export åŒ¹é…ä¸º scriptÂ , å…¶ä»–åŒ¹é…ä¸ºÂ module\n  \"sourceType\": \"unambiguous\",\n  \"presets\": [\n    [\n      // é¢„è®¾ï¼Œä»åå¾€å‰è¯†åˆ«\n      \"@babel/preset-env\",\n      {\n        \"targets\": {\n          \"ie\": \"11\",\n          \"firefox\": \"29\",\n          \"chrome\": \"30\",\n          \"safari\": \"7\"\n        },\n        \"spec\": true,\n        \"loose\": true\n      }\n    ],\n    [\"@babel/preset-react\"],\n    // è¯†åˆ«ts\n    [\"@babel/preset-typescript\", { \"allowDeclareFields\": true }]\n  ],\n  \"plugins\": [\n    [\n      // è‡ªåŠ¨ç§»é™¤è¯­æ³•è½¬æ¢åå†…è”çš„è¾…åŠ©å‡½æ•° \n      \"@babel/plugin-transform-runtime\",\n      {\n        \"regenerator\": false\n      }\n    ],\n    [\"@babel/plugin-transform-typescript\", { \"allowDeclareFields\": true }],\n    // æ”¯æŒè£…é¥°å™¨è¯­æ³•\n    [\"@babel/plugin-proposal-decorators\", { \"legacy\": true }],\n    // ç¼–è¯‘ç±»å¼ç»„ä»¶ï¼Œä½¿ç”¨ç›´æ¥èµ‹å€¼æ–¹å¼\n    [\"@babel/plugin-proposal-class-properties\", { \"loose\": true }],\n    // è¯†åˆ«ç§æœ‰å˜é‡\n    [\"@babel/plugin-proposal-private-methods\", { \"loose\": true }],\n    \"emotion\",\n    \"lodash\",\n    [\"babel-plugin-webpack-alias\", { \"config\": \"./webpack.config.js\", \"noOutputExtension\": true }],\n    // ä»TypeScriptç”ŸæˆReact interface æˆ– åˆ«å\n    [\"babel-plugin-typescript-to-proptypes\"]\n  ]\n}\n\n```\n\n### package.json\n\né…ç½®åŒ…å…¥å£å’Œæ–‡ä»¶ï¼š\n```json\n\"main\": \"lib/index.js\",\n\n...\n\"files\": [\n    \"README.md\",\n    \"index.d.ts\",\n    \"dist/\",\n    \"lib/\"\n],\n```\n\nè¿è¡Œè„šæœ¬ï¼Œæ‰“åŒ…æ‰€æœ‰srcä¸‹çš„æŒ‡å®šæ–‡ä»¶ï¼š\n`babel src/ --extensions '.js,.jsx,.ts,.tsx' -d lib/ --ignore '**/.umi/*','**/__tests__/*'`\n\næŸ¥çœ‹æ‰“åŒ…ç›®å½•libï¼Œå·²ç»æœ‰äº†ç»“æœï¼š\n\n![image.png](/img/posts/2022-5-22/2022-5-22-5.png)\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å¯ä»¥çœ‹åˆ°indexæ˜¯æœ‰é—®é¢˜çš„ã€‚ä»–è‡ªåŠ¨æŠŠ`src/index.ts`æ‰“åŒ…è¿›å»äº†ï¼Œè¿™ä¸ª`index.ts`æ˜¯`dumi`æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆçš„å…¥å£ã€‚è€Œå¾€å¾€æ–‡æ¡£å±•ç¤ºçš„ç»„ä»¶ä¸ç»„ä»¶åº“å®é™…æ‹¥æœ‰çš„ç»„ä»¶æ•°é‡æ˜¯ä¸ä¸€è‡´çš„ï¼Œæœ‰ä¸€äº›å¼€å‘ä¸­çš„é¡¹ç›®æ˜¯ä¸å±•ç¤ºåœ¨æ–‡æ¡£ä¸­çš„ï¼›åŒæ—¶ï¼Œå¦‚æœè°ƒæ•´äº†æ–‡æ¡£å±•ç¤ºçš„ç»„ä»¶ï¼Œåˆ™ä¼šé€ æˆæ‰“åŒ…çš„ç»„ä»¶æœ‰ç¼ºå¤±çš„é£é™©ã€‚æ‰€ä»¥è¿˜æ˜¯å†³å®šå•ç‹¬åœ¨ç”Ÿæˆä¸€æ¬¡libä¸‹çš„index.jsã€‚\n\n### build-index.js\n\nå†™ä¸€ä¸ªè„šæœ¬ç”Ÿæˆindex.jsï¼š\n```js\nconst fs = require('fs');\nconst path = require('path');\nconst child_process = require('child_process');\n\nlet js = '';\n\n// 1. è¯»å–æ‰€æœ‰æƒ³è¦ä»å¯¼å‡ºçš„ç»„ä»¶ï¼ˆè¿™é‡Œé»˜è®¤å…¨éƒ¨ï¼‰\nconst result = fs\n  .readdirSync('./src/components/', {\n    withFileTypes: true,\n  })\n  .filter((dir) =\u003e /^[A-Z]+[a-zA-Z]*$/.test(typeof dir === 'string' ? dir : dir.name));\n\n/** 2. è¾“å‡ºjsæ ¼å¼\n  * import * as InputAll from './components/Input/';\n  *  const Input = Object.assign(InputAll.default, InputAll);\n  *  export { Input };\n */\nresult.forEach((dir) =\u003e {\n  if (typeof dir !== 'string') dir = dir.name;\n  js += `\n    import * as ${dir}All from './components/${dir}/';\n    const ${dir} = Object.assign(${dir}All.default, ${dir}All);\n    export { ${dir} };\n    `;\n});\n\n// 3. å†™å…¥æ–‡ä»¶\nfs.writeFileSync(path.join(__dirname, 'lib/__index.js'), js);\n\n// 4. ä½¿ç”¨babelå†æ¬¡æ‰“ä¸€ä¸‹åŒ…\nchild_process.execSync('npx babel lib/__index.js --out-file lib/index.js');\n\n```\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æ‰§è¡Œè„šæœ¬ `node build-index`å³å¯ã€‚è¿™æ ·ç”Ÿæˆçš„libæ–‡ä»¶å¤¹ä¸‹ä¼šå¤šä¸€ä¸ª`__index.js`æ–‡ä»¶ï¼Œä½†æ˜¯æ— ä¼¤å¤§é›…ï¼Œå¦‚æœè§‰å¾—ä¸å¤Ÿæ¸…çˆ½ï¼Œå¯ä»¥åŠ å…¥ä»¥ä¸‹åˆ é™¤ä»£ç ï¼š\n\n```js\nfs.unlink('lib/__index.js', () =\u003e {});\n```\n\nå¦‚æ­¤ï¼Œå†æ¬¡æ‰§è¡Œè„šæœ¬ï¼š\n\n```js\nbabel src/ --extensions '.js,.jsx,.ts,.tsx' -d lib/ --ignore '**/.umi/*','**/__tests__/*' \u0026\u0026 node build-index.js\n```\nlibæ–‡ä»¶ç”Ÿæˆå®Œæ¯•~\n\n\n## 5. npmå‘å¸ƒ\n\n1. [NPM](https://www.npmjs.com/)çš„ä½¿ç”¨ï¼Œéœ€è¦å…ˆæ³¨å†Œè´¦å·ï¼Œç„¶ååœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ`npm login`:\n\n![image.png](/img/posts/2022-5-22/2022-5-22-6.png)\n\næŒ‰ç…§å›¾ç¤ºè¾“å…¥é¡ºåºç™»å½•ï¼Œå°±ä¼šçœ‹åˆ°Logged inå­—æ ·ï¼Œè¯´æ˜ç™»å…¥æˆåŠŸï¼\n\n2. ç”Ÿæˆå˜æ›´è®°å½•\n\n- é¡¹ç›®ä¸­å®‰è£…standard-version / cz-conventional-changelogï¼š\n`yarn add --dev standard-version cz-conventional-changelog`\n\n- é…ç½®package.jsonä¸­çš„è„šæœ¬ï¼š`\"commit\": \"cz\"`\n\n\n- commitä½ çš„æ‰€æœ‰æäº¤ã€‚\n\n- ç„¶åæ‰“ç‰ˆæœ¬ï¼ˆæœ‰patch/minor/majorä¸‰ç§ç‰ˆæœ¬ç±»å‹ï¼‰ï¼š\n`standard-version --release-as patch`\n\n- æœ€åå‘å¸ƒ\n`npm publish`\n\nçœ‹åˆ°æœ€æ–°çš„ç‰ˆæœ¬å·ç”Ÿæˆå°±è¡¨ç¤ºå‘å¸ƒæˆåŠŸäº†ï¼š\n\n![image.png](/img/posts/2022-5-22/2022-5-22-7.png)\n\næœ€åæ£€æŸ¥npmä¸ªäººä»“åº“ä¸»é¡µæ˜¯å¦æœ‰æ–°çš„ç‰ˆæœ¬ç”Ÿæˆï¼š\n\n![image.png](/img/posts/2022-5-22/2022-5-22-8.png)\n\n## 6. viteé¡¹ç›®ä½¿ç”¨\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æˆ‘ä»¬å¯ä»¥åœ¨viteé¡¹ç›®ä¸­æµ‹è¯•ä¸€ä¸‹æˆ‘ä»¬å‘å¸ƒçš„åŒ…èƒ½å¦ä½¿ç”¨ã€‚ä½¿ç”¨å¦‚ä¸‹é…ç½®çš„ä¾èµ–ç¯å¢ƒï¼š\n\n```json\n  \"scripts\": {\n    \"start\": \"vite\",\n    \"build\": \"vite build\",\n    \"preview\": \"vite preview\"\n  },\n  \"dependencies\": {\n    \"dux-ui\": \"^1.3.4\",\n    \"react\": \"^18.0.0\",\n    \"react-dom\": \"^18.0.0\"\n  },\n  \"devDependencies\": {\n    \"@types/react\": \"^18.0.0\",\n    \"@types/react-dom\": \"^18.0.0\",\n    \"@vitejs/plugin-react\": \"^1.3.0\",\n    \"vite\": \"^2.9.9\"\n  }\n```\n\næ‰§è¡Œ`yarn`å®‰è£…ä¾èµ–ã€‚\n\nåœ¨`vite.config.js`ä¸­é…ç½®å¼•ç”¨è·¯å¾„ï¼š\n\n\n```js\nimport { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\nexport default defineConfig({\n  plugins: [react()],\n  alias: [\n    { find: 'dux-ui/dist/styles/icon.min.css', replacement: '/node_modules/dux-ui/dist/styles/icon.min.css' },\n    { find: 'dux-ui', replacement: '/node_modules/dux-ui/lib/index.js' },\n  ],\n})\n```\n\nåœ¨App.jsxä¸­æµ‹è¯•ç»„ä»¶ï¼š\n\n```jsx\n...\n\u003c\u003e\n    \u003cIcon type=\"loading\" spin\u003e\u003c/Icon\u003e\n    {StyleTypes.map((type) =\u003e (\n        \u003cButton styleType={type} key={type} onClick={() =\u003e console.log('clicked')}\u003e\n          Button\n        \u003c/Button\u003e\n    ))}\n\u003c/\u003e\n```\nå¯åŠ¨é¡¹ç›®åå¯ä»¥çœ‹åˆ°æ•ˆæœï¼š\n\n![image.png](/img/posts/2022-5-22/2022-5-22-9.png)\n\n## 7. Dumié¡¹ç›®Gitee Pagesé…ç½®\n\n- é¦–å…ˆå®‰è£…ä¾èµ–ï¼š`yarn add --dev gh-pages`\n\n- æ‰§è¡Œè„šæœ¬`dumi build`\n\n- ç„¶åè¾“å‡ºåˆ°æƒ³è¦å¯¼å‡ºçš„æ–‡ä»¶å¤¹ï¼ˆä»¥docs-distä¸ºä¾‹ï¼‰ï¼š`gh-pages -d docs-dist`\n\nè¿è¡ŒæˆåŠŸåï¼Œä¼šçœ‹åˆ°gitä»“åº“å¤šä¸€ä¸ªåˆ†æ”¯ï¼š\n\n![image.png](/img/posts/2022-5-22/2022-5-22-10.png)\n\n- åœ¨giteeä»“åº“é¡µé¢ï¼Œé€‰æ‹©å¯¹åº”çš„æœåŠ¡ï¼š\n\n![image.png](/img/posts/2022-5-22/2022-5-22-11.png)\n\n- é€‰æ‹©å¯¹åº”çš„åˆ†æ”¯ï¼Œå¹¶ä¸”éƒ¨ç½²å³å¯ï¼š\n\n![image.png](/img/posts/2022-5-22/2022-5-22-12.png)\n\næ‰“å¼€ç”Ÿæˆçš„é“¾æ¥å³å¯çœ‹åˆ°éƒ¨ç½²çš„ä¸»é¡µã€‚å¦‚æœæ‰“å¼€åæç¤ºé™æ€èµ„æº404ï¼Œåˆ™éœ€è¦è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š\n\n`.umirc.ts`\n\n```js\n  base: '/dux-ui-react/',\n  publicPath: '/dux-ui-react/',\n```\nå†æ¬¡ä»ç¬¬äºŒæ­¥å¼€å§‹æ‰§è¡Œå³å¯ï¼\n\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;è‡³æ­¤ï¼ŒåŸºäºReactçš„UIåº“çš„æ­å»º. éƒ¨ç½². åŸºç¡€ç»„ä»¶çš„å°è£…å·²ç»ç»“æŸã€‚åç»­æˆ‘ä¼šé€æ­¥å®Œå–„ç»„ä»¶åº“ï¼Œæ·»åŠ æ›´å¤šå¸¸ç”¨çš„ç»„ä»¶ï¼Œæ•¬è¯·æœŸå¾…~~"])</script><script>self.__next_f.push([1,"48:T31d5,"])</script><script>self.__next_f.push([1,"## 1. å‰è¨€\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ç”±äºç–«æƒ…åŸå› ï¼Œè¢«å°é—­åœ¨å®¶ä¸­æ¯”è¾ƒçƒ¦èºï¼Œæ‹–äº†å¥½ä¹…æ‰å¼€å§‹ç»­å†™UIç¯‡çš„æ–‡ç« ï¼ŒæŠ±æ­‰ã€‚æœ¬ç¯‡æ˜¯Reactç»„ä»¶åº“çš„ç¬¬5ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹Formè¡¨å•çš„åŠŸèƒ½ã€‚æœ¬æ–‡çš„ä»£ç å±•ç¤ºçš„æ˜¯ä¸»è¦çš„æ ¸å¿ƒä»£ç ï¼Œå…¨éƒ¨ä»£ç è§ä»“åº“ï¼š[Giteeä»“åº“](https://gitee.com/dh1992/dux-ui-react/)ã€‚å¦ï¼Œæˆ‘å·²éƒ¨ç½²äº†æœ¬ç»„ä»¶åº“çš„æ–‡æ¡£åœ°å€ï¼Œè¿˜è¯·æ‰¹è¯„æŒ‡æ­£ï¼šhttps://dh1992.gitee.io/dux-ui-react\n\n\n## 2. Input\n   \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;Inputä½œä¸ºæœ€åŸºæœ¬çš„HTMLè¡¨å•ç»„ä»¶ï¼Œè‚¯å®šæ˜¯ç»„ä»¶åº“ä¸­å¿…ä¸å¯å°‘çš„ä¸€ä¸ªç»„ä»¶ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å®ç°èµ·æ¥ç›¸å¯¹ç®€å•çš„ï¼ŒH5æœ¬èº«å°±è‡ªå¸¦äº†`input`æ ‡ç­¾ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å…¶åŸºç¡€ä¸Šè‡ªå®šä¹‰è‡ªå·±çš„æ ·å¼ï¼Œå¹¶ä¸”å®ç°ä¸€äº›äº‹ä»¶ç›‘å¬å³å¯ã€‚\n   \n   \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æˆ‘ä»¬å…ˆç¡®å®šInputè¦æ¥å—çš„propsæœ‰å“ªäº›ã€‚é¦–å…ˆè¾“å…¥æ¡†è‚¯å®šè¦æœ‰å€¼ï¼Œè¿˜è¦èƒ½ç¦ç”¨å’Œæ¸…é™¤ï¼ŒåŒæ—¶å˜åŒ–è¿˜è¦æœ‰æ£€æµ‹äº‹ä»¶ï¼Œä¸»è¦çš„å‚æ•°æˆ‘ç½—åˆ—ä¸€ä¸‹ï¼š\n   \n| å±æ€§ | æè¿° |\n| --- | --- |\n| value | å—æ§å€¼ |\n| prefix | å‰ç¼€ |\n| suffix | åç¼€ |\n| clearable | æ˜¯å¦å¯æ¸…ç©º |\n| size | å°ºå¯¸ |\n| disabled | æ˜¯å¦ç¦ç”¨ |\n| onClear | æ¸…é™¤äº‹ä»¶ |\n| onFocus | èšç„¦äº‹ä»¶ |\n| onBlur | å¤±ç„¦äº‹ä»¶ |\n| onChange | å˜åŒ–äº‹ä»¶ |\n\n\n   æˆ‘ä»¬åœ¨`components`æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»º`Input`æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸‹æ–°å»º`index.tsx`æ–‡ä»¶ï¼š\n   \n   \n```tsx\n...\nconst Input = ({size, focused, disabled, customStyle, clearable, value}) =\u003e {\n      \n      return \u003cSWrap\n        {...{ size, focused, disabled, customStyle }}\n        empty={!value}\n      \u003e\n        \u003cspan className={inputWrapCls}\u003e\n          {renderPrefix}\n          \u003cinput\n            {...rest}\n            value={value}\n            onChange={onChange}\n            ref={inputRef}\n            onFocus={handleFocus}\n            onBlur={handleBlur}\n            disabled={disabled}\n          /\u003e\n          {renderClear}\n          {renderSuffix}\n        \u003c/span\u003e\n      \u003c/SWrap\u003e\n    );\n}\n```\n\n \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æˆ‘ç”¨ä¸€ä¸ª`SWrap`ç»„ä»¶åŒ…è£¹äº†åŸç”Ÿçš„inpuæ ‡ç­¾ï¼Œæ¥å—ç”¨æˆ·ä¼ å…¥çš„propså±æ€§ã€‚çœ‹ä¸€ä¸‹SWrapæ˜¯æ€ä¹ˆå®ç°çš„ï¼Œä»ç„¶æ˜¯è¿”å›ä¸€ä¸ªstyleWrapå‡½æ•°ï¼Œå…·ä½“çš„csså®ç°å¯ä»¥çœ‹æˆ‘çš„æºç ï¼Œè¿™é‡Œä¸å¤šèµ˜è¿°ï¼š\n \n```tsx\nimport styled from '@emotion/styled';\nimport { css } from '@emotion/core';\n\n...\nexport const SWrap = styleWrap({})(\n  styled.span((props) =\u003e {\n    const {\n      theme: { designTokens: DT },\n      disabled,\n      size,\n      focused,\n      clearable,\n      customStyle,\n    } = props;\n\n    return css`\n        /** csså®ç° */\n        ...\n    `\n  })\n);\n```\n\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ¯ä¸€ä¸ªå±æ€§éƒ½æ˜¯æ€ä¹ˆå®ç°å…¶ä»·å€¼çš„ï¼š\n\n### 2.1 value/disabled/onChange\né€šè¿‡propså±æ€§ä¼ å…¥ä»¥åç›´æ¥èµ‹å€¼ç»™inputæ ‡ç­¾ï¼š`value={value}`\n\n### 2.2 prefix/suffix\nå‰åç¼€æˆ‘ä»¬é€šè¿‡`renderPrefix/renderSuffix`ç»„ä»¶å®ç°ï¼Œåˆ†åˆ«æ”¾åœ¨inputçš„å‰åï¼š\n\n\n```tsx\n// å¦‚æœç”¨æˆ·ä¼ å…¥äº†prefixï¼Œå°±è¿”å›ä¸€ä¸ªspanï¼ŒåŠ ä¸Šclassnameï¼Œå¹¶ç»™ä¸€ä¸ªonMouseDownçš„äº‹ä»¶ï¼Œå¦‚æœä¸éœ€è¦è¿™é‡Œä¹Ÿå¯ä»¥ä¸è¦äº‹ä»¶ã€‚åç¼€ä¹ŸåŒå‰ç¼€ä¸€æ ·ã€‚\nconst renderPrefix = useMemo(() =\u003e {\n  return (\n    prefix \u0026\u0026 (\n      \u003cspan className={inputPrefixCls} onMouseDown={onMouseDown}\u003e\n        {prefix}\n      \u003c/span\u003e\n    )\n  );\n}, [onMouseDown, prefix]);\n```\n\n### 2.3 clearable\nclearableæ˜¯ç»„ä»¶è‡ªå®šä¹‰çš„å±æ€§ï¼ŒåŸç”Ÿinputæ²¡æœ‰è‡ªå¸¦çš„æ¸…é™¤æ“ä½œã€‚æˆ‘ä»¬é€šè¿‡åç¼€ç»„ä»¶å‰è¾¹çš„`renderClear`ç»„ä»¶å®ç°:\n\n\n```tsx\n// å…¶å®ä¸å‰åç¼€å®ç°æ–¹å¼ä¸€æ ·ï¼Œä¸åŒçš„æ˜¯contentæ˜¯å›ºå®šçš„ä¸€ä¸ªIconï¼Œå¹¶å¼ºåˆ¶èµ‹äºˆhandleClearäº‹ä»¶\nconst renderClear = useMemo(() =\u003e {\n  if (clearable) {\n    return (\n      \u003cspan className={clearCls} onClick={handleClear} onMouseDown={onMouseDown}\u003e\n        \u003cIcon type=\"remove_sign\" /\u003e\n      \u003c/span\u003e\n    );\n  }\n}, [clearable, handleClear, onMouseDown]);\n\n// æ¸…é™¤valueäº‹ä»¶\nconst handleClear = useCallback(\n  (e) =\u003e {\n    if (disabled) return;\n    onClear();\n    const input = inputRef.current;\n    if (!input) return;\n    e.target = input;\n    e.currentTarget = input;\n    const cacheV = input.value;\n    input.value = '';\n    onChange(e);\n    input.value = cacheV;\n  },\n  [disabled, onChange, onClear],\n);\n```\n \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æˆ‘ä»¬è®¾å®šçš„æ¸…é™¤äº‹ä»¶æ‰§è¡Œé¡ºåºæ˜¯å…ˆæ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„`onClear`ï¼Œä¹‹åç¼“å­˜valueï¼Œç„¶åæ‹¿åˆ°Inputæ ‡ç­¾çš„refï¼Œè®¾ç½®å…¶valueæ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œå¹¶å°†å½“å‰ç‚¹å‡»äº‹ä»¶çš„targetç»™Inputï¼Œè°ƒç”¨`onChange`è¿”ç»™ç”¨æˆ·ã€‚**æ³¨æ„æœ€åä¸€è¡Œ**ï¼Œè¦é‡æ–°æŠŠinputçš„valueèµ‹å€¼å›ç¼“å­˜çš„åŸå€¼ï¼Œå› ä¸ºè¿™é‡Œå¹¶æ²¡æœ‰ä»»ä½•setStateçš„æ“ä½œï¼Œä¸åº”è¯¥æ”¹å˜åŸæ¥çš„å€¼ã€‚ç”¨ä¸€ä¸ªonChangeäº‹ä»¶é—´éš”ä¸€ä¸‹ï¼Œvalueå€¼åœ¨ä¸€ä¸ªæ¸²æŸ“å‘¨æœŸå†…ä¸ä¼šæ¸²æŸ“ä¸¤æ¬¡ï¼Œæ‰€ä»¥å°±é€ æˆäº†è¢«æ¸…ç©ºçš„å‡è±¡ã€‚è‡³äºæ¸…ç©ºæ•°æ®çš„çœŸå®æ“ä½œï¼Œåº”è¯¥æ”¾åœ¨onChangeä¸­ã€‚\n \n  \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;è‡³æ­¤ï¼ŒInputç»„ä»¶çš„åŠŸèƒ½å®ç°å·²ç»ä»‹ç»å®Œæ¯•ã€‚ä»¥æ­¤ç±»æ¨ï¼Œæ•°å­—è¾“å…¥æ¡†`NumberInput`ï¼Œåªéœ€è¦åœ¨å·¦å³ä¸¤ä¾§ä¸ªåŠ ä¸€ä¸ªButtonæ¥æ§åˆ¶å¢å‡ï¼Œåœ¨`onBlur`äº‹ä»¶ä¸­éœ€è¦é€šè¿‡æ­£åˆ™æ ¡éªŒæ˜¯å¦ä¸ºåˆæ³•çš„æ•°å­—å³å¯ï¼›æ–‡æœ¬åŸŸ`Textarea`å®Œå…¨å¯ä»¥å‚ç…§Inputï¼Œå°†åŸç”Ÿæ ‡ç­¾æ¢æˆtextareaå³å¯ã€‚\n  \n## 3. Radio\n  \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;H5çš„inputæ ‡ç­¾è™½ç„¶æœ‰radioå±æ€§ï¼Œä½†æ˜¯ä¸€èˆ¬ç»„ä»¶åº“å°±ä¸å¤ªä¼šç›´æ¥ä½¿ç”¨äº†ï¼Œä¸€æ–¹é¢æ˜¯åŸç”Ÿçš„æ–¹æ³•å¾€å¾€ä¸èƒ½æ»¡è¶³ç»„ä»¶åº“çš„éœ€æ±‚ï¼Œå¦ä¸€æ–¹é¢ï¼Œä¸æƒ³åŸå§‹çš„Inputè¾“å…¥æ¡†ï¼ŒåŸç”Ÿæ ‡ç­¾ä¸èƒ½åšåˆ°ç»„ä»¶åº“éœ€è¦çš„æ ·å¼å®šåˆ¶å’Œä¸»é¢˜å®šåˆ¶ã€‚æ¯”å¦‚æˆ‘ä»¬è‡ªå®šä¹‰çš„radioç»„ä»¶ï¼Œå¯ä»¥æœ‰åŸç”Ÿæ ·å¼ï¼Œä¹Ÿå¯ä»¥æœ‰cardæ¨¡å¼ï¼Œè€Œä¸”radioå¾€å¾€éƒ½ä¸æ˜¯ä¸€ä¸ªå•ç‹¬å­˜åœ¨ï¼Œè‡³å°‘å¾—æœ‰ä¸¤ä¸ªæ‰èƒ½æ»¡è¶³è¦æ±‚ã€‚æˆ‘ä»¬å…ˆæ¥å®šä¹‰ä¸€ä¸‹`props`ï¼š\n  \n  | å±æ€§ | æè¿° |\n| --- | --- |\n| checked        | æ˜¯å¦é€‰ä¸­                                                        | \n| defaultChecked | é»˜è®¤æ˜¯å¦é€‰ä¸­                                                      | \n| disabled       | æ˜¯å¦ç¦ç”¨                                                        | \n| onChange       | ç‚¹é€‰æ—¶çš„å›è°ƒ                                                      | \n| value          | radioçš„å€¼                                                     | \n| styleType      | æ ·å¼é£æ ¼, å¯é€‰ 'default', 'button', 'tag', 'card', 'text', 'list' | \n| size           | å°ºå¯¸ï¼Œå¯é€‰'sm', 'md', 'lg'ï¼ŒstyleType ä¸º card. list æ—¶æ— æ•ˆ             | \n| title          | æ ‡é¢˜ï¼ŒstyleType ä¸º card æ—¶ä½¿ç”¨                                     | \n\n \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æ¥ä¸‹æ¥åœ¨`src/components`ä¸‹æ–°å»ºæ–‡ä»¶å¤¹`Radio`ï¼Œå¹¶åœ¨å…¶ä¸­æ–°å»º`index.tsx`ï¼š\n \n \n```tsx\n...\nrenderRadioList(props: any) {\n    /* eslint-disable no-unused-vars */\n    const {\n      children,\n      checked,\n      onChange,\n      onClick,\n      disabled,\n      ...rest\n    } = props;\n    /* eslint-enable no-unused-vars */\n\n    return (\n      \u003cRadioListWrap\n        checked={checked}\n        disabled={disabled}\n        {...rest}\n        onClick={(...args: any) =\u003e this.onClick(props, { ...args })}\n      \u003e\n        \u003cRadioIcon checked={checked} disabled={disabled} /\u003e\n        {children != null \u0026\u0026 \u003cspan className={contentCls}\u003e{children}\u003c/span\u003e}\n      \u003c/RadioListWrap\u003e\n    );\n}\n```\n \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;`RadioListWrap`ä»ç„¶æ˜¯ç”¨`styleWrap`åŒ…è£¹çš„åŒ…å«æ ·å¼çš„divï¼Œå†…å®¹ç‰©æˆ‘ä»¬æ”¾ä¸€ä¸ªå›¾æ ‡`RadioIcon`æ¥æ”¶æœ€é‡è¦çš„å±æ€§`checked`ï¼Œåè¾¹ç”¨ä¸€ä¸ªspanåŒ…è£¹ä¼ å…¥çš„childrenï¼Œä½¿ç”¨æ—¶å¯ä»¥è¿™æ ·å†™ï¼š\n \n ```tsx\n \u003cRadio checked\u003echecked\u003c/Radio\u003e\n ```\n ç»„ä»¶`RadioIcon`å†…éƒ¨æ”¾ä¸€ä¸ªå®å¿ƒåœ†å½¢çš„Iconï¼Œ`SIconWrap`ä»ç„¶æ˜¯ä¸€ä¸ªdivï¼š\n \n \n```tsx\nconst RadioIcon = (props: { checked?: boolean; disabled?: boolean }) =\u003e {\n  return (\n    \u003cSIconWrap {...props}\u003e\n      \u003cIcon className={iconCls} type=\"whitecircle\" /\u003e\n    \u003c/SIconWrap\u003e\n  );\n};\n```\n\nåœ¨`SIconWrap`æ ·å¼å®šä¹‰é‡Œï¼Œé€šè¿‡åˆ¤æ–­æ˜¯å¦checkedæ¥æ§åˆ¶æ ·å¼é«˜äº®ï¼š\n\n\n```tsx\n${checked \u0026\u0026\n  css`\n    // checkedæ—¶ï¼ŒSIconWrapåŠ ä¸€ä¸ªä¸»é¢˜è‰²çš„è¾¹æ¡†\n    \u0026.${iconWrapCls} {\n      color: ${DT.T_COLOR_LINE_PRIMARY_DEFAULT};\n      border-color: ${DT.T_COLOR_LINE_PRIMARY_DEFAULT};\n    }\n    // checkedæ—¶ï¼ŒIconå­—ä½“åŠ ä¸Šä¸»é¢˜è‰²\n    .${iconCls} {\n      visibility: visible;\n      opacity: 1;\n      fill: ${DT.T_COLOR_TEXT_PRIMARY_DEFAULT};\n    }\n`}\n```\n\nåŸºæœ¬ç»“æ„è®²è§£å®Œäº†ï¼Œæˆ‘ä»¬æ¥çœ‹åŠ ä¸Šæ ·å¼ç¾åŒ–åçš„æ•ˆæœï¼š\n\n![image.png](/img/posts/2022-5-22/2022-5-22-1.png)\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†æ¨¡æ‹ŸåŸç”Ÿæ ·å¼å¤–ï¼Œè¿˜å¯ä»¥æ¨¡æ‹ŸæŒ‰é’®. æ ‡ç­¾å’Œåˆ—è¡¨æ ·å¼ï¼Œå®ç°æ–¹å¼åŒä¸Šï¼Œåªéœ€è¦å°†`RadioWrap`å†…çš„Iconæ›¿æ¢æˆå…¶ä»–çš„ç»„ä»¶å³å¯ã€‚\n\n\u003e  è¡¨å•ç»„ä»¶æ¯”è¾ƒå¤šï¼Œè¿™é‡Œåªæ˜¯è®²è¿°äº†åŸºæœ¬çš„å‡ ä¸ªå®ç°ï¼Œä¸ºå†™è¡¨å•ç»„ä»¶æä¾›ä¸€ä¸ªæ€è·¯ï¼Œæ›´å¤šç»„ä»¶å¯ä»¥å‚è§[ç»„ä»¶åº“ä¸»é¡µ](https://dh1992.gitee.io/dux-ui-react/)\n\n\n## 4. Form\n  \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;è®²å®ŒåŸºç¡€è¡¨å•ç»„ä»¶ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸‹è¡¨å•ç»„ä»¶çš„å¸ƒå±€ï¼Œå°±å«`Form`ã€‚H5åŸç”Ÿçš„ç»„ä»¶æ˜¯æœ‰formçš„ï¼Œæˆ‘ä»¬è¿™é‡Œéœ€è¦ç”¨åˆ°å…¶submitæ–¹æ³•ï¼Œæ‰€ä»¥å°±ä½¿ç”¨åŸç”Ÿçš„formï¼Œå¹¶å¯¹å…¶è¿›è¡Œæ ·å¼å°è£…ã€‚\n  \n  \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;è¡¨å•å®¹å™¨ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªæ ¹ç»„ä»¶Formï¼Œå†…éƒ¨æœ‰è‡³å°‘ä¸€ä¸ªformitemï¼Œæ¯ä¸€ä¸ªformitemå†…åŒ…å«ä¸€ä¸ªåŸºç¡€è¡¨å•è¾“å…¥ç»„ä»¶ï¼Œå®šä¹‰ä¸åŒçš„nameã€‚åœ¨`src/components`ä¸‹æ–°å»º`Form`æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸‹æ–°å»º`Form.tsx`,`Item.tsx`ã€‚å…ˆçœ‹`Form.tsx`ï¼š\n  \n  \n```tsx\nconst Form = ({ onSubmit, ...rest }: any) =\u003e {\n  const { preventFormDefaultAction } = useContext(ConfigContext);\n  const handleSubmit = React.useCallback(\n    (e) =\u003e {\n      if (e) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n      onSubmit \u0026\u0026 onSubmit(e);\n    },\n    [onSubmit],\n  );\n  return (\n      \u003cFormWrap onSubmit={preventFormDefaultAction ? handleSubmit : onSubmit} {...rest} /\u003e\n  );\n};\n```\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;è¡¨å•å®¹å™¨ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªæ ¹ç»„ä»¶Formç”¨äºå®¹çº³æ‰€æœ‰çš„è¾“å…¥å…ƒç´ ï¼Œè§¦å‘åŸç”Ÿçš„submitäº‹ä»¶ï¼›å†…éƒ¨childrenæœ‰è‡³å°‘ä¸€ä¸ªformitemï¼Œæ¯ä¸€ä¸ªformitemå†…åŒ…å«ä¸€ä¸ªåŸºç¡€è¡¨å•è¾“å…¥ç»„ä»¶ï¼Œå®šä¹‰ä¸åŒçš„nameï¼Œformitemåº”è¯¥éµå¾ªå·¦å³å¸ƒå±€æ ¼å¼ï¼Œä½¿ç”¨floatæˆ–è€…flexéƒ½å¯ä»¥å®ç°ã€‚æˆ‘ä»¬çœ‹ä¼ å…¥çš„å‚æ•°`onSubmit`ï¼Œåœ¨ç»„ä»¶`FormWrap`çš„å›è°ƒonSubmitä¸­è°ƒç”¨ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹`FormWrap`ï¼Œä»–è¿”å›çš„å°±æ˜¯ä¸€ä¸ªåŠ äº†æ ·å¼çš„åŸç”Ÿformæ ‡ç­¾ï¼š\n  \n  \n```tsx\nexport const FormWrap = styleWrap\u003c{ size: string }\u003e({\n  className: prefixCls,\n})(\n  styled('form')((props) =\u003e {\n\n    return css`\n      font-size: 12px;\n\n      // ç»™ä¸‹å±çš„æ¯ä¸€ä¸ªitemåŠ æ ·å¼\n      .${itemCls} {\n        margin-bottom: 16px;\n        \u0026:last-child {\n          margin-bottom: 0;\n        }\n      }\n    `;\n  }),\n);\n\n```\n\n  \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æˆ‘ä»¬å†æ¥çœ‹å†…å®¹ç‰©`Item.tsx`çš„å®ç°ï¼š\n  \n  \n```tsx\n...\nreturn (\n    \u003cItemWrap\u003e\n      \u003cLabelWrap {...labelCol}\u003e\n        {label}\n        {required \u0026\u0026 \u003cRequiredLabel\u003e*\u003c/RequiredLabel\u003e}\n        {help \u0026\u0026 \u003cCommentWrap\u003e{help}\u003c/CommentWrap\u003e}\n      \u003c/LabelWrap\u003e\n      \u003cControllerWrap {...controllerCol}\u003e\n        {children}\n        \u003cRenderTip tip={tip} status={status} /\u003e\n      \u003c/ControllerWrap\u003e\n    \u003c/ItemWrap\u003e\n);\n```\n  \n \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;`ItemWrap`ï¼Œ`LabelWrap`ï¼Œ`ControllerWrap`ï¼Œç”¨äºè¡¨å•æ¡ç›®å·¦å³å¸ƒå±€çš„å®ç°ï¼š\n  \n  ```tsx\n// ItemWrap ä½¿ç”¨12æ …æ ¼å¸ƒå±€\nexport const ItemWrap = styleWrap\u003c{ size: string }\u003e({\n  className: prefixCls,\n})(\n    styled('form')((props) =\u003e {\n\n    return css`\n      font-size: 12px;\n      display: flex;\n\n      // ç»™ä¸‹å±çš„æ¯ä¸€ä¸ªlabelåŠ æ ·å¼ï¼Œæ ·å¼ç±»åä»LabelWrapè·å–\n     .${prefixCls} \u003e .${itemLabelCls} {\n        flex: ${props.labelCol.span || 6}\n      }\n      \n      // ç»™ä¸‹å±çš„æ¯ä¸€ä¸ªcontrollerå—æ§åŒºåŸŸåŠ æ ·å¼ï¼Œæ ·å¼ç±»åä»ControllerWrapè·å–\n     .${prefixCls} \u003e .${itemControllerCls} {\n        flex: ${props.controllerCol.span || 6}\n      }\n    `;\n  }),\n);\n\n```\n  \n   \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æˆ‘ä»¬æ¥çœ‹çœ‹æ”¾ç»„ä»¶åçš„æ•ˆæœï¼ˆä¸»é¡µdemoï¼‰ï¼š\n   \n![image.png](/img/posts/2022-5-22/2022-5-22-2.png)\n\n\n\n   \u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æ€»ç»“ä¸€ä¸‹ï¼Œè¡¨å•ç»„ä»¶éœ€è¦æ”¾åœ¨åŸç”Ÿformæ ‡ç­¾å†…ï¼Œä½¿ç”¨æ …æ ¼å¸ƒå±€ï¼Œå·¦ä¾§æ”¾ç½®labelï¼Œå³ä¾§æ”¾ç½®å…·ä½“çš„è¾“å…¥ç»„ä»¶ï¼›æœ¬æ–‡ç« ä»‹ç»äº†Inputå’ŒRadioå¦‚ä½•æ¥å°è£…ï¼Œå…¶ä»–ç»„ä»¶ä¹Ÿéƒ½æ˜¯å¤§åŒå°å¼‚ï¼Œç”±äºç¯‡å¹…é™åˆ¶ï¼Œè¯»è€…å¯ä»¥å»ä¸»é¡µæŸ¥çœ‹æ•ˆæœæˆ–è€…è‡ªå·±å»npmå®‰è£…ä¸€ä¸‹å®æ–½æ•ˆæœï¼ˆç›¸å…³é…ç½®å¯æŸ¥çœ‹æºç READMEï¼‰ï¼š\n\n```sh\nnpm install --save dux-ui\n```"])</script><script>self.__next_f.push([1,"49:T2c69,"])</script><script>self.__next_f.push([1,"å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­ï¼ŒAPIæ¥å£çš„è´¨é‡ä¼šç›´æ¥å½±å“å‰ç«¯é¡µé¢æ¸²æŸ“çš„é€»è¾‘ã€‚ä½œè€…ç»è¿‡å¤šå¹´çš„ä¸åç«¯å¼€å‘åŒå­¦. äº§å“çš„â€œç£¨åˆâ€ä¸­æ€»ç»“äº†ä¸€å¥—ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå®Œæ•´çš„ï¼Œå¯¹äºå‰ç«¯æ¯”è¾ƒå‹å¥½çš„æ¥å£è§„èŒƒã€‚å…¶å®è¯´æ˜¯æ€¼åç«¯ï¼Œä½†æ¢ä¸ªè§’åº¦è®²ï¼Œä¹Ÿæ˜¯åœ¨å¸®åŠ©åç«¯è¿›æ­¥å˜›ï¼\n\n\n## 0. è®¾è®¡è§„èŒƒåŸåˆ™\n\n```\n1.   å‰ç«¯åº”åªå…³æ³¨æ¸²æŸ“é€»è¾‘ï¼Œè€Œä¸åº”è¯¥å…³æ³¨æ•°æ®çš„å¤„ç†é€»è¾‘ã€‚æ¥å£è¿”å›çš„æ•°æ®åº”è¯¥æ˜¯èƒ½å¤Ÿç›´æ¥å±•ç¤ºåœ¨ç•Œé¢ä¸Šçš„ã€‚\n2.   ä¸€ä¸ªåŠŸèƒ½åº”é¿å…å¤šä¸ªæ¥å£åµŒå¥—è°ƒç”¨è·å–æ•°æ®ï¼Œåå°åº”è¯¥å¤„ç†å¥½ä¸€æ¬¡æ€§è¿”å›ã€‚\n3.   å“åº”æ ¼å¼åº”è¯¥æ˜¯JSONï¼Œè€Œä¸”åº”é¿å…å¤šçº§JSONçš„å‡ºç°ï¼›\n4.   åç«¯å¦‚æœéœ€è¦ç•Œé¢å®æ—¶åˆ·æ–°æ•°æ®ï¼Œä¸åº”è¯¥è¦æ±‚å‰ç«¯å®šæ—¶å™¨è½®è¯¢ï¼Œè€Œè¦æä¾›ç±»ä¼¼webSocketä¹‹ç±»çš„åŠŸèƒ½ã€‚\n```\næ ¹æ®è¿™ä¸ªåŸåˆ™ï¼Œåç«¯è¿”å›çš„æ•°æ®åº”è¯¥æ˜¯æ‰€è§å³æ‰€å¾—çš„æ•°æ®ï¼Œè€Œä¸åº”è¯¥æ˜¯ä¸€å±‚åŒ…ä¸€å±‚çš„å¤æ‚çš„JSONï¼Œéœ€è¦å‰ç«¯é¢å¤–æ¥å¤„ç†å¾ˆå¤æ‚çš„å»é‡ï¼Œæ’åº. æ·±æµ…æ‹·è´ï¼Œå˜å½¢ç­‰å¤„ç†ã€‚å‰ç«¯åœ¨æ¸²æŸ“æ¯ä¸€ä¸ªdivï¼Œæ¯ä¸€ä¸ªtableçš„cellæ—¶ï¼Œä¸ç”¨æ‹…å¿ƒæ•°æ®ç»“æ„ä¼šé¢‘ç¹æ›´æ”¹ä»è€Œå¯¼è‡´é¡µé¢å´©æºƒã€‚\n\n## 1. æ¥å£åˆ¶å®šçš„å…¨æµç¨‹\n\nå‰ç«¯è¯·æ±‚ä¸€èˆ¬æ˜¯`HTTP`åè®®ï¼Œè¿™é‡Œä»¥HTTPä¸ºä¾‹ã€‚\n\n### HTTPè¯·æ±‚çš„åè®®ç±»å‹\n\nåº”ä½¿ç”¨ä¸‹é¢ç½—åˆ—çš„HTTPæ–¹æ³•ï¼ˆä½¿ç”¨çš„SQLå…³é”®å­—ï¼‰:\n\n- `GET`ï¼ˆSELECTï¼‰ï¼šä»æœåŠ¡å™¨å–å‡ºèµ„æºï¼Œä¸€é¡¹æˆ–å¤šé¡¹ã€‚\n- `POST`ï¼ˆCREATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ–°å»ºä¸€ä¸ªèµ„æºã€‚\n- `PUT`ï¼ˆUPDATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜åçš„å®Œæ•´èµ„æºï¼‰ã€‚\n- `PATCH`ï¼ˆUPDATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜çš„å±æ€§ï¼‰ï¼Œä½¿ç”¨æ¯”è¾ƒå°‘\n- `DELETE`ï¼ˆDELETEï¼‰ï¼šä»æœåŠ¡å™¨åˆ é™¤èµ„æºã€‚\n\nä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­:\n\n- `GET` /schoolsï¼šåˆ—å‡ºæ‰€æœ‰çš„å­¦æ ¡åˆ—è¡¨\n- `POST` /schoolï¼šæ–°å»ºä¸€ä¸ªå­¦æ ¡\n- `GET` /school/`{id}`ï¼šè·å–æŸä¸ªæŒ‡å®šå­¦æ ¡çš„ä¿¡æ¯\n- `PUT` /school/`{id}`ï¼šæ›´æ–°æŸä¸ªæŒ‡å®šå­¦æ ¡çš„ä¿¡æ¯ï¼ˆæä¾›è¯¥å­¦æ ¡çš„å…¨éƒ¨ä¿¡æ¯ï¼Œè€Œä¸æ˜¯è®©å‰ç«¯å†é€šè¿‡åˆ«çš„æ¥å£è·å–ï¼‰\n- `PATCH` /school/`{id}`ï¼šæ›´æ–°æŸä¸ªæŒ‡å®šå­¦æ ¡çš„ä¿¡æ¯ï¼ˆæä¾›è¯¥å­¦æ ¡çš„éƒ¨åˆ†ä¿¡æ¯ï¼‰\n- `DELETE` /school/`{id}`ï¼šåˆ é™¤æŸä¸ªå­¦æ ¡\n\n### HTTPè¯·æ±‚çš„å‚æ•°å®šä¹‰\n\nä¸åŒ`HTTP`æ–¹æ³•å¯¹åº”ä¸åŒçš„å‚æ•°ä¼ é€’æ–¹å¼ï¼Œå¦‚ä¸‹ï¼š\n\n\u003e queryæŒ‡è·¯å¾„ä¼ å‚ï¼ŒbodyæŒ‡requestBodyè¯·æ±‚ä½“\n\n- `GET`ï¼špath \u0026 query\n- `POST`ï¼špath \u0026 body\n- `PUT`ï¼špath \u0026 query \u0026 body\n- `PATCH`ï¼špath \u0026 query \u0026 body\n- `DELETE`ï¼špath \u0026 query\n\næ³¨æ„ï¼š\n\n```\n1. æœªå‡ºç°åœ¨ä¸Šè¡¨ä¸­çš„ä½ç½®ä¸å¯æ”¾ç½®å‚æ•°ï¼Œå¦‚GETæ–¹æ³•ä¸å¯åœ¨bodyä¸­æ”¾ç½®å‚æ•°ã€‚\n2. å‚æ•°å‘½åå‡éµå¾ªå°é©¼å³°å‘½åæ³•ã€‚\n3. pathå’Œqueryä¸­ä¼ é€’çš„å‚æ•°éœ€ç¡®ä¿é•¿åº¦å¯æ§ï¼Œè¶…è¿‡2000å­—ç¬¦ï¼ˆå› æµè§ˆå™¨è€Œå¼‚ï¼‰çš„å‚æ•°å¯å¯¼è‡´è¯·æ±‚å¤±è´¥ã€‚å½“è¯·æ±‚æ— æ³•ä¿è¯å‚æ•°é•¿åº¦å¯æ§ï¼Œåˆ™ä¸èƒ½å°†å‚æ•°æ”¾åœ¨pathæˆ–queryä¸­ï¼Œå¿…é¡»ä½¿ç”¨æ”¯æŒbodyå‚æ•°çš„HTTPæ–¹æ³•ï¼Œå¦‚POSTã€‚\n4. pathå’Œqueryä¸­ä¼ é€’çš„å‚æ•°éœ€æ˜¯åŸºæœ¬ç±»å‹ï¼Œäº¦ä¸å¯ä¼ é€’åºåˆ—åŒ–ä¹‹åçš„JSONå¯¹è±¡ï¼ä¸ç„¶å‰ç«¯å°±è¦try/catchä¸€ä¸‹æ¥parseäº†ã€‚\n5. bodyä¸­çš„å‚æ•°éœ€æ˜¯åˆæ³•JSONå¯¹è±¡æˆ–è€…formDataï¼Œå³ä½¿å‚æ•°ä»…åŒ…å«å•å­—æ®µæˆ–å•æ•°ç»„ï¼Œä¹Ÿéœ€åŒ…å«åœ¨å¯¹è±¡ä¸­ï¼Œå¦‚ï¼š\n{\nÂ  name: string;\n}\n```\n\n\n### HTTPå“åº”ç»“æœå®šä¹‰\n\né’ˆå¯¹ä¸åŒæ“ä½œï¼ŒæœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›çš„ç»“æœåº”è¯¥ç¬¦åˆä»¥ä¸‹è§„èŒƒã€‚\n\n\u003cRow\u003e\n  \u003cCol\u003e\n    - `GET` /collectionsï¼šè¿”å›èµ„æºå¯¹è±¡çš„åˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰\n  \u003c/Col\u003e\n  \u003cCol sticky\u003e\n    ```js {{ title: 'Response' }}\n    {\n        RetCode: 0,\n        Message: 'ok',\n        Action: 'collections',\n        Data: [\n            {\n                Id: 1,\n                name: 'collection1',\n                ...\n            },\n            ...\n        ]\n    }\n    ```\n  \u003c/Col\u003e\n\u003c/Row\u003e\n---\n\u003cRow\u003e\n  \u003cCol\u003e\n    - `GET` /collection/resourceï¼šè¿”å›å•ä¸ªèµ„æºå¯¹è±¡\n  \u003c/Col\u003e\n  \u003cCol sticky\u003e\n    ```js {{ title: 'Response' }}\n    {\n        RetCode: 0,\n        Message: 'ok',\n        Action: 'collectionResource',\n        Data: {\n            Id: 1,\n            name: 'collection1',\n            ...\n        }\n    }\n    ```\n  \u003c/Col\u003e\n\u003c/Row\u003e\n---\n\u003cRow\u003e\n  \u003cCol\u003e\n    - `POST` /collectionï¼šè¿”å›æ–°ç”Ÿæˆçš„èµ„æºå¯¹è±¡\n  \u003c/Col\u003e\n  \u003cCol sticky\u003e\n    ```js {{ title: 'Response' }}\n      {\n          RetCode: 0,\n          Message: 'ok',\n          Action: 'collection',\n          Data: {\n              Id: 1,\n              name: 'collection1',\n              ...\n          }\n      }\n    ```\n  \u003c/Col\u003e\n\u003c/Row\u003e\n\n- `PUT` /collection/resourceï¼šè¿”å›å®Œæ•´çš„èµ„æºå¯¹è±¡ï¼Œ è¿”å›ç»“æœåŒä¸Šã€‚\n- `PATCH` /collection/resourceï¼šè¿”å›å®Œæ•´çš„èµ„æºå¯¹è±¡ï¼Œè¿”å›ç»“æœåŒä¸Šã€‚\n\n\u003cRow\u003e\n  \u003cCol\u003e\n    - `DELETE` /collection/resourceï¼šè¿”å›ä¸€ä¸ªç©ºæ–‡æ¡£\n  \u003c/Col\u003e\n  \u003cCol sticky\u003e\n    ```js {{ title: 'Response' }}\n      {\n          RetCode: 0,\n          Message: 'ok',\n          Action: 'collectionResource',\n          Data: {}\n      }\n    ```\n  \u003c/Col\u003e\n\u003c/Row\u003e\n\næ³¨æ„ï¼š\n\n\n1. æ‰€æœ‰è¿”å›æ•°æ®éœ€æ˜¯åˆæ³•JSONï¼Œå°½é‡è¿”å›objectæˆ–è€…array (äºŒè¿›åˆ¶æ–‡ä»¶ä¸‹è½½é™¤å¤–)ã€‚å¦‚æœæ•°æ®ä¸­åŒ…å«ç±»å‹ä¸ºarrayçš„å±æ€§ï¼Œå½“æ•°æ®ä¸ºç©ºæ—¶ï¼Œå°½é‡è¿”å›ç©ºæ•°ç»„[]ï¼Œé¿å…è¿”å›nullã€‚\n2. è¿”å›æ•°æ®é¿å…ä½¿ç”¨mapçš„`\u003c'key', 'value'\u003e`å½¢å¼ï¼å¦‚æœ‰ç›¸å…³æ ¼å¼çš„è¿”å›æ•°æ®ï¼Œè¯·è½¬æ¢ä¸ºarrayã€‚\n3. å¦‚æœæ²¡æœ‰æ•°æ®éœ€è¦è¿”å›ï¼Œæˆ–ç³»ç»ŸæŠ¥é”™æ—¶ï¼Œå¯ç»Ÿä¸€è¿”å›å›ºå®šå­—æ®µï¼š\n\n```ts\n{\n  RetCode: number, // åç«¯çŠ¶æ€ç \n  Message: string, // è¯·æ±‚è¿”å›æ¶ˆæ¯\n  Action: string, // è¯·æ±‚çš„å“åº”å…³é”®å­—\n  Data: Object | Array // å“åº”æ•°æ®\n}\n```\n\n4. è¿”å›å€¼ä¸­åº”å°½é‡é¿å…åŒ…å«æ— ç”¨ä¿¡æ¯ï¼Œæˆ–è€…é¢å¤–çš„æ•°æ®ç»“æ„ï¼Œä»…åŒ…å«å¿…è¦æ•°æ®å³å¯ã€‚å¿…è¦æ•°æ®æŒ‡å‰ç«¯éœ€è¦æ¸²æŸ“çš„æ•°æ®ã€‚\n5. åç«¯å¼‚å¸¸æŠ¥é”™å‡ä»¥'500'çŠ¶æ€ç çš„å½¢å¼è¿”å›ï¼Œä¹Ÿå¯é€‚å½“æ·»åŠ é¢å¤–ä¿¡æ¯ï¼Œéç‰¹æ®Šæƒ…å†µæ— éœ€åœ¨è¿”å›çš„æ•°æ®ä½“ä¸­è¿”å›HTTP codeã€‚\n\n\n### URLè§„èŒƒ\n\nå¯å‚ç…§ä¸‹é¢çš„èŒƒä¾‹ï¼š\n`GET [http | https]://host:port/studio/api/ç»„ä»¶å/v1/æ¨¡å—å/èœå•å/æ¥å£å/:param`\n\næ³¨æ„ï¼š\n```\n1. ä¸ç”¨å¤§å†™å­—æ¯ï¼Œå»ºè®®ç”¨ä¸­æ  - ä¸ç”¨ä¸‹æ  _. æ¯”å¦‚é‚€è¯·ç å†™æˆinvitation-codeè€Œä¸æ˜¯invitation_code\n2. ä½¿ç”¨åè¯è¡¨ç¤ºèµ„æºé›†åˆï¼Œä½¿ç”¨å¤æ•°å½¢å¼ï¼ˆä¸ºç¡®ä¿æ‰€æœ‰API URIsä¿æŒä¸€è‡´ï¼‰ï¼Œä¸èƒ½ä½¿ç”¨åŠ¨è¯ï¼›\n3. æ¯ä¸ªèµ„æºéƒ½è‡³å°‘æœ‰ä¸€ä¸ªæ ‡è¯†å®ƒçš„URIï¼ŒåŒæ—¶åº”è¯¥éµå¾ªä¸€ä¸ªå¯é¢„æµ‹çš„å±‚æ¬¡ç»“æ„æ¥æé«˜å¯ç†è§£æ€§ï¼Œä»è€Œæé«˜å¯ç”¨æ€§ï¼›\n4. å®¾è¯­å¿…é¡»æ˜¯åè¯ã€‚ç½‘å€ä¸­ä¸èƒ½æœ‰åŠ¨è¯ï¼Œåªèƒ½æœ‰åè¯ï¼ŒAPIä¸­çš„åè¯ä¹Ÿåº”è¯¥ä½¿ç”¨å¤æ•°ï¼Œå®¾è¯­å°±æ˜¯APIçš„URLï¼Œæ˜¯HTTPåŠ¨è¯ä½œç”¨çš„å¯¹è±¡ã€‚å®ƒåº”è¯¥æ˜¯åè¯ï¼Œä¸èƒ½æ˜¯åŠ¨è¯\n```\næ­£ğŸŒ° ï¼š\n\n- `GET` /classesï¼šåˆ—å‡ºæ‰€æœ‰ç­çº§\n- `POST` /classesï¼šæ–°å»ºä¸€ä¸ªç­çº§\n- `GET` /classes/`{classId}`ï¼šè·å–æŸä¸ªæŒ‡å®šç­çº§çš„ä¿¡æ¯\n- `PUT` /classes/`{classId}`ï¼šæ›´æ–°æŸä¸ªæŒ‡å®šç­çº§çš„ä¿¡æ¯ï¼ˆä¸€èˆ¬å€¾å‘æ•´ä½“æ›´æ–°ï¼‰\n- `PATCH` /classes/`{classId}`ï¼šæ›´æ–°æŸä¸ªæŒ‡å®šç­çº§çš„ä¿¡æ¯ï¼ˆä¸€èˆ¬å€¾å‘éƒ¨åˆ†æ›´æ–°ï¼‰\n- `DELETE` /classes/`{classId}`ï¼šåˆ é™¤æŸä¸ªç­çº§\n- `GET` /classes/`{classId}`/teachersï¼šåˆ—å‡ºæŸä¸ªæŒ‡å®šç­çº§çš„æ‰€æœ‰è€å¸ˆçš„ä¿¡æ¯\n- `GET` /classes/`{classId}`/studentsï¼šåˆ—å‡ºæŸä¸ªæŒ‡å®šç­çº§çš„æ‰€æœ‰å­¦ç”Ÿçš„ä¿¡æ¯\n- `DELETE` classes/`{classId}`/teachers/`{teacherId}`ï¼šåˆ é™¤æŸä¸ªæŒ‡å®šç­çº§ä¸‹çš„æŒ‡å®šçš„è€å¸ˆçš„ä¿¡æ¯\n\nåä¾‹ï¼š\n- /getAllclasses\n- /createNewclass\n- /deleteAllActiveclasses\n\n\u003e **å¤æ•°è¿˜æ˜¯å•æ•°URLé—®é¢˜**ï¼š æ—¢ç„¶ URL æ˜¯åè¯ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨å¤æ•°ï¼Œè¿˜æ˜¯å•æ•°ï¼Ÿè¿™æ²¡æœ‰ç»Ÿä¸€çš„è§„å®šï¼Œä½†æ˜¯å¸¸è§çš„æ“ä½œæ˜¯è¯»å–ä¸€ä¸ªé›†åˆï¼Œæ¯”å¦‚GET /articlesï¼ˆè¯»å–æ‰€æœ‰æ–‡ç« ï¼‰ï¼Œè¿™é‡Œæ˜æ˜¾åº”è¯¥æ˜¯å¤æ•°ï¼Œè€Œè·å–å•ä¸ªå¯ä»¥ç”¨GET /article/2ã€‚ å½“ç„¶ï¼Œä½ å¯ä»¥ä¸ºäº†ç»Ÿä¸€èµ·è§ï¼Œéƒ½ä½¿ç”¨å¤æ•°URLï¼Œæ¯”å¦‚GET /articles/2ã€‚\n\nå¤šçº§URLçš„å¤„ç†ï¼šå½“æŸ¥è¯¢èµ„æºä¿¡æ¯è¾ƒå¤šæ—¶ï¼Œå¾€å¾€ä¼šæœ‰å¤šçº§å‚æ•°å‡ºç°åœ¨URLä¸­ï¼Œæ­¤å¤„è¦åˆ†ä¸‰ç§æƒ…å†µè®¨è®ºï¼š\n\n1. æŸ¥è¯¢ä¿¡æ¯æŒ‡ä»£å½“å±‚å”¯ä¸€idï¼Œå°†æŸ¥è¯¢ä¿¡æ¯æ”¾åœ¨pathä¸­ï¼Œæ„å»ºå”¯ä¸€çš„æŸ¥è¯¢è·¯å¾„ï¼Œå¦‚ï¼š\n`\u003e GET /authors/12/categories/2`\n\n2. æŸ¥è¯¢ä¿¡æ¯å±äºå¯¹å½“å±‚ä¿¡æ¯çš„çŠ¶æ€è¿‡æ»¤ï¼Œå°†æŸ¥è¯¢ä¿¡æ¯æ”¾åœ¨queryä¸­ï¼Œå¦‚ï¼š\n`\u003e GET /articles?published=true`\n\n3. æŸ¥è¯¢ä¿¡æ¯æ—¢åŒ…å«å½“å±‚idï¼Œä¹ŸåŒ…å«è¿‡æ»¤ä¿¡æ¯ï¼Œåˆ†åˆ«å°†idå’Œè¿‡æ»¤ä¿¡æ¯æ”¾åœ¨pathå’Œqueryä¸­ï¼Œå¦‚ï¼š\n`\u003e GET /authors/12/categories/2?published=true`\n\n\n### HTTPçŠ¶æ€ç çº¦æŸ\n\nå®¢æˆ·ç«¯çš„æ¯ä¸€æ¬¡è¯·æ±‚ï¼ŒæœåŠ¡å™¨éƒ½å¿…é¡»ç»™å‡ºå›åº”ã€‚å›åº”åŒ…æ‹¬ HTTP çŠ¶æ€ç å’Œæ•°æ®ä¸¤éƒ¨åˆ†ã€‚HTTP çŠ¶æ€ç å°±æ˜¯ä¸€ä¸ªä¸‰ä½æ•°ï¼Œåˆ†æˆäº”ä¸ªç±»åˆ«ã€‚\n\n```\n- 1xxï¼šç›¸å…³ä¿¡æ¯\n- 2xxï¼šæ“ä½œæˆåŠŸ\n- 3xxï¼šé‡å®šå‘\n- 4xxï¼šå®¢æˆ·ç«¯é”™è¯¯\n- 5xxï¼šæœåŠ¡å™¨é”™è¯¯\n```\nçŠ¶æ€ç è§„èŒƒè§[W3Cå…³äºHTTPçŠ¶æ€ç å®šä¹‰](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)\n\n### åˆ†é¡µä¸æœç´¢æ¥å£çº¦æŸ\n\nåˆ†é¡µæ¥å£å¹¿æ³›å‡ºç°åœ¨æ•°æ®é‡è¾ƒå¤§åœºæ™¯ä¸‹çš„è¡¨æ ¼å‹äº¤äº’ã€‚å³ä½¿æ˜¯æ¸²æŸ“ç®€å•çš„åˆ—è¡¨å…ƒç´ ï¼Œè¶…è¿‡500é¡¹æœ‰å¯èƒ½å¯¼è‡´å‰ç«¯å¡é¡¿ï¼Œè¶…è¿‡5000é¡¹ä»¥ä¸Šï¼ˆä¸åŒæµè§ˆå™¨. ç”µè„‘é…ç½®ä¼šå½±å“è¿™ä¸ªæ•°å­—ï¼‰æœ‰å¯èƒ½å¯¼è‡´å‰ç«¯å´©æºƒã€‚å‡¡æ— æ³•ä¿è¯èƒ½é™åˆ¶æ¥å£è¿”å›æ•°é‡åœ¨ä¸€ä¸ªè¾ƒå°æ•°é‡çº§ï¼ˆ100ä»¥ä¸‹ï¼‰çš„æ¥å£éƒ½éœ€è¦è€ƒè™‘æ”¯æŒåç«¯åˆ†é¡µï¼›å¦‚æœè¿”å›ç»“æœæ•°é‡æ˜¯ä¸å—æ§åˆ¶çš„ï¼ˆå¦‚åŒ…å«ç”¨æˆ·ç”Ÿæˆæ•°æ®ï¼‰ï¼Œåˆ™`å¿…é¡»æ”¯æŒ`åç«¯åˆ†é¡µã€‚\n\u003cbr /\u003e\n\nè¿™é‡Œç»™å‡ºè¯·æ±‚èŒƒä¾‹ï¼š\n\nGET æ¥å£\n\n`?page={page}\u0026size={size}`\n\nPOST æ¥å£\n\n```js\n// æ ¼å¼1\n{\n    page: number;\n    size: number;\n    total: number; // æ•°æ®æ€»é‡\n}\n\n// æ ¼å¼2\n{\n    Limit: number;\n    Offset: number\n    Total: number; // æ•°æ®æ€»é‡\n}\n\n// å…¶ä¸­pageä¸ºå½“å‰è¯·æ±‚é¡µï¼Œä¸ºä»0å¼€å§‹çš„æ­£æ•´æ•°ï¼›\n// sizeä¸ºå½“å‰é¡µå¤§å°ï¼Œå¸¸ç”¨çš„å€¼æœ‰10. 20ç­‰ï¼Œç†è®ºä¸Šéœ€æ”¯æŒä»»æ„æ­£æ•´æ•°ã€‚ç‰¹æ®Šçš„ï¼Œè‹¥ä¸º-1ï¼Œå¯ä»¥çº¦å®šä¸ºæŸ¥è¯¢å…¨éƒ¨\n// LimitåŒsize\n// Offsetä¸ºç›¸å¯¹åç§»é‡ï¼Œä¸ºä»0å¼€å§‹çš„æ­£æ•´æ•°\n```\n\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœäº¤äº’ä¸­å‡ºç°è¿‡æ»¤. æ’åºåŠŸèƒ½ï¼Œåˆ™ç›¸å…³åŠŸèƒ½å¿…è¦æ—¶éƒ½éœ€è¦åç«¯æ”¯æŒã€‚å¦‚æœå‚æ•°èƒ½ä¿è¯ä¸è¶…è¿‡ä¸€å®šé•¿åº¦ï¼Œåˆ™å‚æ•°æ”¾åœ¨queryé‡Œä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚æ•°ç»„å‹å‚æ•°å¯ä»¥ä»¥ç›¸å…³å­—æ®µç”¨é€—å·è¿æ¥çš„å½¢å¼ä¼ é€’ï¼Œå¦‚ï¼š\n\n```\n?status=RUNNING,COMPLETE,ERROR\n```\n\n\u003e ç‰¹æ®Šç±»å‹å¤„ç†\n\u003e 1. å…³äºBooleanç±»å‹ï¼ŒJSONæ•°æ®ä¼ è¾“ä¸­ä½¿ç”¨true/falseå­—æ®µè¿›è¡Œä¼ é€’ã€‚\n\u003e 2. å…³äºæ—¥æœŸç±»å‹ï¼ŒJSONæ•°æ®ä¼ è¾“ä¸­ä¸€å¾‹ä½¿ç”¨é•¿æ•´å½¢æ—¶é—´æˆ³ï¼ˆUnix timeï¼‰è¿›è¡Œä¼ é€’ï¼Œå…·ä½“æ—¥æœŸæ˜¾ç¤ºæ ¼å¼ç”±å‰ç«¯å¤„ç†ã€‚\n\n\n\n## 2. æ³¨æ„äº‹é¡¹\n\nä»»ä½•å½¢å¼çš„æ¥å£å˜æ›´éƒ½ä¼šå¯¹å‰ç«¯äº§ç”Ÿå½±å“ï¼Œæ¯”å¦‚å­—æ®µåç§°çš„ä¿®æ”¹ï¼Œå­—æ®µçš„å¢å‡ï¼Œå­—æ®µç±»å‹çš„ä¿®æ”¹ï¼Œè¯·æ±‚å‚æ•°ç±»å‹çš„å˜åŠ¨ç­‰ã€‚åŸåˆ™ä¸Šå½“æ¥å£å¯¹æ¥å®Œæˆåä¸åº”æœ‰ä»»ä½•å½¢å¼çš„ä¿®æ”¹ï¼Œå¦‚æœä¸€å®šè¦å˜æ›´æ¥å£ï¼Œéœ€åŠæ—¶é€šçŸ¥ç›¸åº”å‰ç«¯å¼€å‘äººå‘˜å¹¶é‡æ–°å¯¹æ¥ã€‚\n\nè¡¨ç¤ºåŒä¸€å«ä¹‰çš„å­—æ®µåœ¨åŒä¸€å¥—åŠŸèƒ½æ¥å£é›†åˆï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ä¸­åº”å°½é‡ä¿è¯ç›¸åŒã€‚åœ¨æ¥å£è®¾è®¡ä¸­ï¼Œå¯¹åŒä¸€å®ä½“è¿›è¡Œæ“ä½œçš„æ¥å£åº”å°½é‡ä¿è¯åœ¨å‚æ•°å’Œè¿”å›å€¼ä¸­ï¼Œè¯¥å®ä½“çš„æ•°æ®ç»“æ„ä¿æŒä¸€è‡´ï¼Œå°½é‡é¿å…å‰ç«¯åšæ•°æ®å¯¹è±¡è½¬æ¢çš„åŠ¨ä½œã€‚\n\n\n## 3. å‚è€ƒ\n\n[é˜®ä¸€å³° RESTful API è®¾è®¡æŒ‡å—](https://www.ruanyifeng.com/blog/2014/05/restful_api.html)\n\n[Representational state transfer](https://en.wikipedia.org/wiki/Representational_state_transfer)\n\n[Hypertext Transfer Protocol](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods)\n\n```\nçµæ„Ÿæ¥æº - Transwarpé€šç”¨æŠ€æœ¯ç»„å‰ç«¯å›¢é˜Ÿjiraæ–‡æ¡£ - å‰åç«¯æ¥å£è§„èŒƒ\n```"])</script><script>self.__next_f.push([1,"4a:T2d3f,"])</script><script>self.__next_f.push([1,"\u003e ä¸“æ è¯´æ˜ï¼šå¯¹äºreact-router v6ç‰ˆæœ¬ï¼Œæœ‰åŒäº‹ååº”ç¼ºå°‘ç›¸å¯¹å®Œæ•´çš„ä¸­æ–‡æ–‡æ¡£ï¼ŒæŸ¥çœ‹ä¸æ–¹ä¾¿ã€‚ä¸ºäº†ä¾¿äºä½¿ç”¨ï¼Œä½œè€…å¯¹[å®˜ç½‘æ–‡æ¡£](https://reactrouter.com/docs/en/v6)è¿›è¡Œé’ˆå¯¹æ€§ç¿»è¯‘ï¼Œä¾¿äºv6ç‰ˆæœ¬æ›´å¹¿æ³›çš„è¢«ä½¿ç”¨ã€‚\n\nä¸Šä¸€ç¯‡ï¼š[# React Router v6 å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ ï¼ˆä¸€ï¼‰ ---- Installation \u0026\u0026 Quick Start](https://juejin.cn/post/7100479939694034952)\n\n## 1. é—®ç­”ç¯èŠ‚\n\n\u003e åŸæ–‡è·¯å¾„ï¼šhttps://reactrouter.com/docs/en/v6/getting-started/faq#faqs\n\nä¸‹é¢æ˜¯å¤§å®¶åœ¨ä½¿ç”¨`React Router v6`æ—¶ç»å¸¸é—®åˆ°çš„é—®é¢˜ã€‚\n\n### 1. å½“æˆ‘ç”¨çš„æ˜¯ç±»å¼ç»„ä»¶ï¼Œåˆå¿…é¡»ä½¿ç”¨Routeræ—¶ï¼Œæˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ\n\nReact Router v6ç‰ˆæœ¬ä¸å†æ”¯æŒ`withRouter`ã€‚å½“ä½¿ç”¨ç±»å¼Reactç»„ä»¶æ—¶ï¼Œä¸èƒ½å¤Ÿä½¿ç”¨hooksï¼Œç„¶è€Œåœ¨React Router v6ä¸­éƒ½æ˜¯ç”¨hookså‡½æ•°æ¥å…±äº«è·¯ç”±çŠ¶æ€ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€ç±»å¼ç»„ä»¶ä¸èƒ½ä½¿ç”¨React Router v6ã€‚æ­¤æ—¶ä½ éœ€è¦å†™ä¸€ä¸ªè‡ªå·±çš„`withRouter`å°è£…å‡½æ•°ï¼ˆReact16.8+ï¼‰ï¼š\n\n```tsx\nimport {\n  useLocation,\n  useNavigate,\n  useParams,\n} from \"react-router-dom\";\n\nfunction withRouter(Component) {\n  function ComponentWithRouterProp(props) {\n    let location = useLocation();\n    let navigate = useNavigate();\n    let params = useParams();\n    return (\n      \u003cComponent\n        {...props}\n        router={{ location, navigate, params }}\n      /\u003e\n    );\n  }\n\n  return ComponentWithRouterProp;\n}\n```\n\n### 2. ä¸ºä»€ä¹ˆ`\u003cRoute\u003e`æ ‡ç­¾ç”¨`element`å±æ€§æ›¿ä»£`render`å’Œ`component`ï¼Ÿ\n\nåœ¨React Router v6ä¸­ï¼Œæˆ‘ä»¬æŠŠv5ä¸­`\u003cRoute component\u003e`å’Œ`\u003cRoute render\u003e`ä¸¤ä¸ªAPIç”¨`\u003cRoute element\u003e`æ›¿æ¢ï¼Œä¸»è¦åŸå› æœ‰å¦‚ä¸‹å‡ ç‚¹ï¼š\n\n1. å¯¹äºåˆå­¦è€…ï¼Œè‚¯å®šä¼šç»å¸¸ä½¿ç”¨ç»„ä»¶æ‡’åŠ è½½`\u003cSuspense fallback={\u003cSpinner /\u003e}\u003e`ï¼Œè¿™ä¸ªAPIé‡Œï¼Œfallbackå°±æ˜¯ä¸€ä¸ª`ReactÂ element`ï¼Œæˆ‘ä»¬ä¹‹æ‰€ä»¥è¿™ä¹ˆè®¾è®¡ï¼Œå°±æ˜¯ä¸ºäº†è®©åˆå­¦è€…èƒ½å¤Ÿæ›´å®¹æ˜“. æ›´å¹³æ»‘çš„ä½¿ç”¨æ¸²æŸ“å‡½æ•°ã€‚\n\n2. ï¼ˆå®˜ç½‘è¯´çš„æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘æ€»ç»“ä¸€ä¸‹ï¼‰v5ç‰ˆæœ¬ä¸­ï¼Œ`\u003cRoute component\u003e`ä¸èƒ½ä¼ é€’propsï¼Œæƒ³è¦ä¼ é€’ç»„ä»¶å‚æ•°ï¼Œå°±éœ€è¦ä½¿ç”¨`\u003cRoute render\u003e`ï¼Œè¿™å°±å¯¼è‡´äº†v4/v5çš„æ¸²æŸ“APIä½“é‡ä¼šæ›´å¤§ä¸€äº›ï¼Œä¸‹é¢æ˜¯ä¾‹å­ï¼š\n\n```jsx\n// å“¦å¼ï¼Œçœ‹èµ·æ¥æ˜¯ä¸ªä¸é”™çš„å†™æ³•ï¼\n\u003cRoute path=\":userId\" component={Profile} /\u003e\n\n// ä½†æ˜¯å‘¢ï¼Œæˆ‘æ€ä¹ˆç»™ \u003cProfile\u003e ä¼ é€’ props å‘¢??\n// Hmm, æˆ‘è¿˜å¾—ç”¨å¦å¤–ä¸€ç§æ–¹å¼ï¼šrender\n\u003cRoute\n  path=\":userId\"\n  render={routeProps =\u003e (\n    \u003cProfile routeProps={routeProps} animate={true} /\u003e\n  )}\n/\u003e\n\n// æ‰€ä»¥ï¼Œåœ¨v5ç‰ˆæœ¬ä¸­æœ‰ä¸¤ç§è·¯ç”±ç»„ä»¶æ¸²æŸ“æ–¹å¼ :/\n\n// ä½†æ˜¯è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå…³äºæ‰€æœ‰URLéƒ½ä¸èƒ½åŒ¹é…çš„404æƒ…å†µå‘¢ï¼Ÿ\n// æˆ–è®¸è¿˜å¯ä»¥ä½¿ç”¨childrenæ–¹æ³•\n\u003cRoute\n  path=\":userId\"\n  children={({ match }) =\u003e (\n    match ? (\n      \u003cProfile match={match} animate={true} /\u003e\n    ) : (\n      \u003cNotFound /\u003e\n    )\n  )}\n/\u003e\n\n// å¦‚æœæƒ³è¦æ‹¿åˆ°è·¯ç”±çš„åŒ¹é… æˆ–è€… æƒ³åœ¨åµŒå¥—è·¯ç”±æ¯”è¾ƒæ·±å±‚çš„åœ°æ–¹æ¥ä¸€ä¸ªè·¯ç”±è·³è½¬å‘¢ï¼Ÿ\nfunction DeepComponent(routeStuff) {\n  // å•Šï¼Œå¤æ‚çš„å®ç°~\n}\nexport default withRouter(DeepComponent);\n\n// ä»¥ä¸Šæ˜¯åˆ—ä¸¾çš„ä½œè€…èƒ½æƒ³åˆ°çš„ä½¿ç”¨æƒ…å†µã€‚\n```\n\nReactæœ¬èº«ä¸æä¾›ä»»ä½•è·å–`\u003cRoute\u003e`ä¿¡æ¯çš„æ–¹å¼ï¼Œ æ‰€ä»¥æˆ‘ä»¬å¿…é¡»å‘æ˜ä¸€ç§æ—¢èƒ½è·å–Routeä¿¡æ¯ï¼Œåˆèƒ½è·å–è‡ªå®šä¹‰propsçš„æ–¹å¼ã€‚åº†å¹¸çš„æ˜¯ï¼Œhooksçš„å‡ºç°ï¼Œå¯ä»¥æ›¿ä»£ä¹‹å‰çš„`component`. `render`å’Œé«˜é˜¶ç»„ä»¶ã€‚å†çœ‹çœ‹é’ˆå¯¹ä»¥ä¸Šæƒ…å†µï¼Œv6æ˜¯æ€ä¹ˆå®ç°çš„ï¼š\n\n```jsx\n// å°±åƒReactåŸç”Ÿçš„ \u003cSuspense\u003e é‚£æ ·ä½¿ç”¨è·¯ç”±ç»„ä»¶!\n// ä¸éœ€è¦é¢å¤–å¢åŠ å­¦ä¹ ä»»åŠ¡.\n\u003cRoute path=\":userId\" element={\u003cProfile /\u003e} /\u003e\n\n// æˆ‘ä»¬æ¥ä¼ é€’è‡ªå·±çš„props\n\u003cRoute path=\":userId\" element={\u003cProfile animate={true} /\u003e} /\u003e\n\n// è·å–è·¯ç”±å‚æ•°å’Œè·¯ç”±å®šä½ä¿¡æ¯\nfunction Profile({ animate }) {\n  let params = useParams();\n  let location = useLocation();\n}\n\n// è·¯ç”±åµŒå¥—æ·±å±‚çš„ç»„ä»¶è¿›è¡Œè·³è½¬\nfunction DeepComponent() {\n  // ä¸€ä¸ªhooksæå®šï¼\n  let navigate = useNavigate();\n}\n```\n\nå¦å¤–è¯´ä¸€ä¸‹ï¼Œv6ä¸­ä¸ä½¿ç”¨`children`ï¼Œè¿˜æœ‰ä¸ªåŸå› ï¼Œv6åœ¨åµŒå¥—è·¯ç”±ä¸­å·²ç»å°†childrenä½œä¸ºå†…éƒ¨ä¿ç•™å…³é”®å­—äº†ï¼Œè¿™é‡Œå°±ä¸èƒ½å†ç”¨äº†ï¼š[åµŒå¥—è·¯ç”±](https://reactrouter.com/docs/en/v6/getting-started/overview#nested-routes)\n\n### 3. v6å¦‚ä½•å®šä¹‰404é¡µé¢\n\nåœ¨v4ä¸­ï¼Œæ¥æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªè·¯ç”±ä¹‹å¤–çš„pathï¼Œv5ä¸­å¯ä»¥ä½¿ç”¨`path=\"*\"`ï¼Œv6ä¸­æ²¿ç”¨v5çš„ç”¨æ³•ï¼Œä¸è¿‡æ›´ç®€æ´ï¼š\n\n```jsx\n\u003cRoute path=\"*\" element={\u003cNoMatch /\u003e} /\u003e\n```\n\n### 4. ä¸ºä»€ä¹ˆæˆ‘çš„`\u003cRoute\u003e`ä¸æ¸²æŸ“ï¼Ÿå¥½æ°”ï¼\n\nåœ¨v5ä¸­ï¼Œ`\u003cRoute\u003e`ç»„ä»¶å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„Reactç»„ä»¶ï¼ŒURLæ²¡æœ‰åŒ¹é…åˆ°çš„æ—¶å€™ï¼Œå°±ä¼šåƒæ˜¯ifè¯­å¥æ²¡æœ‰è¦†ç›–åˆ°ä¸€æ ·ï¼Œä¸ä¼šæ¸²æŸ“ï¼›åœ¨v6ä¸­ï¼Œ`\u003cRoute\u003e`å…ƒç´ å¹¶æ²¡æœ‰çœŸæ­£çš„æ¸²æŸ“å‡ºæ¥ï¼Œä»–åªæ˜¯ä¸€ä¸ªé…ç½®ã€‚æˆ‘ä»¬æ¥ä¸¾ä¾‹å¯¹æ¯”ä¸€ä¸‹ï¼š\n\nv5ä¸­ï¼Œ`\u003cRoute\u003e`å°±æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå½“åŒ¹é…åˆ°è·¯å¾„`/my-route`æ—¶ï¼Œ`MyRoute`ç»„ä»¶å°±ä¼šè¢«æ¸²æŸ“å‡ºæ¥ï¼š\n```jsx\nlet App = () =\u003e (\n  \u003cdiv\u003e\n    \u003cMyRoute /\u003e\n  \u003c/div\u003e\n);\n\nlet MyRoute = ({ element, ...rest }) =\u003e {\n  return (\n    \u003cRoute path=\"/my-route\" children={\u003cp\u003eHello!\u003c/p\u003e} /\u003e\n  );\n};\n```\n\nv6ä¸­ï¼Œä½ è¦å†è¿™æ ·å†™å°±æ¸²æŸ“ä¸å‡ºæ¥äº†ï¼š\n```jsx\n// ERROR !!!\nlet App = () =\u003e (\n  \u003cRoutes\u003e\n    \u003cMyRoute /\u003e\n  \u003c/Routes\u003e\n);\n\nlet MyRoute = () =\u003e {\n  // \u003cRoutes\u003eå¯çœ‹ä¸åˆ°ä½ è¿™é‡Œè¾¹é…ç½®çš„path\n  return (\n    \u003cRoute path=\"/my-route\" children={\u003cp\u003eHello!\u003c/p\u003e} /\u003e\n  );\n};\n```\nv6çš„æ­£ç¡®å†™æ³•åº”è¯¥éµå¾ªä¸¤ä¸ªåŸåˆ™ï¼š\n\n1. åœ¨`\u003cRoutes\u003e`ä¸­åªæ”¾ç½®`\u003cRoute\u003e`\n\n2. æŠŠéœ€è¦æ¸²æŸ“çš„éƒ½æ”¾åˆ°`element`ä¸­\n\nç¤ºä¾‹ï¼š\n\n```jsx\nlet App = () =\u003e (\n  \u003cdiv\u003e\n    \u003cRoutes\u003e\n      \u003cRoute path=\"/my-route\" element={\u003cMyRoute /\u003e} /\u003e\n    \u003c/Routes\u003e\n  \u003c/div\u003e\n);\n\nlet MyRoute = () =\u003e {\n  return \u003cp\u003eHello!\u003c/p\u003e;\n};\n```\n\nä½¿ç”¨`\u003cRoutes\u003e`æ¥é™æ€åœ°é…ç½®å…¨å±€è·¯ç”±ï¼Œèƒ½å¤Ÿå‘æŒ¥å‡ºv6æ›´å¤šçš„ç‰¹æ€§ã€‚æˆ‘ä»¬ä¹Ÿé¼“åŠ±å¼€å‘è€…å°†æ‰€æœ‰`\u003cRoute\u003e`éƒ½æ”¾åˆ°ä¸€ä¸ª`\u003cRoutes\u003e`æ¥é…ç½®è·¯ç”±ã€‚å¦‚æœä½ çœŸçš„æƒ³è¦ä¸ªæ€§åŒ–çš„åŒ¹é…ç‹¬ç«‹URLçš„ç»„ä»¶ï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·ä¹¦å†™ï¼š\n\n```jsx\nfunction MatchPath({ path, Comp }) {\n  let match = useMatch(path);\n  return match ? \u003cComp {...match} /\u003e : null;\n}\n\n// åŒ¹é…ä»»ä½•åœ°æ–¹çš„ç»„ä»¶ï¼Œä¸ä¸€å®šæœ‰ \u003cRoutes\u003e åŒ…è£¹\n\u003cMatchPath path=\"/accounts/:id\" Comp={Account} /\u003e;\n```\n\n### 5. è·¯ç”±æ ‘æ„å»ºçš„è¿ç§»å·¥ä½œ\n\nåœ¨v5ç‰ˆæœ¬ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨`\u003cRoute\u003e`å’Œ`\u003cSwitch\u003e`æ ‡ç­¾æ¥å¤„ç†è·¯ç”±åµŒå¥—é—®é¢˜ï¼š\n\n```jsx\n// è·¯ç”±æ ‘é¡¶éƒ¨\n\u003cSwitch\u003e\n  \u003cRoute path=\"/users\" component={Users} /\u003e\n\u003c/Switch\u003e;\n\n// è·¯ç”±æ ‘ä¸­æŸä¸ªåœ°æ–¹\nfunction Users() {\n  return (\n    \u003cdiv\u003e\n      \u003ch1\u003eUsers\u003c/h1\u003e\n      \u003cSwitch\u003e\n        \u003cRoute path=\"/users/account\" component={Account} /\u003e\n      \u003c/Switch\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nv6ä¸­çš„ä½¿ç”¨åŸºæœ¬ç±»ä¼¼ï¼Œå°†`Switch`æ¢æˆ`Routes`ã€‚ä¸è¿‡éœ€è¦æ³¨æ„ä»¥ä¸‹ä¸¤ç‚¹ï¼š\n\n1. åœ¨çˆ¶è·¯ç”±çš„pathé…ç½®ä¸­ï¼Œéœ€è¦åŠ å…¥`/*`æ¥åŒ¹é…elementä¸­é…ç½®çš„å­è·¯ç”±\n\n2. åµŒå¥—è·¯ç”±ä¸­ä¸éœ€è¦è·å–å®Œæ•´çš„è·¯å¾„ï¼Œv6æ”¯æŒç›¸å¯¹è·¯å¾„\n\nç¤ºä¾‹ï¼š\n```jsx\n// é¡¶å±‚è·¯ç”±\n\u003cRoutes\u003e\n  \u003cRoute path=\"/users/*\" element={\u003cUsers /\u003e} /\u003e\n\u003c/Routes\u003e;\n\n// è·¯ç”±æ ‘ä¸­æŸä¸ªåœ°æ–¹\nfunction Users() {\n  return (\n    \u003cdiv\u003e\n      \u003ch1\u003eUsers\u003c/h1\u003e\n      \u003cRoutes\u003e\n        \u003cRoute path=\"account\" element={\u003cAccount /\u003e} /\u003e\n      \u003c/Routes\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nå¦ï¼Œåœ¨v5ä¸­å¦‚æœæœ‰æ¸¸ç¦»çš„`\u003cRoute\u003e`ï¼Œåœ¨è¿ç§»æ—¶éœ€è¦ç”¨`\u003cRoutes\u003e`åŒ…è£¹ï¼š\n```jsx\n// v5\n\u003cRoute path=\"/contact\" component={Contact} /\u003e\n\n// v6\n\u003cRoutes\u003e\n  \u003cRoute path=\"contact\" element={\u003cContact /\u003e} /\u003e\n\u003c/Routes\u003e\n```\n\n### 6. v6è¿˜èƒ½ä½¿ç”¨æ­£åˆ™åŒ¹é…å—ï¼Ÿ\n\nv6ä¸­å·²ç»ç§»é™¤äº†æ­£åˆ™åŒ¹é…~~ æœ‰ä»¥ä¸‹ä¸¤ä¸ªåŸå› ï¼š\n\n1. æ­£åˆ™è·¯ç”±åœ¨ä½¿ç”¨ä¸­é€ æˆäº†å¾ˆå¤šä¼˜å…ˆçº§åŒ¹é…çš„é—®é¢˜ï¼Œå› ä¸ºæ­£åˆ™æ˜¯æ²¡æœ‰ä¼˜å…ˆçº§è¿™ä¸ªæ¦‚å¿µçš„\n\n2. æ­£åˆ™åŒ¹é…çš„ä¾èµ–åŒ…å¤ªå¤§äº†ï¼Œå¦‚æœå†æ”¾å›æ¥ï¼Œv6çš„ä½“ç§¯ä¼šå¢åŠ 1/2ï¼ˆå³æ­£åˆ™å ç”¨1/3ï¼‰\n\nåœ¨è°ƒç ”è¿‡å¤§é‡çš„ç”¨ä¾‹åï¼Œæˆ‘ä»¬å‘ç°ï¼Œå®Œå…¨å¯ä»¥è§„é¿æ‰ç›´æ¥ä½¿ç”¨æ­£åˆ™æ¥åŒ¹é…è·¯ç”±ã€‚æ‰€ä»¥ï¼Œå†ä¸‰æƒè¡¡ä¹‹ä¸‹ï¼Œæˆ‘ä»¬åšäº†è¿™ä¸ªé‡è¦çš„åˆ å‡ï¼Œæ¥ç¼©å°React Routerçš„ä½“ç§¯å’Œè§„é¿å·²çŸ¥çš„ä¼˜å…ˆçº§é—®é¢˜ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œæ­£åˆ™è·¯ç”±ä»…ä»…æ˜¯ç”¨æ¥åŒ¹é…ä¸€ä¸ªURLå­—ç¬¦ä¸²ç‰‡æ®µï¼Œå®ç°å¦‚ä¸‹åŠŸèƒ½ï¼š\n\n1. åŒ¹é…å¤šä¸ªé™æ€å€¼\nä¸¾ä¾‹ï¼ˆv5ï¼‰ï¼š\n```jsx\n// v5-lang-route.js\nfunction App() {\n  return (\n    \u003cSwitch\u003e\n      \u003cRoute path={/(en|es|fr)/} component={Lang} /\u003e\n    \u003c/Switch\u003e\n  );\n}\n\nfunction Lang({ params }) {\n  let lang = params[0];\n  let translations = I81n[lang];\n  // ...\n}\n```\nè¿™äº›å­—ç¬¦ä¸²éƒ½æ˜¯é™æ€å†™å…¥çš„è·¯å¾„ï¼Œåœ¨v6ä¸­ï¼Œå®Œå…¨å¯ä»¥ç”¨ä¸‰ä¸ª`Route`ä»£æ›¿ï¼Œå¦‚æœæœ‰å¾ˆå¤šè¦åŒ¹é…çš„ï¼Œæ”¾åœ¨æ•°ç»„é‡Œæ¥ä¸ªéå†å°±è¡Œï¼š\n```jsx\n// v6-lang-route.js\nfunction App() {\n  return (\n    \u003cRoutes\u003e\n      \u003cRoute path=\"en\" element={\u003cLang lang=\"en\" /\u003e} /\u003e\n      \u003cRoute path=\"es\" element={\u003cLang lang=\"es\" /\u003e} /\u003e\n      \u003cRoute path=\"fr\" element={\u003cLang lang=\"fr\" /\u003e} /\u003e\n    \u003c/Routes\u003e\n  );\n}\n\nfunction Lang({ lang }) {\n  let translations = I81n[lang];\n  // ...\n}\n```\n\n2. æ ¡éªŒå‚æ•°ï¼ˆæ¯”å¦‚æ˜¯ä¸æ˜¯numberç±»å‹ï¼‰\n\nä¸¾ä¾‹ï¼ˆv5ï¼‰ï¼š\n```jsx\n// v5-userId-route.js\nfunction App() {\n  return (\n    \u003cSwitch\u003e\n      \u003cRoute path={/users/(\\d+)/} component={User} /\u003e\n    \u003c/Switch\u003e\n  );\n}\n\nfunction User({ params }) {\n  let id = params[0];\n  // ...\n}\n```\nåœ¨v6ä¸­éœ€è¦åšä¸€ç‚¹å¾®é‡çš„å·¥ä½œæ¥å®ç°è¿™ç§æ ¡éªŒï¼š\n```jsx\n// v6-userId-route.js\nfunction App() {\n  return (\n    \u003cRoutes\u003e\n      \u003cRoute path=\"/users/:id\" element={\u003cValidateUser /\u003e} /\u003e\n      \u003cRoute path=\"/users/*\" element={\u003cNotFound /\u003e} /\u003e\n    \u003c/Routes\u003e\n  );\n}\n\nfunction ValidateUser() {\n  let params = useParams();\n  let userId = params.id.match(/\\d+/);\n  if (!userId) {\n    return \u003cNotFound /\u003e;\n  }\n  return \u003cUser id={params.userId} /\u003e;\n}\n\nfunction User(props) {\n  let id = props.id;\n  // ...\n}\n```\n\nåœ¨v5ä¸­ï¼Œå¦‚æœæ­£åˆ™è·¯ç”±ä¸èƒ½åŒ¹é…ä»»ä½•ä¸€ä¸ªURLæ—¶ï¼Œ`\u003cSwitch\u003e`ä¼šå°è¯•åŒ¹é…æ¥ä¸‹æ¥çš„è·¯ç”±ï¼š\n```jsx\n// v5-switch.js\nfunction App() {\n  return (\n    \u003cSwitch\u003e\n      \u003cRoute path={/users/(\\d+)/} component={User} /\u003e\n      \u003cRoute path=\"/users/new\" exact component={NewUser} /\u003e\n      \u003cRoute\n        path=\"/users/inactive\"\n        exact\n        component={InactiveUsers}\n      /\u003e\n      // 'users/abc' ä¼šåŒ¹é…åˆ°è¿™é‡Œ\n      \u003cRoute path=\"/users/*\" component={NotFound} /\u003e\n    \u003c/Switch\u003e\n  );\n}\n```\n\nåœ¨v6ä¸­å°±ä¸ç”¨æ‹…å¿ƒè¿™ç§é—®é¢˜ï¼Œåœ¨ä¸‹è¾¹çš„ä¾‹å­ä¸­ï¼Œç”±äºv6çš„ç²¾ç¡®åŒ¹é…æœºåˆ¶ï¼Œ`:userId`ä¼šä¼˜å…ˆè¢«åŒ¹é…æ‰ï¼Œæ ¡éªŒçš„å·¥ä½œæ˜¯åœ¨åŒ¹é…åˆ°ä¹‹ååœ¨å­ç»„ä»¶å†…è¿›è¡Œçš„ï¼Œè€Œä¸æ˜¯é€šè¿‡æ ¡éªŒæ¥åŒ¹é…ã€‚\n```jsx\n// v6-ranked.js\nfunction App() {\n  return (\n    \u003cRoutes\u003e\n      // '/users/123', '/users/abc' éƒ½ä¼šåŒ¹é…åˆ°\n      \u003cRoute path=\"/users/:id\" element={\u003cValidateUser /\u003e} /\u003e\n      // '/users/new' æ‰èƒ½åŒ¹é…åˆ°\n      \u003cRoute path=\"/users/new\" element={\u003cNewUser /\u003e} /\u003e\n      \u003cRoute\n        path=\"/users/inactive\"\n        element={\u003cInactiveUsers /\u003e}\n      /\u003e\n    \u003c/Routes\u003e\n  );\n}\n```\n\näº‹å®ä¸Šï¼Œ å¦‚æœä½¿ç”¨è€…æ²¡æœ‰æŒ‰ç…§æ­£ç¡®çš„é¡ºåºå¸ƒå±€è‡ªå·±çš„è·¯ç”±æ—¶ï¼Œv5ä¸­ç¡®å®ä¼šå­˜åœ¨è·¯ç”±ä¼˜å…ˆçº§é”™ä¹±çš„é—®é¢˜ã€‚v6å¼•å…¥äº†ç²¾å‡†åŒ¹é…è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚\n\n\u003chr /\u003e\n\nå¦‚æœä½ æ˜¯ç”¨çš„æ˜¯`Remix`ï¼Œåœ¨è·¯ç”±æ²¡æœ‰åŒ¹é…åˆ°æ—¶ï¼Œä½ å¯ä»¥è¿”å›å¸¦`40x`çŠ¶æ€ç çš„Loaderï¼Œç”±äºLoaderè¿è¡Œåœ¨æœåŠ¡ç«¯ï¼Œæ‰€ä»¥è¿™å°†ä¼šå‡å°‘å‰ç«¯ä»£ç æ‰“åŒ…çš„ä½“ç§¯ï¼š\n```jsx\n// remix-useLoaderData.js\nimport { useLoaderData } from \"remix\";\n\nexport async function loader({ params }) {\n  if (!params.id.match(/\\d+/)) {\n    throw new Response(\"\", { status: 400 });\n  }\n\n  let user = await fakeDb.user.find({\n    where: { id: params.id },\n  });\n  if (!user) {\n    throw new Response(\"\", { status: 404 });\n  }\n\n  return user;\n}\n\nfunction User() {\n  let user = useLoaderData();\n  // ...\n}\n```\n\nä¸åŒäºç›´æ¥æ¸²æŸ“ç»„ä»¶ï¼Œremixä¼šæ¸²æŸ“æœ€è¿‘çš„[catch boundary](https://remix.run/docs/en/v1/api/conventions#catchboundary)ã€‚\n\n\u003chr /\u003e\n\nFAQs finished !"])</script><script>self.__next_f.push([1,"4b:T36b8,"])</script><script>self.__next_f.push([1,"\u003e ä¸“æ è¯´æ˜ï¼šå¯¹äºreact-router v6ç‰ˆæœ¬ï¼Œæœ‰åŒäº‹ååº”ç¼ºå°‘ç›¸å¯¹å®Œæ•´çš„ä¸­æ–‡æ–‡æ¡£ï¼ŒæŸ¥çœ‹ä¸æ–¹ä¾¿ã€‚ä¸ºäº†ä¾¿äºä½¿ç”¨ï¼Œä½œè€…å¯¹[å®˜ç½‘æ–‡æ¡£](https://reactrouter.com/docs/en/v6)è¿›è¡Œé’ˆå¯¹æ€§ç¿»è¯‘ï¼Œä¾¿äºv6ç‰ˆæœ¬æ›´å¹¿æ³›çš„è¢«ä½¿ç”¨ã€‚\n\n## 1. å®‰è£…\n\n\næœ¬æ–‡æ¡£ä»‹ç»ä½¿ç”¨åŸºäºReactæ¡†æ¶çš„ä¸åŒæ„å»ºå·¥å…·æ¥é…ç½®React Routerçš„ä¸€èˆ¬æ–¹æ¡ˆã€‚\n\n### åŸºç¡€å®‰è£…\n\n\u003e åŸæ–‡è·¯å¾„ https://reactrouter.com/docs/en/v6/getting-started/installation#basic-installation\n\nå¤§å¤šæ•°Reactå·¥ç¨‹é¡¹ç›®éƒ½ä½¿ç”¨åŒ…ç®¡ç†å™¨[npm](https://www.npmjs.com/) æˆ–è€…Â [Yarn](https://yarnpkg.com/)è¿›è¡Œä¾èµ–ç®¡ç†ã€‚ä½¿ç”¨React Routerå‰çš„ç¬¬ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯åŸºäºä½ çš„åŒ…ç®¡ç†å·¥å…·è¿›è¡ŒReact Routerçš„å®‰è£…ã€‚\n\n1. npm\n\n```sh\n$ npm install react-router-dom@6\n```\n2. yarn\n\n```sh\n$ yarn add react-router-dom@6\n```\n3. pnpm\n\n```sh\n$ pnpm add react-router-dom@6\n```\n\n### åŸºäºCreate-react-appé¡¹ç›®çš„å®‰è£…\n\n\u003e åŸæ–‡è·¯å¾„ https://reactrouter.com/docs/en/v6/getting-started/installation#create-react-app\n\nå½“ä½ åœ¨craé¡¹ç›®ä¸­å®‰è£…å¥½ä¾èµ–åï¼Œæ‰“å¼€æ–‡ä»¶`src/index.js`ï¼Œ ä»Â `react-router-dom`Â å¼•å…¥ `BrowserRouter`ï¼Œ å¹¶ä½¿ç”¨æ ‡ç­¾`\u003cBrowserRouter\u003e`åŒ…è£¹æ–‡ä»¶:\n\n\n```jsx\nimport * as React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport { BrowserRouter } from \"react-router-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\n\nconst root = ReactDOM.createRoot(\n  document.getElementById(\"root\")\n);\nroot.render(\n  \u003cReact.StrictMode\u003e\n    \u003cBrowserRouter\u003e\n      \u003cApp /\u003e\n    \u003c/BrowserRouter\u003e\n  \u003c/React.StrictMode\u003e\n);\n```\n\næ¥ä¸‹æ¥ä½ å°±å¯ä»¥åœ¨appä¸­ä»»æ„åœ°æ–¹ä½¿ç”¨è·¯ç”±äº†ï¼š\n\n```jsx\nimport * as React from \"react\";\nimport { Routes, Route, Link } from \"react-router-dom\";\nimport \"./App.css\";\n\nfunction App() {\n  return (\n    \u003cdiv className=\"App\"\u003e\n      \u003ch1\u003eWelcome to React Router!\u003c/h1\u003e\n      \u003cRoutes\u003e\n        \u003cRoute path=\"/\" element={\u003cHome /\u003e} /\u003e\n        \u003cRoute path=\"about\" element={\u003cAbout /\u003e} /\u003e\n      \u003c/Routes\u003e\n    \u003c/div\u003e\n  );\n}\n```\nä¸Šè¿°æ–‡ä»¶ä¸­ï¼ŒHomeå’ŒAboutæ˜¯è‡ªå®šä¹‰çš„è·¯ç”±ç»„ä»¶ï¼Œé€šè¿‡importå¼•å…¥ã€‚\n\n### åŸºäºParcelé¡¹ç›®çš„å®‰è£…\n\nåœ¨package.jsonä¸­æ·»åŠ è„šæœ¬ï¼š\n\n```json\n\"scripts\": {\n  \"start\": \"parcel index.html\"\n}\n```\n\nå®‰è£…å®Œä¾èµ–åï¼Œåœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶`.babelrc`:\n```js\n{\n  \"presets\": [\"@babel/preset-react\"]\n}\n```\n\nç„¶ååœ¨æ ¹ç›®å½•çš„`index.js`æ–‡ä»¶ä¸­å³å¯ä½¿ç”¨ï¼š\n```jsx\nimport * as React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport { BrowserRouter } from \"react-router-dom\";\nimport App from \"./App.js\";\n\nconst root = ReactDOM.createRoot(\n  document.getElementById(\"root\")\n);\nroot.render(\n  \u003cReact.StrictMode\u003e\n    \u003cBrowserRouter\u003e\n      \u003cApp /\u003e\n    \u003c/BrowserRouter\u003e\n  \u003c/React.StrictMode\u003e\n);\n```\nå†™å…¥æ–‡ä»¶`index.html`ï¼š\n```html\n\u003cbody\u003e\n  \u003cnoscript\n    \u003eYou need to enable JavaScript to run this\n    app.\n  \u003c/noscript\u003e\n  \u003cdiv id=\"root\"\u003e\u003c/div\u003e\n  \u003cscript src=\"./index.js\"\u003e\u003c/script\u003e\n\u003c/body\u003e\n```\næ¥ä¸‹æ¥å°±å¯ä»¥åœ¨Appç»„ä»·ä¸­ä½¿ç”¨routeräº†ï¼Œä½¿ç”¨æ–¹å¼åŒcraé¡¹ç›®ã€‚\n\n### åŸºäºWebpacké¡¹ç›®çš„å®‰è£…\n\n\u003e åŸæ–‡è·¯å¾„ https://reactrouter.com/docs/en/v6/getting-started/installation#webpack\n\nwebpackæ˜¯ä¸€ç§æ›´ç»†ç²’åº¦çš„æ„å»ºå·¥å…·ï¼Œæ‚¨å¯ä»¥è¿›è¡Œæ›´åŠ ç»†å¾®çš„é…ç½®ã€‚å®‰è£…å®Œå¿…è¦çš„ä¾èµ–åï¼Œä¾¿å¯ä»¥å¼•å…¥è·¯ç”±äº†ï¼š\n```jsx\nimport {\n  BrowserRouter,\n  Routes,\n  Route,\n} from \"react-router-dom\";\n\nfunction App() {\n  return (\n    \u003cBrowserRouter\u003e\n      \u003cdiv\u003e\n        \u003ch1\u003eHello, React Router!\u003c/h1\u003e\n        \u003cRoutes\u003e\n          \u003cRoute path=\"/\" element={\u003cHome /\u003e} /\u003e\n        \u003c/Routes\u003e\n      \u003c/div\u003e\n    \u003c/BrowserRouter\u003e\n  );\n}\n```\n\n### ä½¿ç”¨scriptæ ‡ç­¾å…¨å±€å®‰è£…\n\n\u003e åŸæ–‡è·¯å¾„ https://reactrouter.com/docs/en/v6/getting-started/installation#html-script-tags\n\nReact-router v6ä¸React16.8+å®Œå…¨å…¼å®¹ã€‚æ‚¨å®Œå…¨å¯ä»¥åœ¨ä¸€ä¸ªHTMLä¸­é€šè¿‡`\u003cscript\u003e`å¼•å…¥å¯¹åº”çš„jsæ–‡ä»¶è¿›è¡Œå…¨å±€ä½¿ç”¨ï¼šï¼ˆæˆ‘è¿™é‡Œåˆ æ‰äº†åŸæ–‡çš„æ³¨é‡Šï¼‰\n```html\n\u003cbody\u003e\n  \u003cdiv id=\"root\"\u003e\u003c/div\u003e\n\n  \u003cscript src=\"https://unpkg.com/react@\u003e=16.8/umd/react.development.js\" crossorigin\u003e\u003c/script\u003e\n  \u003cscript src=\"https://unpkg.com/react-dom@\u003e=16.8/umd/react-dom.development.js\" crossorigin\u003e\u003c/script\u003e\n\n  \u003c!-- Load history --\u003e\n  \u003cscript src=\"https://unpkg.com/history@5/umd/history.development.js\" crossorigin\u003e\u003c/script\u003e\n\n  \u003c!-- Load React Router and React Router DOM --\u003e\n  \u003cscript src=\"https://unpkg.com/react-router@6/umd/react-router.development.js\" crossorigin\u003e\u003c/script\u003e\n  \u003cscript src=\"https://unpkg.com/react-router-dom@6/umd/react-router-dom.development.js\" crossorigin\u003e\u003c/script\u003e\n\n  \u003c!-- A simple example app --\u003e\n  \u003cscript\u003e\n  var e = React.createElement;\n  var Router = ReactRouterDOM.BrowserRouter;\n  var Routes = ReactRouterDOM.Routes;\n  var Route = ReactRouterDOM.Route;\n\n  ReactDOM.render(\n    (\n      e(Router, null, (\n        e(Routes, null, (\n          e(Route, {\n            element: e('div', null, 'Hello, React Router!')\n          })\n        ))\n      ))\n    ),\n    document.getElementById('root')\n  );\n  \u003c/script\u003e\n\n\u003c/body\u003e\n```\nè™½ç„¶è¿™ç§æ–¹æ³•æ¥å¾—æ¯”è¾ƒå¿«ï¼Œä½†æ˜¯ä¹Ÿå¼•å…¥äº†ä¸€äº›ä¸å¿…è¦çš„ä»£ç å¼•ç”¨ã€‚React RouteråŒ…å«äº†å¾ˆå¤šå°å·¥å…·å’Œç»„ä»¶ï¼ŒæŒ‰éœ€å¼•å…¥æ‰æ˜¯ç‹é“ã€‚æ‰€ä»¥è¿˜æ˜¯æ¨èå‰ä¸‰ç§å®‰è£…æ–¹å¼ã€‚\n\n\n## 2. å¿«é€Ÿå¼€å§‹ï¼ˆæœ‰ä¸€äº›ä¸å®‰è£…é‡å¤ï¼‰\n\n\u003e åŸæ–‡åœ°å€ https://reactrouter.com/docs/en/v6/getting-started/overview#quick-start-overview\n\n### å¼•å…¥ \n\nå®‰è£…ä¾èµ–ï¼Œå‰è¾¹å·²ç»æåˆ°ï¼š\n\n```js\nnpm install react-router-dom@6\n```\n\né…ç½®è·¯ç”±\n```jsx\nimport ReactDOM from \"react-dom/client\";\nimport {\n  BrowserRouter,\n  Routes,\n  Route,\n} from \"react-router-dom\";\n// import your route components too\n\nconst root = ReactDOM.createRoot(\n  document.getElementById(\"root\")\n);\nroot.render(\n  \u003cBrowserRouter\u003e\n    \u003cRoutes\u003e\n      \u003cRoute path=\"/\" element={\u003cApp /\u003e}\u003e\n        \u003cRoute index element={\u003cHome /\u003e} /\u003e\n        \u003cRoute path=\"teams\" element={\u003cTeams /\u003e}\u003e\n          \u003cRoute path=\":teamId\" element={\u003cTeam /\u003e} /\u003e\n          \u003cRoute path=\"new\" element={\u003cNewTeamForm /\u003e} /\u003e\n          \u003cRoute index element={\u003cLeagueStandings /\u003e} /\u003e\n        \u003c/Route\u003e\n      \u003c/Route\u003e\n    \u003c/Routes\u003e\n  \u003c/BrowserRouter\u003e\n);\n```\nåœ¨v6ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œæœ‰å¤šè·¯ç”±è¦åŒ¹é…æ—¶ï¼Œéœ€è¦åˆç†å®‰æ’å‰åæ”¾ç½®é¡ºåºã€‚åœ¨v6ä¸­ï¼ŒåŒ¹é…æ›´æ™ºèƒ½ï¼Œä¸è¦åœ¨æ‹…å¿ƒé¡ºåºé—®é¢˜äº†ï¼Œä¸¾ä¸ªä¾‹å­ï¼š\n```jsx\n\u003cRoute path=\"teams/:teamId\" element={\u003cTeam /\u003e} /\u003e\n\u003cRoute path=\"teams/new\" element={\u003cNewTeamForm /\u003e} /\u003e\n```\nè·¯ç”±`teams/new`ä¼¼ä¹å¯¹äºä¸Šè¾¹ä¸¤ä¸ªè·¯å¾„éƒ½å¯ä»¥åŒ¹é…ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªæ›´ç²¾ç¡®ï¼Œæ‰€ä»¥v6 routerä¼šé€‰æ‹©ç¬¬äºŒä¸ªNewTeamFormã€‚\n\n### è·¯ç”±è·³è½¬\n\nå¯ä½¿ç”¨`Link`æ ‡ç­¾æ¥ç‚¹å‡»æ”¹å˜URLï¼Œæˆ–è€…ä½¿ç”¨`useNavigate`é’©å­é€šè¿‡ä»£ç è·³è½¬ã€‚\n\n- Link\n```jsx\nimport { Link } from \"react-router-dom\";\n\nfunction Home() {\n  return (\n    \u003cdiv\u003e\n      \u003ch1\u003eHome\u003c/h1\u003e\n      \u003cnav\u003e\n        \u003cLink to=\"/\"\u003eHome\u003c/Link\u003e |{\" \"}\n        \u003cLink to=\"about\"\u003eAbout\u003c/Link\u003e\n      \u003c/nav\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n- navigate\n```jsx\nimport { useNavigate } from \"react-router-dom\";\n\nfunction Invoices() {\n  let navigate = useNavigate();\n  return (\n    \u003cdiv\u003e\n      \u003cNewInvoiceForm\n        onSubmit={async (event) =\u003e {\n          let newInvoice = await createInvoice(\n            event.target\n          );\n          navigate(`/invoices/${newInvoice.id}`);\n        }}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### è·å–è·¯ç”±å‚æ•°\n\nå¯ä»¥ä½¿ç”¨Â `:style`Â å½¢å¼ä¼ å‚ï¼Œ ä½¿ç”¨Â `useParams()`Â è·å–å‚æ•°ï¼š\n```jsx\nimport { Routes, Route, useParams } from \"react-router-dom\";\n\nfunction App() {\n  return (\n    \u003cRoutes\u003e\n      \u003cRoute\n        path=\"invoices/:invoiceId\"\n        element={\u003cInvoice /\u003e}\n      /\u003e\n    \u003c/Routes\u003e\n  );\n}\n\nfunction Invoice() {\n  let params = useParams();\n  return \u003ch1\u003eInvoice {params.invoiceId}\u003c/h1\u003e;\n}\n```\nä¸¾ä¸€ä¸ªé€šè¿‡è·¯ç”±å‚æ•°è·å–å¼‚æ­¥æ•°æ®çš„ä¾‹å­ï¼š\n```jsx\nfunction Invoice() {\n  let { invoiceId } = useParams();\n  // useFakeFetchå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå¼‚æ­¥è¯·æ±‚\n  let invoice = useFakeFetch(`/api/invoices/${invoiceId}`);\n  return invoice ? (\n    \u003cdiv\u003e\n      \u003ch1\u003e{invoice.customerName}\u003c/h1\u003e\n    \u003c/div\u003e\n  ) : (\n    \u003cLoading /\u003e\n  );\n}\n```\n\n---\n\u003e 2023.3.9 è¡¥å……ï¼šè¿™é‡Œé¡ºä¾¿è¡¥å……ä¸€ä¸‹è·å–é—®å·ä¼ å‚çš„æ–¹å¼ï¼Œæ–¹ä¾¿æŸ¥è¯¢\n\n### é—®å·ä¼ å‚è·å–\n\n#### v6 ä¸­\n\n```jsx\n// å¼•å…¥\nimport { useSearchParams } from 'react-router-dom';\n...\n\n// è·å–\nconst [searchParams] = useSearchParams();\n// ä½¿ç”¨\nconst currentType = searchParams.get('type');\n```\n\n#### v5ä¸­\n\nv5 ç‰ˆæœ¬æ²¡æœ‰è¿™ä¸ªhookï¼Œéœ€è¦è‡ªå·±å®šä¹‰ä¸€ä¸‹ï¼š\n\n```jsx\n// useSearchParams.js\nimport { useLocation } from \"react-router-dom\";\nimport { useMemo } from \"react\";\n\n/**\n * è·å–å½“å‰é¡µé¢çš„æŸ¥è¯¢å‚æ•°\n */\nexport default function useSearchParams() {\n  const { search } = useLocation();\n  return useMemo(() =\u003e {\n    const urlSearchParams = new URLSearchParams(search);\n    let params = {};\n    urlSearchParams.forEach((value, key) =\u003e {\n      params[key] = value;\n    });\n    return params;\n  }, [search]);\n}\n```\n\nä½¿ç”¨ï¼š\n\n```jsx\nconst searchParams = useSearchParams();\n\nconsole.log(searchParams.type)\n```\n\n---\n\n\n### è·¯ç”±åµŒå¥—\n\nè·¯ç”±åµŒå¥—æ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼Œå¯ä»¥å‡å°‘å†—æ‚çš„å¸ƒå±€ä»£ç ï¼Œé™ä½å¸ƒå±€çš„éš¾åº¦ã€‚å¦‚ä¸‹ä½¿ç”¨ï¼š\n```jsx\nfunction App() {\n  return (\n    \u003cRoutes\u003e\n      \u003cRoute path=\"invoices\" element={\u003cInvoices /\u003e}\u003e\n        \u003cRoute path=\":invoiceId\" element={\u003cInvoice /\u003e} /\u003e\n        \u003cRoute path=\"sent\" element={\u003cSentInvoices /\u003e} /\u003e\n      \u003c/Route\u003e\n    \u003c/Routes\u003e\n  );\n}\n```\nåˆ†åˆ«é€šè¿‡å¦‚ä¸‹ä¸‰ç§è·¯å¾„åŒ¹é…ï¼š\n-   `\"/invoices\"`\n-   `\"/invoices/123\"`\n-   `\"/invoices/sent\"`\n\n### Outlet\n\nå¯ä»¥ä½¿ç”¨ä¸€ä¸ªè·¯ç”±å ä½ç¬¦ï¼Œé’ˆå¯¹å¤šåŒ¹é…çš„è·¯ç”±ä½ç½®è¿›è¡Œå¤ç”¨ï¼Œç±»ä¼¼äºvue routerçš„è·¯ç”±æ’æ§½å’ŒAngularçš„`router-outlet`ï¼š\n```jsx\nimport {\n  Routes,\n  Route,\n  Link,\n  Outlet,\n} from \"react-router-dom\";\n\nfunction App() {\n  return (\n    \u003cRoutes\u003e\n      \u003cRoute path=\"/\" element={\u003cLayout /\u003e}\u003e\n        \u003cRoute path=\"invoices\" element={\u003cInvoices /\u003e} /\u003e\n        \u003cRoute path=\"dashboard\" element={\u003cDashboard /\u003e} /\u003e\n      \u003c/Route\u003e\n    \u003c/Routes\u003e\n  );\n}\n\nfunction Layout() {\n  return (\n    \u003cdiv\u003e\n      \u003ch1\u003eWelcome to the app!\u003c/h1\u003e\n      \u003cnav\u003e\n        \u003cLink to=\"invoices\"\u003eInvoices\u003c/Link\u003e | {\" \"}\n        \u003cLink to=\"dashboard\"\u003eDashboard\u003c/Link\u003e\n      \u003c/nav\u003e\n      \u003cdiv className=\"content\"\u003e\n        \u003cOutlet /\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n\nfunction Invoices() {\n  return \u003ch1\u003eInvoices\u003c/h1\u003e;\n}\n\nfunction Dashboard() {\n  return \u003ch1\u003eDashboard\u003c/h1\u003e;\n}\n```\nè¿™æ ·ä¼šæŠŠURLç‰‡æ®µæ„å»ºä¸ºç»„ä»¶æ ‘ï¼Œè·¯ç”±ä¸‹çš„å­è·¯ç”±ä¼šåŠ¨æ€çš„å»æ›¿æ¢æ‰çˆ¶è·¯ç”±çš„`\u003cOutlet /\u003e`ï¼Œä»¥æ­¤è¾¾åˆ°åµŒå¥—çš„ç›®çš„ã€‚\n\n### é»˜è®¤è·¯ç”±\n\nå½“ä¸€ä¸ªçˆ¶è·¯ç”±æœ‰å¤šä¸ªå­è·¯ç”±ï¼Œä¸”å½“å‰URLåœç•™åœ¨çˆ¶è·¯ç”±æ—¶ï¼ˆä¸Šä¸ªä¾‹å­ä¸­ï¼Œè·¯ç”±ä¸º'/'æ—¶ï¼Œoutleté‡Œå°±æ— æ³•è¯†åˆ«æ¸²æŸ“ï¼‰ï¼Œç•Œé¢è¯¥å¦‚ä½•æ¸²æŸ“å‘¢ï¼Ÿä½ éœ€è¦ç»™çˆ¶è·¯ç”±è®¾ç½®ä¸€ä¸ªé»˜è®¤æ¸²æŸ“çš„å­è·¯ç”±ã€‚\n```jsx\nfunction App() {\n  return (\n    \u003cRoutes\u003e\n      \u003cRoute path=\"/\" element={\u003cLayout /\u003e}\u003e\n        \u003cRoute index element={\u003cActivity /\u003e} /\u003e\n        \u003cRoute path=\"invoices\" element={\u003cInvoices /\u003e} /\u003e\n        \u003cRoute path=\"activity\" element={\u003cActivity /\u003e} /\u003e\n      \u003c/Route\u003e\n    \u003c/Routes\u003e\n  );\n}\n```\nåŠ ä¸Š`index`å±æ€§åå°±ä¼šé»˜è®¤æ¸²æŸ“è¯¥è·¯ç”±ä¸‹çš„ç»„ä»¶ã€‚è€Œä¸”é»˜è®¤ç´¢å¼•è·¯ç”±å¯ä»¥æ”¾åœ¨è·¯ç”±åµŒå¥—çš„ä»»ä½•ä¸€çº§ä¸­ä½¿ç”¨ã€‚\n\n### åµŒå¥—è·¯ç”±ä¸­ä½¿ç”¨Link\n\n```jsx\n...\n// \u003cDashboard /\u003e\n\u003cnav\u003e\n    \u003cLink to=\"invoices\"\u003eInvoices\u003c/Link\u003e{\" \"}\n    \u003cLink to=\"team\"\u003eTeam\u003c/Link\u003e\n\u003c/nav\u003e\n\n...\n\u003cRoutes\u003e\n    \u003cRoute path=\"/\" element={\u003cHome /\u003e} /\u003e\n    \u003cRoute path=\"dashboard\" element={\u003cDashboard /\u003e}\u003e\n        \u003cRoute path=\"invoices\" element={\u003cInvoices /\u003e} /\u003e\n        \u003cRoute path=\"team\" element={\u003cTeam /\u003e} /\u003e\n    \u003c/Route\u003e\n\u003c/Routes\u003e\n\n```\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸Šè¿°ä¸¤ä¸ªLinkä¼šè¿æ¥åˆ°`/dashboard/invoices`Â å’ŒÂ `/dashboard/team`ä¸¤ä¸ªåœ°å€ï¼Œè¿™å°±æ˜¯ç›¸å¯¹è·¯ç”±ã€‚\n\n### 404è·¯ç”±\n\nå½“æ²¡æœ‰ä¸€ä¸ªURLåŒ¹é…æ—¶ï¼Œå°±ä¼šæŸ¥æ‰¾æ˜¯å¦é…ç½®äº†é€šç”¨è·¯ç”±`path=\"*\"`ï¼Œä»–å¯ä»¥åŒ¹é…ä»»ä½•å½¢å¼çš„è·¯ç”±ï¼Œå½“æ²¡æœ‰æ›´ç²¾ç¡®çš„è·¯ç”±åŒ¹é…æ—¶ï¼Œå°±è¿›å…¥è¯¥è·¯ç”±çš„é…ç½®ï¼Œè¯¥è·¯ç”±çš„ä¼˜å…ˆçº§æ˜¯æœ€ä½çš„ã€‚\n\n```jsx\nfunction App() {\n  return (\n    \u003cRoutes\u003e\n      \u003cRoute path=\"/\" element={\u003cHome /\u003e} /\u003e\n      \u003cRoute path=\"dashboard\" element={\u003cDashboard /\u003e} /\u003e\n      \u003cRoute path=\"*\" element={\u003cNotFound /\u003e} /\u003e\n    \u003c/Routes\u003e\n  );\n}\n```\n\n### å¤šä¸ªè·¯ç”±ç»„\n\nä¸€ä¸ª`Routes`ç»„ä»¶åŒ…è£¹çš„è·¯ç”±ä¸ºä¸€ç»„ï¼Œv6ä¸­ä½ å¯ä»¥ä½¿ç”¨å¤šä¸ª`Routes`ã€‚æ¯ä¸€ä¸ª`\u003cRoutes\u003e`éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œåˆ†åˆ«è¿›è¡Œè·¯ç”±åŒ¹é…ï¼Œå…¶éƒ½æ˜¯ç›¸å¯¹äºè·Ÿè·¯ç”±çš„ä¸€ä¸ªé“¾æ¥ã€‚\n```jsx\nfunction App() {\n  return (\n    \u003cdiv\u003e\n      \u003cSidebar\u003e\n        \u003cRoutes\u003e\n          \u003cRoute path=\"/\" element={\u003cMainNav /\u003e} /\u003e\n          \u003cRoute\n            path=\"dashboard\"\n            element={\u003cDashboardNav /\u003e}\n          /\u003e\n        \u003c/Routes\u003e\n      \u003c/Sidebar\u003e\n\n      \u003cMainContent\u003e\n        \u003cRoutes\u003e\n          \u003cRoute path=\"/\" element={\u003cHome /\u003e}\u003e\n            \u003cRoute path=\"about\" element={\u003cAbout /\u003e} /\u003e\n            \u003cRoute path=\"support\" element={\u003cSupport /\u003e} /\u003e\n          \u003c/Route\u003e\n          \u003cRoute path=\"dashboard\" element={\u003cDashboard /\u003e}\u003e\n            \u003cRoute path=\"invoices\" element={\u003cInvoices /\u003e} /\u003e\n            \u003cRoute path=\"team\" element={\u003cTeam /\u003e} /\u003e\n          \u003c/Route\u003e\n          \u003cRoute path=\"*\" element={\u003cNotFound /\u003e} /\u003e\n        \u003c/Routes\u003e\n      \u003c/MainContent\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### å¤šçº§Routesæ—¶æ³¨æ„äº‹é¡¹\n\nå½“å­ç»„ä»¶ä¹Ÿä½¿ç”¨äº†`Routes`æ—¶ï¼Œéœ€è¦åœ¨å…¶ä¸Šä¸€çº§çˆ¶è·¯ç”±åè¾¹è¿½åŠ `/*`ï¼Œè¿½åŠ çš„`*`çš„å±‚çº§æ•°å–å†³äºä½ å­è·¯ç”±çš„å±‚çº§æ•°ã€‚\n```jsx\nfunction App() {\n  return (\n    \u003cRoutes\u003e\n      \u003cRoute path=\"/\" element={\u003cHome /\u003e} /\u003e\n      // ä¸åŠ *ä¼šåŒ¹é…ä¸åˆ°Dashboardä¸­çš„å­è·¯ç”±\n      \u003cRoute path=\"dashboard/*\" element={\u003cDashboard /\u003e} /\u003e\n    \u003c/Routes\u003e\n  );\n}\n\nfunction Dashboard() {\n  return (\n    \u003cdiv\u003e\n      \u003cp\u003eLook, more routes!\u003c/p\u003e\n      \u003cRoutes\u003e\n        \u003cRoute path=\"/\" element={\u003cDashboardGraphs /\u003e} /\u003e\n        \u003cRoute path=\"invoices\" element={\u003cInvoiceList /\u003e} /\u003e\n      \u003c/Routes\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nå¸¸ç”¨é…ç½®ä»‹ç»å®Œæ¯•äº†ã€‚æºæ–‡æ¡£çš„[Tutorial](https://reactrouter.com/docs/en/v6/getting-started/tutorial)æ„Ÿè§‰ä¸æœ¬ç« åŸºæœ¬ç±»ä¼¼ï¼Œæˆ‘æ‰“ç®—è·³è¿‡ä»–ï¼Œä¸‹ä¸€ç« è®²è§£FAQsã€‚"])</script><script>self.__next_f.push([1,"4c:T19bb,"])</script><script>self.__next_f.push([1,"## 1. å‰è¨€\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æ‰¿æ¥ä¸Šä¸€ç¯‡[# æ‰‹æŠŠæ‰‹æ­å»ºåŸºäºReactçš„å‰ç«¯UIåº“ ï¼ˆä¸‰ï¼‰-- åŸºç¡€ç»„ä»¶Iconå’ŒButton](https://juejin.cn/post/7076668781044924453)ã€‚æˆ‘ä»¬ç»§ç»­æ·»åŠ ç»„ä»¶ï¼Œæœ¬æ¬¡è®°å½•çš„æ˜¯å¸ƒå±€ç»„ä»¶Boxå’ŒCombineã€‚\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æœ¬æ–‡çš„ä»£ç å±•ç¤ºçš„æ˜¯ä¸»è¦çš„æ ¸å¿ƒç¤ºæ„ä»£ç ï¼Œå…¨éƒ¨ä»£ç è§ä»“åº“ï¼š[Githubä»“åº“](https://github.com/heiheihoho1213/dux-ui)\n\n\n## 2. Box\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å…³äºé¡µé¢å¸ƒå±€ï¼Œæœ€æµè¡Œçš„ä¾¿æ˜¯flexå¸ƒå±€ï¼ŒBoxç»„ä»¶ä¾¿æ˜¯å¯¹flexå¸ƒå±€è¿›è¡Œçš„ä¸€æ¬¡å°è£…ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œä¸Šä»£ç ã€‚åœ¨`src/component`æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæ–‡ä»¶å¤¹`Box`ï¼Œåœ¨å…¶ä¸­æ–°å»ºæ–‡ä»¶`index.tsx`ï¼š\n\n```tsx\nexport interface BoxProps {\n  children?: ReactNode;\n  direction?: 'row' | 'row-reverse' | 'column' | 'column-reverse';\n  wrap?: 'nowrap' | 'wrap' | 'wrap-reverse';\n  alignItems?: 'center' | 'flex-start' | 'flex-end' | 'stretch';\n  alignContent?: 'center' | 'flex-start' | 'flex-end' | 'space-between' | 'space-around';\n  justifyContent?:\n    | 'center'\n    | 'flex-start'\n    | 'flex-end'\n    | 'space-between'\n    | 'space-around'\n    | 'stretch';\n  padding?: number | string;\n  width?: string;\n  height?: string;\n  flex?: string;\n}\n\nclass Box extends PureComponent\u003cBoxProps\u003e {\n  render() {\n    const box = \u003cBoxWrap {...this.props} /\u003e;\n\n    return box;\n  }\n}\n\n...\n\n```\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ä¸Šè¾¹å®šä¹‰äº†ä¸€äº›æ¥æ”¶å‚æ•°ï¼Œå…¶ä¸flexçš„csså‚æ•°æ˜¯å¯¹åº”çš„ï¼Œæˆ‘ä»¬å°±æ¯ä¸€ä¸ªå…·ä½“çš„å‚æ•°ï¼Œåœ¨ä»£ç é‡Œè¿›è¡Œå®ç°ä¾¿å¯ä»¥å®Œæˆè¯¥ç»„ä»¶äº†ã€‚æ¥ä¸‹æ¥å®ç°`BoxWrap`ç»„ä»¶ï¼š\n\n\n```tsx\nimport styled from '@emotion/styled';\nimport { css } from '@emotion/core';\n\nexport const BoxWrap = styleWrap({\n  className: prefixCls,\n})(\n  styled('div')((props: any) =\u003e {\n      // è¦å®ç°çš„å†…å®¹\n  }),\n);\n```\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æ¶å­å·²ç»æ­èµ·æ¥ï¼Œè€æ ·å­ï¼Œä»ç„¶ä½¿ç”¨styleWrapåŒ…è£¹ä¸€å±‚å…¬å…±æ ·å¼ï¼Œå†…éƒ¨ç”¨ä¸€ä¸ªdivæ‰¿æ¥ï¼Œä¸­é—´è¦å®ç°çš„å†…å®¹åº”è¯¥è¿”å›è¦ä½¿ç”¨çš„cssï¼Œè¿™è¾¹æ˜¯æ ¸å¿ƒå†…å®¹ï¼š\n\n\n```tsx\n...\nconst {\n    children,\n    direction,\n    wrap,\n    justifyContent,\n    alignItems,\n    alignContent,\n    span,\n    flex,\n    width,\n    height,\n    padding,\n} = props;\n\n...\n\nreturn css`\n    box-sizing: border-box;\n    \n    // direction\n    ${direction != null \u0026\u0026\n      css`\n        flex-direction: ${direction};\n      `}\n\n    // wrap\n    ${wrap != null \u0026\u0026\n      css`\n        flex-wrap: ${wrap};\n      `}\n      \n    // justifyContent\n    ${justifyContent != null \u0026\u0026\n      css`\n        justify-content: ${justifyContent};\n      `}\n      \n    // ...\n`\n```\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å¯ä»¥çœ‹åˆ°ï¼Œåªæ˜¯ç®€å•åŠ ä¸€ä¸ªcssä¾¿å¯ä»¥å®ç°ï¼Œç›¸å½“ç®€å•ã€‚éœ€è¦è§£é‡Šçš„æ˜¯childrençš„å±æ€§å¹¶æ²¡æœ‰å…¬å¼€å£°æ˜ï¼Œè€Œæ˜¯ä¼ é€’ç»™`styled`ç”Ÿæˆçš„ç»„ä»¶åéšå¼çš„æ¸²æŸ“äº†ã€‚\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;åˆ›å»ºå®Œæ¯•åï¼Œåœ¨ç»„ä»¶å¤–ä¾¿å¯ä»¥è¿™æ ·å®ç°ï¼š\n\n\n```tsx\n\u003cBox direction=\"column\" justifyContent=\"center\"\u003e\n    \u003cdiv\u003e1\u003c/div\u003e\n    \u003cdiv\u003e2\u003c/div\u003e\n    \u003cdiv\u003e3\u003c/div\u003e\n\u003c/Box\u003e\n```\n\n## 3. Combine\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;Combineç»„ä»¶ç”¨äºç»„åˆä¸åŒçš„ç»„ä»¶ï¼Œç±»ä¼¼Boxï¼Œä»ç„¶æ˜¯æ ·å¼ä¸ºä¸»çš„ç»„ä»¶ï¼Œæ˜¯ä¸ºäº†å¸ƒå±€æ–¹ä¾¿çš„ï¼Œå¯¹cssè¿›è¡Œçš„å°è£…ã€‚æˆ‘ä»¬ä¸ä½¿ç”¨flexï¼Œä½¿ç”¨ä¸€ä¸ªå¤§divåŒ…è£¹ä¸€å †inline-blockå…ƒç´ å³å¯ã€‚åœ¨`src/components`ä¸‹æ–°å»ºæ–‡ä»¶å¤¹`Combine`ï¼Œåœ¨æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæ–‡ä»¶`index.tsx`ï¼š\n\n\n```tsx\nconst Combine = ({\n  children,\n  sharedProps = {},\n  spacing = 'smart',\n  separator,\n  ...rest\n}: CombineProps) =\u003e {\n  const { size = 'md' } = sharedProps;\n  let isFirstItem: boolean;\n  return (\n    \u003cCombineWrap spacing={spacing} {...rest}\u003e\n        {React.Children.map(children, (child) =\u003e (\n            // éå†child\n            \u003c\u003e\n                // æ”¾ç½®åˆ†éš”ç¬¦\n                {separator \u0026\u0026 !isFirstItem ? \u003cspan className={separatorCls} key=\"separator\"\u003e\n                    {separator}\n                  \u003c/span\u003e : null\n                }\n                // æ”¾ç½®å­å…ƒç´ \n                \u003cdiv className={itemCls}\u003e\n                    {React.cloneElement(child)}\n                    ...\n                \u003c/div\u003e\n            \u003c/\u003e\n          )\n        )}\n    \u003c/CombineWrap\u003e\n  )\n}\n```\nä¸Šè¾¹ä»£ç ä¸­å®šä¹‰äº†å­å…ƒç´ å’Œåˆ†éš”ç¬¦çš„ç±»ï¼š\n\n```tsx\nexport const itemCls = prefixCls + '-item';\nexport const separatorCls = prefixCls + '-separator';\n```\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ç»„ä»¶æ¥æ”¶spacingå‚æ•°æ¥æ§åˆ¶ç›¸å…³è”ç»„ä»¶ä¹‹é—´çš„è·ç¦»ï¼ŒåŒæ—¶è¿˜å¯ä»¥è®¾ç½®separatoræ¥ä½œä¸ºè‡ªå®šä¹‰åˆ†éš”ç¬¦ã€‚æ¥çœ‹ä¸€ä¸‹ç»„ä»¶`CombineWrap`çš„å®ç°ï¼š\n\n```tsx\nimport styled from '@emotion/styled';\nimport { css } from '@emotion/core';\n\nexport const CombineWrap = styledWrap\u003c{ spacing: string }\u003e({\n  // æ¥å—è‡ªå®šä¹‰class\n  className: prefixCls,\n})(\n  // ç”Ÿæˆä¸€ä¸ªè‡ªå®šä¹‰æ ·å¼åŒ…è£¹çš„div\n  styled('div')((props) =\u003e {\n    const {\n      spacing,\n      theme: { designTokens: DT },\n    } = props;\n    \n    // spacingMapä¸ºdesignTokensé‡Œå®šä¹‰çš„å¸¸é‡\n    const space = (DT as any)[spacingMap[spacing]];\n\n    return css`\n      display: inline-block;  // inlinkä½¿å¾—å„ä¸ªå­å…ƒç´ å¹³é“ºæ’åˆ—\n      vertical-align: middle;\n      \n      // å­å…ƒç´ æ ·å¼\n      \u003e .${itemCls} { \n        \u0026:focus {\n          z-index: 2;\n        }\n        \u0026:hover {\n          z-index: 3;\n        }\n      }\n      \n      // å­å…ƒç´ ä¸‹ä¸€ä¸ªå…„å¼Ÿï¼Œåˆ†éš”ç¬¦ä¸‹ä¸€ä¸ªå­å…ƒç´ ï¼Œå­å…ƒç´ ä¸‹ä¸€ä¸ªåˆ†éš”ç¬¦ ç»Ÿä¸€éƒ½åŠ ä¸Šå·¦è¾¹è·ï¼Œè¿™é‡Œå°±æ˜¯spaceçš„ç”¨æ³•\n      \u003e .${itemCls}+.${itemCls}, \u003e .${separatorCls}+.${itemCls}, \u003e .${itemCls}+.${separatorCls} {\n        margin-left: ${space};\n      }\n    `;\n  }),\n);\n\n```\n\nå…³äºspacingå¸¸é‡ï¼Œå¯ä»¥åœ¨themeä¸»ä½“ä¸­å®šä¹‰å¸¸é‡ï¼š\n\n```js\nT_SPACING_COMMON_XS: '4px',\nT_SPACING_COMMON_SM: '8px',\nT_SPACING_COMMON_MD: '12px',\nT_SPACING_COMMON_LG: '16px',\nT_SPACING_COMMON_XLG: '20px',\nT_SPACING_COMMON_XXLG: '24px',\nT_SPACING_COMMON_XXXLG: '32px',\n```\n\nç„¶åæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ä¸€ä¸‹ï¼š\n\n```tsx\n\u003cCombine\u003e\n  \u003cButton styleType=\"primary\"\u003eæŒ‰é’®ç»„å±•ç¤º\u003c/Button\u003e\n  \u003cButton\u003eæŒ‰é’®ç»„å±•ç¤º\u003c/Button\u003e\n  \u003cButton\u003eæŒ‰é’®ç»„å±•ç¤º\u003c/Button\u003e\n  \u003cButton disabled\u003eæŒ‰é’®ç»„å±•ç¤º\u003c/Button\u003e\n\u003c/Combine\u003e\n```\n\n\nè‡³æ­¤ï¼Œå¸ƒå±€ç»„ä»¶`Box`å’Œ`Combine`å·²ç»ä»‹ç»å®Œæ¯•~  æ›´å¤šç»„ä»¶å‚ç…§ä»£ç ä»“åº“ï¼š[Githubä»“åº“](https://github.com/heiheihoho1213/dux-ui)\n\n### å‚è€ƒ\n\n[React-components](https://ucloud-fe.github.io/react-components/)\n\n[Antdä¹‹Spaceå’ŒGrid](https://ant.design/components/grid-cn/)"])</script><script>self.__next_f.push([1,"4d:T3b59,"])</script><script>self.__next_f.push([1,"## 1. å‰è¨€\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æ‰¿æ¥ä¸Šä¸€ç¯‡[æ‰‹æŠŠæ‰‹æ­å»ºåŸºäºReactçš„å‰ç«¯UIåº“ï¼ˆäºŒï¼‰-- ä¸»é¢˜é…ç½®](https://juejin.cn/post/7076652936331280421/)ã€‚åœ¨ä¸»é¢˜é…ç½®ä¹‹åï¼Œæˆ‘ä»¬ç€æ‰‹å†™ä¸€äº›åŸºç¡€ç»„ä»¶ä»¥åŠå…¶å‘¨è¾¹çš„é…ç½®å·¥å…·ã€‚ï¼ˆæœ¬æœŸç”¨åˆ°çš„styleWrapçš„å®šä¹‰å¯æŸ¥çœ‹ä¸ŠæœŸï¼‰\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æœ¬æ–‡çš„ä»£ç å±•ç¤ºçš„æ˜¯ä¸»è¦çš„æ ¸å¿ƒä»£ç ï¼Œå…¨éƒ¨ä»£ç è§ä»“åº“ï¼š[Githubä»“åº“](https://github.com/heiheihoho1213/dux-ui)\n\n\n## 2. Icon\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å›¾æ ‡çš„è®¾è®¡æ˜¯ä¸ªæŠ€æœ¯æ´»ï¼Œéœ€è¦è®¾è®¡å‡ºè‡ªå·±ä¸“å±çš„é£æ ¼ï¼Œå°±åƒä¸Šä¸€æœŸä¸€å¼€å§‹è®²çš„é‚£æ ·ï¼ŒStyleé£æ ¼è®¾è®¡æ˜¯ä¸‰è¦ç´ ä¹‹é¦–ã€‚åŸºç¡€ç»„ä»¶è®¾è®¡ï¼Œæ¯”å¦‚æŒ‰é’®æ˜¯æ‰å¹³è¿˜æ˜¯ç«‹ä½“ï¼Œè¾“å…¥æ¡†æ˜¯æ–¹è§’è¿˜æ˜¯åœ†è§’ï¼ŒåŠ ä¸åŠ é˜´å½±ç­‰è¿™äº›ï¼Œå—é¡¹ç›®ç»ç†. äº§å“å’Œäº¤äº’çš„å½±å“ä¼šå¤šä¸€ç‚¹ï¼Œä½†æ˜¯å¤§ä½“æ¥è¯´ï¼Œåº”ä¸å…¬å¸åŒç±»äº§å“ä¿æŒä¸€è‡´ï¼Œè‡³äºå¦‚ä½•è®¾è®¡ï¼Œé‚£å°±æ˜¯å¦å¤–çš„è¯¾é¢˜äº†ï¼Œä¸åœ¨æœ¬æ–‡çš„è®¨è®ºä¹‹åˆ—ã€‚\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æœ¬æ–‡ä¸­çš„Iconå›¾æ ‡ä½¿ç”¨å­—ä½“åº“æ¥å®Œæˆï¼Œé€šè¿‡CSSæ— ä¾µå…¥å¼çš„åœ¨ä¸€ä¸ªå…ƒç´ ä¸ŠåŠ å…¥`before`æˆ–è€…`after`ä¼ªç±»æ¥å®ç°å›¾æ ‡æ˜¾ç¤ºï¼Œè¿™é‡Œä¸æ˜¯æµè§ˆå™¨çš„å­—ä½“ï¼Œä¹Ÿä¸æ˜¯å®¢æˆ·ç”µè„‘é‡Œå®‰è£…çš„å­—ä½“ï¼Œä¹Ÿä¸æ˜¯å›¾ç‰‡æˆ–å…¶ä»–æ–¹å¼ï¼Œè€Œä¸”æ˜¯ä»¥æ–‡å­—çš„æ–¹å¼æ˜¾ç¤ºï¼Œè¿™æ ·åšç›¸å¯¹æ¯”è¾ƒç®€æ´ï¼Œæ–¹ä¾¿ä¿®æ”¹ï¼Œæ›´é‡è¦çš„æ˜¯åˆ©äºSEOä¼˜åŒ–ã€‚æµè§ˆå™¨å…¼å®¹æ€§æ¯”è¾ƒå¥½çš„å­—ä½“åº“æœ‰`WOFF`. `WOFF2`ç­‰ã€‚å­—ä½“åº“å…¼å®¹æ€§è§[å®˜æ–¹è§£é‡Š](https://developer.mozilla.org/zh-CN/docs/Web/CSS/@font-face)ã€‚å­—ä½“åº“æœ‰ä¸“é—¨çš„è‡ªå®šä¹‰ç”Ÿæˆå·¥å…·ï¼Œä¾‹å¦‚[fonteditor](http://www.fonteditor.com/)ï¼Œå¯ä»¥è¯•ç”¨30å¤©ï¼›è‡³äºå­—ä½“åº“ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹å¼€æºçš„å­—ä½“åº“ï¼Œä¾‹å¦‚[Font Awesome](https://fontawesome.dashgame.com/)ã€‚è¿™é‡Œä½œè€…å°±ä½¿ç”¨Font Awesomeçš„woffå­—ä½“åº“ï¼Œæˆ‘ä»¬æ‰“å¼€å›¾å½¢åˆ›å»ºå·¥å…·fonteditoræ¥æŸ¥çœ‹è¿™ä¸ªæ–‡ä»¶ï¼š\n\n![image.png](/img/posts/2022-3-19/2022-3-19-6.png)\n\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€ä¸ªIconéƒ½æœ‰å¯¹åº”çš„`Code-points`ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½é€šè¿‡CSSæ¥é…ç½®å­—ä½“å›¾æ ‡äº†ï¼š\n\n```css\n// ä¸Šå›¾ä¸­ç»ç’ƒæ¯\n.glass:before {\n    content: '\\F000';\n}\n```\nè®¾è®¡æ€è·¯æœ‰äº†ï¼Œæ¥ä¸‹æ¥å°±å¼€å§‹åŠ¨å·¥ï¼\n\n### Icon.tsx\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;åœ¨`src/components`æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»ºæ–‡ä»¶å¤¹`Icon`ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ–°å»º`Icon.tsx`ï¼š\n\n```tsx\n// å®šä¹‰æ¥æ”¶å‚æ•°\nexport interface IconProps {\n    /** å›¾æ ‡ç±»å‹ */\n    type: string;\n    /** æ˜¯å¦æ—‹è½¬ */\n    spin?: boolean;\n    /** è‡ªå®šä¹‰ icon ç±»åå‰ç¼€ï¼Œä½¿ç”¨è‡ªå®šä¹‰å›¾æ ‡åº“æ—¶ä½¿ç”¨ï¼Œé»˜è®¤ä¸º icon\\_\\_ */\n    prefix?: string;\n}\n\n// å›¾æ ‡æ§ä»¶\nconst Icon = ({\n    type,\n    spin,\n    prefix,\n    className,\n    ...rest\n}) =\u003e {\n    const configContext = useContext(ConfigContext);\n    const finalPrefix = useMemo(() =\u003e prefix || configContext.iconDefaultPrefix || 'icon__', [\n        configContext.iconDefaultPrefix,\n        prefix\n    ]);\n    return (\n        \u003cIconWrap\n            className={classnames(prefixCls, `${finalPrefix}${type}`, spin \u0026\u0026 `${prefixCls}-spin`, className)}\n            spin={spin}\n            {...rest}\n        /\u003e\n    );\n};\n\nexport default React.memo(Icon);\n```\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘åœ¨å…¨å±€`configContext`å®šä¹‰äº†é»˜è®¤çš„å›¾æ ‡ç±»åå‰ç¼€ï¼Œé»˜è®¤ä¸º`icon__`ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œåªè¦å’ŒCSSæ ·å¼å¯¹åº”å³å¯ã€‚æœ€åè¿”å›çš„æ˜¯ä¸€ä¸ª`IconWrap`ç»„ä»¶ï¼Œæˆ‘ä»¬åœ¨`Icon`æ–‡ä»¶å¤¹ä¸‹æ–°å»º`style`æ–‡ä»¶å¤¹æ¥æ”¾ç½®æ ·å¼åŒ…è£¹ç±»ï¼Œ`style`ä¸‹è®¾ç½®`font`æ–‡ä»¶å¤¹æ¥å®‰ç½®æˆ‘ä»¬ä¸‹è½½çš„WOFFæ–‡ä»¶ï¼Œå¹¶åœ¨`style`åŒç›®å½•ä¸‹æ–°å»º`icon.css`å’Œ`index.ts`ï¼š\n\nsrc/components/Icon/style/icon.cssï¼š\n\n```css\n/* è‡ªå®šä¹‰ä¸“å±çš„å­—ä½“ç±»å‹ */\n@font-face {\n    font-family: duiicon;\n    /* src: url(./fonts/duiicon.eot?v=1552285261926); */\n    src: url(./fonts/fontawesome-webfont.woff) format('woff');\n    font-weight: 400;\n    font-style: normal;\n}\n\n...\n/* è®¾ç½®å­—ä½“å¯¹åº”çš„ç±» */\n[class*=' icon__']:before,\n[class^='icon__']:before {\n    display: inline-block;\n}\n.icon__glass:before {\n    content: '\\F000';\n}\n...\n```\n\nsrc/components/Icon/style/index.ts:\n\n```ts\nimport styled from '@emotion/styled';\nimport { css } from '@emotion/core';\n\n// spinMixinæ˜¯å…¬å…±çš„æ—‹è½¬æ ·å¼ï¼Œè¯¦è§å…¨éƒ¨ä»£ç \nconst iconSpinMixin = css`\n    ${spinMixin};\n    line-height: normal;\n`;\n\nexport const IconWrap = styleWrap\u003c{ spin?: boolean }\u003e({})(\n    styled('i')(props =\u003e {\n        const { spin } = props;\n\n        return css`\n            vertical-align: baseline;\n            \u0026\u0026\u0026 {\n                ${spin \u0026\u0026 iconSpinMixin};\n            }\n        `;\n    })\n);\n```\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ä»ä»£ç ä¸­çœ‹åˆ°ï¼Œè™½ç„¶è¿™é‡Œé¢æ²¡æœ‰ç”¨åˆ°ä¸»é¢˜æ ·å¼çš„å˜é‡ï¼Œä½†ä¸ºäº†é£æ ¼ç»Ÿä¸€ï¼Œè¿™é‡Œç”¨`styleWrap`åŒ…è£¹ä¸€ä¸‹ï¼Œä¸ç»™è¾“å…¥å‚æ•°å³å¯ï¼Œå…¶è¿”å›çš„ä»ç„¶æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå‡½æ•°å¼ç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œè¿™é‡Œä¼ é€’ä¸€ä¸ªiæ ‡ç­¾ï¼š`styled('i')`ï¼Œå‚æ•°`props`æ˜¯ç»„ä»¶`IconWrap`æ¥å—çš„å‚æ•°ï¼Œå¦‚æœæœ‰spinæ—‹è½¬ï¼Œé‚£å°±åŠ ä¸Šæ—‹è½¬çš„æ ·å¼ã€‚\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å…³äºå‰ç¼€çš„æ‹¼æ¥ï¼Œæˆ‘è¿™é‡Œè¯´ä¸€ä¸‹ï¼š\n\n```js\nclassnames(prefixCls, `${finalPrefix}${type}`, spin \u0026\u0026 `${prefixCls}-spin`, className)\n```\nç¬¬ä¸€æ®µæ˜¯å…¬å…±æ ·å¼ï¼Œè¿™é‡Œä¸º`dux-ui-icon`ï¼Œå¯ä»¥ç†è§£ä¸ºæ¥è‡ªç»„ä»¶åº“çš„æ ‡è¯†ï¼Œä¹Ÿæ–¹ä¾¿ç”¨æˆ·åœ¨ä½¿ç”¨æ—¶æ‰¹é‡æ·»åŠ æ ·å¼ï¼›ç¬¬äºŒæ®µå°±æ˜¯æˆ‘ä»¬ä»£ç ä¸­æ‹¼æ¥çš„`icon__glass`ç­‰ï¼Œç”¨äºå®é™…å›¾æ ‡æ˜¾ç¤ºï¼›ç¬¬ä¸‰æ®µæ˜¯æ—‹è½¬æ ‡è¯†ï¼›ç¬¬å››æ®µæä¾›äº†ç”¨æˆ·è‡ªå®šä¹‰classã€‚\n\nç°åœ¨ï¼Œä»£ç ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š\n\n![image.png](/img/posts/2022-3-19/2022-3-19-7.png)\n\nå½“ç„¶åˆ«å¿˜äº†åœ¨`src/index`å¯¼å‡ºï¼š\n\n```ts\nexport { default as Icon } from './components/Icon';\n```\n\n### Icon demo\n\næˆ‘ä»¬åœ¨åŒç›®å½•ä¸‹çš„`index.md`ä¸­å†™ä¸Šdemoç”¨ä¾‹ï¼š\n\n```tsx\nimport React from 'react';\n// dumi-dux-uiè¦ä¸ä½ package.jsonä¸­çš„nameä¸€è‡´\nimport { Icon } from 'dumi-dux-ui';\nimport Copy from 'copy-to-clipboard';\n\n// demo start\nconst layout = {\n    style: {\n        marginRight: 10\n    }\n};\n\nconst Icons = [\n    'glass',\n];\nconst TypeDemo = () =\u003e (\n    \u003cdiv style={{ display: \"flex\" }}\u003e\n        {Icons.map(item =\u003e (\n            \u003cdiv key={item} style={{ width: '50px', height: '50px', cursor: 'pointer' }} onClick={() =\u003e Copy(item)}\u003e\n                \u003cIcon type={item} {...layout} /\u003e\n            \u003c/div\u003e\n        ))}\n    \u003c/div\u003e\n);\n```\nä¿®æ”¹`.umirc.ts`ï¼š\n\n```ts\n...\nmenus: {\n    // éœ€è¦è‡ªå®šä¹‰ä¾§è¾¹èœå•çš„è·¯å¾„ï¼Œæ²¡æœ‰é…ç½®çš„è·¯å¾„è¿˜æ˜¯ä¼šä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„é…ç½®\n    '/components': [\n      {\n        title: 'ç»„ä»¶',\n        path: '/components',\n        children: [\n          // èœå•å­é¡¹ï¼ˆå¯é€‰ï¼‰\n          'components/Icon/index.md',\n        ],\n      },\n    ],\n  },\n```\n\nç„¶ååœ¨æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼š`npm run docs`ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè¿›å…¥localhost:8000/components/iconå³å¯çœ‹åˆ°ï¼š\n\n![image.png](/img/posts/2022-3-19/2022-3-19-8.png)\n\næˆ‘ä»¬çš„ç»ç’ƒæ¯å›¾æ ‡åŠ è½½å‡ºæ¥äº†ï¼F12æŸ¥çœ‹å…ƒç´ ï¼Œç¡®å®æ˜¯æˆ‘ä»¬æƒ³è¦çš„åŠ è½½æ–¹å¼ï¼š\n\n![image.png](/img/posts/2022-3-19/2022-3-19-9.png)\n\n\n\u003e å…³äº @emotionä¸­çš„`styled`å’Œ`css`æ–¹æ³•ï¼Œå¯ä»¥é¿å…ä½¿ç”¨å¤–æŒ‚cssæ–‡ä»¶ï¼ŒåŒæ—¶ç»„ä»¶ä¼ é€’å‚æ•°æ›´åŠ æ–¹ä¾¿ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å®Œå…¨ä¸ç”¨styledï¼Œå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼Œå…¶æ•ˆæœæ˜¯ç­‰ä»·çš„ã€‚è¯¦ç»†ä½¿ç”¨å¯ä»¥æŸ¥çœ‹[emotionå®˜ç½‘](http://emotion.sh/docs)\n\n\n```tsx\nfunction Content(props: any) {\n    // propsçš„å±æ€§éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå¯ä¼ é€’classNameå±æ€§ï¼Œé€šè¿‡å¤–æŒ‚csså®ç°ç›¸åŒçš„æ ·å¼\n    ...\n    return \u003ci {...props}\u003e\u003c/i\u003e\n}\n\nexport const IconWrap = styleWrap\u003c{ spin?: boolean }\u003e({})(Content);\n```\n\n---\n\n## 3. Button\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æŒ‰é’®ä¸€èˆ¬ä¼šåˆ†ç±»åˆ«ï¼Œä¸åŒçš„ç±»åˆ«æœ‰ä¸åŒçš„é¢œè‰²ï¼Œæˆ‘ä»¬åˆ†ä¸ºå®å¿ƒï¼Œè¾¹æ¡†ç©ºå¿ƒå’Œç¦ç”¨ä¸‰ç§æ¨¡å¼ã€‚ä¸‹é¢åˆ—ä¸€ä¸ªè¡¨æ ¼è¯´æ˜æ‰€æœ‰çš„buttonæ ·å¼ï¼š\n\n\n| ç±»åˆ«åç§° | ç§ç±»åé›†åˆ |\n| --- | --- |\n| StyleTypes ç§ç±» | ['primary', 'warning', 'success', 'error', 'border', 'border-gray'] |\n| Sizes å¤§å° | ['sm', 'md', 'lg'] |\n| Shapes å½¢çŠ¶ | ['circle', 'square'] |\n| Shadowed é˜´å½± | ['true', 'false'] |\n| Loading åŠ è½½ | ['true', 'false'] |\n| Disabled ç¦ç”¨ | ['true', 'false'] |\n| Block å—çº§æ˜¾ç¤º | ['true', 'false'] |\n\næˆ‘ä»¬æ ¹æ®ç½—åˆ—çš„ç±»å‹ï¼Œå¼€å§‹æ­å»ºç»„ä»¶ï¼\n\n### æ­å»ºåŸºç¡€\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æˆ‘ä»¬åœ¨`src/components`æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæ–‡ä»¶å¤¹`Button`ï¼Œåœ¨è¯¥ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶`index.tsx`ï¼š\n\n\n```tsx\n// å®šä¹‰æ¥å—å‚æ•°ï¼Œä¸ºè¡¨æ ¼ä¸­ç½—åˆ—å±æ€§\nexport interface ButtonProps {\n  /** æŒ‰é’®ç±»å‹ */\n  styleType?: 'primary' | 'warning' | 'success' | 'error' | 'border' | 'border-gray';\n  /** æŒ‰é’®å°ºå¯¸ */\n  size?: 'sm' | 'md' | 'lg';\n  /** å½¢çŠ¶ */\n  shape?: 'circle' | 'square';\n  /** é˜´å½± */\n  shadowed?: boolean;\n  /** ä¸»é¢˜ */\n  // theme?: 'dark';\n  /** æ˜¯å¦åŠ è½½ä¸­ */\n  loading?: boolean;\n  /** å›¾æ ‡ */\n  icon?: string | ReactNode;\n  /** è®¾ç½®åŸç”Ÿçš„ button ä¸Š type å±æ€§ */\n  type?: string;\n  /** å±•ç¤ºè®¾ç½®ä¸ºå—å…ƒç´  */\n  block?: boolean;\n}\n```\nåŒæ ·çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ ·å¼ç±»åŒ…è£¹ä¸€ä¸‹åŸç”Ÿçš„buttonï¼ˆè¿˜æ˜¯åœ¨è¿™ä¸ªæ–‡ä»¶ï¼‰ï¼š\n\n```tsx\n...\nrender() {\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const { loading, icon, children, ...rest } = this.props;\n\n    return (\n      \u003cStyleButton loading={loading} {...rest}\u003e\n        // renderIconä¸ºæŒ‚è½½æŒ‰é’®å†…å›¾æ ‡çš„å‡½æ•°\n        {this.renderIcon()}\n        {children}\n      \u003c/StyleButton\u003e\n    );\n  }\n```\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æ¥ä¸‹æ¥å»åˆ›å»º`StyleButton`ï¼Œä¸Iconåˆ›å»ºä¸€æ ·åœ°ï¼Œæˆ‘ä»¬åœ¨`src/components/Button`æ–‡ä»¶å¤¹ä¸‹æ–°å»º`style`æ–‡ä»¶å¤¹ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ–°å»º`index.tsx`ï¼Œæ ¸å¿ƒä»£ç åœ¨è¿™é‡Œï¼š\n\n```tsx\n...\nconst Button = ({\n  loading,\n  styleType,\n  disabled,\n  onClick,\n  block,\n  shadowed,\n  ...rest\n}) =\u003e (\n  \u003cbutton\n    disabled={disabled}\n    onClick={!disabled ? onClick : undefined}\n    {...rest}\n  /\u003e\n);\n\nexport const StyleButton = styleWrap\u003cSButtonProps, HTMLButtonElement\u003e({\n  className: classNameMixin,\n})(styled(Button)(buttonStyleMixin));\n\n```\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å®šä¹‰ä¸€ä¸ªå«Buttonçš„å‡½æ•°å¼ç»„ä»¶ï¼Œå…¶è¿”å›çš„å°±æ˜¯ä¸€ä¸ªåŸç”Ÿçš„buttonï¼Œæ‰€ä»¥restå‚æ•°é‡Œä½ å¯ä»¥ä¼ é€’åŸç”Ÿçš„å±æ€§ï¼Œæœ€åç”¨styleWrapåŒ…è£¹åå¯¼å‡ºã€‚ä¸Iconä¸åŒçš„æ˜¯ï¼ŒButtonçš„æ ·å¼æ›´å¤šï¼Œè€Œä¸”è¿˜è¦é€‚é…ä¸»é¢˜ã€‚æ‰€ä»¥è¿™é‡Œå¤šäº†ä¸€ä¸ªç±»åå£°æ˜`classNameMixin`å’Œä¸€ä¸ªæ ·å¼å‡½æ•°`buttonStyleMixin`.\n\nclassNameMixinï¼š\n```tsx\n// classNameMixinè´Ÿè´£æ·»åŠ å„ç§ç±»åï¼Œç”¨äºå”¯ä¸€è¯†åˆ«å’Œå¼€å‘è€…è¿›è¡Œå®šåˆ¶\nconst classNameMixin = ({\n  size,\n  styleType,\n  shape,\n  loading,\n  disabled,\n  checked,\n}) =\u003e\n  classnames(\n    prefixCls,\n    `${prefixCls}-size-${size}`,\n    `${prefixCls}-styletype-${styleType}`,\n    shape \u0026\u0026 `${prefixCls}-${shape}`,\n    loading \u0026\u0026 `${prefixCls}-loading`,\n    disabled \u0026\u0026 `${prefixCls}-disabled`,\n    checked \u0026\u0026 `${prefixCls}-checked`,\n  );\n```\n\nbuttonStyleMixinæ˜¯ä¸€ä¸ªæ€»å¼€å…³ï¼Œç”¨äºæ·»åŠ å„ç§æ ·å¼ï¼š\n\n```tsx\n// buttonStyleMixin\nconst buttonStyleMixin = (props) =\u003e {\n  const { theme, loading, shape, checked, block } = props;\n  const { designTokens: DT } = theme;\n  return css`\n    margin: 0;\n    box-sizing: border-box;\n    border-radius: ${DT.T_CORNER_LG};\n    text-align: center;\n    text-decoration: none;\n    cursor: pointer;\n    outline: none;\n    font-size: ${DT.T_TYPO_FONT_SIZE_1};\n    white-space: nowrap;\n    ${inlineBlockWithVerticalMixin};  // å—çº§\n\n    ${sizeMixin(props)};  // å¤§å°\n    ${styleTypeMixin(props)};  // styleType\n    ${shape \u0026\u0026 shapeMixin(props)}; // å½¢çŠ¶\n    ${loading \u0026\u0026 loadingMixin(props)};  // åŠ è½½ä¸­\n    ${block \u0026\u0026\n    css`\n      width: 100%;\n    `};\n  `;\n};\n```\næ¥ä¸‹æ¥åˆ†åˆ«è®°å½•ä¸Šè¿°å„ä¸ªæ ·å¼å˜é‡ï¼š\n\nsizeMixinï¼š\n\n```tsx\n// é€šè¿‡getHeightBySizeæ‹¿åˆ°ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­çš„å„ä¸ªå¤§å°\n...\nreturn css`\n    height: ${getHeightBySize(DT, size)};\n    line-height: ${getHeightBySize(DT, size)};\n    padding: 0 ${getPaddingBySize(DT, size)};\n`;\n...\n```\n\nshapeMixinï¼š\n\n```tsx\n...\n// ç›®å‰æ”¯æŒåœ†å½¢å’Œæ–¹å½¢\nswitch (shape) {\n    case 'circle':\n      return css`\n        border-radius: 50% !important;\n        padding: 0;\n        overflow: hidden;\n        width: ${getHeightBySize(DT, size)};\n      `;\n    case 'square':\n      return css`\n        padding: 0;\n        overflow: hidden;\n        width: ${getHeightBySize(DT, size)};\n      `;\n    default:\n      return css``;\n}\n```\n\nloadingMixinçš„è®¾ç½®ä¹Ÿä¸€æ ·ï¼Œä½¿å¾—é¼ æ ‡ä¸å¯ç‚¹å‡»ï¼Œæš—ç°è‰²æ˜¾ç¤ºå³å¯ã€‚\n\nstyleTypeMixinç”¨æ¥é€šè¿‡styleTypeçš„ä¸åŒï¼Œå¯¹åº”çš„è®¾ç½®ä¸åŒçš„ä¸»é¢˜é…è‰²ï¼Œ ä»¥primaryä¸ºä¾‹ï¼š\n\n```tsx\nconst {\n  // æ¥å—ThemeProviderä¼ é€’çš„themeå‚æ•°\n  theme: { designTokens: DT },\n  styleType,\n  disabled,\n  size,\n  shadowed,\n} = props;\n\n...\nprimary: {\n  background: DT.T_BUTTON_PRIMARY_COLOR_BG_DEFAULT,\n  ':hover,:active': {\n    background: DT.T_BUTTON_PRIMARY_COLOR_BG_HOVER,\n    boxShadow: shadowed ? DT.T_SHADOW_BUTTON_PRIMARY_HOVER : 'none',\n  },\n  color: DT.T_BUTTON_PRIMARY_COLOR_TEXT_DEFAULT,\n  fill: DT.T_BUTTON_PRIMARY_COLOR_TEXT_DEFAULT,\n  border: 'none',\n  boxShadow: shadowed ? DT.T_SHADOW_BUTTON_PRIMARY : 'none',\n  transition: `${transitionProperty} ${transitionFlat}`,\n  ':link,:visited': {\n    color: DT.T_BUTTON_PRIMARY_COLOR_TEXT_DEFAULT,\n  },\n},\n...\n```\nå¯ä»¥çœ‹åˆ°ï¼Œå½“`styleType='primary'æ—¶`ï¼Œè®¾ç½®äº†å…¶èƒŒæ™¯è‰². æ–‡å­—é¢œè‰². å¡«å……è‰². æ¸å˜. è¿‡æ¸¡. æ¿€æ´»æ—¶çš„æ ·å¼ä»¥åŠè¢«è®¿é—®åçš„æ ·å¼ç­‰ã€‚\n\nå¦‚æ­¤ï¼Œä¸€ä¸ªç®€å•çš„Buttonç»„ä»¶å°è£…è£…å¥½äº†ï¼Œæˆ‘ä»¬åªæ˜¯å¯¹æ ·å¼è¿›è¡Œäº†æ”¹åŠ¨ï¼Œå…¶æœ¬è´¨è¿˜æ˜¯è¿”å›äº†ä¸€ä¸ªåŸç”ŸæŒ‰é’®ï¼ŒåŸæ¥çš„äº‹ä»¶ä¸å½±å“ä½¿ç”¨ã€‚\n\n### Button demo\n\næˆ‘ä»¬å†™ä¸ªdemoæµ‹è¯•ä¸€ä¸‹ã€‚åœ¨`src/components/Button`ä¸‹æ–°å»º`index.md`ï¼š\n\n```tsx\nimport React from 'react';\n\nimport { Button } from 'dumi-dux-ui';\n\n// demo start\nconst { StyleTypes } = Button;\n\nconst ColorDemo = () =\u003e {\n  return (\n    \u003cdiv\u003e\n      {StyleTypes.map((type) =\u003e (\n        \u003cButton styleType={type} key={type} onClick={() =\u003e console.log('clicked')}\u003e\n          Button\n        \u003c/Button\u003e\n      ))}\n    \u003c/div\u003e\n  );\n};\n// demo end\n\nexport default ColorDemo;\n```\nåœ¨`.umirc.ts`ä¸­åŠ å…¥ï¼š\n\n```js\n...\nmenus: {\n    // éœ€è¦è‡ªå®šä¹‰ä¾§è¾¹èœå•çš„è·¯å¾„ï¼Œæ²¡æœ‰é…ç½®çš„è·¯å¾„è¿˜æ˜¯ä¼šä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„é…ç½®\n    '/components': [\n      {\n        title: 'ç»„ä»¶',\n        path: '/components',\n        children: [\n          // èœå•å­é¡¹ï¼ˆå¯é€‰ï¼‰\n          'components/Icon/index.md',\n          'components/Button/index.md',\n        ],\n      },\n    ],\n  },\n```\n\næ ¹ç›®å½•ä¸‹æ‰§è¡Œ`npm run docs`ï¼Œ ä¸å‡ºæ„å¤–çš„è¯ï¼Œåœ¨localhost:8000/components/buttonä¸‹å¯ä»¥çœ‹åˆ°ï¼š\n\n![image.png](/img/posts/2022-3-19/2022-3-19-10.png)\nF12æµ‹è¯•ç‚¹å‡»äº‹ä»¶ï¼š\n\n![image.png](/img/posts/2022-3-19/2022-3-19-11.png)\n\nè‡³æ­¤ï¼ŒåŸºç¡€ç»„ä»¶Iconå’ŒButtonçš„è®°å½•å°±åˆ°æ­¤ç»“æŸäº†ã€‚ä¸‹ä¸€æœŸä¼šè®°å½•å¸ƒå±€ç»„ä»¶çš„æ­å»ºï¼Œæ•¬è¯·æœŸå¾…~\n\n\n---\n\nå‚è€ƒï¼š\n[antdæ ·å¼è®¾è®¡](https://ant.design/docs/spec/values-cn) \n[Material UIè®¾è®¡](https://mui.com/zh/components/buttons/)"])</script><script>self.__next_f.push([1,"4e:T2957,"])</script><script>self.__next_f.push([1,"## 1. å‰è¨€\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æ‰¿æ¥ä¸Šä¸€ç¯‡[æ‰‹æŠŠæ‰‹æ­å»ºåŸºäºReactçš„å‰ç«¯UIåº“ ï¼ˆä¸€ï¼‰-- é¡¹ç›®åˆå§‹åŒ–](https://juejin.cn/post/7074915729601986567)ï¼Œå¦‚æœæ²¡æœ‰çœ‹è¿‡é¡¹ç›®æ­å»ºçš„ï¼Œå¯ä»¥ç‚¹å‡»å‰è¾¹çš„é“¾æ¥ã€‚åœ¨dumié¡¹ç›®æ­å»ºå®Œæ¯•åï¼Œæˆ‘ä»¬ç€æ‰‹å†™ä¸€ä¸‹å…¨å±€ä¸»é¢˜é…ç½®ã€‚\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æœ¬æ–‡çš„ä»£ç å±•ç¤ºçš„æ˜¯ä¸»è¦çš„æ ¸å¿ƒä»£ç ï¼Œå…¨éƒ¨ä»£ç è§ä»“åº“ï¼š[Githubä»“åº“](https://github.com/heiheihoho1213/dux-ui)\n\n## 2. UIåº“ä¸‰è¦ç´ \n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;åœ¨å†³å®šè¦å†™æ ¸å¿ƒç»„ä»¶ä¹‹å‰ï¼Œé¦–å…ˆè¦ç¡®å®šè¿™ä¹ˆå‡ ä¸ªæ³¨æ„äº‹é¡¹ï¼š\n\n- `1. Styleé£æ ¼`\n- `2. é€‚é…æ€§`\n- `3. å†…å®¹é€‚åº”æ€§`\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;`Styleé£æ ¼`å¯ä»¥åŒ…å«ç»„ä»¶åº“çš„è‰²å½©è®¾è®¡ï¼Œè§†è§‰é£æ ¼è®¾è®¡ï¼Œå­—ä½“ï¼ŒåŠ¨ç”»æ•ˆæœï¼Œä¸»é¢˜çš®è‚¤å’Œä¸€äº›åŸºç¡€æ ·å¼çš„è®¾è®¡ç­‰ï¼›`é€‚é…æ€§`åˆ™è¡¨ç¤ºè¦è€ƒè™‘ç»„ä»¶åº“è¦è¿è¡Œåœ¨ä»€ä¹ˆå¹³å°ï¼Œæ˜¯PCç«¯è¿˜æ˜¯ç§»åŠ¨ç«¯ï¼Œæˆ–è€…æ˜¯å…¼å®¹å…¶ä»–å¹³å°ç­‰ï¼›`å†…å®¹é€‚åº”æ€§`æŒ‡çš„æ˜¯ç»„ä»¶åŒ…å«çš„åŠŸèƒ½èŒƒå›´ï¼Œæ–‡æ¡ˆå‹å¥½åº¦ï¼Œæ˜¯å¦è€ƒè™‘å›½é™…åŒ–ï¼Œå¯¹å¼€å‘è€…æ˜¯å¦å‹å¥½ç­‰é—®é¢˜ã€‚è¿™äº›è®¾è®¡é£æ ¼ä»è€…è§ä»ï¼Œåœ¨ä¹‹åçš„æ–‡ç« ä¸­ä¼šé™†ç»­è®°å½•æˆ‘æ˜¯å¦‚ä½•è®¾è®¡çš„ã€‚\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;åŸºäºä¸Šè¿°åŸåˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä»ä¸»é¢˜è‰²å½©å…¥æ‰‹ã€‚\n\n\u003chr /\u003e\n\n## 3. ThemeProvider\n\nThemeå’Œæ ·å¼è‡ªç„¶æ˜¯å±äºå…¨å±€çš„ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª`provider`æ¥æ‰¿æ¥ã€‚\n\n### ThemeProvider.tsx\n\nåœ¨`src/components`ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹`ThemeProvider`ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶`ThemeProvider.tsx`ï¼š\n\n```tsx\nclass ThemeProvider extends Component {\n    ...\n}\n```\n\n\nåœ¨`src/components/ThemeProvider/ThemeProvider.tsx`ä¸­æ·»åŠ propsï¼Œå…¶ä¸­çš„themeè¡¨ç¤ºå½“å‰çš„ä¸»é¢˜ï¼š\n\n```tsx\nstatic propTypes = {\n    /**\n     * è‡ªå®šä¹‰ä¸»é¢˜\n     */\n    theme: PropTypes.object.isRequired\n};\n```\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æ¥ä¸‹æ¥å®‰è£…ä¸€ä¸ªç¬¬ä¸‰æ–¹ä¾èµ–`emotion-theming`æ¥æä¾›ä¸»é¢˜åŒ–çš„è§£å†³æ–¹æ¡ˆï¼Œè¯¦ç»†é…ç½®å¯æŸ¥çœ‹å…¶[ä¸»é¡µ](https://emotion.sh/docs/theming#themeprovider-reactcomponenttype)ï¼Œå°±å½“åšæ˜¯ä¸€ä¸ªå…¨å±€çš„`context`æ¥ç®¡ç†çŠ¶æ€å§ã€‚æ‰§è¡ŒæŒ‡ä»¤ï¼š\n```sh\nnpm i --save emotion emotion-theming @emotion/core @emotion/styled\n```\n\nç„¶åå®šä¹‰æ„é€ å™¨å’Œæ¸²æŸ“å‡½æ•°ï¼š\n```tsx\nimport React, { Component } from 'react';\nimport _ from 'lodash';\nimport PropTypes from 'prop-types';\nimport { ThemeProvider as EThemeProvider } from 'emotion-theming';\n\nconstructor(props: any) {\n    super(props);\n    const theme = props.theme;\n \n    this.state = {\n        theme\n    };\n}\n...\nrender() {\n    // eslint-disable-next-line no-unused-vars\n    const { theme: _theme, ...rest } = this.props as any;\n    const { theme } = this.state;\n    return \u003cEThemeProvider theme={theme} {...rest} /\u003e;\n}\n```\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ç•™å¿ƒçš„æœ‹å‹å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œæˆ‘è¿™é‡Œçš„stateä¸­çš„themeæ˜¯å†™åœ¨æ„é€ å™¨ä¸­çš„ï¼Œåœ¨æŒ‚è½½çš„æ—¶å€™åªæ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœç”¨æˆ·æƒ³è¦åˆ‡æ¢ä¸»é¢˜ï¼Œå¿…ç„¶ä¼šé€šè¿‡`props`ä¼ é€’æ–°çš„themeå€¼ï¼Œæˆ‘ä»¬è¿™é‡Œæ£€æµ‹propså˜åŒ–ï¼š\n\n```tsx\n...\ncomponentWillReceiveProps(nextProps: any) {\n    const { theme } = nextProps;\n    if (JSON.stringify(theme) !== this.cache) {\n        const mergedTheme = this.getMergedTheme(theme);\n        this.cache = JSON.stringify(theme);\n        this.setState(\n            {\n                theme: mergedTheme\n            },\n        );\n    }\n}\n\ngetMergedTheme = (theme: string) =\u003e {\n    return generateTheme(theme);\n};\n```\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å¯ä»¥çœ‹åˆ°ï¼ŒåŠ äº†ä¸€ä¸ªæœ¬åœ°çš„ç¼“å­˜`cache`æ¥é¿å…é‡å¤å˜æ›´ã€‚å…¶ä¸­`generateTheme`æ˜¯æˆ‘å†™çš„ä¸€ä¸ªå¢å¼ºæ–¹æ³•ï¼Œç”¨äºå¤„ç†å‰åä¸¤ä¸ªä¸»é¢˜å¯¹æ¯”æ›´æ–°ï¼Œå¹¶åŠ å…¥äº†ä¸€äº›å¸¸ç”¨æ ·å¼ï¼Œæ¯”å¦‚`fontSize`ç­‰ï¼Œå¦‚æœä½ è§‰å¾—æ²¡å¿…è¦ï¼Œé‚£ä¹ˆä½ ç›´æ¥è®¾ç½®æ‹¿åˆ°çš„themeå°±è¡Œäº†ã€‚\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;è‡³æ­¤ï¼Œä¸€ä¸ªæä¾›ä¸»é¢˜çš„providerå°±å†™å¥½äº†ï¼Œç°åœ¨æ¥ç»™ä»–å¢åŠ çµé­‚ï¼šé…è‰²ã€‚è¿™é‡Œæˆ‘å†™äº†ä¸¤ç§é…è‰²ï¼ˆä½ ä¹Ÿå¯ä»¥è‡ªå·±è®¾è®¡ï¼Œå¦‚æœä½ å…·å¤‡è®¾è®¡å¸ˆçš„ç¾å­¦ç´ å…»å’Œä¸“ä¸šçŸ¥è¯†çš„è¯ï¼‰ï¼š`Black`å’Œ`White`ã€‚\n\n### designTokens.ts\n\næˆ‘ä»¬åœ¨`ThemeProvider.tsx`åŒç›®å½•æ–°å»ºæ–‡ä»¶`designTokens.ts`æ¥æ”¾ç½®é»˜è®¤ä¸»é¢˜é…è‰²ï¼š\n\n\n```ts\n/** é»˜è®¤çš„ä¸»é¢˜é…è‰² */\nconst designTokens = {\n    ...\n};\n\nexport { designTokens };\n```\nå…·ä½“çš„é…è‰²å˜é‡åº”å…¨å¤§å†™ï¼Œä»¥Tå¼€å¤´ï¼Œä»…åŒ…å«å­—æ¯. æ•°å­—. ä¸‹åˆ’çº¿ï¼Œç”±äºå˜é‡å¤ªå¤šï¼Œè¿™é‡Œç»™å‡ºä¸€éƒ¨åˆ†ï¼š\n\nèƒŒæ™¯è‰²ï¼š\n\n![image.png](/img/posts/2022-3-19/2022-3-19-1.png)\n\nå¤šå½©è‰²ï¼š\n\n![image.png](/img/posts/2022-3-19/2022-3-19-2.png)\n\n\næ¸å˜è‰²æ± ï¼š\n\n![image.png](/img/posts/2022-3-19/2022-3-19-3.png)\n\n\nå¸¸ç”¨å°ºå¯¸ï¼š\n\n![image.png](/img/posts/2022-3-19/2022-3-19-4.png)\n\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;åŒç†ï¼Œåœ¨ç›¸åŒçš„ç›®å½•ä¸‹ï¼Œæ–°å»ºæ–‡ä»¶`dark.ts`, æ”¾å…¥ç›¸åŒçš„å˜é‡ï¼Œä½†æ˜¯è‰²å·åº”è¯¥æ˜¯æš—è‰²è°ƒçš„é…è‰²ï¼Œäº®è‰²è°ƒä¸‹çš„äº®è‰²ï¼Œåœ¨æš—è‰²è°ƒä¸‹åº”è¯¥æ˜¯æš—è‰²ã€‚æ¯”å¦‚æ¸å˜è‰²æ± åº”è¯¥æ˜¯ä¸‹é¢è¿™æ ·ï¼š\n\n![image.png](/img/posts/2022-3-19/2022-3-19-5.png)\n\n\nè¿™äº›é…è‰²æ–¹æ¡ˆï¼Œç½‘ä¸Šä¹Ÿèƒ½æ‰¾åˆ°ç±»ä¼¼çš„ï¼Œé€‰æ‹©è‡ªå·±å–œæ¬¢çš„å°±è¡Œäº†ã€‚\n\næœ‰äº†è¿™äº›é¢œè‰²æ± ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªæ–¹æ³•æ¥è·å–å½“å‰çš„`designTokens`ï¼Œè¿˜æ˜¯åœ¨åŒç›®å½•ä¸‹ï¼Œæ–°å»ºæ–‡ä»¶`useDesignTokens.ts`ï¼š\n\n\n```tsx\nimport { useTheme } from 'emotion-theming';\n\n// ../../styleä¸­å†™äº†å‡ ä¸ªè¾…åŠ©çš„æ ·å¼ï¼Œå¯¹è§£é‡ŠåŸç†æ²¡æœ‰å½±å“ï¼Œæƒ³çœ‹å…¨éƒ¨ä»£ç å¯ä»¥å»é¡¹ç›®ä»“åº“æŸ¥çœ‹\nimport { defaultTheme, Theme } from '../../style';\n\nconst useDesignTokens = () =\u003e {\n  // æ‹¿åˆ°Themeproviderçš„theme\n  const theme = useTheme\u003cTheme\u003e();\n  if (!Object.keys(theme).length) return defaultTheme.designTokens;\n  return theme.designTokens;\n};\n\nexport default useDesignTokens;\n\n```\nè¿™æ ·ï¼Œå°±å¯ä»¥åœ¨ä»»ä½•ä¸€ä¸ªåœ°æ–¹ï¼Œé€šè¿‡useDesignTokensæ‹¿åˆ°å½“å‰çš„ä¸»é¢˜é…è‰²äº†ã€‚\n\n## 4. åæ€\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å†å›åˆ°`ThemeProvider`æœ¬èº«è¿›è¡Œæ€è€ƒï¼Œæ€»è§‰å¾—å°‘äº†ç‚¹ä»€ä¹ˆã€‚æ˜¯ä¸æ˜¯æ˜¾å¾—åŠŸèƒ½æœ‰ç‚¹å•è–„ï¼Œä¼ å€¼åªèƒ½ä¼ é€’themeï¼Œä¸å¤Ÿçµæ´»ã€‚æ•´ä¸ªç»„ä»¶åº“é¡¹ç›®è¦ç»´æŠ¤çš„å…¬å…±å˜é‡åº”è¯¥ä¸ä¼šåªæœ‰ä¸»é¢˜ï¼Œåæ¥å¯èƒ½è¿˜ä¼šæœ‰å›½é™…åŒ–ä»€ä¹ˆçš„ï¼Œæ‰€ä»¥ï¼Œæ˜¯ä¸æ˜¯è¦å†™ä¸€ä¸ªæ›´é€šç”¨çš„Provideræ¥ç»Ÿä¸€å¤„ç†ï¼Ÿ\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æˆ‘ä»¬åœ¨`src/components`æ–‡ä»¶å¤¹ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹`ConfigProvider`ï¼Œåœ¨æ–°åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºæ–‡ä»¶`ConfigProvider.tsx`ï¼Œå†™ä¸Šå¦‚ä¸‹ä»£ç ï¼š\n\n```tsx\nimport React, { ReactNode, createContext } from 'react';\n\nimport ThemeProvider from '../ThemeProvider';\n\nexport interface ConfigProviderProps {\n  /** @ignore */\n  children: ReactNode;\n\n  /** æä¾›æ—¶ä¼šä½¿ç”¨ ThemeProvider åŒ…è£¹ */\n  theme?: any;\n}\n\nconst ConfigProvider = ({ children, theme, ...rest }: ConfigProviderProps) =\u003e {\n\n  const defaultConfig = {};\n  const ConfigContext = createContext\u003cany\u003e(defaultConfig);\n\n  let provider = (\n    \u003cConfigContext.Provider value={{ ...defaultConfig, ...rest }}\u003e\n      {children}\n    \u003c/ConfigContext.Provider\u003e\n  );\n  if (theme) provider = \u003cThemeProvider theme={theme}\u003e{provider}\u003c/ThemeProvider\u003e;\n\n  // ä¸‹è¾¹å¯ä»¥è¿½åŠ å…¶ä»–æƒ…å†µçš„Provider ...\n\n  return provider;\n};\n\nexport { ThemeProvider };\nexport default ConfigProvider;\n```\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨`createContext`æ¥åˆ›å»ºä¸€ä¸ªcontextæ”¾ç½®å…¨å±€å˜é‡ï¼Œä½¿ç”¨`ConfigContext.Provider`ä½œä¸ºåŸºç¡€å…¨å±€å‚æ•°ï¼Œé€šè¿‡æ‹¿åˆ°çš„ä¸åŒå‚æ•°æ¥åŠ¨æ€å åŠ è½¬æ¢ä¸ºå…¶ä»–ä¸åŒçš„`Provider`ã€‚å½“ç„¶ï¼Œcontextå¯ä»¥è‡ªå·±å†å•å†™ä¸€ä¸ªæ–‡ä»¶æ¥å­˜å‚¨ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚\n\n## 5. å¦‚ä½•ä½¿ç”¨\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ä¸ºäº†èƒ½å¤Ÿåœ¨ç»„ä»¶ä¸­ä½¿ç”¨çš„å†…ç½®ä¸»é¢˜è‰²ï¼Œéœ€è¦å°†é…ç½®å¯¹å¤–æš´éœ²å‡ºæ¥ï¼Œåœ¨`src/index.ts`æ–‡ä»¶ä¸­åˆ é™¤ä¸Šä¸€æœŸå¯¼å…¥çš„Fooç»„ä»¶ï¼š\n\n\u003cdel\u003e`export { default as Foo } from './components/Foo';`\u003c/del\u003e\n\nç„¶ååŠ å…¥å¦‚ä¸‹ä»£ç ï¼š\n\n```ts\nexport { default as ThemeDark } from './components/ThemeProvider/dark';\nexport { designTokens as ThemeDefault } from './components/ThemeProvider/designTokens';\nexport {\n  default as ConfigProvider,\n  ThemeProvider,\n} from './components/ConfigProvider/ConfigProvider';\n```\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ä¸»é¢˜é…ç½®æœ‰äº†ï¼Œæ¥ä¸‹æ¥è¦æ€ä¹ˆç”¨å‘¢ï¼Ÿç”¨è¿™ä¸ªProvideræŠŠå…¨å±€Appç»„ä»¶åŒ…è£¹ä¸€ä¸‹å—ï¼Ÿå¦‚æœæœ‰ä¸ªåˆ«ç»„ä»¶æƒ³è¦å®šåˆ¶æ ·å¼å‘¢ï¼Ÿä¼¼ä¹ä¸å¤Ÿçµæ´»ï¼Œä½œè€…è®¤ä¸ºåº”è¯¥å°è£…ä¸€ä¸ªå·¥å…·ç±»ï¼Œåœ¨éœ€è¦é…ç½®ä¸»é¢˜è‰²çš„ç»„åŠ ä¸Šä½¿ç”¨å³å¯ã€‚åœ¨`src`ç›®å½•ä¸‹æ–°å»º`style`æ–‡ä»¶å¤¹ç”¨æ¥æ”¾ç½®å…¬å…±çš„æ ·å¼é…ç½®ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ–°å¢æ–‡ä»¶`styleWrap.tsx`ï¼š\n\n```tsx\n// å¼•å…¥ä¾èµ–\nimport React, { FC, useMemo } from 'react';\nimport { useTheme } from 'emotion-theming';\nimport defaultTheme from '../components/ThemeProvider/theme';\n\n...\n\n// æ–°å»ºä¸€ä¸ªå‡½æ•°\nconst styleWrap = () =\u003e {\n    ...\n    return Com =\u003e {\n        const WithThemeComponent = (props) =\u003e {\n\n            ...\n\n            const theme = useTheme();\n\n            const memoTheme = useMemo(\n                () =\u003e (!theme || !Object.keys(theme)?.length ? defaultTheme : theme),\n                [theme],\n            );\n\n            const result = {\n                ...props,\n                theme: memoTheme,\n            };\n            ...\n\n            const Com = Comp as unknown as FC;\n            // resultä¸­å¸¦æœ‰themeä¸»é¢˜å‚æ•°ï¼Œåœ¨åŸºç¡€ä¸šåŠ¡ç»„ä»¶ä¸­åº”æ¥å—å¹¶å¤„ç†\n            return \u003cCom {...result} /\u003e;\n        } \n\n        return WithThemeComponent;\n    }\n}\n\n```\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å¯ä»¥çœ‹åˆ°ï¼ŒstyleWrapè¿”å›çš„æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶WithThemeComponentï¼Œåœ¨è¯¥ç»„ä»¶é‡Œè·å–å½“å‰ä¸»é¢˜å¹¶ä½¿ç”¨`useMemo`èŠ‚çœæ¸²æŸ“å¼€é”€ï¼Œå°†ç»“æœæ”¶é›†åˆ°`result`é‡Œä½œä¸ºå±æ€§ä¼ é€’ç»™åŸºç¡€ä¸šåŠ¡ç»„ä»¶`Com`.\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æ¥ä¸‹æ¥è®°å½•ä¸€ä¸‹`ThemeProvider`åœ¨ç»„ä»¶ä¸­çš„ä½¿ç”¨æ–¹å¼ï¼š\n\n\n```tsx\n...\n// 1. å¼•å…¥ä¸€ç§å­—ä½“\nconst [theme, setTheme] = useState(ThemeDark);\n...\n\n// 2. ä½¿ç”¨\n\u003cConfigProvider theme={theme}\u003e\n    // æ”¾ç½®è¢«styleWrapåŒ…è£¹çš„ä¸šåŠ¡ç»„ä»¶\n    ...\n\u003c/ConfigProvider\u003e\n\n// 3. åˆ‡æ¢ä¸»é¢˜\nsetTheme(designTokens);\n```\n\n\n\u003chr /\u003e\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æœ¬æœŸä¸»é¢˜é…ç½®çš„è®°å½•åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œä¸‹ä¸€æœŸè®²è§£åŸºç¡€ç»„ä»¶`Button`å’Œ`Icon`çš„è®¾è®¡ï¼ŒåŒæ—¶ä¼šå°†ä¸»é¢˜è‰²åº”ç”¨åœ¨è¿™äº›ç»„ä»¶ä¸Šï¼Œä¸ºäº†èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£åŸºç¡€ç»„ä»¶å¦‚ä½•å¤„ç†ä¼ å…¥çš„themeå‚æ•°ï¼Œä¸‹ä¸€æœŸä¼šå’Œæœ¬æœŸä¸€èµ·å‘å¸ƒï¼Œæ•¬è¯·æœŸå¾…~~"])</script><script>self.__next_f.push([1,"4f:T14b2,"])</script><script>self.__next_f.push([1,"## 1. å‰è¨€\n\n### å†™ä½œèƒŒæ™¯\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ç°åœ¨å¼€å§‹æˆ‘åœ¨æ˜é‡‘çš„ç¬¬ä¸€ä¸ªä¸“æ ï¼Œè®°å½•ä¸€ä¸‹æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­æ­å»ºUIç»„ä»¶åº“çš„è¿‡ç¨‹ï¼Œä»¥ä¾¿äºä»¥åæŸ¥è¯¢ï¼ŒåŒæ—¶ä¹Ÿä¸ºå¤§å®¶æä¾›ä¸€ç§åŸºäºReactåˆ›å»ºå‰ç«¯UIåº“çš„æ€è·¯ã€‚\n\n### ä¸ºä»€ä¹ˆè¦è‡ªå·±å†™UIåº“\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ç°åœ¨ä¼˜ç§€çš„å‰ç«¯å¼€æºUIåº“å·²ç»å¾ˆå¤šäº†ï¼Œæ¯”å¦‚antd. Material UI. element UIç­‰ç­‰ï¼Œè¿™äº›UIåº“ç”Ÿæ€éƒ½æ¯”è¾ƒå®Œå–„ï¼Œæ–‡æ¡£ä¹Ÿå†™å¾—å¾ˆå¥½ï¼Œä½ åœ¨é¡¹ç›®ä¸­ç›´æ¥ç”¨ä¸å°±è¡Œäº†ï¼Œå¯ä¸ºä»€ä¹ˆè¿˜è¦è‡ªå·±å†™å‘¢ï¼Ÿå€Ÿç”¨ä¸€å¥è€è¯ï¼Œç§Ÿä¸å¦‚ä¹°ï¼Œä¹°ä¸å¦‚é€ ï¼Œä»è¿™ä¸ªè§’åº¦ä¹Ÿèƒ½çŸ¥é“è€ç”¨åˆ«äººçš„æ€»è§‰å¾—æœ‰ç‚¹ç¼ºé™·ï¼Œè¿™é‡Œä½œè€…ä¸ªäººè®¤ä¸ºåšæŒå†™è‡ªå·±çš„UIåº“ä¸»è¦æœ‰è¿™ä¹ˆå‡ ä¸ªåŸå› ï¼š\n\n*1.* *ä¼šå—åˆ¶äºäººã€‚*\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;è™½ç„¶æ˜¯å¼€æºçš„åº“ï¼Œä½†æ˜¯éè§‚å¸‚é¢ä¸Šå¤§å¤šæ•°äº§å“ï¼Œéƒ½æ²¡æœ‰ç”¨è¿™äº›ç»„ä»¶åº“ï¼Œç›¸åçš„æ˜¯ä¼ä¸šå†…éƒ¨çš„é¡¹ç›®ç”¨çš„æ¯”è¾ƒå¤šã€‚æˆ‘æƒ³æ›´å¤šçš„åŸå› æ˜¯ä¸æƒ³å—åˆ¶äºäººï¼Œå¦‚æœå“ªä¸€å¤©UIåº“çš„ä½œè€…æƒ³è¦æ”¶ä¸“åˆ©è´¹äº†ï¼Œä½ çš„é¡¹ç›®è¦ä¸è¦è¿ç§»åˆ°åˆ«çš„ç»„ä»¶åº“ï¼Ÿè¿˜æ˜¯è¯´ä¹–ä¹–äº¤é’±å‘¢ï¼Ÿå¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ å…¬å¸æ‰€æœ‰çš„äº§å“éƒ½ç”¨äº†antdï¼Œæ—¥ç§¯æœˆç´¯ï¼Œä½ å°±ä¼šå¤©ç„¶çš„ä¾èµ–é˜¿é‡Œçš„å¼€å‘ä¹ æƒ¯ï¼Œé€‰æ‹©æ–°äº§å“çš„æ—¶å€™å°±ä¼šæ›´å€¾å‘äºé˜¿é‡ŒåŒç³»çš„ï¼Œæ‰€ä»¥è¯´ï¼Œå…è´¹çš„ä»£ä»·æ˜¯å¤±å»è‡ªä¸»æƒã€‚\n\n*2.* *å‡çº§äº§å“éœ€è¦çœ‹è„¸è‰²ã€‚*\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ä¸¾ä¸ªä¾‹å­ï¼Œä½ çš„äº§å“æ‰€ä½¿ç”¨çš„æ¡†æ¶ï¼ŒVueè¦ä»2å‡3ï¼ŒAngularè¦ä»9å‡12ï¼ŒReactè¦å‡çº§18äº†ï¼Œè€Œä½ æ‰€ä¾èµ–çš„ç¬¬ä¸‰æ–¹UIç»„ä»¶åº“è¿˜ä¸æ”¯æŒæ–°ç‰ˆæœ¬æ¡†æ¶ï¼Œæˆ–è€…å¯¹æ–°ç‰ˆæœ¬æ¡†æ¶æˆ–å…¶ä»–çš„ä¾èµ–éƒ¨åˆ†å…¼å®¹ï¼Œè¿™å°±ä¼šä½¿å¾—ä½ çš„å¼€å‘éå¸¸çš„éš¾å—ã€‚\n\n*3.* *ä¸å¥½ç»´æŠ¤ã€‚*\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ä½¿ç”¨åˆ«äººçš„ç»„ä»¶åº“ï¼Œå¦‚æœå‡ºäº†Bugæ€ä¹ˆä¿®å‘¢ï¼Ÿéš¾é“è¦åœ¨Githubä¸ŠæIssueå˜›ğŸ˜‚ï¼Œè¿™æ ·æŠ±æ€¨çš„æ˜¯ä½ çš„å®¢æˆ·ï¼Œå—æŸçš„æ˜¯ä½ çš„äº§å“ã€‚ç¬¬ä¸‰æ–¹è¿›è¡Œçš„å¼€æºï¼Œæ˜¯ä¸ªåŒåˆƒå‰‘ï¼Œå…è´¹ç»™ä½ ç”¨ï¼Œä½†æ˜¯å‡ºäº†é—®é¢˜äººå®¶ä¹Ÿä¸è´Ÿè´£ã€‚\n\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æœ‰äº†è¿™äº›åŸå› ï¼Œåº”è¯¥ä¸ä¼šå†è´¨ç–‘ä¸ºä»€ä¹ˆè¦åšè‡ªå·±çš„UIåº“äº†å§ã€‚æ‹¥æœ‰è‡ªå·±å…¨å¥—çš„äº§å“ä½“ç³»ï¼Œå¯¹äºä¼ä¸šï¼Œæ˜¯ä¸€ä¸ªæ‹¿å›è‡ªä¸»æƒçš„é‡è¦ä¸€æ­¥ï¼Œå¯¹äºæˆ‘ä»¬å¼€å‘è€…ï¼Œä¹Ÿæ˜¯é”¤ç‚¼è‡ªå·±åŸºæœ¬åŠŸçš„è¿‡ç¨‹ï¼Œä½•ä¹è€Œä¸ä¸ºï¼Ÿ\n\n## 2. åŸºäºReact\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;è¿™é‡Œè®°å½•æˆ‘ç°åœ¨æ­£åœ¨æ­å»ºçš„ä¼ä¸šé¡¹ç›®ï¼Œä¸€è¾¹æ­å»ºä¸€è¾¹è®°å½•ï¼Œå…¶ä¹èèï¼Œå¯ä»¥ç§°å¾—ä¸Šæ‰‹æŠŠæ‰‹æ•™å­¦æœ¬å­¦äº†\\[doge\\]ã€‚\n\n### 1. ä½¿ç”¨dumiåˆ›å»º\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;dumiæ˜¯ä¸€ä¸ªå¼€æºçš„è´Ÿè´£ç»„ä»¶å¼€å‘åŠç»„ä»¶æ–‡æ¡£ç”Ÿæˆçš„å·¥å…·ï¼Œè¿™é‡Œä»…ä¸ºäº†æ–¹ä¾¿ç»„ä»¶åº“æ–‡æ¡£å±•ç¤ºä½¿ç”¨ã€‚åœ¨æœ€åæ‰“åŒ…å‘å¸ƒæ—¶ï¼Œdumiä¸å‚ä¸æ‰“åŒ…ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨dumiæ˜¯å¯ä»¥çš„ã€‚\n\næ¥ä¸‹æ¥å°±å¼€å§‹è®°å½•å®æ“æ­¥éª¤ã€‚\n\né¦–å…ˆå®‰è£…Â [node](https://nodejs.org/en/)ï¼Œå¹¶ç¡®ä¿`node \u003e= 10.13 \u0026\u0026 node \u003c 17.6.0`ã€‚è¿™é‡Œä½œè€…äº²æµ‹ï¼Œnode 17.6.0æ˜¯ä¸å…¼å®¹çš„ï¼Œè€Œä½œè€…æœ¬åœ°ä½¿ç”¨çš„`v16.14.2`å¯ä»¥å®Œå…¨å…¼å®¹ã€‚\n\nåœ¨ç©ºç™½çš„åœ°æ–¹æ–°å»ºæ–‡ä»¶å¤¹\n```sh\nmkdir dux-ui \u0026\u0026 cd ./dux-ui\n```\n\nç„¶åæ‰§è¡Œå®‰è£…å‘½ä»¤ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©ç«™ç‚¹å¼çš„åˆ›å»ºæ–¹å¼\n\n```sh\n$ npx @umijs/create-dumi-lib        # åˆå§‹åŒ–ä¸€ä¸ªæ–‡æ¡£æ¨¡å¼çš„ç»„ä»¶åº“å¼€å‘è„šæ‰‹æ¶\n// or\n$ yarn create @umijs/dumi-lib\n\n$ npx @umijs/create-dumi-lib --site # åˆå§‹åŒ–ä¸€ä¸ªç«™ç‚¹æ¨¡å¼çš„ç»„ä»¶åº“å¼€å‘è„šæ‰‹æ¶\n// or\n$ yarn create @umijs/dumi-lib --site\n```\nåœ¨æ ¹ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤\n\n```sh\nnpm install\nnpm run dev\n```\nç„¶åé¡¹ç›®å°±è·‘èµ·æ¥äº†ï¼ï¼ˆç›—ç”¨å®˜ç½‘çš„å›¾ï¼Œä»…ä¾›å‚è€ƒï¼‰\n\n![image.png](/img/posts/2022-3-14/2022-3-14-1.png)\n\n### 2. æ–‡ä»¶ç›®å½•\n\nè„šæ‰‹æ¶æ­å»ºèµ·é¡¹ç›®åï¼Œå¯ä»¥çœ‹åˆ°åˆå§‹æ–‡ä»¶ç›®å½•\n\n![image.png](/img/posts/2022-3-14/2022-3-14-2.png)\n\n\nè¿™é‡Œä¸ºäº†å¼€å‘æ–¹ä¾¿ï¼Œæˆ‘ä»¬æŠŠè‡ªå®šä¹‰çš„ç»„ä»¶æ”¾åœ¨å•ç‹¬çš„`components`æ–‡ä»¶å¤¹ä¸‹ï¼š\n\n![image.png](/img/posts/2022-3-14/2022-3-14-3.png)\n\n\nç„¶åä¿®æ”¹`src`ä¸‹çš„`index`æ–‡ä»¶ä¸­ç»„ä»¶çš„å¯¼å…¥è·¯å¾„ï¼š\n\n```js\nexport { default as Foo } from './components/Foo';\n```\nä¿®æ”¹dumié…ç½®æ–‡ä»¶`.umirc.ts`ï¼Œæ–°å¢menuå±•ç¤ºè·¯å¾„ï¼š\n\n```js\nimport { defineConfig } from 'dumi';\n\nexport default defineConfig({\n  title: 'test-dumi',\n  favicon:\n    'https://user-images.githubusercontent.com/9554297/83762004-a0761b00-a6a9-11ea-83b4-9c8ff721d4b8.png',\n  logo: 'https://user-images.githubusercontent.com/9554297/83762004-a0761b00-a6a9-11ea-83b4-9c8ff721d4b8.png',\n  outputPath: 'docs-dist',\n  mode: 'site',\n  \n  // æ–°å¢\n  menus: {\n    // éœ€è¦è‡ªå®šä¹‰ä¾§è¾¹èœå•çš„è·¯å¾„ï¼Œæ²¡æœ‰é…ç½®çš„è·¯å¾„è¿˜æ˜¯ä¼šä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„é…ç½®\n    '/components': [\n      {\n        title: 'ç»„ä»¶',\n        path: '/components',\n        children: [\n          // èœå•å­é¡¹ï¼ˆå¯é€‰ï¼‰\n          'components/Foo/index.md',\n        ],\n      },\n    ],\n  },\n});\n```\n\nä¿®æ”¹`package.json`\n\n![image.png](/img/posts/2022-3-14/2022-3-14-4.png)\n\n\nç„¶åæ‰§è¡Œ\n\n```sh\nnpm run docs\n```\n\nå¯ä»¥çœ‹åˆ°è·‘èµ·æ¥äº†\n\n![image.png](/img/posts/2022-3-14/2022-3-14-5.png)\n![image.png](/img/posts/2022-3-14/2022-3-14-6.png)\n\nè‡³æ­¤ï¼Œé¡¹ç›®å°±æ­å»ºèµ·æ¥äº†ï¼æœ¬ç« åˆ°æ­¤ç»“æŸï¼Œä¸‹ä¸€èŠ‚ä¼šé€æ­¥è®°å½•å„ä¸ªç»„ä»¶çš„å¼€å‘è¿‡ç¨‹ã€‚"])</script><script>self.__next_f.push([1,"50:T2618,"])</script><script>self.__next_f.push([1,"## 1. nodeç¯å¢ƒä¸å¼€å‘å·¥å…·å‡†å¤‡\n\nå‰ç«¯å·¥ç¨‹åŒ–å¼€å‘ï¼Œæœ¬åœ°å¯åŠ¨å¼€å‘ç¯å¢ƒéƒ½æ˜¯åŸºäºnodejsçš„ï¼Œå‘½ä»¤è¡Œé‡Œè¾“å…¥æŒ‡ä»¤`node -v`å¯ä»¥å¸®åŠ©ç¡®è®¤æ‚¨çš„ç”µè„‘ä¸Šæ˜¯å¦å®‰è£…äº†nodeï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ï¼Œåˆ™å¯ä»¥å» [nodeå®˜ç½‘](http://nodejs.cn/download/) ä¸‹è½½å®‰è£…åŒ…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n![nodeå®˜ç½‘ä¸‹è½½ç•Œé¢](/img/posts/2022-3-1/2022-3-1-1.png)\nä¸ç®¡æ˜¯åœ¨windowsè¿˜æ˜¯åœ¨macç¯å¢ƒä¸‹ï¼Œéƒ½æ˜¯ä¸€é”®å‚»ç“œå¼å®‰è£…ï¼Œç”šè‡³è¿ç¯å¢ƒå˜é‡éƒ½ä¸éœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»äº†ã€‚\n\n\n## 2. å¼€å‘å·¥å…·å‡†å¤‡\nå‰ç«¯çš„å¼€å‘å·¥å…·ï¼Œå¸¸è§çš„æœ‰VSCode. WebStorm. Atomç­‰ï¼Œåªéœ€ç”¨å…¶ä¸­ä¹‹ä¸€ä¾¿è¶³å¯ä»¥å®Œæˆæ‚¨çš„å¼€å‘ä»»åŠ¡ã€‚è¿™é‡Œç¬”è€…ç»™å‡ºå¸¸ç”¨ç¼–è¾‘å™¨çš„å¯¹æ¯”ã€‚\n\n\n| å·¥å…·åç§° | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåº¦ |\n| --- | --- | --- | --- |\n| WebStorm | æ’ä»¶å¾ˆå¤šï¼ŒåŠŸèƒ½é½å…¨ | æ”¶è´¹ï¼Œå ç”¨èµ„æºå¤§ | â˜†â˜…â˜… | \n| Atom | ç•Œé¢æ•´æ´ï¼Œå…è´¹ | æ’ä»¶å®‰è£…å¤šäº†ä¼šæ…¢ï¼Œä¸å¤Ÿæµç•… | â˜†â˜…â˜… | \n| VSCode | è½»é‡çº§ï¼Œæ’ä»¶ç¹å¤šï¼Œæ”¯æŒå®šåˆ¶ï¼Œå…è´¹ | æ’ä»¶è¿‡å¤šä¼šå‡ºç°å†²çªï¼Œä»£ç çš„æç¤ºä¸å‹å¥½ | â˜†â˜…â˜…â˜…â˜… | \n\n\nç¬”è€…æ¥ä¸‹æ¥çš„å¼€å‘å°±ä»¥VSCodeä¸ºå‡†ã€‚\n\nvsCodeä½œä¸ºç›®å‰æœ€ä¸ºæµè¡Œçš„è½»é‡çº§å¼€å‘å·¥å…·ï¼Œå¹¿å—å‰åç«¯ç¨‹åºå‘˜çš„å–œçˆ±ï¼Œå…¶æ’ä»¶åº“ä¹Ÿæ˜¯ååˆ†çš„ä¸°å¯Œï¼Œå¯ä»¥ä¾›å¼€å‘çš„è¿›è¡Œè‡ªå®šä¹‰é…ç½®ï¼Œè€Œä¸”æä¾›äº†æ’ä»¶å¼€å‘çš„åŠŸèƒ½ï¼Œä½¿å¾—å¼€æºä½œè€…èƒ½å¤Ÿæ›´åŠ è½»æ¾çš„è‡ªå®šä¹‰è‡ªå·±çš„æ’ä»¶ï¼Œå¹¶ä¸”æœ‰æ”¯æŒè¿œç¨‹å¼€å‘ç­‰ä¼˜ç‚¹ã€‚ç›¸æ¯”äºwebStormå’Œsublimeè¿™ç§éœ€è¦è´­ä¹°æ­£å¼ç‰ˆï¼ˆsublimeè™½ç„¶ä¸ä¹°ä¹Ÿæ²¡ä»€ä¹ˆå…³ç³»ï¼‰çš„äº§å“ï¼Œå…¶æœ€ç›´æ¥çš„ä¼˜ç‚¹æ˜¯ä»–æ˜¯å…è´¹çš„ï¼\nvsCodeå®˜ç½‘åœ°å€ä¸ºï¼š`https://code.visualstudio.com/`ï¼Œå¼€å‘è€…å¯ä»¥ä¸‹è½½è‡ªå·±æ‰€éœ€çš„ç‰ˆæœ¬ï¼š\n\n![image.png](/img/posts/2022-3-1/2022-3-1-2.png)\nå›½å†…ç”¨æˆ·æœªç¿»å¢™çš„å¯èƒ½ä¼šå‡ºç°ä¸‹è½½ç¼“æ…¢çš„é—®é¢˜ï¼Œè¿™é‡Œä½œè€…æå‰ä¸‹è½½å¥½äº†å›½å†…ç‰ˆæœ¬æ”¾åœ¨æ–‡ç« æœ«å°¾ä¾›å¤§å®¶ä¸‹è½½ã€‚\n\natomä¹Ÿæ˜¯å…è´¹çš„å¼€å‘å·¥å…·ï¼Œè¿™ä¸ªæ ¹æ®è‡ªå·±çš„å–œå¥½æ¥ä½¿ç”¨ã€‚ä½œè€…ä¸€å¼€å§‹å†™ç½‘é¡µä¹Ÿæ˜¯ç”¨çš„atomï¼Œä½†æ˜¯å½“ä½ ä¸‹è½½äº†å®˜ç½‘çš„å®‰è£…åŒ…ï¼Œçœ‹åˆ°ä»–çš„å¤§å°åï¼Œæˆ–è€…åœ¨ä½¿ç”¨å¾ˆé•¿ä¸€æ®µæ—¶é—´åæ‰“å¼€èµ„æºç®¡ç†å™¨åï¼Œä½ å¯èƒ½å°±ä¼šåƒä½œè€…ä¸€æ ·å¼ƒç”¨å®ƒï¼è¿™é‡Œè¿˜æ˜¯ç»™å‡ºå…¶å®˜ç½‘åœ°å€`https://atom.io/`ï¼Œä»–çš„ç•Œé¢ä½œè€…è¿˜æ˜¯æŒºå–œæ¬¢çš„ã€‚\n\n## 3. reacté¡¹ç›®å¼€å‘ç¯å¢ƒæ­å»º\nreactå·¥ç¨‹åŒ–é¡¹ç›®åˆ›å»ºçš„è„šæ‰‹æ¶å·¥å…·è¿™é‡Œä½œè€…ä»‹ç»ä¸»æµçš„ä¸¤ç§ï¼š`create-react-app`å’Œ`vite`.\n### 3.1. create-react-appæ„å»º\nè¿™é‡Œä½¿ç”¨npxå®‰è£…ï¼š`npx create-react-app \u003cå·¥ç¨‹å\u003e`ã€‚\næ³¨æ„å·¥ç¨‹åç§°ä½¿ç”¨å­—æ¯æ•°å­—è¿æ¥çº¿çš„å½¢å¼(èŒƒä¾‹å‚è€ƒï¼š\\\u003chttps://create-react-app.dev/docs/getting-started/\u003e )ï¼Œè¿™é‡Œä½œè€…ä½¿ç”¨hello-world1.\næ„å»ºæˆåŠŸåä¼šçœ‹åˆ°æ§åˆ¶å°æ‰“å°å¦‚ä¸‹æŒ‡ä»¤ï¼š\n\n![10.png](/img/posts/2022-3-1/2022-3-1-3.png)\n\nè¿›å…¥å·¥ç¨‹æ ¹ç›®å½•`cd ./hello-world1`\n\u003e è‹¥åˆ›å»ºæ—¶æ²¡æœ‰å®‰è£…ä¾èµ–æˆåŠŸï¼Œè¿›å…¥å·¥ç¨‹æ ¹ç›®å½•ä¸‹æ‰‹åŠ¨å®‰è£…`npm inatall`å³å¯\n\næ‰§è¡ŒæŒ‡ä»¤ï¼š`npm start`ï¼Œå¯åŠ¨æˆåŠŸååœ¨æµè§ˆå™¨è¾“å…¥ç½‘å€`localhost:3000`å³å¯çœ‹åˆ°æ¬¢è¿ç•Œé¢ï¼š\n\n![11.png](/img/posts/2022-3-1/2022-3-1-4.png)\n\n### 3.2. viteæ„å»º\nç»ˆç«¯è¾“å…¥æŒ‡ä»¤\n```sh\n# npm 6.x\nnpm init vite@latest \u003cå·¥ç¨‹å\u003e --template \u003cæ¨¡æ¿å\u003e\n# npm 7+\nnpm init vite@latest \u003cå·¥ç¨‹å\u003e -- --template \u003cæ¨¡æ¿å\u003e\n```\nè¿™é‡Œæˆ‘ä»¬å½“ç„¶ä½¿ç”¨`react`ä½œä¸ºæ¨¡æ¿å. hello-world2ä½œä¸ºå·¥ç¨‹åæ¥æ„å»ºå·¥ç¨‹ç›®å½•ã€‚è¾“å…¥æŒ‡ä»¤åä½ ä¼šå‘ç°é¡¹ç›®æ„å»ºçš„å¾ˆå¿«ï¼Œé‚£æ˜¯å› ä¸ºè„šæ‰‹æ¶æ²¡æœ‰é»˜è®¤å¸®ä½ å®‰è£…ä¾èµ–ï¼Œæ‰€ä»¥è¦è¿›å…¥å·¥ç¨‹ç›®å½•ï¼ˆ`cd ./hello-world2`ï¼‰å¹¶æ‰‹åŠ¨å®‰è£…ä¾èµ–ï¼š`npm install`ã€‚ä¾èµ–å®‰è£…å®Œæˆåï¼Œå³å¯å¯åŠ¨é¡¹ç›®ï¼š`npm run dev`ï¼ŒåŒæ ·çš„ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥ç½‘å€`localhost:3000`å³å¯çœ‹åˆ°æ¬¢è¿ç•Œé¢ï¼š\n\n![12.png](/img/posts/2022-3-1/2022-3-1-5.png)\n\nè‡³æ­¤é¡¹ç›®å°±å¯åŠ¨å®Œæ¯•äº†~~ \n\nå¦‚æœæ‚¨åªæ˜¯æƒ³å¿«é€Ÿå¼€å‘ä¸€ä¸ªé¡¹ç›®ï¼Œç¯å¢ƒé…ç½®åˆ°è¿™é‡Œå°±ç»“æŸäº†ã€‚ä»¥ä¸‹å†…å®¹ä¸ºé€‰æ‹©æ€§è§‚çœ‹å†…å®¹ï¼Œå¦‚æœæ‚¨è§‰å¾—ä¾èµ–å®‰è£…æ¯”è¾ƒæ…¢ï¼Œåˆæˆ–è€…éœ€è¦ç®¡ç†ä¸åŒç‰ˆæœ¬çš„nodeï¼Œå¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹ã€‚\n\n## 4. ä¾èµ–å®‰è£…çš„æ–¹å¼(é€‰è¯»)\nä¸Šè¾¹ç« èŠ‚ä¸­ï¼Œä½œè€…ä¸»è¦ä½¿ç”¨`npm install`çš„æ–¹å¼å®‰è£…ä¾èµ–ï¼Œä½†æ˜¯æœ‰æ—¶å€™ï¼Œå°¤å…¶æ˜¯ç½‘ç»œä¸å¤ªå¥½çš„æƒ…å†µä¸‹ï¼Œä¾èµ–æ€»æ˜¯ä¸èƒ½è¢«æ­£ç¡®å®‰è£…ï¼Œå‡ºç°å®‰è£…é”™è¯¯ã€‚è¿™ä¸ªæ—¶å€™å¯èƒ½å°±éœ€è¦è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚\n### 4.1. npmå›½å†…é•œåƒé…ç½®\nå›½å†…npmé•œåƒå¯ä»¥ç»•å¼€è¢«å¢™çš„å›°æ‰°ï¼Œä½œè€…æ¨ètaobaoçš„é•œåƒã€‚ä½ å¯ä»¥è¿™æ ·æ‰§è¡Œå‘½ä»¤ï¼š\n`npm install -g cnpm --registry=https://registry.npm.taobao.org`ï¼Œè¿™æ ·å°±å…¨å±€å®‰è£…äº†ä½¿ç”¨çš„taobaoå›½å†…é•œåƒçš„cnpmæŒ‡ä»¤ã€‚ä½ åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¯•è¯•`cnpm install`å°±ä¼šå¿«å¾ˆå¤šã€‚\nä½ è¿˜å¯ä»¥è¿™æ ·é…ç½®é•œåƒï¼š\n`npm config set registry https://registry.npm.taobao.org`ï¼Œè¿™æ ·ä½ å³ä½¿ä½¿ç”¨npmæŒ‡ä»¤å®‰è£…ï¼Œä¹Ÿä¼šèµ°å›½å†…é•œåƒå®‰è£…ã€‚\n\n### 4.2. ä¸åŒçš„ä¾èµ–å®‰è£…ç­–ç•¥\nå‰ç«¯å·¥ç¨‹åŒ–é¡¹ç›®ä¾èµ–å®‰è£…ä¸åªæœ‰npmæ–¹å¼ï¼Œè¿˜æœ‰ä»–çš„å„ç§å˜ç§ã€‚æ¯”å¦‚å®‰è£…é€Ÿåº¦å¿«ï¼Œç‰ˆæœ¬èƒ½å¤Ÿæ›´å¥½ç»Ÿä¸€çš„`yarn`æˆ–è€…è¿è¡Œé€Ÿåº¦æ›´å¿«çš„`pnpm`ã€‚ç»†å¿ƒçš„è¯»è€…å¯ä»¥å‘ç°ï¼Œä¸Šé¢`create-react-app`å®‰è£…çš„æ–¹å¼ä½¿ç”¨äº†`npx`ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨`npm -g`è¿™ç§å…¨å±€æŒ‡ä»¤æ–¹å¼ã€‚åœ¨`npm 5.2`ä»¥åçš„ç‰ˆæœ¬é»˜è®¤ä¼šå®‰è£…`npx`å‘½ä»¤ï¼Œå®ƒå¯ä»¥é¿å…å…¨å±€å®‰è£…æ¨¡å—ã€‚è¿™äº›ä¸åŒçš„ç­–ç•¥åœ¨ä¹‹åçš„æ–‡ç« ä¸­ä¼šæåŠï¼Œåœ¨è¿™é‡Œä¸åšè¿‡å¤šçš„èµ˜è¿°ã€‚\n\n### 4.3. ä½¿ç”¨nvmç®¡ç†nodeç‰ˆæœ¬\nnvmæ˜¯ç›®å‰æ¯”è¾ƒä¸»æµçš„nodeç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œç±»ä¼¼çš„è¿˜æœ‰nodistï¼ˆ`https://github.com/nullivex/nodist/releases`ï¼‰ã€‚è¿™é‡Œä»¥nvmä¸ºå‡†è¿›è¡Œä»‹ç»ã€‚\n#### 4.3.1. windowsç¯å¢ƒå®‰è£…\nè¿›å…¥å®˜ç½‘ä¸‹è½½é“¾æ¥`https://github.com/coreybutler/nvm-windows/releases`ï¼Œä¸‹è½½assetsä¸­çš„å®‰è£…åŒ…ï¼ˆæ–‡ç« æœ«å°¾æä¾›å®‰è£…åŒ…ï¼‰ã€‚\n\n![13.png](/img/posts/2022-3-1/2022-3-1-6.png)\n\nè¿™é‡Œå¯ä»¥ç›´æ¥ä¸‹è½½setupç‰ˆçš„ï¼Œè§£å‹ååŒå‡»å°±å¯å®‰è£…ã€‚å½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©noinstallç‰ˆæœ¬çš„ï¼Œé€šè¿‡æ‰‹åŠ¨é…ç½®ç¯å¢ƒæ¥è¾¾åˆ°ç›¸åŒçš„ç›®çš„ã€‚è¿™é‡Œä»¥å®‰è£…ç‰ˆä¸ºä¾‹ã€‚ä¸‹å›¾ä¸ºå®‰è£…ç•Œé¢ï¼š\n\n![14.png](/img/posts/2022-3-1/2022-3-1-7.png)\nä¸€è·¯nextåˆ°åº•å®Œæˆå®‰è£…å³å¯ã€‚ç¯å¢ƒå˜é‡å·²ç»è‡ªåŠ¨é…ç½®å¥½äº†ã€‚\nåœ¨å‘½ä»¤è¡Œä¸­æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸï¼š\n\n![15.png](/img/posts/2022-3-1/2022-3-1-8.png)\n\nçœ‹åˆ°ç‰ˆæœ¬è¯´æ˜å·²ç»æ­£ç¡®å®‰è£…ï¼ï¼\n#### 4.3.2. MacOSç¯å¢ƒå®‰è£…ï¼ˆéœ€ç¿»å¢™ï¼‰\nè¿›å…¥å®˜ç½‘ä¸‹è½½é“¾æ¥`https://github.com/nvm-sh/nvm#installing-and-updating`ï¼Œå¯ä»¥çœ‹åˆ°å®‰è£…æŒ‡å¼•ï¼Œæˆ‘ä»¬éµä»å®˜æ–¹ç»™çš„æŒ‡ä»¤ç›´æ¥æ‰§è¡Œå³å¯ï¼š\n```sh\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash\n```\næ¥ä¸‹æ¥æ‚¨å¯èƒ½ä¸ä¼šçœ‹åˆ°å®‰è£…æˆåŠŸï¼Œåè€Œä¼šæç¤ºå¦‚ä¸‹ï¼š\n\u003e Failed to connect to raw.githubusercontent.com port 443\n\nè¿™æ˜¯å› ä¸ºæŸç§ç¥ç§˜çš„ä¸œæ–¹åŠ›é‡å¯¼è‡´çš„githubè®¿é—®çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©ç½‘å€`https://ipaddress.com/website/raw.githubusercontent.com`æŸ¥ä¸€ä¸‹`githubusercontent.com`çš„çœŸå®IPï¼Œè¾“å…¥githubusercontent.comæŸ¥è¯¢ä¼šçœ‹åˆ°ï¼š\n\n![16.png](/img/posts/2022-3-1/2022-3-1-9.png)\næˆ‘ä»¬æ‰¾ä¸‹è¾¹æŸ¥åˆ°çš„IPå…¶ä¸­ä¸€ä¸ªå³å¯ï¼ˆå¦‚æœä¸è¡Œå°±æ¢ç€è¯•è¯•ï¼‰ï¼Œæ‰§è¡Œä¸‹è¿°æ­¥éª¤ï¼š\n\n1. è¿›å…¥macçš„hostæ–‡ä»¶ï¼š`sudo vim /etc/hosts`\n2. æœ€ä¸‹è¾¹è¿½åŠ IPæ˜ å°„\n\n![17.png](/img/posts/2022-3-1/2022-3-1-10.png)\n\nç»è¿‡è¿™ä¸¤æ­¥åå†æ¬¡å°è¯•ä¸€å“ˆï¼Œå°±å¯ä»¥æ‰§è¡ŒæˆåŠŸäº†ã€‚\n```sh\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash\n```\nå¦‚æœå¾ˆä¸å¹¸ä½ å’å•å‡ºç°äº†å¦‚ä¸‹é”™è¯¯ï¼Œä¸è¦æƒŠæ…Œï¼Œåº”è¯¥æ˜¯æ²¡æœ‰æ£€æµ‹åˆ°ä½ çš„githubè´¦æˆ·ï¼Œä½ åªéœ€è¦æ‰“å¼€githubä¸»é¡µç™»å½•è´¦å·é‡è¯•å³å¯ã€‚\n\u003e unable to access 'https://github.com/nvm-sh/nvm.git/': LibreSSL SSL_connect: SSL_ERROR_SYSCALL in connection to github.com:443\n\næœ€åï¼\n\nå®‰è£…æˆåŠŸçš„ç•Œé¢å¦‚ä¸‹ï¼š\n\n![18.png](/img/posts/2022-3-1/2022-3-1-11.png)\n\næ­¤æ—¶å…ˆä¸è¦ç€æ€¥ï¼Œå…¨å±€çš„`nvm`æŒ‡ä»¤è¿˜æ²¡æœ‰åŠ å…¥ç¯å¢ƒå˜é‡ä¸­ï¼Œéœ€è¦ä½ æ¥æ‰‹åŠ¨æ·»åŠ ã€‚æ‰§è¡Œå‘½ä»¤(ä»¥zshç»ˆç«¯ä¸ºä¾‹) `sudo vim ~/.zshrc`ï¼Œè¿›å…¥ç¼–è¾‘åï¼Œè¿½åŠ ï¼š\n```sh\nexport NVM_DIR=\"$([ -z \"${XDG_CONFIG_HOME-}\" ] \u0026\u0026 printf %s \"${HOME}/.nvm\" || printf %s \"${XDG_CONFIG_HOME}/nvm\")\"\n[ -s \"$NVM_DIR/nvm.sh\" ] \u0026\u0026 \\. \"$NVM_DIR/nvm.sh\" # This loads nvm\n```\nç„¶åç”Ÿæ•ˆé…ç½®æ–‡ä»¶ï¼š`source ~/.zshrc`å³å¯ã€‚\n\nç°åœ¨å°±è¯•è¯•nvmæŒ‡ä»¤ï¼š\n\n![19.png](/img/posts/2022-3-1/2022-3-1-12.png)\n\næˆåŠŸï¼\n\n##### 4.3.3. nvmåŸºç¡€ä½¿ç”¨\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨`nvm list`å‘½ä»¤æŸ¥çœ‹å½“å‰nodeçš„ç‰ˆæœ¬åˆ—è¡¨\n\n![20.png](/img/posts/2022-3-1/2022-3-1-13.png)\n\nå¯ä»¥çœ‹åˆ°ï¼Œå½“å‰åªæœ‰ç³»ç»Ÿé»˜è®¤çš„16.13.2ç‰ˆæœ¬ã€‚å¦‚æœæƒ³è¦å®‰è£…åˆ«çš„nodeç‰ˆæœ¬ï¼Œæ²¡æœ‰å¿…è¦å†å»nodeå®˜ç½‘ä¸‹è½½äº†ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨nvmæŒ‡ä»¤ä¸‹è½½ã€‚æˆ‘ä»¬å¯ä»¥å…ˆä½¿ç”¨`nvm ls-remote`çœ‹ä¸€ä¸‹å®˜æ–¹éƒ½æœ‰å“ªäº›æ­£å¼ç‰ˆæœ¬ï¼š\n\n![21.png](/img/posts/2022-3-1/2022-3-1-14.png)\n\nåˆ—å‡ºçš„ç‰ˆæœ¬éƒ½æ˜¯å¯ä»¥å®‰è£…çš„ï¼Œæˆ‘ä»¬è¿™é‡Œå¯ä»¥å®‰è£…ç¨³å®šç‰ˆï¼š`nvm install stable`\n\n![23.png](/img/posts/2022-3-1/2022-3-1-15.png)\n\nå¯ä»¥çœ‹åˆ°æˆªæ­¢ä½œè€…å†™è¿™ç¯‡æ–‡ç« æ—¶ï¼Œnodeçš„ç¨³å®šç‰ˆæœ¬æ˜¯17.4.0ï¼Œnvmä¼šè‡ªåŠ¨åˆ‡æ¢è¿›å®‰è£…çš„ç‰ˆæœ¬ä¸Šã€‚å¦‚æœæƒ³è¦è‡ªå®šä¹‰ç‰ˆæœ¬å·å®‰è£…ï¼Œå¯ä»¥ä½¿ç”¨æŒ‡ä»¤`nvm install \u003cç‰ˆæœ¬å·\u003e`\n\n![24.png](/img/posts/2022-3-1/2022-3-1-16.png)\n\nè¿™é‡Œæˆ‘ä»¬å®‰è£…äº†12.22.10ç‰ˆæœ¬ï¼Œå†æ¬¡`nvm list`å¯ä»¥çœ‹åˆ°å·²ç»æœ‰ä¸‰ä¸ªç‰ˆæœ¬äº†ã€‚æƒ³è¦åœ¨å¤šä¸ªç‰ˆæœ¬ä¹‹é—´åˆ‡æ¢ï¼Œåªéœ€ä½¿ç”¨æŒ‡ä»¤`nvm use \u003cç‰ˆæœ¬å·\u003e`å³å¯ä¸€é”®åˆ‡æ¢ï¼\n\n![25.png](/img/posts/2022-3-1/2022-3-1-17.png)\n\nwindowsä¸‹ä½¿ç”¨è¿‡ç¨‹ä¸­è‹¥å‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š\n\n![image.png](/img/posts/2022-3-1/2022-3-1-18.png)\n\nä¸€èˆ¬æ˜¯vscodeæˆ–è€…ç»ˆç«¯æ²¡æœ‰ç®¡ç†å‘˜æƒé™ï¼Œä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€å³å¯ã€‚\n\nè‡³æ­¤ï¼Œå‰ç«¯å·¥ç¨‹åŒ–é¡¹ç›®çš„ç¯å¢ƒé…ç½®å·²ç»ç»“æŸï¼ \n\n## 5. é™„ä»¶\né™„ä»¶æ¸…å•ï¼švscodeå®‰è£…åŒ…. nvmå®‰è£…åŒ…ï¼ˆwinï¼‰. atomå®‰è£…åŒ…ï¼ˆmacï¼‰ã€‚\n\nä¸‹è½½é“¾æ¥ï¼š\n\u003e é“¾æ¥: https://pan.baidu.com/s/1zD2s9UjXrVZ06NANnx8oXg  æå–ç : 5diu"])</script><script>self.__next_f.push([1,"51:T2b05,"])</script><script>self.__next_f.push([1,"## 0. å¼•è¨€\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ä¸€ä¸ªå¥½çš„å‰ç«¯äº§å“ï¼Œå¿…ç„¶æ˜¯ç”¨æˆ·ä½“éªŒä¼˜ç§€. ä½¿ç”¨æµç•…. æ•°æ®å‡†ç¡®. ç•Œé¢å‹å¥½çš„äº§å“ã€‚è¦æƒ³è¾¾åˆ°è¿™ä¸ªç›®æ ‡ï¼Œä¸€å¼€å§‹çš„æŠ€æœ¯é€‰å‹å°±éœ€è¦éå¸¸æ…é‡ï¼Œä¸èƒ½å›¾ä¸€æ—¶ä¹‹å¿«è€Œå¯¼è‡´åæœŸç»´æŠ¤å‡çº§æˆæœ¬æŒ‡æ•°çº§ä¸Šæ¶¨ï¼Œä¹Ÿä¸èƒ½å¿½è§†å›¢é˜Ÿçš„æŠ€æœ¯æ²¿é©å’Œè€æ¿å¯¹äº§å“å®šä½çš„è¦æ±‚ã€‚\n\n\u003e PS. æŠ€æœ¯é€‰å‹ä»è€…è§ä»ï¼Œæœ¬æ–‡åªè°ˆç»éªŒï¼Œæä¾›ä¸€ä¸ªé€‰å‹çš„æ€è·¯ï¼Œè€Œä¸æ˜¯ç»™ä½ å…·ä½“çš„æ–¹æ¡ˆ\n\n#### é€‰å‹çš„ç›®çš„\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸ºäº†å®ç°æ”¶ç›Šæœ€å¤§åŒ–ï¼Œæ˜¯äº§å“è¦æ±‚å’ŒæŠ€æœ¯æˆæœ¬ä¹‹é—´çš„ä¸€ä¸ªæƒè¡¡ã€‚\n\n## 1. ä»ä¼ä¸šçš„è§’åº¦è€ƒè™‘é€‰å‹\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ä¼ä¸šçš„å­˜æ´»å®—æ—¨æ˜¯ç”¨æœ€å°‘çš„äººåŠ›æˆæœ¬åˆ›é€ å‡ºå°½å¯èƒ½å¤šçš„ä¼ä¸šæ•ˆç›Šï¼Œä»è¿™ä¸ªå‡ºå‘ç‚¹å°±å¯ä»¥å¾—å‡ºä¼ä¸šå¯¹ä¸€ä¸ªäº§å“é€‰å‹çš„è¦æ±‚ã€‚\n#### ä¿è¯äº§å“è´¨é‡æ˜¯åŸºç¡€\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;äº§å“è´¨é‡è¦è¿‡åŸºæœ¬å…³ã€‚ä¸è¦æ±‚èƒ½æœ‰å¾ˆæƒŠè‰³çš„æ•ˆæœï¼Œä½†æ˜¯ä¸€å®šè¦æ»¡è¶³å®¢æˆ·çš„è¦æ±‚ï¼Œç½‘é¡µä¸èƒ½é•¿æ—¶é—´ç™½å±ï¼Œè¦ä¸é”™ä½ä¸å¡æ­»ï¼Œæ“ä½œæ­£å¸¸ï¼Œæ•°æ®ç²¾å‡†ã€‚æ›´è¿›é˜¶ä¸€ç‚¹çš„ï¼Œå¯èƒ½è¿˜ä¼šè¦æ±‚ä¸€å®šçš„äº¤äº’å’Œè§†è§‰ä½“éªŒï¼Œè¿˜æœ‰å¯èƒ½ä¼šåŠ å…¥æ— éšœç¢æ•ˆæœã€‚\n\n\u003e å¦‚æœè¦åŠ å…¥å…¼å®¹é˜¿æ‹‰ä¼¯è¯­ç½‘ç«™æ’ç‰ˆçš„è¯ï¼Œå·²æœ‰çš„æ¶æ„å¯èƒ½å®Œå…¨ä¸èƒ½ç”¨ï¼Œéœ€è¦å•ç‹¬å¢åŠ ä¸€å€çš„å·¥ä½œé‡å†å†™ä¸€å¥— -_- \n\n#### é™ä½æˆæœ¬æ˜¯å¿…è¦æ¡ä»¶\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æˆæœ¬åŒ…æ‹¬å‰æœŸå¼€å‘æŠ•å…¥çš„äººåŠ›å’ŒåæœŸç»´æŠ¤æŠ•å…¥çš„äººåŠ›ã€‚å‰ææŠ•å…¥äººåŠ›è¶Šå¤šï¼Œå¼€å‘çš„å‘¨æœŸå¯èƒ½ä¼šçŸ­ï¼Œä½†æ˜¯ä¸ä¹‹å¯¹åº”çš„æ˜¯å›¢é˜Ÿåä½œçš„ç®¡ç†æˆæœ¬ä¼šé«˜èµ·æ¥ï¼›å‰æœŸäººæŠ•å…¥çš„å°‘ï¼Œå¯èƒ½æŠ€æœ¯é€‰å‹ä¼šæœ‰æ¼æ´æˆ–è€…å¯æ‰©å±•æ€§ä¸è¶³ï¼ŒåæœŸæ¢äººæ¥ç»´æŠ¤çš„è¯å¯èƒ½ä¼šä¸¾æ­¥ç»´è‰°ï¼Œä¸å¾—ä¸é‡æ„ã€‚\n\n## 2. ä»äº§å“æŠ€æœ¯å½¢æ€ä¸Šæ¥è€ƒè™‘é€‰å‹\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;äº§å“çš„æŠ€æœ¯å½¢æ€æŒ‡çš„æ˜¯å…¶æŠ€æœ¯æ¨¡å¼ï¼Œåˆ†ä¸ºçº¯å‰ç«¯å¼€å‘. å‰åç«¯åˆ†ç¦»å’Œåç«¯é©±åŠ¨çš„å¼€å‘ã€‚\n\n#### çº¯å‰ç«¯é¡µé¢\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;çº¯å‰ç«¯çš„ä¸€èˆ¬æ˜¯ä¸€äº›é™æ€é¡µé¢ï¼Œæ¯”å¦‚ä¸ªäººåšå®¢. ä¸€äº›æ´»åŠ¨é¡µé¢. å®£ä¼ ç½‘ç«™ç­‰ã€‚ä¸€èˆ¬æ¥è¯´ä¸€ä¸ªäººè¶³ä»¥ï¼Œæ­¤æ—¶ä½ å°±ä¸éœ€è¦è€ƒè™‘ä»€ä¹ˆæ¶æ„äº†ï¼Œä½¿ç”¨ä½ æœ€æ“…é•¿çš„æŠ€æœ¯æ ˆå’Œæˆç†Ÿçš„ç”Ÿæˆå·¥å…·ï¼Œèƒ½å¤Ÿå¿«é€Ÿå †ç Œèµ·æ¥é¡µé¢å°±å¥½ã€‚\n\n#### å‰åç«¯åˆ†ç¦»\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;è¿™ç§äº§å“å½¢æ€åº”è¯¥æ˜¯ç›®å‰å¸‚é¢ä¸Šå¤§å¤šæ•°äº§å“çš„å¼€å‘æ¨¡å¼ï¼Œæ¯”å¦‚å¤§å‹çš„ToBé¡¹ç›®. æˆç†Ÿçš„APPç½‘é¡µå®¢æˆ·ç«¯. ç½‘é¡µè´­ç‰©ç­‰ã€‚è¿™ç§çš„äº§å“ï¼Œé¡µé¢æ¸²æŸ“åŸºæœ¬ä¸Šæ˜¯å‰ç«¯çš„å·¥ä½œï¼Œåç«¯åªéœ€è¦æä¾›APIæ–‡æ¡£å³å¯ã€‚\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;è¿™æ ·çš„äº§å“ï¼Œæ¨èåšæˆWebç«¯æ¸²æŸ“æ¡†æ¶å¼€å‘çš„å•é¡µåº”ç”¨ï¼Œæˆ–è€…ä½¿ç”¨node.jsåšæˆç›´å‡ºæ¨¡æ¿æ¸²æŸ“å¼çš„ã€‚å¦‚æœé¡¹ç›®ä¸šåŠ¡æ¯”è¾ƒå¤šï¼Œå¯ä»¥è€ƒè™‘éƒ¨ç½²å‰ç«¯å¾®æœåŠ¡ã€‚\n\n#### åç«¯ä¸»å¯¼å¼€å‘\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;åç«¯ä¸»å¯¼çš„äº§å“å›¢é˜Ÿï¼Œä¸€èˆ¬ä¸Šä¸ä¼šæœ‰å•ç‹¬çš„å‰ç«¯å¼€å‘ç»„ï¼Œéƒ½æ˜¯ä¸€ä¸ªå›¢é˜Ÿé…ä¸€åˆ°ä¸¤ä¸ªå‰ç«¯æ¥é…åˆåç«¯å¼€å‘ã€‚æ­¤æ—¶ä½œä¸ºå‰ç«¯ï¼Œä½ å°±ä¸éœ€è¦æœ‰å¤ªå¤šè‡ªå·±çš„æƒ³æ³•ï¼Œä¸€åˆ‡ä»ç®€å³å¯ã€‚æ¯”å¦‚ä½¿ç”¨å‰ç«¯é¢„å¤„ç†å™¨Sassæ—¶ï¼Œå¯èƒ½å°±éœ€è¦æ…é‡ä¸€äº›ã€‚åŒæ—¶ä¹Ÿä¸è¦æ ‡æ–°ç«‹å¼‚ï¼Œä½¿ç”¨è¿™ä¸ªå›¢é˜Ÿæ²¡æœ‰ç”¨è¿‡çš„å‰ç«¯æ¡†æ¶ï¼Œè·ŸéšåŸæ¥çš„æŠ€æœ¯æ ˆèµ°å³å¯ã€‚\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;è¿™æ—¶å€™ä½ å¯èƒ½å°±ä¼šæ¯”è¾ƒç—›è‹¦ï¼Œä¸€æ–¹é¢è¦ç»´æŠ¤å‰ä»»å†™çš„ä¹±ä¸ƒå…«ç³Ÿçš„ä»£ç ï¼Œä¸€æ–¹é¢åˆä¸èƒ½ç”¨è‡ªå·±æ“…é•¿çš„æŠ€æœ¯ã€‚ä½œè€…å°±â€œæœ‰å¹¸â€åšè¿‡è¿™æ ·çš„äº§å“ã€‚å½“æ—¶åç«¯çš„è¦æ±‚æ˜¯APIæ¥å£æ˜ å°„åç§°ä¸èƒ½å†™æ­»åˆ°ä»£ç é‡Œï¼Œå‰ç«¯è¦åšæˆå¯é…ç½®å¼çš„ï¼›åç«¯ä¸æ„¿æ„ä¿®æ”¹è¿”å›çš„JSONï¼Œæˆ‘ä¸å¾—ä¸ä¸€å±‚å±‚æ¥è§£æåƒæ— åº•æ´ä¸€æ ·æ·±çš„JSONæ•°æ®ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¸å›¢é˜Ÿç§¯ææ²Ÿé€šæ˜¯ä¸€æ–¹é¢ï¼Œå¦ä¸€æ–¹é¢æ˜¯æ‰¾å‡†è‡ªå·±çš„å®šä½æ¥ä½¿ç”¨æŠ€æœ¯ã€‚è¿™æ ·æ‰æ˜¯ä¸€ä¸ªå¥½çš„ç¨‹åºå‘˜çš„åŸºæœ¬ä¿®å…»ï¼Œæ¯•ç«Ÿè¿™ä¸ªç¨‹åºä½ ä¸å¯èƒ½è‡ªå·±ä¸€ä¸ªäººæ‹¿å‡ºå»å–ä¸æ˜¯ã€‚\n\n## 3. ä»é¢å‘ç”¨æˆ·ç¾¤æ¥è€ƒè™‘é€‰å‹\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å‰ç«¯äº§å“é¢å‘çš„ç”¨æˆ·ç¾¤ä½“ä¸åŒï¼Œå±•ç°çš„å½¢å¼ä¼šæœ‰å·®å¼‚ï¼Œç°ä»£äº’è”ç½‘å¼€å‘å¯¹äºåŒä¸€ä¸ªç”¨æˆ·ç¾¤åˆåˆ†ä¸ºPCç«¯å’Œç§»åŠ¨ç«¯äº§å“ä¸¤ç§ã€‚ä¸»è¦åˆ†ç±»æœ‰å¦‚ä¸‹å‡ ç§ï¼šå¤–éƒ¨ç”¨æˆ·PCç«¯. å¤–éƒ¨ç”¨æˆ·ç§»åŠ¨ç«¯. å†…éƒ¨ç”¨æˆ·PCç«¯. å†…éƒ¨ç”¨æˆ·ç§»åŠ¨ç«¯ï¼›åŒæ—¶å›½å†…å¤–ç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯ä¹Ÿä¼šæœ‰ç»†å¾®çš„å·®åˆ«ã€‚\n\n#### å¤–éƒ¨ç”¨æˆ·PCç«¯\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å¯¹äºå¤–éƒ¨ç”¨æˆ·ï¼Œè§†è§‰ä½“éªŒæ˜¯ç¬¬ä¸€ä½çš„ï¼ŒPCç«¯ä¸ŠSSRä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ä½ å¯èƒ½éœ€è¦ä¸€ä¸ªæ¯”è¾ƒå®Œå–„çš„æ¡†æ¶ï¼Œæ”¯æŒSSRé…ç½®å’ŒUIåŠ¨ç”»åº“ï¼Œè€Œä¸”è¦è°ƒç ”æ¸…æ¥šæ˜¯å¦è¦æ”¯æŒIEç”¨æˆ·ï¼ˆç”šè‡³æ˜¯IE8ï¼‰ï¼Œ`JQuery`(æˆ–**Zepto.js**) æœ‰æ—¶ä¹Ÿæ˜¯æ¯”è¾ƒç®¡ç”¨çš„ã€‚\n\n#### å¤–éƒ¨ç”¨æˆ·ç§»åŠ¨ç«¯\n**1. ç§»åŠ¨ç«¯è®¿é—®çš„é¡µé¢**\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å³ç”¨æ‰‹æœºæµè§ˆå™¨è®¿é—®Webé¡µé¢ã€‚é¡µé¢åˆ‡æ¢è¿˜éƒ½æ˜¯ä¼ ç»Ÿé“¾æ¥è·³è½¬ï¼Œå±äºä¼ ç»ŸWebé¡µé¢ï¼Œå‰åç«¯åˆ†ç¦»å¼€å‘ï¼Œé¡µé¢ç›´å‡ºæ¸²æŸ“ï¼Œä¸PCç«¯çš„æ¶æ„åŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯è¦åšä¸€äº›é€‚é…å·¥ä½œã€‚\n\n**2. ç§»åŠ¨ç«¯Nativeåº”ç”¨**\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;è¿™éƒ¨åˆ†äº§å“ç›®å‰æ¥è¯´å¯¹äºå‰ç«¯å¼€å‘ç”¨çš„æŠ€æœ¯æ ˆæ¯”è¾ƒå¤šçš„æ˜¯`React Native`ï¼Œä½œè€…å°±æ›¾ç»åšè¿‡APPé‡Œçš„å¹¿å‘Šé¡µå’Œæ´»åŠ¨è¯¦æƒ…é¡µé¢ã€‚å¦‚æœä½ çš„äº§å“æœ‰NativeåŒ–çš„è¦æ±‚ï¼Œé‚£ä¹ˆæ•´ä¸ªäº§å“æŠ€æœ¯æ ˆé¦–é€‰Reactï¼Œæ¯•ç«Ÿè¦å’ŒReact Nativeå…¼å®¹ã€‚\n\n#### å†…éƒ¨ç³»ç»Ÿç”¨æˆ·\n**1. PCè®¿é—®çš„é¡µé¢**\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å†…éƒ¨ç”¨æˆ·ä½¿ç”¨çš„ç®¡ç†ç³»ç»Ÿã€‚è¯¸å¦‚OA. é¡¹ç›®ç®¡ç†ç³»ç»Ÿç­‰ã€‚è¿™äº›éœ€æ±‚æ¯”è¾ƒé€šç”¨ï¼Œå¯ä»¥ä½¿ç”¨å¿«é€Ÿå¼€å‘çš„æ¶æ„ï¼Œä½ ç”šè‡³éƒ½ä¸éœ€è¦ä½¿ç”¨å…¬å¸å†…éƒ¨çš„ç»„ä»¶åº“ï¼Œå¼€æºçš„æ¡†æ¶ + UIåº“ + å›¾è¡¨åº“å®Œå…¨å¯ä»¥æ»¡è¶³è¦æ±‚ã€‚\n\n**2. ç§»åŠ¨ç«¯è®¿é—®çš„é¡µé¢**\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ä¼ä¸šå†…éƒ¨ä½¿ç”¨çš„ç§»åŠ¨ç«¯äº§å“ï¼Œå¤§å¤šä¾é™„äºä¼ä¸šå¾®ä¿¡ç­‰APPã€‚å°±æ‹¿ä¼ä¸šå¾®ä¿¡ä¸¾ä¾‹ï¼Œå·¥ä½œå°å¼€æ”¾æœ‰APIï¼Œæ”¯æŒäºŒæ¬¡å¼€å‘ã€‚è¿™æ ·çš„å†…åµŒH5é¡µé¢ä¹Ÿå¤šä¸ºå•é¡µåº”ç”¨ï¼Œå•ç‹¬éƒ¨ç½²å¹¶é…ç½®å¾®ä¿¡ç›¸å…³éªŒè¯å³å¯ã€‚\n\n#### æµ·å¤–ç”¨æˆ·\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;é’ˆå¯¹æµ·å¤–ç”¨æˆ·ï¼Œé…ç½®PWAæˆ–è€…AMPåº”è¯¥ä¼šæˆä¸ºæ¶æ„é€‰æ‹©çš„ä¸€ä¸ªå¿…é€‰é¡¹ã€‚ç›®å‰ä¸‰å¤§æ¡†æ¶ä¹Ÿéƒ½æ™®éæ”¯æŒPWAã€‚\n\n## 4. ä»äº§å“é¢„æœŸçš„æ•ˆæœæ¥è€ƒè™‘é€‰å‹\n\n#### çŸ­ç”Ÿå‘½å‘¨æœŸ\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;çŸ­ç”Ÿå‘½å‘¨æœŸçš„äº§å“é€šå¸¸è¦æ±‚å¿«é€Ÿèµ·æ­¥ï¼šé—¨æ§›ä½. ä¹¦å†™è‡ªç”±. ä¸å¼ºåˆ¶éµå¾ªä»»ä½•æœ€ä½³å®è·µï¼Œä½¿ç”¨è¿‡åå°±åºŸå¼ƒã€‚è¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨ç®€å•çš„. ä¸è¿‡åº¦å°è£…çš„æ¶æ„ï¼Œä¸ä½¿ç”¨`eslint`å’Œ`Typescript`ã€‚ç”šè‡³ä¸éœ€è¦å®‰æ’code reviewï¼Œå› ä¸ºä¸è€ƒè™‘åæœŸç»´æŠ¤ã€‚\n\n#### é•¿æœŸäº§å“\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å¯¹äºé•¿æœŸäº§å“ï¼ŒåæœŸç»´æŠ¤æ˜¯æ¯”è¾ƒé‡è¦çš„ã€‚è¦é€‰æ‹©å…·æœ‰å®Œæ•´ç”Ÿæ€çš„æ¶æ„ï¼Œèƒ½å¤Ÿå¹³ç¨³å‡çº§ï¼Œé‡‡ç”¨æ¨¡å—åŒ–å°è£…ä¸šåŠ¡ç»„ä»¶ï¼Œä¸ç”¨ç¡¬ç¼–ç ï¼Œæ§åˆ¶å•æ–‡ä»¶ä»£ç è¡Œæ•°ç­‰ã€‚åŒä¸€ä¸ªäº§å“çº¿ä¸Šçš„äº§å“è¿‡å¤šï¼Œæ¯”å¦‚é˜¿é‡Œäº‘çš„æ¶æ„ï¼Œä¸Šå¾®æœåŠ¡ä¹Ÿæ˜¯å¿…è¦çš„ã€‚\n\n#### æ¢ç´¢æ€§äº§å“\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æ¢ç´¢å‹äº§å“å¾€å¾€ä¹Ÿæ˜¯çŸ­å‘¨æœŸäº§å“ï¼Œæ˜¯éœ€è¦æ¯”è¾ƒæ¿€è¿›çš„æ¢ç´¢æ–°çš„å‰æ²¿æŠ€æœ¯ã€‚å¦‚æœæˆåŠŸäº†ï¼Œå¯èƒ½ä¼šè¿‡æ¸¡åˆ°é•¿å‘¨æœŸäº§å“ä¸Šå»ã€‚è¿™ä¸­é—´éœ€è¦æ¶æ„å¸ˆåšå¥½å¯ç§»æ¤çš„èƒ½åŠ›ã€‚\n\n## 5. æ¯”è¾ƒé€šç”¨çš„å»ºè®®\n\n#### æ¡†æ¶é€‰æ‹©\n\u003e `React` OR `Vue` OR `Angular` ?\n\nç®€å•ä»‹ç»ï¼š\n1. Vueä¸Šæ‰‹éš¾åº¦æœ€ä½ï¼Œå­¦å¥½äº†ä¸å®¹æ˜“ï¼Œ`2.0`å¾€`3.0`è¿ç§»ä¹Ÿä¸æ˜¯æ— åˆ›çš„ï¼Œé€æ¸å¼€å§‹å¯¹`TS`æ”¯æŒï¼Œä½†ä¸æ˜¯å¤©ç„¶æ”¯æŒï¼Œéœ€è¦ä½ åœ¨é…ç½®ä¸€ä¸‹ä¸‹ã€‚\n2. Reactæ€§èƒ½å¾ˆå¥½ï¼Œä½†åŒæ—¶ä¹Ÿæ¯”è¾ƒéš¾å­¦ï¼Œç‰ˆæœ¬æ›´æ–°çš„å¾ˆå¿«ï¼Œæ–°ç‰ˆæœ¬çš„`Hooks`å¾ˆå¤šäººä¸èƒ½é€‚åº”ã€‚ä¸å¤æ‚å¯¹åº”çš„æ˜¯ä»–çš„çµæ´»æ€§ï¼Œç”Ÿæ€ä¹Ÿåšå¾—å¾ˆå¥½ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ`TS`ã€‚\n3. Angularå¤©ç„¶æ”¯æŒ`TS`ï¼Œå†…ç½®`Rxjs`ï¼Œå¯åµŒå…¥. æ³¨å…¥å’Œè‡ªå¸¦å•å…ƒæµ‹è¯•ã€‚ä½¿ç”¨è¿‡`Java`çš„åŒå­¦åº”è¯¥ä¼šæ¯”è¾ƒå®¹æ˜“æ¥å—ã€‚ç›®å‰åœ¨å›½å†…ä½¿ç”¨ç‡æ¯”è¾ƒä½ã€‚\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ä½œè€…çš„å»ºè®®æ˜¯ï¼Œ**ç”¨ä½ å›¢é˜Ÿå¸¸ç”¨çš„**ï¼è¿™æ˜¯æœ€ä¸»è¦çš„ï¼Œæˆ‘ä¹‹å‰çš„å…¬å¸æ˜¯ä»æœ€æ—©çš„å‰ç«¯MVCæ¶æ„æ¼”è¿›æ¥çš„ï¼Œä¿ç•™äº†å¤§é‡` Angular 1.x `çš„é¡¹ç›®ï¼Œé‚£å‡çº§è‡ªç„¶æ˜¯å¾€ `2.x `è¿ç§»ï¼ˆè™½ç„¶å®Œå…¨æ˜¯ä¸¤ä¸ªæ¡†æ¶ï¼Œä½†å¹¶ä¸å®Œå…¨æ˜¯! ğŸ¶ï¼›æ­¤å¤–ï¼Œä½ çš„å›¢é˜Ÿå¯¹äºä¹‹å‰ä½¿ç”¨çš„æ¡†æ¶æœ‰ç€å¤§é‡çš„æŠ€æœ¯ç§¯æ·€ï¼Œå°è£…äº†å¤§é‡çš„å·¥å…·åº“. å›¾è¡¨åº“æ¥æ”¯æŒè¿™ä¸ªæ¡†æ¶ï¼Œè´¸ç„¶åˆ‡æ¢æ¶æ„å¯èƒ½éœ€è¦é‡å¤é€ è½®å­ï¼Œå¢åŠ å­¦ä¹ æˆæœ¬ï¼Œé™¤éä½ çš„å®¢æˆ·æŒ‡æ˜è¦ä½ ç”¨ï¼\n\n#### ä¾èµ–å‡çº§çš„å¹³æ»‘åº¦\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;é¡¹ç›®åœ¨æ¡†æ¶å‡çº§çš„æ—¶å€™ï¼Œä½ çš„package.jsoné‡Œçš„ä¾èµ–åº”èƒ½å¤Ÿå¹³æ»‘å‡çº§ï¼Œä½ åœ¨å¼•ç”¨ä¾èµ–ä¹‹å‰ï¼Œè¦å…ˆçœ‹å…¶ä¸»é¡µä¸Šæè¿°çš„æ”¯æŒçš„æ¡†æ¶ç‰ˆæœ¬ï¼Œå¹¶ä¸”è¦æ¸…æ¥šå…¶å°†æ¥ä¼šä¸ä¼šæ”¯æŒæ–°ç‰ˆæœ¬çš„æ¡†æ¶ã€‚å¯¹äºä¸€äº›å·¥å…·å‹çš„ä¾èµ–éƒ½è¿˜å¥½è¯´ï¼Œä½†æ˜¯æœ‰äº›ä¾èµ–ï¼Œæ¯”å¦‚`moment.js`å“ªä¸€å¤©è¯´å…¶ä¸æ”¯æŒ`React18`äº†ï¼ˆå¼€ä¸ªç©ç¬‘ï¼‰ï¼Œä½ çš„é‡æ„æˆæœ¬å°±ä¼šå¾ˆé«˜ã€‚\n\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ä½œè€…ç»™çš„å»ºè®®æ˜¯ï¼Œå°å‹é¡¹ç›®ç”¨æˆç†Ÿçš„å¼€æºUIåº“å’Œå·¥å…·åº“æ²¡æœ‰å…³ç³»ï¼Œå°†æ¥é‡æ„çš„æˆæœ¬è¿˜èƒ½æ¥å—ï¼Œå†µä¸”å°†æ¥ä¹Ÿä¸å¤ªä¼šæ¶‰åŠåˆ°ä¸»ç‰ˆæœ¬çš„é¢‘ç¹æ›´æ–°ã€‚å¦‚æœæ˜¯é•¿æœŸç»´æŠ¤çš„é‡è¦é¡¹ç›®ï¼Œå»ºè®®ä¸»è¦çš„ä¾èµ–ï¼Œæ¯”å¦‚UIåº“ç­‰æœ€å¥½ä½¿ç”¨å…¬å¸å†…éƒ¨çš„ï¼Œè¿™æ ·åœ¨æ¡†æ¶å‡çº§çš„æ—¶å€™ï¼ŒUIå¯ä»¥åŒæ­¥è·Ÿç€å‡çº§å°±å¥½ï¼Œè€Œä¸ç”¨çœ‹ç¬¬ä¸‰æ–¹åº“çš„è„¸è‰²äº†ã€‚\n\n#### TS or JS\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;å›¢é˜Ÿæ²¡ç”¨è¿‡TSï¼Œå°±ä¸è¦è´¸ç„¶ç”¨ï¼Œä¸€ç›´ç”¨TSçš„è¯å°±ä¸€å®šè¦ç”¨ã€‚å¿«é€Ÿé¡¹ç›®ç”¨JSï¼Œå¤§å‹é¡¹ç›®ç”¨TSã€‚\n\n#### UI/å›¾è¡¨åº“é€‰æ‹©\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æœ‰èƒ½åŠ›å°±å›¢é˜Ÿè‡ªå·±å¼€å‘ï¼Œå·®ä¸€ç‚¹çš„å°±å¯¹å¼€æºåº“ï¼Œæ¯”å¦‚UIåº“åƒ`antd`. `elementUI`. `MaterialUI`ç­‰ï¼Œå›¾è¡¨åº“å¦‚`D3.js`. `Apache ECharts`. `g2plot`è¿›è¡ŒäºŒæ¬¡å°è£…åä½¿ç”¨ã€‚\n\n#### ä½œè€…å¸¸ç”¨çš„æŠ€æœ¯æ ˆ\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;ä¸‹é¢æ˜¯ä½œè€…å¸¸ç”¨çš„æŠ€æœ¯æ ˆï¼Œç»è¿‡å…¬å¸åå¤æ‰“ç£¨è¿‡çš„ï¼Œæœ‰ä¸€å®šçš„å‚è€ƒä»·å€¼ï¼Œä½†ä¹Ÿä¸è¦ç›²ç›®ç›¸ä¿¡ã€‚\n\n1. `Angular9+` + `ng-zorro` (æˆ–è€…è‡ªå»ºç»„ä»¶åº“) + `lodash-es` + `echarts` + `jsplumb`.\n2. `React17+` + `antd/Material UI`ï¼ˆæˆ–è€…è‡ªå»ºç»„ä»¶åº“ï¼‰ + è‡ªå»ºAPI Serviceåº“ + å…¬å¸è‡ªå»ºå¾®æœåŠ¡æ¶æ„ + `moment.js` + `Typescript` + `webpack`ï¼ŒçŠ¶æ€ç®¡ç†ä½¿ç”¨`mobx`.\n3. `Vue2` + `Vuex` + `elementUI` + `echarts` + `axios`.\n4. ç±»åº“ä½¿ç”¨ `rollup`\n\n## 6. ç»“è®º\n\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;\u0026nbsp;æ²¡æœ‰æœ€å¥½çš„æ¶æ„é€‰æ‹©ï¼Œåªæœ‰é€‚åˆè‡ªå·±çš„ã€‚ä¹Ÿä¸è¦ç›²ç›®ç›¸ä¿¡åˆ«äººçš„ç»éªŒï¼Œè¿˜æ˜¯è¦åŸºäºè‡ªå·±çš„äº§å“å’Œå›¢é˜Ÿè¿›è¡Œè°ƒç ”åï¼ŒæŒ‰ç…§å®äº‹æ¥åˆ¶å®šç­–ç•¥ã€‚\n\n\n\u003e æ¬¢è¿è¯„è®ºäº¤æµï¼å¦‚æœå‘ç°æœ‰ä¸è¶³çš„åœ°æ–¹ï¼Œå¸Œæœ›å„ä½å¤§ç¥ä¸åèµæ•™ï¼"])</script><script>self.__next_f.push([1,"6:[\"$\",\"$Lf\",null,{\"content\":{\"en\":{\"projects\":[{\"id\":\"1\",\"title\":\"Pixel-UI\",\"description\":\"An open-source Vue component library focusing on pixel style design.\",\"link\":\"https://maomentai817.github.io/pixel-ui/\",\"image\":\"/img/projects/pixel-ui.webp\",\"tags\":[\"Vue\",\"Pixel Style\",\"UI\"],\"category\":\"UI\"},{\"id\":\"2\",\"title\":\"Pixel-UI React\",\"description\":\"ä¸€ä¸ªå¼€æºçš„ React ç»„ä»¶åº“ï¼Œä¸“æ³¨äºåƒç´ é£æ ¼è®¾è®¡ã€‚\",\"link\":\"https://maomentai817.github.io/pixel-ui-react/\",\"image\":\"/img/projects/pixel-ui-react.webp\",\"tags\":[\"Vue\",\"Pixel Style\",\"UI\"],\"category\":\"UI\"},{\"id\":\"3\",\"title\":\"Dux-UI\",\"description\":\"A React component library, providing one-stop project setup, component development, and documentation system deployment using dumi.\",\"link\":\"https://heiheihoho1213.github.io/dux-ui/\",\"image\":\"/img/projects/dux-ui.webp\",\"tags\":[\"React\",\"Component Library\"],\"category\":\"UI\"},{\"id\":\"2\",\"title\":\"CodeReview AI\",\"description\":\"A code review tool based on AI, supporting multiple languages.\",\"link\":\"https://code-review-home.vercel.app/\",\"image\":\"/img/projects/code-review.webp\",\"tags\":[\"AI\",\"Code Review\"],\"category\":\"Tools\"},{\"id\":\"3\",\"title\":\"Chinese Color Palette\",\"description\":\"A color palette for Chinese style.\",\"link\":\"https://heiheihoho1213.github.io/monto-color/\",\"image\":\"/img/projects/china-color.webp\",\"tags\":[\"Color Palette\"],\"category\":\"Tools\"},{\"id\":\"1\",\"title\":\"Colorful Bookmark\",\"description\":\"A colorful tag bookmark extension for Chrome.\",\"link\":\"https://chromewebstore.google.com/detail/colorful-bookmark/ilcmekmgeldhckdembghkiohkdffihpe?hl=zh-CN\u0026utm_source=ext_sidebar\",\"image\":\"/img/projects/colorful-bookmark.webp\",\"tags\":[\"Chrome Extension\"],\"category\":\"Tools\"},{\"id\":\"4\",\"title\":\"Timestamp Converter-Time Zone Clock\",\"description\":\"A timestamp converter and time zone clock extension for Chrome.\",\"link\":\"https://chromewebstore.google.com/detail/%E6%97%B6%E9%97%B4%E6%88%B3%E8%BD%AC%E6%8D%A2-%E6%97%B6%E5%8C%BA%E6%97%B6%E9%92%9F/pjcapgdifnhgkkojoggfdlijpelpohcf?hl=zh-CN\u0026gl=DE\",\"image\":\"/img/projects/clock.webp\",\"tags\":[\"Chrome Extension\"],\"category\":\"Tools\"},{\"id\":\"1\",\"title\":\"Web Themes Switch\",\"description\":\"Use css variables to implement theme switching, support black mode, light mode and dark mode.\",\"link\":\"https://code.juejin.cn/pen/7317573307016806435\",\"image\":\"/img/projects/themes-switch.webp\",\"tags\":[\"CSS\"],\"category\":\"Web Themes Switch\"},{\"id\":\"2\",\"title\":\"Ant Design Themes Switch\",\"description\":\"Use antd's theme to implement theme switching, support light mode and dark mode.\",\"link\":\"https://heiheihoho1213.github.io/antd-theme/\",\"image\":\"/img/projects/themes-switch-1.webp\",\"tags\":[\"CSS\"],\"category\":\"Web Themes Switch\"},{\"id\":\"3\",\"title\":\"Sass Preprocessor Theme Switch\",\"description\":\"Use Sass preprocessor to implement theme switching, support light mode, blue mode and dark mode.\",\"link\":\"https://heiheihoho1213.github.io/sass-theme/\",\"image\":\"/img/projects/themes-switch-2.webp\",\"tags\":[\"CSS\"],\"category\":\"Web Themes Switch\"}],\"blog\":[{\"id\":\"1\",\"title\":\"ğŸ® ä» NES åˆ°ç°ä»£ Web â€”â€” åƒç´ é£ç»„ä»¶åº“ Pixel UI  React ç‰ˆæœ¬ï¼Œæ¬¢è¿å¤§å®¶ä¸€èµ·å‚ä¸è¿™ä¸ªé¡¹ç›®\",\"date\":\"2025-11-19\",\"readTime\":\"3 min\",\"excerpt\":\"æ˜é‡‘ä½œè€… @çŒ«é—·å°817 çš„ Pixel U Vue3 ç‰ˆä¸Šçº¿äº†ï¼Œç°åœ¨æˆ‘ä¸ä»–åˆä½œçš„ React ç‰ˆä¹Ÿæ¥äº†...\",\"tags\":[\"REACT\",\"GITHUB\",\"UI/UX\"],\"content\":\"$10\",\"slug\":\"Pixel-UI-React\"},{\"id\":\"$undefined\",\"title\":\"React æºç è§£è¯»\",\"date\":\"2024-04-25\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React çš„è™šæ‹Ÿ DOMã€Fiber ç»“æ„ã€è°ƒåº¦å™¨ç­‰æ ¸å¿ƒæ¦‚å¿µå’Œå®ç°åŸç† ...\",\"tags\":[\"React\",\"æºç è§£è¯»\"],\"content\":\"$11\",\"slug\":\"react-source\"},{\"id\":\"$undefined\",\"title\":\"å›¾ç‰‡æ‡’åŠ è½½ï¼šä»ä½åƒç´ é¢„è§ˆåˆ°é«˜æ¸…åŠ è½½\",\"date\":\"2024-02-07\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»å›¾ç‰‡æ‡’åŠ è½½çš„å®ç°æ–¹æ³• ...\",\"tags\":[\"æ€§èƒ½ä¼˜åŒ–\",\"å›¾ç‰‡æ‡’åŠ è½½\"],\"content\":\"$12\",\"slug\":\"react-18-use-12\"},{\"id\":\"$undefined\",\"title\":\"å‰ç«¯ä¸»é¢˜åˆ‡æ¢æµ…æï¼šä½¿ç”¨å‰ç«¯CSSæ¡†æ¶\",\"date\":\"2024-01-25\",\"readTime\":\"2 min\",\"excerpt\":\"ä½¿ç”¨å‰ç«¯CSSæ¡†æ¶å®ç°ä¸»é¢˜åˆ‡æ¢ ...\",\"tags\":[\"CSS\",\"ä¸»é¢˜åˆ‡æ¢\"],\"content\":\"$13\",\"slug\":\"theme-css-frame\"},{\"id\":\"$undefined\",\"title\":\"å‰ç«¯ä¸»é¢˜åˆ‡æ¢æµ…æï¼šCSS-IN-JS\",\"date\":\"2024-01-25\",\"readTime\":\"2 min\",\"excerpt\":\"ä½¿ç”¨CSS-IN-JSå®ç°ä¸»é¢˜åˆ‡æ¢ ...\",\"tags\":[\"CSS\",\"ä¸»é¢˜åˆ‡æ¢\"],\"content\":\"$14\",\"slug\":\"theme-css-in-js\"},{\"id\":\"$undefined\",\"title\":\"å‰ç«¯ä¸»é¢˜åˆ‡æ¢æµ…æï¼šä½¿ç”¨CSSé¢„å¤„ç†å™¨\",\"date\":\"2024-01-25\",\"readTime\":\"2 min\",\"excerpt\":\"ä½¿ç”¨CSSé¢„å¤„ç†å™¨å®ç°ä¸»é¢˜åˆ‡æ¢ ...\",\"tags\":[\"CSS\",\"ä¸»é¢˜åˆ‡æ¢\"],\"content\":\"## CSS é¢„å¤„ç†å™¨\\n\\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š[sass é¢„ç¼–è¯‘ theme](https://duheng1992.github.io/sass-theme/)\\n\\nå°†æ‰€æœ‰çš„æ ·å¼æ–‡ä»¶ä½¿ç”¨ Sass é¢„å…ˆå®šä¹‰å¥½ï¼š\\n\\n![image.png](/img/posts/2024-1-25/2024-1-25-5.png)\\n\\nç„¶åå†™ä¸€ä¸ª `buildThemes.js` è„šæœ¬åœ¨æ‰“åŒ…å‰ç¼–è¯‘ä¸º cssï¼Œç„¶åå°†è¿™ä¸ªæ–‡ä»¶åŠ¨æ€æ’å…¥åˆ° head é‡Œï¼š\\n\\n```js\\nconst createLinkElementWithKey = (key) =\u003e {\\n  const linkEl = document.createElement('link');\\n  linkEl.setAttribute('rel', 'stylesheet');\\n  linkEl.classList.add(getClassNameForKey(key));\\n  document.head.appendChild(linkEl);\\n  return linkEl;\\n};\\n\\n...\\n// åˆ‡æ¢æ—¶è°ƒç”¨\\nconst setStyle = (key = 'theme', path = 'white') =\u003e {\\n  getLinkElementForKey(key).setAttribute('href', `sass-theme/assets/themes/${path}.css`);\\n}\\n```\\n\\nç¤ºæ„å›¾ï¼š\\n![image.png](/img/posts/2024-1-25/2024-1-25-6.png)\\n\\n\u003e è„šæœ¬çš„å†™æ³•è§ [Demo](https://github.com/heiheihoho1213/sass-theme/tree/master)\\n\\næœ€ç»ˆæ•ˆæœï¼š\\n\\n![image.png](/img/posts/2024-1-25/2024-1-25-7.png)\\n\\n\u003e åœ¨æˆ‘è¿™ä¸ª demo é‡Œï¼Œå…¶å®ä¹Ÿæ˜¯æŠŠä¸»é¢˜æ ·å¼æŒ‚è½½ä¸ºå…¨å±€çš„ css å˜é‡ï¼Œåªæ˜¯ä½¿ç”¨ css é¢„å¤„ç†å™¨è¿‡åº¦äº†ä¸€ä¸‹\\n\\n\\nä¼˜ç‚¹ï¼š\\n\\n- æ ·å¼åˆ‡æ¢æµç•…ï¼Œä¸ä¼šå¡é¡¿\\n- è¯­æ³•æ›´å¤šæ ·ï¼Œå¼€å‘æˆæœ¬ä½\\n- ä¸ css å˜é‡ä¸€æ ·ï¼Œæ–°å¢æˆ–ä¿®æ”¹æ ·å¼ï¼Œåªéœ€è¦æ”¹åŠ¨ Scss/Less å˜é‡å³å¯\\n\\nç¼ºç‚¹ï¼š\\n\\n- éœ€è¦åœ¨ç¼–è¯‘æ—¶æ‰‹åŠ¨ç¼–è¯‘ï¼Œè¿è¡Œæ—¶æ²¡åŠæ³•çƒ­æ›¿æ¢\\n- å­¦ä¹ æˆæœ¬é«˜ä¸€äº›\",\"slug\":\"theme-css-preprocessor\"},{\"id\":\"$undefined\",\"title\":\"å‰ç«¯ä¸»é¢˜åˆ‡æ¢æµ…æï¼šä½¿ç”¨CSSå˜é‡\",\"date\":\"2024-01-25\",\"readTime\":\"2 min\",\"excerpt\":\"ä½¿ç”¨CSSå˜é‡å®ç°ä¸»é¢˜åˆ‡æ¢ ...\",\"tags\":[\"CSS\",\"ä¸»é¢˜åˆ‡æ¢\"],\"content\":\"## CSS å˜é‡\\n\\nè¿™ä¸ªæ–¹æ¡ˆæ˜¯ç›®å‰ä¸»æµæ¨èçš„æ–¹æ¡ˆã€‚åœ¨ä»‹ç»ä¹‹å‰ï¼Œå…ˆè®²ä¸€ä¸‹æµè§ˆå™¨çš„å‡ ä¸ªæ–°ç‰¹æ€§ã€‚\\n\\n#### color-scheme æ–¹æ¡ˆ\\n \\n [color-scheme](https://developer.mozilla.org/zh-CN/docs/Web/CSS/color-scheme) æ˜¯æµè§ˆå™¨æ™®éæ”¯æŒçš„é…ç½®ä¸»é¢˜çš„å±æ€§ã€‚ä»–è¡¨ç¤ºè°ƒç”¨æ“ä½œç³»ç»Ÿé»˜è®¤çš„ä¸»é¢˜æ–¹æ¡ˆè¦†ç›–å½“å‰å…ƒç´ æ ·å¼ï¼š\\n \\n [color-schemeï¼šCSS å˜é‡ä¸»é¢˜åˆ‡æ¢æ¡ˆä¾‹](https://code.juejin.cn/pen/7317573307016806435)\\n \\n#### è‡ªå®šä¹‰æ–¹æ¡ˆ\\n\\nå¦‚æœè¦è‡ªå®šä¹‰å˜é‡ï¼Œå¯ä»¥è¿™æ ·å®šä¹‰è‡ªå·±çš„æ ·å¼å˜é‡ï¼š\\n\\n```css\\n// theme.css\\n\\n// å¤œé—´æ¨¡å¼\\nhtml[data-theme='dark'] {\\n  --text-color: #fff;\\n  --brand-primary: #1668dc;\\n}\\n\\n// æ™®é€šæ¨¡å¼\\n:root {\\n  --text-color: #333;\\n  --brand-primary: #1677ff;\\n}\\n```\\n\\nç„¶ååœ¨ä½¿ç”¨æ—¶ï¼š\\n\\n```js\\n// å…¥å£æ–‡ä»¶\\nimport './theme.css';\\n\\n// ç»„ä»¶æ ·å¼\\na {\\n  color: var(--brand-primary);\\n}\\n```\\n\\nåœ¨åˆ‡æ¢ä¸»é¢˜æ—¶ï¼š\\n\\n```js\\ndocument.documentElement.dataset.theme = è¦è®¾ç½®çš„theme\\n```\\n\\nä½ å¯ä»¥ç»´æŠ¤ä¸€ä¸ª `useTheme` æ¥åŠ¨æ€è·å–å½“å‰çš„ä¸»é¢˜ã€‚\\n\\nè¿™é‡Œæœ‰ä¸€ä¸ªæˆç†Ÿçš„æ¡ˆä¾‹ï¼š[daisyUI](https://daisyui.com/)\\n\\nä¼˜ç‚¹ï¼š\\n\\n- åŸç”Ÿæ”¯æŒï¼Œæ˜¯ç°åœ¨ä¸»æµæ–¹æ¡ˆ\\n- è½»é‡çº§ï¼Œéƒ¨ç½²æ–¹ä¾¿ï¼Œå¯å®šåˆ¶åŒ–ç¨‹åº¦é«˜\\n- ä¸å­˜åœ¨ä¼˜å…ˆçº§å†²çªé—®é¢˜\\n- å¯å®ç°çƒ­æ›¿æ¢å’Œæ›´æ”¹\\n\\nç¼ºç‚¹ï¼š\\n\\n- è€çš„æµè§ˆå™¨å­˜åœ¨å…¼å®¹æ€§é—®é¢˜\",\"slug\":\"theme-css-variable\"},{\"id\":\"$undefined\",\"title\":\"å‰ç«¯ä¸»é¢˜åˆ‡æ¢æµ…æï¼šä½¿ç”¨LinkåŠ¨æ€å¼•å…¥\",\"date\":\"2024-01-25\",\"readTime\":\"2 min\",\"excerpt\":\"ä½¿ç”¨LinkåŠ¨æ€å¼•å…¥å®ç°ä¸»é¢˜åˆ‡æ¢ ...\",\"tags\":[\"CSS\",\"ä¸»é¢˜åˆ‡æ¢\"],\"content\":\"## Link åŠ¨æ€å¼•å…¥\\n\\næå‰å‡†å¤‡å¥½å„ä¸ªä¸»é¢˜çš„ CSS æ–‡ä»¶ï¼Œåœ¨åˆ‡æ¢çš„æ—¶å€™åŠ è½½ï¼Œæ¯”å¦‚ï¼š\\n\\n```js\\n// js\\n const autoThemeChange = (e) =\u003e {\\n    const isDark = e.matches;\\n    document.getElementById('theme').href = `${isDark ? 'dark' : 'light'}.css`; // è¿™é‡Œçš„æ–‡ä»¶ï¼Œå¯ä»¥æ˜¯è¿œç¨‹çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯é¡¹ç›®ä¸­çš„é™æ€æ–‡ä»¶\\n}\\n\\n mediaQueryListDark = window.matchMedia('(prefers-color-scheme: dark)');\\n mediaQueryListDark.addListener(autoThemeChange); \\n```\\n\\n```html\\n\u003c!-- html --\u003e\\n\u003chead\u003e\\n  \u003clink rel=\\\"stylesheet\\\" src=\\\"https://cdn.xxx.com/dark.css\\\"\u003e\\n\u003chead\u003e\\n```\\n\\nä¼˜ç‚¹ï¼š\\n\\n- å®ç°ç®€å•ï¼Œåªéœ€è¦å…³æ³¨ç»´æŠ¤ css å³å¯\\n- å¯ä»¥å®ç°ä¸»é¢˜æ ·å¼æŒ‰éœ€åŠ è½½\\n\\nç¼ºç‚¹ï¼š\\n\\n- å¦‚æœ css æ–‡ä»¶è¿‡å¤§, å¯èƒ½ä¼šå¯¼è‡´é¡µé¢æ ·å¼é—ªçƒ\\n- å„ä¸ªä¸»é¢˜æ–‡ä»¶ç›¸äº’ç‹¬ç«‹ï¼Œä¿®æ”¹æ ·å¼æ¯”è¾ƒéº»çƒ¦\\n- åœ¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼Œæ²¡åŠæ³•ç›´æ¥æ“ä½œå®¢æˆ·ç«¯ DOM å…ƒç´ ï¼Œä¼šå½±å“åŠ è½½æ€§èƒ½\\n- ä¸å¤Ÿçµæ´»ï¼Œä¸èƒ½æ»¡è¶³ç°ä»£å‰ç«¯å¼€å‘çš„éœ€æ±‚\",\"slug\":\"theme-link\"},{\"id\":\"$undefined\",\"title\":\"å‰ç«¯ä¸»é¢˜åˆ‡æ¢æµ…æï¼šæå‰åŠ è½½æ ·å¼ï¼Œç±»ååˆ‡æ¢æ–¹æ¡ˆ\",\"date\":\"2024-01-25\",\"readTime\":\"2 min\",\"excerpt\":\"æå‰åŠ è½½æ ·å¼ï¼Œç±»ååˆ‡æ¢æ–¹æ¡ˆå®ç°ä¸»é¢˜åˆ‡æ¢ ...\",\"tags\":[\"CSS\",\"ä¸»é¢˜åˆ‡æ¢\"],\"content\":\"## æå‰åŠ è½½æ ·å¼ï¼Œç±»ååˆ‡æ¢æ–¹æ¡ˆ\\n\\nå…ˆå¼•å…¥å„ä¸ªä¸»é¢˜çš„ cssï¼Œé€šè¿‡åˆ‡æ¢ç±»åå®ç°ä¸»é¢˜åˆ‡æ¢ã€‚\\n\\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸ª antd çš„å®ç°æ¡ˆä¾‹ï¼š[antd-theme-change-demo](https://heiheihoho1213.github.io/antd-theme/)\\n\\nä»–çš„åŸç†æ˜¯åˆ‡æ¢ä¸»é¢˜æ—¶ï¼Œå¼•å…¥ä¸åŒçš„ä¸»é¢˜ç®—æ³•ï¼ˆcss æ–‡ä»¶ï¼‰ï¼š\\n\\nç„¶åé…ç½® `ThemeProvider`:\\n\\n```js\\nreturn (\\n   \u003cConfigProvider\\n     theme={{\\n       algorithm: themeLight ? theme.defaultAlgorithm : theme.darkAlgorithm,\\n     }}\\n   \u003e\\n     {children}\\n   \u003c/ConfigProvider\u003e\\n );\\n```\\nåœ¨ä¸¤ç§æ¨¡å¼ä¸‹ï¼Œç›¸åŒçš„å…ƒç´ ï¼Œä½†æ˜¯ç±»åä¸åŒäº†ï¼Œåˆ™ä½¿ç”¨ä¸åŒçš„ css ä¸»é¢˜æ–‡ä»¶ï¼š\\n\\näº®ï¼š\\n![image.png](/img/posts/2024-1-25/2024-1-25-1.png)\\n\\næš—ï¼š\\n![image.png](/img/posts/2024-1-25/2024-1-25-2.png)\\n\\næ­¤å¤–ï¼Œè¿˜å¯ä»¥é…ç½®å‰ç¼€æ¥è‡ªå®šä¹‰ç»„ä»¶æ ·å¼ï¼š\\n\\n```js\\nexport const PREFIX = 'tech-theme';\\n...\\n\\n\u003cConfigProvider\\n  prefixCls={prefixCls}\\n\u003e\\n  {children}\\n\u003c/ConfigProvider\u003e\\n```\\né»˜è®¤ï¼š\\n![image.png](/img/posts/2024-1-25/2024-1-25-3.png)\\n\\nè‡ªå®šä¹‰å‰ç¼€ï¼š\\n\\n![image.png](/img/posts/2024-1-25/2024-1-25-4.png)\\n\\n\u003e æ­¤æ–¹æ¡ˆçš„æ ·å¼è¿˜å¯ä»¥é€šè¿‡ hook åŠ¨æ€è·å–ä¸º token ä½¿ç”¨ã€‚\\n\\nä¼˜ç‚¹ï¼š\\n\\n- æ ·å¼åˆ‡æ¢ä¼šæ›´åŠ é¡ºç•…\\n- ä¾¿äºç»„ä»¶å°è£…ä¸çŠ¶æ€ç®¡ç†\\n- å¯é…ç½®æ€§æ¯”è¾ƒå¼ºï¼Œæ”¯æŒåŠ¨æ€è‡ªå®šä¹‰æ ·å¼\\n\\nç¼ºç‚¹ï¼š\\n\\n- é¦–å±åŠ è½½ä¼šæ…¢ä¸€äº›\\n- é™¤äº†æ ·å¼åˆ‡æ¢ä¸ä¼šé—ªçƒï¼Œå…¶ä½™ç¼ºç‚¹ä¸åŠ¨æ€ link æ–¹æ¡ˆç¼ºç‚¹ä¸€æ ·\",\"slug\":\"theme-preload\"},{\"id\":\"$undefined\",\"title\":\"Nextjs: App Router çš„å®˜ç½‘è§£è¯»\",\"date\":\"2024-01-19\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» Nextjs App Router çš„å®ç°æ–¹æ³• ...\",\"tags\":[\"Nextjs\",\"SSR\"],\"content\":\"$15\",\"slug\":\"nextjs-app-router\"},{\"id\":\"$undefined\",\"title\":\"æ­å»ºå¾®å‰ç«¯ MontoAppï¼ˆå…­ï¼‰ - js æ²™ç®±ï¼šè‡ªæ‰§è¡Œ Script ä¸ å¿«ç…§éš”ç¦»\",\"date\":\"2024-01-11\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»è‡ªæ‰§è¡Œ Script ä¸ å¿«ç…§éš”ç¦»çš„å®ç°æ–¹æ³• ...\",\"tags\":[\"å¾®å‰ç«¯\"],\"content\":\"$16\",\"slug\":\"monto-app-sandbox-snapshot-script\"},{\"id\":\"$undefined\",\"title\":\"æ­å»ºå¾®å‰ç«¯ MontoAppï¼ˆäº”ï¼‰ - js æ²™ç®±ï¼šWeb Components ä¸ iframeéš”ç¦»\",\"date\":\"2024-01-10\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» Web Components ä¸ iframeéš”ç¦»çš„å®ç°æ–¹æ³• ...\",\"tags\":[\"å¾®å‰ç«¯\"],\"content\":\"$17\",\"slug\":\"monto-app-sandbox-webcomponents-iframe\"},{\"id\":\"$undefined\",\"title\":\"æ­å»ºå¾®å‰ç«¯ MontoAppï¼ˆä¸‰ï¼‰ - åŠ¨æ€ script æ–¹æ¡ˆ\",\"date\":\"2024-01-09\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»åŠ¨æ€ script æ–¹æ¡ˆçš„å®ç°æ–¹æ³• ...\",\"tags\":[\"å¾®å‰ç«¯\"],\"content\":\"$18\",\"slug\":\"monto-app-dym-script-1\"},{\"id\":\"$undefined\",\"title\":\"æ­å»ºå¾®å‰ç«¯ MontoAppï¼ˆå››ï¼‰ - Web Components æ–¹æ¡ˆ\",\"date\":\"2024-01-9\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» Web Components æ–¹æ¡ˆçš„å®ç°æ–¹æ³• ...\",\"tags\":[\"å¾®å‰ç«¯\"],\"content\":\"$19\",\"slug\":\"monto-app-web-component\"},{\"id\":\"$undefined\",\"title\":\"æ­å»ºå¾®å‰ç«¯ MontoAppï¼ˆäºŒï¼‰ - NPM æ–¹æ¡ˆ\",\"date\":\"2024-01-08\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» NPM æ–¹æ¡ˆçš„å®ç°æ–¹æ³• ...\",\"tags\":[\"å¾®å‰ç«¯\"],\"content\":\"$1a\",\"slug\":\"monto-app-npm-1\"},{\"id\":\"$undefined\",\"title\":\"æ­å»ºå¾®å‰ç«¯ MontoAppï¼ˆä¸€ï¼‰ - iframe æ–¹æ¡ˆ\",\"date\":\"2024-01-03\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» iframe æ–¹æ¡ˆçš„å®ç°æ–¹æ³• ...\",\"tags\":[\"å¾®å‰ç«¯\"],\"content\":\"$1b\",\"slug\":\"monto-app-iframe-1\"},{\"id\":\"$undefined\",\"title\":\"æµ…è°ˆä½œä¸ºå‰ç«¯å¼€å‘å¯¹äºŒå‰æ ‘éå†çš„ç†è§£\",\"date\":\"2023-12-06\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»äºŒå‰æ ‘éå†çš„å®ç°æ–¹æ³• ...\",\"tags\":[\"ç®—æ³•\"],\"content\":\"$1c\",\"slug\":\"btree-1\"},{\"id\":\"$undefined\",\"title\":\"å¹´ç»ˆç›˜ç‚¹ï¼š2023å¹´ CSS é¢†åŸŸæ–°çš„ä¸€äº›å˜åŒ–\",\"date\":\"2023-12-01\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»2023å¹´ CSS é¢†åŸŸæ–°çš„ä¸€äº›å˜åŒ– ...\",\"tags\":[\"CSS\"],\"content\":\"$1d\",\"slug\":\"new-2023\"},{\"id\":\"$undefined\",\"title\":\"å°è‚šå¸¦æ‚¨ Tailwind CSS å¿«é€Ÿå…¥é—¨\",\"date\":\"2023-11-11\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» Tailwind CSS çš„å¿«é€Ÿå…¥é—¨ ...\",\"tags\":[\"CSS\",\"Tailwind CSS\"],\"content\":\"$1e\",\"slug\":\"fe-tailwindcss-guide\"},{\"id\":\"$undefined\",\"title\":\"æ–°ç‰ˆReactå®˜æ–¹æ–‡æ¡£è§£è¯»ï¼ˆå°¾ç« ï¼‰- å®éªŒæ€§åŠŸèƒ½\",\"date\":\"2023-11-09\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React 18 çš„ useã€useOptimisticã€useFormStateã€useFormStatusã€cacheã€experimental_taintObjectReferenceã€experimental_taintUniqueValue ...\",\"tags\":[\"React\",\"React 18\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$1f\",\"slug\":\"react-18-use-12\"},{\"id\":\"$undefined\",\"title\":\"è®²è®² React æœåŠ¡ç«¯æ¸²æŸ“æœ€ä½³å®è·µæ–¹æ¡ˆã€æ–°ç‰ˆReact + Nextjs å®˜æ–¹æ–‡æ¡£è§£è¯»ã€‘\",\"date\":\"2023-11-03\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React æœåŠ¡ç«¯æ¸²æŸ“æœ€ä½³å®è·µæ–¹æ¡ˆçš„å®ç°æ–¹æ³• ...\",\"tags\":[\"Nextjs\",\"React\",\"SSR\"],\"content\":\"$20\",\"slug\":\"react-ssr\"},{\"id\":\"$undefined\",\"title\":\"å›¾è§£æµè§ˆå™¨æ¸²æŸ“åŸç†\",\"date\":\"2023-10-26\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»å›¾è§£æµè§ˆå™¨æ¸²æŸ“åŸç†çš„æ–¹æ¡ˆ ...\",\"tags\":[\"æµè§ˆå™¨\"],\"content\":\"$21\",\"slug\":\"v8-render\"},{\"id\":\"$undefined\",\"title\":\"å›¾è§£æµè§ˆå™¨äº‹ä»¶å¾ªç¯\",\"date\":\"2023-10-12\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»å›¾è§£æµè§ˆå™¨äº‹ä»¶å¾ªç¯çš„æ–¹æ¡ˆ ...\",\"tags\":[\"æµè§ˆå™¨\"],\"content\":\"$22\",\"slug\":\"message-loop\"},{\"id\":\"$undefined\",\"title\":\"æ–°ç‰ˆReactå®˜æ–¹æ–‡æ¡£è§£è¯»ï¼ˆåä¸€ï¼‰- Client API ä¹‹ createRootã€hydrateRoot\",\"date\":\"2023-09-17\",\"readTime\":\"5 min\",\"excerpt\":\"ä»‹ç» React 18 çš„ createRoot å’Œ hydrateRoot ...\",\"tags\":[\"React\",\"React 18\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$23\",\"slug\":\"react-18-use-11\"},{\"id\":\"$undefined\",\"title\":\"æ–°ç‰ˆReactå®˜æ–¹æ–‡æ¡£è§£è¯»ï¼ˆåï¼‰- react-dom API ä¹‹ createPortal å’Œ flushSync\",\"date\":\"2023-09-15\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React 18 çš„ createPortal å’Œ flushSync ...\",\"tags\":[\"React\",\"React 18\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$24\",\"slug\":\"react-18-use-10\"},{\"id\":\"$undefined\",\"title\":\"æ–°ç‰ˆReactå®˜æ–¹æ–‡æ¡£è§£è¯»ï¼ˆä¹ï¼‰- react API ä¹‹ memo ã€forwardRef\",\"date\":\"2023-09-13\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React 18 çš„ memo å’Œ forwardRef ...\",\"tags\":[\"React\",\"React 18\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$25\",\"slug\":\"react-18-use-9\"},{\"id\":\"$undefined\",\"title\":\"æ–°ç‰ˆReactå®˜æ–¹æ–‡æ¡£è§£è¯»ï¼ˆå…«ï¼‰- react API ä¹‹ startTransitionã€ createContext å’Œ lazy\",\"date\":\"2023-09-06\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React 18 çš„ startTransitionã€ createContext å’Œ lazy ...\",\"tags\":[\"React\",\"React 18\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$26\",\"slug\":\"react-18-use-8\"},{\"id\":\"$undefined\",\"title\":\"é’ˆå¯¹å‰ç«¯å‘å¸ƒæ–°ç‰ˆæœ¬åç”¨æˆ·é¡µé¢èµ„æºä¸¢å¤±é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ\",\"date\":\"2023-08-27\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»é’ˆå¯¹å‰ç«¯å‘å¸ƒæ–°ç‰ˆæœ¬åç”¨æˆ·é¡µé¢èµ„æºä¸¢å¤±é—®é¢˜çš„è§£å†³æ–¹æ¡ˆçš„æ–¹æ¡ˆ ...\",\"tags\":[\"å‰ç«¯\"],\"content\":\"$27\",\"slug\":\"version-404\"},{\"id\":\"$undefined\",\"title\":\"æ–°ç‰ˆReactå®˜æ–¹æ–‡æ¡£è§£è¯»ï¼ˆä¸ƒï¼‰- react ç»„ä»¶\",\"date\":\"2023-08-24\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React 18 çš„ Profiler å’Œ Suspense ...\",\"tags\":[\"React\",\"React 18\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$28\",\"slug\":\"react-18-use-7\"},{\"id\":\"$undefined\",\"title\":\"æ–°ç‰ˆReactå®˜æ–¹æ–‡æ¡£è§£è¯»ï¼ˆå…­ï¼‰- Hooks ä¹‹ useTransitionã€useDeferredValue\",\"date\":\"2023-08-18\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React 18 çš„ useTransition å’Œ useDeferredValue ...\",\"tags\":[\"React\",\"React 18\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$29\",\"slug\":\"react-18-use-6\"},{\"id\":\"$undefined\",\"title\":\"æ–°ç‰ˆReactå®˜æ–¹æ–‡æ¡£è§£è¯»ï¼ˆäº”ï¼‰- Hooks ä¹‹ useId å’Œ useSyncExternalStore\",\"date\":\"2023-07-05\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React 18 çš„ useId å’Œ useSyncExternalStore ...\",\"tags\":[\"React\",\"React 18\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$2a\",\"slug\":\"react-18-use-5\"},{\"id\":\"$undefined\",\"title\":\"æ–°ç‰ˆReactå®˜æ–¹æ–‡æ¡£è§£è¯»ï¼ˆå››ï¼‰- Hooks ä¹‹ useContextã€useRef å’Œ useImperativeHandle\",\"date\":\"2023-07-04\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React 18 çš„ useContextã€useRef å’Œ useImperativeHandle ...\",\"tags\":[\"React\",\"React 18\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$2b\",\"slug\":\"react-18-use-4\"},{\"id\":\"$undefined\",\"title\":\"æ–°ç‰ˆReactå®˜æ–¹æ–‡æ¡£è§£è¯»ï¼ˆä¸‰ï¼‰- Hooks ä¹‹ useEffectã€useLayoutEffect å’Œ useInsertionEffect\",\"date\":\"2023-07-03\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React 18 çš„ useEffectã€useLayoutEffect å’Œ useInsertionEffect ...\",\"tags\":[\"React\",\"React 18\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$2c\",\"slug\":\"react-18-use-3\"},{\"id\":\"$undefined\",\"title\":\"æ–°ç‰ˆReactå®˜æ–¹æ–‡æ¡£è§£è¯»ï¼ˆäºŒï¼‰- Hooks ä¹‹ useState å’Œ useReducer\",\"date\":\"2023-07-02\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React 18 çš„ useState å’Œ useReducer ...\",\"tags\":[\"React\",\"React 18\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$2d\",\"slug\":\"react-18-use-2\"},{\"id\":\"$undefined\",\"title\":\"æ–°ç‰ˆReactå®˜æ–¹æ–‡æ¡£è§£è¯»ï¼ˆä¸€ï¼‰- Hooks ä¹‹ useCallback å’Œ useMemo\",\"date\":\"2023-07-01\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React 18 çš„ useCallback å’Œ useMemo ...\",\"tags\":[\"React\",\"React 18\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$2e\",\"slug\":\"react-18-use-1\"},{\"id\":\"$undefined\",\"title\":\"å‰ç«¯æ—¶é—´å›½é™…åŒ–çš„ä¸€ç§è§£å†³æ–¹æ¡ˆ\",\"date\":\"2023-06-26\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»å‰ç«¯æ—¶é—´å›½é™…åŒ–çš„ä¸€ç§è§£å†³æ–¹æ¡ˆçš„æ–¹æ¡ˆ ...\",\"tags\":[\"å·¥ç¨‹åŒ–\"],\"content\":\"$2f\",\"slug\":\"timezone-format\"},{\"id\":\"$undefined\",\"title\":\"ESLinté…ç½®é¡¹è¯¦è§£ï¼Œå¹¶å°†é…ç½®æ‰“åŒ…npm\",\"date\":\"2023-04-21\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»ESLinté…ç½®é¡¹è¯¦è§£ï¼Œå¹¶å°†é…ç½®æ‰“åŒ…npmçš„æ–¹æ¡ˆ ...\",\"tags\":[\"ESLint\"],\"content\":\"$30\",\"slug\":\"eslint-start\"},{\"id\":\"$undefined\",\"title\":\"å†™ä¸€ä¸ªç®€æ˜“çš„å‰ç«¯ç°åº¦ç³»ç»Ÿ\",\"date\":\"2023-03-19\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»å†™ä¸€ä¸ªç®€æ˜“çš„å‰ç«¯ç°åº¦ç³»ç»Ÿçš„æ–¹æ¡ˆ ...\",\"tags\":[\"å·¥ç¨‹åŒ–\"],\"content\":\"$31\",\"slug\":\"stark-start\"},{\"id\":\"$undefined\",\"title\":\"å‰ç«¯Nginxé…ç½®æŒ‡åŒ— + HTTPSå®‰å…¨åŸç†\",\"date\":\"2023-03-18\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»å‰ç«¯Nginxé…ç½®æŒ‡åŒ— + HTTPSå®‰å…¨åŸç†çš„æ–¹æ¡ˆ ...\",\"tags\":[\"Nginx\"],\"content\":\"$32\",\"slug\":\"nginx-start\"},{\"id\":\"$undefined\",\"title\":\"Gitlab CI/CD + Nginx å®ç°è‡ªåŠ¨åŒ–é›†æˆæ„å»ºä¸éƒ¨ç½²\",\"date\":\"2023-01-01\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»Gitlab CI/CD + Nginx å®ç°è‡ªåŠ¨åŒ–é›†æˆæ„å»ºä¸éƒ¨ç½²çš„æ–¹æ¡ˆ ...\",\"tags\":[\"å·¥ç¨‹åŒ–\"],\"content\":\"$33\",\"slug\":\"gitlab-cicd\"},{\"id\":\"$undefined\",\"title\":\"å¼€å§‹ä½¿ç”¨ Mobx å§ï¼\",\"date\":\"2022-12-26\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»å¼€å§‹ä½¿ç”¨ Mobx å§ï¼çš„æ–¹æ¡ˆ ...\",\"tags\":[\"å·¥ç¨‹åŒ–\"],\"content\":\"$34\",\"slug\":\"start-mobx\"},{\"id\":\"$undefined\",\"title\":\"å‰ç«¯é¡¹ç›®éƒ¨ç½²ä¸åŒåŸŸåé—´å…±äº«cookieçš„æ–¹æ¡ˆ\",\"date\":\"2022-12-25\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»å‰ç«¯é¡¹ç›®éƒ¨ç½²ä¸åŒåŸŸåé—´å…±äº«cookieçš„æ–¹æ¡ˆ ...\",\"tags\":[\"å·¥ç¨‹åŒ–\"],\"content\":\"$35\",\"slug\":\"cookie-share\"},{\"id\":\"$undefined\",\"title\":\"Gitlabå®‰è£…ä¸ä»“åº“ç®¡ç†\",\"date\":\"2022-12-24\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»Gitlabå®‰è£…ä¸ä»“åº“ç®¡ç†çš„æ–¹æ¡ˆ ...\",\"tags\":[\"å·¥ç¨‹åŒ–\"],\"content\":\"$36\",\"slug\":\"gitlab-install\"},{\"id\":\"$undefined\",\"title\":\"ä½¿ç”¨ Docker + Nginx éƒ¨ç½²å‰ç«¯é¡¹ç›®\",\"date\":\"2022-12-01\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»ä½¿ç”¨ Docker + Nginx éƒ¨ç½²å‰ç«¯é¡¹ç›®çš„æ–¹æ¡ˆ ...\",\"tags\":[\"å·¥ç¨‹åŒ–\"],\"content\":\"$37\",\"slug\":\"docker-nginx\"},{\"id\":\"$undefined\",\"title\":\"å¦‚ä½•ä½¿ç”¨npmå‘å¸ƒåŒ…çš„æµ‹è¯•ç‰ˆå’Œæ­£å¼ç‰ˆ\",\"date\":\"2022-12-01\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»å¦‚ä½•ä½¿ç”¨npmå‘å¸ƒåŒ…çš„æµ‹è¯•ç‰ˆå’Œæ­£å¼ç‰ˆçš„æ–¹æ¡ˆ ...\",\"tags\":[\"npm\"],\"content\":\"$38\",\"slug\":\"npm-version\"},{\"id\":\"$undefined\",\"title\":\"React Router v6 å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ ï¼ˆå…«ï¼‰ ---- æ–°ç‰ˆæ–°å¢åŠŸèƒ½æ±‡æ€»\",\"date\":\"2022-09-30\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React Router v6 çš„æ–°ç‰ˆæ–°å¢åŠŸèƒ½æ±‡æ€» ...\",\"tags\":[\"React\",\"React Router\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$39\",\"slug\":\"react-router-6-new-features-summary\"},{\"id\":\"$undefined\",\"title\":\"React Router v6 å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ ï¼ˆä¸ƒï¼‰ ---- å†…ç½®API\",\"date\":\"2022-09-19\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React Router v6 çš„createRoutesFromChildrenã€createSearchParamsã€generatePathã€Locationã€matchPathã€matchRoutesã€renderMatchesã€resolvePathç­‰å†…ç½®API ...\",\"tags\":[\"React\",\"React Router\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$3a\",\"slug\":\"react-router-6-built-in-api\"},{\"id\":\"$undefined\",\"title\":\"React Router v6 å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ ï¼ˆå…­ï¼‰ ---- Hooks\",\"date\":\"2022-08-26\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React Router v6 çš„useHrefã€useInRouterContextã€useLinkClickHandlerã€useLinkPressHandlerã€useLocationã€useMatchã€useNavigateã€useNavigationTypeã€useOutletã€useOutletContextã€useParamsã€useResolvedPathã€useRoutesã€useSearchParamsç­‰Hooks ...\",\"tags\":[\"React\",\"React Router\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$3b\",\"slug\":\"react-router-6-hooks\"},{\"id\":\"$undefined\",\"title\":\"å‰ç«¯é•¿åˆ—è¡¨æ»šåŠ¨æ–¹æ¡ˆæ¢è®¨ï¼Œçœ‹å®Œä¸è¦å†è¯´ä¸çŸ¥é“æ€ä¹ˆå®ç°è™šæ‹Ÿåˆ—è¡¨äº†\",\"date\":\"2022-08-23\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»å‰ç«¯é•¿åˆ—è¡¨æ»šåŠ¨æ–¹æ¡ˆçš„å®ç°æ–¹æ³• ...\",\"tags\":[\"æ€§èƒ½ä¼˜åŒ–\",\"è™šæ‹Ÿåˆ—è¡¨\"],\"content\":\"$3c\",\"slug\":\"react-18-use-12\"},{\"id\":\"$undefined\",\"title\":\"æ‰‹æŠŠæ‰‹æ­å»ºåŸºäºReactçš„å‰ç«¯UIåº“ ï¼ˆå…«ï¼‰-- æ¨¡æ€æ¡†ç»„ä»¶\",\"date\":\"2022-6-28\",\"readTime\":\"8 min\",\"excerpt\":\"ä»é›¶å¼€å§‹æ­å»ºåŸºäºReact + dumiæ–‡æ¡£ç³»ç»Ÿçš„å‰ç«¯UIåº“ ...\",\"tags\":[\"REACT\",\"GITHUB\",\"UI/UX\",\"ç»„ä»¶åº“æ­å»º\"],\"content\":\"$3d\",\"slug\":\"fe-UI-8\"},{\"id\":\"$undefined\",\"title\":\"æ‰‹æŠŠæ‰‹æ­å»ºåŸºäºReactçš„å‰ç«¯UIåº“ ï¼ˆä¸ƒï¼‰-- å¼¹å‡ºå±‚ç»„ä»¶\",\"date\":\"2022-6-22\",\"readTime\":\"8 min\",\"excerpt\":\"ä»é›¶å¼€å§‹æ­å»ºåŸºäºReact + dumiæ–‡æ¡£ç³»ç»Ÿçš„å‰ç«¯UIåº“ ...\",\"tags\":[\"REACT\",\"GITHUB\",\"UI/UX\",\"ç»„ä»¶åº“æ­å»º\"],\"content\":\"$3e\",\"slug\":\"fe-UI-7\"},{\"id\":\"$undefined\",\"title\":\"Rxjs ä½¿ç”¨æŒ‡åŒ—\",\"date\":\"2022-06-19\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»Rxjs ä½¿ç”¨æŒ‡åŒ—çš„æ–¹æ¡ˆ ...\",\"tags\":[\"Rxjs\"],\"content\":\"$3f\",\"slug\":\"rxjs\"},{\"id\":\"$undefined\",\"title\":\"ä¼ªå…ƒç´ æ¨¡æ‹Ÿå®ç°å¾®è½¯logoé˜´å½±\",\"date\":\"2022-06-15\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»ä¼ªå…ƒç´ æ¨¡æ‹Ÿå®ç°å¾®è½¯logoé˜´å½±çš„å®ç°æ–¹æ³• ...\",\"tags\":[\"CSS\"],\"content\":\"$40\",\"slug\":\"microsoft-logo\"},{\"id\":\"$undefined\",\"title\":\"shadow æ¢ç©¶(äºŒ) - ç¯çŠ¶åŠ¨ç”»\",\"date\":\"2022-06-15\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»ç¯çŠ¶åŠ¨ç”»çš„å®ç°æ–¹æ³• ...\",\"tags\":[\"CSS\"],\"content\":\"$41\",\"slug\":\"ring-animation\"},{\"id\":\"$undefined\",\"title\":\"shadow æ¢ç©¶(ä¸€) - ç«‹ä½“å¡ç‰‡\",\"date\":\"2022-06-15\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»ç«‹ä½“å¡ç‰‡çš„å®ç°æ–¹æ³• ...\",\"tags\":[\"CSS\"],\"content\":\"$42\",\"slug\":\"shadow-card\"},{\"id\":\"$undefined\",\"title\":\"JavaScript å†å²ç‰ˆæœ¬ä¸€è§ˆ\",\"date\":\"2022-06-15\",\"readTime\":\"10 min\",\"excerpt\":\"ä» ECMA-262 æ ‡å‡†åˆ° JavaScript çš„å†å²ç‰ˆæœ¬ä¸€è§ˆ ...\",\"tags\":[\"JavaScript\"],\"content\":\"$43\",\"slug\":\"js-history\"},{\"id\":\"$undefined\",\"title\":\"React Router v6 å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ ï¼ˆäº”ï¼‰ ---- è·¯ç”±ç»„ä»¶\",\"date\":\"2022-06-09\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React Router v6 çš„Linkã€NavLinkã€Navigateã€Outletã€Routesã€Routeç­‰è·¯ç”±ç»„ä»¶ ...\",\"tags\":[\"React\",\"React Router\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$44\",\"slug\":\"react-router-6-routing-components\"},{\"id\":\"$undefined\",\"title\":\"React Router v6 å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ ï¼ˆå››ï¼‰ ---- å„ç§ç±»å‹çš„Router\",\"date\":\"2022-06-08\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React Router v6 çš„æµè§ˆå™¨Routerã€HashRouterã€HistoryRouterã€MemoryRouterã€NativeRouterã€StaticRouterç­‰ ...\",\"tags\":[\"React\",\"React Router\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$45\",\"slug\":\"react-router-6-various-types-of-routers\"},{\"id\":\"$undefined\",\"title\":\"React Router v6 å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ ï¼ˆä¸‰ï¼‰ ---- ä¸»è¦æ¦‚å¿µ\",\"date\":\"2022-06-07\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React Router v6 çš„ä¸»è¦æ¦‚å¿µ ...\",\"tags\":[\"React\",\"React Router\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$46\",\"slug\":\"react-router-6-concepts\"},{\"id\":\"$undefined\",\"title\":\"æ‰‹æŠŠæ‰‹æ­å»ºåŸºäºReactçš„å‰ç«¯UIåº“ ï¼ˆå…­ï¼‰-- æ‰“åŒ…ä¸å‘å¸ƒ\",\"date\":\"2022-5-23\",\"readTime\":\"4 min\",\"excerpt\":\"ä»é›¶å¼€å§‹æ­å»ºåŸºäºReact + dumiæ–‡æ¡£ç³»ç»Ÿçš„å‰ç«¯UIåº“ ...\",\"tags\":[\"REACT\",\"GITHUB\",\"UI/UX\",\"ç»„ä»¶åº“æ­å»º\"],\"content\":\"$47\",\"slug\":\"fe-UI-6\"},{\"id\":\"$undefined\",\"title\":\"æ‰‹æŠŠæ‰‹æ­å»ºåŸºäºReactçš„å‰ç«¯UIåº“ ï¼ˆäº”ï¼‰-- è¡¨å•ç»„ä»¶\",\"date\":\"2022-5-22\",\"readTime\":\"4 min\",\"excerpt\":\"ä»é›¶å¼€å§‹æ­å»ºåŸºäºReact + dumiæ–‡æ¡£ç³»ç»Ÿçš„å‰ç«¯UIåº“ ...\",\"tags\":[\"REACT\",\"GITHUB\",\"UI/UX\",\"ç»„ä»¶åº“æ­å»º\"],\"content\":\"$48\",\"slug\":\"fe-UI-5\"},{\"id\":\"$undefined\",\"title\":\"ğŸ”¥ å‰ç«¯å·¥ç¨‹åŒ–å¿…ç»çš„ä¸€ç¯ -- å‰åç«¯æ¥å£è§„èŒƒ\",\"date\":\"2022-05-01\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»å‰åç«¯æ¥å£è§„èŒƒçš„æ–¹æ¡ˆ ...\",\"tags\":[\"å·¥ç¨‹åŒ–\"],\"content\":\"$49\",\"slug\":\"fe-vs-be\"},{\"id\":\"$undefined\",\"title\":\"React Router v6 å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ ï¼ˆäºŒï¼‰ ---- FAQs\",\"date\":\"2022-04-25\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React Router v6 çš„å¸¸è§é—®é¢˜å’Œè§£ç­” ...\",\"tags\":[\"React\",\"React Router\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$4a\",\"slug\":\"react-router-6-faqs\"},{\"id\":\"$undefined\",\"title\":\"React Router v6 å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ ï¼ˆä¸€ï¼‰ ---- Installation \u0026\u0026 Quick Start\",\"date\":\"2022-04-12\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç» React Router v6 çš„å®‰è£…å’Œå¿«é€Ÿå¼€å§‹ ...\",\"tags\":[\"React\",\"React Router\",\"å®˜æ–¹æ–‡æ¡£ç¿»è¯‘\"],\"content\":\"$4b\",\"slug\":\"react-router-6-installation-quick-start\"},{\"id\":\"$undefined\",\"title\":\"æ‰‹æŠŠæ‰‹æ­å»ºåŸºäºReactçš„å‰ç«¯UIåº“ ï¼ˆå››ï¼‰-- å¸ƒå±€ç»„ä»¶\",\"date\":\"2022-3-21\",\"readTime\":\"4 min\",\"excerpt\":\"ä»é›¶å¼€å§‹æ­å»ºåŸºäºReact + dumiæ–‡æ¡£ç³»ç»Ÿçš„å‰ç«¯UIåº“ ...\",\"tags\":[\"REACT\",\"GITHUB\",\"UI/UX\",\"ç»„ä»¶åº“æ­å»º\"],\"content\":\"$4c\",\"slug\":\"fe-UI-4\"},{\"id\":\"$undefined\",\"title\":\"æ‰‹æŠŠæ‰‹æ­å»ºåŸºäºReactçš„å‰ç«¯UIåº“ ï¼ˆä¸‰ï¼‰-- åŸºç¡€ç»„ä»¶Iconå’ŒButton\",\"date\":\"2022-3-20\",\"readTime\":\"6 min\",\"excerpt\":\"ä»é›¶å¼€å§‹æ­å»ºåŸºäºReact + dumiæ–‡æ¡£ç³»ç»Ÿçš„å‰ç«¯UIåº“ ...\",\"tags\":[\"REACT\",\"GITHUB\",\"UI/UX\",\"ç»„ä»¶åº“æ­å»º\"],\"content\":\"$4d\",\"slug\":\"fe-UI-3\"},{\"id\":\"3\",\"title\":\"æ‰‹æŠŠæ‰‹æ­å»ºåŸºäºReactçš„å‰ç«¯UIåº“ ï¼ˆäºŒï¼‰-- ä¸»é¢˜é…ç½®\",\"date\":\"2022-3-19\",\"readTime\":\"6 min\",\"excerpt\":\"ä»é›¶å¼€å§‹æ­å»ºåŸºäºReact + dumiæ–‡æ¡£ç³»ç»Ÿçš„å‰ç«¯UIåº“ ...\",\"tags\":[\"REACT\",\"GITHUB\",\"UI/UX\",\"ç»„ä»¶åº“æ­å»º\"],\"content\":\"$4e\",\"slug\":\"fe-UI-2\"},{\"id\":\"2\",\"title\":\"æ‰‹æŠŠæ‰‹æ­å»ºåŸºäºReactçš„å‰ç«¯UIåº“ ï¼ˆä¸€ï¼‰-- é¡¹ç›®åˆå§‹åŒ–\",\"date\":\"2022-3-14\",\"readTime\":\"3 min\",\"excerpt\":\"ä»é›¶å¼€å§‹æ­å»ºåŸºäºReact + dumiæ–‡æ¡£ç³»ç»Ÿçš„å‰ç«¯UIåº“ ...\",\"tags\":[\"REACT\",\"GITHUB\",\"UI/UX\",\"ç»„ä»¶åº“æ­å»º\"],\"content\":\"$4f\",\"slug\":\"fe-UI-1\"},{\"id\":\"$undefined\",\"title\":\"å‰ç«¯ç¯å¢ƒæ­å»º\",\"date\":\"2022-03-01\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»å‰ç«¯ç¯å¢ƒæ­å»ºçš„æ–¹æ¡ˆ ...\",\"tags\":[\"å·¥ç¨‹åŒ–\"],\"content\":\"$50\",\"slug\":\"fe-prepare\"},{\"id\":\"$undefined\",\"title\":\"å…³äºå‰ç«¯äº§å“æŠ€æœ¯é€‰å‹é—®é¢˜çš„è‹¥å¹²æ€è€ƒ\",\"date\":\"2022-02-01\",\"readTime\":\"10 min\",\"excerpt\":\"ä»‹ç»å…³äºå‰ç«¯äº§å“æŠ€æœ¯é€‰å‹é—®é¢˜çš„è‹¥å¹²æ€è€ƒçš„æ–¹æ¡ˆ ...\",\"tags\":[\"æŠ€æœ¯é€‰å‹\"],\"content\":\"$51\",\"slug\":\"select-frame\"}],\"gallery\":[{\"id\":\"img-0\",\"src\":\"https://picsum.photos/1200/1200?random=10\",\"alt\":\"Abstract composition 1\",\"category\":\"3D RENDER\",\"title\":\"Render Experiment #1\",\"description\":\"An exploration of procedural generation using Blender geometry nodes. The texture work focuses on imperfection and realism within a digital construct.\"},{\"id\":\"img-1\",\"src\":\"https://picsum.photos/1200/1200?random=11\",\"alt\":\"Abstract composition 2\",\"category\":\"PHOTOGRAPHY\",\"title\":\"Urban Study #2\",\"description\":\"Captured on 35mm film in Tokyo. This shot emphasizes the interplay between brutalist architecture and organic city life.\"},{\"id\":\"img-2\",\"src\":\"https://picsum.photos/1200/1200?random=12\",\"alt\":\"Abstract composition 3\",\"category\":\"3D RENDER\",\"title\":\"Render Experiment #3\",\"description\":\"An exploration of procedural generation using Blender geometry nodes. The texture work focuses on imperfection and realism within a digital construct.\"},{\"id\":\"img-3\",\"src\":\"https://picsum.photos/1200/1200?random=13\",\"alt\":\"Abstract composition 4\",\"category\":\"PHOTOGRAPHY\",\"title\":\"Urban Study #4\",\"description\":\"Captured on 35mm film in Tokyo. This shot emphasizes the interplay between brutalist architecture and organic city life.\"},{\"id\":\"img-4\",\"src\":\"https://picsum.photos/1200/1200?random=14\",\"alt\":\"Abstract composition 5\",\"category\":\"3D RENDER\",\"title\":\"Render Experiment #5\",\"description\":\"An exploration of procedural generation using Blender geometry nodes. The texture work focuses on imperfection and realism within a digital construct.\"},{\"id\":\"img-5\",\"src\":\"https://picsum.photos/1200/1200?random=15\",\"alt\":\"Abstract composition 6\",\"category\":\"PHOTOGRAPHY\",\"title\":\"Urban Study #6\",\"description\":\"Captured on 35mm film in Tokyo. This shot emphasizes the interplay between brutalist architecture and organic city life.\"},{\"id\":\"img-6\",\"src\":\"https://picsum.photos/1200/1200?random=16\",\"alt\":\"Abstract composition 7\",\"category\":\"3D RENDER\",\"title\":\"Render Experiment #7\",\"description\":\"An exploration of procedural generation using Blender geometry nodes. The texture work focuses on imperfection and realism within a digital construct.\"},{\"id\":\"img-7\",\"src\":\"https://picsum.photos/1200/1200?random=17\",\"alt\":\"Abstract composition 8\",\"category\":\"PHOTOGRAPHY\",\"title\":\"Urban Study #8\",\"description\":\"Captured on 35mm film in Tokyo. This shot emphasizes the interplay between brutalist architecture and organic city life.\"},{\"id\":\"img-8\",\"src\":\"https://picsum.photos/1200/1200?random=18\",\"alt\":\"Abstract composition 9\",\"category\":\"3D RENDER\",\"title\":\"Render Experiment #9\",\"description\":\"An exploration of procedural generation using Blender geometry nodes. The texture work focuses on imperfection and realism within a digital construct.\"}]},\"zh\":{\"projects\":[{\"id\":\"1\",\"title\":\"Pixel-UI\",\"description\":\"ä¸€ä¸ªå¼€æºçš„ Vue ç»„ä»¶åº“ï¼Œä¸“æ³¨äºåƒç´ é£æ ¼è®¾è®¡ã€‚\",\"link\":\"https://maomentai817.github.io/pixel-ui/\",\"image\":\"/img/projects/pixel-ui.webp\",\"tags\":[\"Vue\",\"Pixel Style\",\"Component Library\"],\"category\":\"UI\"},{\"id\":\"2\",\"title\":\"Pixel-UI React\",\"description\":\"ä¸€ä¸ªå¼€æºçš„ React ç»„ä»¶åº“ï¼Œä¸“æ³¨äºåƒç´ é£æ ¼è®¾è®¡ã€‚\",\"link\":\"https://maomentai817.github.io/pixel-ui-react/\",\"image\":\"/img/projects/pixel-ui-react.webp\",\"tags\":[\"Vue\",\"Pixel Style\",\"Component Library\"],\"category\":\"UI\"},{\"id\":\"3\",\"title\":\"React ç»„ä»¶åº“å¼€å‘æ•™å­¦é¡¹ç›® Dux-UI\",\"description\":\"ä¸€ä¸ª React ç»„ä»¶åº“å¼€å‘æ•™å­¦é¡¹ç›®ï¼Œä¸€ç«™å¼é¡¹ç›®æ­å»ºã€ç»„ä»¶å¼€å‘ã€ä½¿ç”¨ dumi éƒ¨ç½²æ–‡æ¡£ç³»ç»Ÿã€‚\",\"link\":\"https://heiheihoho1213.github.io/dux-ui/\",\"image\":\"/img/projects/dux-ui.webp\",\"tags\":[\"React\",\"Component Library\"],\"category\":\"UI\"},{\"id\":\"2\",\"title\":\"CodeReview AI\",\"description\":\"åŸºäº AI çš„ä»£ç å®¡æŸ¥å·¥å…·ï¼Œæ”¯æŒå¤šç§è¯­è¨€ã€‚\",\"link\":\"https://code-review-home.vercel.app/\",\"image\":\"/img/projects/code-review.webp\",\"tags\":[\"AI\",\"Code Review\"],\"category\":\"å·¥å…·\"},{\"id\":\"3\",\"title\":\"ä¸­å¼è‰²å¡\",\"description\":\"ä¸­å¼è‰²å½©é…è‰²æ–¹æ¡ˆ\",\"link\":\"https://heiheihoho1213.github.io/monto-color/\",\"image\":\"/img/projects/china-color.webp\",\"tags\":[\"Color Palette\"],\"category\":\"å·¥å…·\"},{\"id\":\"1\",\"title\":\"å¤šå½©ä¹¦ç­¾ ï¼ˆéœ€æ¢¯å­è®¿é—®ï¼‰\",\"description\":\"ä¸€ä¸ªåŸºäº tag åˆ†ç±»çš„Chrome æµè§ˆå™¨ä¹¦ç­¾æ‰©å±•æ’ä»¶ã€‚\",\"link\":\"https://chromewebstore.google.com/detail/colorful-bookmark/ilcmekmgeldhckdembghkiohkdffihpe?hl=zh-CN\u0026utm_source=ext_sidebar\",\"image\":\"/img/projects/colorful-bookmark.webp\",\"tags\":[\"Chrome æ‰©å±•\"],\"category\":\"å·¥å…·\"},{\"id\":\"4\",\"title\":\"æ—¶é—´æˆ³è½¬æ¢-æ—¶åŒºæ—¶é’Ÿï¼ˆéœ€æ¢¯å­è®¿é—®ï¼‰\",\"description\":\"ä¸€ä¸ªæ—¶é—´æˆ³è½¬æ¢å’Œæ—¶åŒºæ—¶é’Ÿçš„Chrome æµè§ˆå™¨æ‰©å±•æ’ä»¶ã€‚\",\"link\":\"https://chromewebstore.google.com/detail/%E6%97%B6%E9%97%B4%E6%88%B3%E8%BD%AC%E6%8D%A2-%E6%97%B6%E5%8C%BA%E6%97%B6%E9%92%9F/pjcapgdifnhgkkojoggfdlijpelpohcf?hl=zh-CN\u0026gl=DE\",\"image\":\"/img/projects/clock.webp\",\"tags\":[\"Chrome æ‰©å±•\"],\"category\":\"å·¥å…·\"},{\"id\":\"1\",\"title\":\"css å˜é‡å®ç°ä¸»é¢˜åˆ‡æ¢\",\"description\":\"ä½¿ç”¨ css å˜é‡å®ç°ä¸»é¢˜åˆ‡æ¢ï¼Œæ”¯æŒé»‘è‰²æ¨¡å¼ã€äº®è‰²æ¨¡å¼å’Œæš—è‰²æ¨¡å¼ã€‚\",\"link\":\"https://code.juejin.cn/pen/7317573307016806435\",\"image\":\"/img/projects/themes-switch.webp\",\"tags\":[\"CSS\"],\"category\":\"Web ä¸»é¢˜åˆ‡æ¢\"},{\"id\":\"2\",\"title\":\"antd ä¸»é¢˜åˆ‡æ¢\",\"description\":\"ä½¿ç”¨ antd çš„ theme å®ç°ä¸»é¢˜åˆ‡æ¢ï¼Œæ”¯æŒäº®è‰²æ¨¡å¼å’Œæš—è‰²æ¨¡å¼ã€‚\",\"link\":\"https://heiheihoho1213.github.io/antd-theme/\",\"image\":\"/img/projects/themes-switch-1.webp\",\"tags\":[\"CSS\"],\"category\":\"Web ä¸»é¢˜åˆ‡æ¢\"},{\"id\":\"3\",\"title\":\"Sass é¢„å¤„ç†å™¨å®ç°ä¸»é¢˜åˆ‡æ¢\",\"description\":\"ä½¿ç”¨ Sass é¢„å¤„ç†å™¨å®ç°ä¸»é¢˜åˆ‡æ¢ï¼Œæ”¯æŒäº®è‰²æ¨¡å¼ã€è“è‰²æ¨¡å¼å’Œæš—è‰²æ¨¡å¼ã€‚\",\"link\":\"https://heiheihoho1213.github.io/sass-theme/\",\"image\":\"/img/projects/themes-switch-2.webp\",\"tags\":[\"CSS\"],\"category\":\"Web ä¸»é¢˜åˆ‡æ¢\"}],\"blog\":\"$6:props:content:en:blog\",\"gallery\":[{\"id\":\"img-0\",\"src\":\"https://picsum.photos/1200/1200?random=10\",\"alt\":\"æŠ½è±¡æ„å›¾ 1\",\"category\":\"3D æ¸²æŸ“\",\"title\":\"æ¸²æŸ“å®éªŒ #1\",\"description\":\"ä½¿ç”¨ Blender å‡ ä½•èŠ‚ç‚¹æ¢ç´¢ç¨‹åºåŒ–ç”Ÿæˆã€‚çº¹ç†å·¥ä½œä¸“æ³¨äºæ•°å­—æ„é€ ä¸­çš„ä¸å®Œç¾å’ŒçœŸå®æ„Ÿã€‚\"},{\"id\":\"img-1\",\"src\":\"https://picsum.photos/1200/1200?random=11\",\"alt\":\"æŠ½è±¡æ„å›¾ 2\",\"category\":\"æ‘„å½±\",\"title\":\"åŸå¸‚ç ”ç©¶ #2\",\"description\":\"åœ¨ä¸œäº¬ç”¨ 35mm èƒ¶ç‰‡æ‹æ‘„ã€‚è¿™å¼ ç…§ç‰‡å¼ºè°ƒäº†ç²—é‡ä¸»ä¹‰å»ºç­‘ä¸æœ‰æœºåŸå¸‚ç”Ÿæ´»ä¹‹é—´çš„ç›¸äº’ä½œç”¨ã€‚\"},{\"id\":\"img-2\",\"src\":\"https://picsum.photos/1200/1200?random=12\",\"alt\":\"æŠ½è±¡æ„å›¾ 3\",\"category\":\"3D æ¸²æŸ“\",\"title\":\"æ¸²æŸ“å®éªŒ #3\",\"description\":\"ä½¿ç”¨ Blender å‡ ä½•èŠ‚ç‚¹æ¢ç´¢ç¨‹åºåŒ–ç”Ÿæˆã€‚çº¹ç†å·¥ä½œä¸“æ³¨äºæ•°å­—æ„é€ ä¸­çš„ä¸å®Œç¾å’ŒçœŸå®æ„Ÿã€‚\"},{\"id\":\"img-3\",\"src\":\"https://picsum.photos/1200/1200?random=13\",\"alt\":\"æŠ½è±¡æ„å›¾ 4\",\"category\":\"æ‘„å½±\",\"title\":\"åŸå¸‚ç ”ç©¶ #4\",\"description\":\"åœ¨ä¸œäº¬ç”¨ 35mm èƒ¶ç‰‡æ‹æ‘„ã€‚è¿™å¼ ç…§ç‰‡å¼ºè°ƒäº†ç²—é‡ä¸»ä¹‰å»ºç­‘ä¸æœ‰æœºåŸå¸‚ç”Ÿæ´»ä¹‹é—´çš„ç›¸äº’ä½œç”¨ã€‚\"},{\"id\":\"img-4\",\"src\":\"https://picsum.photos/1200/1200?random=14\",\"alt\":\"æŠ½è±¡æ„å›¾ 5\",\"category\":\"3D æ¸²æŸ“\",\"title\":\"æ¸²æŸ“å®éªŒ #5\",\"description\":\"ä½¿ç”¨ Blender å‡ ä½•èŠ‚ç‚¹æ¢ç´¢ç¨‹åºåŒ–ç”Ÿæˆã€‚çº¹ç†å·¥ä½œä¸“æ³¨äºæ•°å­—æ„é€ ä¸­çš„ä¸å®Œç¾å’ŒçœŸå®æ„Ÿã€‚\"},{\"id\":\"img-5\",\"src\":\"https://picsum.photos/1200/1200?random=15\",\"alt\":\"æŠ½è±¡æ„å›¾ 6\",\"category\":\"æ‘„å½±\",\"title\":\"åŸå¸‚ç ”ç©¶ #6\",\"description\":\"åœ¨ä¸œäº¬ç”¨ 35mm èƒ¶ç‰‡æ‹æ‘„ã€‚è¿™å¼ ç…§ç‰‡å¼ºè°ƒäº†ç²—é‡ä¸»ä¹‰å»ºç­‘ä¸æœ‰æœºåŸå¸‚ç”Ÿæ´»ä¹‹é—´çš„ç›¸äº’ä½œç”¨ã€‚\"},{\"id\":\"img-6\",\"src\":\"https://picsum.photos/1200/1200?random=16\",\"alt\":\"æŠ½è±¡æ„å›¾ 7\",\"category\":\"3D æ¸²æŸ“\",\"title\":\"æ¸²æŸ“å®éªŒ #7\",\"description\":\"ä½¿ç”¨ Blender å‡ ä½•èŠ‚ç‚¹æ¢ç´¢ç¨‹åºåŒ–ç”Ÿæˆã€‚çº¹ç†å·¥ä½œä¸“æ³¨äºæ•°å­—æ„é€ ä¸­çš„ä¸å®Œç¾å’ŒçœŸå®æ„Ÿã€‚\"},{\"id\":\"img-7\",\"src\":\"https://picsum.photos/1200/1200?random=17\",\"alt\":\"æŠ½è±¡æ„å›¾ 8\",\"category\":\"æ‘„å½±\",\"title\":\"åŸå¸‚ç ”ç©¶ #8\",\"description\":\"åœ¨ä¸œäº¬ç”¨ 35mm èƒ¶ç‰‡æ‹æ‘„ã€‚è¿™å¼ ç…§ç‰‡å¼ºè°ƒäº†ç²—é‡ä¸»ä¹‰å»ºç­‘ä¸æœ‰æœºåŸå¸‚ç”Ÿæ´»ä¹‹é—´çš„ç›¸äº’ä½œç”¨ã€‚\"},{\"id\":\"img-8\",\"src\":\"https://picsum.photos/1200/1200?random=18\",\"alt\":\"æŠ½è±¡æ„å›¾ 9\",\"category\":\"3D æ¸²æŸ“\",\"title\":\"æ¸²æŸ“å®éªŒ #9\",\"description\":\"ä½¿ç”¨ Blender å‡ ä½•èŠ‚ç‚¹æ¢ç´¢ç¨‹åºåŒ–ç”Ÿæˆã€‚çº¹ç†å·¥ä½œä¸“æ³¨äºæ•°å­—æ„é€ ä¸­çš„ä¸å®Œç¾å’ŒçœŸå®æ„Ÿã€‚\"}]}}}]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1, maximum-scale=5\"}]]\n"])</script><script>self.__next_f.push([1,"52:I[1059,[\"/_next/static/chunks/b18da497cd71639c.js\",\"/_next/static/chunks/a43937f87dbafba4.js\"],\"IconMark\"]\nd:[[\"$\",\"title\",\"0\",{\"children\":\"Heiheihoho's Portfolio\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"A portfolio showcasing my projects, blogs, and gallery explorations.\"}],[\"$\",\"link\",\"2\",{\"rel\":\"shortcut icon\",\"href\":\"/favicon.svg\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/favicon.svg\"}],[\"$\",\"link\",\"4\",{\"rel\":\"apple-touch-icon\",\"href\":\"/favicon.svg\"}],[\"$\",\"$L52\",\"5\",{}]]\n9:null\n"])</script></body></html>